function parallelTraverse(e,t,n){n(e,t);for(var i=0;i<e.children.length;i++)parallelTraverse(e.children[i],t.children[i],n)}var requirejs,require,define;if(function(e){var t,n,i,r,o,a,s=s||function(e){function t(){}var n={},i=n.lib={},r=i.Base={extend:function(e){t.prototype=this;var n=new t;return e&&n.mixIn(e),n.hasOwnProperty("init")||(n.init=function(){n.$super.init.apply(this,arguments)}),(n.init.prototype=n).$super=this,n},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},o=i.WordArray=r.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||s).stringify(this)},concat:function(e){var t=this.words,n=e.words,i=this.sigBytes;if(e=e.sigBytes,this.clamp(),i%4)for(var r=0;r<e;r++)t[i+r>>>2]|=(n[r>>>2]>>>24-r%4*8&255)<<24-(i+r)%4*8;else if(65535<n.length)for(r=0;r<e;r+=4)t[i+r>>>2]=n[r>>>2];else t.push.apply(t,n);return this.sigBytes+=e,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=r.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n=[],i=0;i<t;i+=4)n.push(4294967296*e.random()|0);return new o.init(n,t)}}),a=n.enc={},s=a.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],i=0;i<e;i++){var r=t[i>>>2]>>>24-i%4*8&255;n.push((r>>>4).toString(16)),n.push((15&r).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,n=[],i=0;i<t;i+=2)n[i>>>3]|=parseInt(e.substr(i,2),16)<<24-i%8*4;return new o.init(n,t/2)}},c=a.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],i=0;i<e;i++)n.push(String.fromCharCode(t[i>>>2]>>>24-i%4*8&255));return n.join("")},parse:function(e){for(var t=e.length,n=[],i=0;i<t;i++)n[i>>>2]|=(255&e.charCodeAt(i))<<24-i%4*8;return new o.init(n,t)}},l=a.Utf8={stringify:function(e){try{return decodeURIComponent(escape(c.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return c.parse(unescape(encodeURIComponent(e)))}},u=i.BufferedBlockAlgorithm=r.extend({reset:function(){this._data=new o.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=l.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,i=n.words,r=n.sigBytes,a=this.blockSize,s=r/(4*a);if(t=(s=t?e.ceil(s):e.max((0|s)-this._minBufferSize,0))*a,r=e.min(4*t,r),t){for(var c=0;c<t;c+=a)this._doProcessBlock(i,c);c=i.splice(0,t),n.sigBytes-=r}return new o.init(c,r)},clone:function(){var e=r.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});i.Hasher=u.extend({cfg:r.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){u.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new h.HMAC.init(e,n).finalize(t)}}});var h=n.algo={};return n}(Math);!function(e){function t(e){return 4294967296*(e-(0|e))|0}for(var n=s,i=(o=n.lib).WordArray,r=o.Hasher,o=n.algo,a=[],c=[],l=2,u=0;u<64;){var h;e:{h=l;for(var d=e.sqrt(h),p=2;p<=d;p++)if(!(h%p)){h=!1;break e}h=!0}h&&(u<8&&(a[u]=t(e.pow(l,.5))),c[u]=t(e.pow(l,1/3)),u++),l++}var f=[];o=o.SHA256=r.extend({_doReset:function(){this._hash=new i.init(a.slice(0))},_doProcessBlock:function(e,t){for(var n=this._hash.words,i=n[0],r=n[1],o=n[2],a=n[3],s=n[4],l=n[5],u=n[6],h=n[7],d=0;d<64;d++){if(d<16)f[d]=0|e[t+d];else{var p=f[d-15],m=f[d-2];f[d]=((p<<25|p>>>7)^(p<<14|p>>>18)^p>>>3)+f[d-7]+((m<<15|m>>>17)^(m<<13|m>>>19)^m>>>10)+f[d-16]}p=h+((s<<26|s>>>6)^(s<<21|s>>>11)^(s<<7|s>>>25))+(s&l^~s&u)+c[d]+f[d],m=((i<<30|i>>>2)^(i<<19|i>>>13)^(i<<10|i>>>22))+(i&r^i&o^r&o),h=u,u=l,l=s,s=a+p|0,a=o,o=r,r=i,i=p+m|0}n[0]=n[0]+i|0,n[1]=n[1]+r|0,n[2]=n[2]+o|0,n[3]=n[3]+a|0,n[4]=n[4]+s|0,n[5]=n[5]+l|0,n[6]=n[6]+u|0,n[7]=n[7]+h|0},_doFinalize:function(){var t=this._data,n=t.words,i=8*this._nDataBytes,r=8*t.sigBytes;return n[r>>>5]|=128<<24-r%32,n[14+(64+r>>>9<<4)]=e.floor(i/4294967296),n[15+(64+r>>>9<<4)]=i,t.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var e=r.clone.call(this);return e._hash=this._hash.clone(),e}}),n.SHA256=r._createHelper(o),n.HmacSHA256=r._createHmacHelper(o)}(Math),n=s.enc.Utf8,s.algo.HMAC=s.lib.Base.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=n.parse(t));var i=e.blockSize,r=4*i;t.sigBytes>r&&(t=e.finalize(t)),t.clamp();for(var o=this._oKey=t.clone(),a=this._iKey=t.clone(),s=o.words,c=a.words,l=0;l<i;l++)s[l]^=1549556828,c[l]^=909522486;o.sigBytes=a.sigBytes=r,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher;return e=t.finalize(e),t.reset(),t.finalize(this._oKey.clone().concat(e))}}),t=s.lib.WordArray,s.enc.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,i=this._map;e.clamp(),e=[];for(var r=0;r<n;r+=3)for(var o=(t[r>>>2]>>>24-r%4*8&255)<<16|(t[r+1>>>2]>>>24-(r+1)%4*8&255)<<8|t[r+2>>>2]>>>24-(r+2)%4*8&255,a=0;a<4&&r+.75*a<n;a++)e.push(i.charAt(o>>>6*(3-a)&63));if(t=i.charAt(64))for(;e.length%4;)e.push(t);return e.join("")},parse:function(e){var n=e.length,i=this._map;!(r=i.charAt(64))||-1!=(r=e.indexOf(r))&&(n=r);for(var r=[],o=0,a=0;a<n;a++)if(a%4){var s=i.indexOf(e.charAt(a-1))<<a%4*2,c=i.indexOf(e.charAt(a))>>>6-a%4*2;r[o>>>2]|=(s|c)<<24-o%4*8,o++}return t.create(r,o)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},function(e){var t,n,i,r,o,a,s,c,l,u;(t=e.EGAErrorSeverity||(e.EGAErrorSeverity={}))[t.Undefined=0]="Undefined",t[t.Debug=1]="Debug",t[t.Info=2]="Info",t[t.Warning=3]="Warning",t[t.Error=4]="Error",t[t.Critical=5]="Critical",(n=e.EGAProgressionStatus||(e.EGAProgressionStatus={}))[n.Undefined=0]="Undefined",n[n.Start=1]="Start",n[n.Complete=2]="Complete",n[n.Fail=3]="Fail",(i=e.EGAResourceFlowType||(e.EGAResourceFlowType={}))[i.Undefined=0]="Undefined",i[i.Source=1]="Source",i[i.Sink=2]="Sink",(o=(r=e.http||(e.http={})).EGAHTTPApiResponse||(r.EGAHTTPApiResponse={}))[o.NoResponse=0]="NoResponse",o[o.BadResponse=1]="BadResponse",o[o.RequestTimeout=2]="RequestTimeout",o[o.JsonEncodeFailed=3]="JsonEncodeFailed",o[o.JsonDecodeFailed=4]="JsonDecodeFailed",o[o.InternalServerError=5]="InternalServerError",o[o.BadRequest=6]="BadRequest",o[o.Unauthorized=7]="Unauthorized",o[o.UnknownResponseCode=8]="UnknownResponseCode",o[o.Ok=9]="Ok",o[o.Created=10]="Created",(s=(a=e.events||(e.events={})).EGASdkErrorCategory||(a.EGASdkErrorCategory={}))[s.Undefined=0]="Undefined",s[s.EventValidation=1]="EventValidation",s[s.Database=2]="Database",s[s.Init=3]="Init",s[s.Http=4]="Http",s[s.Json=5]="Json",(c=a.EGASdkErrorArea||(a.EGASdkErrorArea={}))[c.Undefined=0]="Undefined",c[c.BusinessEvent=1]="BusinessEvent",c[c.ResourceEvent=2]="ResourceEvent",c[c.ProgressionEvent=3]="ProgressionEvent",c[c.DesignEvent=4]="DesignEvent",c[c.ErrorEvent=5]="ErrorEvent",c[c.InitHttp=9]="InitHttp",c[c.EventsHttp=10]="EventsHttp",c[c.ProcessEvents=11]="ProcessEvents",c[c.AddEventsToStore=12]="AddEventsToStore",(l=a.EGASdkErrorAction||(a.EGASdkErrorAction={}))[l.Undefined=0]="Undefined",l[l.InvalidCurrency=1]="InvalidCurrency",l[l.InvalidShortString=2]="InvalidShortString",l[l.InvalidEventPartLength=3]="InvalidEventPartLength",l[l.InvalidEventPartCharacters=4]="InvalidEventPartCharacters",l[l.InvalidStore=5]="InvalidStore",l[l.InvalidFlowType=6]="InvalidFlowType",l[l.StringEmptyOrNull=7]="StringEmptyOrNull",l[l.NotFoundInAvailableCurrencies=8]="NotFoundInAvailableCurrencies",l[l.InvalidAmount=9]="InvalidAmount",l[l.NotFoundInAvailableItemTypes=10]="NotFoundInAvailableItemTypes",l[l.WrongProgressionOrder=11]="WrongProgressionOrder",l[l.InvalidEventIdLength=12]="InvalidEventIdLength",l[l.InvalidEventIdCharacters=13]="InvalidEventIdCharacters",l[l.InvalidProgressionStatus=15]="InvalidProgressionStatus",l[l.InvalidSeverity=16]="InvalidSeverity",l[l.InvalidLongString=17]="InvalidLongString",l[l.DatabaseTooLarge=18]="DatabaseTooLarge",l[l.DatabaseOpenOrCreate=19]="DatabaseOpenOrCreate",l[l.JsonError=25]="JsonError",l[l.FailHttpJsonDecode=29]="FailHttpJsonDecode",l[l.FailHttpJsonEncode=30]="FailHttpJsonEncode",(u=a.EGASdkErrorParameter||(a.EGASdkErrorParameter={}))[u.Undefined=0]="Undefined",u[u.Currency=1]="Currency",u[u.CartType=2]="CartType",u[u.ItemType=3]="ItemType",u[u.ItemId=4]="ItemId",u[u.Store=5]="Store",u[u.FlowType=6]="FlowType",u[u.Amount=7]="Amount",u[u.Progression01=8]="Progression01",u[u.Progression02=9]="Progression02",u[u.Progression03=10]="Progression03",u[u.EventId=11]="EventId",u[u.ProgressionStatus=12]="ProgressionStatus",u[u.Severity=13]="Severity",u[u.Message=14]="Message"}(i=i||{}),i.EGAErrorSeverity,i.EGAProgressionStatus,i.EGAResourceFlowType,function(e){function t(){t.debugEnabled=!1}var n,i;(i=n=n||{})[i.Error=0]="Error",i[i.Warning=1]="Warning",i[i.Info=2]="Info",i[i.Debug=3]="Debug";var r=(t.setInfoLog=function(e){t.instance.infoLogEnabled=e},t.setVerboseLog=function(e){t.instance.infoLogVerboseEnabled=e},t.i=function(e){if(t.instance.infoLogEnabled){var i="Info/"+t.Tag+": "+e;t.instance.sendNotificationMessage(i,n.Info)}},t.w=function(e){var i="Warning/"+t.Tag+": "+e;t.instance.sendNotificationMessage(i,n.Warning)},t.e=function(e){var i="Error/"+t.Tag+": "+e;t.instance.sendNotificationMessage(i,n.Error)},t.ii=function(e){if(t.instance.infoLogVerboseEnabled){var i="Verbose/"+t.Tag+": "+e;t.instance.sendNotificationMessage(i,n.Info)}},t.d=function(e){if(t.debugEnabled){var i="Debug/"+t.Tag+": "+e;t.instance.sendNotificationMessage(i,n.Debug)}},t.prototype.sendNotificationMessage=function(e,t){switch(t){case n.Error:console.error(e);break;case n.Warning:console.warn(e);break;case n.Debug:"function"==typeof console.debug?console.debug(e):console.log(e);break;case n.Info:console.log(e)}},t.instance=new t,t.Tag="GameAnalytics",t);e.GALogger=r}((a=i=i||{}).logging||(a.logging={})),function(e){function t(){}var n,i,r;n=e.utilities||(e.utilities={}),i=e.logging.GALogger,t.getHmac=function(e,t){var n=s.HmacSHA256(t,e);return s.enc.Base64.stringify(n)},t.stringMatch=function(e,t){return!(!e||!t)&&t.test(e)},t.joinStringArray=function(e,t){for(var n="",i=0,r=e.length;i<r;i++)0<i&&(n+=t),n+=e[i];return n},t.stringArrayContainsString=function(e,t){if(0===e.length)return!1;for(var n in e)if(e[n]===t)return!0;return!1},t.encode64=function(e){e=encodeURI(e);for(var n,i,r,o,a,s="",c=0,l=0,u=0;r=(n=e.charCodeAt(u++))>>2,o=(3&n)<<4|(i=e.charCodeAt(u++))>>4,a=(15&i)<<2|(c=e.charCodeAt(u++))>>6,l=63&c,isNaN(i)?a=l=64:isNaN(c)&&(l=64),s=s+t.keyStr.charAt(r)+t.keyStr.charAt(o)+t.keyStr.charAt(a)+t.keyStr.charAt(l),n=i=c=0,r=o=a=l=0,u<e.length;);return s},t.decode64=function(e){var n,r,o,a,s="",c=0,l=0,u=0;for(/[^A-Za-z0-9\+\/\=]/g.exec(e)&&i.w("There were invalid base64 characters in the input text. Valid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='. Expect errors in decoding."),e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");n=t.keyStr.indexOf(e.charAt(u++))<<2|(o=t.keyStr.indexOf(e.charAt(u++)))>>4,r=(15&o)<<4|(a=t.keyStr.indexOf(e.charAt(u++)))>>2,c=(3&a)<<6|(l=t.keyStr.indexOf(e.charAt(u++))),s+=String.fromCharCode(n),64!=a&&(s+=String.fromCharCode(r)),64!=l&&(s+=String.fromCharCode(c)),n=r=c=0,o=a=l=0,u<e.length;);return decodeURI(s)},t.timeIntervalSince1970=function(){var e=new Date;return Math.round(e.getTime()/1e3)},t.createGuid=function(){return(t.s4()+t.s4()+"-"+t.s4()+"-4"+t.s4().substr(0,3)+"-"+t.s4()+"-"+t.s4()+t.s4()+t.s4()).toLowerCase()},t.s4=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},t.keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r=t,n.GAUtilities=r}(i=i||{}),function(e){function t(){}var n=o.logging.GALogger,i=o.utilities.GAUtilities,r=o.events.EGASdkErrorCategory,a=o.events.EGASdkErrorArea,s=o.events.EGASdkErrorAction,c=o.events.EGASdkErrorParameter,l=function(e,t,n,i,r){this.category=e,this.area=t,this.action=n,this.parameter=i,this.reason=r};e.ValidationResult=l;var u=(t.validateBusinessEvent=function(e,i,o,u,h){return t.validateCurrency(e)?i<0?(n.w("Validation fail - business event - amount. Cannot be less than 0. Failed amount: "+i),new l(r.EventValidation,a.BusinessEvent,s.InvalidAmount,c.Amount,i+"")):t.validateShortString(o,!0)?t.validateEventPartLength(u,!1)?t.validateEventPartCharacters(u)?t.validateEventPartLength(h,!1)?t.validateEventPartCharacters(h)?null:(n.w("Validation fail - business event - itemId: Cannot contain other characters than A-z, 0-9, -_., ()!?. String: "+h),new l(r.EventValidation,a.BusinessEvent,s.InvalidEventPartCharacters,c.ItemId,h)):(n.w("Validation fail - business event - itemId. Cannot be (null), empty or above 64 characters. String: "+h),new l(r.EventValidation,a.BusinessEvent,s.InvalidEventPartLength,c.ItemId,h)):(n.w("Validation fail - business event - itemType: Cannot contain other characters than A-z, 0-9, -_., ()!?. String: "+u),new l(r.EventValidation,a.BusinessEvent,s.InvalidEventPartCharacters,c.ItemType,u)):(n.w("Validation fail - business event - itemType: Cannot be (null), empty or above 64 characters. String: "+u),new l(r.EventValidation,a.BusinessEvent,s.InvalidEventPartLength,c.ItemType,u)):(n.w("Validation fail - business event - cartType. Cannot be above 32 length. String: "+o),new l(r.EventValidation,a.BusinessEvent,s.InvalidShortString,c.CartType,o)):(n.w("Validation fail - business event - currency: Cannot be (null) and need to be A-Z, 3 characters and in the standard at openexchangerates.org. Failed currency: "+e),new l(r.EventValidation,a.BusinessEvent,s.InvalidCurrency,c.Currency,e))},t.validateResourceEvent=function(e,u,h,d,p,f,m){return e==o.EGAResourceFlowType.Undefined?(n.w("Validation fail - resource event - flowType: Invalid flow type."),new l(r.EventValidation,a.ResourceEvent,s.InvalidFlowType,c.FlowType,"")):u?i.stringArrayContainsString(f,u)?0<h?d?t.validateEventPartLength(d,!1)?t.validateEventPartCharacters(d)?i.stringArrayContainsString(m,d)?t.validateEventPartLength(p,!1)?t.validateEventPartCharacters(p)?null:(n.w("Validation fail - resource event - itemId: Cannot contain other characters than A-z, 0-9, -_., ()!?. String: "+p),new l(r.EventValidation,a.ResourceEvent,s.InvalidEventPartCharacters,c.ItemId,p)):(n.w("Validation fail - resource event - itemId: Cannot be (null), empty or above 64 characters. String: "+p),new l(r.EventValidation,a.ResourceEvent,s.InvalidEventPartLength,c.ItemId,p)):(n.w("Validation fail - resource event - itemType: Not found in list of pre-defined available resource itemTypes. String: "+d),new l(r.EventValidation,a.ResourceEvent,s.NotFoundInAvailableItemTypes,c.ItemType,d)):(n.w("Validation fail - resource event - itemType: Cannot contain other characters than A-z, 0-9, -_., ()!?. String: "+d),new l(r.EventValidation,a.ResourceEvent,s.InvalidEventPartCharacters,c.ItemType,d)):(n.w("Validation fail - resource event - itemType: Cannot be (null), empty or above 64 characters. String: "+d),new l(r.EventValidation,a.ResourceEvent,s.InvalidEventPartLength,c.ItemType,d)):(n.w("Validation fail - resource event - itemType: Cannot be (null)"),new l(r.EventValidation,a.ResourceEvent,s.StringEmptyOrNull,c.ItemType,"")):(n.w("Validation fail - resource event - amount: Float amount cannot be 0 or negative. Value: "+h),new l(r.EventValidation,a.ResourceEvent,s.InvalidAmount,c.Amount,h+"")):(n.w("Validation fail - resource event - currency: Not found in list of pre-defined available resource currencies. String: "+u),new l(r.EventValidation,a.ResourceEvent,s.NotFoundInAvailableCurrencies,c.Currency,u)):(n.w("Validation fail - resource event - currency: Cannot be (null)"),new l(r.EventValidation,a.ResourceEvent,s.StringEmptyOrNull,c.Currency,""))},t.validateProgressionEvent=function(e,i,u,h){if(e==o.EGAProgressionStatus.Undefined)return n.w("Validation fail - progression event: Invalid progression status."),new l(r.EventValidation,a.ProgressionEvent,s.InvalidProgressionStatus,c.ProgressionStatus,"");if(h&&!u&&i)return n.w("Validation fail - progression event: 03 found but 01+02 are invalid. Progression must be set as either 01, 01+02 or 01+02+03."),new l(r.EventValidation,a.ProgressionEvent,s.WrongProgressionOrder,c.Undefined,i+":"+u+":"+h);if(u&&!i)return n.w("Validation fail - progression event: 02 found but not 01. Progression must be set as either 01, 01+02 or 01+02+03"),new l(r.EventValidation,a.ProgressionEvent,s.WrongProgressionOrder,c.Undefined,i+":"+u+":"+h);if(!i)return n.w("Validation fail - progression event: progression01 not valid. Progressions must be set as either 01, 01+02 or 01+02+03"),new l(r.EventValidation,a.ProgressionEvent,s.WrongProgressionOrder,c.Undefined,(i||"")+":"+(u||"")+":"+(h||""));if(!t.validateEventPartLength(i,!1))return n.w("Validation fail - progression event - progression01: Cannot be (null), empty or above 64 characters. String: "+i),new l(r.EventValidation,a.ProgressionEvent,s.InvalidEventPartLength,c.Progression01,i);if(!t.validateEventPartCharacters(i))return n.w("Validation fail - progression event - progression01: Cannot contain other characters than A-z, 0-9, -_., ()!?. String: "+i),new l(r.EventValidation,a.ProgressionEvent,s.InvalidEventPartCharacters,c.Progression01,i);if(u){if(!t.validateEventPartLength(u,!0))return n.w("Validation fail - progression event - progression02: Cannot be empty or above 64 characters. String: "+u),new l(r.EventValidation,a.ProgressionEvent,s.InvalidEventPartLength,c.Progression02,u);if(!t.validateEventPartCharacters(u))return n.w("Validation fail - progression event - progression02: Cannot contain other characters than A-z, 0-9, -_., ()!?. String: "+u),new l(r.EventValidation,a.ProgressionEvent,s.InvalidEventPartCharacters,c.Progression02,u)}if(h){if(!t.validateEventPartLength(h,!0))return n.w("Validation fail - progression event - progression03: Cannot be empty or above 64 characters. String: "+h),new l(r.EventValidation,a.ProgressionEvent,s.InvalidEventPartLength,c.Progression03,h);if(!t.validateEventPartCharacters(h))return n.w("Validation fail - progression event - progression03: Cannot contain other characters than A-z, 0-9, -_., ()!?. String: "+h),new l(r.EventValidation,a.ProgressionEvent,s.InvalidEventPartCharacters,c.Progression03,h)}return null},t.validateDesignEvent=function(e){return t.validateEventIdLength(e)?t.validateEventIdCharacters(e)?null:(n.w("Validation fail - design event - eventId: Non valid characters. Only allowed A-z, 0-9, -_., ()!?. String: "+e),new l(r.EventValidation,a.DesignEvent,s.InvalidEventIdCharacters,c.EventId,e)):(n.w("Validation fail - design event - eventId: Cannot be (null) or empty. Only 5 event parts allowed seperated by :. Each part need to be 32 characters or less. String: "+e),new l(r.EventValidation,a.DesignEvent,s.InvalidEventIdLength,c.EventId,e))},t.validateErrorEvent=function(e,i){return e==o.EGAErrorSeverity.Undefined?(n.w("Validation fail - error event - severity: Severity was unsupported value."),new l(r.EventValidation,a.ErrorEvent,s.InvalidSeverity,c.Severity,"")):t.validateLongString(i,!0)?null:(n.w("Validation fail - error event - message: Message cannot be above 8192 characters."),new l(r.EventValidation,a.ErrorEvent,s.InvalidLongString,c.Message,i))},t.validateSdkErrorEvent=function(e,i,o,c,l){return!(!t.validateKeys(e,i)||(o===r.Undefined?(n.w("Validation fail - sdk error event - type: Category was unsupported value."),1):c===a.Undefined?(n.w("Validation fail - sdk error event - type: Area was unsupported value."),1):l===s.Undefined&&(n.w("Validation fail - sdk error event - type: Action was unsupported value."),1)))},t.validateKeys=function(e,t){return!(!i.stringMatch(e,/^[A-z0-9]{32}$/)||!i.stringMatch(t,/^[A-z0-9]{40}$/))},t.validateCurrency=function(e){return!!e&&!!i.stringMatch(e,/^[A-Z]{3}$/)},t.validateEventPartLength=function(e,t){return!(!t||e)||!!e&&!(64<e.length)},t.validateEventPartCharacters=function(e){return!!i.stringMatch(e,/^[A-Za-z0-9\s\-_\.\(\)\!\?]{1,64}$/)},t.validateEventIdLength=function(e){return!!e&&!!i.stringMatch(e,/^[^:]{1,64}(?::[^:]{1,64}){0,4}$/)},t.validateEventIdCharacters=function(e){return!!e&&!!i.stringMatch(e,/^[A-Za-z0-9\s\-_\.\(\)\!\?]{1,64}(:[A-Za-z0-9\s\-_\.\(\)\!\?]{1,64}){0,4}$/)},t.validateAndCleanInitRequestResponse=function(e,t){if(null==e)return n.w("validateInitRequestResponse failed - no response dictionary."),null;var i={};try{var r=e.server_ts;if(!(0<r))return n.w("validateInitRequestResponse failed - invalid value in 'server_ts' field."),null;i.server_ts=r}catch(t){return n.w("validateInitRequestResponse failed - invalid type in 'server_ts' field. type="+typeof e.server_ts+", value="+e.server_ts+", "+t),null}if(t){try{var o=e.configs;i.configs=o}catch(t){return n.w("validateInitRequestResponse failed - invalid type in 'configs' field. type="+typeof e.configs+", value="+e.configs+", "+t),null}try{var a=e.configs_hash;i.configs_hash=a}catch(t){return n.w("validateInitRequestResponse failed - invalid type in 'configs_hash' field. type="+typeof e.configs_hash+", value="+e.configs_hash+", "+t),null}try{var s=e.ab_id;i.ab_id=s}catch(t){return n.w("validateInitRequestResponse failed - invalid type in 'ab_id' field. type="+typeof e.ab_id+", value="+e.ab_id+", "+t),null}try{var c=e.ab_variant_id;i.ab_variant_id=c}catch(t){return n.w("validateInitRequestResponse failed - invalid type in 'ab_variant_id' field. type="+typeof e.ab_variant_id+", value="+e.ab_variant_id+", "+t),null}}return i},t.validateBuild=function(e){return!!t.validateShortString(e,!1)},t.validateSdkWrapperVersion=function(e){return!!i.stringMatch(e,/^(unity|unreal|gamemaker|cocos2d|construct|defold) [0-9]{0,5}(\.[0-9]{0,5}){0,2}$/)},t.validateEngineVersion=function(e){return!(!e||!i.stringMatch(e,/^(unity|unreal|gamemaker|cocos2d|construct|defold) [0-9]{0,5}(\.[0-9]{0,5}){0,2}$/))},t.validateUserId=function(e){return!!t.validateString(e,!1)||(n.w("Validation fail - user id: id cannot be (null), empty or above 64 characters."),!1)},t.validateShortString=function(e,t){return!(!t||e)||!(!e||32<e.length)},t.validateString=function(e,t){return!(!t||e)||!(!e||64<e.length)},t.validateLongString=function(e,t){return!(!t||e)||!(!e||8192<e.length)},t.validateConnectionType=function(e){return i.stringMatch(e,/^(wwan|wifi|lan|offline)$/)},t.validateCustomDimensions=function(e){return t.validateArrayOfStrings(20,32,!1,"custom dimensions",e)},t.validateResourceCurrencies=function(e){if(!t.validateArrayOfStrings(20,64,!1,"resource currencies",e))return!1;for(var r=0;r<e.length;++r)if(!i.stringMatch(e[r],/^[A-Za-z]+$/))return n.w("resource currencies validation failed: a resource currency can only be A-Z, a-z. String was: "+e[r]),!1;return!0},t.validateResourceItemTypes=function(e){if(!t.validateArrayOfStrings(20,32,!1,"resource item types",e))return!1;for(var i=0;i<e.length;++i)if(!t.validateEventPartCharacters(e[i]))return n.w("resource item types validation failed: a resource item type cannot contain other characters than A-z, 0-9, -_., ()!?. String was: "+e[i]),!1;return!0},t.validateDimension01=function(e,t){return!e||!!i.stringArrayContainsString(t,e)},t.validateDimension02=function(e,t){return!e||!!i.stringArrayContainsString(t,e)},t.validateDimension03=function(e,t){return!e||!!i.stringArrayContainsString(t,e)},t.validateArrayOfStrings=function(e,t,i,r,o){var a=r;if(a=a||"Array",!o)return n.w(a+" validation failed: array cannot be null. "),!1;if(0==i&&0==o.length)return n.w(a+" validation failed: array cannot be empty. "),!1;if(0<e&&o.length>e)return n.w(a+" validation failed: array cannot exceed "+e+" values. It has "+o.length+" values."),!1;for(var s=0;s<o.length;++s){var c=o[s]?o[s].length:0;if(0===c)return n.w(a+" validation failed: contained an empty string. Array="+JSON.stringify(o)),!1;if(0<t&&t<c)return n.w(a+" validation failed: a string exceeded max allowed length (which is: "+t+"). String was: "+o[s]),!1}return!0},t.validateClientTs=function(e){return!(e<-4294967294||4294967294<e)},t);e.GAValidator=u}((o=i=i||{}).validators||(o.validators={})),function(e){!function(e){function t(){}var n=function(e,t,n){this.name=e,this.value=t,this.version=n};e.NameValueVersion=n;var i=function(e,t){this.name=e,this.version=t};e.NameVersion=i;var r=(t.touch=function(){},t.getRelevantSdkVersion=function(){return t.sdkGameEngineVersion?t.sdkGameEngineVersion:t.sdkWrapperVersion},t.getConnectionType=function(){return t.connectionType},t.updateConnectionType=function(){navigator.onLine?t.connectionType="ios"===t.buildPlatform||"android"===t.buildPlatform?"wwan":"lan":t.connectionType="offline"},t.getOSVersionString=function(){return t.buildPlatform+" "+t.osVersionPair.version},t.runtimePlatformToString=function(){return t.osVersionPair.name},t.getBrowserVersionString=function(){var e,n=navigator.userAgent,i=n.match(/(opera|chrome|safari|firefox|ubrowser|msie|trident|fbav(?=\/))\/?\s*(\d+)/i)||[];if(0==i.length&&"ios"===t.buildPlatform)return"webkit_"+t.osVersion;if(/trident/i.test(i[1]))return"IE "+((e=/\brv[ :]+(\d+)/g.exec(n)||[])[1]||"");if("Chrome"===i[1]&&null!=(e=n.match(/\b(OPR|Edge|UBrowser)\/(\d+)/)))return e.slice(1).join(" ").replace("OPR","Opera").replace("UBrowser","UC").toLowerCase();if(i[1]&&"fbav"===i[1].toLowerCase()&&(i[1]="facebook",i[2]))return"facebook "+i[2];var r=i[2]?[i[1],i[2]]:[navigator.appName,navigator.appVersion,"-?"];return null!=(e=n.match(/version\/(\d+)/i))&&r.splice(1,1,e[1]),r.join(" ").toLowerCase()},t.getDeviceModel=function(){return"unknown"},t.getDeviceManufacturer=function(){return"unknown"},t.matchItem=function(e,t){var n,r,o,a,s=new i("unknown","0.0.0"),c=0,l=0;for(c=0;c<t.length;c+=1)if(new RegExp(t[c].value,"i").test(e)){if(n=new RegExp(t[c].version+"[- /:;]([\\d._]+)","i"),a="",(r=e.match(n))&&r[1]&&(o=r[1]),o){var u=o.split(/[._]+/);for(l=0;l<Math.min(u.length,3);l+=1)a+=u[l]+(l<Math.min(u.length,3)-1?".":"")}else a="0.0.0";return s.name=t[c].name,s.version=a,s}return s},t.sdkWrapperVersion="javascript 4.0.10",t.osVersionPair=t.matchItem([navigator.platform,navigator.userAgent,navigator.appVersion,navigator.vendor].join(" "),[new n("windows_phone","Windows Phone","OS"),new n("windows","Win","NT"),new n("ios","iPhone","OS"),new n("ios","iPad","OS"),new n("ios","iPod","OS"),new n("android","Android","Android"),new n("blackBerry","BlackBerry","/"),new n("mac_osx","Mac","OS X"),new n("tizen","Tizen","Tizen"),new n("linux","Linux","rv")]),t.buildPlatform=t.runtimePlatformToString(),t.deviceModel=t.getDeviceModel(),t.deviceManufacturer=t.getDeviceManufacturer(),t.osVersion=t.getOSVersionString(),t.browserVersion=t.getBrowserVersionString(),t);e.GADevice=r}(e.device||(e.device={}))}(i=i||{}),function(e){function t(e){this.deadline=e,this.ignore=!1,this.async=!1,this.running=!1,this.id=++t.idCounter}var n,i;n=e.threading||(e.threading={}),t.idCounter=0,i=t,n.TimedBlock=i}(i=i||{}),function(e){function t(e){this.comparer=e,this._subQueues={},this._sortedKeys=[]}var n,i;n=e.threading||(e.threading={}),t.prototype.enqueue=function(e,t){-1===this._sortedKeys.indexOf(e)&&this.addQueueOfPriority(e),this._subQueues[e].push(t)},t.prototype.addQueueOfPriority=function(e){var t=this;this._sortedKeys.push(e),this._sortedKeys.sort(function(e,n){return t.comparer.compare(e,n)}),this._subQueues[e]=[]},t.prototype.peek=function(){if(this.hasItems())return this._subQueues[this._sortedKeys[0]][0];throw new Error("The queue is empty")},t.prototype.hasItems=function(){return 0<this._sortedKeys.length},t.prototype.dequeue=function(){if(this.hasItems())return this.dequeueFromHighPriorityQueue();throw new Error("The queue is empty")},t.prototype.dequeueFromHighPriorityQueue=function(){var e=this._sortedKeys[0],t=this._subQueues[e].shift();return 0===this._subQueues[e].length&&(this._sortedKeys.shift(),delete this._subQueues[e]),t},i=t,n.PriorityQueue=i}(i=i||{}),function(e){function t(){this.eventsStore=[],this.sessionsStore=[],this.progressionStore=[],this.storeItems={};try{"object"==typeof localStorage?(localStorage.setItem("testingLocalStorage","yes"),localStorage.removeItem("testingLocalStorage"),t.storageAvailable=!0):t.storageAvailable=!1}catch(e){}}var n,i,o,a,s=r.logging.GALogger;(i=n=e.EGAStoreArgsOperator||(e.EGAStoreArgsOperator={}))[i.Equal=0]="Equal",i[i.LessOrEqual=1]="LessOrEqual",i[i.NotEqual=2]="NotEqual",(a=o=e.EGAStore||(e.EGAStore={}))[a.Events=0]="Events",a[a.Sessions=1]="Sessions",a[a.Progression=2]="Progression";var c=(t.isStorageAvailable=function(){return t.storageAvailable},t.isStoreTooLargeForEvents=function(){return t.instance.eventsStore.length+t.instance.sessionsStore.length>t.MaxNumberOfEntries},t.select=function(e,i,r,o){void 0===i&&(i=[]),void 0===r&&(r=!1),void 0===o&&(o=0);var a=t.getStore(e);if(!a)return null;for(var s=[],c=0;c<a.length;++c){for(var l=a[c],u=!0,h=0;h<i.length;++h){var d=i[h];if(l[d[0]])switch(d[1]){case n.Equal:u=l[d[0]]==d[2];break;case n.LessOrEqual:u=l[d[0]]<=d[2];break;case n.NotEqual:u=l[d[0]]!=d[2];break;default:u=!1}else u=!1;if(!u)break}u&&s.push(l)}return r&&s.sort(function(e,t){return e.client_ts-t.client_ts}),0<o&&s.length>o&&(s=s.slice(0,o+1)),s},t.update=function(e,i,r){void 0===r&&(r=[]);var o=t.getStore(e);if(!o)return!1;for(var a=0;a<o.length;++a){for(var s=o[a],c=!0,l=0;l<r.length;++l){var u=r[l];if(s[u[0]])switch(u[1]){case n.Equal:c=s[u[0]]==u[2];break;case n.LessOrEqual:c=s[u[0]]<=u[2];break;case n.NotEqual:c=s[u[0]]!=u[2];break;default:c=!1}else c=!1;if(!c)break}if(c)for(l=0;l<i.length;++l){var h=i[l];s[h[0]]=h[1]}}return!0},t.delete=function(e,i){var r=t.getStore(e);if(r)for(var o=0;o<r.length;++o){for(var a=r[o],s=!0,c=0;c<i.length;++c){var l=i[c];if(a[l[0]])switch(l[1]){case n.Equal:s=a[l[0]]==l[2];break;case n.LessOrEqual:s=a[l[0]]<=l[2];break;case n.NotEqual:s=a[l[0]]!=l[2];break;default:s=!1}else s=!1;if(!s)break}s&&(r.splice(o,1),--o)}},t.insert=function(e,n,i,r){void 0===i&&(i=!1),void 0===r&&(r=null);var o=t.getStore(e);if(o)if(i){if(!r)return;for(var a=!1,s=0;s<o.length;++s){var c=o[s];if(c[r]==n[r]){for(var l in n)c[l]=n[l];a=!0;break}}a||o.push(n)}else o.push(n)},t.save=function(e){t.isStorageAvailable()?(localStorage.setItem(t.StringFormat(t.KeyFormat,e,t.EventsStoreKey),JSON.stringify(t.instance.eventsStore)),localStorage.setItem(t.StringFormat(t.KeyFormat,e,t.SessionsStoreKey),JSON.stringify(t.instance.sessionsStore)),localStorage.setItem(t.StringFormat(t.KeyFormat,e,t.ProgressionStoreKey),JSON.stringify(t.instance.progressionStore)),localStorage.setItem(t.StringFormat(t.KeyFormat,e,t.ItemsStoreKey),JSON.stringify(t.instance.storeItems))):s.w("Storage is not available, cannot save.")},t.load=function(e){if(t.isStorageAvailable()){try{t.instance.eventsStore=JSON.parse(localStorage.getItem(t.StringFormat(t.KeyFormat,e,t.EventsStoreKey))),t.instance.eventsStore||(t.instance.eventsStore=[])}catch(e){s.w("Load failed for 'events' store. Using empty store."),t.instance.eventsStore=[]}try{t.instance.sessionsStore=JSON.parse(localStorage.getItem(t.StringFormat(t.KeyFormat,e,t.SessionsStoreKey))),t.instance.sessionsStore||(t.instance.sessionsStore=[])}catch(e){s.w("Load failed for 'sessions' store. Using empty store."),t.instance.sessionsStore=[]}try{t.instance.progressionStore=JSON.parse(localStorage.getItem(t.StringFormat(t.KeyFormat,e,t.ProgressionStoreKey))),t.instance.progressionStore||(t.instance.progressionStore=[])}catch(e){s.w("Load failed for 'progression' store. Using empty store."),t.instance.progressionStore=[]}try{t.instance.storeItems=JSON.parse(localStorage.getItem(t.StringFormat(t.KeyFormat,e,t.ItemsStoreKey))),t.instance.storeItems||(t.instance.storeItems={})}catch(e){
s.w("Load failed for 'items' store. Using empty store."),t.instance.progressionStore=[]}}else s.w("Storage is not available, cannot load.")},t.setItem=function(e,n,i){var r=t.StringFormat(t.KeyFormat,e,n);i?t.instance.storeItems[r]=i:r in t.instance.storeItems&&delete t.instance.storeItems[r]},t.getItem=function(e,n){var i=t.StringFormat(t.KeyFormat,e,n);return i in t.instance.storeItems?t.instance.storeItems[i]:null},t.getStore=function(e){switch(e){case o.Events:return t.instance.eventsStore;case o.Sessions:return t.instance.sessionsStore;case o.Progression:return t.instance.progressionStore;default:return s.w("GAStore.getStore(): Cannot find store: "+e),null}},t.instance=new t,t.MaxNumberOfEntries=2e3,t.StringFormat=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return e.replace(/{(\d+)}/g,function(e,n){return t[n]||""})},t.KeyFormat="GA::{0}::{1}",t.EventsStoreKey="ga_event",t.SessionsStoreKey="ga_session",t.ProgressionStoreKey="ga_progression",t.ItemsStoreKey="ga_items",t);e.GAStore=c}((r=i=i||{}).store||(r.store={})),function(e){function t(){this.availableCustomDimensions01=[],this.availableCustomDimensions02=[],this.availableCustomDimensions03=[],this.availableResourceCurrencies=[],this.availableResourceItemTypes=[],this.configurations={},this.remoteConfigsListeners=[],this.sdkConfigDefault={},this.sdkConfig={},this.progressionTries={},this._isEventSubmissionEnabled=!0}var n,i,r,o,a,s,c,l,u;n=e.state||(e.state={}),i=e.validators.GAValidator,r=e.utilities.GAUtilities,o=e.logging.GALogger,a=e.store.GAStore,s=e.device.GADevice,c=e.store.EGAStore,l=e.store.EGAStoreArgsOperator,t.setUserId=function(e){t.instance.userId=e,t.cacheIdentifier()},t.getIdentifier=function(){return t.instance.identifier},t.isInitialized=function(){return t.instance.initialized},t.setInitialized=function(e){t.instance.initialized=e},t.getSessionStart=function(){return t.instance.sessionStart},t.getSessionNum=function(){return t.instance.sessionNum},t.getTransactionNum=function(){return t.instance.transactionNum},t.getSessionId=function(){return t.instance.sessionId},t.getCurrentCustomDimension01=function(){return t.instance.currentCustomDimension01},t.getCurrentCustomDimension02=function(){return t.instance.currentCustomDimension02},t.getCurrentCustomDimension03=function(){return t.instance.currentCustomDimension03},t.getGameKey=function(){return t.instance.gameKey},t.getGameSecret=function(){return t.instance.gameSecret},t.getAvailableCustomDimensions01=function(){return t.instance.availableCustomDimensions01},t.setAvailableCustomDimensions01=function(e){i.validateCustomDimensions(e)&&(t.instance.availableCustomDimensions01=e,t.validateAndFixCurrentDimensions(),o.i("Set available custom01 dimension values: ("+r.joinStringArray(e,", ")+")"))},t.getAvailableCustomDimensions02=function(){return t.instance.availableCustomDimensions02},t.setAvailableCustomDimensions02=function(e){i.validateCustomDimensions(e)&&(t.instance.availableCustomDimensions02=e,t.validateAndFixCurrentDimensions(),o.i("Set available custom02 dimension values: ("+r.joinStringArray(e,", ")+")"))},t.getAvailableCustomDimensions03=function(){return t.instance.availableCustomDimensions03},t.setAvailableCustomDimensions03=function(e){i.validateCustomDimensions(e)&&(t.instance.availableCustomDimensions03=e,t.validateAndFixCurrentDimensions(),o.i("Set available custom03 dimension values: ("+r.joinStringArray(e,", ")+")"))},t.getAvailableResourceCurrencies=function(){return t.instance.availableResourceCurrencies},t.setAvailableResourceCurrencies=function(e){i.validateResourceCurrencies(e)&&(t.instance.availableResourceCurrencies=e,o.i("Set available resource currencies: ("+r.joinStringArray(e,", ")+")"))},t.getAvailableResourceItemTypes=function(){return t.instance.availableResourceItemTypes},t.setAvailableResourceItemTypes=function(e){i.validateResourceItemTypes(e)&&(t.instance.availableResourceItemTypes=e,o.i("Set available resource item types: ("+r.joinStringArray(e,", ")+")"))},t.getBuild=function(){return t.instance.build},t.setBuild=function(e){t.instance.build=e,o.i("Set build version: "+e)},t.getUseManualSessionHandling=function(){return t.instance.useManualSessionHandling},t.isEventSubmissionEnabled=function(){return t.instance._isEventSubmissionEnabled},t.getABTestingId=function(){return t.instance.abId},t.getABTestingVariantId=function(){return t.instance.abVariantId},t.prototype.setDefaultId=function(e){this.defaultUserId=e||"",t.cacheIdentifier()},t.getDefaultId=function(){return t.instance.defaultUserId},t.getSdkConfig=function(){var e,n=0;for(var i in t.instance.sdkConfig)0===n&&(e=i),++n;if(e&&0<n)return t.instance.sdkConfig;for(var i in n=0,t.instance.sdkConfigCached)0===n&&(e=i),++n;return e&&0<n?t.instance.sdkConfigCached:t.instance.sdkConfigDefault},t.isEnabled=function(){return!!t.instance.initAuthorized},t.setCustomDimension01=function(e){t.instance.currentCustomDimension01=e,a.setItem(t.getGameKey(),t.Dimension01Key,e),o.i("Set custom01 dimension value: "+e)},t.setCustomDimension02=function(e){t.instance.currentCustomDimension02=e,a.setItem(t.getGameKey(),t.Dimension02Key,e),o.i("Set custom02 dimension value: "+e)},t.setCustomDimension03=function(e){t.instance.currentCustomDimension03=e,a.setItem(t.getGameKey(),t.Dimension03Key,e),o.i("Set custom03 dimension value: "+e)},t.incrementSessionNum=function(){var e=t.getSessionNum()+1;t.instance.sessionNum=e},t.incrementTransactionNum=function(){var e=t.getTransactionNum()+1;t.instance.transactionNum=e},t.incrementProgressionTries=function(e){var n=t.getProgressionTries(e)+1;t.instance.progressionTries[e]=n;var i={};i.progression=e,i.tries=n,a.insert(c.Progression,i,!0,"progression")},t.getProgressionTries=function(e){return e in t.instance.progressionTries?t.instance.progressionTries[e]:0},t.clearProgressionTries=function(e){e in t.instance.progressionTries&&delete t.instance.progressionTries[e];var n=[];n.push(["progression",l.Equal,e]),a.delete(c.Progression,n)},t.setKeys=function(e,n){t.instance.gameKey=e,t.instance.gameSecret=n},t.setManualSessionHandling=function(e){t.instance.useManualSessionHandling=e,o.i("Use manual session handling: "+e)},t.setEnabledEventSubmission=function(e){t.instance._isEventSubmissionEnabled=e},t.getEventAnnotations=function(){var e={v:2};e.user_id=t.instance.identifier,e.client_ts=t.getClientTsAdjusted(),e.sdk_version=s.getRelevantSdkVersion(),e.os_version=s.osVersion,e.manufacturer=s.deviceManufacturer,e.device=s.deviceModel,e.browser_version=s.browserVersion,e.platform=s.buildPlatform,e.session_id=t.instance.sessionId,e[t.SessionNumKey]=t.instance.sessionNum;var n=s.getConnectionType();if(i.validateConnectionType(n)&&(e.connection_type=n),s.gameEngineVersion&&(e.engine_version=s.gameEngineVersion),t.instance.configurations){var r=0;for(var o in t.instance.configurations){r++;break}0<r&&(e.configurations=t.instance.configurations)}return t.instance.abId&&(e.ab_id=t.instance.abId),t.instance.abVariantId&&(e.ab_variant_id=t.instance.abVariantId),t.instance.build&&(e.build=t.instance.build),e},t.getSdkErrorEventAnnotations=function(){var e={v:2};e.category=t.CategorySdkError,e.sdk_version=s.getRelevantSdkVersion(),e.os_version=s.osVersion,e.manufacturer=s.deviceManufacturer,e.device=s.deviceModel,e.platform=s.buildPlatform;var n=s.getConnectionType();return i.validateConnectionType(n)&&(e.connection_type=n),s.gameEngineVersion&&(e.engine_version=s.gameEngineVersion),e},t.getInitAnnotations=function(){var e={};return t.getIdentifier()||t.cacheIdentifier(),e.user_id=t.getIdentifier(),e.sdk_version=s.getRelevantSdkVersion(),e.os_version=s.osVersion,e.platform=s.buildPlatform,t.getBuild()?e.build=t.getBuild():e.build=null,e.session_num=t.getSessionNum(),e.random_salt=t.getSessionNum(),e},t.getClientTsAdjusted=function(){var e=r.timeIntervalSince1970(),n=e+t.instance.clientServerTimeOffset;return i.validateClientTs(n)?n:e},t.sessionIsStarted=function(){return 0!=t.instance.sessionStart},t.cacheIdentifier=function(){t.instance.userId?t.instance.identifier=t.instance.userId:t.instance.defaultUserId&&(t.instance.identifier=t.instance.defaultUserId)},t.ensurePersistedStates=function(){a.isStorageAvailable()&&a.load(t.getGameKey());var e=t.instance;e.setDefaultId(null!=a.getItem(t.getGameKey(),t.DefaultUserIdKey)?a.getItem(t.getGameKey(),t.DefaultUserIdKey):r.createGuid()),e.sessionNum=null!=a.getItem(t.getGameKey(),t.SessionNumKey)?Number(a.getItem(t.getGameKey(),t.SessionNumKey)):0,e.transactionNum=null!=a.getItem(t.getGameKey(),t.TransactionNumKey)?Number(a.getItem(t.getGameKey(),t.TransactionNumKey)):0,e.currentCustomDimension01?a.setItem(t.getGameKey(),t.Dimension01Key,e.currentCustomDimension01):(e.currentCustomDimension01=null!=a.getItem(t.getGameKey(),t.Dimension01Key)?a.getItem(t.getGameKey(),t.Dimension01Key):"",e.currentCustomDimension01),e.currentCustomDimension02?a.setItem(t.getGameKey(),t.Dimension02Key,e.currentCustomDimension02):(e.currentCustomDimension02=null!=a.getItem(t.getGameKey(),t.Dimension02Key)?a.getItem(t.getGameKey(),t.Dimension02Key):"",e.currentCustomDimension02),e.currentCustomDimension03?a.setItem(t.getGameKey(),t.Dimension03Key,e.currentCustomDimension03):(e.currentCustomDimension03=null!=a.getItem(t.getGameKey(),t.Dimension03Key)?a.getItem(t.getGameKey(),t.Dimension03Key):"",e.currentCustomDimension03);var n=null!=a.getItem(t.getGameKey(),t.SdkConfigCachedKey)?a.getItem(t.getGameKey(),t.SdkConfigCachedKey):"";if(n){var i=JSON.parse(r.decode64(n));i&&(e.sdkConfigCached=i)}var o=t.getSdkConfig();e.configsHash=o.configs_hash?o.configs_hash:"",e.abId=o.ab_id?o.ab_id:"",e.abVariantId=o.ab_variant_id?o.ab_variant_id:"";var s=a.select(c.Progression);if(s)for(var l=0;l<s.length;++l){var u=s[l];u&&(e.progressionTries[u.progression]=u.tries)}},t.calculateServerTimeOffset=function(e){return e-r.timeIntervalSince1970()},t.validateAndCleanCustomFields=function(e){var n={};if(e){var i=0;for(var a in e){var s=e[a];if(a&&s)if(i<t.MAX_CUSTOM_FIELDS_COUNT){var c=new RegExp("^[a-zA-Z0-9_]{1,"+t.MAX_CUSTOM_FIELDS_KEY_LENGTH+"}$");if(r.stringMatch(a,c)){var l=typeof s;if("string"==l||s instanceof String)s.length<=t.MAX_CUSTOM_FIELDS_VALUE_STRING_LENGTH&&0<s.length?(n[a]=s,++i):o.w("validateAndCleanCustomFields: entry with key="+a+", value="+s+" has been omitted because its value is an empty string or exceeds the max number of characters ("+t.MAX_CUSTOM_FIELDS_VALUE_STRING_LENGTH+")");else if("number"==l||s instanceof Number){var u=s;n[a]=u,++i}else o.w("validateAndCleanCustomFields: entry with key="+a+", value="+s+" has been omitted because its value is not a string or number")}else o.w("validateAndCleanCustomFields: entry with key="+a+", value="+s+" has been omitted because its key contains illegal character, is empty or exceeds the max number of characters ("+t.MAX_CUSTOM_FIELDS_KEY_LENGTH+")")}else o.w("validateAndCleanCustomFields: entry with key="+a+", value="+s+" has been omitted because it exceeds the max number of custom fields ("+t.MAX_CUSTOM_FIELDS_COUNT+")");else o.w("validateAndCleanCustomFields: entry with key="+a+", value="+s+" has been omitted because its key or value is null")}}return n},t.validateAndFixCurrentDimensions=function(){i.validateDimension01(t.getCurrentCustomDimension01(),t.getAvailableCustomDimensions01())||t.setCustomDimension01(""),i.validateDimension02(t.getCurrentCustomDimension02(),t.getAvailableCustomDimensions02())||t.setCustomDimension02(""),i.validateDimension03(t.getCurrentCustomDimension03(),t.getAvailableCustomDimensions03())||t.setCustomDimension03("")},t.getConfigurationStringValue=function(e,n){return t.instance.configurations[e]?t.instance.configurations[e].toString():n},t.isRemoteConfigsReady=function(){return t.instance.remoteConfigsIsReady},t.addRemoteConfigsListener=function(e){t.instance.remoteConfigsListeners.indexOf(e)<0&&t.instance.remoteConfigsListeners.push(e)},t.removeRemoteConfigsListener=function(e){var n=t.instance.remoteConfigsListeners.indexOf(e);-1<n&&t.instance.remoteConfigsListeners.splice(n,1)},t.getRemoteConfigsContentAsString=function(){return JSON.stringify(t.instance.configurations)},t.populateConfigurations=function(e){var n=e.configs;if(n){t.instance.configurations={};for(var i=0;i<n.length;++i){var r=n[i];if(r){var o=r.key,a=r.value,s=r.start_ts?r.start_ts:Number.MIN_VALUE,c=r.end_ts?r.end_ts:Number.MAX_VALUE,l=t.getClientTsAdjusted();o&&a&&s<l&&l<c&&(t.instance.configurations[o]=a)}}}t.instance.remoteConfigsIsReady=!0;var u=t.instance.remoteConfigsListeners;for(i=0;i<u.length;++i)u[i]&&u[i].onRemoteConfigsUpdated()},t.CategorySdkError="sdk_error",t.MAX_CUSTOM_FIELDS_COUNT=50,t.MAX_CUSTOM_FIELDS_KEY_LENGTH=64,t.MAX_CUSTOM_FIELDS_VALUE_STRING_LENGTH=256,t.instance=new t,t.DefaultUserIdKey="default_user_id",t.SessionNumKey="session_num",t.TransactionNumKey="transaction_num",t.Dimension01Key="dimension01",t.Dimension02Key="dimension02",t.Dimension03Key="dimension03",t.SdkConfigCachedKey="sdk_config_cached",u=t,n.GAState=u}(i=i||{}),function(e){function t(){}var n,i,r,o;n=e.tasks||(e.tasks={}),i=e.utilities.GAUtilities,r=e.logging.GALogger,t.execute=function(e,n,o,a){var s=new Date;if(t.timestampMap[n]||(t.timestampMap[n]=s),t.countMap[n]||(t.countMap[n]=0),3600<=(s.getTime()-t.timestampMap[n].getTime())/1e3&&(t.timestampMap[n]=s,t.countMap[n]=0),!(t.countMap[n]>=t.MaxCount)){var c=i.getHmac(a,o),l=new XMLHttpRequest;l.onreadystatechange=function(){if(4===l.readyState){if(!l.responseText)return;if(200!=l.status)return void r.w("sdk error failed. response code not 200. status code: "+l.status+", description: "+l.statusText+", body: "+l.responseText);t.countMap[n]=t.countMap[n]+1}},l.open("POST",e,!0),l.setRequestHeader("Content-Type","application/json"),l.setRequestHeader("Authorization",c);try{l.send(o)}catch(e){console.error(e)}}},t.MaxCount=10,t.countMap={},t.timestampMap={},o=t,n.SdkErrorTask=o}(i=i||{}),function(e){function t(){this.protocol="https",this.hostName="",this.version="v2",this.remoteConfigsVersion="v1",this.baseUrl=this.protocol+"://"+this.hostName+"/"+this.version,this.remoteConfigsBaseUrl=this.protocol+"://"+this.hostName+"/remote_configs/"+this.remoteConfigsVersion,this.initializeUrlPath="init",this.eventsUrlPath="events",this.useGzip=!1}var n,i,r,o,a,s,c,l,u,h,d;n=e.http||(e.http={}),i=e.state.GAState,r=e.logging.GALogger,o=e.utilities.GAUtilities,a=e.validators.GAValidator,s=e.tasks.SdkErrorTask,c=e.events.EGASdkErrorCategory,l=e.events.EGASdkErrorArea,u=e.events.EGASdkErrorAction,h=e.events.EGASdkErrorParameter,t.prototype.requestInit=function(e,r){var o=i.getGameKey(),a=this.remoteConfigsBaseUrl+"/"+this.initializeUrlPath+"?game_key="+o+"&interval_seconds=0&configs_hash="+e,s=i.getInitAnnotations(),c=JSON.stringify(s);if(c){var l=this.createPayloadData(c,this.useGzip),u=[];u.push(c),t.sendRequest(a,l,u,this.useGzip,t.initRequestCallback,r)}else r(n.EGAHTTPApiResponse.JsonEncodeFailed,null)},t.prototype.sendEventsInArray=function(e,r,o){if(0!=e.length){var a=i.getGameKey(),s=this.baseUrl+"/"+a+"/"+this.eventsUrlPath,c=JSON.stringify(e);if(c){var l=this.createPayloadData(c,this.useGzip),u=[];u.push(c),u.push(r),u.push(e.length.toString()),t.sendRequest(s,l,u,this.useGzip,t.sendEventInArrayRequestCallback,o)}else o(n.EGAHTTPApiResponse.JsonEncodeFailed,null,r,e.length)}},t.prototype.sendSdkErrorEvent=function(e,n,o,c,l,u,h){if(i.isEventSubmissionEnabled()&&a.validateSdkErrorEvent(u,h,e,n,o)){var d,p=this.baseUrl+"/"+u+"/"+this.eventsUrlPath,f="",m=i.getSdkErrorEventAnnotations(),g=t.sdkErrorCategoryString(e);f+=m.error_category=g;var v=t.sdkErrorAreaString(n);f+=":"+(m.error_area=v);var y=t.sdkErrorActionString(o);m.error_action=y;var b=t.sdkErrorParameterString(c);if(0<b.length&&(m.error_parameter=b),0<l.length){var w=l;l.length>t.MAX_ERROR_MESSAGE_LENGTH&&(w=l.substring(0,t.MAX_ERROR_MESSAGE_LENGTH)),m.reason=w}var x=[];x.push(m),(d=JSON.stringify(x))?s.execute(p,f,d,h):r.w("sendSdkErrorEvent: JSON encoding failed.")}},t.sendEventInArrayRequestCallback=function(e,r,o,a){void 0===a&&(a=null),a[0],a[1];var s,d,p=a[2],f=parseInt(a[3]);s=e.responseText,d=e.status;var m=t.instance.processRequestResponse(d,e.statusText,s,"Events");if(m==n.EGAHTTPApiResponse.Ok||m==n.EGAHTTPApiResponse.Created||m==n.EGAHTTPApiResponse.BadRequest){var g=s?JSON.parse(s):{};if(null==g)return o(n.EGAHTTPApiResponse.JsonDecodeFailed,null,p,f),void t.instance.sendSdkErrorEvent(c.Http,l.EventsHttp,u.FailHttpJsonDecode,h.Undefined,s,i.getGameKey(),i.getGameSecret());n.EGAHTTPApiResponse.BadRequest,o(m,g,p,f)}else o(m,null,p,f)},t.sendRequest=function(e,t,n,r,a,s){var c=new XMLHttpRequest,l=i.getGameSecret(),u=o.getHmac(l,t),h=[];for(var d in h.push(u),n)h.push(n[d]);if(c.onreadystatechange=function(){4===c.readyState&&a(c,e,s,h)},c.open("POST",e,!0),c.setRequestHeader("Content-Type","application/json"),c.setRequestHeader("Authorization",u),r)throw new Error("gzip not supported");try{c.send(t)}catch(e){console.error(e.stack)}},t.initRequestCallback=function(e,r,o,s){var d,p;void 0===s&&(s=null),s[0],s[1],d=e.responseText,p=e.status;var f=d?JSON.parse(d):{},m=t.instance.processRequestResponse(p,e.statusText,d,"Init");if(m==n.EGAHTTPApiResponse.Ok||m==n.EGAHTTPApiResponse.Created||m==n.EGAHTTPApiResponse.BadRequest){if(null==f)return o(n.EGAHTTPApiResponse.JsonDecodeFailed,null,"",0),void t.instance.sendSdkErrorEvent(c.Http,l.InitHttp,u.FailHttpJsonDecode,h.Undefined,d,i.getGameKey(),i.getGameSecret());if(m!==n.EGAHTTPApiResponse.BadRequest){var g=a.validateAndCleanInitRequestResponse(f,m===n.EGAHTTPApiResponse.Created);g?o(m,g,"",0):o(n.EGAHTTPApiResponse.BadResponse,null,"",0)}else o(m,null,"",0)}else o(m,null,"",0)},t.prototype.createPayloadData=function(e,t){if(t)throw new Error("gzip not supported");return e},t.prototype.processRequestResponse=function(e,t,i,r){return i?200===e?n.EGAHTTPApiResponse.Ok:201===e?n.EGAHTTPApiResponse.Created:0===e||401===e?n.EGAHTTPApiResponse.Unauthorized:400===e?n.EGAHTTPApiResponse.BadRequest:500===e?n.EGAHTTPApiResponse.InternalServerError:n.EGAHTTPApiResponse.UnknownResponseCode:n.EGAHTTPApiResponse.NoResponse},t.sdkErrorCategoryString=function(e){switch(e){case c.EventValidation:return"event_validation";case c.Database:return"db";case c.Init:return"init";case c.Http:return"http";case c.Json:return"json"}return""},t.sdkErrorAreaString=function(e){switch(e){case l.BusinessEvent:return"business";case l.ResourceEvent:return"resource";case l.ProgressionEvent:return"progression";case l.DesignEvent:return"design";case l.ErrorEvent:return"error";case l.InitHttp:return"init_http";case l.EventsHttp:return"events_http";case l.ProcessEvents:return"process_events";case l.AddEventsToStore:return"add_events_to_store"}return""},t.sdkErrorActionString=function(e){switch(e){case u.InvalidCurrency:return"invalid_currency";case u.InvalidShortString:return"invalid_short_string";case u.InvalidEventPartLength:return"invalid_event_part_length";case u.InvalidEventPartCharacters:return"invalid_event_part_characters";case u.InvalidStore:return"invalid_store";case u.InvalidFlowType:return"invalid_flow_type";case u.StringEmptyOrNull:return"string_empty_or_null";case u.NotFoundInAvailableCurrencies:return"not_found_in_available_currencies";case u.InvalidAmount:return"invalid_amount";case u.NotFoundInAvailableItemTypes:return"not_found_in_available_item_types";case u.WrongProgressionOrder:return"wrong_progression_order";case u.InvalidEventIdLength:return"invalid_event_id_length";case u.InvalidEventIdCharacters:return"invalid_event_id_characters";case u.InvalidProgressionStatus:return"invalid_progression_status";case u.InvalidSeverity:return"invalid_severity";case u.InvalidLongString:return"invalid_long_string";case u.DatabaseTooLarge:return"db_too_large";case u.DatabaseOpenOrCreate:return"db_open_or_create";case u.JsonError:return"json_error";case u.FailHttpJsonDecode:return"fail_http_json_decode";case u.FailHttpJsonEncode:return"fail_http_json_encode"}return""},t.sdkErrorParameterString=function(e){switch(e){case h.Currency:return"currency";case h.CartType:return"cart_type";case h.ItemType:return"item_type";case h.ItemId:return"item_id";case h.Store:return"store";case h.FlowType:return"flow_type";case h.Amount:return"amount";case h.Progression01:return"progression01";case h.Progression02:return"progression02";case h.Progression03:return"progression03";case h.EventId:return"event_id";case h.ProgressionStatus:return"progression_status";case h.Severity:return"severity";case h.Message:return"message"}return""},t.instance=new t,t.MAX_ERROR_MESSAGE_LENGTH=256,d=t,n.GAHTTPApi=d}(i=i||{}),function(e){function t(){}var n,i,r,o,a,s,c,l,u,h,d;n=e.events||(e.events={}),i=e.store.GAStore,r=e.store.EGAStore,o=e.store.EGAStoreArgsOperator,a=e.state.GAState,s=e.logging.GALogger,c=e.utilities.GAUtilities,l=e.http.EGAHTTPApiResponse,u=e.http.GAHTTPApi,h=e.validators.GAValidator,t.addSessionStartEvent=function(){if(a.isEventSubmissionEnabled()){var e={};e.category=t.CategorySessionStart,a.incrementSessionNum(),i.setItem(a.getGameKey(),a.SessionNumKey,a.getSessionNum().toString()),t.addDimensionsToEvent(e),t.addEventToStore(e),s.i("Add SESSION START event"),t.processEvents(t.CategorySessionStart,!1)}},t.addSessionEndEvent=function(){if(a.isEventSubmissionEnabled()){var e=a.getSessionStart(),n=a.getClientTsAdjusted()-e;n<0&&(s.w("Session length was calculated to be less then 0. Should not be possible. Resetting to 0."),n=0);var i={};i.category=t.CategorySessionEnd,i.length=n,t.addDimensionsToEvent(i),t.addEventToStore(i),s.i("Add SESSION END event."),t.processEvents("",!1)}},t.addBusinessEvent=function(e,n,r,o,c,l){if(void 0===c&&(c=null),a.isEventSubmissionEnabled()){var d=h.validateBusinessEvent(e,n,c,r,o);if(null==d){var p={};a.incrementTransactionNum(),i.setItem(a.getGameKey(),a.TransactionNumKey,a.getTransactionNum().toString()),p.event_id=r+":"+o,p.category=t.CategoryBusiness,p.currency=e,p.amount=n,p[a.TransactionNumKey]=a.getTransactionNum(),c&&(p.cart_type=c),t.addDimensionsToEvent(p),t.addFieldsToEvent(p,a.validateAndCleanCustomFields(l)),s.i("Add BUSINESS event: {currency:"+e+", amount:"+n+", itemType:"+r+", itemId:"+o+", cartType:"+c+"}"),t.addEventToStore(p)}else u.instance.sendSdkErrorEvent(d.category,d.area,d.action,d.parameter,d.reason,a.getGameKey(),a.getGameSecret())}},t.addResourceEvent=function(n,i,r,o,c,l){if(a.isEventSubmissionEnabled()){var d=h.validateResourceEvent(n,i,r,o,c,a.getAvailableResourceCurrencies(),a.getAvailableResourceItemTypes());if(null==d){n===e.EGAResourceFlowType.Sink&&(r*=-1);var p={},f=t.resourceFlowTypeToString(n);p.event_id=f+":"+i+":"+o+":"+c,p.category=t.CategoryResource,p.amount=r,t.addDimensionsToEvent(p),t.addFieldsToEvent(p,a.validateAndCleanCustomFields(l)),s.i("Add RESOURCE event: {currency:"+i+", amount:"+r+", itemType:"+o+", itemId:"+c+"}"),t.addEventToStore(p)}else u.instance.sendSdkErrorEvent(d.category,d.area,d.action,d.parameter,d.reason,a.getGameKey(),a.getGameSecret())}},t.addProgressionEvent=function(n,i,r,o,c,l,d){if(a.isEventSubmissionEnabled()){var p=t.progressionStatusToString(n),f=h.validateProgressionEvent(n,i,r,o);if(null==f){var m,g={};m=r?o?i+":"+r+":"+o:i+":"+r:i,g.category=t.CategoryProgression,g.event_id=p+":"+m;var v=0;l&&n!=e.EGAProgressionStatus.Start&&(g.score=c),n===e.EGAProgressionStatus.Fail&&a.incrementProgressionTries(m),n===e.EGAProgressionStatus.Complete&&(a.incrementProgressionTries(m),v=a.getProgressionTries(m),g.attempt_num=v,a.clearProgressionTries(m)),t.addDimensionsToEvent(g),t.addFieldsToEvent(g,a.validateAndCleanCustomFields(d)),s.i("Add PROGRESSION event: {status:"+p+", progression01:"+i+", progression02:"+r+", progression03:"+o+", score:"+c+", attempt:"+v+"}"),t.addEventToStore(g)}else u.instance.sendSdkErrorEvent(f.category,f.area,f.action,f.parameter,f.reason,a.getGameKey(),a.getGameSecret())}},t.addDesignEvent=function(e,n,i,r){if(a.isEventSubmissionEnabled()){var o=h.validateDesignEvent(e);if(null==o){var c={};c.category=t.CategoryDesign,c.event_id=e,i&&(c.value=n),t.addDimensionsToEvent(c),t.addFieldsToEvent(c,a.validateAndCleanCustomFields(r)),s.i("Add DESIGN event: {eventId:"+e+", value:"+n+"}"),t.addEventToStore(c)}else u.instance.sendSdkErrorEvent(o.category,o.area,o.action,o.parameter,o.reason,a.getGameKey(),a.getGameSecret())}},t.addErrorEvent=function(e,n,i){if(a.isEventSubmissionEnabled()){var r=t.errorSeverityToString(e),o=h.validateErrorEvent(e,n);if(null==o){var c={};c.category=t.CategoryError,c.severity=r,c.message=n,t.addDimensionsToEvent(c),t.addFieldsToEvent(c,a.validateAndCleanCustomFields(i)),s.i("Add ERROR event: {severity:"+r+", message:"+n+"}"),t.addEventToStore(c)}else u.instance.sendSdkErrorEvent(o.category,o.area,o.action,o.parameter,o.reason,a.getGameKey(),a.getGameSecret())}},t.processEvents=function(e,l){if(a.isEventSubmissionEnabled())try{var h=c.createGuid();l&&(t.cleanupEvents(),t.fixMissingSessionEndEvents());var d=[];d.push(["status",o.Equal,"new"]);var p=[];p.push(["status",o.Equal,"new"]),e&&(d.push(["category",o.Equal,e]),p.push(["category",o.Equal,e]));var f=[];f.push(["status",h]);var m=i.select(r.Events,d);if(!m||0==m.length)return s.i("Event queue: No events to send"),void t.updateSessionStore();if(m.length>t.MaxEventCount){if(!(m=i.select(r.Events,d,!0,t.MaxEventCount)))return;var g=m[m.length-1].client_ts;if(d.push(["client_ts",o.LessOrEqual,g]),!(m=i.select(r.Events,d)))return;p.push(["client_ts",o.LessOrEqual,g])}if(s.i("Event queue: Sending "+m.length+" events."),!i.update(r.Events,f,p))return;for(var v=[],y=0;y<m.length;++y){var b=m[y],w=JSON.parse(c.decode64(b.event));0!=w.length&&v.push(w)}u.instance.sendEventsInArray(v,h,t.processEventsCallback)}catch(e){s.e("Error during ProcessEvents(): "+e.stack),u.instance.sendSdkErrorEvent(n.EGASdkErrorCategory.Json,n.EGASdkErrorArea.ProcessEvents,n.EGASdkErrorAction.JsonError,n.EGASdkErrorParameter.Undefined,e.stack,a.getGameKey(),a.getGameSecret())}},t.processEventsCallback=function(e,t,n,a){var c=[];if(c.push(["status",o.Equal,n]),e===l.Ok)i.delete(r.Events,c),s.i("Event queue: "+a+" events sent.");else if(e===l.NoResponse){var u=[];u.push(["status","new"]),s.w("Event queue: Failed to send events to collector - Retrying next time"),i.update(r.Events,u,c)}else{if(t){var h,d=0;for(var p in t)0==d&&(h=t[p]),++d;e===l.BadRequest&&h.constructor===Array?s.w("Event queue: "+a+" events sent. "+d+" events failed GA server validation."):s.w("Event queue: Failed to send events.")}else s.w("Event queue: Failed to send events.");i.delete(r.Events,c)}},t.cleanupEvents=function(){i.update(r.Events,[["status","new"]])},t.fixMissingSessionEndEvents=function(){if(a.isEventSubmissionEnabled()){var e=[];e.push(["session_id",o.NotEqual,a.getSessionId()]);var n=i.select(r.Sessions,e);if(n&&0!=n.length){s.i(n.length+" session(s) located with missing session_end event.");for(var l=0;l<n.length;++l){var u=JSON.parse(c.decode64(n[l].event)),h=u.client_ts-n[l].timestamp;h=Math.max(0,h),u.category=t.CategorySessionEnd,u.length=h,t.addEventToStore(u)}}}},t.addEventToStore=function(e){if(a.isEventSubmissionEnabled())if(a.isInitialized())try{if(i.isStoreTooLargeForEvents()&&!c.stringMatch(e.category,/^(user|session_end|business)$/))return s.w("Database too large. Event has been blocked."),void u.instance.sendSdkErrorEvent(n.EGASdkErrorCategory.Database,n.EGASdkErrorArea.AddEventsToStore,n.EGASdkErrorAction.DatabaseTooLarge,n.EGASdkErrorParameter.Undefined,"",a.getGameKey(),a.getGameSecret());var l=a.getEventAnnotations(),h=c.encode64(JSON.stringify(l));for(var d in e)l[d]=e[d];var p=JSON.stringify(l);s.ii("Event added to queue: "+p);var f={status:"new"};f.category=l.category,f.session_id=l.session_id,f.client_ts=l.client_ts,f.event=c.encode64(JSON.stringify(l)),i.insert(r.Events,f),e.category==t.CategorySessionEnd?i.delete(r.Sessions,[["session_id",o.Equal,l.session_id]]):((f={}).session_id=l.session_id,f.timestamp=a.getSessionStart(),f.event=h,i.insert(r.Sessions,f,!0,"session_id")),i.isStorageAvailable()&&i.save(a.getGameKey())}catch(d){s.e("addEventToStore: error"),s.e(d.stack),u.instance.sendSdkErrorEvent(n.EGASdkErrorCategory.Database,n.EGASdkErrorArea.AddEventsToStore,n.EGASdkErrorAction.DatabaseTooLarge,n.EGASdkErrorParameter.Undefined,d.stack,a.getGameKey(),a.getGameSecret())}else s.w("Could not add event: SDK is not initialized")},t.updateSessionStore=function(){if(a.sessionIsStarted()){var e={};e.session_id=a.instance.sessionId,e.timestamp=a.getSessionStart(),e.event=c.encode64(JSON.stringify(a.getEventAnnotations())),i.insert(r.Sessions,e,!0,"session_id"),i.isStorageAvailable()&&i.save(a.getGameKey())}},t.addDimensionsToEvent=function(e){e&&(a.getCurrentCustomDimension01()&&(e.custom_01=a.getCurrentCustomDimension01()),a.getCurrentCustomDimension02()&&(e.custom_02=a.getCurrentCustomDimension02()),a.getCurrentCustomDimension03()&&(e.custom_03=a.getCurrentCustomDimension03()))},t.addFieldsToEvent=function(e,t){e&&t&&0<Object.keys(t).length&&(e.custom_fields=t)},t.resourceFlowTypeToString=function(t){return t==e.EGAResourceFlowType.Source||t==e.EGAResourceFlowType[e.EGAResourceFlowType.Source]?"Source":t==e.EGAResourceFlowType.Sink||t==e.EGAResourceFlowType[e.EGAResourceFlowType.Sink]?"Sink":""},t.progressionStatusToString=function(t){return t==e.EGAProgressionStatus.Start||t==e.EGAProgressionStatus[e.EGAProgressionStatus.Start]?"Start":t==e.EGAProgressionStatus.Complete||t==e.EGAProgressionStatus[e.EGAProgressionStatus.Complete]?"Complete":t==e.EGAProgressionStatus.Fail||t==e.EGAProgressionStatus[e.EGAProgressionStatus.Fail]?"Fail":""},t.errorSeverityToString=function(t){return t==e.EGAErrorSeverity.Debug||t==e.EGAErrorSeverity[e.EGAErrorSeverity.Debug]?"debug":t==e.EGAErrorSeverity.Info||t==e.EGAErrorSeverity[e.EGAErrorSeverity.Info]?"info":t==e.EGAErrorSeverity.Warning||t==e.EGAErrorSeverity[e.EGAErrorSeverity.Warning]?"warning":t==e.EGAErrorSeverity.Error||t==e.EGAErrorSeverity[e.EGAErrorSeverity.Error]?"error":t==e.EGAErrorSeverity.Critical||t==e.EGAErrorSeverity[e.EGAErrorSeverity.Critical]?"critical":""},t.CategorySessionStart="user",t.CategorySessionEnd="session_end",t.CategoryDesign="design",t.CategoryBusiness="business",t.CategoryProgression="progression",t.CategoryResource="resource",t.CategoryError="error",t.MaxEventCount=500,d=t,n.GAEvents=d}(i=i||{}),function(e){function t(){this.blocks=new n.PriorityQueue({compare:function(e,t){return e-t}}),this.id2TimedBlockMap={},t.startThread()}var n,i,r,o,a;n=e.threading||(e.threading={}),i=e.logging.GALogger,r=e.state.GAState,o=e.events.GAEvents,t.createTimedBlock=function(e){void 0===e&&(e=0);var t=new Date;return t.setSeconds(t.getSeconds()+e),new n.TimedBlock(t)},t.performTaskOnGAThread=function(e,i){void 0===i&&(i=0);var r=new Date;r.setSeconds(r.getSeconds()+i);var o=new n.TimedBlock(r);o.block=e,t.instance.id2TimedBlockMap[o.id]=o,t.instance.addTimedBlock(o)},t.performTimedBlockOnGAThread=function(e){t.instance.id2TimedBlockMap[e.id]=e,t.instance.addTimedBlock(e)},t.scheduleTimer=function(e,i){var r=new Date;r.setSeconds(r.getSeconds()+e);var o=new n.TimedBlock(r);return o.block=i,t.instance.id2TimedBlockMap[o.id]=o,t.instance.addTimedBlock(o),o.id},t.getTimedBlockById=function(e){return e in t.instance.id2TimedBlockMap?t.instance.id2TimedBlockMap[e]:null},t.ensureEventQueueIsRunning=function(){t.instance.keepRunning=!0,t.instance.isRunning||(t.instance.isRunning=!0,t.scheduleTimer(t.ProcessEventsIntervalInSeconds,t.processEventQueue))},t.endSessionAndStopQueue=function(){r.isInitialized()&&(i.i("Ending session."),t.stopEventQueue(),r.isEnabled()&&r.sessionIsStarted()&&(o.addSessionEndEvent(),r.instance.sessionStart=0))},t.stopEventQueue=function(){t.instance.keepRunning=!1},t.ignoreTimer=function(e){e in t.instance.id2TimedBlockMap&&(t.instance.id2TimedBlockMap[e].ignore=!0)},t.setEventProcessInterval=function(e){0<e&&(t.ProcessEventsIntervalInSeconds=e)},t.prototype.addTimedBlock=function(e){this.blocks.enqueue(e.deadline.getTime(),e)},
t.run=function(){clearTimeout(t.runTimeoutId);try{for(var e;e=t.getNextBlock();)if(!e.ignore)if(e.async){if(!e.running){e.running=!0,e.block();break}}else e.block();return void(t.runTimeoutId=setTimeout(t.run,t.ThreadWaitTimeInMs))}catch(e){i.e("Error on GA thread"),i.e(e.stack)}},t.startThread=function(){t.runTimeoutId=setTimeout(t.run,0)},t.getNextBlock=function(){var e=new Date;return t.instance.blocks.hasItems()&&t.instance.blocks.peek().deadline.getTime()<=e.getTime()?t.instance.blocks.peek().async&&t.instance.blocks.peek().running?t.instance.blocks.peek():t.instance.blocks.dequeue():null},t.processEventQueue=function(){o.processEvents("",!0),t.instance.keepRunning?t.scheduleTimer(t.ProcessEventsIntervalInSeconds,t.processEventQueue):t.instance.isRunning=!1},t.instance=new t,t.ThreadWaitTimeInMs=1e3,t.ProcessEventsIntervalInSeconds=8,a=t,n.GAThreading=a}(i=i||{}),function(e){function t(){}var n=e.threading.GAThreading,i=e.logging.GALogger,r=e.store.GAStore,o=e.state.GAState,a=e.http.GAHTTPApi,s=e.device.GADevice,c=e.validators.GAValidator,l=e.http.EGAHTTPApiResponse,u=e.utilities.GAUtilities,h=e.events.GAEvents,d=(t.init=function(){if(s.touch(),t.methodMap.configureAvailableCustomDimensions01=t.configureAvailableCustomDimensions01,t.methodMap.configureAvailableCustomDimensions02=t.configureAvailableCustomDimensions02,t.methodMap.configureAvailableCustomDimensions03=t.configureAvailableCustomDimensions03,t.methodMap.configureAvailableResourceCurrencies=t.configureAvailableResourceCurrencies,t.methodMap.configureAvailableResourceItemTypes=t.configureAvailableResourceItemTypes,t.methodMap.configureBuild=t.configureBuild,t.methodMap.configureSdkGameEngineVersion=t.configureSdkGameEngineVersion,t.methodMap.configureGameEngineVersion=t.configureGameEngineVersion,t.methodMap.configureUserId=t.configureUserId,t.methodMap.initialize=t.initialize,t.methodMap.addBusinessEvent=t.addBusinessEvent,t.methodMap.addResourceEvent=t.addResourceEvent,t.methodMap.addProgressionEvent=t.addProgressionEvent,t.methodMap.addDesignEvent=t.addDesignEvent,t.methodMap.addErrorEvent=t.addErrorEvent,t.methodMap.addErrorEvent=t.addErrorEvent,t.methodMap.setEnabledInfoLog=t.setEnabledInfoLog,t.methodMap.setEnabledVerboseLog=t.setEnabledVerboseLog,t.methodMap.setEnabledManualSessionHandling=t.setEnabledManualSessionHandling,t.methodMap.setEnabledEventSubmission=t.setEnabledEventSubmission,t.methodMap.setCustomDimension01=t.setCustomDimension01,t.methodMap.setCustomDimension02=t.setCustomDimension02,t.methodMap.setCustomDimension03=t.setCustomDimension03,t.methodMap.setEventProcessInterval=t.setEventProcessInterval,t.methodMap.startSession=t.startSession,t.methodMap.endSession=t.endSession,t.methodMap.onStop=t.onStop,t.methodMap.onResume=t.onResume,t.methodMap.addRemoteConfigsListener=t.addRemoteConfigsListener,t.methodMap.removeRemoteConfigsListener=t.removeRemoteConfigsListener,t.methodMap.getRemoteConfigsValueAsString=t.getRemoteConfigsValueAsString,t.methodMap.isRemoteConfigsReady=t.isRemoteConfigsReady,t.methodMap.getRemoteConfigsContentAsString=t.getRemoteConfigsContentAsString,"undefined"!=typeof window&&void 0!==window.GameAnalytics&&void 0!==window.GameAnalytics.q){var e=window.GameAnalytics.q;for(var i in e)t.gaCommand.apply(null,e[i])}window.addEventListener("beforeunload",function(){console.log("addEventListener unload"),n.endSessionAndStopQueue()})},t.gaCommand=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];0<t.length&&t[0]in e.GameAnalytics.methodMap&&(1<t.length?e.GameAnalytics.methodMap[t[0]].apply(null,Array.prototype.slice.call(t,1)):e.GameAnalytics.methodMap[t[0]]())},t.configureAvailableCustomDimensions01=function(e){void 0===e&&(e=[]),n.performTaskOnGAThread(function(){t.isSdkReady(!0,!1)?i.w("Available custom dimensions must be set before SDK is initialized"):o.setAvailableCustomDimensions01(e)})},t.configureAvailableCustomDimensions02=function(e){void 0===e&&(e=[]),n.performTaskOnGAThread(function(){t.isSdkReady(!0,!1)?i.w("Available custom dimensions must be set before SDK is initialized"):o.setAvailableCustomDimensions02(e)})},t.configureAvailableCustomDimensions03=function(e){void 0===e&&(e=[]),n.performTaskOnGAThread(function(){t.isSdkReady(!0,!1)?i.w("Available custom dimensions must be set before SDK is initialized"):o.setAvailableCustomDimensions03(e)})},t.configureAvailableResourceCurrencies=function(e){void 0===e&&(e=[]),n.performTaskOnGAThread(function(){t.isSdkReady(!0,!1)?i.w("Available resource currencies must be set before SDK is initialized"):o.setAvailableResourceCurrencies(e)})},t.configureAvailableResourceItemTypes=function(e){void 0===e&&(e=[]),n.performTaskOnGAThread(function(){t.isSdkReady(!0,!1)?i.w("Available resource item types must be set before SDK is initialized"):o.setAvailableResourceItemTypes(e)})},t.configureBuild=function(e){void 0===e&&(e=""),n.performTaskOnGAThread(function(){t.isSdkReady(!0,!1)?i.w("Build version must be set before SDK is initialized."):c.validateBuild(e)?o.setBuild(e):i.i("Validation fail - configure build: Cannot be null, empty or above 32 length. String: "+e)})},t.configureSdkGameEngineVersion=function(e){void 0===e&&(e=""),n.performTaskOnGAThread(function(){t.isSdkReady(!0,!1)||(c.validateSdkWrapperVersion(e)?s.sdkGameEngineVersion=e:i.i("Validation fail - configure sdk version: Sdk version not supported. String: "+e))})},t.configureGameEngineVersion=function(e){void 0===e&&(e=""),n.performTaskOnGAThread(function(){t.isSdkReady(!0,!1)||(c.validateEngineVersion(e)?s.gameEngineVersion=e:i.i("Validation fail - configure game engine version: Game engine version not supported. String: "+e))})},t.configureUserId=function(e){void 0===e&&(e=""),n.performTaskOnGAThread(function(){t.isSdkReady(!0,!1)?i.w("A custom user id must be set before SDK is initialized."):c.validateUserId(e)?o.setUserId(e):i.i("Validation fail - configure user_id: Cannot be null, empty or above 64 length. Will use default user_id method. Used string: "+e)})},t.initialize=function(e,r){void 0===e&&(e=""),void 0===r&&(r=""),s.updateConnectionType();var a=n.createTimedBlock();a.async=!0,t.initTimedBlockId=a.id,a.block=function(){t.isSdkReady(!0,!1)?i.w("SDK already initialized. Can only be called once."):c.validateKeys(e,r)?(o.setKeys(e,r),t.internalInitialize()):i.w("SDK failed initialize. Game key or secret key is invalid. Can only contain characters A-z 0-9, gameKey is 32 length, gameSecret is 40 length. Failed keys - gameKey: "+e+", secretKey: "+r)},n.performTimedBlockOnGAThread(a)},t.addBusinessEvent=function(e,i,r,o,a){void 0===e&&(e=""),void 0===i&&(i=0),void 0===r&&(r=""),void 0===o&&(o=""),void 0===a&&(a=""),s.updateConnectionType(),n.performTaskOnGAThread(function(){t.isSdkReady(!0,!0,"Could not add business event")&&h.addBusinessEvent(e,i,r,o,a,{})})},t.addResourceEvent=function(i,r,o,a,c){void 0===i&&(i=e.EGAResourceFlowType.Undefined),void 0===r&&(r=""),void 0===o&&(o=0),void 0===a&&(a=""),void 0===c&&(c=""),s.updateConnectionType(),n.performTaskOnGAThread(function(){t.isSdkReady(!0,!0,"Could not add resource event")&&h.addResourceEvent(i,r,o,a,c,{})})},t.addProgressionEvent=function(i,r,o,a,c){void 0===i&&(i=e.EGAProgressionStatus.Undefined),void 0===r&&(r=""),void 0===o&&(o=""),void 0===a&&(a=""),s.updateConnectionType(),n.performTaskOnGAThread(function(){if(t.isSdkReady(!0,!0,"Could not add progression event")){var e="number"==typeof c;h.addProgressionEvent(i,r,o,a,e?c:0,e,{})}})},t.addDesignEvent=function(e,i){s.updateConnectionType(),n.performTaskOnGAThread(function(){if(t.isSdkReady(!0,!0,"Could not add design event")){var n="number"==typeof i;h.addDesignEvent(e,n?i:0,n,{})}})},t.addErrorEvent=function(i,r){void 0===i&&(i=e.EGAErrorSeverity.Undefined),void 0===r&&(r=""),s.updateConnectionType(),n.performTaskOnGAThread(function(){t.isSdkReady(!0,!0,"Could not add error event")&&h.addErrorEvent(i,r,{})})},t.setEnabledInfoLog=function(e){void 0===e&&(e=!1),n.performTaskOnGAThread(function(){e?(i.setInfoLog(e),i.i("Info logging enabled")):(i.i("Info logging disabled"),i.setInfoLog(e))})},t.setEnabledVerboseLog=function(e){void 0===e&&(e=!1),n.performTaskOnGAThread(function(){e?(i.setVerboseLog(e),i.i("Verbose logging enabled")):(i.i("Verbose logging disabled"),i.setVerboseLog(e))})},t.setEnabledManualSessionHandling=function(e){void 0===e&&(e=!1),n.performTaskOnGAThread(function(){o.setManualSessionHandling(e)})},t.setEnabledEventSubmission=function(e){void 0===e&&(e=!1),n.performTaskOnGAThread(function(){e?(o.setEnabledEventSubmission(e),i.i("Event submission enabled")):(i.i("Event submission disabled"),o.setEnabledEventSubmission(e))})},t.setCustomDimension01=function(e){void 0===e&&(e=""),n.performTaskOnGAThread(function(){c.validateDimension01(e,o.getAvailableCustomDimensions01())?o.setCustomDimension01(e):i.w("Could not set custom01 dimension value to '"+e+"'. Value not found in available custom01 dimension values")})},t.setCustomDimension02=function(e){void 0===e&&(e=""),n.performTaskOnGAThread(function(){c.validateDimension02(e,o.getAvailableCustomDimensions02())?o.setCustomDimension02(e):i.w("Could not set custom02 dimension value to '"+e+"'. Value not found in available custom02 dimension values")})},t.setCustomDimension03=function(e){void 0===e&&(e=""),n.performTaskOnGAThread(function(){c.validateDimension03(e,o.getAvailableCustomDimensions03())?o.setCustomDimension03(e):i.w("Could not set custom03 dimension value to '"+e+"'. Value not found in available custom03 dimension values")})},t.setEventProcessInterval=function(e){n.performTaskOnGAThread(function(){n.setEventProcessInterval(e)})},t.startSession=function(){if(o.isInitialized()){var e=n.createTimedBlock();e.async=!0,t.initTimedBlockId=e.id,e.block=function(){o.isEnabled()&&o.sessionIsStarted()&&n.endSessionAndStopQueue(),t.resumeSessionAndStartQueue()},n.performTimedBlockOnGAThread(e)}},t.endSession=function(){t.onStop()},t.onStop=function(){n.performTaskOnGAThread(function(){try{n.endSessionAndStopQueue()}catch(e){}})},t.onResume=function(){var e=n.createTimedBlock();e.async=!0,t.initTimedBlockId=e.id,e.block=function(){t.resumeSessionAndStartQueue()},n.performTimedBlockOnGAThread(e)},t.getRemoteConfigsValueAsString=function(e,t){return void 0===t&&(t=null),o.getConfigurationStringValue(e,t)},t.isRemoteConfigsReady=function(){return o.isRemoteConfigsReady()},t.addRemoteConfigsListener=function(e){o.addRemoteConfigsListener(e)},t.removeRemoteConfigsListener=function(e){o.removeRemoteConfigsListener(e)},t.getRemoteConfigsContentAsString=function(){return o.getRemoteConfigsContentAsString()},t.getABTestingId=function(){return o.getABTestingId()},t.getABTestingVariantId=function(){return o.getABTestingVariantId()},t.internalInitialize=function(){o.ensurePersistedStates(),r.setItem(o.getGameKey(),o.DefaultUserIdKey,o.getDefaultId()),o.setInitialized(!0),t.newSession(),o.isEnabled()&&n.ensureEventQueueIsRunning()},t.newSession=function(){i.i("Starting a new session."),o.validateAndFixCurrentDimensions(),a.instance.requestInit(o.instance.configsHash,t.startNewSessionCallback)},t.startNewSessionCallback=function(e,a){if(e!==l.Ok&&e!==l.Created||!a)e==l.Unauthorized?(i.w("Initialize SDK failed - Unauthorized"),o.instance.initAuthorized=!1):(e===l.NoResponse||e===l.RequestTimeout?i.i("Init call (session start) failed - no response. Could be offline or timeout."):e===l.BadResponse||e===l.JsonEncodeFailed||e===l.JsonDecodeFailed?i.i("Init call (session start) failed - bad response. Could be bad response from proxy or GA servers."):e!==l.BadRequest&&e!==l.UnknownResponseCode||i.i("Init call (session start) failed - bad request or unknown response."),null==o.instance.sdkConfig?null!=o.instance.sdkConfigCached?(i.i("Init call (session start) failed - using cached init values."),o.instance.sdkConfig=o.instance.sdkConfigCached):(i.i("Init call (session start) failed - using default init values."),o.instance.sdkConfig=o.instance.sdkConfigDefault):i.i("Init call (session start) failed - using cached init values."),o.instance.initAuthorized=!0);else{var s=0;if(a.server_ts){var c=a.server_ts;s=o.calculateServerTimeOffset(c)}if(a.time_offset=s,e!=l.Created){var d=o.getSdkConfig();d.configs&&(a.configs=d.configs),d.configs_hash&&(a.configs_hash=d.configs_hash),d.ab_id&&(a.ab_id=d.ab_id),d.ab_variant_id&&(a.ab_variant_id=d.ab_variant_id)}o.instance.configsHash=a.configs_hash?a.configs_hash:"",o.instance.abId=a.ab_id?a.ab_id:"",o.instance.abVariantId=a.ab_variant_id?a.ab_variant_id:"",r.setItem(o.getGameKey(),o.SdkConfigCachedKey,u.encode64(JSON.stringify(a))),o.instance.sdkConfigCached=a,o.instance.sdkConfig=a,o.instance.initAuthorized=!0}if(o.instance.clientServerTimeOffset=o.getSdkConfig().time_offset?o.getSdkConfig().time_offset:0,o.populateConfigurations(o.getSdkConfig()),!o.isEnabled())return i.w("Could not start session: SDK is disabled."),void n.stopEventQueue();n.ensureEventQueueIsRunning();var p=u.createGuid();o.instance.sessionId=p,o.instance.sessionStart=o.getClientTsAdjusted(),h.addSessionStartEvent();var f=n.getTimedBlockById(t.initTimedBlockId);null!=f&&(f.running=!1),t.initTimedBlockId=-1},t.resumeSessionAndStartQueue=function(){o.isInitialized()&&(i.i("Resuming session."),o.sessionIsStarted()||t.newSession())},t.isSdkReady=function(e,t,n){return void 0===t&&(t=!0),void 0===n&&(n=""),n&&(n+=": "),e&&!o.isInitialized()?(t&&i.w(n+"SDK is not initialized"),!1):e&&!o.isEnabled()?(t&&i.w(n+"SDK is disabled"),!1):!(e&&!o.sessionIsStarted()&&(t&&i.w(n+"Session has not started yet"),1))},t.initTimedBlockId=-1,t.methodMap={},t);e.GameAnalytics=d}(i=i||{}),i.GameAnalytics.init();var c=i.GameAnalytics.gaCommand;e.gameanalytics=i,e.GameAnalytics=c}(this),window.Downloaded={},function(){var LZString=function(){function e(e,t){if(!r[e]){r[e]={};for(var n=0;n<e.length;n++)r[e][e.charAt(n)]=n}return r[e][t]}var t=String.fromCharCode,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",r={},o={compressToBase64:function(e){if(null==e)return"";var t=o._compress(e,6,function(e){return n.charAt(e)});switch(t.length%4){default:case 0:return t;case 1:return t+"===";case 2:return t+"==";case 3:return t+"="}},decompressFromBase64:function(t){return null==t?"":""==t?null:o._decompress(t.length,32,function(i){return e(n,t.charAt(i))})},compressToUTF16:function(e){return null==e?"":o._compress(e,15,function(e){return t(e+32)})+" "},decompressFromUTF16:function(e){return null==e?"":""==e?null:o._decompress(e.length,16384,function(t){return e.charCodeAt(t)-32})},compressToUint8Array:function(e){for(var t=o.compress(e),n=new Uint8Array(2*t.length),i=0,r=t.length;i<r;i++){var a=t.charCodeAt(i);n[2*i]=a>>>8,n[2*i+1]=a%256}return n},decompressFromUint8Array:function(e){if(null==e)return o.decompress(e);for(var n=new Array(e.length/2),i=0,r=n.length;i<r;i++)n[i]=256*e[2*i]+e[2*i+1];var a=[];return n.forEach(function(e){a.push(t(e))}),o.decompress(a.join(""))},compressToEncodedURIComponent:function(e){return null==e?"":o._compress(e,6,function(e){return i.charAt(e)})},decompressFromEncodedURIComponent:function(t){return null==t?"":""==t?null:(t=t.replace(/ /g,"+"),o._decompress(t.length,32,function(n){return e(i,t.charAt(n))}))},compress:function(e){return o._compress(e,16,function(e){return t(e)})},_compress:function(e,t,n){if(null==e)return"";var i,r,o,a={},s={},c="",l="",u="",h=2,d=3,p=2,f=[],m=0,g=0;for(o=0;o<e.length;o+=1)if(c=e.charAt(o),Object.prototype.hasOwnProperty.call(a,c)||(a[c]=d++,s[c]=!0),l=u+c,Object.prototype.hasOwnProperty.call(a,l))u=l;else{if(Object.prototype.hasOwnProperty.call(s,u)){if(u.charCodeAt(0)<256){for(i=0;i<p;i++)m<<=1,g==t-1?(g=0,f.push(n(m)),m=0):g++;for(r=u.charCodeAt(0),i=0;i<8;i++)m=m<<1|1&r,g==t-1?(g=0,f.push(n(m)),m=0):g++,r>>=1}else{for(r=1,i=0;i<p;i++)m=m<<1|r,g==t-1?(g=0,f.push(n(m)),m=0):g++,r=0;for(r=u.charCodeAt(0),i=0;i<16;i++)m=m<<1|1&r,g==t-1?(g=0,f.push(n(m)),m=0):g++,r>>=1}0==--h&&(h=Math.pow(2,p),p++),delete s[u]}else for(r=a[u],i=0;i<p;i++)m=m<<1|1&r,g==t-1?(g=0,f.push(n(m)),m=0):g++,r>>=1;0==--h&&(h=Math.pow(2,p),p++),a[l]=d++,u=String(c)}if(""!==u){if(Object.prototype.hasOwnProperty.call(s,u)){if(u.charCodeAt(0)<256){for(i=0;i<p;i++)m<<=1,g==t-1?(g=0,f.push(n(m)),m=0):g++;for(r=u.charCodeAt(0),i=0;i<8;i++)m=m<<1|1&r,g==t-1?(g=0,f.push(n(m)),m=0):g++,r>>=1}else{for(r=1,i=0;i<p;i++)m=m<<1|r,g==t-1?(g=0,f.push(n(m)),m=0):g++,r=0;for(r=u.charCodeAt(0),i=0;i<16;i++)m=m<<1|1&r,g==t-1?(g=0,f.push(n(m)),m=0):g++,r>>=1}0==--h&&(h=Math.pow(2,p),p++),delete s[u]}else for(r=a[u],i=0;i<p;i++)m=m<<1|1&r,g==t-1?(g=0,f.push(n(m)),m=0):g++,r>>=1;0==--h&&(h=Math.pow(2,p),p++)}for(r=2,i=0;i<p;i++)m=m<<1|1&r,g==t-1?(g=0,f.push(n(m)),m=0):g++,r>>=1;for(;;){if(m<<=1,g==t-1){f.push(n(m));break}g++}return f.join("")},decompress:function(e){return null==e?"":""==e?null:o._decompress(e.length,32768,function(t){return e.charCodeAt(t)})},_decompress:function(e,n,i){var r,o,a,s,c,l,u,h=[],d=4,p=4,f=3,m="",g=[],v={val:i(0),position:n,index:1};for(r=0;r<3;r+=1)h[r]=r;for(a=0,c=Math.pow(2,2),l=1;l!=c;)s=v.val&v.position,v.position>>=1,0==v.position&&(v.position=n,v.val=i(v.index++)),a|=(s>0?1:0)*l,l<<=1;switch(a){case 0:for(a=0,c=Math.pow(2,8),l=1;l!=c;)s=v.val&v.position,v.position>>=1,0==v.position&&(v.position=n,v.val=i(v.index++)),a|=(s>0?1:0)*l,l<<=1;u=t(a);break;case 1:for(a=0,c=Math.pow(2,16),l=1;l!=c;)s=v.val&v.position,v.position>>=1,0==v.position&&(v.position=n,v.val=i(v.index++)),a|=(s>0?1:0)*l,l<<=1;u=t(a);break;case 2:return""}for(h[3]=u,o=u,g.push(u);;){if(v.index>e)return"";for(a=0,c=Math.pow(2,f),l=1;l!=c;)s=v.val&v.position,v.position>>=1,0==v.position&&(v.position=n,v.val=i(v.index++)),a|=(s>0?1:0)*l,l<<=1;switch(u=a){case 0:for(a=0,c=Math.pow(2,8),l=1;l!=c;)s=v.val&v.position,v.position>>=1,0==v.position&&(v.position=n,v.val=i(v.index++)),a|=(s>0?1:0)*l,l<<=1;h[p++]=t(a),u=p-1,d--;break;case 1:for(a=0,c=Math.pow(2,16),l=1;l!=c;)s=v.val&v.position,v.position>>=1,0==v.position&&(v.position=n,v.val=i(v.index++)),a|=(s>0?1:0)*l,l<<=1;h[p++]=t(a),u=p-1,d--;break;case 2:return g.join("")}if(0==d&&(d=Math.pow(2,f),f++),h[u])m=h[u];else{if(u!==p)return null;m=o+o.charAt(0)}g.push(m),h[p++]=o+m.charAt(0),o=m,0==--d&&(d=Math.pow(2,f),f++)}}};return o}();!function(e){function t(e,t){var n=i.indexOf(e.charAt(t));if(-1===n)throw"Cannot decode base64";return n}function n(e,t){var n=e.charCodeAt(t);if(n>255)throw"INVALID_CHARACTER_ERR: DOM Exception 5";return n}var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";e.encodeB64=function(e){if(1!==arguments.length)throw"SyntaxError: exactly one argument required";var t,r,o=[],a=(e=String(e)).length-e.length%3;if(0===e.length)return e;for(t=0;t<a;t+=3)r=n(e,t)<<16|n(e,t+1)<<8|n(e,t+2),o.push(i.charAt(r>>18)),o.push(i.charAt(r>>12&63)),o.push(i.charAt(r>>6&63)),o.push(i.charAt(63&r));switch(e.length-a){case 1:r=n(e,t)<<16,o.push(i.charAt(r>>18)+i.charAt(r>>12&63)+"==");break;case 2:r=n(e,t)<<16|n(e,t+1)<<8,o.push(i.charAt(r>>18)+i.charAt(r>>12&63)+i.charAt(r>>6&63)+"=")}return o.join("")},e.decodeB64=function(e){var n,i,r=0,o=e.length,a=[];if(e=String(e),0===o)return e;if(o%4!=0)throw"Cannot decode base64";for("="===e.charAt(o-1)&&(r=1,"="===e.charAt(o-2)&&(r=2),o-=4),n=0;n<o;n+=4)i=t(e,n)<<18|t(e,n+1)<<12|t(e,n+2)<<6|t(e,n+3),a.push(String.fromCharCode(i>>16,i>>8&255,255&i));switch(r){case 1:i=t(e,n)<<18|t(e,n+1)<<12|t(e,n+2)<<6,a.push(String.fromCharCode(i>>16,i>>8&255));break;case 2:i=t(e,n)<<18|t(e,n+1)<<12,a.push(String.fromCharCode(i>>16))}return a.join("")}}(window);var getScriptFromServer=function(e){var t=document.createElement("script");t.type="text/javascript",t.src=e.src,t.onload=function(){e.onSuccess&&e.onSuccess(),t.parentNode.removeChild(t)},t.onerror=function(){e.onFailure&&e.onFailure()},document.head.appendChild(t)};window.patcher=function(baseUrl,version,onReady){var timeout=5e3,hasTimedout=!1,hasFinished=!1,currentPatch,downloadSettings=function(){hasTimedout||getScriptFromServer({src:baseUrl+"/settings.js",onSuccess:function(){var e=(window.Downloaded.settings||{})[version]||0;console.log("Detected "+e),-1===e?(localStorage.setItem("patch_"+version,null),onReady("Wiped clean.")):e>currentPatch.version?(console.log("Download new "+e),downloadPatch(e)):(console.log("Apply current "+currentPatch.version),applyPatch())},onFailure:applyPatch})},downloadPatch=function(e){if(!hasTimedout){var t=version+"-"+e;getScriptFromServer({src:baseUrl+"/"+t+".js",onSuccess:function(){var n=window.Downloaded[t]||{},i=n.cmp;if(currentPatch.version=e,i)try{currentPatch.data=LZString.decompressFromBase64(n.data)}catch(e){return currentPatch.data=null,void applyPatch()}else currentPatch.data=n.data;currentPatch.method=n.method||"default",localStorage.setItem("patch_"+version,JSON.stringify(currentPatch)),applyPatch()},onFailure:applyPatch})}},applyPatch=function(){var code;if(!hasFinished)if(hasFinished=!0,currentPatch.data)try{code="atob"===currentPatch.method?window.atob(currentPatch.data):window.decodeB64(currentPatch.data),eval(code),window.PATCHVERSION=currentPatch.version,onReady("Success")}catch(e){onReady("Failed with",e)}else onReady("Nothing to do.")};window.setTimeout(function(){hasFinished||(hasTimedout=!0,console.log("WARNING: Download timed out."),applyPatch())},timeout);try{currentPatch=JSON.parse(localStorage.getItem("patch_"+version))||{version:0}}catch(e){currentPatch={version:0}}downloadSettings()}}(),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).THREE={})}(this,function(e){"use strict";function t(){}function n(e,t){this.x=e||0,this.y=t||0}function i(e,t,n,i){this._x=e||0,this._y=t||0,this._z=n||0,this._w=void 0!==i?i:1}function r(e,t,n){this.x=e||0,this.y=t||0,this.z=n||0}function o(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}function a(e,t,i,r,s,c,l,u,h,d){Object.defineProperty(this,"id",{value:No++}),this.uuid=Co.generateUUID(),this.name="",this.image=void 0!==e?e:a.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==t?t:a.DEFAULT_MAPPING,this.wrapS=void 0!==i?i:1001,this.wrapT=void 0!==r?r:1001,this.magFilter=void 0!==s?s:1006,this.minFilter=void 0!==c?c:1008,this.anisotropy=void 0!==h?h:1,this.format=void 0!==l?l:1023,this.type=void 0!==u?u:1009,this.offset=new n(0,0),this.repeat=new n(1,1),this.center=new n(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new o,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==d?d:3e3,this.version=0,this.onUpdate=null}function s(e,t,n,i){this.x=e||0,this.y=t||0,this.z=n||0,this.w=void 0!==i?i:1}function c(e,t,n){this.width=e,this.height=t,this.scissor=new s(0,0,e,t),this.scissorTest=!1,this.viewport=new s(0,0,e,t),n=n||{},this.texture=new a(void 0,void 0,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.image={},this.texture.image.width=e,this.texture.image.height=t,this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:1006,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0===n.stencilBuffer||n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null}function l(e,t,n){c.call(this,e,t,n),this.samples=4}function u(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}function h(e,t,n,i){this._x=e||0,this._y=t||0,this._z=n||0,this._order=i||h.DefaultOrder}function d(){this.mask=1}function p(){Object.defineProperty(this,"id",{value:oa++}),this.uuid=Co.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=p.DefaultUp.clone();var e=new r,t=new h,n=new i,a=new r(1,1,1);t._onChange(function(){n.setFromEuler(t,!1)}),n._onChange(function(){t.setFromQuaternion(n,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:a},modelViewMatrix:{value:new u},normalMatrix:{value:new o}}),this.matrix=new u,this.matrixWorld=new u,this.matrixAutoUpdate=p.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new d,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}function f(){p.call(this),this.type="Scene",this.background=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function m(e,t){this.min=void 0!==e?e:new r(1/0,1/0,1/0),this.max=void 0!==t?t:new r(-1/0,-1/0,-1/0)}function g(e,t){this.center=void 0!==e?e:new r,this.radius=void 0!==t?t:0}function v(e,t){this.origin=void 0!==e?e:new r,this.direction=void 0!==t?t:new r}function y(e,t,n){this.a=void 0!==e?e:new r,this.b=void 0!==t?t:new r,this.c=void 0!==n?n:new r}function b(e,t,n){return void 0===t&&void 0===n?this.set(e):this.setRGB(e,t,n)}function w(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}function x(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function E(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}function S(e,t,n,i,o,a){this.a=e,this.b=t,this.c=n,this.normal=i&&i.isVector3?i:new r,this.vertexNormals=Array.isArray(i)?i:[],this.color=o&&o.isColor?o:new b,this.vertexColors=Array.isArray(o)?o:[],this.materialIndex=void 0!==a?a:0}function _(){Object.defineProperty(this,"id",{value:ua++}),this.uuid=Co.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.lights=!0,this.blending=1,this.side=0,this.flatShading=!1,this.vertexTangents=!1,this.vertexColors=0,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilFunc=519,this.stencilRef=0,this.stencilMask=255,this.stencilFail=7680,this.stencilZFail=7680,this.stencilZPass=7680,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.userData={},this.needsUpdate=!0}function T(e){_.call(this),this.type="MeshBasicMaterial",this.color=new b(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.lights=!1,this.setValues(e)}function M(e,t,n){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===n,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}function C(e,t,n){M.call(this,new Int8Array(e),t,n)}function A(e,t,n){M.call(this,new Uint8Array(e),t,n)}function R(e,t,n){M.call(this,new Uint8ClampedArray(e),t,n)}function P(e,t,n){M.call(this,new Int16Array(e),t,n)}function I(e,t,n){M.call(this,new Uint16Array(e),t,n)}function L(e,t,n){M.call(this,new Int32Array(e),t,n)}function D(e,t,n){M.call(this,new Uint32Array(e),t,n)}function O(e,t,n){M.call(this,new Float32Array(e),t,n)}function k(e,t,n){M.call(this,new Float64Array(e),t,n)}function F(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function B(e){if(0===e.length)return-1/0;for(var t=e[0],n=1,i=e.length;n<i;++n)e[n]>t&&(t=e[n]);return t}function N(){Object.defineProperty(this,"id",{value:fa+=2}),this.uuid=Co.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}function U(e,t){p.call(this),this.type="Mesh",this.geometry=void 0!==e?e:new N,this.material=void 0!==t?t:new T({color:16777215*Math.random()}),this.drawMode=0,this.updateMorphTargets()}function z(){Object.defineProperty(this,"id",{value:ma+=2}),this.uuid=Co.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}function G(e,t,n,i,r,o){z.call(this),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:i,heightSegments:r,depthSegments:o},this.fromBufferGeometry(new H(e,t,n,i,r,o)),this.mergeVertices()}function H(e,t,n,i,o,a){function s(e,t,n,i,o,a,s,m,g,v,y){var b,w,x=a/g,E=s/v,S=a/2,_=s/2,T=m/2,M=g+1,C=v+1,A=0,R=0,P=new r;for(w=0;w<C;w++){var I=w*E-_;for(b=0;b<M;b++){var L=b*x-S;P[e]=L*i,P[t]=I*o,P[n]=T,u.push(P.x,P.y,P.z),P[e]=0,P[t]=0,P[n]=m>0?1:-1,h.push(P.x,P.y,P.z),d.push(b/g),d.push(1-w/v),A+=1}}for(w=0;w<v;w++)for(b=0;b<g;b++){var D=p+b+M*w,O=p+b+M*(w+1),k=p+(b+1)+M*(w+1),F=p+(b+1)+M*w;l.push(D,O,F),l.push(O,k,F),R+=6}c.addGroup(f,R,y),f+=R,p+=A}N.call(this),this.type="BoxBufferGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:i,heightSegments:o,depthSegments:a};var c=this;e=e||1,t=t||1,n=n||1,i=Math.floor(i)||1,o=Math.floor(o)||1,a=Math.floor(a)||1;var l=[],u=[],h=[],d=[],p=0,f=0;s("z","y","x",-1,-1,n,t,e,a,o,0),s("z","y","x",1,-1,n,t,-e,a,o,1),s("x","z","y",1,1,e,n,t,i,a,2),s("x","z","y",1,-1,e,n,-t,i,a,3),s("x","y","z",1,-1,e,t,n,i,o,4),s("x","y","z",-1,-1,e,t,-n,i,o,5),this.setIndex(l),this.addAttribute("position",new O(u,3)),this.addAttribute("normal",new O(h,3)),this.addAttribute("uv",new O(d,2))}function j(e){var t={};for(var n in e)for(var i in t[n]={},e[n]){var r=e[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture)?t[n][i]=r.clone():Array.isArray(r)?t[n][i]=r.slice():t[n][i]=r}return t}function V(e){for(var t={},n=0;n<e.length;n++){var i=j(e[n]);for(var r in i)t[r]=i[r]}return t}function W(e){_.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}function X(){p.call(this),this.type="Camera",this.matrixWorldInverse=new u,this.projectionMatrix=new u,this.projectionMatrixInverse=new u}
function q(e,t,n,i){X.call(this),this.type="PerspectiveCamera",this.fov=void 0!==e?e:50,this.zoom=1,this.near=void 0!==n?n:.1,this.far=void 0!==i?i:2e3,this.focus=10,this.aspect=void 0!==t?t:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}function Y(e,t,n,i){p.call(this),this.type="CubeCamera";var o=new q(90,1,e,t);o.up.set(0,-1,0),o.lookAt(new r(1,0,0)),this.add(o);var a=new q(90,1,e,t);a.up.set(0,-1,0),a.lookAt(new r(-1,0,0)),this.add(a);var s=new q(90,1,e,t);s.up.set(0,0,1),s.lookAt(new r(0,1,0)),this.add(s);var c=new q(90,1,e,t);c.up.set(0,0,-1),c.lookAt(new r(0,-1,0)),this.add(c);var l=new q(90,1,e,t);l.up.set(0,-1,0),l.lookAt(new r(0,0,1)),this.add(l);var u=new q(90,1,e,t);u.up.set(0,-1,0),u.lookAt(new r(0,0,-1)),this.add(u),i=i||{format:1022,magFilter:1006,minFilter:1006},this.renderTarget=new J(n,n,i),this.renderTarget.texture.name="CubeCamera",this.update=function(e,t){null===this.parent&&this.updateMatrixWorld();var n=e.getRenderTarget(),i=this.renderTarget,r=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0),e.render(t,o),e.setRenderTarget(i,1),e.render(t,a),e.setRenderTarget(i,2),e.render(t,s),e.setRenderTarget(i,3),e.render(t,c),e.setRenderTarget(i,4),e.render(t,l),i.texture.generateMipmaps=r,e.setRenderTarget(i,5),e.render(t,u),e.setRenderTarget(n)},this.clear=function(e,t,n,i){for(var r=e.getRenderTarget(),o=this.renderTarget,a=0;a<6;a++)e.setRenderTarget(o,a),e.clear(t,n,i);e.setRenderTarget(r)}}function J(e,t,n){c.call(this,e,t,n)}function K(e,t,n,i,r,o,s,c,l,u,h,d){a.call(this,null,o,s,c,l,u,i,r,h,d),this.image={data:e,width:t,height:n},this.magFilter=void 0!==l?l:1003,this.minFilter=void 0!==u?u:1003,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}function Z(e,t){this.normal=void 0!==e?e:new r(1,0,0),this.constant=void 0!==t?t:0}function Q(e,t,n,i,r,o){this.planes=[void 0!==e?e:new Z,void 0!==t?t:new Z,void 0!==n?n:new Z,void 0!==i?i:new Z,void 0!==r?r:new Z,void 0!==o?o:new Z]}function $(){function e(r,o){!1!==n&&(i(r,o),t.requestAnimationFrame(e))}var t=null,n=!1,i=null;return{start:function(){!0!==n&&null!==i&&(t.requestAnimationFrame(e),n=!0)},stop:function(){n=!1},setAnimationLoop:function(e){i=e},setContext:function(e){t=e}}}function ee(e){var t=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),t.get(e)},remove:function(n){n.isInterleavedBufferAttribute&&(n=n.data);var i=t.get(n);i&&(e.deleteBuffer(i.buffer),t.delete(n))},update:function(n,i){n.isInterleavedBufferAttribute&&(n=n.data);var r=t.get(n);void 0===r?t.set(n,function(t,n){var i=t.array,r=t.dynamic?35048:35044,o=e.createBuffer();e.bindBuffer(n,o),e.bufferData(n,i,r),t.onUploadCallback();var a=5126;return i instanceof Float32Array?a=5126:i instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):i instanceof Uint16Array?a=5123:i instanceof Int16Array?a=5122:i instanceof Uint32Array?a=5125:i instanceof Int32Array?a=5124:i instanceof Int8Array?a=5120:i instanceof Uint8Array&&(a=5121),{buffer:o,type:a,bytesPerElement:i.BYTES_PER_ELEMENT,version:t.version}}(n,i)):r.version<n.version&&(function(t,n,i){var r=n.array,o=n.updateRange;e.bindBuffer(i,t),!1===n.dynamic?e.bufferData(i,r,35044):-1===o.count?e.bufferSubData(i,0,r):0===o.count?console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):(e.bufferSubData(i,o.offset*r.BYTES_PER_ELEMENT,r.subarray(o.offset,o.offset+o.count)),o.count=-1)}(r.buffer,n,i),r.version=n.version)}}}function te(e,t,n,i){z.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i},this.fromBufferGeometry(new ne(e,t,n,i)),this.mergeVertices()}function ne(e,t,n,i){N.call(this),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i};var r,o,a=(e=e||1)/2,s=(t=t||1)/2,c=Math.floor(n)||1,l=Math.floor(i)||1,u=c+1,h=l+1,d=e/c,p=t/l,f=[],m=[],g=[],v=[];for(o=0;o<h;o++){var y=o*p-s;for(r=0;r<u;r++){var b=r*d-a;m.push(b,-y,0),g.push(0,0,1),v.push(r/c),v.push(1-o/l)}}for(o=0;o<l;o++)for(r=0;r<c;r++){var w=r+u*o,x=r+u*(o+1),E=r+1+u*(o+1),S=r+1+u*o;f.push(w,x,S),f.push(x,E,S)}this.setIndex(f),this.addAttribute("position",new O(m,3)),this.addAttribute("normal",new O(g,3)),this.addAttribute("uv",new O(v,2))}function ie(e,t,n,i){function r(e,n){t.buffers.color.setClear(e.r,e.g,e.b,n,i)}var o,a,s=new b(0),c=0,l=null,u=0;return{getClearColor:function(){return s},setClearColor:function(e,t){s.set(e),r(s,c=void 0!==t?t:1)},getClearAlpha:function(){return c},setClearAlpha:function(e){r(s,c=e)},render:function(t,i,h,d){var p=i.background,f=e.vr,m=f.getSession&&f.getSession();if(m&&"additive"===m.environmentBlendMode&&(p=null),null===p?(r(s,c),l=null,u=0):p&&p.isColor&&(r(p,1),d=!0,l=null,u=0),(e.autoClear||d)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),p&&(p.isCubeTexture||p.isWebGLRenderTargetCube)){void 0===a&&((a=new U(new H(1,1,1),new W({type:"BackgroundCubeMaterial",uniforms:j(xa.cube.uniforms),vertexShader:xa.cube.vertexShader,fragmentShader:xa.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.removeAttribute("normal"),a.geometry.removeAttribute("uv"),a.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(a.material,"map",{get:function(){return this.uniforms.tCube.value}}),n.update(a));var g=p.isWebGLRenderTargetCube?p.texture:p;a.material.uniforms.tCube.value=g,a.material.uniforms.tFlip.value=p.isWebGLRenderTargetCube?1:-1,l===p&&u===g.version||(a.material.needsUpdate=!0,l=p,u=g.version),t.unshift(a,a.geometry,a.material,0,0,null)}else p&&p.isTexture&&(void 0===o&&((o=new U(new ne(2,2),new W({type:"BackgroundMaterial",uniforms:j(xa.background.uniforms),vertexShader:xa.background.vertexShader,fragmentShader:xa.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.removeAttribute("normal"),Object.defineProperty(o.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(o)),o.material.uniforms.t2D.value=p,!0===p.matrixAutoUpdate&&p.updateMatrix(),o.material.uniforms.uvTransform.value.copy(p.matrix),l===p&&u===p.version||(o.material.needsUpdate=!0,l=p,u=p.version),t.unshift(o,o.geometry,o.material,0,0,null))}}}function re(e,t,n,i){var r;this.setMode=function(e){r=e},this.render=function(t,i){e.drawArrays(r,t,i),n.update(i,r)},this.renderInstances=function(o,a,s){var c;if(i.isWebGL2)c=e;else if(null===(c=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");c[i.isWebGL2?"drawArraysInstanced":"drawArraysInstancedANGLE"](r,a,s,o.maxInstancedCount),n.update(s,r,o.maxInstancedCount)}}function oe(e,t,n){function i(t){if("highp"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}var r,o="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext,a=void 0!==n.precision?n.precision:"highp",s=i(a);s!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",s,"instead."),a=s);var c=!0===n.logarithmicDepthBuffer,l=e.getParameter(34930),u=e.getParameter(35660),h=e.getParameter(3379),d=e.getParameter(34076),p=e.getParameter(34921),f=e.getParameter(36347),m=e.getParameter(36348),g=e.getParameter(36349),v=u>0,y=o||!!t.get("OES_texture_float");return{isWebGL2:o,getMaxAnisotropy:function(){if(void 0!==r)return r;var n=t.get("EXT_texture_filter_anisotropic");return r=null!==n?e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:i,precision:a,logarithmicDepthBuffer:c,maxTextures:l,maxVertexTextures:u,maxTextureSize:h,maxCubemapSize:d,maxAttributes:p,maxVertexUniforms:f,maxVaryings:m,maxFragmentUniforms:g,vertexTextures:v,floatFragmentTextures:y,floatVertexTextures:v&&y,maxSamples:o?e.getParameter(36183):0}}function ae(){function e(){u.value!==i&&(u.value=i,u.needsUpdate=r>0),n.numPlanes=r,n.numIntersection=0}function t(e,t,i,r){var o=null!==e?e.length:0,a=null;if(0!==o){if(a=u.value,!0!==r||null===a){var s=i+4*o,h=t.matrixWorldInverse;l.getNormalMatrix(h),(null===a||a.length<s)&&(a=new Float32Array(s));for(var d=0,p=i;d!==o;++d,p+=4)c.copy(e[d]).applyMatrix4(h,l),c.normal.toArray(a,p),a[p+3]=c.constant}u.value=a,u.needsUpdate=!0}return n.numPlanes=o,a}var n=this,i=null,r=0,a=!1,s=!1,c=new Z,l=new o,u={value:null,needsUpdate:!1};this.uniform=u,this.numPlanes=0,this.numIntersection=0,this.init=function(e,n,o){var s=0!==e.length||n||0!==r||a;return a=n,i=t(e,o,0),r=e.length,s},this.beginShadows=function(){s=!0,t(null)},this.endShadows=function(){s=!1,e()},this.setState=function(n,o,c,l,h,d){if(!a||null===n||0===n.length||s&&!c)s?t(null):e();else{var p=s?0:r,f=4*p,m=h.clippingState||null;u.value=m,m=t(n,l,f,d);for(var g=0;g!==f;++g)m[g]=i[g];h.clippingState=m,this.numIntersection=o?this.numPlanes:0,this.numPlanes+=p}}}function se(e){var t={};return{get:function(n){if(void 0!==t[n])return t[n];var i;switch(n){case"WEBGL_depth_texture":i=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=e.getExtension(n)}return null===i&&console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),t[n]=i,i}}}function ce(e,t,n){function i(e){var r=e.target,s=o[r.id];for(var c in null!==s.index&&t.remove(s.index),s.attributes)t.remove(s.attributes[c]);r.removeEventListener("dispose",i),delete o[r.id];var l=a[s.id];l&&(t.remove(l),delete a[s.id]),n.memory.geometries--}function r(e){var n=[],i=e.index,r=e.attributes.position,o=0;if(null!==i){var s=i.array;o=i.version;for(var c=0,l=s.length;c<l;c+=3){var u=s[c+0],h=s[c+1],d=s[c+2];n.push(u,h,h,d,d,u)}}else for(s=r.array,o=r.version,c=0,l=s.length/3-1;c<l;c+=3)u=c+0,h=c+1,d=c+2,n.push(u,h,h,d,d,u);var p=new(B(n)>65535?D:I)(n,1);p.version=o,t.update(p,34963);var f=a[e.id];f&&t.remove(f),a[e.id]=p}var o={},a={};return{get:function(e,t){var r=o[t.id];return r||(t.addEventListener("dispose",i),t.isBufferGeometry?r=t:t.isGeometry&&(void 0===t._bufferGeometry&&(t._bufferGeometry=(new N).setFromObject(e)),r=t._bufferGeometry),o[t.id]=r,n.memory.geometries++,r)},update:function(e){var n=e.index,i=e.attributes;for(var r in null!==n&&t.update(n,34963),i)t.update(i[r],34962);var o=e.morphAttributes;for(var r in o)for(var a=o[r],s=0,c=a.length;s<c;s++)t.update(a[s],34962)},getWireframeAttribute:function(e){var t=a[e.id];if(t){var n=e.index;null!==n&&t.version<n.version&&r(e)}else r(e);return a[e.id]}}}function le(e,t,n,i){var r,o,a;this.setMode=function(e){r=e},this.setIndex=function(e){o=e.type,a=e.bytesPerElement},this.render=function(t,i){e.drawElements(r,i,o,t*a),n.update(i,r)},this.renderInstances=function(s,c,l){var u;if(i.isWebGL2)u=e;else if(null===(u=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");u[i.isWebGL2?"drawElementsInstanced":"drawElementsInstancedANGLE"](r,l,o,c*a,s.maxInstancedCount),n.update(l,r,s.maxInstancedCount)}}function ue(e){var t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,n,i){switch(i=i||1,t.calls++,n){case 4:t.triangles+=i*(e/3);break;case 5:case 6:t.triangles+=i*(e-2);break;case 1:t.lines+=i*(e/2);break;case 3:t.lines+=i*(e-1);break;case 2:t.lines+=i*e;break;case 0:t.points+=i*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}function he(e,t){return Math.abs(t[1])-Math.abs(e[1])}function de(e){var t={},n=new Float32Array(8);return{update:function(i,r,o,a){var s=i.morphTargetInfluences,c=s.length,l=t[r.id];if(void 0===l){l=[];for(var u=0;u<c;u++)l[u]=[u,0];t[r.id]=l}var h=o.morphTargets&&r.morphAttributes.position,d=o.morphNormals&&r.morphAttributes.normal;for(u=0;u<c;u++)0!==(p=l[u])[1]&&(h&&r.removeAttribute("morphTarget"+u),d&&r.removeAttribute("morphNormal"+u));for(u=0;u<c;u++)(p=l[u])[0]=u,p[1]=s[u];for(l.sort(he),u=0;u<8;u++){var p;if(p=l[u]){var f=p[0],m=p[1];if(m){h&&r.addAttribute("morphTarget"+u,h[f]),d&&r.addAttribute("morphNormal"+u,d[f]),n[u]=m;continue}}n[u]=0}a.getUniforms().setValue(e,"morphTargetInfluences",n)}}}function pe(e,t){var n={};return{update:function(i){var r=t.render.frame,o=i.geometry,a=e.get(i,o);return n[a.id]!==r&&(o.isGeometry&&a.updateFromObject(i),e.update(a),n[a.id]=r),a},dispose:function(){n={}}}}function fe(e,t,n,i,r,o,s,c,l,u){e=void 0!==e?e:[],t=void 0!==t?t:301,s=void 0!==s?s:1022,a.call(this,e,t,n,i,r,o,s,c,l,u),this.flipY=!1}function me(e,t,n,i){a.call(this,null),this.image={data:e,width:t,height:n,depth:i},this.magFilter=1003,this.minFilter=1003,this.wrapR=1001,this.generateMipmaps=!1,this.flipY=!1}function ge(e,t,n,i){a.call(this,null),this.image={data:e,width:t,height:n,depth:i},this.magFilter=1003,this.minFilter=1003,this.wrapR=1001,this.generateMipmaps=!1,this.flipY=!1}function ve(e,t,n){var i=e[0];if(i<=0||i>0)return e;var r=t*n,o=Ma[r];if(void 0===o&&(o=new Float32Array(r),Ma[r]=o),0!==t){i.toArray(o,0);for(var a=1,s=0;a!==t;++a)s+=n,e[a].toArray(o,s)}return o}function ye(e,t){if(e.length!==t.length)return!1;for(var n=0,i=e.length;n<i;n++)if(e[n]!==t[n])return!1;return!0}function be(e,t){for(var n=0,i=t.length;n<i;n++)e[n]=t[n]}function we(e,t){var n=Ca[t];void 0===n&&(n=new Int32Array(t),Ca[t]=n);for(var i=0;i!==t;++i)n[i]=e.allocateTextureUnit();return n}function xe(e,t){var n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function Ee(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(ye(n,t))return;e.uniform2fv(this.addr,t),be(n,t)}}function Se(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(ye(n,t))return;e.uniform3fv(this.addr,t),be(n,t)}}function _e(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(ye(n,t))return;e.uniform4fv(this.addr,t),be(n,t)}}function Te(e,t){var n=this.cache,i=t.elements;if(void 0===i){if(ye(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),be(n,t)}else{if(ye(n,i))return;Pa.set(i),e.uniformMatrix2fv(this.addr,!1,Pa),be(n,i)}}function Me(e,t){var n=this.cache,i=t.elements;if(void 0===i){if(ye(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),be(n,t)}else{if(ye(n,i))return;Ra.set(i),e.uniformMatrix3fv(this.addr,!1,Ra),be(n,i)}}function Ce(e,t){var n=this.cache,i=t.elements;if(void 0===i){if(ye(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),be(n,t)}else{if(ye(n,i))return;Aa.set(i),e.uniformMatrix4fv(this.addr,!1,Aa),be(n,i)}}function Ae(e,t,n){var i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.safeSetTexture2D(t||Ea,r)}function Re(e,t,n){var i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture2DArray(t||Sa,r)}function Pe(e,t,n){var i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture3D(t||_a,r)}function Ie(e,t,n){var i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.safeSetTextureCube(t||Ta,r)}function Le(e,t){var n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function De(e,t){var n=this.cache;ye(n,t)||(e.uniform2iv(this.addr,t),be(n,t))}function Oe(e,t){var n=this.cache;ye(n,t)||(e.uniform3iv(this.addr,t),be(n,t))}function ke(e,t){var n=this.cache;ye(n,t)||(e.uniform4iv(this.addr,t),be(n,t))}function Fe(e,t){e.uniform1fv(this.addr,t)}function Be(e,t){e.uniform1iv(this.addr,t)}function Ne(e,t){e.uniform2iv(this.addr,t)}function Ue(e,t){e.uniform3iv(this.addr,t)}function ze(e,t){e.uniform4iv(this.addr,t)}function Ge(e,t){var n=ve(t,this.size,2);e.uniform2fv(this.addr,n)}function He(e,t){var n=ve(t,this.size,3);e.uniform3fv(this.addr,n)}function je(e,t){var n=ve(t,this.size,4);e.uniform4fv(this.addr,n)}function Ve(e,t){var n=ve(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function We(e,t){var n=ve(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function Xe(e,t){var n=ve(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function qe(e,t,n){var i=t.length,r=we(n,i);e.uniform1iv(this.addr,r);for(var o=0;o!==i;++o)n.safeSetTexture2D(t[o]||Ea,r[o])}function Ye(e,t,n){var i=t.length,r=we(n,i);e.uniform1iv(this.addr,r);for(var o=0;o!==i;++o)n.safeSetTextureCube(t[o]||Ta,r[o])}function Je(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=function(e){switch(e){case 5126:return xe;case 35664:return Ee;case 35665:return Se;case 35666:return _e;case 35674:return Te;case 35675:return Me;case 35676:return Ce;case 35678:case 36198:return Ae;case 35679:return Pe;case 35680:return Ie;case 36289:return Re;case 5124:case 35670:return Le;case 35667:case 35671:return De;case 35668:case 35672:return Oe;case 35669:case 35673:return ke}}(t.type)}function Ke(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return Fe;case 35664:return Ge;case 35665:return He;case 35666:return je;case 35674:return Ve;case 35675:return We;case 35676:return Xe;case 35678:return qe;case 35680:return Ye;case 5124:case 35670:return Be;case 35667:case 35671:return Ne;case 35668:case 35672:return Ue;case 35669:case 35673:return ze}}(t.type)}function Ze(e){this.id=e,this.seq=[],this.map={}}function Qe(e,t){e.seq.push(t),e.map[t.id]=t}function $e(e,t,n){var i=e.name,r=i.length;for(Ia.lastIndex=0;;){var o=Ia.exec(i),a=Ia.lastIndex,s=o[1],c="]"===o[2],l=o[3];if(c&&(s|=0),void 0===l||"["===l&&a+2===r){Qe(n,void 0===l?new Je(s,e,t):new Ke(s,e,t));break}var u=n.map[s];void 0===u&&Qe(n,u=new Ze(s)),n=u}}function et(e,t){this.seq=[],this.map={};for(var n=e.getProgramParameter(t,35718),i=0;i<n;++i){var r=e.getActiveUniform(t,i);$e(r,e.getUniformLocation(t,r.name),this)}}function tt(e,t,n){var i=e.createShader(t);return e.shaderSource(i,n),e.compileShader(i),i}function nt(e){switch(e){case 3e3:return["Linear","( value )"];case 3001:return["sRGB","( value )"];case 3002:return["RGBE","( value )"];case 3004:return["RGBM","( value, 7.0 )"];case 3005:return["RGBM","( value, 16.0 )"];case 3006:return["RGBD","( value, 256.0 )"];case 3007:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw new Error("unsupported encoding: "+e)}}function it(e,t,n){var i=e.getShaderParameter(t,35713),r=e.getShaderInfoLog(t).trim();return i&&""===r?"":"THREE.WebGLShader: gl.getShaderInfoLog() "+n+"\n"+r+function(e){for(var t=e.split("\n"),n=0;n<t.length;n++)t[n]=n+1+": "+t[n];return t.join("\n")}(e.getShaderSource(t))}function rt(e,t){var n=nt(t);return"vec4 "+e+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function ot(e,t){var n;switch(t){case 1:n="Linear";break;case 2:n="Reinhard";break;case 3:n="Uncharted2";break;case 4:n="OptimizedCineon";break;case 5:n="ACESFilmic";break;default:throw new Error("unsupported toneMapping: "+t)}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function at(e){return""!==e}function st(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights)}function ct(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}function lt(e){return e.replace(/^[ \t]*#include +<([\w\d./]+)>/gm,function(e,t){var n=ba[t];if(void 0===n)throw new Error("Can not resolve #include <"+t+">");return lt(n)})}function ut(e){return e.replace(/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,function(e,t,n,i){for(var r="",o=parseInt(t);o<parseInt(n);o++)r+=i.replace(/\[ i \]/g,"[ "+o+" ]");return r})}function ht(e,t,n,i,r,o,a){var s=e.getContext(),c=i.defines,l=r.vertexShader,u=r.fragmentShader,h="SHADOWMAP_TYPE_BASIC";1===o.shadowMapType?h="SHADOWMAP_TYPE_PCF":2===o.shadowMapType&&(h="SHADOWMAP_TYPE_PCF_SOFT");var d="ENVMAP_TYPE_CUBE",p="ENVMAP_MODE_REFLECTION",f="ENVMAP_BLENDING_MULTIPLY";if(o.envMap){switch(i.envMap.mapping){case 301:case 302:d="ENVMAP_TYPE_CUBE";break;case 306:case 307:d="ENVMAP_TYPE_CUBE_UV";break;case 303:case 304:d="ENVMAP_TYPE_EQUIREC";break;case 305:d="ENVMAP_TYPE_SPHERE"}switch(i.envMap.mapping){case 302:case 304:p="ENVMAP_MODE_REFRACTION"}switch(i.combine){case 0:f="ENVMAP_BLENDING_MULTIPLY";break;case 1:f="ENVMAP_BLENDING_MIX";break;case 2:f="ENVMAP_BLENDING_ADD"}}var m,g,v,y,b,w=e.gammaFactor>0?e.gammaFactor:1,x=a.isWebGL2?"":function(e,t,n){return[(e=e||{}).derivatives||t.envMapCubeUV||t.bumpMap||t.normalMap&&!t.objectSpaceNormalMap||t.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(e.fragDepth||t.logarithmicDepthBuffer)&&n.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",e.drawBuffers&&n.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(e.shaderTextureLOD||t.envMap)&&n.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(at).join("\n")}(i.extensions,o,t),E=function(e){var t=[];for(var n in e){var i=e[n];!1!==i&&t.push("#define "+n+" "+i)}return t.join("\n")}(c),S=s.createProgram();if(i.isRawShaderMaterial?((m=[E].filter(at).join("\n")).length>0&&(m+="\n"),(g=[x,E].filter(at).join("\n")).length>0&&(g+="\n")):(m=["precision "+o.precision+" float;","precision "+o.precision+" int;","#define SHADER_NAME "+r.name,E,o.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+w,"#define MAX_BONES "+o.maxBones,o.useFog&&o.fog?"#define USE_FOG":"",o.useFog&&o.fogExp?"#define FOG_EXP2":"",o.map?"#define USE_MAP":"",o.envMap?"#define USE_ENVMAP":"",o.envMap?"#define "+p:"",o.lightMap?"#define USE_LIGHTMAP":"",o.aoMap?"#define USE_AOMAP":"",o.emissiveMap?"#define USE_EMISSIVEMAP":"",o.bumpMap?"#define USE_BUMPMAP":"",o.normalMap?"#define USE_NORMALMAP":"",o.normalMap&&o.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",o.displacementMap&&o.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",o.specularMap?"#define USE_SPECULARMAP":"",o.roughnessMap?"#define USE_ROUGHNESSMAP":"",o.metalnessMap?"#define USE_METALNESSMAP":"",o.alphaMap?"#define USE_ALPHAMAP":"",o.vertexTangents?"#define USE_TANGENT":"",o.vertexColors?"#define USE_COLOR":"",o.flatShading?"#define FLAT_SHADED":"",o.skinning?"#define USE_SKINNING":"",o.useVertexTexture?"#define BONE_TEXTURE":"",o.morphTargets?"#define USE_MORPHTARGETS":"",o.morphNormals&&!1===o.flatShading?"#define USE_MORPHNORMALS":"",o.doubleSided?"#define DOUBLE_SIDED":"",o.flipSided?"#define FLIP_SIDED":"",o.shadowMapEnabled?"#define USE_SHADOWMAP":"",o.shadowMapEnabled?"#define "+h:"",o.sizeAttenuation?"#define USE_SIZEATTENUATION":"",o.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",o.logarithmicDepthBuffer&&(a.isWebGL2||t.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(at).join("\n"),g=[x,"precision "+o.precision+" float;","precision "+o.precision+" int;","#define SHADER_NAME "+r.name,E,o.alphaTest?"#define ALPHATEST "+o.alphaTest+(o.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+w,o.useFog&&o.fog?"#define USE_FOG":"",o.useFog&&o.fogExp?"#define FOG_EXP2":"",o.map?"#define USE_MAP":"",o.matcap?"#define USE_MATCAP":"",o.envMap?"#define USE_ENVMAP":"",o.envMap?"#define "+d:"",o.envMap?"#define "+p:"",o.envMap?"#define "+f:"",o.lightMap?"#define USE_LIGHTMAP":"",o.aoMap?"#define USE_AOMAP":"",o.emissiveMap?"#define USE_EMISSIVEMAP":"",o.bumpMap?"#define USE_BUMPMAP":"",o.normalMap?"#define USE_NORMALMAP":"",o.normalMap&&o.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",o.specularMap?"#define USE_SPECULARMAP":"",o.roughnessMap?"#define USE_ROUGHNESSMAP":"",o.metalnessMap?"#define USE_METALNESSMAP":"",o.alphaMap?"#define USE_ALPHAMAP":"",o.vertexTangents?"#define USE_TANGENT":"",o.vertexColors?"#define USE_COLOR":"",o.gradientMap?"#define USE_GRADIENTMAP":"",o.flatShading?"#define FLAT_SHADED":"",o.doubleSided?"#define DOUBLE_SIDED":"",o.flipSided?"#define FLIP_SIDED":"",o.shadowMapEnabled?"#define USE_SHADOWMAP":"",o.shadowMapEnabled?"#define "+h:"",o.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",o.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",o.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",o.logarithmicDepthBuffer&&(a.isWebGL2||t.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"",o.envMap&&(a.isWebGL2||t.get("EXT_shader_texture_lod"))?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",0!==o.toneMapping?"#define TONE_MAPPING":"",0!==o.toneMapping?ba.tonemapping_pars_fragment:"",0!==o.toneMapping?ot("toneMapping",o.toneMapping):"",o.dithering?"#define DITHERING":"",o.outputEncoding||o.mapEncoding||o.matcapEncoding||o.envMapEncoding||o.emissiveMapEncoding?ba.encodings_pars_fragment:"",o.mapEncoding?rt("mapTexelToLinear",o.mapEncoding):"",o.matcapEncoding?rt("matcapTexelToLinear",o.matcapEncoding):"",o.envMapEncoding?rt("envMapTexelToLinear",o.envMapEncoding):"",o.emissiveMapEncoding?rt("emissiveMapTexelToLinear",o.emissiveMapEncoding):"",o.outputEncoding?(v="linearToOutputTexel",y=o.outputEncoding,b=nt(y),"vec4 "+v+"( vec4 value ) { return LinearTo"+b[0]+b[1]+"; }"):"",o.depthPacking?"#define DEPTH_PACKING "+i.depthPacking:"","\n"].filter(at).join("\n")),l=ct(l=st(l=lt(l),o),o),u=ct(u=st(u=lt(u),o),o),l=ut(l),u=ut(u),a.isWebGL2&&!i.isRawShaderMaterial){var _=!1,T=/^\s*#version\s+300\s+es\s*\n/;i.isShaderMaterial&&null!==l.match(T)&&null!==u.match(T)&&(_=!0,l=l.replace(T,""),u=u.replace(T,"")),m=["#version 300 es\n","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+m,g=["#version 300 es\n","#define varying in",_?"":"out highp vec4 pc_fragColor;",_?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+g}var M,C,A=g+u,R=tt(s,35633,m+l),P=tt(s,35632,A);if(s.attachShader(S,R),s.attachShader(S,P),void 0!==i.index0AttributeName?s.bindAttribLocation(S,0,i.index0AttributeName):!0===o.morphTargets&&s.bindAttribLocation(S,0,"position"),s.linkProgram(S),e.debug.checkShaderErrors){var I=s.getProgramInfoLog(S).trim(),L=s.getShaderInfoLog(R).trim(),D=s.getShaderInfoLog(P).trim(),O=!0,k=!0;if(!1===s.getProgramParameter(S,35714)){O=!1;var F=it(s,R,"vertex"),B=it(s,P,"fragment");console.error("THREE.WebGLProgram: shader error: ",s.getError(),"35715",s.getProgramParameter(S,35715),"gl.getProgramInfoLog",I,F,B)}else""!==I?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",I):""!==L&&""!==D||(k=!1);k&&(this.diagnostics={runnable:O,material:i,programLog:I,vertexShader:{log:L,prefix:m},fragmentShader:{log:D,prefix:g}})}return s.deleteShader(R),s.deleteShader(P),this.getUniforms=function(){return void 0===M&&(M=new et(s,S)),M},this.getAttributes=function(){return void 0===C&&(C=function(e,t){for(var n={},i=e.getProgramParameter(t,35721),r=0;r<i;r++){var o=e.getActiveAttrib(t,r).name;n[o]=e.getAttribLocation(t,o)}return n}(s,S)),C},this.destroy=function(){s.deleteProgram(S),this.program=void 0},this.name=r.name,this.id=La++,this.code=n,this.usedTimes=1,this.program=S,this.vertexShader=R,this.fragmentShader=P,this}function dt(e,t,n){function i(e,t){var n;return e?e.isTexture?n=e.encoding:e.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),n=e.texture.encoding):n=3e3,3e3===n&&t&&(n=3007),n}var r=[],o={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},a=["precision","supportsVertexTextures","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","lightMap","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","fog","useFog","fogExp","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering"];this.getParameters=function(t,r,a,s,c,l,u){var h=o[t.type],d=u.isSkinnedMesh?function(e){var t=e.skeleton.bones;if(n.floatVertexTextures)return 1024;var i=n.maxVertexUniforms,r=Math.floor((i-20)/4),o=Math.min(r,t.length);return o<t.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+t.length+" bones. This GPU supports "+o+"."),0):o}(u):0,p=n.precision;null!==t.precision&&(p=n.getMaxPrecision(t.precision))!==t.precision&&console.warn("THREE.WebGLProgram.getParameters:",t.precision,"not supported, using",p,"instead.");var f=e.getRenderTarget();return{shaderID:h,precision:p,supportsVertexTextures:n.vertexTextures,outputEncoding:i(f?f.texture:null,e.gammaOutput),map:!!t.map,
mapEncoding:i(t.map,e.gammaInput),matcap:!!t.matcap,matcapEncoding:i(t.matcap,e.gammaInput),envMap:!!t.envMap,envMapMode:t.envMap&&t.envMap.mapping,envMapEncoding:i(t.envMap,e.gammaInput),envMapCubeUV:!!t.envMap&&(306===t.envMap.mapping||307===t.envMap.mapping),lightMap:!!t.lightMap,aoMap:!!t.aoMap,emissiveMap:!!t.emissiveMap,emissiveMapEncoding:i(t.emissiveMap,e.gammaInput),bumpMap:!!t.bumpMap,normalMap:!!t.normalMap,objectSpaceNormalMap:1===t.normalMapType,displacementMap:!!t.displacementMap,roughnessMap:!!t.roughnessMap,metalnessMap:!!t.metalnessMap,specularMap:!!t.specularMap,alphaMap:!!t.alphaMap,gradientMap:!!t.gradientMap,combine:t.combine,vertexTangents:t.normalMap&&t.vertexTangents,vertexColors:t.vertexColors,fog:!!s,useFog:t.fog,fogExp:s&&s.isFogExp2,flatShading:t.flatShading,sizeAttenuation:t.sizeAttenuation,logarithmicDepthBuffer:n.logarithmicDepthBuffer,skinning:t.skinning&&d>0,maxBones:d,useVertexTexture:n.floatVertexTextures,morphTargets:t.morphTargets,morphNormals:t.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,numDirLights:r.directional.length,numPointLights:r.point.length,numSpotLights:r.spot.length,numRectAreaLights:r.rectArea.length,numHemiLights:r.hemi.length,numClippingPlanes:c,numClipIntersection:l,dithering:t.dithering,shadowMapEnabled:e.shadowMap.enabled&&u.receiveShadow&&a.length>0,shadowMapType:e.shadowMap.type,toneMapping:e.toneMapping,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:t.premultipliedAlpha,alphaTest:t.alphaTest,doubleSided:2===t.side,flipSided:1===t.side,depthPacking:void 0!==t.depthPacking&&t.depthPacking}},this.getProgramCode=function(t,n){var i=[];if(n.shaderID?i.push(n.shaderID):(i.push(t.fragmentShader),i.push(t.vertexShader)),void 0!==t.defines)for(var r in t.defines)i.push(r),i.push(t.defines[r]);for(var o=0;o<a.length;o++)i.push(n[a[o]]);return i.push(t.onBeforeCompile.toString()),i.push(e.gammaOutput),i.push(e.gammaFactor),i.join()},this.acquireProgram=function(i,o,a,s){for(var c,l=0,u=r.length;l<u;l++){var h=r[l];if(h.code===s){++(c=h).usedTimes;break}}return void 0===c&&(c=new ht(e,t,s,i,o,a,n),r.push(c)),c},this.releaseProgram=function(e){if(0==--e.usedTimes){var t=r.indexOf(e);r[t]=r[r.length-1],r.pop(),e.destroy()}},this.programs=r}function pt(){var e=new WeakMap;return{get:function(t){var n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,i){e.get(t)[n]=i},dispose:function(){e=new WeakMap}}}function ft(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function mt(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function gt(){function e(e,i,r,a,s,c){var l=t[n];return void 0===l?(l={id:e.id,object:e,geometry:i,material:r,program:r.program||o,groupOrder:a,renderOrder:e.renderOrder,z:s,group:c},t[n]=l):(l.id=e.id,l.object=e,l.geometry=i,l.material=r,l.program=r.program||o,l.groupOrder=a,l.renderOrder=e.renderOrder,l.z=s,l.group=c),n++,l}var t=[],n=0,i=[],r=[],o={id:-1};return{opaque:i,transparent:r,init:function(){n=0,i.length=0,r.length=0},push:function(t,n,o,a,s,c){var l=e(t,n,o,a,s,c);(!0===o.transparent?r:i).push(l)},unshift:function(t,n,o,a,s,c){var l=e(t,n,o,a,s,c);(!0===o.transparent?r:i).unshift(l)},sort:function(){i.length>1&&i.sort(ft),r.length>1&&r.sort(mt)}}}function vt(){function e(n){var i=n.target;i.removeEventListener("dispose",e),delete t[i.id]}var t={};return{get:function(n,i){var r,o=t[n.id];return void 0===o?(r=new gt,t[n.id]={},t[n.id][i.id]=r,n.addEventListener("dispose",e)):void 0===(r=o[i.id])&&(r=new gt,o[i.id]=r),r},dispose:function(){t={}}}}function yt(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];var i;switch(t.type){case"DirectionalLight":i={direction:new r,color:new b,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new n};break;case"SpotLight":i={position:new r,direction:new r,color:new b,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new n};break;case"PointLight":i={position:new r,color:new b,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new n,shadowCameraNear:1,shadowCameraFar:1e3};break;case"HemisphereLight":i={direction:new r,skyColor:new b,groundColor:new b};break;case"RectAreaLight":i={color:new b,position:new r,halfWidth:new r,halfHeight:new r}}return e[t.id]=i,i}}}function bt(){for(var e=new yt,t={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,shadowsLength:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},n=0;n<9;n++)t.probe.push(new r);var i=new r,o=new u,a=new u;return{setup:function(n,r,s){for(var c=0,l=0,u=0,h=0;h<9;h++)t.probe[h].set(0,0,0);for(var d=0,p=0,f=0,m=0,g=0,v=s.matrixWorldInverse,y=(h=0,n.length);h<y;h++){var b=n[h],w=b.color,x=b.intensity,E=b.distance,S=b.shadow&&b.shadow.map?b.shadow.map.texture:null;if(b.isAmbientLight)c+=w.r*x,l+=w.g*x,u+=w.b*x;else if(b.isLightProbe)for(var _=0;_<9;_++)t.probe[_].addScaledVector(b.sh.coefficients[_],x);else if(b.isDirectionalLight){if((M=e.get(b)).color.copy(b.color).multiplyScalar(b.intensity),M.direction.setFromMatrixPosition(b.matrixWorld),i.setFromMatrixPosition(b.target.matrixWorld),M.direction.sub(i),M.direction.transformDirection(v),M.shadow=b.castShadow,b.castShadow){var T=b.shadow;M.shadowBias=T.bias,M.shadowRadius=T.radius,M.shadowMapSize=T.mapSize}t.directionalShadowMap[d]=S,t.directionalShadowMatrix[d]=b.shadow.matrix,t.directional[d]=M,d++}else if(b.isSpotLight)(M=e.get(b)).position.setFromMatrixPosition(b.matrixWorld),M.position.applyMatrix4(v),M.color.copy(w).multiplyScalar(x),M.distance=E,M.direction.setFromMatrixPosition(b.matrixWorld),i.setFromMatrixPosition(b.target.matrixWorld),M.direction.sub(i),M.direction.transformDirection(v),M.coneCos=Math.cos(b.angle),M.penumbraCos=Math.cos(b.angle*(1-b.penumbra)),M.decay=b.decay,M.shadow=b.castShadow,b.castShadow&&(T=b.shadow,M.shadowBias=T.bias,M.shadowRadius=T.radius,M.shadowMapSize=T.mapSize),t.spotShadowMap[f]=S,t.spotShadowMatrix[f]=b.shadow.matrix,t.spot[f]=M,f++;else if(b.isRectAreaLight)(M=e.get(b)).color.copy(w).multiplyScalar(x),M.position.setFromMatrixPosition(b.matrixWorld),M.position.applyMatrix4(v),a.identity(),o.copy(b.matrixWorld),o.premultiply(v),a.extractRotation(o),M.halfWidth.set(.5*b.width,0,0),M.halfHeight.set(0,.5*b.height,0),M.halfWidth.applyMatrix4(a),M.halfHeight.applyMatrix4(a),t.rectArea[m]=M,m++;else if(b.isPointLight)(M=e.get(b)).position.setFromMatrixPosition(b.matrixWorld),M.position.applyMatrix4(v),M.color.copy(b.color).multiplyScalar(b.intensity),M.distance=b.distance,M.decay=b.decay,M.shadow=b.castShadow,b.castShadow&&(T=b.shadow,M.shadowBias=T.bias,M.shadowRadius=T.radius,M.shadowMapSize=T.mapSize,M.shadowCameraNear=T.camera.near,M.shadowCameraFar=T.camera.far),t.pointShadowMap[p]=S,t.pointShadowMatrix[p]=b.shadow.matrix,t.point[p]=M,p++;else if(b.isHemisphereLight){var M;(M=e.get(b)).direction.setFromMatrixPosition(b.matrixWorld),M.direction.transformDirection(v),M.direction.normalize(),M.skyColor.copy(b.color).multiplyScalar(x),M.groundColor.copy(b.groundColor).multiplyScalar(x),t.hemi[g]=M,g++}}t.ambient[0]=c,t.ambient[1]=l,t.ambient[2]=u;var C=t.hash;C.directionalLength===d&&C.pointLength===p&&C.spotLength===f&&C.rectAreaLength===m&&C.hemiLength===g&&C.shadowsLength===r.length||(t.directional.length=d,t.spot.length=f,t.rectArea.length=m,t.point.length=p,t.hemi.length=g,C.directionalLength=d,C.pointLength=p,C.spotLength=f,C.rectAreaLength=m,C.hemiLength=g,C.shadowsLength=r.length,t.version=Da++)},state:t}}function wt(){var e=new bt,t=[],n=[];return{init:function(){t.length=0,n.length=0},state:{lightsArray:t,shadowsArray:n,lights:e},setupLights:function(i){e.setup(t,n,i)},pushLight:function(e){t.push(e)},pushShadow:function(e){n.push(e)}}}function xt(){function e(n){var i=n.target;i.removeEventListener("dispose",e),delete t[i.id]}var t={};return{get:function(n,i){var r;return void 0===t[n.id]?(r=new wt,t[n.id]={},t[n.id][i.id]=r,n.addEventListener("dispose",e)):void 0===t[n.id][i.id]?(r=new wt,t[n.id][i.id]=r):r=t[n.id][i.id],r},dispose:function(){t={}}}}function Et(e){_.call(this),this.type="MeshDepthMaterial",this.depthPacking=3200,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.setValues(e)}function St(e){_.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new r,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.lights=!1,this.setValues(e)}function _t(e,t,i){function o(t,n,i,r,o,a){var s=t.geometry,c=null,l=g,u=t.customDepthMaterial;if(i&&(l=v,u=t.customDistanceMaterial),u)c=u;else{var h=!1;n.morphTargets&&(s&&s.isBufferGeometry?h=s.morphAttributes&&s.morphAttributes.position&&s.morphAttributes.position.length>0:s&&s.isGeometry&&(h=s.morphTargets&&s.morphTargets.length>0)),t.isSkinnedMesh&&!1===n.skinning&&console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",t);var d=0;h&&(d|=1),t.isSkinnedMesh&&n.skinning&&(d|=2),c=l[d]}if(e.localClippingEnabled&&!0===n.clipShadows&&0!==n.clippingPlanes.length){var p=c.uuid,f=n.uuid,m=y[p];void 0===m&&(m={},y[p]=m);var w=m[f];void 0===w&&(w=c.clone(),m[f]=w),c=w}return c.visible=n.visible,c.wireframe=n.wireframe,c.side=null!=n.shadowSide?n.shadowSide:b[n.side],c.clipShadows=n.clipShadows,c.clippingPlanes=n.clippingPlanes,c.clipIntersection=n.clipIntersection,c.wireframeLinewidth=n.wireframeLinewidth,c.linewidth=n.linewidth,i&&c.isMeshDistanceMaterial&&(c.referencePosition.copy(r),c.nearDistance=o,c.farDistance=a),c}function a(n,i,r,s){if(!1!==n.visible){if(n.layers.test(i.layers)&&(n.isMesh||n.isLine||n.isPoints)&&n.castShadow&&(!n.frustumCulled||l.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,n.matrixWorld);var c=t.update(n),u=n.material;if(Array.isArray(u))for(var h=c.groups,d=0,p=h.length;d<p;d++){var f=h[d],g=u[f.materialIndex];if(g&&g.visible){var v=o(n,g,s,m,r.near,r.far);e.renderBufferDirect(r,null,c,v,n,f)}}else u.visible&&(v=o(n,u,s,m,r.near,r.far),e.renderBufferDirect(r,null,c,v,n,null))}for(var y=n.children,b=0,w=y.length;b<w;b++)a(y[b],i,r,s)}}for(var l=new Q,h=new u,d=new n,p=new n(i,i),f=new r,m=new r,g=new Array(4),v=new Array(4),y={},b={0:1,1:0,2:2},w=[new r(1,0,0),new r(-1,0,0),new r(0,0,1),new r(0,0,-1),new r(0,1,0),new r(0,-1,0)],x=[new r(0,1,0),new r(0,1,0),new r(0,1,0),new r(0,1,0),new r(0,0,1),new r(0,0,-1)],E=[new s,new s,new s,new s,new s,new s],S=0;4!==S;++S){var _=0!=(1&S),T=0!=(2&S),M=new Et({depthPacking:3201,morphTargets:_,skinning:T});g[S]=M;var C=new St({morphTargets:_,skinning:T});v[S]=C}var A=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(t,n,i){if(!1!==A.enabled&&(!1!==A.autoUpdate||!1!==A.needsUpdate)&&0!==t.length){var r,o=e.getRenderTarget(),s=e.getActiveCubeFace(),u=e.getActiveMipmapLevel(),g=e.state;g.setBlending(0),g.buffers.color.setClear(1,1,1,1),g.buffers.depth.setTest(!0),g.setScissorTest(!1);for(var v=0,y=t.length;v<y;v++){var b=t[v],S=b.shadow,_=b&&b.isPointLight;if(void 0!==S){var T=S.camera;if(d.copy(S.mapSize),d.min(p),_){var M=d.x,C=d.y;E[0].set(2*M,C,M,C),E[1].set(0,C,M,C),E[2].set(3*M,C,M,C),E[3].set(M,C,M,C),E[4].set(3*M,0,M,C),E[5].set(M,0,M,C),d.x*=4,d.y*=2}if(null===S.map){var R={minFilter:1003,magFilter:1003,format:1023};S.map=new c(d.x,d.y,R),S.map.texture.name=b.name+".shadowMap",T.updateProjectionMatrix()}S.isSpotLightShadow&&S.update(b);var P=S.map,I=S.matrix;m.setFromMatrixPosition(b.matrixWorld),T.position.copy(m),_?(r=6,I.makeTranslation(-m.x,-m.y,-m.z)):(r=1,f.setFromMatrixPosition(b.target.matrixWorld),T.lookAt(f),T.updateMatrixWorld(),I.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),I.multiply(T.projectionMatrix),I.multiply(T.matrixWorldInverse)),e.setRenderTarget(P),e.clear();for(var L=0;L<r;L++){if(_){f.copy(T.position),f.add(w[L]),T.up.copy(x[L]),T.lookAt(f),T.updateMatrixWorld();var D=E[L];g.viewport(D)}h.multiplyMatrices(T.projectionMatrix,T.matrixWorldInverse),l.setFromMatrix(h),a(n,i,T,_)}}else console.warn("THREE.WebGLShadowMap:",b,"has no shadow.")}A.needsUpdate=!1,e.setRenderTarget(o,s,u)}}}function Tt(e,t,n,i){function r(t,n,i){var r=new Uint8Array(4),o=e.createTexture();e.bindTexture(t,o),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(var a=0;a<i;a++)e.texImage2D(n+a,0,6408,1,1,0,6408,5121,r);return o}function o(n,r){y[n]=1,0===b[n]&&(e.enableVertexAttribArray(n),b[n]=1),w[n]!==r&&((i.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,r),w[n]=r)}function a(t){!0!==x[t]&&(e.enable(t),x[t]=!0)}function c(t){!1!==x[t]&&(e.disable(t),x[t]=!1)}function l(t,i,r,o,s,l,u,h){if(0!==t){if(_||(a(3042),_=!0),5===t)s=s||i,l=l||r,u=u||o,i===M&&s===R||(e.blendEquationSeparate(n.convert(i),n.convert(s)),M=i,R=s),r===C&&o===A&&l===P&&u===I||(e.blendFuncSeparate(n.convert(r),n.convert(o),n.convert(l),n.convert(u)),C=r,A=o,P=l,I=u),T=t,L=null;else if(t!==T||h!==L){if(100===M&&100===R||(e.blendEquation(32774),M=100,R=100),h)switch(t){case 1:e.blendFuncSeparate(1,771,1,771);break;case 2:e.blendFunc(1,1);break;case 3:e.blendFuncSeparate(0,0,769,771);break;case 4:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case 1:e.blendFuncSeparate(770,771,1,771);break;case 2:e.blendFunc(770,1);break;case 3:e.blendFunc(0,769);break;case 4:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}C=null,A=null,P=null,I=null,T=t,L=h}}else _&&(c(3042),_=!1)}function u(t){D!==t&&(t?e.frontFace(2304):e.frontFace(2305),D=t)}function h(t){0!==t?(a(2884),t!==O&&(1===t?e.cullFace(1029):2===t?e.cullFace(1028):e.cullFace(1032))):c(2884),O=t}function d(t,n,i){t?(a(32823),F===n&&B===i||(e.polygonOffset(n,i),F=n,B=i)):c(32823)}function p(t){void 0===t&&(t=33984+N-1),H!==t&&(e.activeTexture(t),H=t)}var f=new function(){var t=!1,n=new s,i=null,r=new s(0,0,0,0);return{setMask:function(n){i===n||t||(e.colorMask(n,n,n,n),i=n)},setLocked:function(e){t=e},setClear:function(t,i,o,a,s){!0===s&&(t*=a,i*=a,o*=a),n.set(t,i,o,a),!1===r.equals(n)&&(e.clearColor(t,i,o,a),r.copy(n))},reset:function(){t=!1,i=null,r.set(-1,0,0,0)}}},m=new function(){var t=!1,n=null,i=null,r=null;return{setTest:function(e){e?a(2929):c(2929)},setMask:function(i){n===i||t||(e.depthMask(i),n=i)},setFunc:function(t){if(i!==t){if(t)switch(t){case 0:e.depthFunc(512);break;case 1:e.depthFunc(519);break;case 2:e.depthFunc(513);break;case 3:e.depthFunc(515);break;case 4:e.depthFunc(514);break;case 5:e.depthFunc(518);break;case 6:e.depthFunc(516);break;case 7:e.depthFunc(517);break;default:e.depthFunc(515)}else e.depthFunc(515);i=t}},setLocked:function(e){t=e},setClear:function(t){r!==t&&(e.clearDepth(t),r=t)},reset:function(){t=!1,n=null,i=null,r=null}}},g=new function(){var t=!1,n=null,i=null,r=null,o=null,s=null,l=null,u=null,h=null;return{setTest:function(e){e?a(2960):c(2960)},setMask:function(i){n===i||t||(e.stencilMask(i),n=i)},setFunc:function(t,n,a){i===t&&r===n&&o===a||(e.stencilFunc(t,n,a),i=t,r=n,o=a)},setOp:function(t,n,i){s===t&&l===n&&u===i||(e.stencilOp(t,n,i),s=t,l=n,u=i)},setLocked:function(e){t=e},setClear:function(t){h!==t&&(e.clearStencil(t),h=t)},reset:function(){t=!1,n=null,i=null,r=null,o=null,s=null,l=null,u=null,h=null}}},v=e.getParameter(34921),y=new Uint8Array(v),b=new Uint8Array(v),w=new Uint8Array(v),x={},E=null,S=null,_=null,T=null,M=null,C=null,A=null,R=null,P=null,I=null,L=!1,D=null,O=null,k=null,F=null,B=null,N=e.getParameter(35661),U=!1,z=0,G=e.getParameter(7938);-1!==G.indexOf("WebGL")?(z=parseFloat(/^WebGL\ ([0-9])/.exec(G)[1]),U=z>=1):-1!==G.indexOf("OpenGL ES")&&(z=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(G)[1]),U=z>=2);var H=null,j={},V=new s,W=new s,X={};return X[3553]=r(3553,3553,1),X[34067]=r(34067,34069,6),f.setClear(0,0,0,1),m.setClear(1),g.setClear(0),a(2929),m.setFunc(3),u(!1),h(1),a(2884),l(0),{buffers:{color:f,depth:m,stencil:g},initAttributes:function(){for(var e=0,t=y.length;e<t;e++)y[e]=0},enableAttribute:function(e){o(e,0)},enableAttributeAndDivisor:o,disableUnusedAttributes:function(){for(var t=0,n=b.length;t!==n;++t)b[t]!==y[t]&&(e.disableVertexAttribArray(t),b[t]=0)},enable:a,disable:c,getCompressedTextureFormats:function(){if(null===E&&(E=[],t.get("WEBGL_compressed_texture_pvrtc")||t.get("WEBGL_compressed_texture_s3tc")||t.get("WEBGL_compressed_texture_etc1")||t.get("WEBGL_compressed_texture_astc")))for(var n=e.getParameter(34467),i=0;i<n.length;i++)E.push(n[i]);return E},useProgram:function(t){return S!==t&&(e.useProgram(t),S=t,!0)},setBlending:l,setMaterial:function(e,t){2===e.side?c(2884):a(2884);var n=1===e.side;t&&(n=!n),u(n),1===e.blending&&!1===e.transparent?l(0):l(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),m.setFunc(e.depthFunc),m.setTest(e.depthTest),m.setMask(e.depthWrite),f.setMask(e.colorWrite);var i=e.stencilWrite;g.setTest(i),i&&(g.setFunc(e.stencilFunc,e.stencilRef,e.stencilMask),g.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),d(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)},setFlipSided:u,setCullFace:h,setLineWidth:function(t){t!==k&&(U&&e.lineWidth(t),k=t)},setPolygonOffset:d,setScissorTest:function(e){e?a(3089):c(3089)},activeTexture:p,bindTexture:function(t,n){null===H&&p();var i=j[H];void 0===i&&(i={type:void 0,texture:void 0},j[H]=i),i.type===t&&i.texture===n||(e.bindTexture(t,n||X[t]),i.type=t,i.texture=n)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===V.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),V.copy(t))},viewport:function(t){!1===W.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),W.copy(t))},reset:function(){for(var t=0;t<b.length;t++)1===b[t]&&(e.disableVertexAttribArray(t),b[t]=0);x={},E=null,H=null,j={},S=null,T=null,D=null,O=null,f.reset(),m.reset(),g.reset()}}}function Mt(e,t,n,i,r,o,a){function s(e,t){return A?new OffscreenCanvas(e,t):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function c(e,t,n,i){var r=1;if((e.width>i||e.height>i)&&(r=i/Math.max(e.width,e.height)),r<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){var o=t?Co.floorPowerOfTwo:Math.floor,a=o(r*e.width),c=o(r*e.height);void 0===M&&(M=s(a,c));var l=n?s(a,c):M;return l.width=a,l.height=c,l.getContext("2d").drawImage(e,0,0,a,c),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+a+"x"+c+")."),l}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function l(e){return Co.isPowerOfTwo(e.width)&&Co.isPowerOfTwo(e.height)}function u(e,t){return e.generateMipmaps&&t&&1003!==e.minFilter&&1006!==e.minFilter}function h(t,n,r,o){e.generateMipmap(t),i.get(n).__maxMipLevel=Math.log(Math.max(r,o))*Math.LOG2E}function d(e,n){if(!r.isWebGL2)return e;var i=e;return 6403===e&&(5126===n&&(i=33326),5131===n&&(i=33325),5121===n&&(i=33321)),6407===e&&(5126===n&&(i=34837),5131===n&&(i=34843),5121===n&&(i=32849)),6408===e&&(5126===n&&(i=34836),5131===n&&(i=34842),5121===n&&(i=32856)),33325===i||33326===i||34842===i||34836===i?t.get("EXT_color_buffer_float"):34843!==i&&34837!==i||console.warn("THREE.WebGLRenderer: Floating point textures with RGB format not supported. Please use RGBA instead."),i}function p(e){return 1003===e||1004===e||1005===e?9728:9729}function f(t){var n=t.target;n.removeEventListener("dispose",f),function(t){var n=i.get(t);void 0!==n.__webglInit&&(e.deleteTexture(n.__webglTexture),i.remove(t))}(n),n.isVideoTexture&&delete C[n.id],a.memory.textures--}function m(t){var n=t.target;n.removeEventListener("dispose",m),function(t){var n=i.get(t),r=i.get(t.texture);if(t){if(void 0!==r.__webglTexture&&e.deleteTexture(r.__webglTexture),t.depthTexture&&t.depthTexture.dispose(),t.isWebGLRenderTargetCube)for(var o=0;o<6;o++)e.deleteFramebuffer(n.__webglFramebuffer[o]),n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer[o]);else e.deleteFramebuffer(n.__webglFramebuffer),n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer);i.remove(t.texture),i.remove(t)}}(n),a.memory.textures--}function g(e,t){var r=i.get(e);if(e.isVideoTexture&&function(e){var t=e.id,n=a.render.frame;C[t]!==n&&(C[t]=n,e.update())}(e),e.version>0&&r.__version!==e.version){var o=e.image;if(void 0===o)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==o.complete)return void x(r,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.activeTexture(33984+t),n.bindTexture(3553,r.__webglTexture)}function v(t,a){var s=i.get(t);if(6===t.image.length)if(t.version>0&&s.__version!==t.version){w(s,t),n.activeTexture(33984+a),n.bindTexture(34067,s.__webglTexture),e.pixelStorei(37440,t.flipY);for(var p=t&&t.isCompressedTexture,f=t.image[0]&&t.image[0].isDataTexture,m=[],g=0;g<6;g++)m[g]=p||f?f?t.image[g].image:t.image[g]:c(t.image[g],!1,!0,r.maxCubemapSize);var v=m[0],y=l(v)||r.isWebGL2,x=o.convert(t.format),E=o.convert(t.type),S=d(x,E);for(b(34067,t,y),g=0;g<6;g++)if(p)for(var _,T=m[g].mipmaps,M=0,C=T.length;M<C;M++)_=T[M],1023!==t.format&&1022!==t.format?n.getCompressedTextureFormats().indexOf(x)>-1?n.compressedTexImage2D(34069+g,M,S,_.width,_.height,0,_.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):n.texImage2D(34069+g,M,S,_.width,_.height,0,x,E,_.data);else f?n.texImage2D(34069+g,0,S,m[g].width,m[g].height,0,x,E,m[g].data):n.texImage2D(34069+g,0,S,x,E,m[g]);s.__maxMipLevel=p?T.length-1:0,u(t,y)&&h(34067,t,v.width,v.height),s.__version=t.version,t.onUpdate&&t.onUpdate(t)}else n.activeTexture(33984+a),n.bindTexture(34067,s.__webglTexture)}function y(e,t){n.activeTexture(33984+t),n.bindTexture(34067,i.get(e).__webglTexture)}function b(n,a,s){var c;if(s?(e.texParameteri(n,10242,o.convert(a.wrapS)),e.texParameteri(n,10243,o.convert(a.wrapT)),32879!==n&&35866!==n||e.texParameteri(n,32882,o.convert(a.wrapR)),e.texParameteri(n,10240,o.convert(a.magFilter)),e.texParameteri(n,10241,o.convert(a.minFilter))):(e.texParameteri(n,10242,33071),e.texParameteri(n,10243,33071),32879!==n&&35866!==n||e.texParameteri(n,32882,33071),1001===a.wrapS&&1001===a.wrapT||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(n,10240,p(a.magFilter)),e.texParameteri(n,10241,p(a.minFilter)),1003!==a.minFilter&&1006!==a.minFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),c=t.get("EXT_texture_filter_anisotropic")){if(1015===a.type&&null===t.get("OES_texture_float_linear"))return;if(1016===a.type&&null===(r.isWebGL2||t.get("OES_texture_half_float_linear")))return;(a.anisotropy>1||i.get(a).__currentAnisotropy)&&(e.texParameterf(n,c.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(a.anisotropy,r.getMaxAnisotropy())),i.get(a).__currentAnisotropy=a.anisotropy)}}function w(t,n){void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",f),t.__webglTexture=e.createTexture(),a.memory.textures++)}function x(t,i,a){var s=3553;i.isDataTexture2DArray&&(s=35866),i.isDataTexture3D&&(s=32879),w(t,i),n.activeTexture(33984+a),n.bindTexture(s,t.__webglTexture),e.pixelStorei(37440,i.flipY),e.pixelStorei(37441,i.premultiplyAlpha),e.pixelStorei(3317,i.unpackAlignment);var p=function(e){return!r.isWebGL2&&(1001!==e.wrapS||1001!==e.wrapT||1003!==e.minFilter&&1006!==e.minFilter)}(i)&&!1===l(i.image),f=c(i.image,p,!1,r.maxTextureSize),m=l(f)||r.isWebGL2,g=o.convert(i.format),v=o.convert(i.type),y=d(g,v);b(s,i,m);var x,E=i.mipmaps;if(i.isDepthTexture){if(y=6402,1015===i.type){if(!r.isWebGL2)throw new Error("Float Depth Texture only supported in WebGL2.0");y=36012}else r.isWebGL2&&(y=33189);1026===i.format&&6402===y&&1012!==i.type&&1014!==i.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),i.type=1012,v=o.convert(i.type)),1027===i.format&&(y=34041,1020!==i.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),i.type=1020,v=o.convert(i.type))),n.texImage2D(3553,0,y,f.width,f.height,0,g,v,null)}else if(i.isDataTexture)if(E.length>0&&m){for(var S=0,_=E.length;S<_;S++)x=E[S],n.texImage2D(3553,S,y,x.width,x.height,0,g,v,x.data);i.generateMipmaps=!1,t.__maxMipLevel=E.length-1}else n.texImage2D(3553,0,y,f.width,f.height,0,g,v,f.data),t.__maxMipLevel=0;else if(i.isCompressedTexture){for(S=0,_=E.length;S<_;S++)x=E[S],1023!==i.format&&1022!==i.format?n.getCompressedTextureFormats().indexOf(g)>-1?n.compressedTexImage2D(3553,S,y,x.width,x.height,0,x.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texImage2D(3553,S,y,x.width,x.height,0,g,v,x.data);t.__maxMipLevel=E.length-1}else if(i.isDataTexture2DArray)n.texImage3D(35866,0,y,f.width,f.height,f.depth,0,g,v,f.data),t.__maxMipLevel=0;else if(i.isDataTexture3D)n.texImage3D(32879,0,y,f.width,f.height,f.depth,0,g,v,f.data),t.__maxMipLevel=0;else if(E.length>0&&m){for(S=0,_=E.length;S<_;S++)x=E[S],n.texImage2D(3553,S,y,g,v,x);i.generateMipmaps=!1,t.__maxMipLevel=E.length-1}else n.texImage2D(3553,0,y,g,v,f),t.__maxMipLevel=0;u(i,m)&&h(3553,i,f.width,f.height),t.__version=i.version,i.onUpdate&&i.onUpdate(i)}function E(t,r,a,s){var c=o.convert(r.texture.format),l=o.convert(r.texture.type),u=d(c,l);n.texImage2D(s,0,u,r.width,r.height,0,c,l,null),e.bindFramebuffer(36160,t),e.framebufferTexture2D(36160,a,s,i.get(r.texture).__webglTexture,0),e.bindFramebuffer(36160,null)}function S(t,n,i){if(e.bindRenderbuffer(36161,t),n.depthBuffer&&!n.stencilBuffer){if(i){var r=T(n);e.renderbufferStorageMultisample(36161,r,33189,n.width,n.height)}else e.renderbufferStorage(36161,33189,n.width,n.height);e.framebufferRenderbuffer(36160,36096,36161,t)}else if(n.depthBuffer&&n.stencilBuffer)i?(r=T(n),e.renderbufferStorageMultisample(36161,r,35056,n.width,n.height)):e.renderbufferStorage(36161,34041,n.width,n.height),e.framebufferRenderbuffer(36160,33306,36161,t);else{var a=d(o.convert(n.texture.format),o.convert(n.texture.type));i?(r=T(n),e.renderbufferStorageMultisample(36161,r,a,n.width,n.height)):e.renderbufferStorage(36161,a,n.width,n.height)}e.bindRenderbuffer(36161,null)}function _(t){var n=i.get(t),r=!0===t.isWebGLRenderTargetCube;if(t.depthTexture){if(r)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,n){if(n&&n.isWebGLRenderTargetCube)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(36160,t),!n.depthTexture||!n.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");i.get(n.depthTexture).__webglTexture&&n.depthTexture.image.width===n.width&&n.depthTexture.image.height===n.height||(n.depthTexture.image.width=n.width,n.depthTexture.image.height=n.height,n.depthTexture.needsUpdate=!0),g(n.depthTexture,0);var r=i.get(n.depthTexture).__webglTexture;if(1026===n.depthTexture.format)e.framebufferTexture2D(36160,36096,3553,r,0);else{if(1027!==n.depthTexture.format)throw new Error("Unknown depthTexture format");e.framebufferTexture2D(36160,33306,3553,r,0)}}(n.__webglFramebuffer,t)}else if(r){n.__webglDepthbuffer=[];for(var o=0;o<6;o++)e.bindFramebuffer(36160,n.__webglFramebuffer[o]),n.__webglDepthbuffer[o]=e.createRenderbuffer(),S(n.__webglDepthbuffer[o],t)}else e.bindFramebuffer(36160,n.__webglFramebuffer),n.__webglDepthbuffer=e.createRenderbuffer(),S(n.__webglDepthbuffer,t);e.bindFramebuffer(36160,null)}function T(e){return r.isWebGL2&&e.isWebGLMultisampleRenderTarget?Math.min(r.maxSamples,e.samples):0}var M,C={},A="undefined"!=typeof OffscreenCanvas,R=0,P=!1,I=!1;this.allocateTextureUnit=function(){var e=R;return e>=r.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+r.maxTextures),R+=1,e},this.resetTextureUnits=function(){R=0},this.setTexture2D=g,this.setTexture2DArray=function(e,t){var r=i.get(e);e.version>0&&r.__version!==e.version?x(r,e,t):(n.activeTexture(33984+t),n.bindTexture(35866,r.__webglTexture))},this.setTexture3D=function(e,t){var r=i.get(e);e.version>0&&r.__version!==e.version?x(r,e,t):(n.activeTexture(33984+t),n.bindTexture(32879,r.__webglTexture))},this.setTextureCube=v,this.setTextureCubeDynamic=y,this.setupRenderTarget=function(t){var s=i.get(t),c=i.get(t.texture);t.addEventListener("dispose",m),c.__webglTexture=e.createTexture(),a.memory.textures++;var p=!0===t.isWebGLRenderTargetCube,f=!0===t.isWebGLMultisampleRenderTarget,g=l(t)||r.isWebGL2;if(p){s.__webglFramebuffer=[];for(var v=0;v<6;v++)s.__webglFramebuffer[v]=e.createFramebuffer()}else if(s.__webglFramebuffer=e.createFramebuffer(),f)if(r.isWebGL2){s.__webglMultisampledFramebuffer=e.createFramebuffer(),s.__webglColorRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,s.__webglColorRenderbuffer);var y=d(o.convert(t.texture.format),o.convert(t.texture.type)),w=T(t);e.renderbufferStorageMultisample(36161,w,y,t.width,t.height),e.bindFramebuffer(36160,s.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064,36161,s.__webglColorRenderbuffer),e.bindRenderbuffer(36161,null),t.depthBuffer&&(s.__webglDepthRenderbuffer=e.createRenderbuffer(),S(s.__webglDepthRenderbuffer,t,!0)),e.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(p){for(n.bindTexture(34067,c.__webglTexture),b(34067,t.texture,g),v=0;v<6;v++)E(s.__webglFramebuffer[v],t,36064,34069+v);u(t.texture,g)&&h(34067,t.texture,t.width,t.height),n.bindTexture(34067,null)}else n.bindTexture(3553,c.__webglTexture),b(3553,t.texture,g),E(s.__webglFramebuffer,t,36064,3553),u(t.texture,g)&&h(3553,t.texture,t.width,t.height),n.bindTexture(3553,null);t.depthBuffer&&_(t)},this.updateRenderTargetMipmap=function(e){var t=e.texture;if(u(t,l(e)||r.isWebGL2)){var o=e.isWebGLRenderTargetCube?34067:3553,a=i.get(t).__webglTexture;n.bindTexture(o,a),h(o,t,e.width,e.height),n.bindTexture(o,null)}},this.updateMultisampleRenderTarget=function(t){if(t.isWebGLMultisampleRenderTarget)if(r.isWebGL2){var n=i.get(t);e.bindFramebuffer(36008,n.__webglMultisampledFramebuffer),e.bindFramebuffer(36009,n.__webglFramebuffer);var o=t.width,a=t.height,s=16384;t.depthBuffer&&(s|=256),t.stencilBuffer&&(s|=1024),e.blitFramebuffer(0,0,o,a,0,0,o,a,s,9728)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(e,t){
e&&e.isWebGLRenderTarget&&(!1===P&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),P=!0),e=e.texture),g(e,t)},this.safeSetTextureCube=function(e,t){e&&e.isWebGLRenderTargetCube&&(!1===I&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),I=!0),e=e.texture),e&&e.isCubeTexture||Array.isArray(e.image)&&6===e.image.length?v(e,t):y(e,t)}}function Ct(e,t,n){return{convert:function(e){var i;if(1e3===e)return 10497;if(1001===e)return 33071;if(1002===e)return 33648;if(1003===e)return 9728;if(1004===e)return 9984;if(1005===e)return 9986;if(1006===e)return 9729;if(1007===e)return 9985;if(1008===e)return 9987;if(1009===e)return 5121;if(1017===e)return 32819;if(1018===e)return 32820;if(1019===e)return 33635;if(1010===e)return 5120;if(1011===e)return 5122;if(1012===e)return 5123;if(1013===e)return 5124;if(1014===e)return 5125;if(1015===e)return 5126;if(1016===e){if(n.isWebGL2)return 5131;if(null!==(i=t.get("OES_texture_half_float")))return i.HALF_FLOAT_OES}if(1021===e)return 6406;if(1022===e)return 6407;if(1023===e)return 6408;if(1024===e)return 6409;if(1025===e)return 6410;if(1026===e)return 6402;if(1027===e)return 34041;if(1028===e)return 6403;if(100===e)return 32774;if(101===e)return 32778;if(102===e)return 32779;if(200===e)return 0;if(201===e)return 1;if(202===e)return 768;if(203===e)return 769;if(204===e)return 770;if(205===e)return 771;if(206===e)return 772;if(207===e)return 773;if(208===e)return 774;if(209===e)return 775;if(210===e)return 776;if((33776===e||33777===e||33778===e||33779===e)&&null!==(i=t.get("WEBGL_compressed_texture_s3tc"))){if(33776===e)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===e)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===e)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===e)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}if((35840===e||35841===e||35842===e||35843===e)&&null!==(i=t.get("WEBGL_compressed_texture_pvrtc"))){if(35840===e)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===e)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===e)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===e)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===e&&null!==(i=t.get("WEBGL_compressed_texture_etc1")))return i.COMPRESSED_RGB_ETC1_WEBGL;if((37808===e||37809===e||37810===e||37811===e||37812===e||37813===e||37814===e||37815===e||37816===e||37817===e||37818===e||37819===e||37820===e||37821===e)&&null!==(i=t.get("WEBGL_compressed_texture_astc")))return e;if(103===e||104===e){if(n.isWebGL2){if(103===e)return 32775;if(104===e)return 32776}if(null!==(i=t.get("EXT_blend_minmax"))){if(103===e)return i.MIN_EXT;if(104===e)return i.MAX_EXT}}if(1020===e){if(n.isWebGL2)return 34042;if(null!==(i=t.get("WEBGL_depth_texture")))return i.UNSIGNED_INT_24_8_WEBGL}return 0}}}function At(){p.call(this),this.type="Group"}function Rt(e){q.call(this),this.cameras=e||[]}function Pt(e,t,n){za.setFromMatrixPosition(t.matrixWorld),Ga.setFromMatrixPosition(n.matrixWorld);var i=za.distanceTo(Ga),r=t.projectionMatrix.elements,o=n.projectionMatrix.elements,a=r[14]/(r[10]-1),s=r[14]/(r[10]+1),c=(r[9]+1)/r[5],l=(r[9]-1)/r[5],u=(r[8]-1)/r[0],h=(o[8]+1)/o[0],d=a*u,p=a*h,f=i/(-u+h),m=f*-u;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(f),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.getInverse(e.matrixWorld);var g=a+f,v=s+f,y=d-m,b=p+(i-m),w=c*s/v*g,x=l*s/v*g;e.projectionMatrix.makePerspective(y,b,w,x,g,v)}function It(e){function t(){return null!==p&&!0===p.isPresenting}function o(){if(t()){var n=p.getEyeParameters("left");l=2*n.renderWidth*b,h=n.renderHeight*b,C=e.getPixelRatio(),e.getSize(A),e.setDrawingBufferSize(l,h,1),_.viewport.set(0,0,l/2,h),T.viewport.set(l/2,0,l/2,h),P.start(),d.dispatchEvent({type:"sessionstart"})}else d.enabled&&e.setDrawingBufferSize(A.width,A.height,C),P.stop(),d.dispatchEvent({type:"sessionend"})}function a(e){for(var t=navigator.getGamepads&&navigator.getGamepads(),n=0,i=0,r=t.length;n<r;n++){var o=t[n];if(o&&("Daydream Controller"===o.id||"Gear VR Controller"===o.id||"Oculus Go Controller"===o.id||"OpenVR Gamepad"===o.id||o.id.startsWith("Oculus Touch")||o.id.startsWith("HTC Vive Focus")||o.id.startsWith("Spatial Controller"))){if(i===e)return o;i++}}}function c(e,t){null!==t&&4===t.length&&e.set(t[0]*l,t[1]*h,t[2]*l,t[3]*h)}var l,h,d=this,p=null,f=null,m=null,g=[],v=new u,y=new u,b=1,w="local-floor";"undefined"!=typeof window&&"VRFrameData"in window&&(f=new window.VRFrameData,window.addEventListener("vrdisplaypresentchange",o,!1));var x=new u,E=new i,S=new r,_=new q;_.viewport=new s,_.layers.enable(1);var T=new q;T.viewport=new s,T.layers.enable(2);var M=new Rt([_,T]);M.layers.enable(1),M.layers.enable(2);var C,A=new n,R=[];this.enabled=!1,this.getController=function(e){var t=g[e];return void 0===t&&((t=new At).matrixAutoUpdate=!1,t.visible=!1,g[e]=t),t},this.getDevice=function(){return p},this.setDevice=function(e){void 0!==e&&(p=e),P.setContext(e)},this.setFramebufferScaleFactor=function(e){b=e},this.setReferenceSpaceType=function(e){w=e},this.setPoseTarget=function(e){void 0!==e&&(m=e)},this.getCamera=function(e){var n="local-floor"===w?1.6:0;if(!1===t())return e.position.set(0,n,0),e.rotation.set(0,0,0),e;if(p.depthNear=e.near,p.depthFar=e.far,p.getFrameData(f),"local-floor"===w){var i=p.stageParameters;i?v.fromArray(i.sittingToStandingTransform):v.makeTranslation(0,n,0)}var r=f.pose,o=null!==m?m:e;o.matrix.copy(v),o.matrix.decompose(o.position,o.quaternion,o.scale),null!==r.orientation&&(E.fromArray(r.orientation),o.quaternion.multiply(E)),null!==r.position&&(E.setFromRotationMatrix(v),S.fromArray(r.position),S.applyQuaternion(E),o.position.add(S)),o.updateMatrixWorld(),_.near=e.near,T.near=e.near,_.far=e.far,T.far=e.far,_.matrixWorldInverse.fromArray(f.leftViewMatrix),T.matrixWorldInverse.fromArray(f.rightViewMatrix),y.getInverse(v),"local-floor"===w&&(_.matrixWorldInverse.multiply(y),T.matrixWorldInverse.multiply(y));var s=o.parent;null!==s&&(x.getInverse(s.matrixWorld),_.matrixWorldInverse.multiply(x),T.matrixWorldInverse.multiply(x)),_.matrixWorld.getInverse(_.matrixWorldInverse),T.matrixWorld.getInverse(T.matrixWorldInverse),_.projectionMatrix.fromArray(f.leftProjectionMatrix),T.projectionMatrix.fromArray(f.rightProjectionMatrix),Pt(M,_,T);var l=p.getLayers();if(l.length){var u=l[0];c(_.viewport,u.leftBounds),c(T.viewport,u.rightBounds)}return function(){for(var e=0;e<g.length;e++){var t=g[e],n=a(e);if(void 0!==n&&void 0!==n.pose){if(null===n.pose)return;var i=n.pose;!1===i.hasPosition&&t.position.set(.2,-.6,-.05),null!==i.position&&t.position.fromArray(i.position),null!==i.orientation&&t.quaternion.fromArray(i.orientation),t.matrix.compose(t.position,t.quaternion,t.scale),t.matrix.premultiply(v),t.matrix.decompose(t.position,t.quaternion,t.scale),t.matrixWorldNeedsUpdate=!0,t.visible=!0;var r="Daydream Controller"===n.id?0:1;void 0===R[e]&&(R[e]=!1),R[e]!==n.buttons[r].pressed&&(R[e]=n.buttons[r].pressed,!0===R[e]?t.dispatchEvent({type:"selectstart"}):(t.dispatchEvent({type:"selectend"}),t.dispatchEvent({type:"select"})))}else t.visible=!1}}(),M},this.getStandingMatrix=function(){return v},this.isPresenting=t;var P=new $;this.setAnimationLoop=function(e){P.setAnimationLoop(e),t()&&P.start()},this.submitFrame=function(){t()&&p.submitFrame()},this.dispose=function(){"undefined"!=typeof window&&window.removeEventListener("vrdisplaypresentchange",o)},this.setFrameOfReferenceType=function(){console.warn("THREE.WebVRManager: setFrameOfReferenceType() has been deprecated.")}}function Lt(e,t){function n(){return null!==l&&null!==h}function i(e){for(var t=0;t<f.length;t++)m[t]===e.inputSource&&f[t].dispatchEvent({type:e.type})}function r(){e.setFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),w.stop(),c.dispatchEvent({type:"sessionend"})}function o(e){h=e,w.setContext(l),w.start(),c.dispatchEvent({type:"sessionstart"})}function a(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.getInverse(e.matrixWorld)}var c=this,l=null,h=null,d="local-floor",p=null,f=[],m=[],g=new q;g.layers.enable(1),g.viewport=new s;var v=new q;v.layers.enable(2),v.viewport=new s;var y=new Rt([g,v]);y.layers.enable(1),y.layers.enable(2),this.enabled=!1,this.getController=function(e){var t=f[e];return void 0===t&&((t=new At).matrixAutoUpdate=!1,t.visible=!1,f[e]=t),t},this.setFramebufferScaleFactor=function(e){},this.setReferenceSpaceType=function(e){d=e},this.getSession=function(){return l},this.setSession=function(e){null!==(l=e)&&(l.addEventListener("select",i),l.addEventListener("selectstart",i),l.addEventListener("selectend",i),l.addEventListener("end",r),l.updateRenderState({baseLayer:new XRWebGLLayer(l,t)}),l.requestReferenceSpace(d).then(o),m=l.inputSources,l.addEventListener("inputsourceschange",function(){m=l.inputSources,console.log(m);for(var e=0;e<f.length;e++)f[e].userData.inputSource=m[e]}))},this.getCamera=function(e){if(n()){var t=e.parent,i=y.cameras;a(y,t);for(var r=0;r<i.length;r++)a(i[r],t);e.matrixWorld.copy(y.matrixWorld);for(var o=e.children,s=(r=0,o.length);r<s;r++)o[r].updateMatrixWorld(!0);return Pt(y,g,v),y}return e},this.isPresenting=n;var b=null,w=new $;w.setAnimationLoop(function(t,n){if(null!==(p=n.getViewerPose(h))){var i=p.views,r=l.renderState.baseLayer;e.setFramebuffer(r.framebuffer);for(var o=0;o<i.length;o++){var a=i[o],s=r.getViewport(a),c=a.transform.inverse.matrix,u=y.cameras[o];u.matrix.fromArray(c).getInverse(u.matrix),u.projectionMatrix.fromArray(a.projectionMatrix),u.viewport.set(s.x,s.y,s.width,s.height),0===o&&y.matrix.copy(u.matrix)}}for(o=0;o<f.length;o++){var d=f[o],g=m[o];if(g){var v=n.getPose(g.targetRaySpace,h);if(null!==v){d.matrix.fromArray(v.transform.matrix),d.matrix.decompose(d.position,d.rotation,d.scale),d.visible=!0;continue}}d.visible=!1}b&&b(t)}),this.setAnimationLoop=function(e){b=e},this.dispose=function(){},this.getStandingMatrix=function(){return console.warn("THREE.WebXRManager: getStandingMatrix() is no longer needed."),new u},this.getDevice=function(){console.warn("THREE.WebXRManager: getDevice() has been deprecated.")},this.setDevice=function(){console.warn("THREE.WebXRManager: setDevice() has been deprecated.")},this.setFrameOfReferenceType=function(){console.warn("THREE.WebXRManager: setFrameOfReferenceType() has been deprecated.")},this.submitFrame=function(){}}function Dt(e){function t(){return null===me?Me:1}function i(){L=new se(I),(D=new oe(I,L,e)).isWebGL2||(L.get("WEBGL_depth_texture"),L.get("OES_texture_float"),L.get("OES_texture_half_float"),L.get("OES_texture_half_float_linear"),L.get("OES_standard_derivatives"),L.get("OES_element_index_uint"),L.get("ANGLE_instanced_arrays")),L.get("OES_texture_float_linear"),J=new Ct(I,L,D),(O=new Tt(I,L,J,D)).scissor(Ee.copy(Ae).multiplyScalar(Me).floor()),O.viewport(xe.copy(Ce).multiplyScalar(Me).floor()),k=new ue(I),F=new pt,B=new Mt(I,L,O,F,D,J,k),N=new ee(I),U=new ce(I,N,k),z=new pe(U,k),X=new de(I),G=new dt(Z,L,D),H=new vt,V=new xt,W=new ie(Z,O,z,T),q=new re(I,L,k,D),Y=new le(I,L,k,D),k.programs=G.programs,Z.capabilities=D,Z.extensions=L,Z.properties=F,Z.renderLists=H,Z.state=O,Z.info=k}function o(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),te=!0}function a(){console.log("THREE.WebGLRenderer: Context Restored."),te=!1,i()}function c(e){var t=e.target;t.removeEventListener("dispose",c),function(e){l(e),F.remove(e)}(t)}function l(e){var t=F.get(e).program;e.program=void 0,void 0!==t&&G.releaseProgram(t)}function h(e,t,n,i){if(!1!==e.visible){if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)P.pushLight(e),e.castShadow&&P.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||Pe.intersectsSprite(e)){i&&ke.setFromMatrixPosition(e.matrixWorld).applyMatrix4(Oe);var r=z.update(e);(o=e.material).visible&&R.push(e,r,o,n,ke.z,null)}}else if(e.isImmediateRenderObject)i&&ke.setFromMatrixPosition(e.matrixWorld).applyMatrix4(Oe),R.push(e,null,e.material,n,ke.z,null);else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.update(),!e.frustumCulled||Pe.intersectsObject(e))){i&&ke.setFromMatrixPosition(e.matrixWorld).applyMatrix4(Oe),r=z.update(e);var o=e.material;if(Array.isArray(o))for(var a=r.groups,s=0,c=a.length;s<c;s++){var l=a[s],u=o[l.materialIndex];u&&u.visible&&R.push(e,r,u,n,ke.z,l)}else o.visible&&R.push(e,r,o,n,ke.z,null)}var d=e.children;for(s=0,c=d.length;s<c;s++)h(d[s],t,n,i)}}function d(e,t,n,i){for(var r=0,o=e.length;r<o;r++){var a=e[r],s=a.object,c=a.geometry,l=void 0===i?a.material:i,u=a.group;if(n.isArrayCamera){we=n;for(var h=n.cameras,d=0,f=h.length;d<f;d++){var m=h[d];s.layers.test(m.layers)&&(O.viewport(xe.copy(m.viewport)),P.setupLights(m),p(s,t,m,c,l,u))}}else we=null,p(s,t,n,c,l,u)}}function p(e,t,n,i,r,o){if(e.onBeforeRender(Z,t,n,i,r,o),P=V.get(t,we||n),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject){O.setMaterial(r);var a=m(n,t.fog,r,e);ye.geometry=null,ye.program=null,ye.wireframe=!1,function(e,t){e.render(function(e){Z.renderBufferImmediate(e,t)})}(e,a)}else Z.renderBufferDirect(n,t.fog,i,r,e,o);e.onAfterRender(Z,t,n,i,r,o),P=V.get(t,we||n)}function f(e,t,n){var i=F.get(e),r=P.state.lights,o=P.state.shadowsArray,a=r.state.version,s=G.getParameters(e,r.state,o,t,Ie.numPlanes,Ie.numIntersection,n),u=G.getProgramCode(e,s),h=i.program,d=!0;if(void 0===h)e.addEventListener("dispose",c);else if(h.code!==u)l(e);else if(i.lightsStateVersion!==a)i.lightsStateVersion=a,d=!1;else{if(void 0!==s.shaderID)return;d=!1}if(d){if(s.shaderID){var p=xa[s.shaderID];i.shader={name:e.type,uniforms:j(p.uniforms),vertexShader:p.vertexShader,fragmentShader:p.fragmentShader}}else i.shader={name:e.type,uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader};e.onBeforeCompile(i.shader,Z),u=G.getProgramCode(e,s),h=G.acquireProgram(e,i.shader,s,u),i.program=h,e.program=h}var f=h.getAttributes();if(e.morphTargets){e.numSupportedMorphTargets=0;for(var m=0;m<Z.maxMorphTargets;m++)f["morphTarget"+m]>=0&&e.numSupportedMorphTargets++}if(e.morphNormals)for(e.numSupportedMorphNormals=0,m=0;m<Z.maxMorphNormals;m++)f["morphNormal"+m]>=0&&e.numSupportedMorphNormals++;var g=i.shader.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(i.numClippingPlanes=Ie.numPlanes,i.numIntersection=Ie.numIntersection,g.clippingPlanes=Ie.uniform),i.fog=t,i.lightsStateVersion=a,e.lights&&(g.ambientLightColor.value=r.state.ambient,g.lightProbe.value=r.state.probe,g.directionalLights.value=r.state.directional,g.spotLights.value=r.state.spot,g.rectAreaLights.value=r.state.rectArea,g.pointLights.value=r.state.point,g.hemisphereLights.value=r.state.hemi,g.directionalShadowMap.value=r.state.directionalShadowMap,g.directionalShadowMatrix.value=r.state.directionalShadowMatrix,g.spotShadowMap.value=r.state.spotShadowMap,g.spotShadowMatrix.value=r.state.spotShadowMatrix,g.pointShadowMap.value=r.state.pointShadowMap,g.pointShadowMatrix.value=r.state.pointShadowMatrix);var v=i.program.getUniforms(),y=et.seqWithValue(v.seq,g);i.uniformsList=y}function m(e,t,n,i){B.resetTextureUnits();var r=F.get(n),o=P.state.lights;if(Le&&(De||e!==be)){var a=e===be&&n.id===ve;Ie.setState(n.clippingPlanes,n.clipIntersection,n.clipShadows,e,r,a)}!1===n.needsUpdate&&(void 0===r.program||n.fog&&r.fog!==t||n.lights&&r.lightsStateVersion!==o.state.version?n.needsUpdate=!0:void 0===r.numClippingPlanes||r.numClippingPlanes===Ie.numPlanes&&r.numIntersection===Ie.numIntersection||(n.needsUpdate=!0)),n.needsUpdate&&(f(n,t,i),n.needsUpdate=!1);var s,c,l=!1,u=!1,h=!1,d=r.program,p=d.getUniforms(),m=r.shader.uniforms;if(O.useProgram(d.program)&&(l=!0,u=!0,h=!0),n.id!==ve&&(ve=n.id,u=!0),l||be!==e){if(p.setValue(I,"projectionMatrix",e.projectionMatrix),D.logarithmicDepthBuffer&&p.setValue(I,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),be!==e&&(be=e,u=!0,h=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshStandardMaterial||n.envMap){var b=p.map.cameraPosition;void 0!==b&&b.setValue(I,ke.setFromMatrixPosition(e.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.skinning)&&p.setValue(I,"viewMatrix",e.matrixWorldInverse)}if(n.skinning){p.setOptional(I,i,"bindMatrix"),p.setOptional(I,i,"bindMatrixInverse");var w=i.skeleton;if(w){var x=w.bones;if(D.floatVertexTextures){if(void 0===w.boneTexture){var E=Math.sqrt(4*x.length);E=Co.ceilPowerOfTwo(E),E=Math.max(E,4);var S=new Float32Array(E*E*4);S.set(w.boneMatrices);var _=new K(S,E,E,1023,1015);_.needsUpdate=!0,w.boneMatrices=S,w.boneTexture=_,w.boneTextureSize=E}p.setValue(I,"boneTexture",w.boneTexture,B),p.setValue(I,"boneTextureSize",w.boneTextureSize)}else p.setOptional(I,w,"boneMatrices")}}return u&&(p.setValue(I,"toneMappingExposure",Z.toneMappingExposure),p.setValue(I,"toneMappingWhitePoint",Z.toneMappingWhitePoint),n.lights&&(c=h,(s=m).ambientLightColor.needsUpdate=c,s.lightProbe.needsUpdate=c,s.directionalLights.needsUpdate=c,s.pointLights.needsUpdate=c,s.spotLights.needsUpdate=c,s.rectAreaLights.needsUpdate=c,s.hemisphereLights.needsUpdate=c),t&&n.fog&&function(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)}(m,t),n.isMeshBasicMaterial?g(m,n):n.isMeshLambertMaterial?(g(m,n),function(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}(m,n)):n.isMeshPhongMaterial?(g(m,n),n.isMeshToonMaterial?function(e,t){v(e,t),t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(m,n):v(m,n)):n.isMeshStandardMaterial?(g(m,n),n.isMeshPhysicalMaterial?function(e,t){y(e,t),e.reflectivity.value=t.reflectivity,e.clearCoat.value=t.clearCoat,e.clearCoatRoughness.value=t.clearCoatRoughness}(m,n):y(m,n)):n.isMeshMatcapMaterial?(g(m,n),function(e,t){t.matcap&&(e.matcap.value=t.matcap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(m,n)):n.isMeshDepthMaterial?(g(m,n),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(m,n)):n.isMeshDistanceMaterial?(g(m,n),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(m,n)):n.isMeshNormalMaterial?(g(m,n),function(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(m,n)):n.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}(m,n),n.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(m,n)):n.isPointsMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*Me,e.scale.value=.5*Te,e.map.value=t.map,null!==t.map&&(!0===t.map.matrixAutoUpdate&&t.map.updateMatrix(),e.uvTransform.value.copy(t.map.matrix))}(m,n):n.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,e.map.value=t.map,null!==t.map&&(!0===t.map.matrixAutoUpdate&&t.map.updateMatrix(),e.uvTransform.value.copy(t.map.matrix))}(m,n):n.isShadowMaterial&&(m.color.value.copy(n.color),m.opacity.value=n.opacity),void 0!==m.ltc_1&&(m.ltc_1.value=wa.LTC_1),void 0!==m.ltc_2&&(m.ltc_2.value=wa.LTC_2),et.upload(I,r.uniformsList,m,B)),n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(et.upload(I,r.uniformsList,m,B),n.uniformsNeedUpdate=!1),n.isSpriteMaterial&&p.setValue(I,"center",i.center),p.setValue(I,"modelViewMatrix",i.modelViewMatrix),p.setValue(I,"normalMatrix",i.normalMatrix),p.setValue(I,"modelMatrix",i.matrixWorld),d}function g(e,t){var n;e.opacity.value=t.opacity,t.color&&e.diffuse.value.copy(t.color),t.emissive&&e.emissive.value.copy(t.emissive).multiplyScalar(t.emissiveIntensity),t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.specularMap&&(e.specularMap.value=t.specularMap),t.envMap&&(e.envMap.value=t.envMap,e.flipEnvMap.value=t.envMap.isCubeTexture?-1:1,e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio,e.maxMipLevel.value=F.get(t.envMap).__maxMipLevel),t.lightMap&&(e.lightMap.value=t.lightMap,e.lightMapIntensity.value=t.lightMapIntensity),t.aoMap&&(e.aoMap.value=t.aoMap,e.aoMapIntensity.value=t.aoMapIntensity),t.map?n=t.map:t.specularMap?n=t.specularMap:t.displacementMap?n=t.displacementMap:t.normalMap?n=t.normalMap:t.bumpMap?n=t.bumpMap:t.roughnessMap?n=t.roughnessMap:t.metalnessMap?n=t.metalnessMap:t.alphaMap?n=t.alphaMap:t.emissiveMap&&(n=t.emissiveMap),void 0!==n&&(n.isWebGLRenderTarget&&(n=n.texture),!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix))}function v(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}function y(e,t){e.roughness.value=t.roughness,e.metalness.value=t.metalness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap),t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),t.envMap&&(e.envMapIntensity.value=t.envMapIntensity)}console.log("THREE.WebGLRenderer","107");var b=void 0!==(e=e||{}).canvas?e.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),w=void 0!==e.context?e.context:null,x=void 0!==e.alpha&&e.alpha,E=void 0===e.depth||e.depth,S=void 0===e.stencil||e.stencil,_=void 0!==e.antialias&&e.antialias,T=void 0===e.premultipliedAlpha||e.premultipliedAlpha,M=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,C=void 0!==e.powerPreference?e.powerPreference:"default",A=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat,R=null,P=null;this.domElement=b,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.physicallyCorrectLights=!1,this.toneMapping=1,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var I,L,D,O,k,F,B,N,U,z,G,H,V,W,X,q,Y,J,Z=this,te=!1,ne=null,he=0,fe=0,me=null,ge=null,ve=-1,ye={geometry:null,program:null,wireframe:!1},be=null,we=null,xe=new s,Ee=new s,Se=null,_e=b.width,Te=b.height,Me=1,Ce=new s(0,0,_e,Te),Ae=new s(0,0,_e,Te),Re=!1,Pe=new Q,Ie=new ae,Le=!1,De=!1,Oe=new u,ke=new r;try{var Fe={alpha:x,depth:E,stencil:S,antialias:_,premultipliedAlpha:T,preserveDrawingBuffer:M,powerPreference:C,failIfMajorPerformanceCaveat:A,xrCompatible:!0};if(b.addEventListener("webglcontextlost",o,!1),b.addEventListener("webglcontextrestored",a,!1),null===(I=w||b.getContext("webgl",Fe)||b.getContext("experimental-webgl",Fe)))throw null!==b.getContext("webgl")?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.");void 0===I.getShaderPrecisionFormat&&(I.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}i();var Be="undefined"!=typeof navigator&&"xr"in navigator&&"supportsSession"in navigator.xr?new Lt(Z,I):new It(Z);this.vr=Be;var Ne=new _t(Z,z,D.maxTextureSize);this.shadowMap=Ne,this.getContext=function(){return I},this.getContextAttributes=function(){return I.getContextAttributes()},this.forceContextLoss=function(){var e=L.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){var e=L.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return Me},this.setPixelRatio=function(e){void 0!==e&&(Me=e,this.setSize(_e,Te,!1))},this.getSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),e=new n),e.set(_e,Te)},this.setSize=function(e,t,n){Be.isPresenting()?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(_e=e,Te=t,b.width=Math.floor(e*Me),b.height=Math.floor(t*Me),!1!==n&&(b.style.width=e+"px",b.style.height=t+"px"),this.setViewport(0,0,e,t))},this.getDrawingBufferSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),e=new n),e.set(_e*Me,Te*Me).floor()},this.setDrawingBufferSize=function(e,t,n){_e=e,Te=t,Me=n,b.width=Math.floor(e*n),b.height=Math.floor(t*n),this.setViewport(0,0,e,t)},this.getCurrentViewport=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),e=new s),e.copy(xe)},this.getViewport=function(e){return e.copy(Ce)},this.setViewport=function(e,t,n,i){e.isVector4?Ce.set(e.x,e.y,e.z,e.w):Ce.set(e,t,n,i),O.viewport(xe.copy(Ce).multiplyScalar(Me).floor())},this.getScissor=function(e){return e.copy(Ae)},this.setScissor=function(e,t,n,i){e.isVector4?Ae.set(e.x,e.y,e.z,e.w):Ae.set(e,t,n,i),O.scissor(Ee.copy(Ae).multiplyScalar(Me).floor())},this.getScissorTest=function(){return Re},this.setScissorTest=function(e){O.setScissorTest(Re=e)},this.getClearColor=function(){return W.getClearColor()},this.setClearColor=function(){W.setClearColor.apply(W,arguments)},this.getClearAlpha=function(){return W.getClearAlpha()},this.setClearAlpha=function(){W.setClearAlpha.apply(W,arguments)},this.clear=function(e,t,n){var i=0;(void 0===e||e)&&(i|=16384),(void 0===t||t)&&(i|=256),(void 0===n||n)&&(i|=1024),I.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){b.removeEventListener("webglcontextlost",o,!1),b.removeEventListener("webglcontextrestored",a,!1),H.dispose(),V.dispose(),F.dispose(),z.dispose(),Be.dispose(),ze.stop()},this.renderBufferImmediate=function(e,t){O.initAttributes();var n=F.get(e);e.hasPositions&&!n.position&&(n.position=I.createBuffer()),e.hasNormals&&!n.normal&&(n.normal=I.createBuffer()),e.hasUvs&&!n.uv&&(n.uv=I.createBuffer()),e.hasColors&&!n.color&&(n.color=I.createBuffer());var i=t.getAttributes();e.hasPositions&&(I.bindBuffer(34962,n.position),I.bufferData(34962,e.positionArray,35048),O.enableAttribute(i.position),I.vertexAttribPointer(i.position,3,5126,!1,0,0)),e.hasNormals&&(I.bindBuffer(34962,n.normal),I.bufferData(34962,e.normalArray,35048),O.enableAttribute(i.normal),I.vertexAttribPointer(i.normal,3,5126,!1,0,0)),e.hasUvs&&(I.bindBuffer(34962,n.uv),I.bufferData(34962,e.uvArray,35048),O.enableAttribute(i.uv),I.vertexAttribPointer(i.uv,2,5126,!1,0,0)),e.hasColors&&(I.bindBuffer(34962,n.color),I.bufferData(34962,e.colorArray,35048),O.enableAttribute(i.color),I.vertexAttribPointer(i.color,3,5126,!1,0,0)),O.disableUnusedAttributes(),I.drawArrays(4,0,e.count),e.count=0},this.renderBufferDirect=function(e,n,i,r,o,a){var s=o.isMesh&&o.matrixWorld.determinant()<0;O.setMaterial(r,s);var c=m(e,n,r,o),l=!1;ye.geometry===i.id&&ye.program===c.id&&ye.wireframe===(!0===r.wireframe)||(ye.geometry=i.id,ye.program=c.id,ye.wireframe=!0===r.wireframe,l=!0),o.morphTargetInfluences&&(X.update(o,i,r,c),l=!0);var u,h=i.index,d=i.attributes.position,p=1;!0===r.wireframe&&(h=U.getWireframeAttribute(i),p=2);var f=q;null!==h&&(u=N.get(h),(f=Y).setIndex(u)),l&&(function(e,t,n){if(n&&n.isInstancedBufferGeometry&&!D.isWebGL2&&null===L.get("ANGLE_instanced_arrays"))console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");else{O.initAttributes();var i=n.attributes,r=t.getAttributes(),o=e.defaultAttributeValues;for(var a in r){var s=r[a];if(s>=0){var c=i[a];if(void 0!==c){var l=c.normalized,u=c.itemSize,h=N.get(c);if(void 0===h)continue;var d=h.buffer,p=h.type,f=h.bytesPerElement;if(c.isInterleavedBufferAttribute){var m=c.data,g=m.stride,v=c.offset;m&&m.isInstancedInterleavedBuffer?(O.enableAttributeAndDivisor(s,m.meshPerAttribute),void 0===n.maxInstancedCount&&(n.maxInstancedCount=m.meshPerAttribute*m.count)):O.enableAttribute(s),I.bindBuffer(34962,d),I.vertexAttribPointer(s,u,p,l,g*f,v*f)}else c.isInstancedBufferAttribute?(O.enableAttributeAndDivisor(s,c.meshPerAttribute),void 0===n.maxInstancedCount&&(n.maxInstancedCount=c.meshPerAttribute*c.count)):O.enableAttribute(s),I.bindBuffer(34962,d),I.vertexAttribPointer(s,u,p,l,0,0)}else if(void 0!==o){var y=o[a];if(void 0!==y)switch(y.length){case 2:I.vertexAttrib2fv(s,y);break;case 3:I.vertexAttrib3fv(s,y);break;case 4:I.vertexAttrib4fv(s,y);break;default:I.vertexAttrib1fv(s,y)}}}}O.disableUnusedAttributes()}}(r,c,i),null!==h&&I.bindBuffer(34963,u.buffer));var g=1/0;null!==h?g=h.count:void 0!==d&&(g=d.count);var v=i.drawRange.start*p,y=i.drawRange.count*p,b=null!==a?a.start*p:0,w=null!==a?a.count*p:1/0,x=Math.max(v,b),E=Math.min(g,v+y,b+w)-1,S=Math.max(0,E-x+1);if(0!==S){if(o.isMesh)if(!0===r.wireframe)O.setLineWidth(r.wireframeLinewidth*t()),f.setMode(1);else switch(o.drawMode){case 0:f.setMode(4);break;case 1:f.setMode(5);break;case 2:f.setMode(6)}else if(o.isLine){var _=r.linewidth;void 0===_&&(_=1),O.setLineWidth(_*t()),o.isLineSegments?f.setMode(1):o.isLineLoop?f.setMode(2):f.setMode(3)}else o.isPoints?f.setMode(0):o.isSprite&&f.setMode(4);i&&i.isInstancedBufferGeometry?i.maxInstancedCount>0&&f.renderInstances(i,x,S):f.render(x,S)}},this.compile=function(e,t){(P=V.get(e,t)).init(),e.traverse(function(e){e.isLight&&(P.pushLight(e),e.castShadow&&P.pushShadow(e))}),P.setupLights(t),e.traverse(function(t){if(t.material)if(Array.isArray(t.material))for(var n=0;n<t.material.length;n++)f(t.material[n],e.fog,t);else f(t.material,e.fog,t)})};var Ue=null,ze=new $;ze.setAnimationLoop(function(e){Be.isPresenting()||Ue&&Ue(e)}),"undefined"!=typeof window&&ze.setContext(window),this.setAnimationLoop=function(e){Ue=e,Be.setAnimationLoop(e),ze.start()},this.render=function(e,t){var n,i;if(void 0!==arguments[2]&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),n=arguments[2]),void 0!==arguments[3]&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),i=arguments[3]),t&&t.isCamera){if(!te){
ye.geometry=null,ye.program=null,ye.wireframe=!1,ve=-1,be=null,!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),Be.enabled&&(t=Be.getCamera(t)),(P=V.get(e,t)).init(),e.onBeforeRender(Z,e,t,n||me),Oe.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),Pe.setFromMatrix(Oe),De=this.localClippingEnabled,Le=Ie.init(this.clippingPlanes,De,t),(R=H.get(e,t)).init(),h(e,t,0,Z.sortObjects),!0===Z.sortObjects&&R.sort(),Le&&Ie.beginShadows();var r=P.state.shadowsArray;Ne.render(r,e,t),P.setupLights(t),Le&&Ie.endShadows(),this.info.autoReset&&this.info.reset(),void 0!==n&&this.setRenderTarget(n),W.render(R,e,t,i);var o=R.opaque,a=R.transparent;if(e.overrideMaterial){var s=e.overrideMaterial;o.length&&d(o,e,t,s),a.length&&d(a,e,t,s)}else o.length&&d(o,e,t),a.length&&d(a,e,t);e.onAfterRender(Z,e,t),null!==me&&(B.updateRenderTargetMipmap(me),B.updateMultisampleRenderTarget(me)),O.buffers.depth.setTest(!0),O.buffers.depth.setMask(!0),O.buffers.color.setMask(!0),O.setPolygonOffset(!1),Be.enabled&&Be.submitFrame(),R=null,P=null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.setFramebuffer=function(e){ne!==e&&I.bindFramebuffer(36160,e),ne=e},this.getActiveCubeFace=function(){return he},this.getActiveMipmapLevel=function(){return fe},this.getRenderTarget=function(){return me},this.setRenderTarget=function(e,t,n){me=e,he=t,fe=n,e&&void 0===F.get(e).__webglFramebuffer&&B.setupRenderTarget(e);var i=ne,r=!1;if(e){var o=F.get(e).__webglFramebuffer;e.isWebGLRenderTargetCube?(i=o[t||0],r=!0):i=e.isWebGLMultisampleRenderTarget?F.get(e).__webglMultisampledFramebuffer:o,xe.copy(e.viewport),Ee.copy(e.scissor),Se=e.scissorTest}else xe.copy(Ce).multiplyScalar(Me).floor(),Ee.copy(Ae).multiplyScalar(Me).floor(),Se=Re;if(ge!==i&&(I.bindFramebuffer(36160,i),ge=i),O.viewport(xe),O.scissor(Ee),O.setScissorTest(Se),r){var a=F.get(e.texture);I.framebufferTexture2D(36160,36064,34069+(t||0),a.__webglTexture,n||0)}},this.readRenderTargetPixels=function(e,t,n,i,r,o,a){if(e&&e.isWebGLRenderTarget){var s=F.get(e).__webglFramebuffer;if(e.isWebGLRenderTargetCube&&void 0!==a&&(s=s[a]),s){var c=!1;s!==ge&&(I.bindFramebuffer(36160,s),c=!0);try{var l=e.texture,u=l.format,h=l.type;if(1023!==u&&J.convert(u)!==I.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(1009===h||J.convert(h)===I.getParameter(35738)||1015===h&&(D.isWebGL2||L.get("OES_texture_float")||L.get("WEBGL_color_buffer_float"))||1016===h&&(D.isWebGL2?L.get("EXT_color_buffer_float"):L.get("EXT_color_buffer_half_float"))))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===I.checkFramebufferStatus(36160)?t>=0&&t<=e.width-i&&n>=0&&n<=e.height-r&&I.readPixels(t,n,i,r,J.convert(u),J.convert(h),o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{c&&I.bindFramebuffer(36160,ge)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(e,t,n){var i=t.image.width,r=t.image.height,o=J.convert(t.format);B.setTexture2D(t,0),I.copyTexImage2D(3553,n||0,o,e.x,e.y,i,r,0)},this.copyTextureToTexture=function(e,t,n,i){var r=t.image.width,o=t.image.height,a=J.convert(n.format),s=J.convert(n.type);B.setTexture2D(n,0),t.isDataTexture?I.texSubImage2D(3553,i||0,e.x,e.y,r,o,a,s,t.image.data):I.texSubImage2D(3553,i||0,e.x,e.y,a,s,t.image)},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function Ot(e,t){this.name="",this.color=new b(e),this.density=void 0!==t?t:25e-5}function kt(e,t,n){this.name="",this.color=new b(e),this.near=void 0!==t?t:1,this.far=void 0!==n?n:1e3}function Ft(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}function Bt(e,t,n,i){this.data=e,this.itemSize=t,this.offset=n,this.normalized=!0===i}function Nt(e){_.call(this),this.type="SpriteMaterial",this.color=new b(16777215),this.map=null,this.rotation=0,this.sizeAttenuation=!0,this.lights=!1,this.transparent=!0,this.setValues(e)}function Ut(e){if(p.call(this),this.type="Sprite",void 0===Oa){Oa=new N;var t=new Ft(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);Oa.setIndex([0,1,2,0,2,3]),Oa.addAttribute("position",new Bt(t,3,0,!1)),Oa.addAttribute("uv",new Bt(t,2,3,!1))}this.geometry=Oa,this.material=void 0!==e?e:new Nt,this.center=new n(.5,.5)}function zt(){p.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}function Gt(e,t){e&&e.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),U.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new u,this.bindMatrixInverse=new u}function Ht(e,t){if(e=e||[],this.bones=e.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),void 0===t)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var n=0,i=this.bones.length;n<i;n++)this.boneInverses.push(new u)}}function jt(){p.call(this),this.type="Bone"}function Vt(e){_.call(this),this.type="LineBasicMaterial",this.color=new b(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.lights=!1,this.setValues(e)}function Wt(e,t,n){1===n&&console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead."),p.call(this),this.type="Line",this.geometry=void 0!==e?e:new N,this.material=void 0!==t?t:new Vt({color:16777215*Math.random()})}function Xt(e,t){Wt.call(this,e,t),this.type="LineSegments"}function qt(e,t){Wt.call(this,e,t),this.type="LineLoop"}function Yt(e){_.call(this),this.type="PointsMaterial",this.color=new b(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.lights=!1,this.setValues(e)}function Jt(e,t){p.call(this),this.type="Points",this.geometry=void 0!==e?e:new N,this.material=void 0!==t?t:new Yt({color:16777215*Math.random()}),this.updateMorphTargets()}function Kt(e,t,n,i,r,o,s,c,l){a.call(this,e,t,n,i,r,o,s,c,l),this.format=void 0!==s?s:1022,this.minFilter=void 0!==o?o:1006,this.magFilter=void 0!==r?r:1006,this.generateMipmaps=!1}function Zt(e,t,n,i,r,o,s,c,l,u,h,d){a.call(this,null,o,s,c,l,u,i,r,h,d),this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}function Qt(e,t,n,i,r,o,s,c,l){a.call(this,e,t,n,i,r,o,s,c,l),this.needsUpdate=!0}function $t(e,t,n,i,r,o,s,c,l,u){if(1026!==(u=void 0!==u?u:1026)&&1027!==u)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&1026===u&&(n=1012),void 0===n&&1027===u&&(n=1020),a.call(this,null,i,r,o,s,c,u,n,l),this.image={width:e,height:t},this.magFilter=void 0!==s?s:1003,this.minFilter=void 0!==c?c:1003,this.flipY=!1,this.generateMipmaps=!1}function en(e){N.call(this),this.type="WireframeGeometry";var t,n,i,o,a,s,c,l,u,h,d=[],p=[0,0],f={},m=["a","b","c"];if(e&&e.isGeometry){var g=e.faces;for(t=0,i=g.length;t<i;t++){var v=g[t];for(n=0;n<3;n++)c=v[m[n]],l=v[m[(n+1)%3]],p[0]=Math.min(c,l),p[1]=Math.max(c,l),void 0===f[u=p[0]+","+p[1]]&&(f[u]={index1:p[0],index2:p[1]})}for(u in f)s=f[u],h=e.vertices[s.index1],d.push(h.x,h.y,h.z),h=e.vertices[s.index2],d.push(h.x,h.y,h.z)}else if(e&&e.isBufferGeometry){var y,b,w,x,E,S,_;if(h=new r,null!==e.index){for(y=e.attributes.position,b=e.index,0===(w=e.groups).length&&(w=[{start:0,count:b.count,materialIndex:0}]),o=0,a=w.length;o<a;++o)for(t=E=(x=w[o]).start,i=E+x.count;t<i;t+=3)for(n=0;n<3;n++)c=b.getX(t+n),l=b.getX(t+(n+1)%3),p[0]=Math.min(c,l),p[1]=Math.max(c,l),void 0===f[u=p[0]+","+p[1]]&&(f[u]={index1:p[0],index2:p[1]});for(u in f)s=f[u],h.fromBufferAttribute(y,s.index1),d.push(h.x,h.y,h.z),h.fromBufferAttribute(y,s.index2),d.push(h.x,h.y,h.z)}else for(t=0,i=(y=e.attributes.position).count/3;t<i;t++)for(n=0;n<3;n++)S=3*t+n,h.fromBufferAttribute(y,S),d.push(h.x,h.y,h.z),_=3*t+(n+1)%3,h.fromBufferAttribute(y,_),d.push(h.x,h.y,h.z)}this.addAttribute("position",new O(d,3))}function tn(e,t,n){z.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:n},this.fromBufferGeometry(new nn(e,t,n)),this.mergeVertices()}function nn(e,t,n){N.call(this),this.type="ParametricBufferGeometry",this.parameters={func:e,slices:t,stacks:n};var i,o,a=[],s=[],c=[],l=[],u=1e-5,h=new r,d=new r,p=new r,f=new r,m=new r;e.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");var g=t+1;for(i=0;i<=n;i++){var v=i/n;for(o=0;o<=t;o++){var y=o/t;e(y,v,d),s.push(d.x,d.y,d.z),y-u>=0?(e(y-u,v,p),f.subVectors(d,p)):(e(y+u,v,p),f.subVectors(p,d)),v-u>=0?(e(y,v-u,p),m.subVectors(d,p)):(e(y,v+u,p),m.subVectors(p,d)),h.crossVectors(f,m).normalize(),c.push(h.x,h.y,h.z),l.push(y,v)}}for(i=0;i<n;i++)for(o=0;o<t;o++){var b=i*g+o,w=i*g+o+1,x=(i+1)*g+o+1,E=(i+1)*g+o;a.push(b,w,E),a.push(w,x,E)}this.setIndex(a),this.addAttribute("position",new O(s,3)),this.addAttribute("normal",new O(c,3)),this.addAttribute("uv",new O(l,2))}function rn(e,t,n,i){z.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:i},this.fromBufferGeometry(new on(e,t,n,i)),this.mergeVertices()}function on(e,t,i,o){function a(e,t,n,i){var r,o,a=Math.pow(2,i),c=[];for(r=0;r<=a;r++){c[r]=[];var l=e.clone().lerp(n,r/a),u=t.clone().lerp(n,r/a),h=a-r;for(o=0;o<=h;o++)c[r][o]=0===o&&r===a?l:l.clone().lerp(u,o/h)}for(r=0;r<a;r++)for(o=0;o<2*(a-r)-1;o++){var d=Math.floor(o/2);o%2==0?(s(c[r][d+1]),s(c[r+1][d]),s(c[r][d])):(s(c[r][d+1]),s(c[r+1][d+1]),s(c[r+1][d]))}}function s(e){d.push(e.x,e.y,e.z)}function c(t,n){var i=3*t;n.x=e[i+0],n.y=e[i+1],n.z=e[i+2]}function l(e,t,n,i){i<0&&1===e.x&&(p[t]=e.x-1),0===n.x&&0===n.z&&(p[t]=i/2/Math.PI+.5)}function u(e){return Math.atan2(e.z,-e.x)}function h(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}N.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:o},i=i||1;var d=[],p=[];!function(e){for(var n=new r,i=new r,o=new r,s=0;s<t.length;s+=3)c(t[s+0],n),c(t[s+1],i),c(t[s+2],o),a(n,i,o,e)}(o=o||0),function(e){for(var t=new r,n=0;n<d.length;n+=3)t.x=d[n+0],t.y=d[n+1],t.z=d[n+2],t.normalize().multiplyScalar(e),d[n+0]=t.x,d[n+1]=t.y,d[n+2]=t.z}(i),function(){for(var e=new r,t=0;t<d.length;t+=3){e.x=d[t+0],e.y=d[t+1],e.z=d[t+2];var i=u(e)/2/Math.PI+.5,o=h(e)/Math.PI+.5;p.push(i,1-o)}(function(){for(var e=new r,t=new r,i=new r,o=new r,a=new n,s=new n,c=new n,h=0,f=0;h<d.length;h+=9,f+=6){e.set(d[h+0],d[h+1],d[h+2]),t.set(d[h+3],d[h+4],d[h+5]),i.set(d[h+6],d[h+7],d[h+8]),a.set(p[f+0],p[f+1]),s.set(p[f+2],p[f+3]),c.set(p[f+4],p[f+5]),o.copy(e).add(t).add(i).divideScalar(3);var m=u(o);l(a,f+0,e,m),l(s,f+2,t,m),l(c,f+4,i,m)}})(),function(){for(var e=0;e<p.length;e+=6){var t=p[e+0],n=p[e+2],i=p[e+4],r=Math.max(t,n,i),o=Math.min(t,n,i);r>.9&&o<.1&&(t<.2&&(p[e+0]+=1),n<.2&&(p[e+2]+=1),i<.2&&(p[e+4]+=1))}}()}(),this.addAttribute("position",new O(d,3)),this.addAttribute("normal",new O(d.slice(),3)),this.addAttribute("uv",new O(p,2)),0===o?this.computeVertexNormals():this.normalizeNormals()}function an(e,t){z.call(this),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new sn(e,t)),this.mergeVertices()}function sn(e,t){on.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronBufferGeometry",this.parameters={radius:e,detail:t}}function cn(e,t){z.call(this),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new ln(e,t)),this.mergeVertices()}function ln(e,t){on.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronBufferGeometry",this.parameters={radius:e,detail:t}}function un(e,t){z.call(this),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new hn(e,t)),this.mergeVertices()}function hn(e,t){var n=(1+Math.sqrt(5))/2,i=[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1];on.call(this,i,[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronBufferGeometry",this.parameters={radius:e,detail:t}}function dn(e,t){z.call(this),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new pn(e,t)),this.mergeVertices()}function pn(e,t){var n=(1+Math.sqrt(5))/2,i=1/n,r=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-n,0,-i,n,0,i,-n,0,i,n,-i,-n,0,-i,n,0,i,-n,0,i,n,0,-n,0,-i,n,0,-i,-n,0,i,n,0,i];on.call(this,r,[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronBufferGeometry",this.parameters={radius:e,detail:t}}function fn(e,t,n,i,r,o){z.call(this),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:i,closed:r},void 0!==o&&console.warn("THREE.TubeGeometry: taper has been removed.");var a=new mn(e,t,n,i,r);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals,this.fromBufferGeometry(a),this.mergeVertices()}function mn(e,t,i,o,a){function s(n){f=e.getPointAt(n/t,f);var r=c.normals[n],a=c.binormals[n];for(u=0;u<=o;u++){var s=u/o*Math.PI*2,l=Math.sin(s),p=-Math.cos(s);d.x=p*r.x+l*a.x,d.y=p*r.y+l*a.y,d.z=p*r.z+l*a.z,d.normalize(),g.push(d.x,d.y,d.z),h.x=f.x+i*d.x,h.y=f.y+i*d.y,h.z=f.z+i*d.z,m.push(h.x,h.y,h.z)}}N.call(this),this.type="TubeBufferGeometry",this.parameters={path:e,tubularSegments:t,radius:i,radialSegments:o,closed:a},t=t||64,i=i||1,o=o||8,a=a||!1;var c=e.computeFrenetFrames(t,a);this.tangents=c.tangents,this.normals=c.normals,this.binormals=c.binormals;var l,u,h=new r,d=new r,p=new n,f=new r,m=[],g=[],v=[],y=[];!function(){for(l=0;l<t;l++)s(l);s(!1===a?t:0),function(){for(l=0;l<=t;l++)for(u=0;u<=o;u++)p.x=l/t,p.y=u/o,v.push(p.x,p.y)}(),function(){for(u=1;u<=t;u++)for(l=1;l<=o;l++){var e=(o+1)*(u-1)+(l-1),n=(o+1)*u+(l-1),i=(o+1)*u+l,r=(o+1)*(u-1)+l;y.push(e,n,r),y.push(n,i,r)}}()}(),this.setIndex(y),this.addAttribute("position",new O(m,3)),this.addAttribute("normal",new O(g,3)),this.addAttribute("uv",new O(v,2))}function gn(e,t,n,i,r,o,a){z.call(this),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:i,p:r,q:o},void 0!==a&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new vn(e,t,n,i,r,o)),this.mergeVertices()}function vn(e,t,n,i,o,a){function s(e,t,n,i,r){var o=Math.cos(e),a=Math.sin(e),s=n/t*e,c=Math.cos(s);r.x=i*(2+c)*.5*o,r.y=i*(2+c)*a*.5,r.z=i*Math.sin(s)*.5}N.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:i,p:o,q:a},e=e||1,t=t||.4,n=Math.floor(n)||64,i=Math.floor(i)||8,o=o||2,a=a||3;var c,l,u=[],h=[],d=[],p=[],f=new r,m=new r,g=new r,v=new r,y=new r,b=new r,w=new r;for(c=0;c<=n;++c){var x=c/n*o*Math.PI*2;for(s(x,o,a,e,g),s(x+.01,o,a,e,v),b.subVectors(v,g),w.addVectors(v,g),y.crossVectors(b,w),w.crossVectors(y,b),y.normalize(),w.normalize(),l=0;l<=i;++l){var E=l/i*Math.PI*2,S=-t*Math.cos(E),_=t*Math.sin(E);f.x=g.x+(S*w.x+_*y.x),f.y=g.y+(S*w.y+_*y.y),f.z=g.z+(S*w.z+_*y.z),h.push(f.x,f.y,f.z),m.subVectors(f,g).normalize(),d.push(m.x,m.y,m.z),p.push(c/n),p.push(l/i)}}for(l=1;l<=n;l++)for(c=1;c<=i;c++){var T=(i+1)*(l-1)+(c-1),M=(i+1)*l+(c-1),C=(i+1)*l+c,A=(i+1)*(l-1)+c;u.push(T,M,A),u.push(M,C,A)}this.setIndex(u),this.addAttribute("position",new O(h,3)),this.addAttribute("normal",new O(d,3)),this.addAttribute("uv",new O(p,2))}function yn(e,t,n,i,r){z.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:i,arc:r},this.fromBufferGeometry(new bn(e,t,n,i,r)),this.mergeVertices()}function bn(e,t,n,i,o){N.call(this),this.type="TorusBufferGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:i,arc:o},e=e||1,t=t||.4,n=Math.floor(n)||8,i=Math.floor(i)||6,o=o||2*Math.PI;var a,s,c=[],l=[],u=[],h=[],d=new r,p=new r,f=new r;for(a=0;a<=n;a++)for(s=0;s<=i;s++){var m=s/i*o,g=a/n*Math.PI*2;p.x=(e+t*Math.cos(g))*Math.cos(m),p.y=(e+t*Math.cos(g))*Math.sin(m),p.z=t*Math.sin(g),l.push(p.x,p.y,p.z),d.x=e*Math.cos(m),d.y=e*Math.sin(m),f.subVectors(p,d).normalize(),u.push(f.x,f.y,f.z),h.push(s/i),h.push(a/n)}for(a=1;a<=n;a++)for(s=1;s<=i;s++){var v=(i+1)*a+s-1,y=(i+1)*(a-1)+s-1,b=(i+1)*(a-1)+s,w=(i+1)*a+s;c.push(v,y,w),c.push(y,b,w)}this.setIndex(c),this.addAttribute("position",new O(l,3)),this.addAttribute("normal",new O(u,3)),this.addAttribute("uv",new O(h,2))}function wn(e,t,n,i,r){var o,a;if(r===function(e,t,n,i){for(var r=0,o=t,a=n-i;o<n;o+=i)r+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return r}(e,t,n,i)>0)for(o=t;o<n;o+=i)a=Nn(o,e[o],e[o+1],a);else for(o=n-i;o>=t;o-=i)a=Nn(o,e[o],e[o+1],a);return a&&On(a,a.next)&&(Un(a),a=a.next),a}function xn(e,t){if(!e)return e;t||(t=e);var n,i=e;do{if(n=!1,i.steiner||!On(i,i.next)&&0!==Dn(i.prev,i,i.next))i=i.next;else{if(Un(i),(i=t=i.prev)===i.next)break;n=!0}}while(n||i!==t);return t}function En(e,t,n,i,r,o,a){if(e){!a&&o&&function(e,t,n,i){var r=e;do{null===r.z&&(r.z=Rn(r.x,r.y,t,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){var t,n,i,r,o,a,s,c,l=1;do{for(n=e,e=null,o=null,a=0;n;){for(a++,i=n,s=0,t=0;t<l&&(s++,i=i.nextZ);t++);for(c=l;s>0||c>0&&i;)0!==s&&(0===c||!i||n.z<=i.z)?(r=n,n=n.nextZ,s--):(r=i,i=i.nextZ,c--),o?o.nextZ=r:e=r,r.prevZ=o,o=r;n=i}o.nextZ=null,l*=2}while(a>1)}(r)}(e,i,r,o);for(var s,c,l=e;e.prev!==e.next;)if(s=e.prev,c=e.next,o?_n(e,i,r,o):Sn(e))t.push(s.i/n),t.push(e.i/n),t.push(c.i/n),Un(e),e=c.next,l=c.next;else if((e=c)===l){a?1===a?En(e=Tn(e,t,n),t,n,i,r,o,2):2===a&&Mn(e,t,n,i,r,o):En(xn(e),t,n,i,r,o,1);break}}}function Sn(e){var t=e.prev,n=e,i=e.next;if(Dn(t,n,i)>=0)return!1;for(var r=e.next.next;r!==e.prev;){if(In(t.x,t.y,n.x,n.y,i.x,i.y,r.x,r.y)&&Dn(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function _n(e,t,n,i){var r=e.prev,o=e,a=e.next;if(Dn(r,o,a)>=0)return!1;for(var s=r.x<o.x?r.x<a.x?r.x:a.x:o.x<a.x?o.x:a.x,c=r.y<o.y?r.y<a.y?r.y:a.y:o.y<a.y?o.y:a.y,l=r.x>o.x?r.x>a.x?r.x:a.x:o.x>a.x?o.x:a.x,u=r.y>o.y?r.y>a.y?r.y:a.y:o.y>a.y?o.y:a.y,h=Rn(s,c,t,n,i),d=Rn(l,u,t,n,i),p=e.prevZ,f=e.nextZ;p&&p.z>=h&&f&&f.z<=d;){if(p!==e.prev&&p!==e.next&&In(r.x,r.y,o.x,o.y,a.x,a.y,p.x,p.y)&&Dn(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,f!==e.prev&&f!==e.next&&In(r.x,r.y,o.x,o.y,a.x,a.y,f.x,f.y)&&Dn(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;p&&p.z>=h;){if(p!==e.prev&&p!==e.next&&In(r.x,r.y,o.x,o.y,a.x,a.y,p.x,p.y)&&Dn(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;f&&f.z<=d;){if(f!==e.prev&&f!==e.next&&In(r.x,r.y,o.x,o.y,a.x,a.y,f.x,f.y)&&Dn(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function Tn(e,t,n){var i=e;do{var r=i.prev,o=i.next.next;!On(r,o)&&kn(r,i,i.next,o)&&Fn(r,o)&&Fn(o,r)&&(t.push(r.i/n),t.push(i.i/n),t.push(o.i/n),Un(i),Un(i.next),i=e=o),i=i.next}while(i!==e);return i}function Mn(e,t,n,i,r,o){var a=e;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&Ln(a,s)){var c=Bn(a,s);return a=xn(a,a.next),c=xn(c,c.next),En(a,t,n,i,r,o),void En(c,t,n,i,r,o)}s=s.next}a=a.next}while(a!==e)}function Cn(e,t){return e.x-t.x}function An(e,t){if(t=function(e,t){var n,i=t,r=e.x,o=e.y,a=-1/0;do{if(o<=i.y&&o>=i.next.y&&i.next.y!==i.y){var s=i.x+(o-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(s<=r&&s>a){if(a=s,s===r){if(o===i.y)return i;if(o===i.next.y)return i.next}n=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!n)return null;if(r===a)return n.prev;var c,l=n,u=n.x,h=n.y,d=1/0;for(i=n.next;i!==l;)r>=i.x&&i.x>=u&&r!==i.x&&In(o<h?r:a,o,u,h,o<h?a:r,o,i.x,i.y)&&((c=Math.abs(o-i.y)/(r-i.x))<d||c===d&&i.x>n.x)&&Fn(i,e)&&(n=i,d=c),i=i.next;return n}(e,t)){var n=Bn(t,e);xn(n,n.next)}}function Rn(e,t,n,i,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*r)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Pn(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function In(e,t,n,i,r,o,a,s){return(r-a)*(t-s)-(e-a)*(o-s)>=0&&(e-a)*(i-s)-(n-a)*(t-s)>=0&&(n-a)*(o-s)-(r-a)*(i-s)>=0}function Ln(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&kn(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&Fn(e,t)&&Fn(t,e)&&function(e,t){var n=e,i=!1,r=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&r<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==e);return i}(e,t)}function Dn(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function On(e,t){return e.x===t.x&&e.y===t.y}function kn(e,t,n,i){return!!(On(e,n)&&On(t,i)||On(e,i)&&On(n,t))||Dn(e,t,n)>0!=Dn(e,t,i)>0&&Dn(n,i,e)>0!=Dn(n,i,t)>0}function Fn(e,t){return Dn(e.prev,e,e.next)<0?Dn(e,t,e.next)>=0&&Dn(e,e.prev,t)>=0:Dn(e,t,e.prev)<0||Dn(e,e.next,t)<0}function Bn(e,t){var n=new zn(e.i,e.x,e.y),i=new zn(t.i,t.x,t.y),r=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=r,r.prev=n,i.next=n,n.prev=i,o.next=i,i.prev=o,i}function Nn(e,t,n,i){var r=new zn(e,t,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function Un(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function zn(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Gn(e){var t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function Hn(e,t){for(var n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}function jn(e,t){z.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},this.fromBufferGeometry(new Vn(e,t)),this.mergeVertices()}function Vn(e,t){function i(e){function i(e,t,n){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(n).add(e)}function c(e,t,i){var r,o,a,s=e.x-t.x,c=e.y-t.y,l=i.x-e.x,u=i.y-e.y,h=s*s+c*c,d=s*u-c*l;if(Math.abs(d)>Number.EPSILON){var p=Math.sqrt(h),f=Math.sqrt(l*l+u*u),m=t.x-c/p,g=t.y+s/p,v=((i.x-u/f-m)*u-(i.y+l/f-g)*l)/(s*u-c*l),y=(r=m+s*v-e.x)*r+(o=g+c*v-e.y)*o;if(y<=2)return new n(r,o);a=Math.sqrt(y/2)}else{var b=!1;s>Number.EPSILON?l>Number.EPSILON&&(b=!0):s<-Number.EPSILON?l<-Number.EPSILON&&(b=!0):Math.sign(c)===Math.sign(u)&&(b=!0),b?(r=-c,o=s,a=Math.sqrt(h)):(r=s,o=c,a=Math.sqrt(h/2))}return new n(r/a,o/a)}function l(e,t){var n,i;for(J=e.length;--J>=0;){n=J,(i=J-1)<0&&(i=e.length-1);var r=0,o=v+2*S;for(r=0;r<o;r++){var a=X*r,s=X*(r+1);d(t+n+a,t+i+a,t+i+s,t+n+s)}}}function u(e,t,n){m.push(e),m.push(t),m.push(n)}function h(e,t,n){p(e),p(t),p(n);var i=a.length/3,r=T.generateTopUV(o,a,i-3,i-2,i-1);f(r[0]),f(r[1]),f(r[2])}function d(e,t,n,i){p(e),p(t),p(i),p(t),p(n),p(i);var r=a.length/3,s=T.generateSideWallUV(o,a,r-6,r-3,r-2,r-1);f(s[0]),f(s[1]),f(s[3]),f(s[1]),f(s[2]),f(s[3])}function p(e){a.push(m[3*e+0]),a.push(m[3*e+1]),a.push(m[3*e+2])}function f(e){s.push(e.x),s.push(e.y)}var m=[],g=void 0!==t.curveSegments?t.curveSegments:12,v=void 0!==t.steps?t.steps:1,y=void 0!==t.depth?t.depth:100,b=void 0===t.bevelEnabled||t.bevelEnabled,w=void 0!==t.bevelThickness?t.bevelThickness:6,x=void 0!==t.bevelSize?t.bevelSize:w-2,E=void 0!==t.bevelOffset?t.bevelOffset:0,S=void 0!==t.bevelSegments?t.bevelSegments:3,_=t.extrudePath,T=void 0!==t.UVGenerator?t.UVGenerator:Va;void 0!==t.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),y=t.amount);var M,C,A,R,P,I,L,D,O=!1;_&&(M=_.getSpacedPoints(v),O=!0,b=!1,C=_.computeFrenetFrames(v,!1),A=new r,R=new r,P=new r),b||(S=0,w=0,x=0,E=0);var k=e.extractPoints(g),F=k.shape,B=k.holes;if(!ja.isClockWise(F))for(F=F.reverse(),L=0,D=B.length;L<D;L++)I=B[L],ja.isClockWise(I)&&(B[L]=I.reverse());var N=ja.triangulateShape(F,B),U=F;for(L=0,D=B.length;L<D;L++)I=B[L],F=F.concat(I);for(var z,G,H,j,V,W,X=F.length,q=N.length,Y=[],J=0,K=U.length,Z=K-1,Q=J+1;J<K;J++,Z++,Q++)Z===K&&(Z=0),Q===K&&(Q=0),Y[J]=c(U[J],U[Z],U[Q]);var $,ee,te=[],ne=Y.concat();for(L=0,D=B.length;L<D;L++){for(I=B[L],$=[],J=0,Z=(K=I.length)-1,Q=J+1;J<K;J++,Z++,Q++)Z===K&&(Z=0),Q===K&&(Q=0),$[J]=c(I[J],I[Z],I[Q]);te.push($),ne=ne.concat($)}for(z=0;z<S;z++){for(H=z/S,j=w*Math.cos(H*Math.PI/2),G=x*Math.sin(H*Math.PI/2)+E,J=0,K=U.length;J<K;J++)u((V=i(U[J],Y[J],G)).x,V.y,-j);for(L=0,D=B.length;L<D;L++)for(I=B[L],$=te[L],J=0,K=I.length;J<K;J++)u((V=i(I[J],$[J],G)).x,V.y,-j)}for(G=x+E,J=0;J<X;J++)V=b?i(F[J],ne[J],G):F[J],O?(R.copy(C.normals[0]).multiplyScalar(V.x),A.copy(C.binormals[0]).multiplyScalar(V.y),P.copy(M[0]).add(R).add(A),u(P.x,P.y,P.z)):u(V.x,V.y,0);for(ee=1;ee<=v;ee++)for(J=0;J<X;J++)V=b?i(F[J],ne[J],G):F[J],O?(R.copy(C.normals[ee]).multiplyScalar(V.x),A.copy(C.binormals[ee]).multiplyScalar(V.y),P.copy(M[ee]).add(R).add(A),u(P.x,P.y,P.z)):u(V.x,V.y,y/v*ee);for(z=S-1;z>=0;z--){for(H=z/S,j=w*Math.cos(H*Math.PI/2),G=x*Math.sin(H*Math.PI/2)+E,J=0,K=U.length;J<K;J++)u((V=i(U[J],Y[J],G)).x,V.y,y+j);for(L=0,D=B.length;L<D;L++)for(I=B[L],$=te[L],J=0,K=I.length;J<K;J++)V=i(I[J],$[J],G),O?u(V.x,V.y+M[v-1].y,M[v-1].x+j):u(V.x,V.y,y+j)}!function(){var e=a.length/3;if(b){var t=0,n=X*t;for(J=0;J<q;J++)h((W=N[J])[2]+n,W[1]+n,W[0]+n);for(n=X*(t=v+2*S),J=0;J<q;J++)h((W=N[J])[0]+n,W[1]+n,W[2]+n)}else{for(J=0;J<q;J++)h((W=N[J])[2],W[1],W[0]);for(J=0;J<q;J++)h((W=N[J])[0]+X*v,W[1]+X*v,W[2]+X*v)}o.addGroup(e,a.length/3-e,0)}(),function(){var e=a.length/3,t=0;for(l(U,t),t+=U.length,L=0,D=B.length;L<D;L++)l(I=B[L],t),t+=I.length;o.addGroup(e,a.length/3-e,1)}()}N.call(this),this.type="ExtrudeBufferGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];for(var o=this,a=[],s=[],c=0,l=e.length;c<l;c++)i(e[c]);this.addAttribute("position",new O(a,3)),this.addAttribute("uv",new O(s,2)),this.computeVertexNormals()}function Wn(e,t,n){if(n.shapes=[],Array.isArray(e))for(var i=0,r=e.length;i<r;i++){var o=e[i];n.shapes.push(o.uuid)}else n.shapes.push(e.uuid);return void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON()),n}function Xn(e,t){z.call(this),this.type="TextGeometry",this.parameters={text:e,parameters:t},this.fromBufferGeometry(new qn(e,t)),this.mergeVertices()}function qn(e,t){var n=(t=t||{}).font;if(!n||!n.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new z;var i=n.generateShapes(e,t.size);t.depth=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),Vn.call(this,i,t),this.type="TextBufferGeometry"}function Yn(e,t,n,i,r,o,a){z.call(this),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:i,phiLength:r,thetaStart:o,thetaLength:a},this.fromBufferGeometry(new Jn(e,t,n,i,r,o,a)),this.mergeVertices()}function Jn(e,t,n,i,o,a,s){N.call(this),this.type="SphereBufferGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:i,phiLength:o,thetaStart:a,thetaLength:s},e=e||1,t=Math.max(3,Math.floor(t)||8),n=Math.max(2,Math.floor(n)||6),i=void 0!==i?i:0,o=void 0!==o?o:2*Math.PI,a=void 0!==a?a:0,s=void 0!==s?s:Math.PI;var c,l,u=Math.min(a+s,Math.PI),h=0,d=[],p=new r,f=new r,m=[],g=[],v=[],y=[];for(l=0;l<=n;l++){var b=[],w=l/n,x=0;for(0==l&&0==a?x=.5/t:l==n&&u==Math.PI&&(x=-.5/t),c=0;c<=t;c++){var E=c/t;p.x=-e*Math.cos(i+E*o)*Math.sin(a+w*s),p.y=e*Math.cos(a+w*s),p.z=e*Math.sin(i+E*o)*Math.sin(a+w*s),g.push(p.x,p.y,p.z),f.copy(p).normalize(),v.push(f.x,f.y,f.z),y.push(E+x,1-w),b.push(h++)}d.push(b)}for(l=0;l<n;l++)for(c=0;c<t;c++){var S=d[l][c+1],_=d[l][c],T=d[l+1][c],M=d[l+1][c+1];(0!==l||a>0)&&m.push(S,_,M),(l!==n-1||u<Math.PI)&&m.push(_,T,M)}this.setIndex(m),this.addAttribute("position",new O(g,3)),this.addAttribute("normal",new O(v,3)),this.addAttribute("uv",new O(y,2))}function Kn(e,t,n,i,r,o){z.call(this),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:i,thetaStart:r,thetaLength:o},this.fromBufferGeometry(new Zn(e,t,n,i,r,o)),this.mergeVertices()}function Zn(e,t,i,o,a,s){N.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:i,phiSegments:o,thetaStart:a,thetaLength:s},e=e||.5,t=t||1,a=void 0!==a?a:0,s=void 0!==s?s:2*Math.PI,i=void 0!==i?Math.max(3,i):8;var c,l,u,h=[],d=[],p=[],f=[],m=e,g=(t-e)/(o=void 0!==o?Math.max(1,o):1),v=new r,y=new n;for(l=0;l<=o;l++){for(u=0;u<=i;u++)c=a+u/i*s,v.x=m*Math.cos(c),v.y=m*Math.sin(c),d.push(v.x,v.y,v.z),p.push(0,0,1),y.x=(v.x/t+1)/2,y.y=(v.y/t+1)/2,f.push(y.x,y.y);m+=g}for(l=0;l<o;l++){var b=l*(i+1);for(u=0;u<i;u++){var w=c=u+b,x=c+i+1,E=c+i+2,S=c+1;h.push(w,x,S),h.push(x,E,S)}}this.setIndex(h),this.addAttribute("position",new O(d,3)),this.addAttribute("normal",new O(p,3)),this.addAttribute("uv",new O(f,2))}function Qn(e,t,n,i){z.call(this),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:i},this.fromBufferGeometry(new $n(e,t,n,i)),this.mergeVertices()}function $n(e,t,i,o){N.call(this),this.type="LatheBufferGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:o},t=Math.floor(t)||12,i=i||0,o=o||2*Math.PI,o=Co.clamp(o,0,2*Math.PI);var a,s,c,l=[],u=[],h=[],d=1/t,p=new r,f=new n;for(s=0;s<=t;s++){var m=i+s*d*o,g=Math.sin(m),v=Math.cos(m);for(c=0;c<=e.length-1;c++)p.x=e[c].x*g,p.y=e[c].y,p.z=e[c].x*v,u.push(p.x,p.y,p.z),f.x=s/t,f.y=c/(e.length-1),h.push(f.x,f.y)}for(s=0;s<t;s++)for(c=0;c<e.length-1;c++){var y=a=c+s*e.length,b=a+e.length,w=a+e.length+1,x=a+1;l.push(y,b,x),l.push(b,w,x)}if(this.setIndex(l),this.addAttribute("position",new O(u,3)),this.addAttribute("uv",new O(h,2)),this.computeVertexNormals(),o===2*Math.PI){var E=this.attributes.normal.array,S=new r,_=new r,T=new r;for(a=t*e.length*3,s=0,c=0;s<e.length;s++,c+=3)S.x=E[c+0],S.y=E[c+1],S.z=E[c+2],_.x=E[a+c+0],_.y=E[a+c+1],_.z=E[a+c+2],T.addVectors(S,_).normalize(),E[c+0]=E[a+c+0]=T.x,E[c+1]=E[a+c+1]=T.y,E[c+2]=E[a+c+2]=T.z}}function ei(e,t){z.call(this),this.type="ShapeGeometry","object"==typeof t&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),t=t.curveSegments),this.parameters={shapes:e,curveSegments:t},this.fromBufferGeometry(new ti(e,t)),this.mergeVertices()}function ti(e,t){function n(e){var n,s,l,u=r.length/3,h=e.extractPoints(t),d=h.shape,p=h.holes;for(!1===ja.isClockWise(d)&&(d=d.reverse()),n=0,s=p.length;n<s;n++)l=p[n],!0===ja.isClockWise(l)&&(p[n]=l.reverse());var f=ja.triangulateShape(d,p);for(n=0,s=p.length;n<s;n++)l=p[n],d=d.concat(l);for(n=0,s=d.length;n<s;n++){var m=d[n];r.push(m.x,m.y,0),o.push(0,0,1),a.push(m.x,m.y)}for(n=0,s=f.length;n<s;n++){var g=f[n],v=g[0]+u,y=g[1]+u,b=g[2]+u;i.push(v,y,b),c+=3}}N.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:e,curveSegments:t},t=t||12;var i=[],r=[],o=[],a=[],s=0,c=0;if(!1===Array.isArray(e))n(e);else for(var l=0;l<e.length;l++)n(e[l]),this.addGroup(s,c,l),s+=c,c=0;this.setIndex(i),this.addAttribute("position",new O(r,3)),this.addAttribute("normal",new O(o,3)),this.addAttribute("uv",new O(a,2))}function ni(e,t){if(t.shapes=[],Array.isArray(e))for(var n=0,i=e.length;n<i;n++){var r=e[n];t.shapes.push(r.uuid)}else t.shapes.push(e.uuid);return t}function ii(e,t){N.call(this),this.type="EdgesGeometry",
this.parameters={thresholdAngle:t},t=void 0!==t?t:1;var n,i,r,o,a=[],s=Math.cos(Co.DEG2RAD*t),c=[0,0],l={},u=["a","b","c"];e.isBufferGeometry?(o=new z).fromBufferGeometry(e):o=e.clone(),o.mergeVertices(),o.computeFaceNormals();for(var h=o.vertices,d=o.faces,p=0,f=d.length;p<f;p++)for(var m=d[p],g=0;g<3;g++)n=m[u[g]],i=m[u[(g+1)%3]],c[0]=Math.min(n,i),c[1]=Math.max(n,i),void 0===l[r=c[0]+","+c[1]]?l[r]={index1:c[0],index2:c[1],face1:p,face2:void 0}:l[r].face2=p;for(r in l){var v=l[r];if(void 0===v.face2||d[v.face1].normal.dot(d[v.face2].normal)<=s){var y=h[v.index1];a.push(y.x,y.y,y.z),y=h[v.index2],a.push(y.x,y.y,y.z)}}this.addAttribute("position",new O(a,3))}function ri(e,t,n,i,r,o,a,s){z.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:i,heightSegments:r,openEnded:o,thetaStart:a,thetaLength:s},this.fromBufferGeometry(new oi(e,t,n,i,r,o,a,s)),this.mergeVertices()}function oi(e,t,i,o,a,s,c,l){function u(i){var a,s,u,v=new n,w=new r,x=0,E=!0===i?e:t,S=!0===i?1:-1;for(s=g,a=1;a<=o;a++)p.push(0,y*S,0),f.push(0,S,0),m.push(.5,.5),g++;for(u=g,a=0;a<=o;a++){var _=a/o*l+c,T=Math.cos(_),M=Math.sin(_);w.x=E*M,w.y=y*S,w.z=E*T,p.push(w.x,w.y,w.z),f.push(0,S,0),v.x=.5*T+.5,v.y=.5*M*S+.5,m.push(v.x,v.y),g++}for(a=0;a<o;a++){var C=s+a,A=u+a;!0===i?d.push(A,A+1,C):d.push(A+1,A,C),x+=3}h.addGroup(b,x,!0===i?1:2),b+=x}N.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:o,heightSegments:a,openEnded:s,thetaStart:c,thetaLength:l};var h=this;e=void 0!==e?e:1,t=void 0!==t?t:1,i=i||1,o=Math.floor(o)||8,a=Math.floor(a)||1,s=void 0!==s&&s,c=void 0!==c?c:0,l=void 0!==l?l:2*Math.PI;var d=[],p=[],f=[],m=[],g=0,v=[],y=i/2,b=0;!function(){var n,s,u=new r,w=new r,x=0,E=(t-e)/i;for(s=0;s<=a;s++){var S=[],_=s/a,T=_*(t-e)+e;for(n=0;n<=o;n++){var M=n/o,C=M*l+c,A=Math.sin(C),R=Math.cos(C);w.x=T*A,w.y=-_*i+y,w.z=T*R,p.push(w.x,w.y,w.z),u.set(A,E,R).normalize(),f.push(u.x,u.y,u.z),m.push(M,1-_),S.push(g++)}v.push(S)}for(n=0;n<o;n++)for(s=0;s<a;s++){var P=v[s][n],I=v[s+1][n],L=v[s+1][n+1],D=v[s][n+1];d.push(P,I,D),d.push(I,L,D),x+=6}h.addGroup(b,x,0),b+=x}(),!1===s&&(e>0&&u(!0),t>0&&u(!1)),this.setIndex(d),this.addAttribute("position",new O(p,3)),this.addAttribute("normal",new O(f,3)),this.addAttribute("uv",new O(m,2))}function ai(e,t,n,i,r,o,a){ri.call(this,0,e,t,n,i,r,o,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:i,openEnded:r,thetaStart:o,thetaLength:a}}function si(e,t,n,i,r,o,a){oi.call(this,0,e,t,n,i,r,o,a),this.type="ConeBufferGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:i,openEnded:r,thetaStart:o,thetaLength:a}}function ci(e,t,n,i){z.call(this),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:i},this.fromBufferGeometry(new li(e,t,n,i)),this.mergeVertices()}function li(e,t,i,o){N.call(this),this.type="CircleBufferGeometry",this.parameters={radius:e,segments:t,thetaStart:i,thetaLength:o},e=e||1,t=void 0!==t?Math.max(3,t):8,i=void 0!==i?i:0,o=void 0!==o?o:2*Math.PI;var a,s,c=[],l=[],u=[],h=[],d=new r,p=new n;for(l.push(0,0,0),u.push(0,0,1),h.push(.5,.5),s=0,a=3;s<=t;s++,a+=3){var f=i+s/t*o;d.x=e*Math.cos(f),d.y=e*Math.sin(f),l.push(d.x,d.y,d.z),u.push(0,0,1),p.x=(l[a]/e+1)/2,p.y=(l[a+1]/e+1)/2,h.push(p.x,p.y)}for(a=1;a<=t;a++)c.push(a,a+1,0);this.setIndex(c),this.addAttribute("position",new O(l,3)),this.addAttribute("normal",new O(u,3)),this.addAttribute("uv",new O(h,2))}function ui(e){_.call(this),this.type="ShadowMaterial",this.color=new b(0),this.transparent=!0,this.setValues(e)}function hi(e){W.call(this,e),this.type="RawShaderMaterial"}function di(e){_.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new b(16777215),this.roughness=.5,this.metalness=.5,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new b(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new n(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function pi(e){di.call(this),this.defines={PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.clearCoat=0,this.clearCoatRoughness=0,this.setValues(e)}function fi(e){_.call(this),this.type="MeshPhongMaterial",this.color=new b(16777215),this.specular=new b(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new b(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new n(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function mi(e){fi.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.gradientMap=null,this.setValues(e)}function gi(e){_.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new n(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function vi(e){_.call(this),this.type="MeshLambertMaterial",this.color=new b(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new b(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function yi(e){_.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new b(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new n(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.lights=!1,this.setValues(e)}function bi(e){Vt.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}function wi(e,t,n,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new t.constructor(n),this.sampleValues=t,this.valueSize=n}function xi(e,t,n,i){wi.call(this,e,t,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function Ei(e,t,n,i){wi.call(this,e,t,n,i)}function Si(e,t,n,i){wi.call(this,e,t,n,i)}function _i(e,t,n,i){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=qa.convertArray(t,this.TimeBufferType),this.values=qa.convertArray(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}function Ti(e,t,n){_i.call(this,e,t,n)}function Mi(e,t,n,i){_i.call(this,e,t,n,i)}function Ci(e,t,n,i){_i.call(this,e,t,n,i)}function Ai(e,t,n,i){wi.call(this,e,t,n,i)}function Ri(e,t,n,i){_i.call(this,e,t,n,i)}function Pi(e,t,n,i){_i.call(this,e,t,n,i)}function Ii(e,t,n,i){_i.call(this,e,t,n,i)}function Li(e,t,n){this.name=e,this.tracks=n,this.duration=void 0!==t?t:-1,this.uuid=Co.generateUUID(),this.duration<0&&this.resetDuration()}function Di(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Ci;case"vector":case"vector2":case"vector3":case"vector4":return Ii;case"color":return Mi;case"quaternion":return Ri;case"bool":case"boolean":return Ti;case"string":return Pi}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){var n=[],i=[];qa.flattenJSON(e.keys,n,i,"value"),e.times=n,e.values=i}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}function Oi(e,t,n){var i=this,r=!1,o=0,a=0,s=void 0;this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){a++,!1===r&&void 0!==i.onStart&&i.onStart(e,o,a),r=!0},this.itemEnd=function(e){o++,void 0!==i.onProgress&&i.onProgress(e,o,a),o===a&&(r=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(e){void 0!==i.onError&&i.onError(e)},this.resolveURL=function(e){return s?s(e):e},this.setURLModifier=function(e){return s=e,this}}function ki(e){this.manager=void 0!==e?e:Ja}function Fi(e){this.manager=void 0!==e?e:Ja}function Bi(e){this.manager=void 0!==e?e:Ja,this._parser=null}function Ni(e){this.manager=void 0!==e?e:Ja,this._parser=null}function Ui(e){this.manager=void 0!==e?e:Ja}function zi(e){this.manager=void 0!==e?e:Ja}function Gi(e){this.manager=void 0!==e?e:Ja}function Hi(){this.type="Curve",this.arcLengthDivisions=200}function ji(e,t,n,i,r,o,a,s){Hi.call(this),this.type="EllipseCurve",this.aX=e||0,this.aY=t||0,this.xRadius=n||1,this.yRadius=i||1,this.aStartAngle=r||0,this.aEndAngle=o||2*Math.PI,this.aClockwise=a||!1,this.aRotation=s||0}function Vi(e,t,n,i,r,o){ji.call(this,e,t,n,n,i,r,o),this.type="ArcCurve"}function Wi(){function e(e,o,a,s){t=e,n=a,i=-3*e+3*o-2*a-s,r=2*e-2*o+a+s}var t=0,n=0,i=0,r=0;return{initCatmullRom:function(t,n,i,r,o){e(n,i,o*(i-t),o*(r-n))},initNonuniformCatmullRom:function(t,n,i,r,o,a,s){var c=(n-t)/o-(i-t)/(o+a)+(i-n)/a,l=(i-n)/a-(r-n)/(a+s)+(r-i)/s;e(n,i,c*=a,l*=a)},calc:function(e){var o=e*e;return t+n*e+i*o+r*(o*e)}}}function Xi(e,t,n,i){Hi.call(this),this.type="CatmullRomCurve3",this.points=e||[],this.closed=t||!1,this.curveType=n||"centripetal",this.tension=i||.5}function qi(e,t,n,i,r){var o=.5*(i-t),a=.5*(r-n),s=e*e;return(2*n-2*i+o+a)*(e*s)+(-3*n+3*i-2*o-a)*s+o*e+n}function Yi(e,t,n,i){return function(e,t){var n=1-e;return n*n*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,n)+function(e,t){return e*e*t}(e,i)}function Ji(e,t,n,i,r){return function(e,t){var n=1-e;return n*n*n*t}(e,t)+function(e,t){var n=1-e;return 3*n*n*e*t}(e,n)+function(e,t){return 3*(1-e)*e*e*t}(e,i)+function(e,t){return e*e*e*t}(e,r)}function Ki(e,t,i,r){Hi.call(this),this.type="CubicBezierCurve",this.v0=e||new n,this.v1=t||new n,this.v2=i||new n,this.v3=r||new n}function Zi(e,t,n,i){Hi.call(this),this.type="CubicBezierCurve3",this.v0=e||new r,this.v1=t||new r,this.v2=n||new r,this.v3=i||new r}function Qi(e,t){Hi.call(this),this.type="LineCurve",this.v1=e||new n,this.v2=t||new n}function $i(e,t){Hi.call(this),this.type="LineCurve3",this.v1=e||new r,this.v2=t||new r}function er(e,t,i){Hi.call(this),this.type="QuadraticBezierCurve",this.v0=e||new n,this.v1=t||new n,this.v2=i||new n}function tr(e,t,n){Hi.call(this),this.type="QuadraticBezierCurve3",this.v0=e||new r,this.v1=t||new r,this.v2=n||new r}function nr(e){Hi.call(this),this.type="SplineCurve",this.points=e||[]}function ir(){Hi.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function rr(e){ir.call(this),this.type="Path",this.currentPoint=new n,e&&this.setFromPoints(e)}function or(e){rr.call(this,e),this.uuid=Co.generateUUID(),this.type="Shape",this.holes=[]}function ar(e,t){p.call(this),this.type="Light",this.color=new b(e),this.intensity=void 0!==t?t:1,this.receiveShadow=void 0}function sr(e,t,n){ar.call(this,e,n),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(p.DefaultUp),this.updateMatrix(),this.groundColor=new b(t)}function cr(e){this.camera=e,this.bias=0,this.radius=1,this.mapSize=new n(512,512),this.map=null,this.matrix=new u}function lr(){cr.call(this,new q(50,1,.5,500))}function ur(e,t,n,i,r,o){ar.call(this,e,t),this.type="SpotLight",this.position.copy(p.DefaultUp),this.updateMatrix(),this.target=new p,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(e){this.intensity=e/Math.PI}}),this.distance=void 0!==n?n:0,this.angle=void 0!==i?i:Math.PI/3,this.penumbra=void 0!==r?r:0,this.decay=void 0!==o?o:1,this.shadow=new lr}function hr(e,t,n,i){ar.call(this,e,t),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(e){this.intensity=e/(4*Math.PI)}}),this.distance=void 0!==n?n:0,this.decay=void 0!==i?i:1,this.shadow=new cr(new q(90,1,.5,500))}function dr(e,t,n,i,r,o){X.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=void 0!==e?e:-1,this.right=void 0!==t?t:1,this.top=void 0!==n?n:1,this.bottom=void 0!==i?i:-1,this.near=void 0!==r?r:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()}function pr(){cr.call(this,new dr(-5,5,5,-5,.5,500))}function fr(e,t){ar.call(this,e,t),this.type="DirectionalLight",this.position.copy(p.DefaultUp),this.updateMatrix(),this.target=new p,this.shadow=new pr}function mr(e,t){ar.call(this,e,t),this.type="AmbientLight",this.castShadow=void 0}function gr(e,t,n,i){ar.call(this,e,t),this.type="RectAreaLight",this.width=void 0!==n?n:10,this.height=void 0!==i?i:10}function vr(e){this.manager=void 0!==e?e:Ja,this.textures={}}function yr(){N.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}function br(e,t,n,i){"number"==typeof n&&(i=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),M.call(this,e,t,n),this.meshPerAttribute=i||1}function wr(e){this.manager=void 0!==e?e:Ja}function xr(e){this.manager=void 0!==e?e:Ja,this.resourcePath=""}function Er(e){"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.manager=void 0!==e?e:Ja,this.options=void 0}function Sr(){this.type="ShapePath",this.color=new b,this.subPaths=[],this.currentPath=null}function _r(e){this.type="Font",this.data=e}function Tr(e,t,n,i,r){var o=r.glyphs[e]||r.glyphs["?"];if(o){var a,s,c,l,u,h,d,p,f=new Sr;if(o.o)for(var m=o._cachedOutline||(o._cachedOutline=o.o.split(" ")),g=0,v=m.length;g<v;)switch(m[g++]){case"m":a=m[g++]*t+n,s=m[g++]*t+i,f.moveTo(a,s);break;case"l":a=m[g++]*t+n,s=m[g++]*t+i,f.lineTo(a,s);break;case"q":c=m[g++]*t+n,l=m[g++]*t+i,u=m[g++]*t+n,h=m[g++]*t+i,f.quadraticCurveTo(u,h,c,l);break;case"b":c=m[g++]*t+n,l=m[g++]*t+i,u=m[g++]*t+n,h=m[g++]*t+i,d=m[g++]*t+n,p=m[g++]*t+i,f.bezierCurveTo(u,h,d,p,c,l)}return{offsetX:o.ha*t,path:f}}console.error('THREE.Font: character "'+e+'" does not exists in font family '+r.familyName+".")}function Mr(e){this.manager=void 0!==e?e:Ja}function Cr(){}function Ar(e){this.manager=void 0!==e?e:Ja}function Rr(){this.coefficients=[];for(var e=0;e<9;e++)this.coefficients.push(new r)}function Pr(e,t){ar.call(this,void 0,t),this.sh=void 0!==e?e:new Rr}function Ir(e,t,n){Pr.call(this,void 0,n);var i=(new b).set(e),o=(new b).set(t),a=new r(i.r,i.g,i.b),s=new r(o.r,o.g,o.b),c=Math.sqrt(Math.PI),l=c*Math.sqrt(.75);this.sh.coefficients[0].copy(a).add(s).multiplyScalar(c),this.sh.coefficients[1].copy(a).sub(s).multiplyScalar(l)}function Lr(e,t){Pr.call(this,void 0,t);var n=(new b).set(e);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}function Dr(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new q,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new q,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1}function Or(e){this.autoStart=void 0===e||e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}function kr(){p.call(this),this.type="AudioListener",this.context=Ms.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0}function Fr(e){p.call(this),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.startTime=0,this.offset=0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this.filters=[]}function Br(e){Fr.call(this,e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}function Nr(e,t){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=void 0!==t?t:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}function Ur(e,t,n){this.binding=e,this.valueSize=n;var i,r=Float64Array;switch(t){case"quaternion":i=this._slerp;break;case"string":case"bool":r=Array,i=this._select;break;default:i=this._lerp}this.buffer=new r(4*n),this._mixBufferRegion=i,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}function zr(e,t,n){var i=n||Gr.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}function Gr(e,t,n){this.path=t,this.parsedPath=n||Gr.parseTrackName(t),this.node=Gr.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e}function Hr(){this.uuid=Co.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var e={};this._indicesByUUID=e;for(var t=0,n=arguments.length;t!==n;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var i=this;this.stats={objects:{get total(){return i._objects.length},get inUse(){return this.total-i.nCachedObjects_}},get bindingsPerObject(){return i._bindings.length}}}function jr(e,t,n){this._mixer=e,this._clip=t,this._localRoot=n||null;for(var i=t.tracks,r=i.length,o=new Array(r),a={endingStart:2400,endingEnd:2400},s=0;s!==r;++s){var c=i[s].createInterpolant(null);o[s]=c,c.settings=a}this._interpolantSettings=a,this._interpolants=o,this._propertyBindings=new Array(r),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}function Vr(e){this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}function Wr(e){"string"==typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}function Xr(e,t,n){Ft.call(this,e,t),this.meshPerAttribute=n||1}function qr(e,t,n,i){this.ray=new v(e,t),this.near=n||0,this.far=i||1/0,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function Yr(e,t){return e.distance-t.distance}function Jr(e,t,n,i){if(!1!==e.visible&&(e.raycast(t,n),!0===i))for(var r=e.children,o=0,a=r.length;o<a;o++)Jr(r[o],t,n,!0)}function Kr(e,t,n){return this.radius=void 0!==e?e:1,this.phi=void 0!==t?t:0,this.theta=void 0!==n?n:0,this}function Zr(e,t,n){return this.radius=void 0!==e?e:1,this.theta=void 0!==t?t:0,this.y=void 0!==n?n:0,this}function Qr(e,t){this.min=void 0!==e?e:new n(1/0,1/0),this.max=void 0!==t?t:new n(-1/0,-1/0)}function $r(e,t){this.start=void 0!==e?e:new r,this.end=void 0!==t?t:new r}function eo(e){p.call(this),this.material=e,this.render=function(){}}function to(e,t,n,i){this.object=e,this.size=void 0!==t?t:1;var r=void 0!==n?n:16711680,o=void 0!==i?i:1,a=0,s=this.object.geometry;s&&s.isGeometry?a=3*s.faces.length:s&&s.isBufferGeometry&&(a=s.attributes.normal.count);var c=new N,l=new O(2*a*3,3);c.addAttribute("position",l),Xt.call(this,c,new Vt({color:r,linewidth:o})),this.matrixAutoUpdate=!1,this.update()}function no(e,t){p.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;for(var n=new N,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],r=0,o=1;r<32;r++,o++){var a=r/32*Math.PI*2,s=o/32*Math.PI*2;i.push(Math.cos(a),Math.sin(a),1,Math.cos(s),Math.sin(s),1)}n.addAttribute("position",new O(i,3));var c=new Vt({fog:!1});this.cone=new Xt(n,c),this.add(this.cone),this.update()}function io(e){for(var t=function e(t){var n=[];t&&t.isBone&&n.push(t);for(var i=0;i<t.children.length;i++)n.push.apply(n,e(t.children[i]));return n}(e),n=new N,i=[],r=[],o=new b(0,0,1),a=new b(0,1,0),s=0;s<t.length;s++){var c=t[s];c.parent&&c.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),r.push(o.r,o.g,o.b),r.push(a.r,a.g,a.b))}n.addAttribute("position",new O(i,3)),n.addAttribute("color",new O(r,3));var l=new Vt({vertexColors:2,depthTest:!1,depthWrite:!1,transparent:!0});Xt.call(this,n,l),this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}function ro(e,t,n){this.light=e,this.light.updateMatrixWorld(),this.color=n;var i=new Jn(t,4,2),r=new T({wireframe:!0,fog:!1});U.call(this,i,r),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}function oo(e,t){this.type="RectAreaLightHelper",this.light=e,this.color=t;var n=new N;n.addAttribute("position",new O([1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),n.computeBoundingSphere();var i=new Vt({fog:!1});Wt.call(this,n,i);var r=new N;r.addAttribute("position",new O([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),r.computeBoundingSphere(),this.add(new U(r,new T({side:1,fog:!1}))),this.update()}function ao(e,t,n){p.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n;var i=new ln(t);i.rotateY(.5*Math.PI),this.material=new T({wireframe:!0,fog:!1}),void 0===this.color&&(this.material.vertexColors=2);var r=i.getAttribute("position"),o=new Float32Array(3*r.count);i.addAttribute("color",new M(o,3)),this.add(new U(i,this.material)),this.update()}function so(e,t){this.lightProbe=e,this.size=t;var n={GAMMA_OUTPUT:""},i=new W({defines:n,uniforms:{sh:{value:this.lightProbe.sh.coefficients},intensity:{value:this.lightProbe.intensity}},vertexShader:["varying vec3 vNormal;","void main() {","\tvNormal = normalize( normalMatrix * normal );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#define RECIPROCAL_PI 0.318309886","vec3 inverseTransformDirection( in vec3 normal, in mat4 matrix ) {","\t// matrix is assumed to be orthogonal","\treturn normalize( ( vec4( normal, 0.0 ) * matrix ).xyz );","}","vec3 linearToOutput( in vec3 a ) {","\t#ifdef GAMMA_OUTPUT","\t\treturn pow( a, vec3( 1.0 / float( GAMMA_FACTOR ) ) );","\t#else","\t\treturn a;","\t#endif","}","// source: https://graphics.stanford.edu/papers/envmap/envmap.pdf","vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {","\t// normal is assumed to have unit length","\tfloat x = normal.x, y = normal.y, z = normal.z;","\t// band 0","\tvec3 result = shCoefficients[ 0 ] * 0.886227;","\t// band 1","\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;","\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;","\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;","\t// band 2","\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;","\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;","\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );","\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;","\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );","\treturn result;","}","uniform vec3 sh[ 9 ]; // sh coefficients","uniform float intensity; // light probe intensity","varying vec3 vNormal;","void main() {","\tvec3 normal = normalize( vNormal );","\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );","\tvec3 irradiance = shGetIrradianceAt( worldNormal, sh );","\tvec3 outgoingLight = RECIPROCAL_PI * irradiance * intensity;","\toutgoingLight = linearToOutput( outgoingLight );","\tgl_FragColor = vec4( outgoingLight, 1.0 );","}"].join("\n")}),r=new Jn(1,32,16);U.call(this,r,i),this.onBeforeRender()}function co(e,t,n,i){e=e||10,t=t||10,n=new b(void 0!==n?n:4473924),i=new b(void 0!==i?i:8947848);for(var r=t/2,o=e/t,a=e/2,s=[],c=[],l=0,u=0,h=-a;l<=t;l++,h+=o){s.push(-a,0,h,a,0,h),s.push(h,0,-a,h,0,a);var d=l===r?n:i;d.toArray(c,u),u+=3,d.toArray(c,u),u+=3,d.toArray(c,u),u+=3,d.toArray(c,u),u+=3}var p=new N;p.addAttribute("position",new O(s,3)),p.addAttribute("color",new O(c,3));var f=new Vt({vertexColors:2});Xt.call(this,p,f)}function lo(e,t,n,i,r,o){e=e||10,t=t||16,n=n||8,i=i||64,r=new b(void 0!==r?r:4473924),o=new b(void 0!==o?o:8947848);var a,s,c,l,u,h,d,p=[],f=[];for(l=0;l<=t;l++)c=l/t*(2*Math.PI),a=Math.sin(c)*e,s=Math.cos(c)*e,p.push(0,0,0),p.push(a,0,s),d=1&l?r:o,f.push(d.r,d.g,d.b),f.push(d.r,d.g,d.b);for(l=0;l<=n;l++)for(d=1&l?r:o,h=e-e/n*l,u=0;u<i;u++)c=u/i*(2*Math.PI),a=Math.sin(c)*h,s=Math.cos(c)*h,p.push(a,0,s),f.push(d.r,d.g,d.b),c=(u+1)/i*(2*Math.PI),a=Math.sin(c)*h,s=Math.cos(c)*h,p.push(a,0,s),f.push(d.r,d.g,d.b);var m=new N;m.addAttribute("position",new O(p,3)),m.addAttribute("color",new O(f,3));var g=new Vt({vertexColors:2});Xt.call(this,m,g)}function uo(e,t,n,i){this.audio=e,this.range=t||1,this.divisionsInnerAngle=n||16,this.divisionsOuterAngle=i||2;var r=new N,o=this.divisionsInnerAngle+2*this.divisionsOuterAngle,a=new Float32Array(3*(3*o+3));r.addAttribute("position",new M(a,3));var s=new Vt({color:65280}),c=new Vt({color:16776960});Wt.call(this,r,[c,s]),this.update()}function ho(e,t,n,i){this.object=e,this.size=void 0!==t?t:1;var r=void 0!==n?n:16776960,o=void 0!==i?i:1,a=0,s=this.object.geometry;s&&s.isGeometry?a=s.faces.length:console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.");var c=new N,l=new O(2*a*3,3);c.addAttribute("position",l),Xt.call(this,c,new Vt({color:r,linewidth:o})),this.matrixAutoUpdate=!1,this.update()}function po(e,t,n){p.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,void 0===t&&(t=1);var i=new N;i.addAttribute("position",new O([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));var r=new Vt({fog:!1});this.lightPlane=new Wt(i,r),this.add(this.lightPlane),(i=new N).addAttribute("position",new O([0,0,0,0,0,1],3)),this.targetLine=new Wt(i,r),this.add(this.targetLine),this.update()}function fo(e){function t(e,t,i){n(e,i),n(t,i)}function n(e,t){o.push(0,0,0),a.push(t.r,t.g,t.b),void 0===s[e]&&(s[e]=[]),s[e].push(o.length/3-1)}var i=new N,r=new Vt({color:16777215,vertexColors:1}),o=[],a=[],s={},c=new b(16755200),l=new b(16711680),u=new b(43775),h=new b(16777215),d=new b(3355443);t("n1","n2",c),t("n2","n4",c),t("n4","n3",c),t("n3","n1",c),t("f1","f2",c),t("f2","f4",c),t("f4","f3",c),t("f3","f1",c),t("n1","f1",c),t("n2","f2",c),t("n3","f3",c),t("n4","f4",c),t("p","n1",l),t("p","n2",l),t("p","n3",l),t("p","n4",l),t("u1","u2",u),t("u2","u3",u),t("u3","u1",u),t("c","t",h),t("p","c",d),t("cn1","cn2",d),t("cn3","cn4",d),t("cf1","cf2",d),t("cf3","cf4",d),i.addAttribute("position",new O(o,3)),i.addAttribute("color",new O(a,3)),Xt.call(this,i,r),this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update()}function mo(e,t){this.object=e,void 0===t&&(t=16776960);var n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(24),r=new N;r.setIndex(new M(n,1)),r.addAttribute("position",new M(i,3)),Xt.call(this,r,new Vt({color:t})),this.matrixAutoUpdate=!1,this.update()}function go(e,t){this.type="Box3Helper",this.box=e,t=t||16776960;var n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new N;i.setIndex(new M(n,1)),i.addAttribute("position",new O([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),Xt.call(this,i,new Vt({color:t})),this.geometry.computeBoundingSphere()}function vo(e,t,n){this.type="PlaneHelper",this.plane=e,this.size=void 0===t?1:t;var i=void 0!==n?n:16776960,r=new N;r.addAttribute("position",new O([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),r.computeBoundingSphere(),Wt.call(this,r,new Vt({color:i}));var o=new N;o.addAttribute("position",new O([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),o.computeBoundingSphere(),this.add(new U(o,new T({color:i,opacity:.2,transparent:!0,depthWrite:!1})))}function yo(e,t,n,i,o,a){p.call(this),void 0===e&&(e=new r(0,0,1)),void 0===t&&(t=new r(0,0,0)),void 0===n&&(n=1),void 0===i&&(i=16776960),void 0===o&&(o=.2*n),void 0===a&&(a=.2*o),void 0===Es&&((Es=new N).addAttribute("position",new O([0,0,0,0,1,0],3)),(Ss=new oi(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(t),this.line=new Wt(Es,new Vt({color:i})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new U(Ss,new T({color:i})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,o,a)}function bo(e){var t=[0,0,0,e=e||1,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=new N;n.addAttribute("position",new O(t,3)),n.addAttribute("color",new O([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var i=new Vt({vertexColors:2});Xt.call(this,n,i)}function wo(e){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),Xi.call(this,e),this.type="catmullrom",this.closed=!0}function xo(e){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),Xi.call(this,e),this.type="catmullrom"}function Eo(e){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),Xi.call(this,e),this.type="catmullrom"}void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}),void 0===Math.sign&&(Math.sign=function(e){return e<0?-1:e>0?1:+e}),"name"in Function.prototype==0&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var i=arguments[n];if(null!=i)for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t}),Object.assign(t.prototype,{addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)},removeEventListener:function(e,t){if(void 0!==this._listeners){var n=this._listeners[e];if(void 0!==n){var i=n.indexOf(t);-1!==i&&n.splice(i,1)}}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var n=t.slice(0),i=0,r=n.length;i<r;i++)n[i].call(this,e)}}}});var So,_o,To,Mo,Co={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){for(var e=[],t=0;t<256;t++)e[t]=(t<16?"0":"")+t.toString(16);return function(){var t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0,r=4294967295*Math.random()|0
;return(e[255&t]+e[t>>8&255]+e[t>>16&255]+e[t>>24&255]+"-"+e[255&n]+e[n>>8&255]+"-"+e[n>>16&15|64]+e[n>>24&255]+"-"+e[63&i|128]+e[i>>8&255]+"-"+e[i>>16&255]+e[i>>24&255]+e[255&r]+e[r>>8&255]+e[r>>16&255]+e[r>>24&255]).toUpperCase()}}(),clamp:function(e,t,n){return Math.max(t,Math.min(n,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,n,i,r){return i+(e-t)*(r-i)/(n-t)},lerp:function(e,t,n){return(1-n)*e+n*t},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*Co.DEG2RAD},radToDeg:function(e){return e*Co.RAD2DEG},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}};Object.defineProperties(n.prototype,{width:{get:function(){return this.x},set:function(e){this.x=e}},height:{get:function(){return this.y},set:function(e){this.y=e}}}),Object.assign(n.prototype,{isVector2:!0,set:function(e,t){return this.x=e,this.y=t,this},setScalar:function(e){return this.x=e,this.y=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){return this.multiplyScalar(1/e)},applyMatrix3:function(e){var t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this},clampLength:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},cross:function(e){return this.x*e.y-this.y*e.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var e=Math.atan2(this.y,this.x);return e<0&&(e+=2*Math.PI),e},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,n=this.y-e.y;return t*t+n*n},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromBufferAttribute:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this},rotateAround:function(e,t){var n=Math.cos(t),i=Math.sin(t),r=this.x-e.x,o=this.y-e.y;return this.x=r*n-o*i+e.x,this.y=r*i+o*n+e.y,this}}),Object.assign(i,{slerp:function(e,t,n,i){return n.copy(e).slerp(t,i)},slerpFlat:function(e,t,n,i,r,o,a){var s=n[i+0],c=n[i+1],l=n[i+2],u=n[i+3],h=r[o+0],d=r[o+1],p=r[o+2],f=r[o+3];if(u!==f||s!==h||c!==d||l!==p){var m=1-a,g=s*h+c*d+l*p+u*f,v=g>=0?1:-1,y=1-g*g;if(y>Number.EPSILON){var b=Math.sqrt(y),w=Math.atan2(b,g*v);m=Math.sin(m*w)/b,a=Math.sin(a*w)/b}var x=a*v;if(s=s*m+h*x,c=c*m+d*x,l=l*m+p*x,u=u*m+f*x,m===1-a){var E=1/Math.sqrt(s*s+c*c+l*l+u*u);s*=E,c*=E,l*=E,u*=E}}e[t]=s,e[t+1]=c,e[t+2]=l,e[t+3]=u}}),Object.defineProperties(i.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},w:{get:function(){return this._w},set:function(e){this._w=e,this._onChangeCallback()}}}),Object.assign(i.prototype,{isQuaternion:!0,set:function(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this},setFromEuler:function(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var n=e._x,i=e._y,r=e._z,o=e.order,a=Math.cos,s=Math.sin,c=a(n/2),l=a(i/2),u=a(r/2),h=s(n/2),d=s(i/2),p=s(r/2);return"XYZ"===o?(this._x=h*l*u+c*d*p,this._y=c*d*u-h*l*p,this._z=c*l*p+h*d*u,this._w=c*l*u-h*d*p):"YXZ"===o?(this._x=h*l*u+c*d*p,this._y=c*d*u-h*l*p,this._z=c*l*p-h*d*u,this._w=c*l*u+h*d*p):"ZXY"===o?(this._x=h*l*u-c*d*p,this._y=c*d*u+h*l*p,this._z=c*l*p+h*d*u,this._w=c*l*u-h*d*p):"ZYX"===o?(this._x=h*l*u-c*d*p,this._y=c*d*u+h*l*p,this._z=c*l*p-h*d*u,this._w=c*l*u+h*d*p):"YZX"===o?(this._x=h*l*u+c*d*p,this._y=c*d*u+h*l*p,this._z=c*l*p-h*d*u,this._w=c*l*u-h*d*p):"XZY"===o&&(this._x=h*l*u-c*d*p,this._y=c*d*u-h*l*p,this._z=c*l*p+h*d*u,this._w=c*l*u+h*d*p),!1!==t&&this._onChangeCallback(),this},setFromAxisAngle:function(e,t){var n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this},setFromRotationMatrix:function(e){var t,n=e.elements,i=n[0],r=n[4],o=n[8],a=n[1],s=n[5],c=n[9],l=n[2],u=n[6],h=n[10],d=i+s+h;return d>0?(t=.5/Math.sqrt(d+1),this._w=.25/t,this._x=(u-c)*t,this._y=(o-l)*t,this._z=(a-r)*t):i>s&&i>h?(t=2*Math.sqrt(1+i-s-h),this._w=(u-c)/t,this._x=.25*t,this._y=(r+a)/t,this._z=(o+l)/t):s>h?(t=2*Math.sqrt(1+s-i-h),this._w=(o-l)/t,this._x=(r+a)/t,this._y=.25*t,this._z=(c+u)/t):(t=2*Math.sqrt(1+h-i-s),this._w=(a-r)/t,this._x=(o+l)/t,this._y=(c+u)/t,this._z=.25*t),this._onChangeCallback(),this},setFromUnitVectors:function(e,t){var n=e.dot(t)+1;return n<1e-6?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()},angleTo:function(e){return 2*Math.acos(Math.abs(Co.clamp(this.dot(e),-1,1)))},rotateTowards:function(e,t){var n=this.angleTo(e);if(0===n)return this;var i=Math.min(1,t/n);return this.slerp(e,i),this},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},premultiply:function(e){return this.multiplyQuaternions(e,this)},multiplyQuaternions:function(e,t){var n=e._x,i=e._y,r=e._z,o=e._w,a=t._x,s=t._y,c=t._z,l=t._w;return this._x=n*l+o*a+i*c-r*s,this._y=i*l+o*s+r*a-n*c,this._z=r*l+o*c+n*s-i*a,this._w=o*l-n*a-i*s-r*c,this._onChangeCallback(),this},slerp:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var n=this._x,i=this._y,r=this._z,o=this._w,a=o*e._w+n*e._x+i*e._y+r*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=n,this._y=i,this._z=r,this;var s=1-a*a;if(s<=Number.EPSILON){var c=1-t;return this._w=c*o+t*this._w,this._x=c*n+t*this._x,this._y=c*i+t*this._y,this._z=c*r+t*this._z,this.normalize(),this._onChangeCallback(),this}var l=Math.sqrt(s),u=Math.atan2(l,a),h=Math.sin((1-t)*u)/l,d=Math.sin(t*u)/l;return this._w=o*h+this._w*d,this._x=n*h+this._x*d,this._y=i*h+this._y*d,this._z=r*h+this._z*d,this._onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},_onChange:function(e){return this._onChangeCallback=e,this},_onChangeCallback:function(){}}),Object.assign(r.prototype,{isVector3:!0,set:function(e,t,n){return this.x=e,this.y=t,this.z=n,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:(_o=new i,function(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(_o.setFromEuler(e))}),applyAxisAngle:function(){var e=new i;return function(t,n){return this.applyQuaternion(e.setFromAxisAngle(t,n))}}(),applyMatrix3:function(e){var t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*i,this.y=r[1]*t+r[4]*n+r[7]*i,this.z=r[2]*t+r[5]*n+r[8]*i,this},applyMatrix4:function(e){var t=this.x,n=this.y,i=this.z,r=e.elements,o=1/(r[3]*t+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*i+r[12])*o,this.y=(r[1]*t+r[5]*n+r[9]*i+r[13])*o,this.z=(r[2]*t+r[6]*n+r[10]*i+r[14])*o,this},applyQuaternion:function(e){var t=this.x,n=this.y,i=this.z,r=e.x,o=e.y,a=e.z,s=e.w,c=s*t+o*i-a*n,l=s*n+a*t-r*i,u=s*i+r*n-o*t,h=-r*t-o*n-a*i;return this.x=c*s+h*-r+l*-a-u*-o,this.y=l*s+h*-o+u*-r-c*-a,this.z=u*s+h*-a+c*-o-l*-r,this},project:function(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)},unproject:function(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)},transformDirection:function(e){var t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i,this.y=r[1]*t+r[5]*n+r[9]*i,this.z=r[2]*t+r[6]*n+r[10]*i,this.normalize()},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this},clampLength:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)},cross:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)},crossVectors:function(e,t){var n=e.x,i=e.y,r=e.z,o=t.x,a=t.y,s=t.z;return this.x=i*s-r*a,this.y=r*o-n*s,this.z=n*a-i*o,this},projectOnVector:function(e){var t=e.dot(this)/e.lengthSq();return this.copy(e).multiplyScalar(t)},projectOnPlane:(So=new r,function(e){return So.copy(this).projectOnVector(e),this.sub(So)}),reflect:function(){var e=new r;return function(t){return this.sub(e.copy(t).multiplyScalar(2*this.dot(t)))}}(),angleTo:function(e){var t=this.dot(e)/Math.sqrt(this.lengthSq()*e.lengthSq());return Math.acos(Co.clamp(t,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)},setFromSpherical:function(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)},setFromSphericalCoords:function(e,t,n){var i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this},setFromCylindrical:function(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)},setFromCylindricalCoords:function(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this},setFromMatrixPosition:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this},setFromMatrixScale:function(e){var t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this},setFromMatrixColumn:function(e,t){return this.fromArray(e.elements,4*t)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromBufferAttribute:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}}),Object.assign(o.prototype,{isMatrix3:!0,set:function(e,t,n,i,r,o,a,s,c){var l=this.elements;return l[0]=e,l[1]=i,l[2]=a,l[3]=t,l[4]=r,l[5]=s,l[6]=n,l[7]=o,l[8]=c,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this},setFromMatrix4:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this},applyToBufferAttribute:function(e){void 0===To&&(To=new r);for(var t=0,n=e.count;t<n;t++)To.x=e.getX(t),To.y=e.getY(t),To.z=e.getZ(t),To.applyMatrix3(this),e.setXYZ(t,To.x,To.y,To.z);return e},multiply:function(e){return this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var n=e.elements,i=t.elements,r=this.elements,o=n[0],a=n[3],s=n[6],c=n[1],l=n[4],u=n[7],h=n[2],d=n[5],p=n[8],f=i[0],m=i[3],g=i[6],v=i[1],y=i[4],b=i[7],w=i[2],x=i[5],E=i[8];return r[0]=o*f+a*v+s*w,r[3]=o*m+a*y+s*x,r[6]=o*g+a*b+s*E,r[1]=c*f+l*v+u*w,r[4]=c*m+l*y+u*x,r[7]=c*g+l*b+u*E,r[2]=h*f+d*v+p*w,r[5]=h*m+d*y+p*x,r[8]=h*g+d*b+p*E,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],a=e[5],s=e[6],c=e[7],l=e[8];return t*o*l-t*a*c-n*r*l+n*a*s+i*r*c-i*o*s},getInverse:function(e,t){e&&e.isMatrix4&&console.error("THREE.Matrix3: .getInverse() no longer takes a Matrix4 argument.");var n=e.elements,i=this.elements,r=n[0],o=n[1],a=n[2],s=n[3],c=n[4],l=n[5],u=n[6],h=n[7],d=n[8],p=d*c-l*h,f=l*u-d*s,m=h*s-c*u,g=r*p+o*f+a*m;if(0===g){var v="THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(v);return console.warn(v),this.identity()}var y=1/g;return i[0]=p*y,i[1]=(a*h-d*o)*y,i[2]=(l*o-a*c)*y,i[3]=f*y,i[4]=(d*r-a*u)*y,i[5]=(a*s-l*r)*y,i[6]=m*y,i[7]=(o*u-h*r)*y,i[8]=(c*r-o*s)*y,this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(e){return this.setFromMatrix4(e).getInverse(this).transpose()},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},setUvTransform:function(e,t,n,i,r,o,a){var s=Math.cos(r),c=Math.sin(r);this.set(n*s,n*c,-n*(s*o+c*a)+o+e,-i*c,i*s,-i*(-c*o+s*a)+a+t,0,0,1)},scale:function(e,t){var n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this},rotate:function(e){var t=Math.cos(e),n=Math.sin(e),i=this.elements,r=i[0],o=i[3],a=i[6],s=i[1],c=i[4],l=i[7];return i[0]=t*r+n*s,i[3]=t*o+n*c,i[6]=t*a+n*l,i[1]=-n*r+t*s,i[4]=-n*o+t*c,i[7]=-n*a+t*l,this},translate:function(e,t){var n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this},equals:function(e){for(var t=this.elements,n=e.elements,i=0;i<9;i++)if(t[i]!==n[i])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var n=0;n<9;n++)this.elements[n]=e[n+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}});var Ao,Ro,Po,Io,Lo,Do,Oo,ko,Fo,Bo={getDataURL:function(e){var t;if("undefined"==typeof HTMLCanvasElement)return e.src;if(e instanceof HTMLCanvasElement)t=e;else{void 0===Mo&&(Mo=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),Mo.width=e.width,Mo.height=e.height;var n=Mo.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=Mo}return t.width>2048||t.height>2048?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}},No=0;a.DEFAULT_IMAGE=void 0,a.DEFAULT_MAPPING=300,a.prototype=Object.assign(Object.create(t.prototype),{constructor:a,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},toJSON:function(e){var t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];var n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){var i=this.image;if(void 0===i.uuid&&(i.uuid=Co.generateUUID()),!t&&void 0===e.images[i.uuid]){var r;if(Array.isArray(i)){r=[];for(var o=0,a=i.length;o<a;o++)r.push(Bo.getDataURL(i[o]))}else r=Bo.getDataURL(i);e.images[i.uuid]={uuid:i.uuid,url:r}}n.image=i.uuid}return t||(e.textures[this.uuid]=n),n},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case 1e3:e.x=e.x-Math.floor(e.x);break;case 1001:e.x=e.x<0?0:1;break;case 1002:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case 1e3:e.y=e.y-Math.floor(e.y);break;case 1001:e.y=e.y<0?0:1;break;case 1002:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}}),Object.defineProperty(a.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.defineProperties(s.prototype,{width:{get:function(){return this.z},set:function(e){this.z=e}},height:{get:function(){return this.w},set:function(e){this.w=e}}}),Object.assign(s.prototype,{isVector4:!0,set:function(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,n=this.y,i=this.z,r=this.w,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*i+o[12]*r,this.y=o[1]*t+o[5]*n+o[9]*i+o[13]*r,this.z=o[2]*t+o[6]*n+o[10]*i+o[14]*r,this.w=o[3]*t+o[7]*n+o[11]*i+o[15]*r,this},divideScalar:function(e){return this.multiplyScalar(1/e)},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,n,i,r,o=e.elements,a=o[0],s=o[4],c=o[8],l=o[1],u=o[5],h=o[9],d=o[2],p=o[6],f=o[10];if(Math.abs(s-l)<.01&&Math.abs(c-d)<.01&&Math.abs(h-p)<.01){if(Math.abs(s+l)<.1&&Math.abs(c+d)<.1&&Math.abs(h+p)<.1&&Math.abs(a+u+f-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;var m=(a+1)/2,g=(u+1)/2,v=(f+1)/2,y=(s+l)/4,b=(c+d)/4,w=(h+p)/4;return m>g&&m>v?m<.01?(n=0,i=.707106781,r=.707106781):(i=y/(n=Math.sqrt(m)),r=b/n):g>v?g<.01?(n=.707106781,i=0,r=.707106781):(n=y/(i=Math.sqrt(g)),r=w/i):v<.01?(n=.707106781,i=.707106781,r=0):(n=b/(r=Math.sqrt(v)),i=w/r),this.set(n,i,r,t),this}var x=Math.sqrt((p-h)*(p-h)+(c-d)*(c-d)+(l-s)*(l-s));return Math.abs(x)<.001&&(x=1),this.x=(p-h)/x,this.y=(c-d)/x,this.z=(l-s)/x,this.w=Math.acos((a+u+f-1)/2),this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this},clampLength:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},lerpVectors:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},fromBufferAttribute:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}}),c.prototype=Object.assign(Object.create(t.prototype),{constructor:c,isWebGLRenderTarget:!0,setSize:function(e,t){this.width===e&&this.height===t||(this.width=e,this.height=t,this.texture.image.width=e,this.texture.image.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),l.prototype=Object.assign(Object.create(c.prototype),{constructor:l,isWebGLMultisampleRenderTarget:!0,copy:function(e){return c.prototype.copy.call(this,e),this.samples=e.samples,this}}),Object.assign(u.prototype,{isMatrix4:!0,set:function(e,t,n,i,r,o,a,s,c,l,u,h,d,p,f,m){var g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=i,g[1]=r,g[5]=o,g[9]=a,g[13]=s,g[2]=c,g[6]=l,g[10]=u,g[14]=h,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){
return(new u).fromArray(this.elements)},copy:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this},copyPosition:function(e){var t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this},extractBasis:function(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this},makeBasis:function(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this},extractRotation:function(){var e=new r;return function(t){var n=this.elements,i=t.elements,r=1/e.setFromMatrixColumn(t,0).length(),o=1/e.setFromMatrixColumn(t,1).length(),a=1/e.setFromMatrixColumn(t,2).length();return n[0]=i[0]*r,n[1]=i[1]*r,n[2]=i[2]*r,n[3]=0,n[4]=i[4]*o,n[5]=i[5]*o,n[6]=i[6]*o,n[7]=0,n[8]=i[8]*a,n[9]=i[9]*a,n[10]=i[10]*a,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}}(),makeRotationFromEuler:function(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,n=e.x,i=e.y,r=e.z,o=Math.cos(n),a=Math.sin(n),s=Math.cos(i),c=Math.sin(i),l=Math.cos(r),u=Math.sin(r);if("XYZ"===e.order){var h=o*l,d=o*u,p=a*l,f=a*u;t[0]=s*l,t[4]=-s*u,t[8]=c,t[1]=d+p*c,t[5]=h-f*c,t[9]=-a*s,t[2]=f-h*c,t[6]=p+d*c,t[10]=o*s}else if("YXZ"===e.order){var m=s*l,g=s*u,v=c*l,y=c*u;t[0]=m+y*a,t[4]=v*a-g,t[8]=o*c,t[1]=o*u,t[5]=o*l,t[9]=-a,t[2]=g*a-v,t[6]=y+m*a,t[10]=o*s}else if("ZXY"===e.order)m=s*l,g=s*u,v=c*l,y=c*u,t[0]=m-y*a,t[4]=-o*u,t[8]=v+g*a,t[1]=g+v*a,t[5]=o*l,t[9]=y-m*a,t[2]=-o*c,t[6]=a,t[10]=o*s;else if("ZYX"===e.order)h=o*l,d=o*u,p=a*l,f=a*u,t[0]=s*l,t[4]=p*c-d,t[8]=h*c+f,t[1]=s*u,t[5]=f*c+h,t[9]=d*c-p,t[2]=-c,t[6]=a*s,t[10]=o*s;else if("YZX"===e.order){var b=o*s,w=o*c,x=a*s,E=a*c;t[0]=s*l,t[4]=E-b*u,t[8]=x*u+w,t[1]=u,t[5]=o*l,t[9]=-a*l,t[2]=-c*l,t[6]=w*u+x,t[10]=b-E*u}else"XZY"===e.order&&(b=o*s,w=o*c,x=a*s,E=a*c,t[0]=s*l,t[4]=-u,t[8]=c*l,t[1]=b*u+E,t[5]=o*l,t[9]=w*u-x,t[2]=x*u-w,t[6]=a*l,t[10]=E*u+b);return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromQuaternion:(Do=new r(0,0,0),Oo=new r(1,1,1),function(e){return this.compose(Do,e,Oo)}),lookAt:(Po=new r,Io=new r,Lo=new r,function(e,t,n){var i=this.elements;return Lo.subVectors(e,t),0===Lo.lengthSq()&&(Lo.z=1),Lo.normalize(),Po.crossVectors(n,Lo),0===Po.lengthSq()&&(1===Math.abs(n.z)?Lo.x+=1e-4:Lo.z+=1e-4,Lo.normalize(),Po.crossVectors(n,Lo)),Po.normalize(),Io.crossVectors(Lo,Po),i[0]=Po.x,i[4]=Io.x,i[8]=Lo.x,i[1]=Po.y,i[5]=Io.y,i[9]=Lo.y,i[2]=Po.z,i[6]=Io.z,i[10]=Lo.z,this}),multiply:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var n=e.elements,i=t.elements,r=this.elements,o=n[0],a=n[4],s=n[8],c=n[12],l=n[1],u=n[5],h=n[9],d=n[13],p=n[2],f=n[6],m=n[10],g=n[14],v=n[3],y=n[7],b=n[11],w=n[15],x=i[0],E=i[4],S=i[8],_=i[12],T=i[1],M=i[5],C=i[9],A=i[13],R=i[2],P=i[6],I=i[10],L=i[14],D=i[3],O=i[7],k=i[11],F=i[15];return r[0]=o*x+a*T+s*R+c*D,r[4]=o*E+a*M+s*P+c*O,r[8]=o*S+a*C+s*I+c*k,r[12]=o*_+a*A+s*L+c*F,r[1]=l*x+u*T+h*R+d*D,r[5]=l*E+u*M+h*P+d*O,r[9]=l*S+u*C+h*I+d*k,r[13]=l*_+u*A+h*L+d*F,r[2]=p*x+f*T+m*R+g*D,r[6]=p*E+f*M+m*P+g*O,r[10]=p*S+f*C+m*I+g*k,r[14]=p*_+f*A+m*L+g*F,r[3]=v*x+y*T+b*R+w*D,r[7]=v*E+y*M+b*P+w*O,r[11]=v*S+y*C+b*I+w*k,r[15]=v*_+y*A+b*L+w*F,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},applyToBufferAttribute:function(){var e=new r;return function(t){for(var n=0,i=t.count;n<i;n++)e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.applyMatrix4(this),t.setXYZ(n,e.x,e.y,e.z);return t}}(),determinant:function(){var e=this.elements,t=e[0],n=e[4],i=e[8],r=e[12],o=e[1],a=e[5],s=e[9],c=e[13],l=e[2],u=e[6],h=e[10],d=e[14];return e[3]*(+r*s*u-i*c*u-r*a*h+n*c*h+i*a*d-n*s*d)+e[7]*(+t*s*d-t*c*h+r*o*h-i*o*d+i*c*l-r*s*l)+e[11]*(+t*c*u-t*a*d-r*o*u+n*o*d+r*a*l-n*c*l)+e[15]*(-i*a*l-t*s*u+t*a*h+i*o*u-n*o*h+n*s*l)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},setPosition:function(e,t,n){var i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this},getInverse:function(e,t){var n=this.elements,i=e.elements,r=i[0],o=i[1],a=i[2],s=i[3],c=i[4],l=i[5],u=i[6],h=i[7],d=i[8],p=i[9],f=i[10],m=i[11],g=i[12],v=i[13],y=i[14],b=i[15],w=p*y*h-v*f*h+v*u*m-l*y*m-p*u*b+l*f*b,x=g*f*h-d*y*h-g*u*m+c*y*m+d*u*b-c*f*b,E=d*v*h-g*p*h+g*l*m-c*v*m-d*l*b+c*p*b,S=g*p*u-d*v*u-g*l*f+c*v*f+d*l*y-c*p*y,_=r*w+o*x+a*E+s*S;if(0===_){var T="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(T);return console.warn(T),this.identity()}var M=1/_;return n[0]=w*M,n[1]=(v*f*s-p*y*s-v*a*m+o*y*m+p*a*b-o*f*b)*M,n[2]=(l*y*s-v*u*s+v*a*h-o*y*h-l*a*b+o*u*b)*M,n[3]=(p*u*s-l*f*s-p*a*h+o*f*h+l*a*m-o*u*m)*M,n[4]=x*M,n[5]=(d*y*s-g*f*s+g*a*m-r*y*m-d*a*b+r*f*b)*M,n[6]=(g*u*s-c*y*s-g*a*h+r*y*h+c*a*b-r*u*b)*M,n[7]=(c*f*s-d*u*s+d*a*h-r*f*h-c*a*m+r*u*m)*M,n[8]=E*M,n[9]=(g*p*s-d*v*s-g*o*m+r*v*m+d*o*b-r*p*b)*M,n[10]=(c*v*s-g*l*s+g*o*h-r*v*h-c*o*b+r*l*b)*M,n[11]=(d*l*s-c*p*s-d*o*h+r*p*h+c*o*m-r*l*m)*M,n[12]=S*M,n[13]=(d*v*a-g*p*a+g*o*f-r*v*f-d*o*y+r*p*y)*M,n[14]=(g*l*a-c*v*a-g*o*u+r*v*u+c*o*y-r*l*y)*M,n[15]=(c*p*a-d*l*a+d*o*u-r*p*u-c*o*f+r*l*f)*M,this},scale:function(e){var t=this.elements,n=e.x,i=e.y,r=e.z;return t[0]*=n,t[4]*=i,t[8]*=r,t[1]*=n,t[5]*=i,t[9]*=r,t[2]*=n,t[6]*=i,t[10]*=r,t[3]*=n,t[7]*=i,t[11]*=r,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))},makeTranslation:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var n=Math.cos(t),i=Math.sin(t),r=1-n,o=e.x,a=e.y,s=e.z,c=r*o,l=r*a;return this.set(c*o+n,c*a-i*s,c*s+i*a,0,c*a+i*s,l*a+n,l*s-i*o,0,c*s-i*a,l*s+i*o,r*s*s+n,0,0,0,0,1),this},makeScale:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this},makeShear:function(e,t,n){return this.set(1,t,n,0,e,1,n,0,e,t,1,0,0,0,0,1),this},compose:function(e,t,n){var i=this.elements,r=t._x,o=t._y,a=t._z,s=t._w,c=r+r,l=o+o,u=a+a,h=r*c,d=r*l,p=r*u,f=o*l,m=o*u,g=a*u,v=s*c,y=s*l,b=s*u,w=n.x,x=n.y,E=n.z;return i[0]=(1-(f+g))*w,i[1]=(d+b)*w,i[2]=(p-y)*w,i[3]=0,i[4]=(d-b)*x,i[5]=(1-(h+g))*x,i[6]=(m+v)*x,i[7]=0,i[8]=(p+y)*E,i[9]=(m-v)*E,i[10]=(1-(h+f))*E,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this},decompose:(Ao=new r,Ro=new u,function(e,t,n){var i=this.elements,r=Ao.set(i[0],i[1],i[2]).length(),o=Ao.set(i[4],i[5],i[6]).length(),a=Ao.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),e.x=i[12],e.y=i[13],e.z=i[14],Ro.copy(this);var s=1/r,c=1/o,l=1/a;return Ro.elements[0]*=s,Ro.elements[1]*=s,Ro.elements[2]*=s,Ro.elements[4]*=c,Ro.elements[5]*=c,Ro.elements[6]*=c,Ro.elements[8]*=l,Ro.elements[9]*=l,Ro.elements[10]*=l,t.setFromRotationMatrix(Ro),n.x=r,n.y=o,n.z=a,this}),makePerspective:function(e,t,n,i,r,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var a=this.elements,s=2*r/(t-e),c=2*r/(n-i),l=(t+e)/(t-e),u=(n+i)/(n-i),h=-(o+r)/(o-r),d=-2*o*r/(o-r);return a[0]=s,a[4]=0,a[8]=l,a[12]=0,a[1]=0,a[5]=c,a[9]=u,a[13]=0,a[2]=0,a[6]=0,a[10]=h,a[14]=d,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this},makeOrthographic:function(e,t,n,i,r,o){var a=this.elements,s=1/(t-e),c=1/(n-i),l=1/(o-r),u=(t+e)*s,h=(n+i)*c,d=(o+r)*l;return a[0]=2*s,a[4]=0,a[8]=0,a[12]=-u,a[1]=0,a[5]=2*c,a[9]=0,a[13]=-h,a[2]=0,a[6]=0,a[10]=-2*l,a[14]=-d,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},equals:function(e){for(var t=this.elements,n=e.elements,i=0;i<16;i++)if(t[i]!==n[i])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var n=0;n<16;n++)this.elements[n]=e[n+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}),h.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],h.DefaultOrder="XYZ",Object.defineProperties(h.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},order:{get:function(){return this._order},set:function(e){this._order=e,this._onChangeCallback()}}}),Object.assign(h.prototype,{isEuler:!0,set:function(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._order=i||this._order,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this},setFromRotationMatrix:function(e,t,n){var i=Co.clamp,r=e.elements,o=r[0],a=r[4],s=r[8],c=r[1],l=r[5],u=r[9],h=r[2],d=r[6],p=r[10];return"XYZ"===(t=t||this._order)?(this._y=Math.asin(i(s,-1,1)),Math.abs(s)<.99999?(this._x=Math.atan2(-u,p),this._z=Math.atan2(-a,o)):(this._x=Math.atan2(d,l),this._z=0)):"YXZ"===t?(this._x=Math.asin(-i(u,-1,1)),Math.abs(u)<.99999?(this._y=Math.atan2(s,p),this._z=Math.atan2(c,l)):(this._y=Math.atan2(-h,o),this._z=0)):"ZXY"===t?(this._x=Math.asin(i(d,-1,1)),Math.abs(d)<.99999?(this._y=Math.atan2(-h,p),this._z=Math.atan2(-a,l)):(this._y=0,this._z=Math.atan2(c,o))):"ZYX"===t?(this._y=Math.asin(-i(h,-1,1)),Math.abs(h)<.99999?(this._x=Math.atan2(d,p),this._z=Math.atan2(c,o)):(this._x=0,this._z=Math.atan2(-a,l))):"YZX"===t?(this._z=Math.asin(i(c,-1,1)),Math.abs(c)<.99999?(this._x=Math.atan2(-u,l),this._y=Math.atan2(-h,o)):(this._x=0,this._y=Math.atan2(s,p))):"XZY"===t?(this._z=Math.asin(-i(a,-1,1)),Math.abs(a)<.99999?(this._x=Math.atan2(d,l),this._y=Math.atan2(s,o)):(this._x=Math.atan2(-u,p),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t),this._order=t,!1!==n&&this._onChangeCallback(),this},setFromQuaternion:function(e,t,n){return void 0===ko&&(ko=new u),ko.makeRotationFromQuaternion(e),this.setFromRotationMatrix(ko,t,n)},setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:function(e){return void 0===Fo&&(Fo=new i),Fo.setFromEuler(this),this.setFromQuaternion(Fo,e)},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new r(this._x,this._y,this._z)},_onChange:function(e){return this._onChangeCallback=e,this},_onChangeCallback:function(){}}),Object.assign(d.prototype,{set:function(e){this.mask=1<<e|0},enable:function(e){this.mask|=1<<e|0},toggle:function(e){this.mask^=1<<e|0},disable:function(e){this.mask&=~(1<<e|0)},test:function(e){return 0!=(this.mask&e.mask)}});var Uo,zo,Go,Ho,jo,Vo,Wo,Xo,qo,Yo,Jo,Ko,Zo,Qo,$o,ea,ta,na,ia,ra,oa=0;p.DefaultUp=new r(0,1,0),p.DefaultMatrixAutoUpdate=!0,p.prototype=Object.assign(Object.create(t.prototype),{constructor:p,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix:function(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(e){return this.quaternion.premultiply(e),this},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:(jo=new i,function(e,t){return jo.setFromAxisAngle(e,t),this.quaternion.multiply(jo),this}),rotateOnWorldAxis:function(){var e=new i;return function(t,n){return e.setFromAxisAngle(t,n),this.quaternion.premultiply(e),this}}(),rotateX:function(){var e=new r(1,0,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateY:function(){var e=new r(0,1,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateZ:function(){var e=new r(0,0,1);return function(t){return this.rotateOnAxis(e,t)}}(),translateOnAxis:function(){var e=new r;return function(t,n){return e.copy(t).applyQuaternion(this.quaternion),this.position.add(e.multiplyScalar(n)),this}}(),translateX:function(){var e=new r(1,0,0);return function(t){return this.translateOnAxis(e,t)}}(),translateY:function(){var e=new r(0,1,0);return function(t){return this.translateOnAxis(e,t)}}(),translateZ:function(){var e=new r(0,0,1);return function(t){return this.translateOnAxis(e,t)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:(Ho=new u,function(e){return e.applyMatrix4(Ho.getInverse(this.matrixWorld))}),lookAt:function(){var e=new i,t=new u,n=new r,o=new r;return function(i,r,a){i.isVector3?n.copy(i):n.set(i,r,a);var s=this.parent;this.updateWorldMatrix(!0,!1),o.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?t.lookAt(o,n,this.up):t.lookAt(n,o,this.up),this.quaternion.setFromRotationMatrix(t),s&&(t.extractRotation(s.matrixWorld),e.setFromRotationMatrix(t),this.quaternion.premultiply(e.inverse()))}}(),add:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent({type:"added"})):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)},remove:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}var n=this.children.indexOf(e);return-1!==n&&(e.parent=null,this.children.splice(n,1),e.dispatchEvent({type:"removed"})),this},attach:(Go=new u,function(e){return this.updateWorldMatrix(!0,!1),Go.getInverse(this.matrixWorld),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),Go.multiply(e.parent.matrixWorld)),e.applyMatrix(Go),e.updateWorldMatrix(!1,!1),this.add(e),this}),getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var n=0,i=this.children.length;n<i;n++){var r=this.children[n].getObjectByProperty(e,t);if(void 0!==r)return r}},getWorldPosition:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),e=new r),this.updateMatrixWorld(!0),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:(Uo=new r,zo=new r,function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),e=new i),this.updateMatrixWorld(!0),this.matrixWorld.decompose(Uo,e,zo),e}),getWorldScale:function(){var e=new r,t=new i;return function(n){return void 0===n&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),n=new r),this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,t,n),n}}(),getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),e=new r),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()},raycast:function(){},traverse:function(e){e(this);for(var t=this.children,n=0,i=t.length;n<i;n++)t[n].traverse(e)},traverseVisible:function(e){if(!1!==this.visible){e(this);for(var t=this.children,n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}},traverseAncestors:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=this.children,n=0,i=t.length;n<i;n++)t[n].updateMatrixWorld(e)},updateWorldMatrix:function(e,t){var n=this.parent;if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t)for(var i=this.children,r=0,o=i.length;r<o;r++)i[r].updateWorldMatrix(!1,!0)},toJSON:function(e){function t(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}function n(e){var t=[];for(var n in e){var i=e[n];delete i.metadata,t.push(i)}return t}var i=void 0===e||"string"==typeof e,r={};i&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{}},r.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var o={};if(o.uuid=this.uuid,o.type=this.type,""!==this.name&&(o.name=this.name),!0===this.castShadow&&(o.castShadow=!0),!0===this.receiveShadow&&(o.receiveShadow=!0),!1===this.visible&&(o.visible=!1),!1===this.frustumCulled&&(o.frustumCulled=!1),0!==this.renderOrder&&(o.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(o.userData=this.userData),o.layers=this.layers.mask,o.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(o.matrixAutoUpdate=!1),this.isMesh&&0!==this.drawMode&&(o.drawMode=this.drawMode),this.isMesh||this.isLine||this.isPoints){o.geometry=t(e.geometries,this.geometry);var a=this.geometry.parameters;if(void 0!==a&&void 0!==a.shapes){var s=a.shapes;if(Array.isArray(s))for(var c=0,l=s.length;c<l;c++){var u=s[c];t(e.shapes,u)}else t(e.shapes,s)}}if(void 0!==this.material)if(Array.isArray(this.material)){var h=[];for(c=0,l=this.material.length;c<l;c++)h.push(t(e.materials,this.material[c]));o.material=h}else o.material=t(e.materials,this.material);if(this.children.length>0)for(o.children=[],c=0;c<this.children.length;c++)o.children.push(this.children[c].toJSON(e).object);if(i){var d=n(e.geometries),p=n(e.materials),f=n(e.textures),m=n(e.images);s=n(e.shapes),d.length>0&&(r.geometries=d),p.length>0&&(r.materials=p),f.length>0&&(r.textures=f),m.length>0&&(r.images=m),s.length>0&&(r.shapes=s)}return r.object=o,r},clone:function(e){return(new this.constructor).copy(this,e)},copy:function(e,t){if(void 0===t&&(t=!0),this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(var n=0;n<e.children.length;n++){var i=e.children[n];this.add(i.clone())}return this}}),f.prototype=Object.assign(Object.create(p.prototype),{constructor:f,isScene:!0,copy:function(e,t){return p.prototype.copy.call(this,e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this},toJSON:function(e){var t=p.prototype.toJSON.call(this,e);return null!==this.background&&(t.object.background=this.background.toJSON(e)),null!==this.fog&&(t.object.fog=this.fog.toJSON()),t},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.assign(m.prototype,{isBox3:!0,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromArray:function(e){for(var t=1/0,n=1/0,i=1/0,r=-1/0,o=-1/0,a=-1/0,s=0,c=e.length;s<c;s+=3){var l=e[s],u=e[s+1],h=e[s+2];l<t&&(t=l),u<n&&(n=u),h<i&&(i=h),l>r&&(r=l),u>o&&(o=u),h>a&&(a=h)}return this.min.set(t,n,i),this.max.set(r,o,a),this},setFromBufferAttribute:function(e){for(var t=1/0,n=1/0,i=1/0,r=-1/0,o=-1/0,a=-1/0,s=0,c=e.count;s<c;s++){var l=e.getX(s),u=e.getY(s),h=e.getZ(s);l<t&&(t=l),u<n&&(n=u),h<i&&(i=h),l>r&&(r=l),u>o&&(o=u),h>a&&(a=h)}return this.min.set(t,n,i),this.max.set(r,o,a),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new r;return function(t,n){var i=e.copy(n).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}}(),setFromObject:function(e){return this.makeEmpty(),this.expandByObject(e)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(e){return void 0===e&&(console.warn("THREE.Box3: .getCenter() target is now required"),e=new r),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("THREE.Box3: .getSize() target is now required"),e=new r),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},expandByObject:function(){function e(e){var r=e.geometry;if(void 0!==r)if(r.isGeometry){var a=r.vertices;for(n=0,i=a.length;n<i;n++)o.copy(a[n]),o.applyMatrix4(e.matrixWorld),t.expandByPoint(o)}else if(r.isBufferGeometry){var s=r.attributes.position;if(void 0!==s)for(n=0,i=s.count;n<i;n++)o.fromBufferAttribute(s,n).applyMatrix4(e.matrixWorld),t.expandByPoint(o)}}var t,n,i,o=new r;return function(n){return t=this,n.updateMatrixWorld(!0),n.traverse(e),this}}(),containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .getParameter() target is now required"),t=new r),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},intersectsSphere:(Wo=new r,function(e){return this.clampPoint(e.center,Wo),Wo.distanceToSquared(e.center)<=e.radius*e.radius}),intersectsPlane:function(e){var t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant},intersectsTriangle:function(){function e(e){var r,o;for(r=0,o=e.length-3;r<=o;r+=3){c.fromArray(e,r);var a=u.x*Math.abs(c.x)+u.y*Math.abs(c.y)+u.z*Math.abs(c.z),s=t.dot(c),l=n.dot(c),h=i.dot(c);if(Math.max(-Math.max(s,l,h),Math.min(s,l,h))>a)return!1}return!0}var t=new r,n=new r,i=new r,o=new r,a=new r,s=new r,c=new r,l=new r,u=new r,h=new r;return function(r){if(this.isEmpty())return!1;this.getCenter(l),u.subVectors(this.max,l),t.subVectors(r.a,l),n.subVectors(r.b,l),i.subVectors(r.c,l),o.subVectors(n,t),a.subVectors(i,n),s.subVectors(t,i);var c=[0,-o.z,o.y,0,-a.z,a.y,0,-s.z,s.y,o.z,0,-o.x,a.z,0,-a.x,s.z,0,-s.x,-o.y,o.x,0,-a.y,a.x,0,-s.y,s.x,0];return!!e(c)&&!!e(c=[1,0,0,0,1,0,0,0,1])&&(h.crossVectors(o,a),e(c=[h.x,h.y,h.z]))}}(),clampPoint:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .clampPoint() target is now required"),t=new r),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new r;return function(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),getBoundingSphere:function(){var e=new r;return function(t){return void 0===t&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(t.center),t.radius=.5*this.getSize(e).length(),t}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:(Vo=[new r,new r,new r,new r,new r,new r,new r,new r],function(e){return this.isEmpty()||(Vo[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Vo[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Vo[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Vo[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Vo[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Vo[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Vo[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Vo[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Vo)),this}),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}),Object.assign(g.prototype,{set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:function(e,t){void 0===Xo&&(Xo=new m);var n=this.center;void 0!==t?n.copy(t):Xo.setFromPoints(e).getCenter(n);for(var i=0,r=0,o=e.length;r<o;r++)i=Math.max(i,n.distanceToSquared(e[r]));return this.radius=Math.sqrt(i),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},intersectsBox:function(e){return e.intersectsSphere(this)},intersectsPlane:function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius},clampPoint:function(e,t){var n=this.center.distanceToSquared(e);return void 0===t&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),t=new r),t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t},getBoundingBox:function(e){return void 0===e&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),e=new m),e.set(this.center,this.center),e.expandByScalar(this.radius),e},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius}}),Object.assign(v.prototype,{set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){return void 0===t&&(console.warn("THREE.Ray: .at() target is now required"),t=new r),t.copy(this.direction).multiplyScalar(e).add(this.origin)},lookAt:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this},recast:function(){var e=new r;return function(t){return this.origin.copy(this.at(t,e)),this}}(),closestPointToPoint:function(e,t){void 0===t&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),t=new r),t.subVectors(e,this.origin);var n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)},distanceToPoint:function(e){return Math.sqrt(this.distanceSqToPoint(e))},distanceSqToPoint:function(){var e=new r;return function(t){var n=e.subVectors(t,this.origin).dot(this.direction);return n<0?this.origin.distanceToSquared(t):(e.copy(this.direction).multiplyScalar(n).add(this.origin),e.distanceToSquared(t))}}(),distanceSqToSegment:(Yo=new r,Jo=new r,Ko=new r,function(e,t,n,i){Yo.copy(e).add(t).multiplyScalar(.5),Jo.copy(t).sub(e).normalize(),Ko.copy(this.origin).sub(Yo);var r,o,a,s,c=.5*e.distanceTo(t),l=-this.direction.dot(Jo),u=Ko.dot(this.direction),h=-Ko.dot(Jo),d=Ko.lengthSq(),p=Math.abs(1-l*l);if(p>0)if(o=l*u-h,s=c*p,(r=l*h-u)>=0)if(o>=-s)if(o<=s){var f=1/p;a=(r*=f)*(r+l*(o*=f)+2*u)+o*(l*r+o+2*h)+d}else o=c,a=-(r=Math.max(0,-(l*o+u)))*r+o*(o+2*h)+d;else o=-c,a=-(r=Math.max(0,-(l*o+u)))*r+o*(o+2*h)+d;else o<=-s?a=-(r=Math.max(0,-(-l*c+u)))*r+(o=r>0?-c:Math.min(Math.max(-c,-h),c))*(o+2*h)+d:o<=s?(r=0,a=(o=Math.min(Math.max(-c,-h),c))*(o+2*h)+d):a=-(r=Math.max(0,-(l*c+u)))*r+(o=r>0?c:Math.min(Math.max(-c,-h),c))*(o+2*h)+d;else o=l>0?-c:c,a=-(r=Math.max(0,-(l*o+u)))*r+o*(o+2*h)+d;return n&&n.copy(this.direction).multiplyScalar(r).add(this.origin),i&&i.copy(Jo).multiplyScalar(o).add(Yo),a}),intersectSphere:function(){var e=new r;return function(t,n){e.subVectors(t.center,this.origin);var i=e.dot(this.direction),r=e.dot(e)-i*i,o=t.radius*t.radius;if(r>o)return null;var a=Math.sqrt(o-r),s=i-a,c=i+a;return s<0&&c<0?null:s<0?this.at(c,n):this.at(s,n)}}(),intersectsSphere:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;var n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null},intersectPlane:function(e,t){var n=this.distanceToPlane(e);return null===n?null:this.at(n,t)},intersectsPlane:function(e){var t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0},intersectBox:function(e,t){var n,i,r,o,a,s,c=1/this.direction.x,l=1/this.direction.y,u=1/this.direction.z,h=this.origin;return c>=0?(n=(e.min.x-h.x)*c,i=(e.max.x-h.x)*c):(n=(e.max.x-h.x)*c,i=(e.min.x-h.x)*c),l>=0?(r=(e.min.y-h.y)*l,o=(e.max.y-h.y)*l):(r=(e.max.y-h.y)*l,o=(e.min.y-h.y)*l),n>o||r>i?null:((r>n||n!=n)&&(n=r),(o<i||i!=i)&&(i=o),u>=0?(a=(e.min.z-h.z)*u,s=(e.max.z-h.z)*u):(a=(e.max.z-h.z)*u,s=(e.min.z-h.z)*u),n>s||a>i?null:((a>n||n!=n)&&(n=a),(s<i||i!=i)&&(i=s),i<0?null:this.at(n>=0?n:i,t)))},intersectsBox:(qo=new r,function(e){return null!==this.intersectBox(e,qo)}),intersectTriangle:function(){var e=new r,t=new r,n=new r,i=new r;return function(r,o,a,s,c){t.subVectors(o,r),n.subVectors(a,r),i.crossVectors(t,n);var l,u=this.direction.dot(i);if(u>0){if(s)return null;l=1}else{if(!(u<0))return null;l=-1,u=-u}e.subVectors(this.origin,r);var h=l*this.direction.dot(n.crossVectors(e,n));if(h<0)return null;var d=l*this.direction.dot(t.cross(e));if(d<0)return null;if(h+d>u)return null;var p=-l*e.dot(i)
;return p<0?null:this.at(p/u,c)}}(),applyMatrix4:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}}),Object.assign(y,{getNormal:(Qo=new r,function(e,t,n,i){void 0===i&&(console.warn("THREE.Triangle: .getNormal() target is now required"),i=new r),i.subVectors(n,t),Qo.subVectors(e,t),i.cross(Qo);var o=i.lengthSq();return o>0?i.multiplyScalar(1/Math.sqrt(o)):i.set(0,0,0)}),getBarycoord:function(){var e=new r,t=new r,n=new r;return function(i,o,a,s,c){e.subVectors(s,o),t.subVectors(a,o),n.subVectors(i,o);var l=e.dot(e),u=e.dot(t),h=e.dot(n),d=t.dot(t),p=t.dot(n),f=l*d-u*u;if(void 0===c&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),c=new r),0===f)return c.set(-2,-1,-1);var m=1/f,g=(d*h-u*p)*m,v=(l*p-u*h)*m;return c.set(1-g-v,v,g)}}(),containsPoint:function(){var e=new r;return function(t,n,i,r){return y.getBarycoord(t,n,i,r,e),e.x>=0&&e.y>=0&&e.x+e.y<=1}}(),getUV:(Zo=new r,function(e,t,n,i,r,o,a,s){return this.getBarycoord(e,t,n,i,Zo),s.set(0,0),s.addScaledVector(r,Zo.x),s.addScaledVector(o,Zo.y),s.addScaledVector(a,Zo.z),s}),isFrontFacing:function(){var e=new r,t=new r;return function(n,i,r,o){return e.subVectors(r,i),t.subVectors(n,i),e.cross(t).dot(o)<0}}()}),Object.assign(y.prototype,{set:function(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this},setFromPointsAndIndices:function(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},getArea:function(){var e=new r,t=new r;return function(){return e.subVectors(this.c,this.b),t.subVectors(this.a,this.b),.5*e.cross(t).length()}}(),getMidpoint:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),e=new r),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(e){return y.getNormal(this.a,this.b,this.c,e)},getPlane:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getPlane() target is now required"),e=new r),e.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(e,t){return y.getBarycoord(e,this.a,this.b,this.c,t)},getUV:function(e,t,n,i,r){return y.getUV(e,this.a,this.b,this.c,t,n,i,r)},containsPoint:function(e){return y.containsPoint(e,this.a,this.b,this.c)},isFrontFacing:function(e){return y.isFrontFacing(this.a,this.b,this.c,e)},intersectsBox:function(e){return e.intersectsTriangle(this)},closestPointToPoint:($o=new r,ea=new r,ta=new r,na=new r,ia=new r,ra=new r,function(e,t){void 0===t&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),t=new r);var n,i,o=this.a,a=this.b,s=this.c;$o.subVectors(a,o),ea.subVectors(s,o),na.subVectors(e,o);var c=$o.dot(na),l=ea.dot(na);if(c<=0&&l<=0)return t.copy(o);ia.subVectors(e,a);var u=$o.dot(ia),h=ea.dot(ia);if(u>=0&&h<=u)return t.copy(a);var d=c*h-u*l;if(d<=0&&c>=0&&u<=0)return n=c/(c-u),t.copy(o).addScaledVector($o,n);ra.subVectors(e,s);var p=$o.dot(ra),f=ea.dot(ra);if(f>=0&&p<=f)return t.copy(s);var m=p*l-c*f;if(m<=0&&l>=0&&f<=0)return i=l/(l-f),t.copy(o).addScaledVector(ea,i);var g=u*f-p*h;if(g<=0&&h-u>=0&&p-f>=0)return ta.subVectors(s,a),i=(h-u)/(h-u+(p-f)),t.copy(a).addScaledVector(ta,i);var v=1/(g+m+d);return n=m*v,i=d*v,t.copy(o).addScaledVector($o,n).addScaledVector(ea,i)}),equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}});var aa,sa,ca,la={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Object.assign(b.prototype,{isColor:!0,r:1,g:1,b:1,set:function(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setScalar:function(e){return this.r=e,this.g=e,this.b=e,this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,n){return this.r=e,this.g=t,this.b=n,this},setHSL:function(e,t,n){if(e=Co.euclideanModulo(e,1),t=Co.clamp(t,0,1),n=Co.clamp(n,0,1),0===t)this.r=this.g=this.b=n;else{var i=n<=.5?n*(1+t):n+t-n*t,r=2*n-i;this.r=w(r,i,e+1/3),this.g=w(r,i,e),this.b=w(r,i,e-1/3)}return this},setStyle:function(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}var n;if(n=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(e)){var i,r=n[1],o=n[2];switch(r){case"rgb":case"rgba":if(i=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(i[1],10))/255,this.g=Math.min(255,parseInt(i[2],10))/255,this.b=Math.min(255,parseInt(i[3],10))/255,t(i[5]),this;if(i=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(i[1],10))/100,this.g=Math.min(100,parseInt(i[2],10))/100,this.b=Math.min(100,parseInt(i[3],10))/100,t(i[5]),this;break;case"hsl":case"hsla":if(i=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o)){var a=parseFloat(i[1])/360,s=parseInt(i[2],10)/100,c=parseInt(i[3],10)/100;return t(i[5]),this.setHSL(a,s,c)}}}else if(n=/^\#([A-Fa-f0-9]+)$/.exec(e)){var l,u=(l=n[1]).length;if(3===u)return this.r=parseInt(l.charAt(0)+l.charAt(0),16)/255,this.g=parseInt(l.charAt(1)+l.charAt(1),16)/255,this.b=parseInt(l.charAt(2)+l.charAt(2),16)/255,this;if(6===u)return this.r=parseInt(l.charAt(0)+l.charAt(1),16)/255,this.g=parseInt(l.charAt(2)+l.charAt(3),16)/255,this.b=parseInt(l.charAt(4)+l.charAt(5),16)/255,this}return e&&e.length>0&&(void 0!==(l=la[e])?this.setHex(l):console.warn("THREE.Color: Unknown color "+e)),this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e,t){return void 0===t&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},copyLinearToGamma:function(e,t){void 0===t&&(t=2);var n=t>0?1/t:1;return this.r=Math.pow(e.r,n),this.g=Math.pow(e.g,n),this.b=Math.pow(e.b,n),this},convertGammaToLinear:function(e){return this.copyGammaToLinear(this,e),this},convertLinearToGamma:function(e){return this.copyLinearToGamma(this,e),this},copySRGBToLinear:function(e){return this.r=x(e.r),this.g=x(e.g),this.b=x(e.b),this},copyLinearToSRGB:function(e){return this.r=E(e.r),this.g=E(e.g),this.b=E(e.b),this},convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){void 0===e&&(console.warn("THREE.Color: .getHSL() target is now required"),e={h:0,s:0,l:0});var t,n,i=this.r,r=this.g,o=this.b,a=Math.max(i,r,o),s=Math.min(i,r,o),c=(s+a)/2;if(s===a)t=0,n=0;else{var l=a-s;switch(n=c<=.5?l/(a+s):l/(2-a-s),a){case i:t=(r-o)/l+(r<o?6:0);break;case r:t=(o-i)/l+2;break;case o:t=(i-r)/l+4}t/=6}return e.h=t,e.s=n,e.l=c,e},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:(ca={},function(e,t,n){return this.getHSL(ca),ca.h+=e,ca.s+=t,ca.l+=n,this.setHSL(ca.h,ca.s,ca.l),this}),add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},sub:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},lerpHSL:(aa={h:0,s:0,l:0},sa={h:0,s:0,l:0},function(e,t){this.getHSL(aa),e.getHSL(sa);var n=Co.lerp(aa.h,sa.h,t),i=Co.lerp(aa.s,sa.s,t),r=Co.lerp(aa.l,sa.l,t);return this.setHSL(n,i,r),this}),equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e,t){return void 0===t&&(t=0),this.r=e[t],this.g=e[t+1],this.b=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e},toJSON:function(){return this.getHex()}}),Object.assign(S.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var t=0,n=e.vertexNormals.length;t<n;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(t=0,n=e.vertexColors.length;t<n;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}});var ua=0;_.prototype=Object.assign(Object.create(t.prototype),{constructor:_,isMaterial:!0,onBeforeCompile:function(){},setValues:function(e){if(void 0!==e)for(var t in e){var n=e[t];if(void 0!==n)if("shading"!==t){var i=this[t];void 0!==i?i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[t]=n:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===n;else console.warn("THREE.Material: '"+t+"' parameter is undefined.")}},toJSON:function(e){function t(e){var t=[];for(var n in e){var i=e[n];delete i.metadata,t.push(i)}return t}var n=void 0===e||"string"==typeof e;n&&(e={textures:{},images:{}});var i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearCoat&&(i.clearCoat=this.clearCoat),void 0!==this.clearCoatRoughness&&(i.clearCoatRoughness=this.clearCoatRoughness),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,i.reflectivity=this.reflectivity,i.refractionRatio=this.refractionRatio,void 0!==this.combine&&(i.combine=this.combine),void 0!==this.envMapIntensity&&(i.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.size&&(i.size=this.size),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(i.blending=this.blending),!0===this.flatShading&&(i.flatShading=this.flatShading),0!==this.side&&(i.side=this.side),0!==this.vertexColors&&(i.vertexColors=this.vertexColors),this.opacity<1&&(i.opacity=this.opacity),!0===this.transparent&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.stencilWrite=this.stencilWrite,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilMask=this.stencilMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(i.rotation=this.rotation),!0===this.polygonOffset&&(i.polygonOffset=!0),0!==this.polygonOffsetFactor&&(i.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(i.morphTargets=!0),!0===this.morphNormals&&(i.morphNormals=!0),!0===this.skinning&&(i.skinning=!0),!1===this.visible&&(i.visible=!1),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),n){var r=t(e.textures),o=t(e.images);r.length>0&&(i.textures=r),o.length>0&&(i.images=o)}return i},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.lights=e.lights,this.blending=e.blending,this.side=e.side,this.flatShading=e.flatShading,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWrite=e.stencilWrite,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilMask=e.stencilMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.userData=JSON.parse(JSON.stringify(e.userData)),this.clipShadows=e.clipShadows,this.clipIntersection=e.clipIntersection;var t=e.clippingPlanes,n=null;if(null!==t){var i=t.length;n=new Array(i);for(var r=0;r!==i;++r)n[r]=t[r].clone()}return this.clippingPlanes=n,this.shadowSide=e.shadowSide,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),T.prototype=Object.create(_.prototype),T.prototype.constructor=T,T.prototype.isMeshBasicMaterial=!0,T.prototype.copy=function(e){return _.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this},Object.defineProperty(M.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(M.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setArray:function(e){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");return this.count=void 0!==e?e.length/this.itemSize:0,this.array=e,this},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.dynamic=e.dynamic,this},copyAt:function(e,t,n){e*=this.itemSize,n*=t.itemSize;for(var i=0,r=this.itemSize;i<r;i++)this.array[e+i]=t.array[n+i];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){for(var t=this.array,n=0,i=0,r=e.length;i<r;i++){var o=e[i];void 0===o&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",i),o=new b),t[n++]=o.r,t[n++]=o.g,t[n++]=o.b}return this},copyVector2sArray:function(e){for(var t=this.array,i=0,r=0,o=e.length;r<o;r++){var a=e[r];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),a=new n),t[i++]=a.x,t[i++]=a.y}return this},copyVector3sArray:function(e){for(var t=this.array,n=0,i=0,o=e.length;i<o;i++){var a=e[i];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",i),a=new r),t[n++]=a.x,t[n++]=a.y,t[n++]=a.z}return this},copyVector4sArray:function(e){for(var t=this.array,n=0,i=0,r=e.length;i<r;i++){var o=e[i];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",i),o=new s),t[n++]=o.x,t[n++]=o.y,t[n++]=o.z,t[n++]=o.w}return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this},setXYZ:function(e,t,n,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this},setXYZW:function(e,t,n,i,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=r,this},onUpload:function(e){return this.onUploadCallback=e,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),C.prototype=Object.create(M.prototype),C.prototype.constructor=C,A.prototype=Object.create(M.prototype),A.prototype.constructor=A,R.prototype=Object.create(M.prototype),R.prototype.constructor=R,P.prototype=Object.create(M.prototype),P.prototype.constructor=P,I.prototype=Object.create(M.prototype),I.prototype.constructor=I,L.prototype=Object.create(M.prototype),L.prototype.constructor=L,D.prototype=Object.create(M.prototype),D.prototype.constructor=D,O.prototype=Object.create(M.prototype),O.prototype.constructor=O,k.prototype=Object.create(M.prototype),k.prototype.constructor=k,Object.assign(F.prototype,{computeGroups:function(e){for(var t,n=[],i=void 0,r=e.faces,o=0;o<r.length;o++){var a=r[o];a.materialIndex!==i&&(i=a.materialIndex,void 0!==t&&(t.count=3*o-t.start,n.push(t)),t={start:3*o,materialIndex:i})}void 0!==t&&(t.count=3*o-t.start,n.push(t)),this.groups=n},fromGeometry:function(e){var t,i=e.faces,r=e.vertices,o=e.faceVertexUvs,a=o[0]&&o[0].length>0,s=o[1]&&o[1].length>0,c=e.morphTargets,l=c.length;if(l>0){t=[];for(var u=0;u<l;u++)t[u]={name:c[u].name,data:[]};this.morphTargets.position=t}var h,d=e.morphNormals,p=d.length;if(p>0){for(h=[],u=0;u<p;u++)h[u]={name:d[u].name,data:[]};this.morphTargets.normal=h}var f=e.skinIndices,m=e.skinWeights,g=f.length===r.length,v=m.length===r.length;for(r.length>0&&0===i.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported."),u=0;u<i.length;u++){var y=i[u];this.vertices.push(r[y.a],r[y.b],r[y.c]);var b=y.vertexNormals;if(3===b.length)this.normals.push(b[0],b[1],b[2]);else{var w=y.normal;this.normals.push(w,w,w)}var x,E=y.vertexColors;if(3===E.length)this.colors.push(E[0],E[1],E[2]);else{var S=y.color;this.colors.push(S,S,S)}!0===a&&(void 0!==(x=o[0][u])?this.uvs.push(x[0],x[1],x[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",u),this.uvs.push(new n,new n,new n))),!0===s&&(void 0!==(x=o[1][u])?this.uvs2.push(x[0],x[1],x[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",u),this.uvs2.push(new n,new n,new n)));for(var _=0;_<l;_++){var T=c[_].vertices;t[_].data.push(T[y.a],T[y.b],T[y.c])}for(_=0;_<p;_++){var M=d[_].vertexNormals[u];h[_].data.push(M.a,M.b,M.c)}g&&this.skinIndices.push(f[y.a],f[y.b],f[y.c]),v&&this.skinWeights.push(m[y.a],m[y.b],m[y.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this}});var ha,da,pa,fa=1;N.prototype=Object.assign(Object.create(t.prototype),{constructor:N,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(e){Array.isArray(e)?this.index=new(B(e)>65535?D:I)(e,1):this.index=e},addAttribute:function(e,t){return t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):(this.attributes[e]=t,this):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.addAttribute(e,new M(arguments[1],arguments[2])))},getAttribute:function(e){return this.attributes[e]},removeAttribute:function(e){return delete this.attributes[e],this},addGroup:function(e,t,n){this.groups.push({start:e,count:t,materialIndex:void 0!==n?n:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix:function(e){var t=this.attributes.position;void 0!==t&&(e.applyToBufferAttribute(t),t.needsUpdate=!0);var n=this.attributes.normal;void 0!==n&&((new o).getNormalMatrix(e).applyToBufferAttribute(n),n.needsUpdate=!0);var i=this.attributes.tangent;return void 0!==i&&((new o).getNormalMatrix(e).applyToBufferAttribute(i),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(){var e=new u;return function(t){return e.makeRotationX(t),this.applyMatrix(e),this}}(),rotateY:function(){var e=new u;return function(t){return e.makeRotationY(t),this.applyMatrix(e),this}}(),rotateZ:function(){var e=new u;return function(t){return e.makeRotationZ(t),this.applyMatrix(e),this}}(),translate:function(){var e=new u;return function(t,n,i){return e.makeTranslation(t,n,i),this.applyMatrix(e),this}}(),scale:function(){var e=new u;return function(t,n,i){return e.makeScale(t,n,i),this.applyMatrix(e),this}}(),lookAt:(pa=new p,function(e){pa.lookAt(e),pa.updateMatrix(),this.applyMatrix(pa.matrix)}),center:(da=new r,function(){return this.computeBoundingBox(),this.boundingBox.getCenter(da).negate(),this.translate(da.x,da.y,da.z),this}),setFromObject:function(e){var t=e.geometry;if(e.isPoints||e.isLine){var n=new O(3*t.vertices.length,3),i=new O(3*t.colors.length,3);if(this.addAttribute("position",n.copyVector3sArray(t.vertices)),this.addAttribute("color",i.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length){var r=new O(t.lineDistances.length,1);this.addAttribute("lineDistance",r.copyArray(t.lineDistances))}null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone())}else e.isMesh&&t&&t.isGeometry&&this.fromGeometry(t);return this},setFromPoints:function(e){for(var t=[],n=0,i=e.length;n<i;n++){var r=e[n];t.push(r.x,r.y,r.z||0)}return this.addAttribute("position",new O(t,3)),this},updateFromObject:function(e){var t,n=e.geometry;if(e.isMesh){var i=n.__directGeometry;if(!0===n.elementsNeedUpdate&&(i=void 0,n.elementsNeedUpdate=!1),void 0===i)return this.fromGeometry(n);i.verticesNeedUpdate=n.verticesNeedUpdate,i.normalsNeedUpdate=n.normalsNeedUpdate,i.colorsNeedUpdate=n.colorsNeedUpdate,i.uvsNeedUpdate=n.uvsNeedUpdate,i.groupsNeedUpdate=n.groupsNeedUpdate,n.verticesNeedUpdate=!1,n.normalsNeedUpdate=!1,n.colorsNeedUpdate=!1,n.uvsNeedUpdate=!1,n.groupsNeedUpdate=!1,n=i}return!0===n.verticesNeedUpdate&&(void 0!==(t=this.attributes.position)&&(t.copyVector3sArray(n.vertices),t.needsUpdate=!0),n.verticesNeedUpdate=!1),!0===n.normalsNeedUpdate&&(void 0!==(t=this.attributes.normal)&&(t.copyVector3sArray(n.normals),t.needsUpdate=!0),n.normalsNeedUpdate=!1),!0===n.colorsNeedUpdate&&(void 0!==(t=this.attributes.color)&&(t.copyColorsArray(n.colors),t.needsUpdate=!0),n.colorsNeedUpdate=!1),n.uvsNeedUpdate&&(void 0!==(t=this.attributes.uv)&&(t.copyVector2sArray(n.uvs),t.needsUpdate=!0),n.uvsNeedUpdate=!1),n.lineDistancesNeedUpdate&&(void 0!==(t=this.attributes.lineDistance)&&(t.copyArray(n.lineDistances),t.needsUpdate=!0),n.lineDistancesNeedUpdate=!1),n.groupsNeedUpdate&&(n.computeGroups(e.geometry),this.groups=n.groups,n.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=(new F).fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){var t=new Float32Array(3*e.vertices.length);if(this.addAttribute("position",new M(t,3).copyVector3sArray(e.vertices)),e.normals.length>0){var n=new Float32Array(3*e.normals.length);this.addAttribute("normal",new M(n,3).copyVector3sArray(e.normals))}if(e.colors.length>0){var i=new Float32Array(3*e.colors.length);this.addAttribute("color",new M(i,3).copyColorsArray(e.colors))}if(e.uvs.length>0){var r=new Float32Array(2*e.uvs.length);this.addAttribute("uv",new M(r,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){var o=new Float32Array(2*e.uvs2.length);this.addAttribute("uv2",new M(o,2).copyVector2sArray(e.uvs2))}for(var a in this.groups=e.groups,e.morphTargets){for(var s=[],c=e.morphTargets[a],l=0,u=c.length;l<u;l++){var h=c[l],d=new O(3*h.data.length,3);d.name=h.name,s.push(d.copyVector3sArray(h.data))}this.morphAttributes[a]=s}if(e.skinIndices.length>0){var p=new O(4*e.skinIndices.length,4);this.addAttribute("skinIndex",p.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){var f=new O(4*e.skinWeights.length,4);this.addAttribute("skinWeight",f.copyVector4sArray(e.skinWeights))}return null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:(ha=new m,function(){null===this.boundingBox&&(this.boundingBox=new m);var e=this.attributes.position,t=this.morphAttributes.position;if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(var n=0,i=t.length;n<i;n++){var r=t[n];ha.setFromBufferAttribute(r),this.boundingBox.expandByPoint(ha.min),this.boundingBox.expandByPoint(ha.max)}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}),computeBoundingSphere:function(){var e=new m,t=new m,n=new r;return function(){null===this.boundingSphere&&(this.boundingSphere=new g);var i=this.attributes.position,r=this.morphAttributes.position;if(i){var o=this.boundingSphere.center;if(e.setFromBufferAttribute(i),r)for(var a=0,s=r.length;a<s;a++){var c=r[a];t.setFromBufferAttribute(c),e.expandByPoint(t.min),e.expandByPoint(t.max)}e.getCenter(o);var l=0;for(a=0,s=i.count;a<s;a++)n.fromBufferAttribute(i,a),l=Math.max(l,o.distanceToSquared(n));if(r)for(a=0,s=r.length;a<s;a++)for(var u=0,h=(c=r[a]).count;u<h;u++)n.fromBufferAttribute(c,u),l=Math.max(l,o.distanceToSquared(n));this.boundingSphere.radius=Math.sqrt(l),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.index,t=this.attributes;if(t.position){var n=t.position.array;if(void 0===t.normal)this.addAttribute("normal",new M(new Float32Array(n.length),3));else for(var i=t.normal.array,o=0,a=i.length;o<a;o++)i[o]=0;var s,c,l,u=t.normal.array,h=new r,d=new r,p=new r,f=new r,m=new r;if(e){var g=e.array;for(o=0,a=e.count;o<a;o+=3)s=3*g[o+0],c=3*g[o+1],l=3*g[o+2],h.fromArray(n,s),d.fromArray(n,c),p.fromArray(n,l),f.subVectors(p,d),m.subVectors(h,d),f.cross(m),u[s]+=f.x,u[s+1]+=f.y,u[s+2]+=f.z,u[c]+=f.x,
u[c+1]+=f.y,u[c+2]+=f.z,u[l]+=f.x,u[l+1]+=f.y,u[l+2]+=f.z}else for(o=0,a=n.length;o<a;o+=9)h.fromArray(n,o),d.fromArray(n,o+3),p.fromArray(n,o+6),f.subVectors(p,d),m.subVectors(h,d),f.cross(m),u[o]=f.x,u[o+1]=f.y,u[o+2]=f.z,u[o+3]=f.x,u[o+4]=f.y,u[o+5]=f.z,u[o+6]=f.x,u[o+7]=f.y,u[o+8]=f.z;this.normalizeNormals(),t.normal.needsUpdate=!0}},merge:function(e,t){if(e&&e.isBufferGeometry){void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var n=this.attributes;for(var i in n)if(void 0!==e.attributes[i])for(var r=n[i].array,o=e.attributes[i],a=o.array,s=o.itemSize*t,c=Math.min(a.length,r.length-s),l=0,u=s;l<c;l++,u++)r[u]=a[l];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e)},normalizeNormals:function(){var e=new r;return function(){for(var t=this.attributes.normal,n=0,i=t.count;n<i;n++)e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.normalize(),t.setXYZ(n,e.x,e.y,e.z)}}(),toNonIndexed:function(){function e(e,t){for(var n=e.array,i=e.itemSize,r=new n.constructor(t.length*i),o=0,a=0,s=0,c=t.length;s<c;s++){o=t[s]*i;for(var l=0;l<i;l++)r[a++]=n[o++]}return new M(r,i)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var t=new N,n=this.index.array,i=this.attributes;for(var r in i){var o=e(i[r],n);t.addAttribute(r,o)}var a=this.morphAttributes;for(r in a){for(var s=[],c=a[r],l=0,u=c.length;l<u;l++)o=e(c[l],n),s.push(o);t.morphAttributes[r]=s}for(var h=this.groups,d=(l=0,h.length);l<d;l++){var p=h[l];t.addGroup(p.start,p.count,p.materialIndex)}return t},toJSON:function(){var e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){var t=this.parameters;for(var n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};var i=this.index;null!==i&&(e.data.index={type:i.array.constructor.name,array:Array.prototype.slice.call(i.array)});var r=this.attributes;for(var n in r){var o=(d=r[n]).toJSON();""!==d.name&&(o.name=d.name),e.data.attributes[n]=o}var a={},s=!1;for(var n in this.morphAttributes){for(var c=this.morphAttributes[n],l=[],u=0,h=c.length;u<h;u++){var d;o=(d=c[u]).toJSON(),""!==d.name&&(o.name=d.name),l.push(o)}l.length>0&&(a[n]=l,s=!0)}s&&(e.data.morphAttributes=a);var p=this.groups;p.length>0&&(e.data.groups=JSON.parse(JSON.stringify(p)));var f=this.boundingSphere;return null!==f&&(e.data.boundingSphere={center:f.center.toArray(),radius:f.radius}),e},clone:function(){return(new N).copy(this)},copy:function(e){var t,n,i;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var r=e.index;null!==r&&this.setIndex(r.clone());var o=e.attributes;for(t in o){var a=o[t];this.addAttribute(t,a.clone())}var s=e.morphAttributes;for(t in s){var c=[],l=s[t];for(n=0,i=l.length;n<i;n++)c.push(l[n].clone());this.morphAttributes[t]=c}var u=e.groups;for(n=0,i=u.length;n<i;n++){var h=u[n];this.addGroup(h.start,h.count,h.materialIndex)}var d=e.boundingBox;null!==d&&(this.boundingBox=d.clone());var p=e.boundingSphere;return null!==p&&(this.boundingSphere=p.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),U.prototype=Object.assign(Object.create(p.prototype),{constructor:U,isMesh:!0,setDrawMode:function(e){this.drawMode=e},copy:function(e){return p.prototype.copy.call(this,e),this.drawMode=e.drawMode,void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this},updateMorphTargets:function(){var e,t,n,i=this.geometry;if(i.isBufferGeometry){var r=i.morphAttributes,o=Object.keys(r);if(o.length>0){var a=r[o[0]];if(void 0!==a)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=a.length;e<t;e++)n=a[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}else{var s=i.morphTargets;void 0!==s&&s.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(){function e(e,t,n,i,r,o,a,s){if(null===(1===t.side?i.intersectTriangle(a,o,r,!0,s):i.intersectTriangle(r,o,a,2!==t.side,s)))return null;T.copy(s),T.applyMatrix4(e.matrixWorld);var c=n.ray.origin.distanceTo(T);return c<n.near||c>n.far?null:{distance:c,point:T.clone(),object:e}}function t(t,i,r,o,a,u,g,v,T,M,C){s.fromBufferAttribute(a,T),c.fromBufferAttribute(a,M),l.fromBufferAttribute(a,C);var A=t.morphTargetInfluences;if(i.morphTargets&&u&&A){f.set(0,0,0),m.set(0,0,0),b.set(0,0,0);for(var R=0,P=u.length;R<P;R++){var I=A[R],L=u[R];0!==I&&(h.fromBufferAttribute(L,T),d.fromBufferAttribute(L,M),p.fromBufferAttribute(L,C),f.addScaledVector(h.sub(s),I),m.addScaledVector(d.sub(c),I),b.addScaledVector(p.sub(l),I))}s.add(f),c.add(m),l.add(b)}var D=e(t,i,r,o,s,c,l,_);if(D){g&&(w.fromBufferAttribute(g,T),x.fromBufferAttribute(g,M),E.fromBufferAttribute(g,C),D.uv=y.getUV(_,s,c,l,w,x,E,new n)),v&&(w.fromBufferAttribute(v,T),x.fromBufferAttribute(v,M),E.fromBufferAttribute(v,C),D.uv2=y.getUV(_,s,c,l,w,x,E,new n));var O=new S(T,M,C);y.getNormal(s,c,l,O.normal),D.face=O}return D}var i=new u,o=new v,a=new g,s=new r,c=new r,l=new r,h=new r,d=new r,p=new r,f=new r,m=new r,b=new r,w=new n,x=new n,E=new n,_=new r,T=new r;return function(r,s){var c,l=this.geometry,u=this.material,h=this.matrixWorld;if(void 0!==u&&(null===l.boundingSphere&&l.computeBoundingSphere(),a.copy(l.boundingSphere),a.applyMatrix4(h),!1!==r.ray.intersectsSphere(a)&&(i.getInverse(h),o.copy(r.ray).applyMatrix4(i),null===l.boundingBox||!1!==o.intersectsBox(l.boundingBox))))if(l.isBufferGeometry){var d,p,f,m,g,v,b,S,T,M=l.index,C=l.attributes.position,A=l.morphAttributes.position,R=l.attributes.uv,P=l.attributes.uv2,I=l.groups,L=l.drawRange;if(null!==M)if(Array.isArray(u))for(m=0,v=I.length;m<v;m++)for(T=u[(S=I[m]).materialIndex],g=Math.max(S.start,L.start),b=Math.min(S.start+S.count,L.start+L.count);g<b;g+=3)d=M.getX(g),p=M.getX(g+1),f=M.getX(g+2),(c=t(this,T,r,o,C,A,R,P,d,p,f))&&(c.faceIndex=Math.floor(g/3),c.face.materialIndex=S.materialIndex,s.push(c));else for(m=Math.max(0,L.start),v=Math.min(M.count,L.start+L.count);m<v;m+=3)d=M.getX(m),p=M.getX(m+1),f=M.getX(m+2),(c=t(this,u,r,o,C,A,R,P,d,p,f))&&(c.faceIndex=Math.floor(m/3),s.push(c));else if(void 0!==C)if(Array.isArray(u))for(m=0,v=I.length;m<v;m++)for(T=u[(S=I[m]).materialIndex],g=Math.max(S.start,L.start),b=Math.min(S.start+S.count,L.start+L.count);g<b;g+=3)(c=t(this,T,r,o,C,A,R,P,d=g,p=g+1,f=g+2))&&(c.faceIndex=Math.floor(g/3),c.face.materialIndex=S.materialIndex,s.push(c));else for(m=Math.max(0,L.start),v=Math.min(C.count,L.start+L.count);m<v;m+=3)(c=t(this,u,r,o,C,A,R,P,d=m,p=m+1,f=m+2))&&(c.faceIndex=Math.floor(m/3),s.push(c))}else if(l.isGeometry){var D,O,k,F,B=Array.isArray(u),N=l.vertices,U=l.faces,z=l.faceVertexUvs[0];z.length>0&&(F=z);for(var G=0,H=U.length;G<H;G++){var j=U[G],V=B?u[j.materialIndex]:u;if(void 0!==V&&(D=N[j.a],O=N[j.b],k=N[j.c],c=e(this,V,r,o,D,O,k,_))){if(F&&F[G]){var W=F[G];w.copy(W[0]),x.copy(W[1]),E.copy(W[2]),c.uv=y.getUV(_,D,O,k,w,x,E,new n)}c.face=j,c.faceIndex=G,s.push(c)}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var ma=0;z.prototype=Object.assign(Object.create(t.prototype),{constructor:z,isGeometry:!0,applyMatrix:function(e){for(var t=(new o).getNormalMatrix(e),n=0,i=this.vertices.length;n<i;n++)this.vertices[n].applyMatrix4(e);for(n=0,i=this.faces.length;n<i;n++){var r=this.faces[n];r.normal.applyMatrix3(t).normalize();for(var a=0,s=r.vertexNormals.length;a<s;a++)r.vertexNormals[a].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(){var e=new u;return function(t){return e.makeRotationX(t),this.applyMatrix(e),this}}(),rotateY:function(){var e=new u;return function(t){return e.makeRotationY(t),this.applyMatrix(e),this}}(),rotateZ:function(){var e=new u;return function(t){return e.makeRotationZ(t),this.applyMatrix(e),this}}(),translate:function(){var e=new u;return function(t,n,i){return e.makeTranslation(t,n,i),this.applyMatrix(e),this}}(),scale:function(){var e=new u;return function(t,n,i){return e.makeScale(t,n,i),this.applyMatrix(e),this}}(),lookAt:function(){var e=new p;return function(t){e.lookAt(t),e.updateMatrix(),this.applyMatrix(e.matrix)}}(),fromBufferGeometry:function(e){function t(e,t,o,a){var s=void 0===l?[]:[i.colors[e].clone(),i.colors[t].clone(),i.colors[o].clone()],d=new S(e,t,o,void 0===c?[]:[(new r).fromArray(c,3*e),(new r).fromArray(c,3*t),(new r).fromArray(c,3*o)],s,a);i.faces.push(d),void 0!==u&&i.faceVertexUvs[0].push([(new n).fromArray(u,2*e),(new n).fromArray(u,2*t),(new n).fromArray(u,2*o)]),void 0!==h&&i.faceVertexUvs[1].push([(new n).fromArray(h,2*e),(new n).fromArray(h,2*t),(new n).fromArray(h,2*o)])}var i=this,o=null!==e.index?e.index.array:void 0,a=e.attributes,s=a.position.array,c=void 0!==a.normal?a.normal.array:void 0,l=void 0!==a.color?a.color.array:void 0,u=void 0!==a.uv?a.uv.array:void 0,h=void 0!==a.uv2?a.uv2.array:void 0;void 0!==h&&(this.faceVertexUvs[1]=[]);for(var d=0;d<s.length;d+=3)i.vertices.push((new r).fromArray(s,d)),void 0!==l&&i.colors.push((new b).fromArray(l,d));var p=e.groups;if(p.length>0)for(d=0;d<p.length;d++)for(var f=p[d],m=f.start,g=m,v=m+f.count;g<v;g+=3)void 0!==o?t(o[g],o[g+1],o[g+2],f.materialIndex):t(g,g+1,g+2,f.materialIndex);else if(void 0!==o)for(d=0;d<o.length;d+=3)t(o[d],o[d+1],o[d+2]);else for(d=0;d<s.length/3;d+=3)t(d,d+1,d+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){var e=new r;return function(){return this.computeBoundingBox(),this.boundingBox.getCenter(e).negate(),this.translate(e.x,e.y,e.z),this}}(),normalize:function(){this.computeBoundingSphere();var e=this.boundingSphere.center,t=this.boundingSphere.radius,n=0===t?1:1/t,i=new u;return i.set(n,0,0,-n*e.x,0,n,0,-n*e.y,0,0,n,-n*e.z,0,0,0,1),this.applyMatrix(i),this},computeFaceNormals:function(){for(var e=new r,t=new r,n=0,i=this.faces.length;n<i;n++){var o=this.faces[n],a=this.vertices[o.a],s=this.vertices[o.b],c=this.vertices[o.c];e.subVectors(c,s),t.subVectors(a,s),e.cross(t),e.normalize(),o.normal.copy(e)}},computeVertexNormals:function(e){var t,n,i,o,a,s;for(void 0===e&&(e=!0),s=new Array(this.vertices.length),t=0,n=this.vertices.length;t<n;t++)s[t]=new r;if(e){var c,l,u,h=new r,d=new r;for(i=0,o=this.faces.length;i<o;i++)a=this.faces[i],c=this.vertices[a.a],l=this.vertices[a.b],u=this.vertices[a.c],h.subVectors(u,l),d.subVectors(c,l),h.cross(d),s[a.a].add(h),s[a.b].add(h),s[a.c].add(h)}else for(this.computeFaceNormals(),i=0,o=this.faces.length;i<o;i++)s[(a=this.faces[i]).a].add(a.normal),s[a.b].add(a.normal),s[a.c].add(a.normal);for(t=0,n=this.vertices.length;t<n;t++)s[t].normalize();for(i=0,o=this.faces.length;i<o;i++){var p=(a=this.faces[i]).vertexNormals;3===p.length?(p[0].copy(s[a.a]),p[1].copy(s[a.b]),p[2].copy(s[a.c])):(p[0]=s[a.a].clone(),p[1]=s[a.b].clone(),p[2]=s[a.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var e,t,n;for(this.computeFaceNormals(),e=0,t=this.faces.length;e<t;e++){var i=(n=this.faces[e]).vertexNormals;3===i.length?(i[0].copy(n.normal),i[1].copy(n.normal),i[2].copy(n.normal)):(i[0]=n.normal.clone(),i[1]=n.normal.clone(),i[2]=n.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var e,t,n,i,o;for(n=0,i=this.faces.length;n<i;n++)for((o=this.faces[n]).__originalFaceNormal?o.__originalFaceNormal.copy(o.normal):o.__originalFaceNormal=o.normal.clone(),o.__originalVertexNormals||(o.__originalVertexNormals=[]),e=0,t=o.vertexNormals.length;e<t;e++)o.__originalVertexNormals[e]?o.__originalVertexNormals[e].copy(o.vertexNormals[e]):o.__originalVertexNormals[e]=o.vertexNormals[e].clone();var a=new z;for(a.faces=this.faces,e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var s=this.morphNormals[e].faceNormals,c=this.morphNormals[e].vertexNormals;for(n=0,i=this.faces.length;n<i;n++)l=new r,u={a:new r,b:new r,c:new r},s.push(l),c.push(u)}var l,u,h=this.morphNormals[e];for(a.vertices=this.morphTargets[e].vertices,a.computeFaceNormals(),a.computeVertexNormals(),n=0,i=this.faces.length;n<i;n++)o=this.faces[n],l=h.faceNormals[n],u=h.vertexNormals[n],l.copy(o.normal),u.a.copy(o.vertexNormals[0]),u.b.copy(o.vertexNormals[1]),u.c.copy(o.vertexNormals[2])}for(n=0,i=this.faces.length;n<i;n++)(o=this.faces[n]).normal=o.__originalFaceNormal,o.vertexNormals=o.__originalVertexNormals},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new m),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new g),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,n){if(e&&e.isGeometry){var i,r=this.vertices.length,a=this.vertices,s=e.vertices,c=this.faces,l=e.faces,u=this.colors,h=e.colors;void 0===n&&(n=0),void 0!==t&&(i=(new o).getNormalMatrix(t));for(var d=0,p=s.length;d<p;d++){var f=s[d].clone();void 0!==t&&f.applyMatrix4(t),a.push(f)}for(d=0,p=h.length;d<p;d++)u.push(h[d].clone());for(d=0,p=l.length;d<p;d++){var m,g,v,y=l[d],b=y.vertexNormals,w=y.vertexColors;(m=new S(y.a+r,y.b+r,y.c+r)).normal.copy(y.normal),void 0!==i&&m.normal.applyMatrix3(i).normalize();for(var x=0,E=b.length;x<E;x++)g=b[x].clone(),void 0!==i&&g.applyMatrix3(i).normalize(),m.vertexNormals.push(g);for(m.color.copy(y.color),x=0,E=w.length;x<E;x++)v=w[x],m.vertexColors.push(v.clone());m.materialIndex=y.materialIndex+n,c.push(m)}for(d=0,p=e.faceVertexUvs.length;d<p;d++){var _=e.faceVertexUvs[d];for(void 0===this.faceVertexUvs[d]&&(this.faceVertexUvs[d]=[]),x=0,E=_.length;x<E;x++){for(var T=_[x],M=[],C=0,A=T.length;C<A;C++)M.push(T[C].clone());this.faceVertexUvs[d].push(M)}}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e)},mergeMesh:function(e){e&&e.isMesh?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)},mergeVertices:function(){var e,t,n,i,r,o,a,s,c={},l=[],u=[],h=Math.pow(10,4);for(n=0,i=this.vertices.length;n<i;n++)e=this.vertices[n],void 0===c[t=Math.round(e.x*h)+"_"+Math.round(e.y*h)+"_"+Math.round(e.z*h)]?(c[t]=n,l.push(this.vertices[n]),u[n]=l.length-1):u[n]=u[c[t]];var d=[];for(n=0,i=this.faces.length;n<i;n++){(r=this.faces[n]).a=u[r.a],r.b=u[r.b],r.c=u[r.c],o=[r.a,r.b,r.c];for(var p=0;p<3;p++)if(o[p]===o[(p+1)%3]){d.push(n);break}}for(n=d.length-1;n>=0;n--){var f=d[n];for(this.faces.splice(f,1),a=0,s=this.faceVertexUvs.length;a<s;a++)this.faceVertexUvs[a].splice(f,1)}var m=this.vertices.length-l.length;return this.vertices=l,m},setFromPoints:function(e){this.vertices=[];for(var t=0,n=e.length;t<n;t++){var i=e[t];this.vertices.push(new r(i.x,i.y,i.z||0))}return this},sortFacesByMaterialIndex:function(){for(var e=this.faces,t=e.length,n=0;n<t;n++)e[n]._id=n;e.sort(function(e,t){return e.materialIndex-t.materialIndex});var i,r,o=this.faceVertexUvs[0],a=this.faceVertexUvs[1];for(o&&o.length===t&&(i=[]),a&&a.length===t&&(r=[]),n=0;n<t;n++){var s=e[n]._id;i&&i.push(o[s]),r&&r.push(a[s])}i&&(this.faceVertexUvs[0]=i),r&&(this.faceVertexUvs[1]=r)},toJSON:function(){function e(e,t,n){return n?e|1<<t:e&~(1<<t)}function t(e){var t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==d[t]||(d[t]=h.length/3,h.push(e.x,e.y,e.z)),d[t]}function n(e){var t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==f[t]||(f[t]=p.length,p.push(e.getHex())),f[t]}function i(e){var t=e.x.toString()+e.y.toString();return void 0!==g[t]||(g[t]=m.length/2,m.push(e.x,e.y)),g[t]}var r={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),void 0!==this.parameters){var o=this.parameters;for(var a in o)void 0!==o[a]&&(r[a]=o[a]);return r}for(var s=[],c=0;c<this.vertices.length;c++){var l=this.vertices[c];s.push(l.x,l.y,l.z)}var u=[],h=[],d={},p=[],f={},m=[],g={};for(c=0;c<this.faces.length;c++){var v=this.faces[c],y=void 0!==this.faceVertexUvs[0][c],b=v.normal.length()>0,w=v.vertexNormals.length>0,x=1!==v.color.r||1!==v.color.g||1!==v.color.b,E=v.vertexColors.length>0,S=0;if(S=e(S,0,0),S=e(S,1,!0),S=e(S,2,!1),S=e(S,3,y),S=e(S,4,b),S=e(S,5,w),S=e(S,6,x),S=e(S,7,E),u.push(S),u.push(v.a,v.b,v.c),u.push(v.materialIndex),y){var _=this.faceVertexUvs[0][c];u.push(i(_[0]),i(_[1]),i(_[2]))}if(b&&u.push(t(v.normal)),w){var T=v.vertexNormals;u.push(t(T[0]),t(T[1]),t(T[2]))}if(x&&u.push(n(v.color)),E){var M=v.vertexColors;u.push(n(M[0]),n(M[1]),n(M[2]))}}return r.data={},r.data.vertices=s,r.data.normals=h,p.length>0&&(r.data.colors=p),m.length>0&&(r.data.uvs=[m]),r.data.faces=u,r},clone:function(){return(new z).copy(this)},copy:function(e){var t,n,i,r,o,a;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var s=e.vertices;for(t=0,n=s.length;t<n;t++)this.vertices.push(s[t].clone());var c=e.colors;for(t=0,n=c.length;t<n;t++)this.colors.push(c[t].clone());var l=e.faces;for(t=0,n=l.length;t<n;t++)this.faces.push(l[t].clone());for(t=0,n=e.faceVertexUvs.length;t<n;t++){var u=e.faceVertexUvs[t];for(void 0===this.faceVertexUvs[t]&&(this.faceVertexUvs[t]=[]),i=0,r=u.length;i<r;i++){var h=u[i],d=[];for(o=0,a=h.length;o<a;o++){var p=h[o];d.push(p.clone())}this.faceVertexUvs[t].push(d)}}var f=e.morphTargets;for(t=0,n=f.length;t<n;t++){var m={};if(m.name=f[t].name,void 0!==f[t].vertices)for(m.vertices=[],i=0,r=f[t].vertices.length;i<r;i++)m.vertices.push(f[t].vertices[i].clone());if(void 0!==f[t].normals)for(m.normals=[],i=0,r=f[t].normals.length;i<r;i++)m.normals.push(f[t].normals[i].clone());this.morphTargets.push(m)}var g=e.morphNormals;for(t=0,n=g.length;t<n;t++){var v={};if(void 0!==g[t].vertexNormals)for(v.vertexNormals=[],i=0,r=g[t].vertexNormals.length;i<r;i++){var y=g[t].vertexNormals[i],b={};b.a=y.a.clone(),b.b=y.b.clone(),b.c=y.c.clone(),v.vertexNormals.push(b)}if(void 0!==g[t].faceNormals)for(v.faceNormals=[],i=0,r=g[t].faceNormals.length;i<r;i++)v.faceNormals.push(g[t].faceNormals[i].clone());this.morphNormals.push(v)}var w=e.skinWeights;for(t=0,n=w.length;t<n;t++)this.skinWeights.push(w[t].clone());var x=e.skinIndices;for(t=0,n=x.length;t<n;t++)this.skinIndices.push(x[t].clone());var E=e.lineDistances;for(t=0,n=E.length;t<n;t++)this.lineDistances.push(E[t]);var S=e.boundingBox;null!==S&&(this.boundingBox=S.clone());var _=e.boundingSphere;return null!==_&&(this.boundingSphere=_.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),G.prototype=Object.create(z.prototype),G.prototype.constructor=G,H.prototype=Object.create(N.prototype),H.prototype.constructor=H;var ga,va,ya={clone:j,merge:V};W.prototype=Object.create(_.prototype),W.prototype.constructor=W,W.prototype.isShaderMaterial=!0,W.prototype.copy=function(e){return _.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=j(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=e.extensions,this},W.prototype.toJSON=function(e){var t=_.prototype.toJSON.call(this,e);for(var n in t.uniforms={},this.uniforms){var i=this.uniforms[n].value;i&&i.isTexture?t.uniforms[n]={type:"t",value:i.toJSON(e).uuid}:i&&i.isColor?t.uniforms[n]={type:"c",value:i.getHex()}:i&&i.isVector2?t.uniforms[n]={type:"v2",value:i.toArray()}:i&&i.isVector3?t.uniforms[n]={type:"v3",value:i.toArray()}:i&&i.isVector4?t.uniforms[n]={type:"v4",value:i.toArray()}:i&&i.isMatrix3?t.uniforms[n]={type:"m3",value:i.toArray()}:i&&i.isMatrix4?t.uniforms[n]={type:"m4",value:i.toArray()}:t.uniforms[n]={value:i}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;var r={};for(var o in this.extensions)!0===this.extensions[o]&&(r[o]=!0);return Object.keys(r).length>0&&(t.extensions=r),t},X.prototype=Object.assign(Object.create(p.prototype),{constructor:X,isCamera:!0,copy:function(e,t){return p.prototype.copy.call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),e=new r),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()},updateMatrixWorld:function(e){p.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),q.prototype=Object.assign(Object.create(X.prototype),{constructor:q,isPerspectiveCamera:!0,copy:function(e,t){return X.prototype.copy.call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},setFocalLength:function(e){var t=.5*this.getFilmHeight()/e;this.fov=2*Co.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()},getFocalLength:function(){var e=Math.tan(.5*Co.DEG2RAD*this.fov);return.5*this.getFilmHeight()/e},getEffectiveFOV:function(){return 2*Co.RAD2DEG*Math.atan(Math.tan(.5*Co.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(e,t,n,i,r,o){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=this.near,t=e*Math.tan(.5*Co.DEG2RAD*this.fov)/this.zoom,n=2*t,i=this.aspect*n,r=-.5*i,o=this.view;if(null!==this.view&&this.view.enabled){var a=o.fullWidth,s=o.fullHeight;r+=o.offsetX*i/a,t-=o.offsetY*n/s,i*=o.width/a,n*=o.height/s}var c=this.filmOffset;0!==c&&(r+=e*c/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,t,t-n,e,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){var t=p.prototype.toJSON.call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}),Y.prototype=Object.create(p.prototype),Y.prototype.constructor=Y,J.prototype=Object.create(c.prototype),J.prototype.constructor=J,J.prototype.isWebGLRenderTargetCube=!0,J.prototype.fromEquirectangularTexture=function(e,t){this.texture.type=t.type,this.texture.format=t.format,this.texture.encoding=t.encoding;var n=new f,i={uniforms:{tEquirect:{value:null}},vertexShader:["varying vec3 vWorldDirection;","vec3 transformDirection( in vec3 dir, in mat4 matrix ) {","\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );","}","void main() {","\tvWorldDirection = transformDirection( position, modelMatrix );","\t#include <begin_vertex>","\t#include <project_vertex>","}"].join("\n"),fragmentShader:["uniform sampler2D tEquirect;","varying vec3 vWorldDirection;","#define RECIPROCAL_PI 0.31830988618","#define RECIPROCAL_PI2 0.15915494","void main() {","\tvec3 direction = normalize( vWorldDirection );","\tvec2 sampleUV;","\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;","\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;","\tgl_FragColor = texture2D( tEquirect, sampleUV );","}"].join("\n")},r=new W({type:"CubemapFromEquirect",uniforms:j(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:1,blending:0});r.uniforms.tEquirect.value=t;var o=new U(new H(5,5,5),r);n.add(o);var a=new Y(1,10,1);return a.renderTarget=this,a.renderTarget.texture.name="CubeCameraTexture",a.update(e,n),o.geometry.dispose(),o.material.dispose(),this},K.prototype=Object.create(a.prototype),K.prototype.constructor=K,K.prototype.isDataTexture=!0,Object.assign(Z.prototype,{isPlane:!0,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(){var e=new r,t=new r;return function(n,i,r){var o=e.subVectors(r,i).cross(t.subVectors(n,i)).normalize();return this.setFromNormalAndCoplanarPoint(o,n),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return void 0===t&&(console.warn("THREE.Plane: .projectPoint() target is now required"),t=new r),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)},intersectLine:function(){var e=new r;return function(t,n){void 0===n&&(console.warn("THREE.Plane: .intersectLine() target is now required"),n=new r);var i=t.delta(e),o=this.normal.dot(i);if(0===o)return 0===this.distanceToPoint(t.start)?n.copy(t.start):void 0;var a=-(t.start.dot(this.normal)+this.constant)/o;return a<0||a>1?void 0:n.copy(i).multiplyScalar(a).add(t.start)}}(),intersectsLine:function(e){var t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0},intersectsBox:function(e){return e.intersectsPlane(this)},intersectsSphere:function(e){return e.intersectsPlane(this)},coplanarPoint:function(e){return void 0===e&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),e=new r),e.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new r,t=new o;return function(n,i){var r=i||t.getNormalMatrix(n),o=this.coplanarPoint(e).applyMatrix4(n),a=this.normal.applyMatrix3(r).normalize();return this.constant=-o.dot(a),this}}(),translate:function(e){return this.constant-=e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}}),Object.assign(Q.prototype,{set:function(e,t,n,i,r,o){var a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(n),a[3].copy(i),a[4].copy(r),a[5].copy(o),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){for(var t=this.planes,n=0;n<6;n++)t[n].copy(e.planes[n]);return this},setFromMatrix:function(e){var t=this.planes,n=e.elements,i=n[0],r=n[1],o=n[2],a=n[3],s=n[4],c=n[5],l=n[6],u=n[7],h=n[8],d=n[9],p=n[10],f=n[11],m=n[12],g=n[13],v=n[14],y=n[15];return t[0].setComponents(a-i,u-s,f-h,y-m).normalize(),t[1].setComponents(a+i,u+s,f+h,y+m).normalize(),t[2].setComponents(a+r,u+c,f+d,y+g).normalize(),t[3].setComponents(a-r,u-c,f-d,y-g).normalize(),t[4].setComponents(a-o,u-l,f-p,y-v).normalize(),t[5].setComponents(a+o,u+l,f+p,y+v).normalize(),this},intersectsObject:(va=new g,function(e){var t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),va.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(va)}),intersectsSprite:function(){var e=new g;return function(t){return e.center.set(0,0,0),e.radius=.7071067811865476,e.applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}(),intersectsSphere:function(e){for(var t=this.planes,n=e.center,i=-e.radius,r=0;r<6;r++)if(t[r].distanceToPoint(n)<i)return!1;return!0},intersectsBox:(ga=new r,function(e){for(var t=this.planes,n=0;n<6;n++){var i=t[n];if(ga.x=i.normal.x>0?e.max.x:e.min.x,ga.y=i.normal.y>0?e.max.y:e.min.y,ga.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(ga)<0)return!1}return!0}),containsPoint:function(e){for(var t=this.planes,n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}});var ba={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",
bsdfs:"vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG ) && ! defined( MATCAP )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG ) && ! defined( MATCAP )\n\tvarying vec3 vViewPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG ) && ! defined( MATCAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\tfloat rcpPowScale = 1.0 / powScale;\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV( sampler2D envMap, vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\tvec4 result = mix(color10, color20, t);\n\treturn vec4(result.rgb, 1.0);\n}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = normalMatrix * objectNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = normalMatrix * objectTangent;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = min( floor( D ) / 255.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\treflectVec = normalize( reflectVec );\n\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_pars_fragment:"#if defined( USE_ENVMAP ) || defined( PHYSICAL )\n\tuniform float reflectivity;\n\tuniform float envMapIntensity;\n#endif\n#ifdef USE_ENVMAP\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent ));\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = -mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef TOON\n\tuniform sampler2D gradientMap;\n\tvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\t\tfloat dotNL = dot( normal, lightDirection );\n\t\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t\t#ifdef USE_GRADIENTMAP\n\t\t\treturn texture2D( gradientMap, coord ).rgb;\n\t\t#else\n\t\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t\t#endif\n\t}\n#endif",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif",
lights_pars_begin:"uniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t\tfloat shadowCameraNear;\n\t\tfloat shadowCameraFar;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifdef TOON\n\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#else\n\t\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\t\tvec3 irradiance = dotNL * directLight.color;\n\t#endif\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef STANDARD\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.clearCoat = saturate( clearCoat );\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\t#ifndef STANDARD\n\t\tfloat clearCoat;\n\t\tfloat clearCoatRoughness;\n\t#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearCoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifndef STANDARD\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n\treflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#ifndef STANDARD\n\t\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#endif\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifndef STANDARD\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\tfloat dotNL = dotNV;\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\tfloat clearCoatInv = 1.0 - clearCoatDHR;\n\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec3 singleScattering = vec3( 0.0 );\n\t\tvec3 multiScattering = vec3( 0.0 );\n\t\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\t\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\t\treflectedLight.indirectSpecular += clearCoatInv * radiance * singleScattering;\n\t\treflectedLight.indirectDiffuse += multiScattering * cosineWeightedIrradiance;\n\t\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n\t#else\n\t\treflectedLight.indirectSpecular += clearCoatInv * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n\t#endif\n\t#ifndef STANDARD\n\t\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearCoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tirradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), maxMipLevel );\n\t#ifndef STANDARD\n\t\tclearCoatRadiance += getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), maxMipLevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, irradiance, clearCoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t#else\n\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\tgl_Position.z *= gl_Position.w;\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#ifdef USE_MAP\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif",map_particle_pars_fragment:"#ifdef USE_MAP\n\tuniform mat3 uvTransform;\n\tuniform sampler2D map;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t#endif\n#endif",normal_fragment_maps:"#ifdef USE_NORMALMAP\n\t#ifdef OBJECTSPACE_NORMALMAP\n\t\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\t#ifdef FLIP_SIDED\n\t\t\tnormal = - normal;\n\t\t#endif\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\tnormal = normalize( normalMatrix * normal );\n\t#else\n\t\t#ifdef USE_TANGENT\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\t\tmapN.xy = normalScale * mapN.xy;\n\t\t\tnormal = normalize( vTBN * mapN );\n\t\t#else\n\t\t\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n\t\t#endif\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\t#ifdef OBJECTSPACE_NORMALMAP\n\t\tuniform mat3 normalMatrix;\n\t#else\n\t\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\t\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\t\tvec2 st0 = dFdx( vUv.st );\n\t\t\tvec2 st1 = dFdy( vUv.st );\n\t\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\t\tvec3 N = normalize( surf_norm );\n\t\t\tmat3 tsn = mat3( S, T, N );\n\t\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\t\tmapN.xy *= normalScale;\n\t\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\treturn normalize( tsn * mapN );\n\t\t}\n\t#endif\n#endif",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#if defined( DITHERING )\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#if defined( DITHERING )\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",
shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n\t#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( ( color * ( 2.51 * color + 0.03 ) ) / ( color * ( 2.43 * color + 0.59 ) + 0.14 ) );\n}",uv_pars_fragment:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV;\n\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",
meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define PHYSICAL\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define PHYSICAL\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <fog_fragment>\n}",shadow_vert:"#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"},wa={common:{diffuse:{value:new b(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new o},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new n(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new b(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new b(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},uvTransform:{value:new o}},sprite:{diffuse:{value:new b(15658734)},opacity:{value:1},center:{value:new n(.5,.5)},rotation:{value:0},map:{value:null},uvTransform:{value:new o}}},xa={basic:{uniforms:V([wa.common,wa.specularmap,wa.envmap,wa.aomap,wa.lightmap,wa.fog]),vertexShader:ba.meshbasic_vert,fragmentShader:ba.meshbasic_frag},lambert:{uniforms:V([wa.common,wa.specularmap,wa.envmap,wa.aomap,wa.lightmap,wa.emissivemap,wa.fog,wa.lights,{emissive:{value:new b(0)}}]),vertexShader:ba.meshlambert_vert,fragmentShader:ba.meshlambert_frag},phong:{uniforms:V([wa.common,wa.specularmap,wa.envmap,wa.aomap,wa.lightmap,wa.emissivemap,wa.bumpmap,wa.normalmap,wa.displacementmap,wa.gradientmap,wa.fog,wa.lights,{emissive:{value:new b(0)},specular:{value:new b(1118481)},shininess:{value:30}}]),vertexShader:ba.meshphong_vert,fragmentShader:ba.meshphong_frag},standard:{uniforms:V([wa.common,wa.envmap,wa.aomap,wa.lightmap,wa.emissivemap,wa.bumpmap,wa.normalmap,wa.displacementmap,wa.roughnessmap,wa.metalnessmap,wa.fog,wa.lights,{emissive:{value:new b(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:ba.meshphysical_vert,fragmentShader:ba.meshphysical_frag},matcap:{uniforms:V([wa.common,wa.bumpmap,wa.normalmap,wa.displacementmap,wa.fog,{matcap:{value:null}}]),vertexShader:ba.meshmatcap_vert,fragmentShader:ba.meshmatcap_frag},points:{uniforms:V([wa.points,wa.fog]),vertexShader:ba.points_vert,fragmentShader:ba.points_frag},dashed:{uniforms:V([wa.common,wa.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ba.linedashed_vert,fragmentShader:ba.linedashed_frag},depth:{uniforms:V([wa.common,wa.displacementmap]),vertexShader:ba.depth_vert,fragmentShader:ba.depth_frag},normal:{uniforms:V([wa.common,wa.bumpmap,wa.normalmap,wa.displacementmap,{opacity:{value:1}}]),vertexShader:ba.normal_vert,fragmentShader:ba.normal_frag},sprite:{uniforms:V([wa.sprite,wa.fog]),vertexShader:ba.sprite_vert,fragmentShader:ba.sprite_frag},background:{uniforms:{uvTransform:{value:new o},t2D:{value:null}},vertexShader:ba.background_vert,fragmentShader:ba.background_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:ba.cube_vert,fragmentShader:ba.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ba.equirect_vert,fragmentShader:ba.equirect_frag},distanceRGBA:{uniforms:V([wa.common,wa.displacementmap,{referencePosition:{value:new r},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ba.distanceRGBA_vert,fragmentShader:ba.distanceRGBA_frag},shadow:{uniforms:V([wa.lights,wa.fog,{color:{value:new b(0)},opacity:{value:1}}]),vertexShader:ba.shadow_vert,fragmentShader:ba.shadow_frag}};xa.physical={uniforms:V([xa.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:ba.meshphysical_vert,fragmentShader:ba.meshphysical_frag},te.prototype=Object.create(z.prototype),te.prototype.constructor=te,ne.prototype=Object.create(N.prototype),ne.prototype.constructor=ne,fe.prototype=Object.create(a.prototype),fe.prototype.constructor=fe,fe.prototype.isCubeTexture=!0,Object.defineProperty(fe.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}}),me.prototype=Object.create(a.prototype),me.prototype.constructor=me,me.prototype.isDataTexture2DArray=!0,ge.prototype=Object.create(a.prototype),ge.prototype.constructor=ge,ge.prototype.isDataTexture3D=!0;var Ea=new a,Sa=new me,_a=new ge,Ta=new fe,Ma=[],Ca=[],Aa=new Float32Array(16),Ra=new Float32Array(9),Pa=new Float32Array(4);Ke.prototype.updateCache=function(e){var t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),be(t,e)},Ze.prototype.setValue=function(e,t,n){for(var i=this.seq,r=0,o=i.length;r!==o;++r){var a=i[r];a.setValue(e,t[a.id],n)}};var Ia=/([\w\d_]+)(\])?(\[|\.)?/g;et.prototype.setValue=function(e,t,n,i){var r=this.map[t];void 0!==r&&r.setValue(e,n,i)},et.prototype.setOptional=function(e,t,n){var i=t[n];void 0!==i&&this.setValue(e,n,i)},et.upload=function(e,t,n,i){for(var r=0,o=t.length;r!==o;++r){var a=t[r],s=n[a.id];!1!==s.needsUpdate&&a.setValue(e,s.value,i)}},et.seqWithValue=function(e,t){for(var n=[],i=0,r=e.length;i!==r;++i){var o=e[i];o.id in t&&n.push(o)}return n};var La=0,Da=0;Et.prototype=Object.create(_.prototype),Et.prototype.constructor=Et,Et.prototype.isMeshDepthMaterial=!0,Et.prototype.copy=function(e){return _.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},St.prototype=Object.create(_.prototype),St.prototype.constructor=St,St.prototype.isMeshDistanceMaterial=!0,St.prototype.copy=function(e){return _.prototype.copy.call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this},At.prototype=Object.assign(Object.create(p.prototype),{constructor:At,isGroup:!0}),Rt.prototype=Object.assign(Object.create(q.prototype),{constructor:Rt,isArrayCamera:!0});var Oa,ka,Fa,Ba,Na,Ua,za=new r,Ga=new r;Object.assign(It.prototype,t.prototype),Object.assign(Lt.prototype,t.prototype),Object.assign(Ot.prototype,{isFogExp2:!0,clone:function(){return new Ot(this.color,this.density)},toJSON:function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}),Object.assign(kt.prototype,{isFog:!0,clone:function(){return new kt(this.color,this.near,this.far)},toJSON:function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}),Object.defineProperty(Ft.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(Ft.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setArray:function(e){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");return this.count=void 0!==e?e.length/this.stride:0,this.array=e,this},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.dynamic=e.dynamic,this},copyAt:function(e,t,n){e*=this.stride,n*=t.stride;for(var i=0,r=this.stride;i<r;i++)this.array[e+i]=t.array[n+i];return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(e){return this.onUploadCallback=e,this}}),Object.defineProperties(Bt.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(Bt.prototype,{isInterleavedBufferAttribute:!0,setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this},setXYZ:function(e,t,n,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this},setXYZW:function(e,t,n,i,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this.data.array[e+3]=r,this}}),Nt.prototype=Object.create(_.prototype),Nt.prototype.constructor=Nt,Nt.prototype.isSpriteMaterial=!0,Nt.prototype.copy=function(e){return _.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this},Ut.prototype=Object.assign(Object.create(p.prototype),{constructor:Ut,isSprite:!0,raycast:function(){function e(e,t,n,i,r,o){a.subVectors(e,n).addScalar(.5).multiply(i),void 0!==r?(s.x=o*a.x-r*a.y,s.y=r*a.x+o*a.y):s.copy(a),e.copy(t),e.x+=s.x,e.y+=s.y,e.applyMatrix4(c)}var t=new r,i=new r,o=new r,a=new n,s=new n,c=new u,l=new r,h=new r,d=new r,p=new n,f=new n,m=new n;return function(r,a){i.setFromMatrixScale(this.matrixWorld),c.copy(r._camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(r._camera.matrixWorldInverse,this.matrixWorld),o.setFromMatrixPosition(this.modelViewMatrix),r._camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&i.multiplyScalar(-o.z);var s,u,g=this.material.rotation;0!==g&&(u=Math.cos(g),s=Math.sin(g));var v=this.center;e(l.set(-.5,-.5,0),o,v,i,s,u),e(h.set(.5,-.5,0),o,v,i,s,u),e(d.set(.5,.5,0),o,v,i,s,u),p.set(0,0),f.set(1,0),m.set(1,1);var b=r.ray.intersectTriangle(l,h,d,!1,t);if(null!==b||(e(h.set(-.5,.5,0),o,v,i,s,u),f.set(0,1),null!==(b=r.ray.intersectTriangle(l,d,h,!1,t)))){var w=r.ray.origin.distanceTo(t);w<r.near||w>r.far||a.push({distance:w,point:t.clone(),uv:y.getUV(t,l,h,d,p,f,m,new n),face:null,object:this})}}}(),clone:function(){return new this.constructor(this.material).copy(this)},copy:function(e){return p.prototype.copy.call(this,e),void 0!==e.center&&this.center.copy(e.center),this}}),zt.prototype=Object.assign(Object.create(p.prototype),{constructor:zt,isLOD:!0,copy:function(e){p.prototype.copy.call(this,e,!1);for(var t=e.levels,n=0,i=t.length;n<i;n++){var r=t[n];this.addLevel(r.object.clone(),r.distance)}return this},addLevel:function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var n=this.levels,i=0;i<n.length&&!(t<n[i].distance);i++);return n.splice(i,0,{distance:t,object:e}),this.add(e),this},getObjectForDistance:function(e){for(var t=this.levels,n=1,i=t.length;n<i&&!(e<t[n].distance);n++);return t[n-1].object},raycast:(ka=new r,function(e,t){ka.setFromMatrixPosition(this.matrixWorld);var n=e.ray.origin.distanceTo(ka);this.getObjectForDistance(n).raycast(e,t)}),update:function(){var e=new r,t=new r;return function(n){var i=this.levels;if(i.length>1){e.setFromMatrixPosition(n.matrixWorld),t.setFromMatrixPosition(this.matrixWorld);var r=e.distanceTo(t);i[0].object.visible=!0;for(var o=1,a=i.length;o<a&&r>=i[o].distance;o++)i[o-1].object.visible=!1,i[o].object.visible=!0;for(;o<a;o++)i[o].object.visible=!1}}}(),toJSON:function(e){var t=p.prototype.toJSON.call(this,e);t.object.levels=[];for(var n=this.levels,i=0,r=n.length;i<r;i++){var o=n[i];t.object.levels.push({object:o.object.uuid,distance:o.distance})}return t}}),Gt.prototype=Object.assign(Object.create(U.prototype),{constructor:Gt,isSkinnedMesh:!0,bind:function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){for(var e=new s,t=this.geometry.attributes.skinWeight,n=0,i=t.count;n<i;n++){e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.w=t.getW(n);var r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}},updateMatrixWorld:function(e){U.prototype.updateMatrixWorld.call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Object.assign(Ht.prototype,{calculateInverses:function(){this.boneInverses=[];for(var e=0,t=this.bones.length;e<t;e++){var n=new u;this.bones[e]&&n.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(n)}},pose:function(){var e,t,n;for(t=0,n=this.bones.length;t<n;t++)(e=this.bones[t])&&e.matrixWorld.getInverse(this.boneInverses[t]);for(t=0,n=this.bones.length;t<n;t++)(e=this.bones[t])&&(e.parent&&e.parent.isBone?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))},update:(Fa=new u,Ba=new u,function(){for(var e=this.bones,t=this.boneInverses,n=this.boneMatrices,i=this.boneTexture,r=0,o=e.length;r<o;r++){var a=e[r]?e[r].matrixWorld:Ba;Fa.multiplyMatrices(a,t[r]),Fa.toArray(n,16*r)}void 0!==i&&(i.needsUpdate=!0)}),clone:function(){return new Ht(this.bones,this.boneInverses)},getBoneByName:function(e){for(var t=0,n=this.bones.length;t<n;t++){var i=this.bones[t];if(i.name===e)return i}}}),jt.prototype=Object.assign(Object.create(p.prototype),{constructor:jt,isBone:!0}),Vt.prototype=Object.create(_.prototype),Vt.prototype.constructor=Vt,Vt.prototype.isLineBasicMaterial=!0,Vt.prototype.copy=function(e){return _.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this},Wt.prototype=Object.assign(Object.create(p.prototype),{constructor:Wt,isLine:!0,computeLineDistances:(Na=new r,Ua=new r,function(){var e=this.geometry;if(e.isBufferGeometry)if(null===e.index){for(var t=e.attributes.position,n=[0],i=1,r=t.count;i<r;i++)Na.fromBufferAttribute(t,i-1),Ua.fromBufferAttribute(t,i),n[i]=n[i-1],n[i]+=Na.distanceTo(Ua);e.addAttribute("lineDistance",new O(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry){var o=e.vertices;for((n=e.lineDistances)[0]=0,i=1,r=o.length;i<r;i++)n[i]=n[i-1],n[i]+=o[i-1].distanceTo(o[i])}return this}),raycast:function(){var e=new u,t=new v,n=new g;return function(i,o){var a=i.linePrecision,s=this.geometry,c=this.matrixWorld;if(null===s.boundingSphere&&s.computeBoundingSphere(),n.copy(s.boundingSphere),n.applyMatrix4(c),n.radius+=a,!1!==i.ray.intersectsSphere(n)){e.getInverse(c),t.copy(i.ray).applyMatrix4(e);var l=a/((this.scale.x+this.scale.y+this.scale.z)/3),u=l*l,h=new r,d=new r,p=new r,f=new r,m=this&&this.isLineSegments?2:1;if(s.isBufferGeometry){var g=s.index,v=s.attributes.position.array;if(null!==g)for(var y=g.array,b=0,w=y.length-1;b<w;b+=m){var x=y[b],E=y[b+1];h.fromArray(v,3*x),d.fromArray(v,3*E),t.distanceSqToSegment(h,d,f,p)>u||(f.applyMatrix4(this.matrixWorld),(T=i.ray.origin.distanceTo(f))<i.near||T>i.far||o.push({distance:T,point:p.clone().applyMatrix4(this.matrixWorld),index:b,face:null,faceIndex:null,object:this}))}else for(b=0,w=v.length/3-1;b<w;b+=m)h.fromArray(v,3*b),d.fromArray(v,3*b+3),t.distanceSqToSegment(h,d,f,p)>u||(f.applyMatrix4(this.matrixWorld),(T=i.ray.origin.distanceTo(f))<i.near||T>i.far||o.push({distance:T,point:p.clone().applyMatrix4(this.matrixWorld),index:b,face:null,faceIndex:null,object:this}))}else if(s.isGeometry){var S=s.vertices,_=S.length;for(b=0;b<_-1;b+=m){var T;t.distanceSqToSegment(S[b],S[b+1],f,p)>u||(f.applyMatrix4(this.matrixWorld),(T=i.ray.origin.distanceTo(f))<i.near||T>i.far||o.push({distance:T,point:p.clone().applyMatrix4(this.matrixWorld),index:b,face:null,faceIndex:null,object:this}))}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Xt.prototype=Object.assign(Object.create(Wt.prototype),{constructor:Xt,isLineSegments:!0,computeLineDistances:function(){var e=new r,t=new r;return function(){var n=this.geometry;if(n.isBufferGeometry)if(null===n.index){for(var i=n.attributes.position,r=[],o=0,a=i.count;o<a;o+=2)e.fromBufferAttribute(i,o),t.fromBufferAttribute(i,o+1),r[o]=0===o?0:r[o-1],r[o+1]=r[o]+e.distanceTo(t);n.addAttribute("lineDistance",new O(r,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(n.isGeometry){var s=n.vertices;for(r=n.lineDistances,o=0,a=s.length;o<a;o+=2)e.copy(s[o]),t.copy(s[o+1]),r[o]=0===o?0:r[o-1],r[o+1]=r[o]+e.distanceTo(t)}return this}}()}),qt.prototype=Object.assign(Object.create(Wt.prototype),{constructor:qt,isLineLoop:!0}),Yt.prototype=Object.create(_.prototype),Yt.prototype.constructor=Yt,Yt.prototype.isPointsMaterial=!0,Yt.prototype.copy=function(e){return _.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this},Jt.prototype=Object.assign(Object.create(p.prototype),{constructor:Jt,isPoints:!0,raycast:function(){var e=new u,t=new v,n=new g;return function(i,o){function a(e,n){var r=t.distanceSqToPoint(e);if(r<d){t.closestPointToPoint(e,f),f.applyMatrix4(l);var a=i.ray.origin.distanceTo(f);if(a<i.near||a>i.far)return;o.push({distance:a,distanceToRay:Math.sqrt(r),point:f.clone(),index:n,face:null,object:s})}}var s=this,c=this.geometry,l=this.matrixWorld,u=i.params.Points.threshold;if(null===c.boundingSphere&&c.computeBoundingSphere(),n.copy(c.boundingSphere),n.applyMatrix4(l),n.radius+=u,!1!==i.ray.intersectsSphere(n)){e.getInverse(l),t.copy(i.ray).applyMatrix4(e);var h=u/((this.scale.x+this.scale.y+this.scale.z)/3),d=h*h,p=new r,f=new r;if(c.isBufferGeometry){var m=c.index,g=c.attributes.position.array;if(null!==m)for(var v=m.array,y=0,b=v.length;y<b;y++){var w=v[y];p.fromArray(g,3*w),a(p,w)}else{y=0;for(var x=g.length/3;y<x;y++)p.fromArray(g,3*y),a(p,y)}}else{var E=c.vertices;for(y=0,x=E.length;y<x;y++)a(E[y],y)}}}}(),updateMorphTargets:function(){var e,t,n,i=this.geometry;if(i.isBufferGeometry){var r=i.morphAttributes,o=Object.keys(r);if(o.length>0){var a=r[o[0]];if(void 0!==a)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=a.length;e<t;e++)n=a[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}else{var s=i.morphTargets;void 0!==s&&s.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Kt.prototype=Object.assign(Object.create(a.prototype),{constructor:Kt,isVideoTexture:!0,update:function(){var e=this.image;e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),Zt.prototype=Object.create(a.prototype),Zt.prototype.constructor=Zt,Zt.prototype.isCompressedTexture=!0,Qt.prototype=Object.create(a.prototype),Qt.prototype.constructor=Qt,Qt.prototype.isCanvasTexture=!0,$t.prototype=Object.create(a.prototype),$t.prototype.constructor=$t,$t.prototype.isDepthTexture=!0,en.prototype=Object.create(N.prototype),en.prototype.constructor=en,tn.prototype=Object.create(z.prototype),tn.prototype.constructor=tn,nn.prototype=Object.create(N.prototype),nn.prototype.constructor=nn,rn.prototype=Object.create(z.prototype),rn.prototype.constructor=rn,
on.prototype=Object.create(N.prototype),on.prototype.constructor=on,an.prototype=Object.create(z.prototype),an.prototype.constructor=an,sn.prototype=Object.create(on.prototype),sn.prototype.constructor=sn,cn.prototype=Object.create(z.prototype),cn.prototype.constructor=cn,ln.prototype=Object.create(on.prototype),ln.prototype.constructor=ln,un.prototype=Object.create(z.prototype),un.prototype.constructor=un,hn.prototype=Object.create(on.prototype),hn.prototype.constructor=hn,dn.prototype=Object.create(z.prototype),dn.prototype.constructor=dn,pn.prototype=Object.create(on.prototype),pn.prototype.constructor=pn,fn.prototype=Object.create(z.prototype),fn.prototype.constructor=fn,mn.prototype=Object.create(N.prototype),mn.prototype.constructor=mn,mn.prototype.toJSON=function(){var e=N.prototype.toJSON.call(this);return e.path=this.parameters.path.toJSON(),e},gn.prototype=Object.create(z.prototype),gn.prototype.constructor=gn,vn.prototype=Object.create(N.prototype),vn.prototype.constructor=vn,yn.prototype=Object.create(z.prototype),yn.prototype.constructor=yn,bn.prototype=Object.create(N.prototype),bn.prototype.constructor=bn;var Ha=function(e,t,n){n=n||2;var i,r,o,a,s,c,l,u=t&&t.length,h=u?t[0]*n:e.length,d=wn(e,0,h,n,!0),p=[];if(!d||d.next===d.prev)return p;if(u&&(d=function(e,t,n,i){var r,o,a,s,c,l=[];for(r=0,o=t.length;r<o;r++)a=t[r]*i,s=r<o-1?t[r+1]*i:e.length,(c=wn(e,a,s,i,!1))===c.next&&(c.steiner=!0),l.push(Pn(c));for(l.sort(Cn),r=0;r<l.length;r++)An(l[r],n),n=xn(n,n.next);return n}(e,t,d,n)),e.length>80*n){i=o=e[0],r=a=e[1];for(var f=n;f<h;f+=n)(s=e[f])<i&&(i=s),(c=e[f+1])<r&&(r=c),s>o&&(o=s),c>a&&(a=c);l=0!==(l=Math.max(o-i,a-r))?1/l:0}return En(d,p,n,i,r,l),p},ja={area:function(e){for(var t=e.length,n=0,i=t-1,r=0;r<t;i=r++)n+=e[i].x*e[r].y-e[r].x*e[i].y;return.5*n},isClockWise:function(e){return ja.area(e)<0},triangulateShape:function(e,t){var n=[],i=[],r=[];Gn(e),Hn(n,e);var o=e.length;t.forEach(Gn);for(var a=0;a<t.length;a++)i.push(o),o+=t[a].length,Hn(n,t[a]);var s=Ha(n,i);for(a=0;a<s.length;a+=3)r.push(s.slice(a,a+3));return r}};jn.prototype=Object.create(z.prototype),jn.prototype.constructor=jn,jn.prototype.toJSON=function(){var e=z.prototype.toJSON.call(this);return Wn(this.parameters.shapes,this.parameters.options,e)},Vn.prototype=Object.create(N.prototype),Vn.prototype.constructor=Vn,Vn.prototype.toJSON=function(){var e=N.prototype.toJSON.call(this);return Wn(this.parameters.shapes,this.parameters.options,e)};var Va={generateTopUV:function(e,t,i,r,o){var a=t[3*i],s=t[3*i+1],c=t[3*r],l=t[3*r+1],u=t[3*o],h=t[3*o+1];return[new n(a,s),new n(c,l),new n(u,h)]},generateSideWallUV:function(e,t,i,r,o,a){var s=t[3*i],c=t[3*i+1],l=t[3*i+2],u=t[3*r],h=t[3*r+1],d=t[3*r+2],p=t[3*o],f=t[3*o+1],m=t[3*o+2],g=t[3*a],v=t[3*a+1],y=t[3*a+2];return Math.abs(c-h)<.01?[new n(s,1-l),new n(u,1-d),new n(p,1-m),new n(g,1-y)]:[new n(c,1-l),new n(h,1-d),new n(f,1-m),new n(v,1-y)]}};Xn.prototype=Object.create(z.prototype),Xn.prototype.constructor=Xn,qn.prototype=Object.create(Vn.prototype),qn.prototype.constructor=qn,Yn.prototype=Object.create(z.prototype),Yn.prototype.constructor=Yn,Jn.prototype=Object.create(N.prototype),Jn.prototype.constructor=Jn,Kn.prototype=Object.create(z.prototype),Kn.prototype.constructor=Kn,Zn.prototype=Object.create(N.prototype),Zn.prototype.constructor=Zn,Qn.prototype=Object.create(z.prototype),Qn.prototype.constructor=Qn,$n.prototype=Object.create(N.prototype),$n.prototype.constructor=$n,ei.prototype=Object.create(z.prototype),ei.prototype.constructor=ei,ei.prototype.toJSON=function(){var e=z.prototype.toJSON.call(this);return ni(this.parameters.shapes,e)},ti.prototype=Object.create(N.prototype),ti.prototype.constructor=ti,ti.prototype.toJSON=function(){var e=N.prototype.toJSON.call(this);return ni(this.parameters.shapes,e)},ii.prototype=Object.create(N.prototype),ii.prototype.constructor=ii,ri.prototype=Object.create(z.prototype),ri.prototype.constructor=ri,oi.prototype=Object.create(N.prototype),oi.prototype.constructor=oi,ai.prototype=Object.create(ri.prototype),ai.prototype.constructor=ai,si.prototype=Object.create(oi.prototype),si.prototype.constructor=si,ci.prototype=Object.create(z.prototype),ci.prototype.constructor=ci,li.prototype=Object.create(N.prototype),li.prototype.constructor=li;var Wa=Object.freeze({WireframeGeometry:en,ParametricGeometry:tn,ParametricBufferGeometry:nn,TetrahedronGeometry:an,TetrahedronBufferGeometry:sn,OctahedronGeometry:cn,OctahedronBufferGeometry:ln,IcosahedronGeometry:un,IcosahedronBufferGeometry:hn,DodecahedronGeometry:dn,DodecahedronBufferGeometry:pn,PolyhedronGeometry:rn,PolyhedronBufferGeometry:on,TubeGeometry:fn,TubeBufferGeometry:mn,TorusKnotGeometry:gn,TorusKnotBufferGeometry:vn,TorusGeometry:yn,TorusBufferGeometry:bn,TextGeometry:Xn,TextBufferGeometry:qn,SphereGeometry:Yn,SphereBufferGeometry:Jn,RingGeometry:Kn,RingBufferGeometry:Zn,PlaneGeometry:te,PlaneBufferGeometry:ne,LatheGeometry:Qn,LatheBufferGeometry:$n,ShapeGeometry:ei,ShapeBufferGeometry:ti,ExtrudeGeometry:jn,ExtrudeBufferGeometry:Vn,EdgesGeometry:ii,ConeGeometry:ai,ConeBufferGeometry:si,CylinderGeometry:ri,CylinderBufferGeometry:oi,CircleGeometry:ci,CircleBufferGeometry:li,BoxGeometry:G,BoxBufferGeometry:H});ui.prototype=Object.create(_.prototype),ui.prototype.constructor=ui,ui.prototype.isShadowMaterial=!0,ui.prototype.copy=function(e){return _.prototype.copy.call(this,e),this.color.copy(e.color),this},hi.prototype=Object.create(W.prototype),hi.prototype.constructor=hi,hi.prototype.isRawShaderMaterial=!0,di.prototype=Object.create(_.prototype),di.prototype.constructor=di,di.prototype.isMeshStandardMaterial=!0,di.prototype.copy=function(e){return _.prototype.copy.call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},pi.prototype=Object.create(di.prototype),pi.prototype.constructor=pi,pi.prototype.isMeshPhysicalMaterial=!0,pi.prototype.copy=function(e){return di.prototype.copy.call(this,e),this.defines={PHYSICAL:""},this.reflectivity=e.reflectivity,this.clearCoat=e.clearCoat,this.clearCoatRoughness=e.clearCoatRoughness,this},fi.prototype=Object.create(_.prototype),fi.prototype.constructor=fi,fi.prototype.isMeshPhongMaterial=!0,fi.prototype.copy=function(e){return _.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},mi.prototype=Object.create(fi.prototype),mi.prototype.constructor=mi,mi.prototype.isMeshToonMaterial=!0,mi.prototype.copy=function(e){return fi.prototype.copy.call(this,e),this.gradientMap=e.gradientMap,this},gi.prototype=Object.create(_.prototype),gi.prototype.constructor=gi,gi.prototype.isMeshNormalMaterial=!0,gi.prototype.copy=function(e){return _.prototype.copy.call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},vi.prototype=Object.create(_.prototype),vi.prototype.constructor=vi,vi.prototype.isMeshLambertMaterial=!0,vi.prototype.copy=function(e){return _.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},yi.prototype=Object.create(_.prototype),yi.prototype.constructor=yi,yi.prototype.isMeshMatcapMaterial=!0,yi.prototype.copy=function(e){return _.prototype.copy.call(this,e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},bi.prototype=Object.create(Vt.prototype),bi.prototype.constructor=bi,bi.prototype.isLineDashedMaterial=!0,bi.prototype.copy=function(e){return Vt.prototype.copy.call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this};var Xa=Object.freeze({ShadowMaterial:ui,SpriteMaterial:Nt,RawShaderMaterial:hi,ShaderMaterial:W,PointsMaterial:Yt,MeshPhysicalMaterial:pi,MeshStandardMaterial:di,MeshPhongMaterial:fi,MeshToonMaterial:mi,MeshNormalMaterial:gi,MeshLambertMaterial:vi,MeshDepthMaterial:Et,MeshDistanceMaterial:St,MeshBasicMaterial:T,MeshMatcapMaterial:yi,LineDashedMaterial:bi,LineBasicMaterial:Vt,Material:_}),qa={arraySlice:function(e,t,n){return qa.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==n?n:e.length)):e.slice(t,n)},convertArray:function(e,t,n){return!e||!n&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){for(var t=e.length,n=new Array(t),i=0;i!==t;++i)n[i]=i;return n.sort(function(t,n){return e[t]-e[n]}),n},sortedArray:function(e,t,n){for(var i=e.length,r=new e.constructor(i),o=0,a=0;a!==i;++o)for(var s=n[o]*t,c=0;c!==t;++c)r[a++]=e[s+c];return r},flattenJSON:function(e,t,n,i){for(var r=1,o=e[0];void 0!==o&&void 0===o[i];)o=e[r++];if(void 0!==o){var a=o[i];if(void 0!==a)if(Array.isArray(a))do{void 0!==(a=o[i])&&(t.push(o.time),n.push.apply(n,a)),o=e[r++]}while(void 0!==o);else if(void 0!==a.toArray)do{void 0!==(a=o[i])&&(t.push(o.time),a.toArray(n,n.length)),o=e[r++]}while(void 0!==o);else do{void 0!==(a=o[i])&&(t.push(o.time),n.push(a)),o=e[r++]}while(void 0!==o)}}};Object.assign(wi.prototype,{evaluate:function(e){var t=this.parameterPositions,n=this._cachedIndex,i=t[n],r=t[n-1];e:{t:{var o;n:{i:if(!(e<i)){for(var a=n+2;;){if(void 0===i){if(e<r)break i;return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,e,r)}if(n===a)break;if(r=i,e<(i=t[++n]))break t}o=t.length;break n}if(e>=r)break e;var s=t[1];for(e<s&&(n=2,r=s),a=n-2;;){if(void 0===r)return this._cachedIndex=0,this.beforeStart_(0,e,i);if(n===a)break;if(i=r,e>=(r=t[--n-1]))break t}o=n,n=0}for(;n<o;){var c=n+o>>>1;e<t[c]?o=c:n=c+1}if(i=t[n],void 0===(r=t[n-1]))return this._cachedIndex=0,this.beforeStart_(0,e,i);if(void 0===i)return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,r,e)}this._cachedIndex=n,this.intervalChanged_(n,r,i)}return this.interpolate_(n,r,e,i)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(e){for(var t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i,o=0;o!==i;++o)t[o]=n[r+o];return t},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(wi.prototype,{beforeStart_:wi.prototype.copySampleValue_,afterEnd_:wi.prototype.copySampleValue_}),xi.prototype=Object.assign(Object.create(wi.prototype),{constructor:xi,DefaultSettings_:{endingStart:2400,endingEnd:2400},intervalChanged_:function(e,t,n){var i=this.parameterPositions,r=e-2,o=e+1,a=i[r],s=i[o];if(void 0===a)switch(this.getSettings_().endingStart){case 2401:r=e,a=2*t-n;break;case 2402:a=t+i[r=i.length-2]-i[r+1];break;default:r=e,a=n}if(void 0===s)switch(this.getSettings_().endingEnd){case 2401:o=e,s=2*n-t;break;case 2402:o=1,s=n+i[1]-i[0];break;default:o=e-1,s=t}var c=.5*(n-t),l=this.valueSize;this._weightPrev=c/(t-a),this._weightNext=c/(s-n),this._offsetPrev=r*l,this._offsetNext=o*l},interpolate_:function(e,t,n,i){for(var r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=e*a,c=s-a,l=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,d=this._weightNext,p=(n-t)/(i-t),f=p*p,m=f*p,g=-h*m+2*h*f-h*p,v=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*p+1,y=(-1-d)*m+(1.5+d)*f+.5*p,b=d*m-d*f,w=0;w!==a;++w)r[w]=g*o[l+w]+v*o[c+w]+y*o[s+w]+b*o[u+w];return r}}),Ei.prototype=Object.assign(Object.create(wi.prototype),{constructor:Ei,interpolate_:function(e,t,n,i){for(var r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=e*a,c=s-a,l=(n-t)/(i-t),u=1-l,h=0;h!==a;++h)r[h]=o[c+h]*u+o[s+h]*l;return r}}),Si.prototype=Object.assign(Object.create(wi.prototype),{constructor:Si,interpolate_:function(e){return this.copySampleValue_(e-1)}}),Object.assign(_i,{toJSON:function(e){var t,n=e.constructor;if(void 0!==n.toJSON)t=n.toJSON(e);else{t={name:e.name,times:qa.convertArray(e.times,Array),values:qa.convertArray(e.values,Array)};var i=e.getInterpolation();i!==e.DefaultInterpolation&&(t.interpolation=i)}return t.type=e.ValueTypeName,t}}),Object.assign(_i.prototype,{constructor:_i,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:2301,InterpolantFactoryMethodDiscrete:function(e){return new Si(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new Ei(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new xi(this.times,this.values,this.getValueSize(),e)},setInterpolation:function(e){var t;switch(e){case 2300:t=this.InterpolantFactoryMethodDiscrete;break;case 2301:t=this.InterpolantFactoryMethodLinear;break;case 2302:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){var n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(n);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=t,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}},getValueSize:function(){return this.values.length/this.times.length},shift:function(e){if(0!==e)for(var t=this.times,n=0,i=t.length;n!==i;++n)t[n]+=e;return this},scale:function(e){if(1!==e)for(var t=this.times,n=0,i=t.length;n!==i;++n)t[n]*=e;return this},trim:function(e,t){for(var n=this.times,i=n.length,r=0,o=i-1;r!==i&&n[r]<e;)++r;for(;-1!==o&&n[o]>t;)--o;if(++o,0!==r||o!==i){r>=o&&(r=(o=Math.max(o,1))-1);var a=this.getValueSize();this.times=qa.arraySlice(n,r,o),this.values=qa.arraySlice(this.values,r*a,o*a)}return this},validate:function(){var e=!0,t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);var n=this.times,i=this.values,r=n.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);for(var o=null,a=0;a!==r;a++){var s=n[a];if("number"==typeof s&&isNaN(s)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,s),e=!1;break}if(null!==o&&o>s){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,s,o),e=!1;break}o=s}if(void 0!==i&&qa.isTypedArray(i)){a=0;for(var c=i.length;a!==c;++a){var l=i[a];if(isNaN(l)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,l),e=!1;break}}}return e},optimize:function(){for(var e=this.times,t=this.values,n=this.getValueSize(),i=2302===this.getInterpolation(),r=1,o=e.length-1,a=1;a<o;++a){var s=!1,c=e[a];if(c!==e[a+1]&&(1!==a||c!==c[0]))if(i)s=!0;else for(var l=a*n,u=l-n,h=l+n,d=0;d!==n;++d){var p=t[l+d];if(p!==t[u+d]||p!==t[h+d]){s=!0;break}}if(s){if(a!==r){e[r]=e[a];var f=a*n,m=r*n;for(d=0;d!==n;++d)t[m+d]=t[f+d]}++r}}if(o>0){for(e[r]=e[o],f=o*n,m=r*n,d=0;d!==n;++d)t[m+d]=t[f+d];++r}return r!==e.length&&(this.times=qa.arraySlice(e,0,r),this.values=qa.arraySlice(t,0,r*n)),this},clone:function(){var e=qa.arraySlice(this.times,0),t=qa.arraySlice(this.values,0),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}),Ti.prototype=Object.assign(Object.create(_i.prototype),{constructor:Ti,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Mi.prototype=Object.assign(Object.create(_i.prototype),{constructor:Mi,ValueTypeName:"color"}),Ci.prototype=Object.assign(Object.create(_i.prototype),{constructor:Ci,ValueTypeName:"number"}),Ai.prototype=Object.assign(Object.create(wi.prototype),{constructor:Ai,interpolate_:function(e,t,n,r){for(var o=this.resultBuffer,a=this.sampleValues,s=this.valueSize,c=e*s,l=(n-t)/(r-t),u=c+s;c!==u;c+=4)i.slerpFlat(o,0,a,c-s,a,c,l);return o}}),Ri.prototype=Object.assign(Object.create(_i.prototype),{constructor:Ri,ValueTypeName:"quaternion",DefaultInterpolation:2301,InterpolantFactoryMethodLinear:function(e){return new Ai(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:void 0}),Pi.prototype=Object.assign(Object.create(_i.prototype),{constructor:Pi,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Ii.prototype=Object.assign(Object.create(_i.prototype),{constructor:Ii,ValueTypeName:"vector"}),Object.assign(Li,{parse:function(e){for(var t=[],n=e.tracks,i=1/(e.fps||1),r=0,o=n.length;r!==o;++r)t.push(Di(n[r]).scale(i));return new Li(e.name,e.duration,t)},toJSON:function(e){for(var t=[],n=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid},r=0,o=n.length;r!==o;++r)t.push(_i.toJSON(n[r]));return i},CreateFromMorphTargetSequence:function(e,t,n,i){for(var r=t.length,o=[],a=0;a<r;a++){var s=[],c=[];s.push((a+r-1)%r,a,(a+1)%r),c.push(0,1,0);var l=qa.getKeyframeOrder(s);s=qa.sortedArray(s,1,l),c=qa.sortedArray(c,1,l),i||0!==s[0]||(s.push(r),c.push(c[0])),o.push(new Ci(".morphTargetInfluences["+t[a].name+"]",s,c).scale(1/n))}return new Li(e,-1,o)},findByName:function(e,t){var n=e;if(!Array.isArray(e)){var i=e;n=i.geometry&&i.geometry.animations||i.animations}for(var r=0;r<n.length;r++)if(n[r].name===t)return n[r];return null},CreateClipsFromMorphTargetSequences:function(e,t,n){for(var i={},r=/^([\w-]*?)([\d]+)$/,o=0,a=e.length;o<a;o++){var s=e[o],c=s.name.match(r);if(c&&c.length>1){var l=i[h=c[1]];l||(i[h]=l=[]),l.push(s)}}var u=[];for(var h in i)u.push(Li.CreateFromMorphTargetSequence(h,i[h],t,n));return u},parseAnimation:function(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var n=function(e,t,n,i,r){if(0!==n.length){var o=[],a=[];qa.flattenJSON(n,o,a,i),0!==o.length&&r.push(new e(t,o,a))}},i=[],r=e.name||"default",o=e.length||-1,a=e.fps||30,s=e.hierarchy||[],c=0;c<s.length;c++){var l=s[c].keys;if(l&&0!==l.length)if(l[0].morphTargets){for(var u={},h=0;h<l.length;h++)if(l[h].morphTargets)for(var d=0;d<l[h].morphTargets.length;d++)u[l[h].morphTargets[d]]=-1;for(var p in u){var f=[],m=[];for(d=0;d!==l[h].morphTargets.length;++d){var g=l[h];f.push(g.time),m.push(g.morphTarget===p?1:0)}i.push(new Ci(".morphTargetInfluence["+p+"]",f,m))}o=u.length*(a||1)}else{var v=".bones["+t[c].name+"]";n(Ii,v+".position",l,"pos",i),n(Ri,v+".quaternion",l,"rot",i),n(Ii,v+".scale",l,"scl",i)}}return 0===i.length?null:new Li(r,o,i)}}),Object.assign(Li.prototype,{resetDuration:function(){for(var e=0,t=0,n=this.tracks.length;t!==n;++t){var i=this.tracks[t];e=Math.max(e,i.times[i.times.length-1])}return this.duration=e,this},trim:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},validate:function(){for(var e=!0,t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e},optimize:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this},clone:function(){for(var e=[],t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new Li(this.name,this.duration,e)}});var Ya={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},Ja=new Oi,Ka={};Object.assign(ki.prototype,{load:function(e,t,n,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var r=this,o=Ya.get(e);if(void 0!==o)return r.manager.itemStart(e),setTimeout(function(){t&&t(o),r.manager.itemEnd(e)},0),o;if(void 0===Ka[e]){var a=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(a){var s=a[1],c=!!a[2],l=a[3];l=decodeURIComponent(l),c&&(l=atob(l));try{var u,h=(this.responseType||"").toLowerCase();switch(h){case"arraybuffer":case"blob":for(var d=new Uint8Array(l.length),p=0;p<l.length;p++)d[p]=l.charCodeAt(p);u="blob"===h?new Blob([d.buffer],{type:s}):d.buffer;break;case"document":var f=new DOMParser;u=f.parseFromString(l,s);break;case"json":u=JSON.parse(l);break;default:u=l}setTimeout(function(){t&&t(u),r.manager.itemEnd(e)},0)}catch(t){setTimeout(function(){i&&i(t),r.manager.itemError(e),r.manager.itemEnd(e)},0)}}else{Ka[e]=[],Ka[e].push({onLoad:t,onProgress:n,onError:i});var m=new XMLHttpRequest;for(var g in m.open("GET",e,!0),m.addEventListener("load",function(t){var n=this.response;Ya.add(e,n);var i=Ka[e];if(delete Ka[e],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received.");for(var o=0,a=i.length;o<a;o++)(s=i[o]).onLoad&&s.onLoad(n);r.manager.itemEnd(e)}else{for(o=0,a=i.length;o<a;o++){var s;(s=i[o]).onError&&s.onError(t)}r.manager.itemError(e),r.manager.itemEnd(e)}},!1),m.addEventListener("progress",function(t){for(var n=Ka[e],i=0,r=n.length;i<r;i++){var o=n[i];o.onProgress&&o.onProgress(t)}},!1),m.addEventListener("error",function(t){var n=Ka[e];delete Ka[e];for(var i=0,o=n.length;i<o;i++){var a=n[i];a.onError&&a.onError(t)}r.manager.itemError(e),r.manager.itemEnd(e)},!1),m.addEventListener("abort",function(t){var n=Ka[e];delete Ka[e];for(var i=0,o=n.length;i<o;i++){var a=n[i];a.onError&&a.onError(t)}r.manager.itemError(e),r.manager.itemEnd(e)},!1),void 0!==this.responseType&&(m.responseType=this.responseType),void 0!==this.withCredentials&&(m.withCredentials=this.withCredentials),m.overrideMimeType&&m.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)m.setRequestHeader(g,this.requestHeader[g]);m.send(null)}return r.manager.itemStart(e),m}Ka[e].push({onLoad:t,onProgress:n,onError:i})},setPath:function(e){return this.path=e,this},setResponseType:function(e){return this.responseType=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setMimeType:function(e){return this.mimeType=e,this},setRequestHeader:function(e){return this.requestHeader=e,this}}),Object.assign(Fi.prototype,{load:function(e,t,n,i){var r=this,o=new ki(r.manager);o.setPath(r.path),o.load(e,function(e){t(r.parse(JSON.parse(e)))},n,i)},parse:function(e){for(var t=[],n=0;n<e.length;n++){var i=Li.parse(e[n]);t.push(i)}return t},setPath:function(e){return this.path=e,this}}),Object.assign(Bi.prototype,{load:function(e,t,n,i){function r(r){c.load(e[r],function(e){var n=o._parser(e,!0);a[r]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},6===(l+=1)&&(1===n.mipmapCount&&(s.minFilter=1006),s.format=n.format,s.needsUpdate=!0,t&&t(s))},n,i)}var o=this,a=[],s=new Zt;s.image=a;var c=new ki(this.manager);if(c.setPath(this.path),c.setResponseType("arraybuffer"),Array.isArray(e))for(var l=0,u=0,h=e.length;u<h;++u)r(u);else c.load(e,function(e){var n=o._parser(e,!0);if(n.isCubemap)for(var i=n.mipmaps.length/n.mipmapCount,r=0;r<i;r++){a[r]={mipmaps:[]};for(var c=0;c<n.mipmapCount;c++)a[r].mipmaps.push(n.mipmaps[r*n.mipmapCount+c]),a[r].format=n.format,a[r].width=n.width,a[r].height=n.height}else s.image.width=n.width,s.image.height=n.height,s.mipmaps=n.mipmaps;1===n.mipmapCount&&(s.minFilter=1006),s.format=n.format,s.needsUpdate=!0,t&&t(s)},n,i);return s},setPath:function(e){return this.path=e,this}}),Object.assign(Ni.prototype,{load:function(e,t,n,i){var r=this,o=new K,a=new ki(this.manager);return a.setResponseType("arraybuffer"),a.setPath(this.path),a.load(e,function(e){var n=r._parser(e);n&&(void 0!==n.image?o.image=n.image:void 0!==n.data&&(o.image.width=n.width,o.image.height=n.height,o.image.data=n.data),o.wrapS=void 0!==n.wrapS?n.wrapS:1001,o.wrapT=void 0!==n.wrapT?n.wrapT:1001,o.magFilter=void 0!==n.magFilter?n.magFilter:1006,o.minFilter=void 0!==n.minFilter?n.minFilter:1008,o.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.format&&(o.format=n.format),void 0!==n.type&&(o.type=n.type),void 0!==n.mipmaps&&(o.mipmaps=n.mipmaps),1===n.mipmapCount&&(o.minFilter=1006),o.needsUpdate=!0,t&&t(o,n))},n,i),o},setPath:function(e){return this.path=e,this}}),Object.assign(Ui.prototype,{crossOrigin:"anonymous",load:function(e,t,n,i){function r(){c.removeEventListener("load",r,!1),c.removeEventListener("error",o,!1),Ya.add(e,this),t&&t(this),a.manager.itemEnd(e)}function o(t){c.removeEventListener("load",r,!1),c.removeEventListener("error",o,!1),i&&i(t),a.manager.itemError(e),a.manager.itemEnd(e)}void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var a=this,s=Ya.get(e);if(void 0!==s)return a.manager.itemStart(e),setTimeout(function(){t&&t(s),a.manager.itemEnd(e)},0),s;var c=document.createElementNS("http://www.w3.org/1999/xhtml","img");return c.addEventListener("load",r,!1),c.addEventListener("error",o,!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(c.crossOrigin=this.crossOrigin),a.manager.itemStart(e),c.src=e,c},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Object.assign(zi.prototype,{crossOrigin:"anonymous",load:function(e,t,n,i){function r(n){a.load(e[n],function(e){o.images[n]=e,6==++s&&(o.needsUpdate=!0,t&&t(o))},void 0,i)}var o=new fe,a=new Ui(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);for(var s=0,c=0;c<e.length;++c)r(c);return o},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Object.assign(Gi.prototype,{crossOrigin:"anonymous",load:function(e,t,n,i){var r=new a,o=new Ui(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(n){r.image=n;var i=e.search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/);r.format=i?1022:1023,r.needsUpdate=!0,void 0!==t&&t(r)},n,i),r},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Object.assign(Hi.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(e,t){var n=this.getUtoTmapping(e);return this.getPoint(n,t)},getPoints:function(e){void 0===e&&(e=5);for(var t=[],n=0;n<=e;n++)t.push(this.getPoint(n/e));return t},getSpacedPoints:function(e){void 0===e&&(e=5);for(var t=[],n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t},getLength:function(){var e=this.getLengths();return e[e.length-1]},getLengths:function(e){if(void 0===e&&(e=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,n,i=[],r=this.getPoint(0),o=0;for(i.push(0),n=1;n<=e;n++)o+=(t=this.getPoint(n/e)).distanceTo(r),i.push(o),r=t;return this.cacheArcLengths=i,i},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(e,t){var n,i=this.getLengths(),r=0,o=i.length;n=t||e*i[o-1];for(var a,s=0,c=o-1;s<=c;)if((a=i[r=Math.floor(s+(c-s)/2)]-n)<0)s=r+1;else{if(!(a>0)){c=r;break}c=r-1}if(i[r=c]===n)return r/(o-1);var l=i[r];return(r+(n-l)/(i[r+1]-l))/(o-1)},getTangent:function(e){var t=e-1e-4,n=e+1e-4;t<0&&(t=0),n>1&&(n=1);var i=this.getPoint(t);return this.getPoint(n).clone().sub(i).normalize()},getTangentAt:function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)},computeFrenetFrames:function(e,t){var n,i,o,a=new r,s=[],c=[],l=[],h=new r,d=new u;for(n=0;n<=e;n++)i=n/e,s[n]=this.getTangentAt(i),s[n].normalize();c[0]=new r,l[0]=new r;var p=Number.MAX_VALUE,f=Math.abs(s[0].x),m=Math.abs(s[0].y),g=Math.abs(s[0].z);for(f<=p&&(p=f,a.set(1,0,0)),m<=p&&(p=m,a.set(0,1,0)),g<=p&&a.set(0,0,1),h.crossVectors(s[0],a).normalize(),c[0].crossVectors(s[0],h),l[0].crossVectors(s[0],c[0]),n=1;n<=e;n++)c[n]=c[n-1].clone(),l[n]=l[n-1].clone(),h.crossVectors(s[n-1],s[n]),h.length()>Number.EPSILON&&(h.normalize(),o=Math.acos(Co.clamp(s[n-1].dot(s[n]),-1,1)),c[n].applyMatrix4(d.makeRotationAxis(h,o))),l[n].crossVectors(s[n],c[n]);if(!0===t)for(o=Math.acos(Co.clamp(c[0].dot(c[e]),-1,1)),o/=e,s[0].dot(h.crossVectors(c[0],c[e]))>0&&(o=-o),n=1;n<=e;n++)c[n].applyMatrix4(d.makeRotationAxis(s[n],o*n)),l[n].crossVectors(s[n],c[n]);return{tangents:s,normals:c,binormals:l}},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this},toJSON:function(){var e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e},fromJSON:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}),ji.prototype=Object.create(Hi.prototype),ji.prototype.constructor=ji,ji.prototype.isEllipseCurve=!0,ji.prototype.getPoint=function(e,t){for(var i=t||new n,r=2*Math.PI,o=this.aEndAngle-this.aStartAngle,a=Math.abs(o)<Number.EPSILON;o<0;)o+=r;for(;o>r;)o-=r;o<Number.EPSILON&&(o=a?0:r),!0!==this.aClockwise||a||(o===r?o=-r:o-=r);var s=this.aStartAngle+e*o,c=this.aX+this.xRadius*Math.cos(s),l=this.aY+this.yRadius*Math.sin(s);if(0!==this.aRotation){var u=Math.cos(this.aRotation),h=Math.sin(this.aRotation),d=c-this.aX,p=l-this.aY
;c=d*u-p*h+this.aX,l=d*h+p*u+this.aY}return i.set(c,l)},ji.prototype.copy=function(e){return Hi.prototype.copy.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},ji.prototype.toJSON=function(){var e=Hi.prototype.toJSON.call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e},ji.prototype.fromJSON=function(e){return Hi.prototype.fromJSON.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},Vi.prototype=Object.create(ji.prototype),Vi.prototype.constructor=Vi,Vi.prototype.isArcCurve=!0;var Za=new r,Qa=new Wi,$a=new Wi,es=new Wi;Xi.prototype=Object.create(Hi.prototype),Xi.prototype.constructor=Xi,Xi.prototype.isCatmullRomCurve3=!0,Xi.prototype.getPoint=function(e,t){var n,i,o,a,s=t||new r,c=this.points,l=c.length,u=(l-(this.closed?0:1))*e,h=Math.floor(u),d=u-h;if(this.closed?h+=h>0?0:(Math.floor(Math.abs(h)/l)+1)*l:0===d&&h===l-1&&(h=l-2,d=1),this.closed||h>0?n=c[(h-1)%l]:(Za.subVectors(c[0],c[1]).add(c[0]),n=Za),i=c[h%l],o=c[(h+1)%l],this.closed||h+2<l?a=c[(h+2)%l]:(Za.subVectors(c[l-1],c[l-2]).add(c[l-1]),a=Za),"centripetal"===this.curveType||"chordal"===this.curveType){var p="chordal"===this.curveType?.5:.25,f=Math.pow(n.distanceToSquared(i),p),m=Math.pow(i.distanceToSquared(o),p),g=Math.pow(o.distanceToSquared(a),p);m<1e-4&&(m=1),f<1e-4&&(f=m),g<1e-4&&(g=m),Qa.initNonuniformCatmullRom(n.x,i.x,o.x,a.x,f,m,g),$a.initNonuniformCatmullRom(n.y,i.y,o.y,a.y,f,m,g),es.initNonuniformCatmullRom(n.z,i.z,o.z,a.z,f,m,g)}else"catmullrom"===this.curveType&&(Qa.initCatmullRom(n.x,i.x,o.x,a.x,this.tension),$a.initCatmullRom(n.y,i.y,o.y,a.y,this.tension),es.initCatmullRom(n.z,i.z,o.z,a.z,this.tension));return s.set(Qa.calc(d),$a.calc(d),es.calc(d)),s},Xi.prototype.copy=function(e){Hi.prototype.copy.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var i=e.points[t];this.points.push(i.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},Xi.prototype.toJSON=function(){var e=Hi.prototype.toJSON.call(this);e.points=[];for(var t=0,n=this.points.length;t<n;t++){var i=this.points[t];e.points.push(i.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e},Xi.prototype.fromJSON=function(e){Hi.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var i=e.points[t];this.points.push((new r).fromArray(i))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},Ki.prototype=Object.create(Hi.prototype),Ki.prototype.constructor=Ki,Ki.prototype.isCubicBezierCurve=!0,Ki.prototype.getPoint=function(e,t){var i=t||new n,r=this.v0,o=this.v1,a=this.v2,s=this.v3;return i.set(Ji(e,r.x,o.x,a.x,s.x),Ji(e,r.y,o.y,a.y,s.y)),i},Ki.prototype.copy=function(e){return Hi.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},Ki.prototype.toJSON=function(){var e=Hi.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},Ki.prototype.fromJSON=function(e){return Hi.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},Zi.prototype=Object.create(Hi.prototype),Zi.prototype.constructor=Zi,Zi.prototype.isCubicBezierCurve3=!0,Zi.prototype.getPoint=function(e,t){var n=t||new r,i=this.v0,o=this.v1,a=this.v2,s=this.v3;return n.set(Ji(e,i.x,o.x,a.x,s.x),Ji(e,i.y,o.y,a.y,s.y),Ji(e,i.z,o.z,a.z,s.z)),n},Zi.prototype.copy=function(e){return Hi.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},Zi.prototype.toJSON=function(){var e=Hi.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},Zi.prototype.fromJSON=function(e){return Hi.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},Qi.prototype=Object.create(Hi.prototype),Qi.prototype.constructor=Qi,Qi.prototype.isLineCurve=!0,Qi.prototype.getPoint=function(e,t){var i=t||new n;return 1===e?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i},Qi.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},Qi.prototype.getTangent=function(){return this.v2.clone().sub(this.v1).normalize()},Qi.prototype.copy=function(e){return Hi.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Qi.prototype.toJSON=function(){var e=Hi.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Qi.prototype.fromJSON=function(e){return Hi.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},$i.prototype=Object.create(Hi.prototype),$i.prototype.constructor=$i,$i.prototype.isLineCurve3=!0,$i.prototype.getPoint=function(e,t){var n=t||new r;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n},$i.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},$i.prototype.copy=function(e){return Hi.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},$i.prototype.toJSON=function(){var e=Hi.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},$i.prototype.fromJSON=function(e){return Hi.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},er.prototype=Object.create(Hi.prototype),er.prototype.constructor=er,er.prototype.isQuadraticBezierCurve=!0,er.prototype.getPoint=function(e,t){var i=t||new n,r=this.v0,o=this.v1,a=this.v2;return i.set(Yi(e,r.x,o.x,a.x),Yi(e,r.y,o.y,a.y)),i},er.prototype.copy=function(e){return Hi.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},er.prototype.toJSON=function(){var e=Hi.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},er.prototype.fromJSON=function(e){return Hi.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},tr.prototype=Object.create(Hi.prototype),tr.prototype.constructor=tr,tr.prototype.isQuadraticBezierCurve3=!0,tr.prototype.getPoint=function(e,t){var n=t||new r,i=this.v0,o=this.v1,a=this.v2;return n.set(Yi(e,i.x,o.x,a.x),Yi(e,i.y,o.y,a.y),Yi(e,i.z,o.z,a.z)),n},tr.prototype.copy=function(e){return Hi.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},tr.prototype.toJSON=function(){var e=Hi.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},tr.prototype.fromJSON=function(e){return Hi.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},nr.prototype=Object.create(Hi.prototype),nr.prototype.constructor=nr,nr.prototype.isSplineCurve=!0,nr.prototype.getPoint=function(e,t){var i=t||new n,r=this.points,o=(r.length-1)*e,a=Math.floor(o),s=o-a,c=r[0===a?a:a-1],l=r[a],u=r[a>r.length-2?r.length-1:a+1],h=r[a>r.length-3?r.length-1:a+2];return i.set(qi(s,c.x,l.x,u.x,h.x),qi(s,c.y,l.y,u.y,h.y)),i},nr.prototype.copy=function(e){Hi.prototype.copy.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var i=e.points[t];this.points.push(i.clone())}return this},nr.prototype.toJSON=function(){var e=Hi.prototype.toJSON.call(this);e.points=[];for(var t=0,n=this.points.length;t<n;t++){var i=this.points[t];e.points.push(i.toArray())}return e},nr.prototype.fromJSON=function(e){Hi.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++){var r=e.points[t];this.points.push((new n).fromArray(r))}return this};var ts=Object.freeze({ArcCurve:Vi,CatmullRomCurve3:Xi,CubicBezierCurve:Ki,CubicBezierCurve3:Zi,EllipseCurve:ji,LineCurve:Qi,LineCurve3:$i,QuadraticBezierCurve:er,QuadraticBezierCurve3:tr,SplineCurve:nr});ir.prototype=Object.assign(Object.create(Hi.prototype),{constructor:ir,add:function(e){this.curves.push(e)},closePath:function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Qi(t,e))},getPoint:function(e){for(var t=e*this.getLength(),n=this.getCurveLengths(),i=0;i<n.length;){if(n[i]>=t){var r=n[i]-t,o=this.curves[i],a=o.getLength(),s=0===a?0:1-r/a;return o.getPointAt(s)}i++}return null},getLength:function(){var e=this.getCurveLengths();return e[e.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,n=0,i=this.curves.length;n<i;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e},getSpacedPoints:function(e){void 0===e&&(e=40);for(var t=[],n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t},getPoints:function(e){e=e||12;for(var t,n=[],i=0,r=this.curves;i<r.length;i++)for(var o=r[i],a=o&&o.isEllipseCurve?2*e:o&&(o.isLineCurve||o.isLineCurve3)?1:o&&o.isSplineCurve?e*o.points.length:e,s=o.getPoints(a),c=0;c<s.length;c++){var l=s[c];t&&t.equals(l)||(n.push(l),t=l)}return this.autoClose&&n.length>1&&!n[n.length-1].equals(n[0])&&n.push(n[0]),n},copy:function(e){Hi.prototype.copy.call(this,e),this.curves=[];for(var t=0,n=e.curves.length;t<n;t++){var i=e.curves[t];this.curves.push(i.clone())}return this.autoClose=e.autoClose,this},toJSON:function(){var e=Hi.prototype.toJSON.call(this);e.autoClose=this.autoClose,e.curves=[];for(var t=0,n=this.curves.length;t<n;t++){var i=this.curves[t];e.curves.push(i.toJSON())}return e},fromJSON:function(e){Hi.prototype.fromJSON.call(this,e),this.autoClose=e.autoClose,this.curves=[];for(var t=0,n=e.curves.length;t<n;t++){var i=e.curves[t];this.curves.push((new ts[i.type]).fromJSON(i))}return this}}),rr.prototype=Object.assign(Object.create(ir.prototype),{constructor:rr,setFromPoints:function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y)},moveTo:function(e,t){this.currentPoint.set(e,t)},lineTo:function(e,t){var i=new Qi(this.currentPoint.clone(),new n(e,t));this.curves.push(i),this.currentPoint.set(e,t)},quadraticCurveTo:function(e,t,i,r){var o=new er(this.currentPoint.clone(),new n(e,t),new n(i,r));this.curves.push(o),this.currentPoint.set(i,r)},bezierCurveTo:function(e,t,i,r,o,a){var s=new Ki(this.currentPoint.clone(),new n(e,t),new n(i,r),new n(o,a));this.curves.push(s),this.currentPoint.set(o,a)},splineThru:function(e){var t=new nr([this.currentPoint.clone()].concat(e));this.curves.push(t),this.currentPoint.copy(e[e.length-1])},arc:function(e,t,n,i,r,o){var a=this.currentPoint.x,s=this.currentPoint.y;this.absarc(e+a,t+s,n,i,r,o)},absarc:function(e,t,n,i,r,o){this.absellipse(e,t,n,n,i,r,o)},ellipse:function(e,t,n,i,r,o,a,s){var c=this.currentPoint.x,l=this.currentPoint.y;this.absellipse(e+c,t+l,n,i,r,o,a,s)},absellipse:function(e,t,n,i,r,o,a,s){var c=new ji(e,t,n,i,r,o,a,s);if(this.curves.length>0){var l=c.getPoint(0);l.equals(this.currentPoint)||this.lineTo(l.x,l.y)}this.curves.push(c);var u=c.getPoint(1);this.currentPoint.copy(u)},copy:function(e){return ir.prototype.copy.call(this,e),this.currentPoint.copy(e.currentPoint),this},toJSON:function(){var e=ir.prototype.toJSON.call(this);return e.currentPoint=this.currentPoint.toArray(),e},fromJSON:function(e){return ir.prototype.fromJSON.call(this,e),this.currentPoint.fromArray(e.currentPoint),this}}),or.prototype=Object.assign(Object.create(rr.prototype),{constructor:or,getPointsHoles:function(e){for(var t=[],n=0,i=this.holes.length;n<i;n++)t[n]=this.holes[n].getPoints(e);return t},extractPoints:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},copy:function(e){rr.prototype.copy.call(this,e),this.holes=[];for(var t=0,n=e.holes.length;t<n;t++){var i=e.holes[t];this.holes.push(i.clone())}return this},toJSON:function(){var e=rr.prototype.toJSON.call(this);e.uuid=this.uuid,e.holes=[];for(var t=0,n=this.holes.length;t<n;t++){var i=this.holes[t];e.holes.push(i.toJSON())}return e},fromJSON:function(e){rr.prototype.fromJSON.call(this,e),this.uuid=e.uuid,this.holes=[];for(var t=0,n=e.holes.length;t<n;t++){var i=e.holes[t];this.holes.push((new rr).fromJSON(i))}return this}}),ar.prototype=Object.assign(Object.create(p.prototype),{constructor:ar,isLight:!0,copy:function(e){return p.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},toJSON:function(e){var t=p.prototype.toJSON.call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}),sr.prototype=Object.assign(Object.create(ar.prototype),{constructor:sr,isHemisphereLight:!0,copy:function(e){return ar.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}),Object.assign(cr.prototype,{copy:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var e={};return 0!==this.bias&&(e.bias=this.bias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}),lr.prototype=Object.assign(Object.create(cr.prototype),{constructor:lr,isSpotLightShadow:!0,update:function(e){var t=this.camera,n=2*Co.RAD2DEG*e.angle,i=this.mapSize.width/this.mapSize.height,r=e.distance||t.far;n===t.fov&&i===t.aspect&&r===t.far||(t.fov=n,t.aspect=i,t.far=r,t.updateProjectionMatrix())}}),ur.prototype=Object.assign(Object.create(ar.prototype),{constructor:ur,isSpotLight:!0,copy:function(e){return ar.prototype.copy.call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),hr.prototype=Object.assign(Object.create(ar.prototype),{constructor:hr,isPointLight:!0,copy:function(e){return ar.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}),dr.prototype=Object.assign(Object.create(X.prototype),{constructor:dr,isOrthographicCamera:!0,copy:function(e,t){return X.prototype.copy.call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this},setViewOffset:function(e,t,n,i,r,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2,r=n-e,o=n+e,a=i+t,s=i-t;if(null!==this.view&&this.view.enabled){var c=this.zoom/(this.view.width/this.view.fullWidth),l=this.zoom/(this.view.height/this.view.fullHeight),u=(this.right-this.left)/this.view.width,h=(this.top-this.bottom)/this.view.height;o=(r+=u*(this.view.offsetX/c))+u*(this.view.width/c),s=(a-=h*(this.view.offsetY/l))-h*(this.view.height/l)}this.projectionMatrix.makeOrthographic(r,o,a,s,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){var t=p.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}),pr.prototype=Object.assign(Object.create(cr.prototype),{constructor:pr}),fr.prototype=Object.assign(Object.create(ar.prototype),{constructor:fr,isDirectionalLight:!0,copy:function(e){return ar.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),mr.prototype=Object.assign(Object.create(ar.prototype),{constructor:mr,isAmbientLight:!0}),gr.prototype=Object.assign(Object.create(ar.prototype),{constructor:gr,isRectAreaLight:!0,copy:function(e){return ar.prototype.copy.call(this,e),this.width=e.width,this.height=e.height,this},toJSON:function(e){var t=ar.prototype.toJSON.call(this,e);return t.object.width=this.width,t.object.height=this.height,t}}),Object.assign(vr.prototype,{load:function(e,t,n,i){var r=this,o=new ki(r.manager);o.setPath(r.path),o.load(e,function(e){t(r.parse(JSON.parse(e)))},n,i)},parse:function(e){function t(e){return void 0===i[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),i[e]}var i=this.textures,a=new Xa[e.type];if(void 0!==e.uuid&&(a.uuid=e.uuid),void 0!==e.name&&(a.name=e.name),void 0!==e.color&&a.color.setHex(e.color),void 0!==e.roughness&&(a.roughness=e.roughness),void 0!==e.metalness&&(a.metalness=e.metalness),void 0!==e.emissive&&a.emissive.setHex(e.emissive),void 0!==e.specular&&a.specular.setHex(e.specular),void 0!==e.shininess&&(a.shininess=e.shininess),void 0!==e.clearCoat&&(a.clearCoat=e.clearCoat),void 0!==e.clearCoatRoughness&&(a.clearCoatRoughness=e.clearCoatRoughness),void 0!==e.vertexColors&&(a.vertexColors=e.vertexColors),void 0!==e.fog&&(a.fog=e.fog),void 0!==e.flatShading&&(a.flatShading=e.flatShading),void 0!==e.blending&&(a.blending=e.blending),void 0!==e.combine&&(a.combine=e.combine),void 0!==e.side&&(a.side=e.side),void 0!==e.opacity&&(a.opacity=e.opacity),void 0!==e.transparent&&(a.transparent=e.transparent),void 0!==e.alphaTest&&(a.alphaTest=e.alphaTest),void 0!==e.depthTest&&(a.depthTest=e.depthTest),void 0!==e.depthWrite&&(a.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(a.colorWrite=e.colorWrite),void 0!==e.wireframe&&(a.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(a.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(a.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(a.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(a.rotation=e.rotation),1!==e.linewidth&&(a.linewidth=e.linewidth),void 0!==e.dashSize&&(a.dashSize=e.dashSize),void 0!==e.gapSize&&(a.gapSize=e.gapSize),void 0!==e.scale&&(a.scale=e.scale),void 0!==e.polygonOffset&&(a.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(a.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(a.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.skinning&&(a.skinning=e.skinning),void 0!==e.morphTargets&&(a.morphTargets=e.morphTargets),void 0!==e.morphNormals&&(a.morphNormals=e.morphNormals),void 0!==e.dithering&&(a.dithering=e.dithering),void 0!==e.visible&&(a.visible=e.visible),void 0!==e.userData&&(a.userData=e.userData),void 0!==e.uniforms)for(var c in e.uniforms){var l=e.uniforms[c];switch(a.uniforms[c]={},l.type){case"t":a.uniforms[c].value=t(l.value);break;case"c":a.uniforms[c].value=(new b).setHex(l.value);break;case"v2":a.uniforms[c].value=(new n).fromArray(l.value);break;case"v3":a.uniforms[c].value=(new r).fromArray(l.value);break;case"v4":a.uniforms[c].value=(new s).fromArray(l.value);break;case"m3":a.uniforms[c].value=(new o).fromArray(l.value);case"m4":a.uniforms[c].value=(new u).fromArray(l.value);break;default:a.uniforms[c].value=l.value}}if(void 0!==e.defines&&(a.defines=e.defines),void 0!==e.vertexShader&&(a.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(a.fragmentShader=e.fragmentShader),void 0!==e.extensions)for(var h in e.extensions)a.extensions[h]=e.extensions[h];if(void 0!==e.shading&&(a.flatShading=1===e.shading),void 0!==e.size&&(a.size=e.size),void 0!==e.sizeAttenuation&&(a.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(a.map=t(e.map)),void 0!==e.matcap&&(a.matcap=t(e.matcap)),void 0!==e.alphaMap&&(a.alphaMap=t(e.alphaMap),a.transparent=!0),void 0!==e.bumpMap&&(a.bumpMap=t(e.bumpMap)),void 0!==e.bumpScale&&(a.bumpScale=e.bumpScale),void 0!==e.normalMap&&(a.normalMap=t(e.normalMap)),void 0!==e.normalMapType&&(a.normalMapType=e.normalMapType),void 0!==e.normalScale){var d=e.normalScale;!1===Array.isArray(d)&&(d=[d,d]),a.normalScale=(new n).fromArray(d)}return void 0!==e.displacementMap&&(a.displacementMap=t(e.displacementMap)),void 0!==e.displacementScale&&(a.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(a.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(a.roughnessMap=t(e.roughnessMap)),void 0!==e.metalnessMap&&(a.metalnessMap=t(e.metalnessMap)),void 0!==e.emissiveMap&&(a.emissiveMap=t(e.emissiveMap)),void 0!==e.emissiveIntensity&&(a.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(a.specularMap=t(e.specularMap)),void 0!==e.envMap&&(a.envMap=t(e.envMap)),void 0!==e.envMapIntensity&&(a.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(a.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(a.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(a.lightMap=t(e.lightMap)),void 0!==e.lightMapIntensity&&(a.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(a.aoMap=t(e.aoMap)),void 0!==e.aoMapIntensity&&(a.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(a.gradientMap=t(e.gradientMap)),a},setPath:function(e){return this.path=e,this},setTextures:function(e){return this.textures=e,this}});var ns={decodeText:function(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);for(var t="",n=0,i=e.length;n<i;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch(e){return t}},extractUrlBase:function(e){var t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)}};yr.prototype=Object.assign(Object.create(N.prototype),{constructor:yr,isInstancedBufferGeometry:!0,copy:function(e){return N.prototype.copy.call(this,e),this.maxInstancedCount=e.maxInstancedCount,this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var e=N.prototype.toJSON.call(this);return e.maxInstancedCount=this.maxInstancedCount,e.isInstancedBufferGeometry=!0,e}}),br.prototype=Object.assign(Object.create(M.prototype),{constructor:br,isInstancedBufferAttribute:!0,copy:function(e){return M.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},toJSON:function(){var e=M.prototype.toJSON.call(this);return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}),Object.assign(wr.prototype,{load:function(e,t,n,i){var r=this,o=new ki(r.manager);o.setPath(r.path),o.load(e,function(e){t(r.parse(JSON.parse(e)))},n,i)},parse:function(e){var t=e.isInstancedBufferGeometry?new yr:new N,n=e.data.index;if(void 0!==n){var i=new is[n.type](n.array);t.setIndex(new M(i,1))}var o=e.data.attributes;for(var a in o){var s=o[a],c=(i=new is[s.type](s.array),new(s.isInstancedBufferAttribute?br:M)(i,s.itemSize,s.normalized));void 0!==s.name&&(c.name=s.name),t.addAttribute(a,c)}var l=e.data.morphAttributes;if(l)for(var a in l){for(var u=l[a],h=[],d=0,p=u.length;d<p;d++)s=u[d],c=new M(i=new is[s.type](s.array),s.itemSize,s.normalized),void 0!==s.name&&(c.name=s.name),h.push(c);t.morphAttributes[a]=h}var f=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==f){d=0;for(var m=f.length;d!==m;++d){var v=f[d];t.addGroup(v.start,v.count,v.materialIndex)}}var y=e.data.boundingSphere;if(void 0!==y){var b=new r;void 0!==y.center&&b.fromArray(y.center),t.boundingSphere=new g(b,y.radius)}return e.name&&(t.name=e.name),e.userData&&(t.userData=e.userData),t},setPath:function(e){return this.path=e,this}});var is={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};Object.assign(xr.prototype,{crossOrigin:"anonymous",load:function(e,t,n,i){var r=this,o=void 0===this.path?ns.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||o;var a=new ki(r.manager);a.setPath(this.path),a.load(e,function(n){var o=null;try{o=JSON.parse(n)}catch(t){return void 0!==i&&i(t),void console.error("THREE:ObjectLoader: Can't parse "+e+".",t.message)}var a=o.metadata;void 0!==a&&void 0!==a.type&&"geometry"!==a.type.toLowerCase()?r.parse(o,t):console.error("THREE.ObjectLoader: Can't load "+e)},n,i)},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setCrossOrigin:function(e){return this.crossOrigin=e,this},parse:function(e,t){var n=this.parseShape(e.shapes),i=this.parseGeometries(e.geometries,n),r=this.parseImages(e.images,function(){void 0!==t&&t(s)}),o=this.parseTextures(e.textures,r),a=this.parseMaterials(e.materials,o),s=this.parseObject(e.object,i,a);return e.animations&&(s.animations=this.parseAnimations(e.animations)),void 0!==e.images&&0!==e.images.length||void 0!==t&&t(s),s},parseShape:function(e){var t={};if(void 0!==e)for(var n=0,i=e.length;n<i;n++){var r=(new or).fromJSON(e[n]);t[r.uuid]=r}return t},parseGeometries:function(e,t){var n={};if(void 0!==e)for(var i=new wr,r=0,o=e.length;r<o;r++){var a,s=e[r];switch(s.type){case"PlaneGeometry":case"PlaneBufferGeometry":a=new Wa[s.type](s.width,s.height,s.widthSegments,s.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":a=new Wa[s.type](s.width,s.height,s.depth,s.widthSegments,s.heightSegments,s.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":a=new Wa[s.type](s.radius,s.segments,s.thetaStart,s.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":a=new Wa[s.type](s.radiusTop,s.radiusBottom,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":a=new Wa[s.type](s.radius,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":a=new Wa[s.type](s.radius,s.widthSegments,s.heightSegments,s.phiStart,s.phiLength,s.thetaStart,s.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":a=new Wa[s.type](s.radius,s.detail);break;case"RingGeometry":case"RingBufferGeometry":a=new Wa[s.type](s.innerRadius,s.outerRadius,s.thetaSegments,s.phiSegments,s.thetaStart,s.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":a=new Wa[s.type](s.radius,s.tube,s.radialSegments,s.tubularSegments,s.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":a=new Wa[s.type](s.radius,s.tube,s.tubularSegments,s.radialSegments,s.p,s.q);break;case"TubeGeometry":case"TubeBufferGeometry":a=new Wa[s.type]((new ts[s.path.type]).fromJSON(s.path),s.tubularSegments,s.radius,s.radialSegments,s.closed);break;case"LatheGeometry":case"LatheBufferGeometry":a=new Wa[s.type](s.points,s.segments,s.phiStart,s.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":a=new Wa[s.type](s.vertices,s.indices,s.radius,s.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":for(var c=[],l=0,u=s.shapes.length;l<u;l++){var h=t[s.shapes[l]];c.push(h)}a=new Wa[s.type](c,s.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":for(c=[],l=0,u=s.shapes.length;l<u;l++)h=t[s.shapes[l]],c.push(h);var d=s.options.extrudePath;void 0!==d&&(s.options.extrudePath=(new ts[d.type]).fromJSON(d)),a=new Wa[s.type](c,s.options);break;case"BufferGeometry":case"InstancedBufferGeometry":a=i.parse(s);break;case"Geometry":"THREE"in window&&"LegacyJSONLoader"in THREE?a=(new THREE.LegacyJSONLoader).parse(s,this.resourcePath).geometry:console.error('THREE.ObjectLoader: You have to import LegacyJSONLoader in order load geometry data of type "Geometry".');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+s.type+'"');continue}a.uuid=s.uuid,void 0!==s.name&&(a.name=s.name),!0===a.isBufferGeometry&&void 0!==s.userData&&(a.userData=s.userData),n[s.uuid]=a}return n},parseMaterials:function(e,t){var n={},i={};if(void 0!==e){var r=new vr;r.setTextures(t);for(var o=0,a=e.length;o<a;o++){var s=e[o];if("MultiMaterial"===s.type){for(var c=[],l=0;l<s.materials.length;l++){var u=s.materials[l];void 0===n[u.uuid]&&(n[u.uuid]=r.parse(u)),c.push(n[u.uuid])}i[s.uuid]=c}else void 0===n[s.uuid]&&(n[s.uuid]=r.parse(s)),i[s.uuid]=n[s.uuid]}}return i},parseAnimations:function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n],r=Li.parse(i);void 0!==i.uuid&&(r.uuid=i.uuid),t.push(r)}return t},parseImages:function(e,t){function n(e){return i.manager.itemStart(e),o.load(e,function(){i.manager.itemEnd(e)},void 0,function(){i.manager.itemError(e),i.manager.itemEnd(e)})}var i=this,r={};if(void 0!==e&&e.length>0){var o=new Ui(new Oi(t));o.setCrossOrigin(this.crossOrigin);for(var a=0,s=e.length;a<s;a++){var c=e[a],l=c.url;if(Array.isArray(l)){r[c.uuid]=[];for(var u=0,h=l.length;u<h;u++){var d=l[u],p=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(d)?d:i.resourcePath+d;r[c.uuid].push(n(p))}}else p=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(c.url)?c.url:i.resourcePath+c.url,r[c.uuid]=n(p)}}return r},parseTextures:function(e,t){function n(e,t){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}var i={};if(void 0!==e)for(var r=0,o=e.length;r<o;r++){var s,c=e[r];void 0===c.image&&console.warn('THREE.ObjectLoader: No "image" specified for',c.uuid),void 0===t[c.image]&&console.warn("THREE.ObjectLoader: Undefined image",c.image),(s=Array.isArray(t[c.image])?new fe(t[c.image]):new a(t[c.image])).needsUpdate=!0,s.uuid=c.uuid,void 0!==c.name&&(s.name=c.name),void 0!==c.mapping&&(s.mapping=n(c.mapping,ls)),void 0!==c.offset&&s.offset.fromArray(c.offset),void 0!==c.repeat&&s.repeat.fromArray(c.repeat),void 0!==c.center&&s.center.fromArray(c.center),void 0!==c.rotation&&(s.rotation=c.rotation),void 0!==c.wrap&&(s.wrapS=n(c.wrap[0],us),s.wrapT=n(c.wrap[1],us)),void 0!==c.format&&(s.format=c.format),void 0!==c.type&&(s.type=c.type),void 0!==c.encoding&&(s.encoding=c.encoding),void 0!==c.minFilter&&(s.minFilter=n(c.minFilter,hs)),void 0!==c.magFilter&&(s.magFilter=n(c.magFilter,hs)),void 0!==c.anisotropy&&(s.anisotropy=c.anisotropy),void 0!==c.flipY&&(s.flipY=c.flipY),void 0!==c.premultiplyAlpha&&(s.premultiplyAlpha=c.premultiplyAlpha),void 0!==c.unpackAlignment&&(s.unpackAlignment=c.unpackAlignment),i[c.uuid]=s}return i},parseObject:function(e,t,n){function i(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function r(e){if(void 0!==e){if(Array.isArray(e)){for(var t=[],i=0,r=e.length;i<r;i++){var o=e[i];void 0===n[o]&&console.warn("THREE.ObjectLoader: Undefined material",o),t.push(n[o])}return t}return void 0===n[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),n[e]}}var o;switch(e.type){case"Scene":o=new f,void 0!==e.background&&Number.isInteger(e.background)&&(o.background=new b(e.background)),void 0!==e.fog&&("Fog"===e.fog.type?o.fog=new kt(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(o.fog=new Ot(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":
o=new q(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(o.focus=e.focus),void 0!==e.zoom&&(o.zoom=e.zoom),void 0!==e.filmGauge&&(o.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(o.filmOffset=e.filmOffset),void 0!==e.view&&(o.view=Object.assign({},e.view));break;case"OrthographicCamera":o=new dr(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(o.zoom=e.zoom),void 0!==e.view&&(o.view=Object.assign({},e.view));break;case"AmbientLight":o=new mr(e.color,e.intensity);break;case"DirectionalLight":o=new fr(e.color,e.intensity);break;case"PointLight":o=new hr(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":o=new gr(e.color,e.intensity,e.width,e.height);break;case"SpotLight":o=new ur(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":o=new sr(e.color,e.groundColor,e.intensity);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":var a=i(e.geometry),s=r(e.material);o=a.bones&&a.bones.length>0?new Gt(a,s):new U(a,s),void 0!==e.drawMode&&o.setDrawMode(e.drawMode);break;case"LOD":o=new zt;break;case"Line":o=new Wt(i(e.geometry),r(e.material),e.mode);break;case"LineLoop":o=new qt(i(e.geometry),r(e.material));break;case"LineSegments":o=new Xt(i(e.geometry),r(e.material));break;case"PointCloud":case"Points":o=new Jt(i(e.geometry),r(e.material));break;case"Sprite":o=new Ut(r(e.material));break;case"Group":o=new At;break;default:o=new p}if(o.uuid=e.uuid,void 0!==e.name&&(o.name=e.name),void 0!==e.matrix?(o.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(o.matrixAutoUpdate=e.matrixAutoUpdate),o.matrixAutoUpdate&&o.matrix.decompose(o.position,o.quaternion,o.scale)):(void 0!==e.position&&o.position.fromArray(e.position),void 0!==e.rotation&&o.rotation.fromArray(e.rotation),void 0!==e.quaternion&&o.quaternion.fromArray(e.quaternion),void 0!==e.scale&&o.scale.fromArray(e.scale)),void 0!==e.castShadow&&(o.castShadow=e.castShadow),void 0!==e.receiveShadow&&(o.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(o.shadow.bias=e.shadow.bias),void 0!==e.shadow.radius&&(o.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&o.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(o.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(o.visible=e.visible),void 0!==e.frustumCulled&&(o.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(o.renderOrder=e.renderOrder),void 0!==e.userData&&(o.userData=e.userData),void 0!==e.layers&&(o.layers.mask=e.layers),void 0!==e.children)for(var c=e.children,l=0;l<c.length;l++)o.add(this.parseObject(c[l],t,n));if("LOD"===e.type)for(var u=e.levels,h=0;h<u.length;h++){var d=u[h],m=o.getObjectByProperty("uuid",d.object);void 0!==m&&o.addLevel(m,d.distance)}return o}});var rs,os,as,ss,cs,ls={UVMapping:300,CubeReflectionMapping:301,CubeRefractionMapping:302,EquirectangularReflectionMapping:303,EquirectangularRefractionMapping:304,SphericalReflectionMapping:305,CubeUVReflectionMapping:306,CubeUVRefractionMapping:307},us={RepeatWrapping:1e3,ClampToEdgeWrapping:1001,MirroredRepeatWrapping:1002},hs={NearestFilter:1003,NearestMipmapNearestFilter:1004,NearestMipmapLinearFilter:1005,LinearFilter:1006,LinearMipmapNearestFilter:1007,LinearMipmapLinearFilter:1008};Er.prototype={constructor:Er,setOptions:function(e){return this.options=e,this},load:function(e,t,n,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var r=this,o=Ya.get(e);if(void 0!==o)return r.manager.itemStart(e),setTimeout(function(){t&&t(o),r.manager.itemEnd(e)},0),o;fetch(e).then(function(e){return e.blob()}).then(function(e){return void 0===r.options?createImageBitmap(e):createImageBitmap(e,r.options)}).then(function(n){Ya.add(e,n),t&&t(n),r.manager.itemEnd(e)}).catch(function(t){i&&i(t),r.manager.itemError(e),r.manager.itemEnd(e)}),r.manager.itemStart(e)},setCrossOrigin:function(){return this},setPath:function(e){return this.path=e,this}},Object.assign(Sr.prototype,{moveTo:function(e,t){this.currentPath=new rr,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t)},lineTo:function(e,t){this.currentPath.lineTo(e,t)},quadraticCurveTo:function(e,t,n,i){this.currentPath.quadraticCurveTo(e,t,n,i)},bezierCurveTo:function(e,t,n,i,r,o){this.currentPath.bezierCurveTo(e,t,n,i,r,o)},splineThru:function(e){this.currentPath.splineThru(e)},toShapes:function(e,t){function n(e){for(var t=[],n=0,i=e.length;n<i;n++){var r=e[n],o=new or;o.curves=r.curves,t.push(o)}return t}function i(e,t){for(var n=t.length,i=!1,r=n-1,o=0;o<n;r=o++){var a=t[r],s=t[o],c=s.x-a.x,l=s.y-a.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(a=t[o],c=-c,s=t[r],l=-l),e.y<a.y||e.y>s.y)continue;if(e.y===a.y){if(e.x===a.x)return!0}else{var u=l*(e.x-a.x)-c*(e.y-a.y);if(0===u)return!0;if(u<0)continue;i=!i}}else{if(e.y!==a.y)continue;if(s.x<=e.x&&e.x<=a.x||a.x<=e.x&&e.x<=s.x)return!0}}return i}var r=ja.isClockWise,o=this.subPaths;if(0===o.length)return[];if(!0===t)return n(o);var a,s,c,l=[];if(1===o.length)return s=o[0],(c=new or).curves=s.curves,l.push(c),l;var u=!r(o[0].getPoints());u=e?!u:u;var h,d,p=[],f=[],m=[],g=0;f[g]=void 0,m[g]=[];for(var v=0,y=o.length;v<y;v++)a=r(h=(s=o[v]).getPoints()),(a=e?!a:a)?(!u&&f[g]&&g++,f[g]={s:new or,p:h},f[g].s.curves=s.curves,u&&g++,m[g]=[]):m[g].push({h:s,p:h[0]});if(!f[0])return n(o);if(f.length>1){for(var b=!1,w=[],x=0,E=f.length;x<E;x++)p[x]=[];for(x=0,E=f.length;x<E;x++)for(var S=m[x],_=0;_<S.length;_++){for(var T=S[_],M=!0,C=0;C<f.length;C++)i(T.p,f[C].p)&&(x!==C&&w.push({froms:x,tos:C,hole:_}),M?(M=!1,p[C].push(T)):b=!0);M&&p[x].push(T)}w.length>0&&(b||(m=p))}v=0;for(var A=f.length;v<A;v++){c=f[v].s,l.push(c);for(var R=0,P=(d=m[v]).length;R<P;R++)c.holes.push(d[R].h)}return l}}),Object.assign(_r.prototype,{isFont:!0,generateShapes:function(e,t){void 0===t&&(t=100);for(var n=[],i=function(e,t,n){for(var i=Array.from?Array.from(e):String(e).split(""),r=t/n.resolution,o=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*r,a=[],s=0,c=0,l=0;l<i.length;l++){var u=i[l];if("\n"===u)s=0,c-=o;else{var h=Tr(u,r,s,c,n);s+=h.offsetX,a.push(h.path)}}return a}(e,t,this.data),r=0,o=i.length;r<o;r++)Array.prototype.push.apply(n,i[r].toShapes());return n}}),Object.assign(Mr.prototype,{load:function(e,t,n,i){var r=this,o=new ki(this.manager);o.setPath(this.path),o.load(e,function(e){var n;try{n=JSON.parse(e)}catch(t){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),n=JSON.parse(e.substring(65,e.length-2))}var i=r.parse(n);t&&t(i)},n,i)},parse:function(e){return new _r(e)},setPath:function(e){return this.path=e,this}}),Cr.Handlers={handlers:[],add:function(e,t){this.handlers.push(e,t)},get:function(e){for(var t=this.handlers,n=0,i=t.length;n<i;n+=2){var r=t[n],o=t[n+1];if(r.test(e))return o}return null}},Object.assign(Cr.prototype,{crossOrigin:"anonymous",onLoadStart:function(){},onLoadProgress:function(){},onLoadComplete:function(){},initMaterials:function(e,t,n){for(var i=[],r=0;r<e.length;++r)i[r]=this.createMaterial(e[r],t,n);return i},createMaterial:(rs={NoBlending:0,NormalBlending:1,AdditiveBlending:2,SubtractiveBlending:3,MultiplyBlending:4,CustomBlending:5},os=new b,as=new Gi,ss=new vr,function(e,t,n){function i(e,i,o,a,s){var c,l=t+e,u=Cr.Handlers.get(l);null!==u?c=u.load(l):(as.setCrossOrigin(n),c=as.load(l)),void 0!==i&&(c.repeat.fromArray(i),1!==i[0]&&(c.wrapS=1e3),1!==i[1]&&(c.wrapT=1e3)),void 0!==o&&c.offset.fromArray(o),void 0!==a&&("repeat"===a[0]&&(c.wrapS=1e3),"mirror"===a[0]&&(c.wrapS=1002),"repeat"===a[1]&&(c.wrapT=1e3),"mirror"===a[1]&&(c.wrapT=1002)),void 0!==s&&(c.anisotropy=s);var h=Co.generateUUID();return r[h]=c,h}var r={},o={uuid:Co.generateUUID(),type:"MeshLambertMaterial"};for(var a in e){var s=e[a];switch(a){case"DbgColor":case"DbgIndex":case"opticalDensity":case"illumination":break;case"DbgName":o.name=s;break;case"blending":o.blending=rs[s];break;case"colorAmbient":case"mapAmbient":console.warn("THREE.Loader.createMaterial:",a,"is no longer supported.");break;case"colorDiffuse":o.color=os.fromArray(s).getHex();break;case"colorSpecular":o.specular=os.fromArray(s).getHex();break;case"colorEmissive":o.emissive=os.fromArray(s).getHex();break;case"specularCoef":o.shininess=s;break;case"shading":"basic"===s.toLowerCase()&&(o.type="MeshBasicMaterial"),"phong"===s.toLowerCase()&&(o.type="MeshPhongMaterial"),"standard"===s.toLowerCase()&&(o.type="MeshStandardMaterial");break;case"mapDiffuse":o.map=i(s,e.mapDiffuseRepeat,e.mapDiffuseOffset,e.mapDiffuseWrap,e.mapDiffuseAnisotropy);break;case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":break;case"mapEmissive":o.emissiveMap=i(s,e.mapEmissiveRepeat,e.mapEmissiveOffset,e.mapEmissiveWrap,e.mapEmissiveAnisotropy);break;case"mapEmissiveRepeat":case"mapEmissiveOffset":case"mapEmissiveWrap":case"mapEmissiveAnisotropy":break;case"mapLight":o.lightMap=i(s,e.mapLightRepeat,e.mapLightOffset,e.mapLightWrap,e.mapLightAnisotropy);break;case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":break;case"mapAO":o.aoMap=i(s,e.mapAORepeat,e.mapAOOffset,e.mapAOWrap,e.mapAOAnisotropy);break;case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":break;case"mapBump":o.bumpMap=i(s,e.mapBumpRepeat,e.mapBumpOffset,e.mapBumpWrap,e.mapBumpAnisotropy);break;case"mapBumpScale":o.bumpScale=s;break;case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":break;case"mapNormal":o.normalMap=i(s,e.mapNormalRepeat,e.mapNormalOffset,e.mapNormalWrap,e.mapNormalAnisotropy);break;case"mapNormalFactor":o.normalScale=s;break;case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":break;case"mapSpecular":o.specularMap=i(s,e.mapSpecularRepeat,e.mapSpecularOffset,e.mapSpecularWrap,e.mapSpecularAnisotropy);break;case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":break;case"mapMetalness":o.metalnessMap=i(s,e.mapMetalnessRepeat,e.mapMetalnessOffset,e.mapMetalnessWrap,e.mapMetalnessAnisotropy);break;case"mapMetalnessRepeat":case"mapMetalnessOffset":case"mapMetalnessWrap":case"mapMetalnessAnisotropy":break;case"mapRoughness":o.roughnessMap=i(s,e.mapRoughnessRepeat,e.mapRoughnessOffset,e.mapRoughnessWrap,e.mapRoughnessAnisotropy);break;case"mapRoughnessRepeat":case"mapRoughnessOffset":case"mapRoughnessWrap":case"mapRoughnessAnisotropy":break;case"mapAlpha":o.alphaMap=i(s,e.mapAlphaRepeat,e.mapAlphaOffset,e.mapAlphaWrap,e.mapAlphaAnisotropy);break;case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"flipSided":o.side=1;break;case"doubleSided":o.side=2;break;case"transparency":console.warn("THREE.Loader.createMaterial: transparency has been renamed to opacity"),o.opacity=s;break;case"depthTest":case"depthWrite":case"colorWrite":case"opacity":case"reflectivity":case"transparent":case"visible":case"wireframe":o[a]=s;break;case"vertexColors":!0===s&&(o.vertexColors=2),"face"===s&&(o.vertexColors=1);break;default:console.error("THREE.Loader.createMaterial: Unsupported",a,s)}}return"MeshBasicMaterial"===o.type&&delete o.emissive,"MeshPhongMaterial"!==o.type&&delete o.specular,o.opacity<1&&(o.transparent=!0),ss.setTextures(r),ss.parse(o)})});var ds,ps,fs,ms,gs,vs,ys,bs,ws,xs,Es,Ss,_s,Ts,Ms={getContext:function(){return void 0===cs&&(cs=new(window.AudioContext||window.webkitAudioContext)),cs},setContext:function(e){cs=e}};Object.assign(Ar.prototype,{load:function(e,t,n,i){var r=new ki(this.manager);r.setResponseType("arraybuffer"),r.setPath(this.path),r.load(e,function(e){var n=e.slice(0);Ms.getContext().decodeAudioData(n,function(e){t(e)})},n,i)},setPath:function(e){return this.path=e,this}}),Object.assign(Rr.prototype,{isSphericalHarmonics3:!0,set:function(e){for(var t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this},zero:function(){for(var e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this},getAt:function(e,t){var n=e.x,i=e.y,r=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.282095),t.addScale(o[1],.488603*i),t.addScale(o[2],.488603*r),t.addScale(o[3],.488603*n),t.addScale(o[4],n*i*1.092548),t.addScale(o[5],i*r*1.092548),t.addScale(o[6],.315392*(3*r*r-1)),t.addScale(o[7],n*r*1.092548),t.addScale(o[8],.546274*(n*n-i*i)),t},getIrradianceAt:function(e,t){var n=e.x,i=e.y,r=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.886227),t.addScale(o[1],1.023328*i),t.addScale(o[2],1.023328*r),t.addScale(o[3],1.023328*n),t.addScale(o[4],.858086*n*i),t.addScale(o[5],.858086*i*r),t.addScale(o[6],.743125*r*r-.247708),t.addScale(o[7],.858086*n*r),t.addScale(o[8],.429043*(n*n-i*i)),t},add:function(e){for(var t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this},scale:function(e){for(var t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this},lerp:function(e,t){for(var n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this},equals:function(e){for(var t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0},copy:function(e){return this.set(e.coefficients)},clone:function(){return(new this.constructor).copy(this)},fromArray:function(e){for(var t=this.coefficients,n=0;n<9;n++)t[n].fromArray(e,3*n);return this},toArray:function(){for(var e=[],t=this.coefficients,n=0;n<9;n++)t[n].toArray(e,3*n);return e}}),Object.assign(Rr,{getBasisAt:function(e,t){var n=e.x,i=e.y,r=e.z;t[0]=.282095,t[1]=.488603*i,t[2]=.488603*r,t[3]=.488603*n,t[4]=1.092548*n*i,t[5]=1.092548*i*r,t[6]=.315392*(3*r*r-1),t[7]=1.092548*n*r,t[8]=.546274*(n*n-i*i)}}),Pr.prototype=Object.assign(Object.create(ar.prototype),{constructor:Pr,isLightProbe:!0,copy:function(e){return ar.prototype.copy.call(this,e),this.sh.copy(e.sh),this.intensity=e.intensity,this},toJSON:function(e){return ar.prototype.toJSON.call(this,e)}}),Ir.prototype=Object.assign(Object.create(Pr.prototype),{constructor:Ir,isHemisphereLightProbe:!0,copy:function(e){return Pr.prototype.copy.call(this,e),this},toJSON:function(e){return Pr.prototype.toJSON.call(this,e)}}),Lr.prototype=Object.assign(Object.create(Pr.prototype),{constructor:Lr,isAmbientLightProbe:!0,copy:function(e){return Pr.prototype.copy.call(this,e),this},toJSON:function(e){return Pr.prototype.toJSON.call(this,e)}}),Object.assign(Dr.prototype,{update:function(){var e,t,n,i,r,o,a,s,c=new u,l=new u;return function(u){if(e!==this||t!==u.focus||n!==u.fov||i!==u.aspect*this.aspect||r!==u.near||o!==u.far||a!==u.zoom||s!==this.eyeSep){e=this,t=u.focus,n=u.fov,i=u.aspect*this.aspect,r=u.near,o=u.far,a=u.zoom;var h,d,p=u.projectionMatrix.clone(),f=(s=this.eyeSep/2)*r/t,m=r*Math.tan(Co.DEG2RAD*n*.5)/a;l.elements[12]=-s,c.elements[12]=s,h=-m*i+f,d=m*i+f,p.elements[0]=2*r/(d-h),p.elements[8]=(d+h)/(d-h),this.cameraL.projectionMatrix.copy(p),h=-m*i-f,d=m*i-f,p.elements[0]=2*r/(d-h),p.elements[8]=(d+h)/(d-h),this.cameraR.projectionMatrix.copy(p)}this.cameraL.matrixWorld.copy(u.matrixWorld).multiply(l),this.cameraR.matrixWorld.copy(u.matrixWorld).multiply(c)}}()}),Object.assign(Or.prototype,{start:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=("undefined"==typeof performance?Date:performance).now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}),kr.prototype=Object.assign(Object.create(p.prototype),{constructor:kr,getInput:function(){return this.gain},removeFilter:function(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},getFilter:function(){return this.filter},setFilter:function(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this},updateMatrixWorld:function(){var e=new r,t=new i,n=new r,o=new r,a=new Or;return function(i){p.prototype.updateMatrixWorld.call(this,i);var r=this.context.listener,s=this.up;if(this.timeDelta=a.getDelta(),this.matrixWorld.decompose(e,t,n),o.set(0,0,-1).applyQuaternion(t),r.positionX){var c=this.context.currentTime+this.timeDelta;r.positionX.linearRampToValueAtTime(e.x,c),r.positionY.linearRampToValueAtTime(e.y,c),r.positionZ.linearRampToValueAtTime(e.z,c),r.forwardX.linearRampToValueAtTime(o.x,c),r.forwardY.linearRampToValueAtTime(o.y,c),r.forwardZ.linearRampToValueAtTime(o.z,c),r.upX.linearRampToValueAtTime(s.x,c),r.upY.linearRampToValueAtTime(s.y,c),r.upZ.linearRampToValueAtTime(s.z,c)}else r.setPosition(e.x,e.y,e.z),r.setOrientation(o.x,o.y,o.z,s.x,s.y,s.z)}}()}),Fr.prototype=Object.assign(Object.create(p.prototype),{constructor:Fr,getOutput:function(){return this.gain},setNodeSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this},setMediaElementSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this},setBuffer:function(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(){if(!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){var e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.onended=this.onEnded.bind(this),this.startTime=this.context.currentTime,e.start(this.startTime,this.offset),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")},pause:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this.source.stop(),this.source.onended=null,this.offset+=(this.context.currentTime-this.startTime)*this.playbackRate,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")},stop:function(){if(!1!==this.hasPlaybackControl)return this.source.stop(),this.source.onended=null,this.offset=0,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},connect:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(e){return e||(e=[]),!0===this.isPlaying?(this.disconnect(),this.filters=e,this.connect()):this.filters=e,this},setDetune:function(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this},getDetune:function(){return this.detune},getFilter:function(){return this.getFilters()[0]},setFilter:function(e){return this.setFilters(e?[e]:[])},setPlaybackRate:function(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")},getVolume:function(){return this.gain.gain.value},setVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}),Br.prototype=Object.assign(Object.create(Fr.prototype),{constructor:Br,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(e){return this.panner.refDistance=e,this},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(e){return this.panner.rolloffFactor=e,this},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(e){return this.panner.distanceModel=e,this},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(e){return this.panner.maxDistance=e,this},setDirectionalCone:function(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this},updateMatrixWorld:function(){var e=new r,t=new i,n=new r,o=new r;return function(i){if(p.prototype.updateMatrixWorld.call(this,i),!0!==this.hasPlaybackControl||!1!==this.isPlaying){this.matrixWorld.decompose(e,t,n),o.set(0,0,1).applyQuaternion(t);var r=this.panner;if(r.positionX){var a=this.context.currentTime+this.listener.timeDelta;r.positionX.linearRampToValueAtTime(e.x,a),r.positionY.linearRampToValueAtTime(e.y,a),r.positionZ.linearRampToValueAtTime(e.z,a),r.orientationX.linearRampToValueAtTime(o.x,a),r.orientationY.linearRampToValueAtTime(o.y,a),r.orientationZ.linearRampToValueAtTime(o.z,a)}else r.setPosition(e.x,e.y,e.z),r.setOrientation(o.x,o.y,o.z)}}}()}),Object.assign(Nr.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var e=0,t=this.getFrequencyData(),n=0;n<t.length;n++)e+=t[n];return e/t.length}}),Object.assign(Ur.prototype,{accumulate:function(e,t){var n=this.buffer,i=this.valueSize,r=e*i+i,o=this.cumulativeWeight;if(0===o){for(var a=0;a!==i;++a)n[r+a]=n[a];o=t}else{var s=t/(o+=t);this._mixBufferRegion(n,r,0,s,i)}this.cumulativeWeight=o},apply:function(e){var t=this.valueSize,n=this.buffer,i=e*t+t,r=this.cumulativeWeight,o=this.binding;if(this.cumulativeWeight=0,r<1){var a=3*t;this._mixBufferRegion(n,i,a,1-r,t)}for(var s=t,c=t+t;s!==c;++s)if(n[s]!==n[s+t]){o.setValue(n,i);break}},saveOriginalState:function(){var e=this.binding,t=this.buffer,n=this.valueSize,i=3*n;e.getValue(t,i);for(var r=n,o=i;r!==o;++r)t[r]=t[i+r%n];this.cumulativeWeight=0},restoreOriginalState:function(){var e=3*this.valueSize;this.binding.setValue(this.buffer,e)},_select:function(e,t,n,i,r){if(i>=.5)for(var o=0;o!==r;++o)e[t+o]=e[n+o]},_slerp:function(e,t,n,r){i.slerpFlat(e,t,e,t,e,n,r)},_lerp:function(e,t,n,i,r){for(var o=1-i,a=0;a!==r;++a){var s=t+a;e[s]=e[s]*o+e[n+a]*i}}}),Object.assign(zr.prototype,{getValue:function(e,t){this.bind();var n=this._targetGroup.nCachedObjects_,i=this._bindings[n];void 0!==i&&i.getValue(e,t)},setValue:function(e,t){for(var n=this._bindings,i=this._targetGroup.nCachedObjects_,r=n.length;i!==r;++i)n[i].setValue(e,t)},bind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()},unbind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}),Object.assign(Gr,{Composite:zr,create:function(e,t,n){return e&&e.isAnimationObjectGroup?new Gr.Composite(e,t,n):new Gr(e,t,n)},sanitizeNodeName:(bs=new RegExp("[\\[\\]\\.:\\/]","g"),function(e){return e.replace(/\s/g,"_").replace(bs,"")}),parseTrackName:(ds="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",ps=/((?:WC+[\/:])*)/.source.replace("WC","[^\\[\\]\\.:\\/]"),fs=/(WCOD+)?/.source.replace("WCOD",ds),ms=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC","[^\\[\\]\\.:\\/]"),gs=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC","[^\\[\\]\\.:\\/]"),vs=new RegExp("^"+ps+fs+ms+gs+"$"),ys=["material","materials","bones"],function(e){var t=vs.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);var n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){var r=n.nodeName.substring(i+1);-1!==ys.indexOf(r)&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=r)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}),findNode:function(e,t){if(!t||""===t||"root"===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){var n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){var i=function(e){for(var n=0;n<e.length;n++){var r=e[n];if(r.name===t||r.uuid===t)return r;var o=i(r.children);if(o)return o}return null},r=i(e.children);if(r)return r}return null}}),Object.assign(Gr.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(e,t){e[t]=this.node[this.propertyName]},function(e,t){for(var n=this.resolvedProperty,i=0,r=n.length;i!==r;++i)e[t++]=n[i]},function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]},function(e,t){this.resolvedProperty.toArray(e,t)}],SetterByBindingTypeAndVersioning:[[function(e,t){this.targetObject[this.propertyName]=e[t]},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){for(var n=this.resolvedProperty,i=0,r=n.length;i!==r;++i)n[i]=e[t++]},function(e,t){for(var n=this.resolvedProperty,i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.needsUpdate=!0},function(e,t){for(var n=this.resolvedProperty,i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty.fromArray(e,t)},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(e,t){this.bind(),this.getValue(e,t)},setValue:function(e,t){this.bind(),this.setValue(e,t)},bind:function(){var e=this.node,t=this.parsedPath,n=t.objectName,i=t.propertyName,r=t.propertyIndex;if(e||(e=Gr.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,e){if(n){var o=t.objectIndex;switch(n){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(var a=0;a<e.length;a++)if(e[a].name===o){o=a;break}break;default:if(void 0===e[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(void 0!==o){if(void 0===e[o])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[o]}}var s=e[i];if(void 0!==s){var c=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?c=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(c=this.Versioning.MatrixWorldNeedsUpdate);var l=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===i){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(e.geometry.isBufferGeometry){if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);for(a=0;a<this.node.geometry.morphAttributes.position.length;a++)if(e.geometry.morphAttributes.position[a].name===r){r=a;break}}else{if(!e.geometry.morphTargets)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);for(a=0;a<this.node.geometry.morphTargets.length;a++)if(e.geometry.morphTargets[a].name===r){r=a;break}}}l=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=r}else void 0!==s.fromArray&&void 0!==s.toArray?(l=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(l=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=i;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][c]}else{var u=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+u+"."+i+" but it wasn't found.",e)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(Gr.prototype,{_getValue_unbound:Gr.prototype.getValue,_setValue_unbound:Gr.prototype.setValue}),Object.assign(Hr.prototype,{isAnimationObjectGroup:!0,add:function(){for(var e=this._objects,t=e.length,n=this.nCachedObjects_,i=this._indicesByUUID,r=this._paths,o=this._parsedPaths,a=this._bindings,s=a.length,c=void 0,l=0,u=arguments.length;l!==u;++l){var h=arguments[l],d=h.uuid,p=i[d];if(void 0===p){p=t++,i[d]=p,e.push(h);for(var f=0,m=s;f!==m;++f)a[f].push(new Gr(h,r[f],o[f]))}else if(p<n){c=e[p];var g=--n,v=e[g];for(i[v.uuid]=p,e[p]=v,i[d]=g,e[g]=h,f=0,m=s;f!==m;++f){var y=a[f],b=y[g],w=y[p];y[p]=b,void 0===w&&(w=new Gr(h,r[f],o[f])),y[g]=w}}else e[p]!==c&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=n},remove:function(){for(var e=this._objects,t=this.nCachedObjects_,n=this._indicesByUUID,i=this._bindings,r=i.length,o=0,a=arguments.length;o!==a;++o){var s=arguments[o],c=s.uuid,l=n[c];if(void 0!==l&&l>=t){var u=t++,h=e[u];n[h.uuid]=l,e[l]=h,n[c]=u,e[u]=s;for(var d=0,p=r;d!==p;++d){var f=i[d],m=f[u],g=f[l];f[l]=m,f[u]=g}}}this.nCachedObjects_=t},uncache:function(){for(var e=this._objects,t=e.length,n=this.nCachedObjects_,i=this._indicesByUUID,r=this._bindings,o=r.length,a=0,s=arguments.length;a!==s;++a){var c=arguments[a],l=c.uuid,u=i[l];if(void 0!==u)if(delete i[l],u<n){var h=--n,d=e[h],p=e[y=--t];i[d.uuid]=u,e[u]=d,i[p.uuid]=h,e[h]=p,e.pop();for(var f=0,m=o;f!==m;++f){var g=(b=r[f])[h],v=b[y];b[u]=g,b[h]=v,b.pop()}}else{var y;for(i[(p=e[y=--t]).uuid]=u,e[u]=p,e.pop(),f=0,m=o;f!==m;++f){var b;(b=r[f])[u]=b[y],b.pop()}}}this.nCachedObjects_=n},subscribe_:function(e,t){var n=this._bindingsIndicesByPath,i=n[e],r=this._bindings;if(void 0!==i)return r[i];var o=this._paths,a=this._parsedPaths,s=this._objects,c=s.length,l=this.nCachedObjects_,u=new Array(c);i=r.length,n[e]=i,o.push(e),a.push(t),r.push(u);for(var h=l,d=s.length;h!==d;++h){var p=s[h];u[h]=new Gr(p,e,t)}return u},unsubscribe_:function(e){
var t=this._bindingsIndicesByPath,n=t[e];if(void 0!==n){var i=this._paths,r=this._parsedPaths,o=this._bindings,a=o.length-1,s=o[a];t[e[a]]=n,o[n]=s,o.pop(),r[n]=r[a],r.pop(),i[n]=i[a],i.pop()}}}),Object.assign(jr.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(e){return this._startTime=e,this},setLoop:function(e,t){return this.loop=e,this.repetitions=t,this},setEffectiveWeight:function(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(e){return this._scheduleFading(e,0,1)},fadeOut:function(e){return this._scheduleFading(e,1,0)},crossFadeFrom:function(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){var i=this._clip.duration,r=e._clip.duration,o=r/i,a=i/r;e.warp(1,o,t),this.warp(a,1,t)}return this},crossFadeTo:function(e,t,n){return e.crossFadeFrom(this,t,n)},stopFading:function(){var e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},setEffectiveTimeScale:function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()},syncWith:function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()},halt:function(e){return this.warp(this._effectiveTimeScale,0,e)},warp:function(e,t,n){var i=this._mixer,r=i.time,o=this._timeScaleInterpolant,a=this.timeScale;null===o&&(o=i._lendControlInterpolant(),this._timeScaleInterpolant=o);var s=o.parameterPositions,c=o.sampleValues;return s[0]=r,s[1]=r+n,c[0]=e/a,c[1]=t/a,this},stopWarping:function(){var e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(e,t,n,i){if(this.enabled){var r=this._startTime;if(null!==r){var o=(e-r)*n;if(o<0||0===n)return;this._startTime=null,t=n*o}t*=this._updateTimeScale(e);var a=this._updateTime(t),s=this._updateWeight(e);if(s>0)for(var c=this._interpolants,l=this._propertyBindings,u=0,h=c.length;u!==h;++u)c[u].evaluate(a),l[u].accumulate(i,s)}else this._updateWeight(e)},_updateWeight:function(e){var t=0;if(this.enabled){t=this.weight;var n=this._weightInterpolant;if(null!==n){var i=n.evaluate(e)[0];t*=i,e>n.parameterPositions[1]&&(this.stopFading(),0===i&&(this.enabled=!1))}}return this._effectiveWeight=t,t},_updateTimeScale:function(e){var t=0;if(!this.paused){t=this.timeScale;var n=this._timeScaleInterpolant;null!==n&&(t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t},_updateTime:function(e){var t=this.time+e,n=this._clip.duration,i=this.loop,r=this._loopCount,o=2202===i;if(0===e)return-1===r?t:o&&1==(1&r)?n-t:t;if(2200===i){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(t>=n)t=n;else{if(!(t<0)){this.time=t;break e}t=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=t,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===r&&(e>=0?(r=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),t>=n||t<0){var a=Math.floor(t/n);t-=n*a,r+=Math.abs(a);var s=this.repetitions-r;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,t=e>0?n:0,this.time=t,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===s){var c=e<0;this._setEndings(c,!c,o)}else this._setEndings(!1,!1,o);this._loopCount=r,this.time=t,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=t;if(o&&1==(1&r))return n-t}return t},_setEndings:function(e,t,n){var i=this._interpolantSettings;n?(i.endingStart=2401,i.endingEnd=2401):(i.endingStart=e?this.zeroSlopeAtStart?2401:2400:2402,i.endingEnd=t?this.zeroSlopeAtEnd?2401:2400:2402)},_scheduleFading:function(e,t,n){var i=this._mixer,r=i.time,o=this._weightInterpolant;null===o&&(o=i._lendControlInterpolant(),this._weightInterpolant=o);var a=o.parameterPositions,s=o.sampleValues;return a[0]=r,s[0]=t,a[1]=r+e,s[1]=n,this}}),Vr.prototype=Object.assign(Object.create(t.prototype),{constructor:Vr,_bindAction:function(e,t){var n=e._localRoot||this._root,i=e._clip.tracks,r=i.length,o=e._propertyBindings,a=e._interpolants,s=n.uuid,c=this._bindingsByRootAndName,l=c[s];void 0===l&&(l={},c[s]=l);for(var u=0;u!==r;++u){var h=i[u],d=h.name,p=l[d];if(void 0!==p)o[u]=p;else{if(void 0!==(p=o[u])){null===p._cacheIndex&&(++p.referenceCount,this._addInactiveBinding(p,s,d));continue}var f=t&&t._propertyBindings[u].binding.parsedPath;++(p=new Ur(Gr.create(n,d,f),h.ValueTypeName,h.getValueSize())).referenceCount,this._addInactiveBinding(p,s,d),o[u]=p}a[u].resultBuffer=p.buffer}},_activateAction:function(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){var t=(e._localRoot||this._root).uuid,n=e._clip.uuid,i=this._actionsByClip[n];this._bindAction(e,i&&i.knownActions[0]),this._addInactiveAction(e,n,t)}for(var r=e._propertyBindings,o=0,a=r.length;o!==a;++o){var s=r[o];0==s.useCount++&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}},_deactivateAction:function(e){if(this._isActiveAction(e)){for(var t=e._propertyBindings,n=0,i=t.length;n!==i;++n){var r=t[n];0==--r.useCount&&(r.restoreOriginalState(),this._takeBackBinding(r))}this._takeBackAction(e)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},_isActiveAction:function(e){var t=e._cacheIndex;return null!==t&&t<this._nActiveActions},_addInactiveAction:function(e,t,n){var i=this._actions,r=this._actionsByClip,o=r[t];if(void 0===o)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,r[t]=o;else{var a=o.knownActions;e._byClipCacheIndex=a.length,a.push(e)}e._cacheIndex=i.length,i.push(e),o.actionByRoot[n]=e},_removeInactiveAction:function(e){var t=this._actions,n=t[t.length-1],i=e._cacheIndex;n._cacheIndex=i,t[i]=n,t.pop(),e._cacheIndex=null;var r=e._clip.uuid,o=this._actionsByClip,a=o[r],s=a.knownActions,c=s[s.length-1],l=e._byClipCacheIndex;c._byClipCacheIndex=l,s[l]=c,s.pop(),e._byClipCacheIndex=null,delete a.actionByRoot[(e._localRoot||this._root).uuid],0===s.length&&delete o[r],this._removeInactiveBindingsForAction(e)},_removeInactiveBindingsForAction:function(e){for(var t=e._propertyBindings,n=0,i=t.length;n!==i;++n){var r=t[n];0==--r.referenceCount&&this._removeInactiveBinding(r)}},_lendAction:function(e){var t=this._actions,n=e._cacheIndex,i=this._nActiveActions++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r},_takeBackAction:function(e){var t=this._actions,n=e._cacheIndex,i=--this._nActiveActions,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r},_addInactiveBinding:function(e,t,n){var i=this._bindingsByRootAndName,r=i[t],o=this._bindings;void 0===r&&(r={},i[t]=r),r[n]=e,e._cacheIndex=o.length,o.push(e)},_removeInactiveBinding:function(e){var t=this._bindings,n=e.binding,i=n.rootNode.uuid,r=n.path,o=this._bindingsByRootAndName,a=o[i],s=t[t.length-1],c=e._cacheIndex;s._cacheIndex=c,t[c]=s,t.pop(),delete a[r],0===Object.keys(a).length&&delete o[i]},_lendBinding:function(e){var t=this._bindings,n=e._cacheIndex,i=this._nActiveBindings++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r},_takeBackBinding:function(e){var t=this._bindings,n=e._cacheIndex,i=--this._nActiveBindings,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r},_lendControlInterpolant:function(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,n=e[t];return void 0===n&&((n=new Ei(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=t,e[t]=n),n},_takeBackControlInterpolant:function(e){var t=this._controlInterpolants,n=e.__cacheIndex,i=--this._nActiveControlInterpolants,r=t[i];e.__cacheIndex=i,t[i]=e,r.__cacheIndex=n,t[n]=r},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(e,t){var n=t||this._root,i=n.uuid,r="string"==typeof e?Li.findByName(n,e):e,o=null!==r?r.uuid:e,a=this._actionsByClip[o],s=null;if(void 0!==a){var c=a.actionByRoot[i];if(void 0!==c)return c;s=a.knownActions[0],null===r&&(r=s._clip)}if(null===r)return null;var l=new jr(this,r,t);return this._bindAction(l,s),this._addInactiveAction(l,o,i),l},existingAction:function(e,t){var n=t||this._root,i=n.uuid,r="string"==typeof e?Li.findByName(n,e):e,o=r?r.uuid:e,a=this._actionsByClip[o];return void 0!==a&&a.actionByRoot[i]||null},stopAllAction:function(){var e=this._actions,t=this._nActiveActions,n=this._bindings,i=this._nActiveBindings;this._nActiveActions=0,this._nActiveBindings=0;for(var r=0;r!==t;++r)e[r].reset();for(r=0;r!==i;++r)n[r].useCount=0;return this},update:function(e){e*=this.timeScale;for(var t=this._actions,n=this._nActiveActions,i=this.time+=e,r=Math.sign(e),o=this._accuIndex^=1,a=0;a!==n;++a)t[a]._update(i,e,r,o);var s=this._bindings,c=this._nActiveBindings;for(a=0;a!==c;++a)s[a].apply(o);return this},getRoot:function(){return this._root},uncacheClip:function(e){var t=this._actions,n=e.uuid,i=this._actionsByClip,r=i[n];if(void 0!==r){for(var o=r.knownActions,a=0,s=o.length;a!==s;++a){var c=o[a];this._deactivateAction(c);var l=c._cacheIndex,u=t[t.length-1];c._cacheIndex=null,c._byClipCacheIndex=null,u._cacheIndex=l,t[l]=u,t.pop(),this._removeInactiveBindingsForAction(c)}delete i[n]}},uncacheRoot:function(e){var t=e.uuid,n=this._actionsByClip;for(var i in n){var r=n[i].actionByRoot[t];void 0!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}var o=this._bindingsByRootAndName[t];if(void 0!==o)for(var a in o){var s=o[a];s.restoreOriginalState(),this._removeInactiveBinding(s)}},uncacheAction:function(e,t){var n=this.existingAction(e,t);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}),Wr.prototype.clone=function(){return new Wr(void 0===this.value.clone?this.value:this.value.clone())},Xr.prototype=Object.assign(Object.create(Ft.prototype),{constructor:Xr,isInstancedInterleavedBuffer:!0,copy:function(e){return Ft.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}}),Object.assign(qr.prototype,{linePrecision:1,set:function(e,t){this.ray.set(e,t)},setFromCamera:function(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this._camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this._camera=t):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(e,t,n){var i=n||[];return Jr(e,this,i,t),i.sort(Yr),i},intersectObjects:function(e,t,n){var i=n||[];if(!1===Array.isArray(e))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),i;for(var r=0,o=e.length;r<o;r++)Jr(e[r],this,i,t);return i.sort(Yr),i}}),Object.assign(Kr.prototype,{set:function(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this},makeSafe:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(Co.clamp(t/this.radius,-1,1))),this}}),Object.assign(Zr.prototype,{set:function(e,t,n){return this.radius=e,this.theta=t,this.y=n,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}}),Object.assign(Qr.prototype,{set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new n;return function(t,n){var i=e.copy(n).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(e){return void 0===e&&(console.warn("THREE.Box2: .getCenter() target is now required"),e=new n),this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("THREE.Box2: .getSize() target is now required"),e=new n),this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e,t){return void 0===t&&(console.warn("THREE.Box2: .getParameter() target is now required"),t=new n),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function(e,t){return void 0===t&&(console.warn("THREE.Box2: .clampPoint() target is now required"),t=new n),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new n;return function(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}),Object.assign($r.prototype,{set:function(e,t){return this.start.copy(e),this.end.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},getCenter:function(e){return void 0===e&&(console.warn("THREE.Line3: .getCenter() target is now required"),e=new r),e.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){return void 0===e&&(console.warn("THREE.Line3: .delta() target is now required"),e=new r),e.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){return void 0===t&&(console.warn("THREE.Line3: .at() target is now required"),t=new r),this.delta(t).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(e,t){void 0===ws&&(ws=new r,xs=new r),ws.subVectors(e,this.start),xs.subVectors(this.end,this.start);var n=xs.dot(xs),i=xs.dot(ws)/n;return t&&(i=Co.clamp(i,0,1)),i},closestPointToPoint:function(e,t,n){var i=this.closestPointToPointParameter(e,t);return void 0===n&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),n=new r),this.delta(n).multiplyScalar(i).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}}),eo.prototype=Object.create(p.prototype),eo.prototype.constructor=eo,eo.prototype.isImmediateRenderObject=!0,to.prototype=Object.create(Xt.prototype),to.prototype.constructor=to,to.prototype.update=function(){var e=new r,t=new r,n=new o;return function(){var i=["a","b","c"];this.object.updateMatrixWorld(!0),n.getNormalMatrix(this.object.matrixWorld);var r=this.object.matrixWorld,o=this.geometry.attributes.position,a=this.object.geometry;if(a&&a.isGeometry)for(var s=a.vertices,c=a.faces,l=0,u=0,h=c.length;u<h;u++)for(var d=c[u],p=0,f=d.vertexNormals.length;p<f;p++){var m=s[d[i[p]]],g=d.vertexNormals[p];e.copy(m).applyMatrix4(r),t.copy(g).applyMatrix3(n).normalize().multiplyScalar(this.size).add(e),o.setXYZ(l,e.x,e.y,e.z),l+=1,o.setXYZ(l,t.x,t.y,t.z),l+=1}else if(a&&a.isBufferGeometry){var v=a.attributes.position,y=a.attributes.normal;for(l=0,p=0,f=v.count;p<f;p++)e.set(v.getX(p),v.getY(p),v.getZ(p)).applyMatrix4(r),t.set(y.getX(p),y.getY(p),y.getZ(p)),t.applyMatrix3(n).normalize().multiplyScalar(this.size).add(e),o.setXYZ(l,e.x,e.y,e.z),l+=1,o.setXYZ(l,t.x,t.y,t.z),l+=1}o.needsUpdate=!0}}(),no.prototype=Object.create(p.prototype),no.prototype.constructor=no,no.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},no.prototype.update=function(){var e=new r;return function(){this.light.updateMatrixWorld();var t=this.light.distance?this.light.distance:1e3,n=t*Math.tan(this.light.angle);this.cone.scale.set(n,n,t),e.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(e),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}(),io.prototype=Object.create(Xt.prototype),io.prototype.constructor=io,io.prototype.updateMatrixWorld=function(){var e=new r,t=new u,n=new u;return function(i){var r=this.bones,o=this.geometry,a=o.getAttribute("position");n.getInverse(this.root.matrixWorld);for(var s=0,c=0;s<r.length;s++){var l=r[s];l.parent&&l.parent.isBone&&(t.multiplyMatrices(n,l.matrixWorld),e.setFromMatrixPosition(t),a.setXYZ(c,e.x,e.y,e.z),t.multiplyMatrices(n,l.parent.matrixWorld),e.setFromMatrixPosition(t),a.setXYZ(c+1,e.x,e.y,e.z),c+=2)}o.getAttribute("position").needsUpdate=!0,p.prototype.updateMatrixWorld.call(this,i)}}(),ro.prototype=Object.create(U.prototype),ro.prototype.constructor=ro,ro.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},ro.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)},oo.prototype=Object.create(Wt.prototype),oo.prototype.constructor=oo,oo.prototype.update=function(){if(this.scale.set(.5*this.light.width,.5*this.light.height,1),void 0!==this.color)this.material.color.set(this.color),this.children[0].material.color.set(this.color);else{this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);var e=this.material.color,t=Math.max(e.r,e.g,e.b);t>1&&e.multiplyScalar(1/t),this.children[0].material.color.copy(this.material.color)}},oo.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()},ao.prototype=Object.create(p.prototype),ao.prototype.constructor=ao,ao.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},ao.prototype.update=function(){var e=new r,t=new b,n=new b;return function(){var i=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var r=i.geometry.getAttribute("color");t.copy(this.light.color),n.copy(this.light.groundColor);for(var o=0,a=r.count;o<a;o++){var s=o<a/2?t:n;r.setXYZ(o,s.r,s.g,s.b)}r.needsUpdate=!0}i.lookAt(e.setFromMatrixPosition(this.light.matrixWorld).negate())}}(),so.prototype=Object.create(U.prototype),so.prototype.constructor=so,so.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},so.prototype.onBeforeRender=function(){this.position.copy(this.lightProbe.position),this.scale.set(1,1,1).multiplyScalar(this.size),this.material.uniforms.intensity.value=this.lightProbe.intensity},co.prototype=Object.assign(Object.create(Xt.prototype),{constructor:co,copy:function(e){return Xt.prototype.copy.call(this,e),this.geometry.copy(e.geometry),this.material.copy(e.material),this},clone:function(){return(new this.constructor).copy(this)}}),lo.prototype=Object.create(Xt.prototype),lo.prototype.constructor=lo,uo.prototype=Object.create(Wt.prototype),uo.prototype.constructor=uo,uo.prototype.update=function(){function e(e,i,o,a){var s=(i-e)/o;for(f.setXYZ(h,0,0,0),d++,t=e;t<i;t+=s)n=h+d,f.setXYZ(n,Math.sin(t)*r,0,Math.cos(t)*r),f.setXYZ(n+1,Math.sin(Math.min(t+s,i))*r,0,Math.cos(Math.min(t+s,i))*r),f.setXYZ(n+2,0,0,0),d+=3;p.addGroup(h,d,a),h+=d,d=0}var t,n,i=this.audio,r=this.range,o=this.divisionsInnerAngle,a=this.divisionsOuterAngle,s=Co.degToRad(i.panner.coneInnerAngle),c=Co.degToRad(i.panner.coneOuterAngle),l=s/2,u=c/2,h=0,d=0,p=this.geometry,f=p.attributes.position;p.clearGroups(),e(-u,-l,a,0),e(-l,l,o,1),e(l,u,a,0),f.needsUpdate=!0,s===c&&(this.material[0].visible=!1)},uo.prototype.dispose=function(){this.geometry.dispose(),this.material[0].dispose(),this.material[1].dispose()},ho.prototype=Object.create(Xt.prototype),ho.prototype.constructor=ho,ho.prototype.update=function(){var e=new r,t=new r,n=new o;return function(){this.object.updateMatrixWorld(!0),n.getNormalMatrix(this.object.matrixWorld);for(var i=this.object.matrixWorld,r=this.geometry.attributes.position,o=this.object.geometry,a=o.vertices,s=o.faces,c=0,l=0,u=s.length;l<u;l++){var h=s[l],d=h.normal;e.copy(a[h.a]).add(a[h.b]).add(a[h.c]).divideScalar(3).applyMatrix4(i),t.copy(d).applyMatrix3(n).normalize().multiplyScalar(this.size).add(e),r.setXYZ(c,e.x,e.y,e.z),c+=1,r.setXYZ(c,t.x,t.y,t.z),c+=1}r.needsUpdate=!0}}(),po.prototype=Object.create(p.prototype),po.prototype.constructor=po,po.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},po.prototype.update=function(){var e=new r,t=new r,n=new r;return function(){e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),n.subVectors(t,e),this.lightPlane.lookAt(t),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(t),this.targetLine.scale.z=n.length()}}(),fo.prototype=Object.create(Xt.prototype),fo.prototype.constructor=fo,fo.prototype.update=function(){function e(e,r,a,s){i.set(r,a,s).unproject(o);var c=n[e];if(void 0!==c)for(var l=t.getAttribute("position"),u=0,h=c.length;u<h;u++)l.setXYZ(c[u],i.x,i.y,i.z)}var t,n,i=new r,o=new X;return function(){t=this.geometry,n=this.pointMap,o.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),e("c",0,0,-1),e("t",0,0,1),e("n1",-1,-1,-1),e("n2",1,-1,-1),e("n3",-1,1,-1),e("n4",1,1,-1),e("f1",-1,-1,1),e("f2",1,-1,1),e("f3",-1,1,1),e("f4",1,1,1),e("u1",.7,1.1,-1),e("u2",-.7,1.1,-1),e("u3",0,2,-1),e("cf1",-1,0,1),e("cf2",1,0,1),e("cf3",0,-1,1),e("cf4",0,1,1),e("cn1",-1,0,-1),e("cn2",1,0,-1),e("cn3",0,-1,-1),e("cn4",0,1,-1),t.getAttribute("position").needsUpdate=!0}}(),mo.prototype=Object.create(Xt.prototype),mo.prototype.constructor=mo,mo.prototype.update=function(){var e=new m;return function(t){if(void 0!==t&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&e.setFromObject(this.object),!e.isEmpty()){var n=e.min,i=e.max,r=this.geometry.attributes.position,o=r.array;o[0]=i.x,o[1]=i.y,o[2]=i.z,o[3]=n.x,o[4]=i.y,o[5]=i.z,o[6]=n.x,o[7]=n.y,o[8]=i.z,o[9]=i.x,o[10]=n.y,o[11]=i.z,o[12]=i.x,o[13]=i.y,o[14]=n.z,o[15]=n.x,o[16]=i.y,o[17]=n.z,o[18]=n.x,o[19]=n.y,o[20]=n.z,o[21]=i.x,o[22]=n.y,o[23]=n.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}}}(),mo.prototype.setFromObject=function(e){return this.object=e,this.update(),this},mo.prototype.copy=function(e){return Xt.prototype.copy.call(this,e),this.object=e.object,this},mo.prototype.clone=function(){return(new this.constructor).copy(this)},go.prototype=Object.create(Xt.prototype),go.prototype.constructor=go,go.prototype.updateMatrixWorld=function(e){var t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),p.prototype.updateMatrixWorld.call(this,e))},vo.prototype=Object.create(Wt.prototype),vo.prototype.constructor=vo,vo.prototype.updateMatrixWorld=function(e){var t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=t<0?1:0,this.lookAt(this.plane.normal),p.prototype.updateMatrixWorld.call(this,e)},yo.prototype=Object.create(p.prototype),yo.prototype.constructor=yo,yo.prototype.setDirection=(Ts=new r,function(e){e.y>.99999?this.quaternion.set(0,0,0,1):e.y<-.99999?this.quaternion.set(1,0,0,0):(Ts.set(e.z,0,-e.x).normalize(),_s=Math.acos(e.y),this.quaternion.setFromAxisAngle(Ts,_s))}),yo.prototype.setLength=function(e,t,n){void 0===t&&(t=.2*e),void 0===n&&(n=.2*t),this.line.scale.set(1,Math.max(0,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()},yo.prototype.setColor=function(e){this.line.material.color.set(e),this.cone.material.color.set(e)},yo.prototype.copy=function(e){return p.prototype.copy.call(this,e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this},yo.prototype.clone=function(){return(new this.constructor).copy(this)},bo.prototype=Object.create(Xt.prototype),bo.prototype.constructor=bo,Hi.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(Hi.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},Object.assign(ir.prototype,{createPointsGeometry:function(e){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getPoints(e);return this.createGeometry(t)},createSpacedPointsGeometry:function(e){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getSpacedPoints(e);return this.createGeometry(t)},createGeometry:function(e){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");for(var t=new z,n=0,i=e.length;n<i;n++){var o=e[n];t.vertices.push(new r(o.x,o.y,o.z||0))}return t}}),Object.assign(rr.prototype,{fromPoints:function(e){console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)}}),wo.prototype=Object.create(Xi.prototype),xo.prototype=Object.create(Xi.prototype),Eo.prototype=Object.create(Xi.prototype),Object.assign(Eo.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),co.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},io.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(Cr.prototype,{extractUrlBase:function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),ns.extractUrlBase(e)}}),Object.assign(xr.prototype,{setTexturePath:function(e){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)}}),Object.assign(Qr.prototype,{center:function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},size:function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)}}),Object.assign(m.prototype,{center:function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionSphere:function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},size:function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)}}),$r.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Object.assign(Co,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(e){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),Co.floorPowerOfTwo(e)},nextPowerOfTwo:function(e){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),Co.ceilPowerOfTwo(e)}}),Object.assign(o.prototype,{flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},multiplyVector3:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBuffer:function(e){return console.warn("THREE.Matrix3: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(e)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(u.prototype,{extractPosition:function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},getPosition:function(){var e;return function(){return void 0===e&&(e=new r),console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),e.setFromMatrixColumn(this,3)}}(),setRotationFromQuaternion:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),
this.makeRotationFromQuaternion(e)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector4:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBuffer:function(e){return console.warn("THREE.Matrix4: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(e)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(e,t,n,i,r,o){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,i,n,r,o)}}),Z.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},i.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},Object.assign(v.prototype,{isIntersectionBox:function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionPlane:function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},isIntersectionSphere:function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)}}),Object.assign(y.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},midpoint:function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},normal:function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},plane:function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)}}),Object.assign(y,{barycoordFromPoint:function(e,t,n,i,r){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),y.getBarycoord(e,t,n,i,r)},normal:function(e,t,n,i){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),y.getNormal(e,t,n,i)}}),Object.assign(or.prototype,{extractAllPoints:function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},extrude:function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new jn(this,e)},makeGeometry:function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new ei(this,e)}}),Object.assign(n.prototype,{fromAttribute:function(e,t,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},distanceToManhattan:function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(r.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},applyProjection:function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},fromAttribute:function(e,t,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},distanceToManhattan:function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(s.prototype,{fromAttribute:function(e,t,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(z.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}}),Object.assign(p.prototype,{getChildByName:function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")}}),Object.defineProperties(p.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.defineProperties(zt.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(Ht.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),Gt.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(Hi.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(e){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=e}}),q.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(ar.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(M.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")}}),Object.assign(N.prototype,{addIndex:function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},addDrawCall:function(e,t,n){void 0!==n&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")}}),Object.defineProperties(N.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.assign(Vn.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}}),Object.defineProperties(Wr.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(_.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new b}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===e}}}),Object.defineProperties(fi.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(W.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),Object.assign(Dt.prototype,{clearTarget:function(e,t,n,i){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,n,i)},animate:function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()}}),Object.defineProperties(Dt.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}}}),Object.defineProperties(_t.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(J.prototype,{activeCubeFace:{set:function(){console.warn("THREE.WebGLRenderTargetCube: .activeCubeFace has been removed. It is now the second parameter of WebGLRenderer.setRenderTarget().")}},activeMipMapLevel:{set:function(){console.warn("THREE.WebGLRenderTargetCube: .activeMipMapLevel has been removed. It is now the third parameter of WebGLRenderer.setRenderTarget().")}}}),Object.defineProperties(c.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),Object.defineProperties(It.prototype,{standing:{set:function(){console.warn("THREE.WebVRManager: .standing has been removed.")}},userHeight:{set:function(){console.warn("THREE.WebVRManager: .userHeight has been removed.")}}}),Fr.prototype.load=function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var t=this;return(new Ar).load(e,function(e){t.setBuffer(e)}),this},Nr.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},Y.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)};var Cs={merge:function(e,t,n){var i;console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),t.isMesh&&(t.matrixAutoUpdate&&t.updateMatrix(),i=t.matrix,t=t.geometry),e.merge(t,i,n)},center:function(e){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),e.center()}};Bo.crossOrigin=void 0,Bo.loadTexture=function(e,t,n,i){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var r=new Gi;r.setCrossOrigin(this.crossOrigin);var o=r.load(e,n,void 0,i);return t&&(o.mapping=t),o},Bo.loadTextureCube=function(e,t,n,i){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var r=new zi;r.setCrossOrigin(this.crossOrigin);var o=r.load(e,n,void 0,i);return t&&(o.mapping=t),o},Bo.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},Bo.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};var As={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")}};e.ACESFilmicToneMapping=5,e.AddEquation=100,e.AddOperation=2,e.AdditiveBlending=2,e.AlphaFormat=1021,e.AlwaysDepth=1,e.AlwaysStencilFunc=519,e.AmbientLight=mr,e.AmbientLightProbe=Lr,e.AnimationClip=Li,e.AnimationLoader=Fi,e.AnimationMixer=Vr,e.AnimationObjectGroup=Hr,e.AnimationUtils=qa,e.ArcCurve=Vi,e.ArrayCamera=Rt,e.ArrowHelper=yo,e.Audio=Fr,e.AudioAnalyser=Nr,e.AudioContext=Ms,e.AudioListener=kr,e.AudioLoader=Ar,e.AxesHelper=bo,e.AxisHelper=function(e){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new bo(e)},e.BackSide=1,e.BasicDepthPacking=3200,e.BasicShadowMap=0,e.BinaryTextureLoader=function(e){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new Ni(e)},e.Bone=jt,e.BooleanKeyframeTrack=Ti,e.BoundingBoxHelper=function(e,t){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new mo(e,t)},e.Box2=Qr,e.Box3=m,e.Box3Helper=go,e.BoxBufferGeometry=H,e.BoxGeometry=G,e.BoxHelper=mo,e.BufferAttribute=M,e.BufferGeometry=N,e.BufferGeometryLoader=wr,e.ByteType=1010,e.Cache=Ya,e.Camera=X,e.CameraHelper=fo,e.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been removed")},e.CanvasTexture=Qt,e.CatmullRomCurve3=Xi,e.CineonToneMapping=4,e.CircleBufferGeometry=li,e.CircleGeometry=ci,e.ClampToEdgeWrapping=1001,e.Clock=Or,e.ClosedSplineCurve3=wo,e.Color=b,e.ColorKeyframeTrack=Mi,e.CompressedTexture=Zt,e.CompressedTextureLoader=Bi,e.ConeBufferGeometry=si,e.ConeGeometry=ai,e.CubeCamera=Y,e.CubeGeometry=G,e.CubeReflectionMapping=301,e.CubeRefractionMapping=302,e.CubeTexture=fe,e.CubeTextureLoader=zi,e.CubeUVReflectionMapping=306,e.CubeUVRefractionMapping=307,e.CubicBezierCurve=Ki,e.CubicBezierCurve3=Zi,e.CubicInterpolant=xi,e.CullFaceBack=1,e.CullFaceFront=2,e.CullFaceFrontBack=3,e.CullFaceNone=0,e.Curve=Hi,e.CurvePath=ir,e.CustomBlending=5,e.CylinderBufferGeometry=oi,e.CylinderGeometry=ri,e.Cylindrical=Zr,e.DataTexture=K,e.DataTexture2DArray=me,e.DataTexture3D=ge,e.DataTextureLoader=Ni,e.DecrementStencilOp=7683,e.DecrementWrapStencilOp=34056,e.DefaultLoadingManager=Ja,e.DepthFormat=1026,e.DepthStencilFormat=1027,e.DepthTexture=$t,e.DirectionalLight=fr,e.DirectionalLightHelper=po,e.DirectionalLightShadow=pr,e.DiscreteInterpolant=Si,e.DodecahedronBufferGeometry=pn,e.DodecahedronGeometry=dn,e.DoubleSide=2,e.DstAlphaFactor=206,e.DstColorFactor=208,e.DynamicBufferAttribute=function(e,t){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead."),new M(e,t).setDynamic(!0)},e.EdgesGeometry=ii,e.EdgesHelper=function(e,t){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new Xt(new ii(e.geometry),new Vt({color:void 0!==t?t:16777215}))},e.EllipseCurve=ji,e.EqualDepth=4,e.EqualStencilFunc=514,e.EquirectangularReflectionMapping=303,e.EquirectangularRefractionMapping=304,e.Euler=h,e.EventDispatcher=t,e.ExtrudeBufferGeometry=Vn,e.ExtrudeGeometry=jn,e.Face3=S,e.Face4=function(e,t,n,i,r,o,a){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new S(e,t,n,r,o,a)},e.FaceColors=1,e.FaceNormalsHelper=ho,e.FileLoader=ki,e.FlatShading=1,e.Float32Attribute=function(e,t){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new O(e,t)},e.Float32BufferAttribute=O,e.Float64Attribute=function(e,t){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new k(e,t)},e.Float64BufferAttribute=k,e.FloatType=1015,e.Fog=kt,e.FogExp2=Ot,e.Font=_r,e.FontLoader=Mr,e.FrontFaceDirectionCCW=1,e.FrontFaceDirectionCW=0,e.FrontSide=0,e.Frustum=Q,e.GammaEncoding=3007,e.Geometry=z,e.GeometryUtils=Cs,e.GreaterDepth=6,e.GreaterEqualDepth=5,e.GreaterEqualStencilFunc=518,e.GreaterStencilFunc=516,e.GridHelper=co,e.Group=At,e.HalfFloatType=1016,e.HemisphereLight=sr,e.HemisphereLightHelper=ao,e.HemisphereLightProbe=Ir,e.IcosahedronBufferGeometry=hn,e.IcosahedronGeometry=un,e.ImageBitmapLoader=Er,e.ImageLoader=Ui,e.ImageUtils=Bo,e.ImmediateRenderObject=eo,e.IncrementStencilOp=7682,e.IncrementWrapStencilOp=34055,e.InstancedBufferAttribute=br,e.InstancedBufferGeometry=yr,e.InstancedInterleavedBuffer=Xr,e.Int16Attribute=function(e,t){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new P(e,t)},e.Int16BufferAttribute=P,e.Int32Attribute=function(e,t){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new L(e,t)},e.Int32BufferAttribute=L,e.Int8Attribute=function(e,t){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new C(e,t)},e.Int8BufferAttribute=C,e.IntType=1013,e.InterleavedBuffer=Ft,e.InterleavedBufferAttribute=Bt,e.Interpolant=wi,e.InterpolateDiscrete=2300,e.InterpolateLinear=2301,e.InterpolateSmooth=2302,e.InvertStencilOp=5386,e.JSONLoader=function(){console.error("THREE.JSONLoader has been removed.")},e.KeepStencilOp=7680,e.KeyframeTrack=_i,e.LOD=zt,e.LatheBufferGeometry=$n,e.LatheGeometry=Qn,e.Layers=d,e.LensFlare=function(){console.error("THREE.LensFlare has been moved to /examples/js/objects/Lensflare.js")},e.LessDepth=2,e.LessEqualDepth=3,e.LessEqualStencilFunc=515,e.LessStencilFunc=513,e.Light=ar,e.LightProbe=Pr,e.LightProbeHelper=so,e.LightShadow=cr,e.Line=Wt,e.Line3=$r,e.LineBasicMaterial=Vt,e.LineCurve=Qi,e.LineCurve3=$i,e.LineDashedMaterial=bi,e.LineLoop=qt,e.LinePieces=1,e.LineSegments=Xt,e.LineStrip=0,e.LinearEncoding=3e3,e.LinearFilter=1006,e.LinearInterpolant=Ei,e.LinearMipMapLinearFilter=1008,e.LinearMipMapNearestFilter=1007,e.LinearMipmapLinearFilter=1008,e.LinearMipmapNearestFilter=1007,e.LinearToneMapping=1,e.Loader=Cr,e.LoaderUtils=ns,e.LoadingManager=Oi,e.LogLuvEncoding=3003,e.LoopOnce=2200,e.LoopPingPong=2202,e.LoopRepeat=2201,e.LuminanceAlphaFormat=1025,e.LuminanceFormat=1024,e.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},e.Material=_,e.MaterialLoader=vr,e.Math=Co,e.Matrix3=o,e.Matrix4=u,e.MaxEquation=104,e.Mesh=U,e.MeshBasicMaterial=T,e.MeshDepthMaterial=Et,e.MeshDistanceMaterial=St,e.MeshFaceMaterial=function(e){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),e},e.MeshLambertMaterial=vi,e.MeshMatcapMaterial=yi,e.MeshNormalMaterial=gi,e.MeshPhongMaterial=fi,e.MeshPhysicalMaterial=pi,e.MeshStandardMaterial=di,e.MeshToonMaterial=mi,e.MinEquation=103,e.MirroredRepeatWrapping=1002,e.MixOperation=1,e.MultiMaterial=function(e){return void 0===e&&(e=[]),console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),e.isMultiMaterial=!0,e.materials=e,e.clone=function(){return e.slice()},e},e.MultiplyBlending=4,e.MultiplyOperation=0,e.NearestFilter=1003,e.NearestMipMapLinearFilter=1005,e.NearestMipMapNearestFilter=1004,e.NearestMipmapLinearFilter=1005,e.NearestMipmapNearestFilter=1004,e.NeverDepth=0,e.NeverStencilFunc=512,e.NoBlending=0,e.NoColors=0,e.NoToneMapping=0,e.NormalBlending=1,e.NotEqualDepth=7,e.NotEqualStencilFunc=517,e.NumberKeyframeTrack=Ci,e.Object3D=p,e.ObjectLoader=xr,e.ObjectSpaceNormalMap=1,e.OctahedronBufferGeometry=ln,e.OctahedronGeometry=cn,e.OneFactor=201,e.OneMinusDstAlphaFactor=207,e.OneMinusDstColorFactor=209,e.OneMinusSrcAlphaFactor=205,e.OneMinusSrcColorFactor=203,e.OrthographicCamera=dr,e.PCFShadowMap=1,e.PCFSoftShadowMap=2,e.ParametricBufferGeometry=nn,
e.ParametricGeometry=tn,e.Particle=function(e){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new Ut(e)},e.ParticleBasicMaterial=function(e){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new Yt(e)},e.ParticleSystem=function(e,t){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new Jt(e,t)},e.ParticleSystemMaterial=function(e){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new Yt(e)},e.Path=rr,e.PerspectiveCamera=q,e.Plane=Z,e.PlaneBufferGeometry=ne,e.PlaneGeometry=te,e.PlaneHelper=vo,e.PointCloud=function(e,t){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new Jt(e,t)},e.PointCloudMaterial=function(e){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new Yt(e)},e.PointLight=hr,e.PointLightHelper=ro,e.Points=Jt,e.PointsMaterial=Yt,e.PolarGridHelper=lo,e.PolyhedronBufferGeometry=on,e.PolyhedronGeometry=rn,e.PositionalAudio=Br,e.PositionalAudioHelper=uo,e.PropertyBinding=Gr,e.PropertyMixer=Ur,e.QuadraticBezierCurve=er,e.QuadraticBezierCurve3=tr,e.Quaternion=i,e.QuaternionKeyframeTrack=Ri,e.QuaternionLinearInterpolant=Ai,e.REVISION="107",e.RGBADepthPacking=3201,e.RGBAFormat=1023,e.RGBA_ASTC_10x10_Format=37819,e.RGBA_ASTC_10x5_Format=37816,e.RGBA_ASTC_10x6_Format=37817,e.RGBA_ASTC_10x8_Format=37818,e.RGBA_ASTC_12x10_Format=37820,e.RGBA_ASTC_12x12_Format=37821,e.RGBA_ASTC_4x4_Format=37808,e.RGBA_ASTC_5x4_Format=37809,e.RGBA_ASTC_5x5_Format=37810,e.RGBA_ASTC_6x5_Format=37811,e.RGBA_ASTC_6x6_Format=37812,e.RGBA_ASTC_8x5_Format=37813,e.RGBA_ASTC_8x6_Format=37814,e.RGBA_ASTC_8x8_Format=37815,e.RGBA_PVRTC_2BPPV1_Format=35843,e.RGBA_PVRTC_4BPPV1_Format=35842,e.RGBA_S3TC_DXT1_Format=33777,e.RGBA_S3TC_DXT3_Format=33778,e.RGBA_S3TC_DXT5_Format=33779,e.RGBDEncoding=3006,e.RGBEEncoding=3002,e.RGBEFormat=1023,e.RGBFormat=1022,e.RGBM16Encoding=3005,e.RGBM7Encoding=3004,e.RGB_ETC1_Format=36196,e.RGB_PVRTC_2BPPV1_Format=35841,e.RGB_PVRTC_4BPPV1_Format=35840,e.RGB_S3TC_DXT1_Format=33776,e.RawShaderMaterial=hi,e.Ray=v,e.Raycaster=qr,e.RectAreaLight=gr,e.RectAreaLightHelper=oo,e.RedFormat=1028,e.ReinhardToneMapping=2,e.RepeatWrapping=1e3,e.ReplaceStencilOp=7681,e.ReverseSubtractEquation=102,e.RingBufferGeometry=Zn,e.RingGeometry=Kn,e.Scene=f,e.SceneUtils=As,e.ShaderChunk=ba,e.ShaderLib=xa,e.ShaderMaterial=W,e.ShadowMaterial=ui,e.Shape=or,e.ShapeBufferGeometry=ti,e.ShapeGeometry=ei,e.ShapePath=Sr,e.ShapeUtils=ja,e.ShortType=1011,e.Skeleton=Ht,e.SkeletonHelper=io,e.SkinnedMesh=Gt,e.SmoothShading=2,e.Sphere=g,e.SphereBufferGeometry=Jn,e.SphereGeometry=Yn,e.Spherical=Kr,e.SphericalHarmonics3=Rr,e.SphericalReflectionMapping=305,e.Spline=Eo,e.SplineCurve=nr,e.SplineCurve3=xo,e.SpotLight=ur,e.SpotLightHelper=no,e.SpotLightShadow=lr,e.Sprite=Ut,e.SpriteMaterial=Nt,e.SrcAlphaFactor=204,e.SrcAlphaSaturateFactor=210,e.SrcColorFactor=202,e.StereoCamera=Dr,e.StringKeyframeTrack=Pi,e.SubtractEquation=101,e.SubtractiveBlending=3,e.TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},e.TangentSpaceNormalMap=0,e.TetrahedronBufferGeometry=sn,e.TetrahedronGeometry=an,e.TextBufferGeometry=qn,e.TextGeometry=Xn,e.Texture=a,e.TextureLoader=Gi,e.TorusBufferGeometry=bn,e.TorusGeometry=yn,e.TorusKnotBufferGeometry=vn,e.TorusKnotGeometry=gn,e.Triangle=y,e.TriangleFanDrawMode=2,e.TriangleStripDrawMode=1,e.TrianglesDrawMode=0,e.TubeBufferGeometry=mn,e.TubeGeometry=fn,e.UVMapping=300,e.Uint16Attribute=function(e,t){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new I(e,t)},e.Uint16BufferAttribute=I,e.Uint32Attribute=function(e,t){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new D(e,t)},e.Uint32BufferAttribute=D,e.Uint8Attribute=function(e,t){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new A(e,t)},e.Uint8BufferAttribute=A,e.Uint8ClampedAttribute=function(e,t){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new R(e,t)},e.Uint8ClampedBufferAttribute=R,e.Uncharted2ToneMapping=3,e.Uniform=Wr,e.UniformsLib=wa,e.UniformsUtils=ya,e.UnsignedByteType=1009,e.UnsignedInt248Type=1020,e.UnsignedIntType=1014,e.UnsignedShort4444Type=1017,e.UnsignedShort5551Type=1018,e.UnsignedShort565Type=1019,e.UnsignedShortType=1012,e.Vector2=n,e.Vector3=r,e.Vector4=s,e.VectorKeyframeTrack=Ii,e.Vertex=function(e,t,n){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new r(e,t,n)},e.VertexColors=2,e.VertexNormalsHelper=to,e.VideoTexture=Kt,e.WebGLMultisampleRenderTarget=l,e.WebGLRenderTarget=c,e.WebGLRenderTargetCube=J,e.WebGLRenderer=Dt,e.WebGLUtils=Ct,e.WireframeGeometry=en,e.WireframeHelper=function(e,t){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new Xt(new en(e.geometry),new Vt({color:void 0!==t?t:16777215}))},e.WrapAroundEnding=2402,e.XHRLoader=function(e){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new ki(e)},e.ZeroCurvatureEnding=2400,e.ZeroFactor=200,e.ZeroSlopeEnding=2401,e.ZeroStencilOp=0,e.sRGBEncoding=3001,Object.defineProperty(e,"__esModule",{value:!0})}),THREE.SkeletonUtils={retarget:function(){var e=new THREE.Vector3,t=new THREE.Quaternion,n=new THREE.Vector3,i=new THREE.Matrix4,r=new THREE.Matrix4,o=new THREE.Matrix4;return function(a,s,c){(c=c||{}).preserveMatrix=void 0===c.preserveMatrix||c.preserveMatrix,c.preservePosition=void 0===c.preservePosition||c.preservePosition,c.preserveHipPosition=void 0!==c.preserveHipPosition&&c.preserveHipPosition,c.useTargetMatrix=void 0!==c.useTargetMatrix&&c.useTargetMatrix,c.hip=void 0!==c.hip?c.hip:"hip",c.names=c.names||{};var l,u,h,d,p,f,m=s.isObject3D?s.skeleton.bones:this.getBones(s),g=a.isObject3D?a.skeleton.bones:this.getBones(a);if(a.isObject3D?a.skeleton.pose():(c.useTargetMatrix=!0,c.preserveMatrix=!1),c.preservePosition)for(p=[],f=0;f<g.length;f++)p.push(g[f].position.clone());if(c.preserveMatrix)for(a.updateMatrixWorld(),a.matrixWorld.identity(),f=0;f<a.children.length;++f)a.children[f].updateMatrixWorld(!0);if(c.offsets)for(l=[],f=0;f<g.length;++f)u=g[f],h=c.names[u.name]||u.name,c.offsets&&c.offsets[h]&&(u.matrix.multiply(c.offsets[h]),u.matrix.decompose(u.position,u.quaternion,u.scale),u.updateMatrixWorld()),l.push(u.matrixWorld.clone());for(f=0;f<g.length;++f){if(u=g[f],h=c.names[u.name]||u.name,d=this.getBoneByName(h,m),o.copy(u.matrixWorld),d){if(d.updateMatrixWorld(),c.useTargetMatrix?r.copy(d.matrixWorld):(r.getInverse(a.matrixWorld),r.multiply(d.matrixWorld)),n.setFromMatrixScale(r),r.scale(n.set(1/n.x,1/n.y,1/n.z)),o.makeRotationFromQuaternion(t.setFromRotationMatrix(r)),a.isObject3D){var v=g.indexOf(u),y=l?l[v]:i.getInverse(a.skeleton.boneInverses[v]);o.multiply(y)}o.copyPosition(r)}u.parent&&u.parent.isBone?(u.matrix.getInverse(u.parent.matrixWorld),u.matrix.multiply(o)):u.matrix.copy(o),c.preserveHipPosition&&h===c.hip&&u.matrix.setPosition(e.set(0,u.position.y,0)),u.matrix.decompose(u.position,u.quaternion,u.scale),u.updateMatrixWorld()}if(c.preservePosition)for(f=0;f<g.length;++f)u=g[f],(h=c.names[u.name]||u.name)!==c.hip&&u.position.copy(p[f]);c.preserveMatrix&&a.updateMatrixWorld(!0)}}(),retargetClip:function(e,t,n,i){(i=i||{}).useFirstFramePosition=void 0!==i.useFirstFramePosition&&i.useFirstFramePosition,i.fps=void 0!==i.fps?i.fps:30,i.names=i.names||[],t.isObject3D||(t=this.getHelperFromSkeleton(t));var r,o,a,s,c,l,u=Math.round(n.duration*(i.fps/1e3)*1e3),h=1/i.fps,d=[],p=new THREE.AnimationMixer(t),f=this.getBones(e.skeleton),m=[];for(p.clipAction(n).play(),p.update(0),t.updateMatrixWorld(),c=0;c<u;++c){var g=c*h;for(this.retarget(e,t,i),l=0;l<f.length;++l)s=i.names[f[l].name]||f[l].name,this.getBoneByName(s,t.skeleton)&&(o=f[l],a=m[l]=m[l]||{bone:o},i.hip===s&&(a.pos||(a.pos={times:new Float32Array(u),values:new Float32Array(3*u)}),i.useFirstFramePosition&&(0===c&&(r=o.position.clone()),o.position.sub(r)),a.pos.times[c]=g,o.position.toArray(a.pos.values,3*c)),a.quat||(a.quat={times:new Float32Array(u),values:new Float32Array(4*u)}),a.quat.times[c]=g,o.quaternion.toArray(a.quat.values,4*c));p.update(h),t.updateMatrixWorld()}for(c=0;c<m.length;++c)(a=m[c])&&(a.pos&&d.push(new THREE.VectorKeyframeTrack(".bones["+a.bone.name+"].position",a.pos.times,a.pos.values)),d.push(new THREE.QuaternionKeyframeTrack(".bones["+a.bone.name+"].quaternion",a.quat.times,a.quat.values)));return p.uncacheAction(n),new THREE.AnimationClip(n.name,-1,d)},getHelperFromSkeleton:function(e){var t=new THREE.SkeletonHelper(e.bones[0]);return t.skeleton=e,t},getSkeletonOffsets:function(){var e=new THREE.Vector3,t=new THREE.Vector3,n=new THREE.Vector3,i=new THREE.Vector3,r=new THREE.Vector2,o=new THREE.Vector2;return function(a,s,c){(c=c||{}).hip=void 0!==c.hip?c.hip:"hip",c.names=c.names||{},s.isObject3D||(s=this.getHelperFromSkeleton(s));var l,u,h,d,p=Object.keys(c.names),f=Object.values(c.names),m=s.isObject3D?s.skeleton.bones:this.getBones(s),g=a.isObject3D?a.skeleton.bones:this.getBones(a),v=[];for(a.skeleton.pose(),d=0;d<g.length;++d)if(l=g[d],h=c.names[l.name]||l.name,(u=this.getBoneByName(h,m))&&h!==c.hip){var y=this.getNearestBone(l.parent,p),b=this.getNearestBone(u.parent,f);y.updateMatrixWorld(),b.updateMatrixWorld(),e.setFromMatrixPosition(y.matrixWorld),t.setFromMatrixPosition(l.matrixWorld),n.setFromMatrixPosition(b.matrixWorld),i.setFromMatrixPosition(u.matrixWorld),r.subVectors(new THREE.Vector2(t.x,t.y),new THREE.Vector2(e.x,e.y)).normalize(),o.subVectors(new THREE.Vector2(i.x,i.y),new THREE.Vector2(n.x,n.y)).normalize();var w=r.angle()-o.angle(),x=(new THREE.Matrix4).makeRotationFromEuler(new THREE.Euler(0,0,w));l.matrix.multiply(x),l.matrix.decompose(l.position,l.quaternion,l.scale),l.updateMatrixWorld(),v[h]=x}return v}}(),renameBones:function(e,t){for(var n=this.getBones(e),i=0;i<n.length;++i){var r=n[i];t[r.name]&&(r.name=t[r.name])}return this},getBones:function(e){return Array.isArray(e)?e:e.bones},getBoneByName:function(e,t){for(var n=0,i=this.getBones(t);n<i.length;n++)if(e===i[n].name)return i[n]},getNearestBone:function(e,t){for(;e.isBone;){if(-1!==t.indexOf(e.name))return e;e=e.parent}},findBoneTrackData:function(e,t){for(var n=/\[(.*)\]\.(.*)/,i={name:e},r=0;r<t.length;++r){var o=n.exec(t[r].name);o&&e===o[1]&&(i[o[2]]=r)}return i},getEqualsBonesNames:function(e,t){var n=this.getBones(e),i=this.getBones(t),r=[];e:for(var o=0;o<n.length;o++)for(var a=n[o].name,s=0;s<i.length;s++)if(a===i[s].name){r.push(a);continue e}return r},clone:function(e){var t=new Map,n=new Map,i=e.clone();return parallelTraverse(e,i,function(e,i){t.set(i,e),n.set(e,i)}),i.traverse(function(e){if(e.isSkinnedMesh){var i=e,r=t.get(e),o=r.skeleton.bones;i.skeleton=r.skeleton.clone(),i.bindMatrix.copy(r.bindMatrix),i.skeleton.bones=o.map(function(e){return n.get(e)}),i.bind(i.skeleton,i.bindMatrix)}}),i.animations=e.animations,i}},function(){"use strict";function e(e,t){var n,i=e.split("."),r=s;!(i[0]in r)&&r.execScript&&r.execScript("var "+i[0]);for(;i.length&&(n=i.shift());)i.length||t===a?r=r[n]?r[n]:r[n]={}:r[n]=t}function t(e){var t,n,i,r,o,a,s,l,u,h,d=e.length,p=0,f=Number.POSITIVE_INFINITY;for(l=0;l<d;++l)e[l]>p&&(p=e[l]),e[l]<f&&(f=e[l]);for(t=1<<p,n=new(c?Uint32Array:Array)(t),i=1,r=0,o=2;i<=p;){for(l=0;l<d;++l)if(e[l]===i){for(a=0,s=r,u=0;u<i;++u)a=a<<1|1&s,s>>=1;for(h=i<<16|l,u=a;u<t;u+=o)n[u]=h;++r}++i,r<<=1,o<<=1}return[n,p,f]}function n(e,t){switch(this.g=[],this.h=32768,this.d=this.f=this.a=this.l=0,this.input=c?new Uint8Array(e):e,this.m=!1,this.i=u,this.r=!1,!t&&(t={})||(t.index&&(this.a=t.index),t.bufferSize&&(this.h=t.bufferSize),t.bufferType&&(this.i=t.bufferType),t.resize&&(this.r=t.resize)),this.i){case l:this.b=32768,this.c=new(c?Uint8Array:Array)(32768+this.h+258);break;case u:this.b=0,this.c=new(c?Uint8Array:Array)(this.h),this.e=this.z,this.n=this.v,this.j=this.w;break;default:throw Error("invalid inflate mode")}}function i(e,t){for(var n,i=e.f,r=e.d,o=e.input,a=e.a,s=o.length;r<t;){if(a>=s)throw Error("input buffer is broken");i|=o[a++]<<r,r+=8}return n=i&(1<<t)-1,e.f=i>>>t,e.d=r-t,e.a=a,n}function r(e,t){for(var n,i,r=e.f,o=e.d,a=e.input,s=e.a,c=a.length,l=t[0],u=t[1];o<u&&!(s>=c);)r|=a[s++]<<o,o+=8;if((i=(n=l[r&(1<<u)-1])>>>16)>o)throw Error("invalid code length: "+i);return e.f=r>>i,e.d=o-i,e.a=s,65535&n}function o(e,t){var i,r;switch(this.input=e,this.a=0,!t&&(t={})||(t.index&&(this.a=t.index),t.verify&&(this.A=t.verify)),i=e[this.a++],r=e[this.a++],15&i){case P:this.method=P;break;default:throw Error("unsupported compression method")}if(0!=((i<<8)+r)%31)throw Error("invalid fcheck flag:"+((i<<8)+r)%31);if(32&r)throw Error("fdict flag is not supported");this.q=new n(e,{index:this.a,bufferSize:t.bufferSize,bufferType:t.bufferType,resize:t.resize})}var a=void 0,s=this,c="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array&&"undefined"!=typeof DataView,l=0,u=1,h={t:l,s:u};n.prototype.k=function(){for(;!this.m;){var e=i(this,3);switch(1&e&&(this.m=!0),e>>>=1){case 0:var n=this.input,o=this.a,s=this.c,h=this.b,d=n.length,p=a,f=s.length,g=a;if(this.d=this.f=0,o+1>=d)throw Error("invalid uncompressed block header: LEN");if(p=n[o++]|n[o++]<<8,o+1>=d)throw Error("invalid uncompressed block header: NLEN");if(p===~(n[o++]|n[o++]<<8))throw Error("invalid uncompressed block header: length verify");if(o+p>n.length)throw Error("input buffer is broken");switch(this.i){case l:for(;h+p>s.length;){if(p-=g=f-h,c)s.set(n.subarray(o,o+g),h),h+=g,o+=g;else for(;g--;)s[h++]=n[o++];this.b=h,s=this.e(),h=this.b}break;case u:for(;h+p>s.length;)s=this.e({p:2});break;default:throw Error("invalid inflate mode")}if(c)s.set(n.subarray(o,o+p),h),h+=p,o+=p;else for(;p--;)s[h++]=n[o++];this.a=o,this.b=h,this.c=s;break;case 1:this.j(C,R);break;case 2:var v,y,b,w,x=i(this,5)+257,E=i(this,5)+1,S=i(this,4)+4,_=new(c?Uint8Array:Array)(m.length),T=a,M=a,A=a,P=a,I=a;for(I=0;I<S;++I)_[m[I]]=i(this,3);if(!c)for(I=S,S=_.length;I<S;++I)_[m[I]]=0;for(v=t(_),T=new(c?Uint8Array:Array)(x+E),I=0,w=x+E;I<w;)switch(M=r(this,v),M){case 16:for(P=3+i(this,2);P--;)T[I++]=A;break;case 17:for(P=3+i(this,3);P--;)T[I++]=0;A=0;break;case 18:for(P=11+i(this,7);P--;)T[I++]=0;A=0;break;default:A=T[I++]=M}y=t(c?T.subarray(0,x):T.slice(0,x)),b=t(c?T.subarray(x):T.slice(x)),this.j(y,b);break;default:throw Error("unknown BTYPE: "+e)}}return this.n()};var d,p,f=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],m=c?new Uint16Array(f):f,g=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],v=c?new Uint16Array(g):g,y=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],b=c?new Uint8Array(y):y,w=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],x=c?new Uint16Array(w):w,E=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],S=c?new Uint8Array(E):E,_=new(c?Uint8Array:Array)(288);for(d=0,p=_.length;d<p;++d)_[d]=143>=d?8:255>=d?9:279>=d?7:8;var T,M,C=t(_),A=new(c?Uint8Array:Array)(30);for(T=0,M=A.length;T<M;++T)A[T]=5;var R=t(A);n.prototype.j=function(e,t){var n=this.c,o=this.b;this.o=e;for(var a,s,c,l,u=n.length-258;256!==(a=r(this,e));)if(256>a)o>=u&&(this.b=o,n=this.e(),o=this.b),n[o++]=a;else for(l=v[s=a-257],0<b[s]&&(l+=i(this,b[s])),a=r(this,t),c=x[a],0<S[a]&&(c+=i(this,S[a])),o>=u&&(this.b=o,n=this.e(),o=this.b);l--;)n[o]=n[o++-c];for(;8<=this.d;)this.d-=8,this.a--;this.b=o},n.prototype.w=function(e,t){var n=this.c,o=this.b;this.o=e;for(var a,s,c,l,u=n.length;256!==(a=r(this,e));)if(256>a)o>=u&&(u=(n=this.e()).length),n[o++]=a;else for(l=v[s=a-257],0<b[s]&&(l+=i(this,b[s])),a=r(this,t),c=x[a],0<S[a]&&(c+=i(this,S[a])),o+l>u&&(u=(n=this.e()).length);l--;)n[o]=n[o++-c];for(;8<=this.d;)this.d-=8,this.a--;this.b=o},n.prototype.e=function(){var e,t,n=new(c?Uint8Array:Array)(this.b-32768),i=this.b-32768,r=this.c;if(c)n.set(r.subarray(32768,n.length));else for(e=0,t=n.length;e<t;++e)n[e]=r[e+32768];if(this.g.push(n),this.l+=n.length,c)r.set(r.subarray(i,i+32768));else for(e=0;32768>e;++e)r[e]=r[i+e];return this.b=32768,r},n.prototype.z=function(e){var t,n,i,r=this.input.length/this.a+1|0,o=this.input,a=this.c;return e&&("number"==typeof e.p&&(r=e.p),"number"==typeof e.u&&(r+=e.u)),n=2>r?(i=(o.length-this.a)/this.o[2]/2*258|0)<a.length?a.length+i:a.length<<1:a.length*r,c?(t=new Uint8Array(n)).set(a):t=a,this.c=t},n.prototype.n=function(){var e,t,n,i,r,o=0,a=this.c,s=this.g,l=new(c?Uint8Array:Array)(this.l+(this.b-32768));if(0===s.length)return c?this.c.subarray(32768,this.b):this.c.slice(32768,this.b);for(t=0,n=s.length;t<n;++t)for(i=0,r=(e=s[t]).length;i<r;++i)l[o++]=e[i];for(t=32768,n=this.b;t<n;++t)l[o++]=a[t];return this.g=[],this.buffer=l},n.prototype.v=function(){var e,t=this.b;return c?this.r?(e=new Uint8Array(t)).set(this.c.subarray(0,t)):e=this.c.subarray(0,t):(this.c.length>t&&(this.c.length=t),e=this.c),this.buffer=e},o.prototype.k=function(){var e,t,n=this.input;if(e=this.q.k(),this.a=this.q.a,this.A){t=(n[this.a++]<<24|n[this.a++]<<16|n[this.a++]<<8|n[this.a++])>>>0;var i=e;if("string"==typeof i){var r,o,a=i.split("");for(r=0,o=a.length;r<o;r++)a[r]=(255&a[r].charCodeAt(0))>>>0;i=a}for(var s,c=1,l=0,u=i.length,h=0;0<u;){u-=s=1024<u?1024:u;do{l+=c+=i[h++]}while(--s);c%=65521,l%=65521}if(t!==(l<<16|c)>>>0)throw Error("invalid adler-32 checksum")}return e};var P=8;e("Zlib.Inflate",o),e("Zlib.Inflate.prototype.decompress",o.prototype.k);var I,L,D,O,k={ADAPTIVE:h.s,BLOCK:h.t};if(Object.keys)I=Object.keys(k);else for(L in I=[],D=0,k)I[D++]=L;for(D=0,O=I.length;D<O;++D)e("Zlib.Inflate.BufferType."+(L=I[D]),k[L])}.call(this),THREE.FBXLoader=function(){function e(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager}function t(e){this.textureLoader=e}function n(){}function i(){}function r(){}function o(){}function a(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===t||t}function s(){}function c(e){var t=e.match(/FBXVersion: (\d+)/);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function l(e){return e/46186158e3}function u(e,t,n,i){var r;switch(i.mappingType){case"ByPolygonVertex":r=e;break;case"ByPolygon":r=t;break;case"ByVertice":r=n;break;case"AllSame":r=i.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+i.mappingType)}"IndexToDirect"===i.referenceType&&(r=i.indices[r]);var o=r*i.dataSize,a=o+i.dataSize;return function(e,t,n,i){for(var r=n,o=0;r<i;r++,o++)e[o]=t[r];return e}(w,i.buffer,o,a)}function h(e){var t,n=new THREE.Matrix4,i=new THREE.Matrix4,r=new THREE.Matrix4,o=new THREE.Matrix4,a=new THREE.Matrix4,s=new THREE.Matrix4,c=new THREE.Matrix4,l=new THREE.Matrix4,u=new THREE.Matrix4,h=new THREE.Matrix4,d=new THREE.Matrix4,p=e.inheritType?e.inheritType:0;e.translation&&n.setPosition(E.fromArray(e.translation)),e.preRotation&&((t=e.preRotation.map(THREE.Math.degToRad)).push(e.eulerOrder),i.makeRotationFromEuler(x.fromArray(t))),e.rotation&&((t=e.rotation.map(THREE.Math.degToRad)).push(e.eulerOrder),r.makeRotationFromEuler(x.fromArray(t))),e.postRotation&&((t=e.postRotation.map(THREE.Math.degToRad)).push(e.eulerOrder),o.makeRotationFromEuler(x.fromArray(t))),e.scale&&a.scale(E.fromArray(e.scale)),e.scalingOffset&&c.setPosition(E.fromArray(e.scalingOffset)),e.scalingPivot&&s.setPosition(E.fromArray(e.scalingPivot)),e.rotationOffset&&l.setPosition(E.fromArray(e.rotationOffset)),e.rotationPivot&&u.setPosition(E.fromArray(e.rotationPivot)),e.parentMatrixWorld&&(h=e.parentMatrixWorld);var f=i.multiply(r).multiply(o),m=new THREE.Matrix4;h.extractRotation(m);var g,v,y,b,w=new THREE.Matrix4;if(w.copyPosition(h),y=w.getInverse(w).multiply(h),v=m.getInverse(m).multiply(y),g=a,0===p)b=m.multiply(f).multiply(v).multiply(g);else if(1===p)b=m.multiply(v).multiply(f).multiply(g);else{var S=(new THREE.Matrix4).copy(a),_=v.multiply(S.getInverse(S));b=m.multiply(f).multiply(_).multiply(g)}var T=n.multiply(l).multiply(u).multiply(i).multiply(r).multiply(o).multiply(u.getInverse(u)).multiply(c).multiply(s).multiply(a).multiply(s.getInverse(s)),M=(new THREE.Matrix4).copyPosition(T),C=h.multiply(M);return d.copyPosition(C),d.multiply(b)}function d(e){var t=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===(e=e||0)?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),t[0]):t[e]}function p(e){return e.split(",").map(function(e){return parseFloat(e)})}function f(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=e.byteLength),THREE.LoaderUtils.decodeText(new Uint8Array(e,t,n))}function m(e,t,n){return e.slice(0,t).concat(n).concat(e.slice(t))}var g,v,y,b;e.prototype={constructor:e,crossOrigin:"anonymous",load:function(e,t,n,i,r){var o=this;b=r;var a=void 0===o.path?THREE.LoaderUtils.extractUrlBase(e):o.path,s=new THREE.FileLoader(this.manager);s.setPath(o.path),s.setResponseType("arraybuffer"),s.load(e,function(n){try{t(o.parse(n,a))}catch(t){setTimeout(function(){i&&i(t),o.manager.itemError(e)},0)}},n,i)},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setCrossOrigin:function(e){return this.crossOrigin=e,this},parse:function(e,n){if(s="Kaydara FBX Binary  \0",(a=e).byteLength>=s.length&&s===f(a,0,s.length))g=(new o).parse(e);else{var i=f(e);if(!function(e){for(var t,n,i=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],r=0,o=0;o<i.length;++o)if(n=void 0,n=e[(t=1)-1],e=e.slice(r+t),r++,n===i[o])return!1;return!0}(i))throw new Error("THREE.FBXLoader: Unknown format.");if(c(i)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+c(i));g=(new r).parse(i)}var a,s;return new t(new THREE.TextureLoader(this.manager).setPath(this.resourcePath||n).setCrossOrigin(this.crossOrigin)).parse(g)}},t.prototype={constructor:t,parse:function(){v=this.parseConnections();var e=this.parseImages(),t=this.parseTextures(e),i=this.parseMaterials(t),r=this.parseDeformers(),o=(new n).parse(r);return this.parseScene(r,o,i),y},parseConnections:function(){var e=new Map;return"Connections"in g&&g.Connections.connections.forEach(function(t){var n=t[0],i=t[1],r=t[2];e.has(n)||e.set(n,{parents:[],children:[]});var o={ID:i,relationship:r};e.get(n).parents.push(o),e.has(i)||e.set(i,{parents:[],children:[]});var a={ID:n,relationship:r};e.get(i).children.push(a)}),e},parseImages:function(){var e={},t={};if("Video"in g.Objects){var n=g.Objects.Video;for(var i in n){var r=n[i];if(e[c=parseInt(i)]=r.RelativeFilename||r.Filename,"Content"in r){var o=r.Content instanceof ArrayBuffer&&r.Content.byteLength>0,a="string"==typeof r.Content&&""!==r.Content;if(o||a){var s=this.parseImage(n[i]);t[r.RelativeFilename||r.Filename]=s}}}}for(var c in e){var l=e[c];void 0!==t[l]?e[c]=t[l]:e[c]=e[c].split("\\").pop()}return e},parseImage:function(e){var t,n=e.Content,i=e.RelativeFilename||e.Filename,r=i.slice(i.lastIndexOf(".")+1).toLowerCase();switch(r){case"bmp":t="image/bmp";break;case"jpg":case"jpeg":t="image/jpeg";break;case"png":t="image/png";break;case"tif":t="image/tiff";break;case"tga":if("function"!=typeof THREE.TGALoader)return void console.warn("FBXLoader: THREE.TGALoader is required to load TGA textures");if(null===THREE.Loader.Handlers.get(".tga")){var o=new THREE.TGALoader;o.setPath(this.textureLoader.path),THREE.Loader.Handlers.add(/\.tga$/i,o)}t="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+r+'" is not supported.')}if("string"==typeof n)return"data:"+t+";base64,"+n;var a=new Uint8Array(n);return window.URL.createObjectURL(new Blob([a],{type:t}))},parseTextures:function(e){var t=new Map;if("Texture"in g.Objects){var n=g.Objects.Texture;for(var i in n){var r=this.parseTexture(n[i],e);t.set(parseInt(i),r)}}return t},parseTexture:function(e,t){var n=this.loadTexture(e,t);n.ID=e.id,n.name=e.attrName;var i=e.WrapModeU,r=e.WrapModeV,o=void 0!==i?i.value:0,a=void 0!==r?r.value:0;if(n.wrapS=0===o?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,n.wrapT=0===a?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,"Scaling"in e){var s=e.Scaling.value;n.repeat.x=s[0],n.repeat.y=s[1]}return n},loadTexture:function(e,t){var n,i,r=this.textureLoader.path,o=v.get(e.id).children;void 0!==o&&o.length>0&&void 0!==t[o[0].ID]&&(0!==(n=t[o[0].ID]).indexOf("blob:")&&0!==n.indexOf("data:")||this.textureLoader.setPath(void 0));var a=e.FileName.slice(-3).toLowerCase();if("tga"===a){var s=THREE.Loader.Handlers.get(".tga");null===s?(console.warn("FBXLoader: TGALoader not found, creating empty placeholder texture for",n),i=new THREE.Texture):i=s.load(n)}else"psd"===a?(console.warn("FBXLoader: PSD textures are not supported, creating empty placeholder texture for",n),i=new THREE.Texture):i=this.textureLoader.load(n);return this.textureLoader.setPath(r),i},parseMaterials:function(e){var t=new Map;if("Material"in g.Objects){var n=g.Objects.Material;for(var i in n){var r=this.parseMaterial(n[i],e);null!==r&&t.set(parseInt(i),r)}}return t},parseMaterial:function(e,t){b&&b(e);var n=e.id,i=e.attrName,r=e.ShadingModel;if("object"==typeof r&&(r=r.value),!v.has(n))return null;var o,a=this.parseParameters(e,t,n);switch(r.toLowerCase()){case"phong":o=new THREE.MeshPhongMaterial;break;case"lambert":o=new THREE.MeshLambertMaterial;break;case"basic":o=new THREE.MeshBasicMaterial;break;default:/^\d+$/.test(r)&&THREE.CustomMaterial&&parseInt(r)<THREE.CustomMaterial.length?o=new(THREE.CustomMaterial[parseInt(r)]):(console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',r),o=new THREE.MeshPhongMaterial)}return o.setValues(a),o.name=i,o},parseParameters:function(e,t,n){var i={};e.BumpFactor&&(i.bumpScale=e.BumpFactor.value),e.Diffuse?i.color=(new THREE.Color).fromArray(e.Diffuse.value):e.DiffuseColor&&"Color"===e.DiffuseColor.type&&(i.color=(new THREE.Color).fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(i.displacementScale=e.DisplacementFactor.value),e.Emissive?i.emissive=(new THREE.Color).fromArray(e.Emissive.value):e.EmissiveColor&&"Color"===e.EmissiveColor.type&&(i.emissive=(new THREE.Color).fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(i.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(i.opacity=parseFloat(e.Opacity.value)),i.opacity<1&&(i.transparent=!0),e.ReflectionFactor&&(i.reflectivity=e.ReflectionFactor.value),e.Shininess&&(i.shininess=e.Shininess.value),e.Specular?i.specular=(new THREE.Color).fromArray(e.Specular.value):e.SpecularColor&&"Color"===e.SpecularColor.type&&(i.specular=(new THREE.Color).fromArray(e.SpecularColor.value));var r=this;return v.get(n).children.forEach(function(e){var n=e.relationship;switch(n){case"Bump":i.bumpMap=r.getTexture(t,e.ID);break;case"Maya|TEX_ao_map":i.aoMap=r.getTexture(t,e.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":i.map=r.getTexture(t,e.ID);break;case"DisplacementColor":i.displacementMap=r.getTexture(t,e.ID);break;case"EmissiveColor":i.emissiveMap=r.getTexture(t,e.ID);break;case"NormalMap":case"Maya|TEX_normal_map":i.normalMap=r.getTexture(t,e.ID);break;case"ReflectionColor":i.envMap=r.getTexture(t,e.ID),i.envMap.mapping=THREE.EquirectangularReflectionMapping;break;case"SpecularColor":i.specularMap=r.getTexture(t,e.ID);break;case"TransparentColor":i.alphaMap=r.getTexture(t,e.ID),i.transparent=!0;break;case"TransparencyFactor":i.opacity=1,i.alphaTest=.4,i.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",n)}}),i},getTexture:function(e,t){return"LayeredTexture"in g.Objects&&t in g.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=v.get(t).children[0].ID),e.get(t)},parseDeformers:function(){var e={},t={};if("Deformer"in g.Objects){var n=g.Objects.Deformer;for(var i in n){var r=n[i],o=v.get(parseInt(i));if("Skin"===r.attrType){var a=this.parseSkeleton(o,n);a.ID=i,o.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),a.geometryID=o.parents[0].ID,e[i]=a}else if("BlendShape"===r.attrType){var s={id:i};s.rawTargets=this.parseMorphTargets(o,n),s.id=i,o.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[i]=s}}}return{skeletons:e,morphTargets:t}},parseSkeleton:function(e,t){var n=[];return e.children.forEach(function(e){var i=t[e.ID];if("Cluster"===i.attrType){var r={ID:e.ID,indices:[],weights:[],transformLink:(new THREE.Matrix4).fromArray(i.TransformLink.a)};"Indexes"in i&&(r.indices=i.Indexes.a,r.weights=i.Weights.a),n.push(r)}}),{rawBones:n,bones:[]}},parseMorphTargets:function(e,t){for(var n=[],i=0;i<e.children.length;i++){var r=e.children[i],o=t[r.ID],a={name:o.attrName,initialWeight:o.DeformPercent,id:o.id,fullWeights:o.FullWeights.a};if("BlendShapeChannel"!==o.attrType)return;a.geoID=v.get(parseInt(r.ID)).children.filter(function(e){return void 0===e.relationship})[0].ID,n.push(a)}return n},parseScene:function(e,t,n){y=new THREE.Group;var r=this.parseModels(e.skeletons,t,n),o=g.Objects.Model,a=this;r.forEach(function(e){var t=o[e.ID];a.setLookAtProperties(e,t),v.get(e.ID).parents.forEach(function(t){var n=r.get(t.ID);void 0!==n&&n.add(e)}),null===e.parent&&y.add(e)}),this.bindSkeleton(e.skeletons,t,r),this.createAmbientLight(),this.setupMorphMaterials(),y.traverse(function(e){if(e.userData.transformData){e.parent&&(e.userData.transformData.parentMatrixWorld=e.parent.matrix);var t=h(e.userData.transformData);e.applyMatrix(t)}});var s=(new i).parse();1===y.children.length&&y.children[0].isGroup&&(y.children[0].animations=s,y=y.children[0]),y.animations=s},parseModels:function(e,t,n){var i=new Map,r=g.Objects.Model;for(var o in r){var a=parseInt(o),s=r[o],c=v.get(a),l=this.buildSkeleton(c,e,a,s.attrName);if(!l){switch(s.attrType){case"Camera":l=this.createCamera(c);break;case"Light":l=this.createLight(c);break;case"Mesh":l=this.createMesh(c,t,n);break;case"NurbsCurve":l=this.createCurve(c,t);break;case"LimbNode":case"Root":l=new THREE.Bone;break;case"Null":default:l=new THREE.Group}l.name=THREE.PropertyBinding.sanitizeNodeName(s.attrName),l.ID=a}this.getTransformData(l,s),i.set(a,l)}return i},buildSkeleton:function(e,t,n,i){var r=null;return e.parents.forEach(function(e){for(var o in t){var a=t[o];a.rawBones.forEach(function(t,o){if(t.ID===e.ID){var s=r;(r=new THREE.Bone).matrixWorld.copy(t.transformLink),r.name=THREE.PropertyBinding.sanitizeNodeName(i),r.ID=n,a.bones[o]=r,null!==s&&r.add(s)}})}}),r},createCamera:function(e){var t,n;if(e.children.forEach(function(e){var t=g.Objects.NodeAttribute[e.ID];void 0!==t&&(n=t)}),void 0===n)t=new THREE.Object3D;else{var i=0;void 0!==n.CameraProjectionType&&1===n.CameraProjectionType.value&&(i=1);var r=1;void 0!==n.NearPlane&&(r=n.NearPlane.value/1e3);var o=1e3;void 0!==n.FarPlane&&(o=n.FarPlane.value/1e3);var a=window.innerWidth,s=window.innerHeight;void 0!==n.AspectWidth&&void 0!==n.AspectHeight&&(a=n.AspectWidth.value,s=n.AspectHeight.value);var c=a/s,l=45;void 0!==n.FieldOfView&&(l=n.FieldOfView.value);var u=n.FocalLength?n.FocalLength.value:null;switch(i){case 0:t=new THREE.PerspectiveCamera(l,c,r,o),null!==u&&t.setFocalLength(u);break;case 1:t=new THREE.OrthographicCamera(-a/2,a/2,s/2,-s/2,r,o);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+i+"."),t=new THREE.Object3D}}return t},createLight:function(e){var t,n;if(e.children.forEach(function(e){var t=g.Objects.NodeAttribute[e.ID];void 0!==t&&(n=t)}),void 0===n)t=new THREE.Object3D;else{var i;i=void 0===n.LightType?0:n.LightType.value;var r=16777215
;void 0!==n.Color&&(r=(new THREE.Color).fromArray(n.Color.value));var o=void 0===n.Intensity?1:n.Intensity.value/100;void 0!==n.CastLightOnObject&&0===n.CastLightOnObject.value&&(o=0);var a=0;switch(void 0!==n.FarAttenuationEnd&&(a=void 0!==n.EnableFarAttenuation&&0===n.EnableFarAttenuation.value?0:n.FarAttenuationEnd.value),i){case 0:t=new THREE.PointLight(r,o,a,1);break;case 1:t=new THREE.DirectionalLight(r,o);break;case 2:var s=Math.PI/3;void 0!==n.InnerAngle&&(s=THREE.Math.degToRad(n.InnerAngle.value));var c=0;void 0!==n.OuterAngle&&(c=THREE.Math.degToRad(n.OuterAngle.value),c=Math.max(c,1)),t=new THREE.SpotLight(r,o,a,s,c,1);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a THREE.PointLight."),t=new THREE.PointLight(r,o)}void 0!==n.CastShadows&&1===n.CastShadows.value&&(t.castShadow=!0)}return t},createMesh:function(e,t,n){var i,r=null,o=null,a=[];return e.children.forEach(function(e){t.has(e.ID)&&(r=t.get(e.ID)),n.has(e.ID)&&a.push(n.get(e.ID))}),a.length>1?o=a:a.length>0?o=a[0]:(o=new THREE.MeshPhongMaterial({color:13421772}),a.push(o)),"color"in r.attributes&&a.forEach(function(e){e.vertexColors=THREE.VertexColors}),r.FBX_Deformer?(a.forEach(function(e){e.skinning=!0}),(i=new THREE.SkinnedMesh(r,o)).normalizeSkinWeights()):i=new THREE.Mesh(r,o),i},createCurve:function(e,t){var n=e.children.reduce(function(e,n){return t.has(n.ID)&&(e=t.get(n.ID)),e},null),i=new THREE.LineBasicMaterial({color:3342591,linewidth:1});return new THREE.Line(n,i)},getTransformData:function(e,t){var n={};"InheritType"in t&&(n.inheritType=parseInt(t.InheritType.value)),n.eulerOrder="RotationOrder"in t?d(t.RotationOrder.value):"ZYX","Lcl_Translation"in t&&(n.translation=t.Lcl_Translation.value),"PreRotation"in t&&(n.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(n.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(n.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(n.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(n.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(n.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(n.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(n.rotationPivot=t.RotationPivot.value),e.userData.transformData=n},setLookAtProperties:function(e,t){"LookAtProperty"in t&&v.get(e.ID).children.forEach(function(t){if("LookAtProperty"===t.relationship){var n=g.Objects.Model[t.ID];if("Lcl_Translation"in n){var i=n.Lcl_Translation.value;void 0!==e.target?(e.target.position.fromArray(i),y.add(e.target)):e.lookAt((new THREE.Vector3).fromArray(i))}}})},bindSkeleton:function(e,t,n){var i=this.parsePoseNodes();for(var r in e){var o=e[r];v.get(parseInt(o.ID)).parents.forEach(function(e){if(t.has(e.ID)){var r=e.ID;v.get(r).parents.forEach(function(e){n.has(e.ID)&&n.get(e.ID).bind(new THREE.Skeleton(o.bones),i[e.ID])})}})}},parsePoseNodes:function(){var e={};if("Pose"in g.Objects){var t=g.Objects.Pose;for(var n in t)if("BindPose"===t[n].attrType){var i=t[n].PoseNode;Array.isArray(i)?i.forEach(function(t){e[t.Node]=(new THREE.Matrix4).fromArray(t.Matrix.a)}):e[i.Node]=(new THREE.Matrix4).fromArray(i.Matrix.a)}}return e},createAmbientLight:function(){if("GlobalSettings"in g&&"AmbientColor"in g.GlobalSettings){var e=g.GlobalSettings.AmbientColor.value,t=e[0],n=e[1],i=e[2];if(0!==t||0!==n||0!==i){var r=new THREE.Color(t,n,i);y.add(new THREE.AmbientLight(r,1))}}},setupMorphMaterials:function(){var e=this;y.traverse(function(t){t.isMesh&&t.geometry.morphAttributes.position&&t.geometry.morphAttributes.position.length&&(Array.isArray(t.material)?t.material.forEach(function(n,i){e.setupMorphMaterial(t,n,i)}):e.setupMorphMaterial(t,t.material))})},setupMorphMaterial:function(e,t,n){var i=e.uuid,r=t.uuid,o=!1;if(y.traverse(function(e){e.isMesh&&(Array.isArray(e.material)?e.material.forEach(function(t){t.uuid===r&&e.uuid!==i&&(o=!0)}):e.material.uuid===r&&e.uuid!==i&&(o=!0))}),!0===o){var a=t.clone();a.morphTargets=!0,void 0===n?e.material=a:e.material[n]=a}else t.morphTargets=!0}},n.prototype={constructor:n,parse:function(e){var t=new Map;if("Geometry"in g.Objects){var n=g.Objects.Geometry;for(var i in n){var r=v.get(parseInt(i)),o=this.parseGeometry(r,n[i],e);t.set(parseInt(i),o)}}return t},parseGeometry:function(e,t,n){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,n);case"NurbsCurve":return this.parseNurbsGeometry(t)}},parseMeshGeometry:function(e,t,n){var i=n.skeletons,r=n.morphTargets,o=e.parents.map(function(e){return g.Objects.Model[e.ID]});if(0!==o.length){var a=e.children.reduce(function(e,t){return void 0!==i[t.ID]&&(e=i[t.ID]),e},null),s=e.children.reduce(function(e,t){return void 0!==r[t.ID]&&(e=r[t.ID]),e},null),c=o[0],l={};"RotationOrder"in c&&(l.eulerOrder=d(c.RotationOrder.value)),"InheritType"in c&&(l.inheritType=parseInt(c.InheritType.value)),"GeometricTranslation"in c&&(l.translation=c.GeometricTranslation.value),"GeometricRotation"in c&&(l.rotation=c.GeometricRotation.value),"GeometricScaling"in c&&(l.scale=c.GeometricScaling.value);var u=h(l);return this.genGeometry(t,a,s,u)}},genGeometry:function(e,t,n,i){var r=new THREE.BufferGeometry;e.attrName&&(r.name=e.attrName);var o=this.parseGeoNode(e,t),a=this.genBuffers(o),s=new THREE.Float32BufferAttribute(a.vertex,3);if(i.applyToBufferAttribute(s),r.addAttribute("position",s),a.colors.length>0&&r.addAttribute("color",new THREE.Float32BufferAttribute(a.colors,3)),t&&(r.addAttribute("skinIndex",new THREE.Uint16BufferAttribute(a.weightsIndices,4)),r.addAttribute("skinWeight",new THREE.Float32BufferAttribute(a.vertexWeights,4)),r.FBX_Deformer=t),a.normal.length>0){var c=new THREE.Float32BufferAttribute(a.normal,3);(new THREE.Matrix3).getNormalMatrix(i).applyToBufferAttribute(c),r.addAttribute("normal",c)}if(a.uvs.forEach(function(e,t){var n="uv"+(t+1).toString();0===t&&(n="uv"),r.addAttribute(n,new THREE.Float32BufferAttribute(a.uvs[t],2))}),o.material&&"AllSame"!==o.material.mappingType){var l=a.materialIndex[0],u=0;if(a.materialIndex.forEach(function(e,t){e!==l&&(r.addGroup(u,t-u,l),l=e,u=t)}),r.groups.length>0){var h=r.groups[r.groups.length-1],d=h.start+h.count;d!==a.materialIndex.length&&r.addGroup(d,a.materialIndex.length-d,l)}0===r.groups.length&&r.addGroup(0,a.materialIndex.length,a.materialIndex[0])}return this.addMorphTargets(r,e,n,i),r},parseGeoNode:function(e,t){var n={};if(n.vertexPositions=void 0!==e.Vertices?e.Vertices.a:[],n.vertexIndices=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(n.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(n.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(n.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){n.uv=[];for(var i=0;e.LayerElementUV[i];)n.uv.push(this.parseUVs(e.LayerElementUV[i])),i++}return n.weightTable={},null!==t&&(n.skeleton=t,t.rawBones.forEach(function(e,t){e.indices.forEach(function(i,r){void 0===n.weightTable[i]&&(n.weightTable[i]=[]),n.weightTable[i].push({id:t,weight:e.weights[r]})})})),n},genBuffers:function(e){var t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]},n=0,i=0,r=!1,o=[],a=[],s=[],c=[],l=[],h=[],d=this;return e.vertexIndices.forEach(function(p,f){var m=!1;p<0&&(p^=-1,m=!0);var g=[],v=[];if(o.push(3*p,3*p+1,3*p+2),e.color){var y=u(f,n,p,e.color);s.push(y[0],y[1],y[2])}if(e.skeleton){if(void 0!==e.weightTable[p]&&e.weightTable[p].forEach(function(e){v.push(e.weight),g.push(e.id)}),v.length>4){r||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),r=!0);var b=[0,0,0,0],w=[0,0,0,0];v.forEach(function(e,t){var n=e,i=g[t];w.forEach(function(e,t,r){if(n>e){r[t]=n,n=e;var o=b[t];b[t]=i,i=o}})}),g=b,v=w}for(;v.length<4;)v.push(0),g.push(0);for(var x=0;x<4;++x)l.push(v[x]),h.push(g[x])}if(e.normal&&(y=u(f,n,p,e.normal),a.push(y[0],y[1],y[2])),e.material&&"AllSame"!==e.material.mappingType)var E=u(f,n,p,e.material)[0];e.uv&&e.uv.forEach(function(e,t){var i=u(f,n,p,e);void 0===c[t]&&(c[t]=[]),c[t].push(i[0]),c[t].push(i[1])}),i++,m&&(d.genFace(t,e,o,E,a,s,c,l,h,i),n++,i=0,o=[],a=[],s=[],c=[],l=[],h=[])}),t},genFace:function(e,t,n,i,r,o,a,s,c,l){for(var u=2;u<l;u++)e.vertex.push(t.vertexPositions[n[0]]),e.vertex.push(t.vertexPositions[n[1]]),e.vertex.push(t.vertexPositions[n[2]]),e.vertex.push(t.vertexPositions[n[3*(u-1)]]),e.vertex.push(t.vertexPositions[n[3*(u-1)+1]]),e.vertex.push(t.vertexPositions[n[3*(u-1)+2]]),e.vertex.push(t.vertexPositions[n[3*u]]),e.vertex.push(t.vertexPositions[n[3*u+1]]),e.vertex.push(t.vertexPositions[n[3*u+2]]),t.skeleton&&(e.vertexWeights.push(s[0]),e.vertexWeights.push(s[1]),e.vertexWeights.push(s[2]),e.vertexWeights.push(s[3]),e.vertexWeights.push(s[4*(u-1)]),e.vertexWeights.push(s[4*(u-1)+1]),e.vertexWeights.push(s[4*(u-1)+2]),e.vertexWeights.push(s[4*(u-1)+3]),e.vertexWeights.push(s[4*u]),e.vertexWeights.push(s[4*u+1]),e.vertexWeights.push(s[4*u+2]),e.vertexWeights.push(s[4*u+3]),e.weightsIndices.push(c[0]),e.weightsIndices.push(c[1]),e.weightsIndices.push(c[2]),e.weightsIndices.push(c[3]),e.weightsIndices.push(c[4*(u-1)]),e.weightsIndices.push(c[4*(u-1)+1]),e.weightsIndices.push(c[4*(u-1)+2]),e.weightsIndices.push(c[4*(u-1)+3]),e.weightsIndices.push(c[4*u]),e.weightsIndices.push(c[4*u+1]),e.weightsIndices.push(c[4*u+2]),e.weightsIndices.push(c[4*u+3])),t.color&&(e.colors.push(o[0]),e.colors.push(o[1]),e.colors.push(o[2]),e.colors.push(o[3*(u-1)]),e.colors.push(o[3*(u-1)+1]),e.colors.push(o[3*(u-1)+2]),e.colors.push(o[3*u]),e.colors.push(o[3*u+1]),e.colors.push(o[3*u+2])),t.material&&"AllSame"!==t.material.mappingType&&(e.materialIndex.push(i),e.materialIndex.push(i),e.materialIndex.push(i)),t.normal&&(e.normal.push(r[0]),e.normal.push(r[1]),e.normal.push(r[2]),e.normal.push(r[3*(u-1)]),e.normal.push(r[3*(u-1)+1]),e.normal.push(r[3*(u-1)+2]),e.normal.push(r[3*u]),e.normal.push(r[3*u+1]),e.normal.push(r[3*u+2])),t.uv&&t.uv.forEach(function(t,n){void 0===e.uvs[n]&&(e.uvs[n]=[]),e.uvs[n].push(a[n][0]),e.uvs[n].push(a[n][1]),e.uvs[n].push(a[n][2*(u-1)]),e.uvs[n].push(a[n][2*(u-1)+1]),e.uvs[n].push(a[n][2*u]),e.uvs[n].push(a[n][2*u+1])})},addMorphTargets:function(e,t,n,i){if(null!==n){e.morphAttributes.position=[];var r=this;n.rawTargets.forEach(function(n){var o=g.Objects.Geometry[n.geoID];void 0!==o&&r.genMorphGeometry(e,t,o,i,n.name)})}},genMorphGeometry:function(e,t,n,i,r){var o=new THREE.BufferGeometry;n.attrName&&(o.name=n.attrName);for(var a=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],s=void 0!==t.Vertices?t.Vertices.a.slice():[],c=void 0!==n.Vertices?n.Vertices.a:[],l=void 0!==n.Indexes?n.Indexes.a:[],u=0;u<l.length;u++){var h=3*l[u];s[h]+=c[3*u],s[h+1]+=c[3*u+1],s[h+2]+=c[3*u+2]}var d={vertexIndices:a,vertexPositions:s},p=this.genBuffers(d),f=new THREE.Float32BufferAttribute(p.vertex,3);f.name=r||n.attrName,i.applyToBufferAttribute(f),e.morphAttributes.position.push(f)},parseNormals:function(e){var t=e.MappingInformationType,n=e.ReferenceInformationType,i=e.Normals.a,r=[];return"IndexToDirect"===n&&("NormalIndex"in e?r=e.NormalIndex.a:"NormalsIndex"in e&&(r=e.NormalsIndex.a)),{dataSize:3,buffer:i,indices:r,mappingType:t,referenceType:n}},parseUVs:function(e){var t=e.MappingInformationType,n=e.ReferenceInformationType,i=e.UV.a,r=[];return"IndexToDirect"===n&&(r=e.UVIndex.a),{dataSize:2,buffer:i,indices:r,mappingType:t,referenceType:n}},parseVertexColors:function(e){var t=e.MappingInformationType,n=e.ReferenceInformationType,i=e.Colors.a,r=[];return"IndexToDirect"===n&&(r=e.ColorIndex.a),{dataSize:4,buffer:i,indices:r,mappingType:t,referenceType:n}},parseMaterialIndices:function(e){var t=e.MappingInformationType,n=e.ReferenceInformationType;if("NoMappingInformation"===t)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};for(var i=e.Materials.a,r=[],o=0;o<i.length;++o)r.push(o);return{dataSize:1,buffer:i,indices:r,mappingType:t,referenceType:n}},parseNurbsGeometry:function(e){if(void 0===THREE.NURBSCurve)return console.error("THREE.FBXLoader: The loader relies on THREE.NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new THREE.BufferGeometry;var t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new THREE.BufferGeometry;for(var n,i,r=t-1,o=e.KnotVector.a,a=[],s=e.Points.a,c=0,l=s.length;c<l;c+=4)a.push((new THREE.Vector4).fromArray(s,c));if("Closed"===e.Form)a.push(a[0]);else if("Periodic"===e.Form)for(n=r,i=o.length-1-n,c=0;c<r;++c)a.push(a[c]);var u=new THREE.NURBSCurve(r,o,a,n,i).getPoints(7*a.length),h=new Float32Array(3*u.length);u.forEach(function(e,t){e.toArray(h,3*t)});var d=new THREE.BufferGeometry;return d.addAttribute("position",new THREE.BufferAttribute(h,3)),d}},i.prototype={constructor:i,parse:function(){var e=[],t=this.parseClips();if(void 0!==t)for(var n in t){var i=t[n],r=this.addClip(i);e.push(r)}return e},parseClips:function(){if(void 0!==g.Objects.AnimationCurve){var e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);var t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}},parseAnimationCurveNodes:function(){var e=g.Objects.AnimationCurveNode,t=new Map;for(var n in e){var i=e[n];if(null!==i.attrName.match(/S|R|T|DeformPercent/)){var r={id:i.id,attr:i.attrName,curves:{}};t.set(r.id,r)}}return t},parseAnimationCurves:function(e){var t=g.Objects.AnimationCurve;for(var n in t){var i={id:t[n].id,times:t[n].KeyTime.a.map(l),values:t[n].KeyValueFloat.a},r=v.get(i.id);if(void 0!==r){var o=r.parents[0].ID,a=r.parents[0].relationship;a.match(/X/)?e.get(o).curves.x=i:a.match(/Y/)?e.get(o).curves.y=i:a.match(/Z/)?e.get(o).curves.z=i:a.match(/d|DeformPercent/)&&e.has(o)&&(e.get(o).curves.morph=i)}}},parseAnimationLayers:function(e){var t=g.Objects.AnimationLayer,n=new Map;for(var i in t){var r=[],o=v.get(parseInt(i));void 0!==o&&(o.children.forEach(function(t,n){if(e.has(t.ID)){var i=e.get(t.ID);if(void 0!==i.curves.x||void 0!==i.curves.y||void 0!==i.curves.z){if(void 0===r[n]&&void 0!==(u=v.get(t.ID).parents.filter(function(e){return void 0!==e.relationship})[0].ID)){var o=g.Objects.Model[u.toString()],a={modelName:THREE.PropertyBinding.sanitizeNodeName(o.attrName),ID:o.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};y.traverse(function(e){e.ID===o.id&&(a.transform=e.matrix,e.userData.transformData&&(a.eulerOrder=e.userData.transformData.eulerOrder))}),a.transform||(a.transform=new THREE.Matrix4),"PreRotation"in o&&(a.preRotation=o.PreRotation.value),"PostRotation"in o&&(a.postRotation=o.PostRotation.value),r[n]=a}r[n]&&(r[n][i.attr]=i)}else if(void 0!==i.curves.morph){if(void 0===r[n]){var s=v.get(t.ID).parents.filter(function(e){return void 0!==e.relationship})[0].ID,c=v.get(s).parents[0].ID,l=v.get(c).parents[0].ID,u=v.get(l).parents[0].ID;o=g.Objects.Model[u],a={modelName:THREE.PropertyBinding.sanitizeNodeName(o.attrName),morphName:g.Objects.Deformer[s].attrName},r[n]=a}r[n][i.attr]=i}}}),n.set(parseInt(i),r))}return n},parseAnimStacks:function(e){var t=g.Objects.AnimationStack,n={};for(var i in t){var r=v.get(parseInt(i)).children;r.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");var o=e.get(r[0].ID);n[i]={name:t[i].attrName,layer:o}}return n},addClip:function(e){var t=[],n=this;return e.layer.forEach(function(e){t=t.concat(n.generateTracks(e))}),new THREE.AnimationClip(e.name,-1,t)},generateTracks:function(e){var t=[],n=new THREE.Vector3,i=new THREE.Quaternion,r=new THREE.Vector3;if(e.transform&&e.transform.decompose(n,i,r),n=n.toArray(),i=(new THREE.Euler).setFromQuaternion(i,e.eulerOrder).toArray(),r=r.toArray(),void 0!==e.T&&Object.keys(e.T.curves).length>0){var o=this.generateVectorTrack(e.modelName,e.T.curves,n,"position");void 0!==o&&t.push(o)}if(void 0!==e.R&&Object.keys(e.R.curves).length>0){var a=this.generateRotationTrack(e.modelName,e.R.curves,i,e.preRotation,e.postRotation,e.eulerOrder);void 0!==a&&t.push(a)}if(void 0!==e.S&&Object.keys(e.S.curves).length>0){var s=this.generateVectorTrack(e.modelName,e.S.curves,r,"scale");void 0!==s&&t.push(s)}if(void 0!==e.DeformPercent){var c=this.generateMorphTrack(e);void 0!==c&&t.push(c)}return t},generateVectorTrack:function(e,t,n,i){var r=this.getTimesForAllAxes(t),o=this.getKeyframeTrackValues(r,t,n);return new THREE.VectorKeyframeTrack(e+"."+i,r,o)},generateRotationTrack:function(e,t,n,i,r,o){void 0!==t.x&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(THREE.Math.degToRad)),void 0!==t.y&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(THREE.Math.degToRad)),void 0!==t.z&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(THREE.Math.degToRad));var a=this.getTimesForAllAxes(t),s=this.getKeyframeTrackValues(a,t,n);void 0!==i&&((i=i.map(THREE.Math.degToRad)).push(o),i=(new THREE.Euler).fromArray(i),i=(new THREE.Quaternion).setFromEuler(i)),void 0!==r&&((r=r.map(THREE.Math.degToRad)).push(o),r=(new THREE.Euler).fromArray(r),r=(new THREE.Quaternion).setFromEuler(r).inverse());for(var c=new THREE.Quaternion,l=new THREE.Euler,u=[],h=0;h<s.length;h+=3)l.set(s[h],s[h+1],s[h+2],o),c.setFromEuler(l),void 0!==i&&c.premultiply(i),void 0!==r&&c.multiply(r),c.toArray(u,h/3*4);return new THREE.QuaternionKeyframeTrack(e+".quaternion",a,u)},generateMorphTrack:function(e){var t=e.DeformPercent.curves.morph,n=t.values.map(function(e){return e/100}),i=y.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new THREE.NumberKeyframeTrack(e.modelName+".morphTargetInfluences["+i+"]",t.times,n)},getTimesForAllAxes:function(e){var t=[];return void 0!==e.x&&(t=t.concat(e.x.times)),void 0!==e.y&&(t=t.concat(e.y.times)),void 0!==e.z&&(t=t.concat(e.z.times)),t.sort(function(e,t){return e-t}).filter(function(e,t,n){return n.indexOf(e)==t})},getKeyframeTrackValues:function(e,t,n){var i=n,r=[],o=-1,a=-1,s=-1;return e.forEach(function(e){if(t.x&&(o=t.x.times.indexOf(e)),t.y&&(a=t.y.times.indexOf(e)),t.z&&(s=t.z.times.indexOf(e)),-1!==o){var n=t.x.values[o];r.push(n),i[0]=n}else r.push(i[0]);if(-1!==a){var c=t.y.values[a];r.push(c),i[1]=c}else r.push(i[1]);if(-1!==s){var l=t.z.values[s];r.push(l),i[2]=l}else r.push(i[2])}),r},interpolateRotations:function(e){for(var t=1;t<e.values.length;t++){var n=e.values[t-1],i=e.values[t]-n,r=Math.abs(i);if(r>=180){for(var o=r/180,a=i/o,s=n+a,c=e.times[t-1],l=(e.times[t]-c)/o,u=c+l,h=[],d=[];u<e.times[t];)h.push(u),u+=l,d.push(s),s+=a;e.times=m(e.times,t,h),e.values=m(e.values,t,d)}}}},r.prototype={constructor:r,getPrevNode:function(){return this.nodeStack[this.currentIndent-2]},getCurrentNode:function(){return this.nodeStack[this.currentIndent-1]},getCurrentProp:function(){return this.currentProp},pushStack:function(e){this.nodeStack.push(e),this.currentIndent+=1},popStack:function(){this.nodeStack.pop(),this.currentIndent-=1},setCurrentProp:function(e,t){this.currentProp=e,this.currentPropName=t},parse:function(e){this.currentIndent=0,this.allNodes=new s,this.nodeStack=[],this.currentProp=[],this.currentPropName="";var t=this,n=e.split(/[\r\n]+/);return n.forEach(function(e,i){var r=e.match(/^[\s\t]*;/),o=e.match(/^[\s\t]*$/);if(!r&&!o){var a=e.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),s=e.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),c=e.match("^\\t{"+(t.currentIndent-1)+"}}");a?t.parseNodeBegin(e,a):s?t.parseNodeProperty(e,s,n[++i]):c?t.popStack():e.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(e)}}),this.allNodes},parseNodeBegin:function(e,t){var n=t[1].trim().replace(/^"/,"").replace(/"$/,""),i=t[2].split(",").map(function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")}),r={name:n},o=this.parseNodeAttr(i),a=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(n,r):n in a?("PoseNode"===n?a.PoseNode.push(r):void 0!==a[n].id&&(a[n]={},a[n][a[n].id]=a[n]),""!==o.id&&(a[n][o.id]=r)):"number"==typeof o.id?(a[n]={},a[n][o.id]=r):"Properties70"!==n&&(a[n]="PoseNode"===n?[r]:r),"number"==typeof o.id&&(r.id=o.id),""!==o.name&&(r.attrName=o.name),""!==o.type&&(r.attrType=o.type),this.pushStack(r)},parseNodeAttr:function(e){var t=e[0];""!==e[0]&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));var n="",i="";return e.length>1&&(n=e[1].replace(/^(\w+)::/,""),i=e[2]),{id:t,name:n,type:i}},parseNodeProperty:function(e,t,n){var i=t[1].replace(/^"/,"").replace(/"$/,"").trim(),r=t[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===i&&","===r&&(r=n.replace(/"/g,"").replace(/,$/,"").trim());var o=this.getCurrentNode();if("Properties70"!==o.name){if("C"===i){var a=r.split(",").slice(1),s=parseInt(a[0]),c=parseInt(a[1]),l=r.split(",").slice(3);i="connections",function(e,t){for(var n=0,i=e.length,r=t.length;n<r;n++,i++)e[i]=t[n]}(r=[s,c],l=l.map(function(e){return e.trim().replace(/^"/,"")})),void 0===o[i]&&(o[i]=[])}"Node"===i&&(o.id=r),i in o&&Array.isArray(o[i])?o[i].push(r):"a"!==i?o[i]=r:o.a=r,this.setCurrentProp(o,i),"a"===i&&","!==r.slice(-1)&&(o.a=p(r))}else this.parseNodeSpecialProperty(e,i,r)},parseNodePropertyContinued:function(e){var t=this.getCurrentNode();t.a+=e,","!==e.slice(-1)&&(t.a=p(t.a))},parseNodeSpecialProperty:function(e,t,n){var i=n.split('",').map(function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")}),r=i[0],o=i[1],a=i[2],s=i[3],c=i[4];switch(o){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":c=parseFloat(c);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":c=p(c)}this.getPrevNode()[r]={type:o,type2:a,flag:s,value:c},this.setCurrentProp(this.getPrevNode(),r)}},o.prototype={constructor:o,parse:function(e){var t=new a(e);t.skip(23);for(var n=t.getUint32(),i=new s;!this.endOfContent(t);){var r=this.parseNode(t,n);null!==r&&i.add(r.name,r)}return i},endOfContent:function(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()},parseNode:function(e,t){var n={},i=t>=7500?e.getUint64():e.getUint32(),r=t>=7500?e.getUint64():e.getUint32(),o=(t>=7500?e.getUint64():e.getUint32(),e.getUint8()),a=e.getString(o);if(0===i)return null;for(var s=[],c=0;c<r;c++)s.push(this.parseProperty(e));var l=s.length>0?s[0]:"",u=s.length>1?s[1]:"",h=s.length>2?s[2]:"";for(n.singleProperty=1===r&&e.getOffset()===i;i>e.getOffset();){var d=this.parseNode(e,t);null!==d&&this.parseSubNode(a,n,d)}return n.propertyList=s,"number"==typeof l&&(n.id=l),""!==u&&(n.attrName=u),""!==h&&(n.attrType=h),""!==a&&(n.name=a),n},parseSubNode:function(e,t,n){if(!0===n.singleProperty){var i=n.propertyList[0];Array.isArray(i)?(t[n.name]=n,n.a=i):t[n.name]=i}else if("Connections"===e&&"C"===n.name){var r=[];n.propertyList.forEach(function(e,t){0!==t&&r.push(e)}),void 0===t.connections&&(t.connections=[]),t.connections.push(r)}else if("Properties70"===n.name)Object.keys(n).forEach(function(e){t[e]=n[e]});else if("Properties70"===e&&"P"===n.name){var o,a=n.propertyList[0],s=n.propertyList[1],c=n.propertyList[2],l=n.propertyList[3];0===a.indexOf("Lcl ")&&(a=a.replace("Lcl ","Lcl_")),0===s.indexOf("Lcl ")&&(s=s.replace("Lcl ","Lcl_")),o="Color"===s||"ColorRGB"===s||"Vector"===s||"Vector3D"===s||0===s.indexOf("Lcl_")?[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:n.propertyList[4],t[a]={type:s,type2:c,flag:l,value:o}}else void 0===t[n.name]?"number"==typeof n.id?(t[n.name]={},t[n.name][n.id]=n):t[n.name]=n:"PoseNode"===n.name?(Array.isArray(t[n.name])||(t[n.name]=[t[n.name]]),t[n.name].push(n)):void 0===t[n.name][n.id]&&(t[n.name][n.id]=n)},parseProperty:function(e){var t=e.getString(1);switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":var n=e.getUint32();return e.getArrayBuffer(n);case"S":return n=e.getUint32(),e.getString(n);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":var i=e.getUint32(),r=e.getUint32(),o=e.getUint32();if(0===r)switch(t){case"b":case"c":return e.getBooleanArray(i);case"d":return e.getFloat64Array(i);case"f":return e.getFloat32Array(i);case"i":return e.getInt32Array(i);case"l":return e.getInt64Array(i)}"undefined"==typeof Zlib&&console.error("THREE.FBXLoader: External library Inflate.min.js required, obtain or import from https://github.com/imaya/zlib.js");var s=new a(new Zlib.Inflate(new Uint8Array(e.getArrayBuffer(o))).decompress().buffer);switch(t){case"b":case"c":return s.getBooleanArray(i);case"d":return s.getFloat64Array(i);case"f":return s.getFloat32Array(i);case"i":return s.getInt32Array(i);case"l":return s.getInt64Array(i)}default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}},a.prototype={constructor:a,getOffset:function(){return this.offset},size:function(){return this.dv.buffer.byteLength},skip:function(e){this.offset+=e},getBoolean:function(){return 1==(1&this.getUint8())},getBooleanArray:function(e){for(var t=[],n=0;n<e;n++)t.push(this.getBoolean());return t},getUint8:function(){var e=this.dv.getUint8(this.offset);return this.offset+=1,e},getInt16:function(){var e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e},getInt32:function(){var e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e},getInt32Array:function(e){for(var t=[],n=0;n<e;n++)t.push(this.getInt32());return t},getUint32:function(){var e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e},getInt64:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,4294967295==(e=4294967295&~e)&&(t=t+1&4294967295),-(4294967296*t+(e=e+1&4294967295))):4294967296*t+e},getInt64Array:function(e){for(var t=[],n=0;n<e;n++)t.push(this.getInt64());return t},getUint64:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e},getFloat32:function(){var e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e},getFloat32Array:function(e){for(var t=[],n=0;n<e;n++)t.push(this.getFloat32());return t},getFloat64:function(){var e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e},getFloat64Array:function(e){for(var t=[],n=0;n<e;n++)t.push(this.getFloat64());return t},getArrayBuffer:function(e){var t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t},getString:function(e){for(var t=[],n=0;n<e;n++)t[n]=this.getUint8();var i=t.indexOf(0);return i>=0&&(t=t.slice(0,i)),THREE.LoaderUtils.decodeText(new Uint8Array(t))}},s.prototype={constructor:s,add:function(e,t){this[e]=t}};var w=[],x=new THREE.Euler,E=new THREE.Vector3;return e}(),function(e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).PIXI=e()}(function(){return function e(t,n,i){function r(a,s){if(!n[a]){if(!t[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(o)return o(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var u=n[a]={exports:{}};t[a][0].call(u.exports,function(e){var n=t[a][1][e];return r(n||e)},u,u.exports,e,t,n,i)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<i.length;a++)r(i[a]);return r}({1:[function(e,t,n){(function(e,n){!function(){function i(){}function r(e){return e}function o(e){return!!e}function a(e){return!e}function s(e){return function(){if(null===e)throw new Error("Callback was already called.");e.apply(this,arguments),e=null}}function c(e){return function(){null!==e&&(e.apply(this,arguments),e=null)}}function l(e){return U(e)||"number"==typeof e.length&&e.length>=0&&e.length%1==0}function u(e,t){for(var n=-1,i=e.length;++n<i;)t(e[n],n,e)}function h(e,t){for(var n=-1,i=e.length,r=Array(i);++n<i;)r[n]=t(e[n],n,e);return r}function d(e){return h(Array(e),function(e,t){return t})}function p(e,t,n){return u(e,function(e,i,r){n=t(n,e,i,r)}),n}function f(e,t){u(z(e),function(n){t(e[n],n)})}function m(e,t){for(var n=0;n<e.length;n++)if(e[n]===t)return n;return-1}function g(e){var t,n,i=-1;return l(e)?(t=e.length,function(){return++i<t?i:null}):(n=z(e),t=n.length,function(){return++i<t?n[i]:null})}function v(e,t){return t=null==t?e.length-1:+t,function(){for(var n=Math.max(arguments.length-t,0),i=Array(n),r=0;r<n;r++)i[r]=arguments[r+t];switch(t){case 0:return e.call(this,i);case 1:return e.call(this,arguments[0],i)}}}function y(e){return function(t,n,i){return e(t,i)}}function b(e){return function(t,n,r){r=c(r||i);var o=g(t=t||[]);if(e<=0)return r(null);var a=!1,l=0,u=!1;!function i(){if(a&&l<=0)return r(null);for(;l<e&&!u;){var c=o();if(null===c)return a=!0,void(l<=0&&r(null));l+=1,n(t[c],c,s(function(e){l-=1,e?(r(e),u=!0):i()}))}}()}}function w(e){return function(t,n,i){return e(F.eachOf,t,n,i)}}function x(e){return function(t,n,i,r){return e(b(n),t,i,r)}}function E(e){return function(t,n,i){return e(F.eachOfSeries,t,n,i)}}function S(e,t,n,r){r=c(r||i);var o=l(t=t||[])?[]:{};e(t,function(e,t,i){n(e,function(e,n){o[t]=n,i(e)})},function(e){r(e,o)})}function _(e,t,n,i){var r=[];e(t,function(e,t,i){n(e,function(n){n&&r.push({index:t,value:e}),i()})},function(){i(h(r.sort(function(e,t){return e.index-t.index}),function(e){return e.value}))})}function T(e,t,n,i){_(e,t,function(e,t){n(e,function(e){t(!e)})},i)}function M(e,t,n){return function(i,r,o,a){function s(){a&&a(n(!1,void 0))}function c(e,i,r){if(!a)return r();o(e,function(i){a&&t(i)&&(a(n(!0,e)),a=o=!1),r()})}arguments.length>3?e(i,r,c,s):(a=o,o=r,e(i,c,s))}}function C(e,t){return t}function A(e,t,n){n=n||i;var r=l(t)?[]:{};e(t,function(e,t,n){e(v(function(e,i){i.length<=1&&(i=i[0]),r[t]=i,n(e)}))},function(e){n(e,r)})}function R(e,t,n,i){var r=[];e(t,function(e,t,i){n(e,function(e,t){r=r.concat(t||[]),i(e)})},function(e){i(e,r)})}function P(e,t,n){function r(e,t,n,r){if(null!=r&&"function"!=typeof r)throw new Error("task callback must be a function");if(e.started=!0,U(t)||(t=[t]),0===t.length&&e.idle())return F.setImmediate(function(){e.drain()});u(t,function(t){var o={data:t,callback:r||i};n?e.tasks.unshift(o):e.tasks.push(o),e.tasks.length===e.concurrency&&e.saturated()}),F.setImmediate(e.process)}function o(e,t){return function(){a-=1;var n=!1,i=arguments;u(t,function(e){u(c,function(t,i){t!==e||n||(c.splice(i,1),n=!0)}),e.callback.apply(e,i)}),e.tasks.length+a===0&&e.drain(),e.process()}}if(null==t)t=1;else if(0===t)throw new Error("Concurrency must not be zero");var a=0,c=[],l={tasks:[],concurrency:t,payload:n,saturated:i,empty:i,drain:i,started:!1,paused:!1,push:function(e,t){r(l,e,!1,t)},kill:function(){l.drain=i,l.tasks=[]},unshift:function(e,t){r(l,e,!0,t)},process:function(){for(;!l.paused&&a<l.concurrency&&l.tasks.length;){var t=l.payload?l.tasks.splice(0,l.payload):l.tasks.splice(0,l.tasks.length),n=h(t,function(e){return e.data});0===l.tasks.length&&l.empty(),a+=1,c.push(t[0]);var i=s(o(l,t));e(n,i)}},length:function(){return l.tasks.length},running:function(){return a},workersList:function(){return c},idle:function(){return l.tasks.length+a===0},pause:function(){l.paused=!0},resume:function(){if(!1!==l.paused){l.paused=!1;for(var e=Math.min(l.concurrency,l.tasks.length),t=1;t<=e;t++)F.setImmediate(l.process)}}};return l}function I(e){return v(function(t,n){t.apply(null,n.concat([v(function(t,n){"object"==typeof console&&(t?console.error&&console.error(t):console[e]&&u(n,function(t){console[e](t)}))})]))})}function L(e){return function(t,n,i){e(d(t),n,i)}}function D(e){return v(function(t,n){var i=v(function(n){var i=this,r=n.pop();return e(t,function(e,t,r){e.apply(i,n.concat([r]))},r)});return n.length?i.apply(this,n):i})}function O(e){return v(function(t){var n=t.pop();t.push(function(){var e=arguments
;i?F.setImmediate(function(){n.apply(null,e)}):n.apply(null,e)});var i=!0;e.apply(this,t),i=!1})}var k,F={},B="object"==typeof self&&self.self===self&&self||"object"==typeof n&&n.global===n&&n||this;null!=B&&(k=B.async),F.noConflict=function(){return B.async=k,F};var N=Object.prototype.toString,U=Array.isArray||function(e){return"[object Array]"===N.call(e)},z=Object.keys||function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t},G="function"==typeof setImmediate&&setImmediate,H=G?function(e){G(e)}:function(e){setTimeout(e,0)};"object"==typeof e&&"function"==typeof e.nextTick?F.nextTick=e.nextTick:F.nextTick=H,F.setImmediate=G?H:F.nextTick,F.forEach=F.each=function(e,t,n){return F.eachOf(e,y(t),n)},F.forEachSeries=F.eachSeries=function(e,t,n){return F.eachOfSeries(e,y(t),n)},F.forEachLimit=F.eachLimit=function(e,t,n,i){return b(t)(e,y(n),i)},F.forEachOf=F.eachOf=function(e,t,n){function r(e){l--,e?n(e):null===o&&l<=0&&n(null)}n=c(n||i);for(var o,a=g(e=e||[]),l=0;null!=(o=a());)l+=1,t(e[o],o,s(r));0===l&&n(null)},F.forEachOfSeries=F.eachOfSeries=function(e,t,n){n=c(n||i);var r=g(e=e||[]),o=r();!function i(){var a=!0;if(null===o)return n(null);t(e[o],o,s(function(e){if(e)n(e);else{if(null===(o=r()))return n(null);a?F.setImmediate(i):i()}})),a=!1}()},F.forEachOfLimit=F.eachOfLimit=function(e,t,n,i){b(t)(e,n,i)},F.map=w(S),F.mapSeries=E(S),F.mapLimit=x(S),F.inject=F.foldl=F.reduce=function(e,t,n,i){F.eachOfSeries(e,function(e,i,r){n(t,e,function(e,n){t=n,r(e)})},function(e){i(e,t)})},F.foldr=F.reduceRight=function(e,t,n,i){var o=h(e,r).reverse();F.reduce(o,t,n,i)},F.transform=function(e,t,n,i){3===arguments.length&&(i=n,n=t,t=U(e)?[]:{}),F.eachOf(e,function(e,i,r){n(t,e,i,r)},function(e){i(e,t)})},F.select=F.filter=w(_),F.selectLimit=F.filterLimit=x(_),F.selectSeries=F.filterSeries=E(_),F.reject=w(T),F.rejectLimit=x(T),F.rejectSeries=E(T),F.any=F.some=M(F.eachOf,o,r),F.someLimit=M(F.eachOfLimit,o,r),F.all=F.every=M(F.eachOf,a,a),F.everyLimit=M(F.eachOfLimit,a,a),F.detect=M(F.eachOf,r,C),F.detectSeries=M(F.eachOfSeries,r,C),F.detectLimit=M(F.eachOfLimit,r,C),F.sortBy=function(e,t,n){function i(e,t){var n=e.criteria,i=t.criteria;return n<i?-1:n>i?1:0}F.map(e,function(e,n){t(e,function(t,i){t?n(t):n(null,{value:e,criteria:i})})},function(e,t){if(e)return n(e);n(null,h(t.sort(i),function(e){return e.value}))})},F.auto=function(e,t,n){function r(e){y.unshift(e)}function o(e){var t=m(y,e);t>=0&&y.splice(t,1)}function a(){l--,u(y.slice(0),function(e){e()})}"function"==typeof arguments[1]&&(n=t,t=null),n=c(n||i);var s=z(e),l=s.length;if(!l)return n(null);t||(t=l);var h={},d=0,g=!1,y=[];r(function(){l||n(null,h)}),u(s,function(i){function s(){return d<t&&p(y,function(e,t){return e&&h.hasOwnProperty(t)},!0)&&!h.hasOwnProperty(i)}if(!g){for(var c,l=U(e[i])?e[i]:[e[i]],u=v(function(e,t){if(d--,t.length<=1&&(t=t[0]),e){var r={};f(h,function(e,t){r[t]=e}),r[i]=t,g=!0,n(e,r)}else h[i]=t,F.setImmediate(a)}),y=l.slice(0,l.length-1),b=y.length;b--;){if(!(c=e[y[b]]))throw new Error("Has nonexistent dependency in "+y.join(", "));if(U(c)&&m(c,i)>=0)throw new Error("Has cyclic dependencies")}s()?(d++,l[l.length-1](u,h)):r(function e(){s()&&(d++,o(e),l[l.length-1](u,h))})}})},F.retry=function(e,t,n){function i(e,t){if("number"==typeof t)e.times=parseInt(t,10)||o;else{if("object"!=typeof t)throw new Error("Unsupported argument type for 'times': "+typeof t);e.times=parseInt(t.times,10)||o,e.interval=parseInt(t.interval,10)||a}}function r(e,t){function n(e,n){return function(i){e(function(e,t){i(!e||n,{err:e,result:t})},t)}}function i(e){return function(t){setTimeout(function(){t(null)},e)}}for(;c.times;){var r=!(c.times-=1);s.push(n(c.task,r)),!r&&c.interval>0&&s.push(i(c.interval))}F.series(s,function(t,n){n=n[n.length-1],(e||c.callback)(n.err,n.result)})}var o=5,a=0,s=[],c={times:o,interval:a},l=arguments.length;if(l<1||l>3)throw new Error("Invalid arguments - must be either (task), (task, callback), (times, task) or (times, task, callback)");return l<=2&&"function"==typeof e&&(n=t,t=e),"function"!=typeof e&&i(c,e),c.callback=n,c.task=t,c.callback?r():r},F.waterfall=function(e,t){if(t=c(t||i),!U(e)){var n=new Error("First argument to waterfall must be an array of functions");return t(n)}if(!e.length)return t();!function e(n){return v(function(i,r){if(i)t.apply(null,[i].concat(r));else{var o=n.next();o?r.push(e(o)):r.push(t),O(n).apply(null,r)}})}(F.iterator(e))()},F.parallel=function(e,t){A(F.eachOf,e,t)},F.parallelLimit=function(e,t,n){A(b(t),e,n)},F.series=function(e,t){A(F.eachOfSeries,e,t)},F.iterator=function(e){return function t(n){function i(){return e.length&&e[n].apply(null,arguments),i.next()}return i.next=function(){return n<e.length-1?t(n+1):null},i}(0)},F.apply=v(function(e,t){return v(function(n){return e.apply(null,t.concat(n))})}),F.concat=w(R),F.concatSeries=E(R),F.whilst=function(e,t,n){if(n=n||i,e()){var r=v(function(i,o){i?n(i):e.apply(this,o)?t(r):n.apply(null,[null].concat(o))});t(r)}else n(null)},F.doWhilst=function(e,t,n){var i=0;return F.whilst(function(){return++i<=1||t.apply(this,arguments)},e,n)},F.until=function(e,t,n){return F.whilst(function(){return!e.apply(this,arguments)},t,n)},F.doUntil=function(e,t,n){return F.doWhilst(e,function(){return!t.apply(this,arguments)},n)},F.during=function(e,t,n){n=n||i;var r=v(function(t,i){t?n(t):(i.push(o),e.apply(this,i))}),o=function(e,i){e?n(e):i?t(r):n(null)};e(o)},F.doDuring=function(e,t,n){var i=0;F.during(function(e){i++<1?e(null,!0):t.apply(this,arguments)},e,n)},F.queue=function(e,t){return P(function(t,n){e(t[0],n)},t,1)},F.priorityQueue=function(e,t){function n(e,t){return e.priority-t.priority}var r=F.queue(e,t);return r.push=function(e,t,o){!function(e,t,r,o){if(null!=o&&"function"!=typeof o)throw new Error("task callback must be a function");if(e.started=!0,U(t)||(t=[t]),0===t.length)return F.setImmediate(function(){e.drain()});u(t,function(t){var a={data:t,priority:r,callback:"function"==typeof o?o:i};e.tasks.splice(function(e,t,n){for(var i=-1,r=e.length-1;i<r;){var o=i+(r-i+1>>>1);n(t,e[o])>=0?i=o:r=o-1}return i}(e.tasks,a,n)+1,0,a),e.tasks.length===e.concurrency&&e.saturated(),F.setImmediate(e.process)})}(r,e,t,o)},delete r.unshift,r},F.cargo=function(e,t){return P(e,1,t)},F.log=I("log"),F.dir=I("dir"),F.memoize=function(e,t){var n={},i={},o=Object.prototype.hasOwnProperty;t=t||r;var a=v(function(r){var a=r.pop(),s=t.apply(null,r);o.call(n,s)?F.setImmediate(function(){a.apply(null,n[s])}):o.call(i,s)?i[s].push(a):(i[s]=[a],e.apply(null,r.concat([v(function(e){n[s]=e;var t=i[s];delete i[s];for(var r=0,o=t.length;r<o;r++)t[r].apply(null,e)})])))});return a.memo=n,a.unmemoized=e,a},F.unmemoize=function(e){return function(){return(e.unmemoized||e).apply(null,arguments)}},F.times=L(F.map),F.timesSeries=L(F.mapSeries),F.timesLimit=function(e,t,n,i){return F.mapLimit(d(e),t,n,i)},F.seq=function(){var e=arguments;return v(function(t){var n=this,r=t[t.length-1];"function"==typeof r?t.pop():r=i,F.reduce(e,t,function(e,t,i){t.apply(n,e.concat([v(function(e,t){i(e,t)})]))},function(e,t){r.apply(n,[e].concat(t))})})},F.compose=function(){return F.seq.apply(null,Array.prototype.reverse.call(arguments))},F.applyEach=D(F.eachOf),F.applyEachSeries=D(F.eachOfSeries),F.forever=function(e,t){var n=s(t||i),r=O(e);!function e(t){if(t)return n(t);r(e)}()},F.ensureAsync=O,F.constant=v(function(e){var t=[null].concat(e);return function(e){return e.apply(this,t)}}),F.wrapSync=F.asyncify=function(e){return v(function(t){var n,i,r,o=t.pop();try{n=e.apply(this,t)}catch(e){return o(e)}("function"==(r=typeof(i=n))||"object"===r&&i)&&"function"==typeof n.then?n.then(function(e){o(null,e)}).catch(function(e){o(e.message?e:new Error(e))}):o(null,n)})},"object"==typeof t&&t.exports?t.exports=F:B.async=F}()}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:3}],2:[function(e,t,n){(function(e){function t(e,t){for(var n=0,i=e.length-1;i>=0;i--){var r=e[i];"."===r?e.splice(i,1):".."===r?(e.splice(i,1),n++):n&&(e.splice(i,1),n--)}if(t)for(;n--;n)e.unshift("..");return e}function i(e,t){if(e.filter)return e.filter(t);for(var n=[],i=0;i<e.length;i++)t(e[i],i,e)&&n.push(e[i]);return n}var r=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,o=function(e){return r.exec(e).slice(1)};n.resolve=function(){for(var n="",r=!1,o=arguments.length-1;o>=-1&&!r;o--){var a=o>=0?arguments[o]:e.cwd();if("string"!=typeof a)throw new TypeError("Arguments to path.resolve must be strings");a&&(n=a+"/"+n,r="/"===a.charAt(0))}return(r?"/":"")+(n=t(i(n.split("/"),function(e){return!!e}),!r).join("/"))||"."},n.normalize=function(e){var r=n.isAbsolute(e),o="/"===a(e,-1);return(e=t(i(e.split("/"),function(e){return!!e}),!r).join("/"))||r||(e="."),e&&o&&(e+="/"),(r?"/":"")+e},n.isAbsolute=function(e){return"/"===e.charAt(0)},n.join=function(){var e=Array.prototype.slice.call(arguments,0);return n.normalize(i(e,function(e,t){if("string"!=typeof e)throw new TypeError("Arguments to path.join must be strings");return e}).join("/"))},n.relative=function(e,t){function i(e){for(var t=0;t<e.length&&""===e[t];t++);for(var n=e.length-1;n>=0&&""===e[n];n--);return t>n?[]:e.slice(t,n-t+1)}e=n.resolve(e).substr(1),t=n.resolve(t).substr(1);for(var r=i(e.split("/")),o=i(t.split("/")),a=Math.min(r.length,o.length),s=a,c=0;c<a;c++)if(r[c]!==o[c]){s=c;break}var l=[];for(c=s;c<r.length;c++)l.push("..");return(l=l.concat(o.slice(s))).join("/")},n.sep="/",n.delimiter=":",n.dirname=function(e){var t=o(e),n=t[0],i=t[1];return n||i?(i&&(i=i.substr(0,i.length-1)),n+i):"."},n.basename=function(e,t){var n=o(e)[2];return t&&n.substr(-1*t.length)===t&&(n=n.substr(0,n.length-t.length)),n},n.extname=function(e){return o(e)[3]};var a="b"==="ab".substr(-1)?function(e,t,n){return e.substr(t,n)}:function(e,t,n){return t<0&&(t=e.length+t),e.substr(t,n)}}).call(this,e("_process"))},{_process:3}],3:[function(e,t,n){function i(){u=!1,s.length?l=s.concat(l):h=-1,l.length&&r()}function r(){if(!u){var e=setTimeout(i);u=!0;for(var t=l.length;t;){for(s=l,l=[];++h<t;)s&&s[h].run();h=-1,t=l.length}s=null,u=!1,clearTimeout(e)}}function o(e,t){this.fun=e,this.array=t}function a(){}var s,c=t.exports={},l=[],u=!1,h=-1;c.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.push(new o(e,t)),1!==l.length||u||setTimeout(r,0)},o.prototype.run=function(){this.fun.apply(null,this.array)},c.title="browser",c.browser=!0,c.env={},c.argv=[],c.version="",c.versions={},c.on=a,c.addListener=a,c.once=a,c.off=a,c.removeListener=a,c.removeAllListeners=a,c.emit=a,c.binding=function(e){throw new Error("process.binding is not supported")},c.cwd=function(){return"/"},c.chdir=function(e){throw new Error("process.chdir is not supported")},c.umask=function(){return 0}},{}],4:[function(e,t,n){(function(e){!function(i){function r(e){throw new RangeError(E[e])}function o(e,t){for(var n=e.length,i=[];n--;)i[n]=t(e[n]);return i}function a(e,t){var n=e.split("@"),i="";return n.length>1&&(i=n[0]+"@",e=n[1]),i+o((e=e.replace(x,".")).split("."),t).join(".")}function s(e){for(var t,n,i=[],r=0,o=e.length;r<o;)(t=e.charCodeAt(r++))>=55296&&t<=56319&&r<o?56320==(64512&(n=e.charCodeAt(r++)))?i.push(((1023&t)<<10)+(1023&n)+65536):(i.push(t),r--):i.push(t);return i}function c(e){return o(e,function(e){var t="";return e>65535&&(t+=_((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+_(e)}).join("")}function l(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function u(e,t,n){var i=0;for(e=n?S(e/700):e>>1,e+=S(e/t);e>455;i+=36)e=S(e/35);return S(i+36*e/(e+38))}function h(e){var t,n,i,o,a,s,l,h,d,p,f,m=[],g=e.length,v=0,b=128,w=72;for((n=e.lastIndexOf("-"))<0&&(n=0),i=0;i<n;++i)e.charCodeAt(i)>=128&&r("not-basic"),m.push(e.charCodeAt(i));for(o=n>0?n+1:0;o<g;){for(a=v,s=1,l=36;o>=g&&r("invalid-input"),((h=(f=e.charCodeAt(o++))-48<10?f-22:f-65<26?f-65:f-97<26?f-97:36)>=36||h>S((y-v)/s))&&r("overflow"),v+=h*s,!(h<(d=l<=w?1:l>=w+26?26:l-w));l+=36)s>S(y/(p=36-d))&&r("overflow"),s*=p;w=u(v-a,t=m.length+1,0==a),S(v/t)>y-b&&r("overflow"),b+=S(v/t),v%=t,m.splice(v++,0,b)}return c(m)}function d(e){var t,n,i,o,a,c,h,d,p,f,m,g,v,b,w,x=[];for(g=(e=s(e)).length,t=128,n=0,a=72,c=0;c<g;++c)(m=e[c])<128&&x.push(_(m));for(i=o=x.length,o&&x.push("-");i<g;){for(h=y,c=0;c<g;++c)(m=e[c])>=t&&m<h&&(h=m);for(h-t>S((y-n)/(v=i+1))&&r("overflow"),n+=(h-t)*v,t=h,c=0;c<g;++c)if((m=e[c])<t&&++n>y&&r("overflow"),m==t){for(d=n,p=36;!(d<(f=p<=a?1:p>=a+26?26:p-a));p+=36)w=d-f,b=36-f,x.push(_(l(f+w%b,0))),d=S(w/b);x.push(_(l(d,0))),a=u(n,v,i==o),n=0,++i}++n,++t}return x.join("")}var p="object"==typeof n&&n&&!n.nodeType&&n,f="object"==typeof t&&t&&!t.nodeType&&t,m="object"==typeof e&&e;m.global!==m&&m.window!==m&&m.self!==m||(i=m);var g,v,y=2147483647,b=/^xn--/,w=/[^\x20-\x7E]/,x=/[\x2E\u3002\uFF0E\uFF61]/g,E={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},S=Math.floor,_=String.fromCharCode;if(g={version:"1.3.2",ucs2:{decode:s,encode:c},decode:h,encode:d,toASCII:function(e){return a(e,function(e){return w.test(e)?"xn--"+d(e):e})},toUnicode:function(e){return a(e,function(e){return b.test(e)?h(e.slice(4).toLowerCase()):e})}},p&&f)if(t.exports==p)f.exports=g;else for(v in g)g.hasOwnProperty(v)&&(p[v]=g[v]);else i.punycode=g}(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],5:[function(e,t,n){"use strict";function i(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.exports=function(e,t,n,o){t=t||"&",n=n||"=";var a={};if("string"!=typeof e||0===e.length)return a;var s=/\+/g;e=e.split(t);var c=1e3;o&&"number"==typeof o.maxKeys&&(c=o.maxKeys);var l=e.length;c>0&&l>c&&(l=c);for(var u=0;u<l;++u){var h,d,p,f,m=e[u].replace(s,"%20"),g=m.indexOf(n);g>=0?(h=m.substr(0,g),d=m.substr(g+1)):(h=m,d=""),p=decodeURIComponent(h),f=decodeURIComponent(d),i(a,p)?r(a[p])?a[p].push(f):a[p]=[a[p],f]:a[p]=f}return a};var r=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},{}],6:[function(e,t,n){"use strict";function i(e,t){if(e.map)return e.map(t);for(var n=[],i=0;i<e.length;i++)n.push(t(e[i],i));return n}var r=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};t.exports=function(e,t,n,s){return t=t||"&",n=n||"=",null===e&&(e=void 0),"object"==typeof e?i(a(e),function(a){var s=encodeURIComponent(r(a))+n;return o(e[a])?i(e[a],function(e){return s+encodeURIComponent(r(e))}).join(t):s+encodeURIComponent(r(e[a]))}).join(t):s?encodeURIComponent(r(s))+n+encodeURIComponent(r(e)):""};var o=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},a=Object.keys||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t}},{}],7:[function(e,t,n){"use strict";n.decode=n.parse=e("./decode"),n.encode=n.stringify=e("./encode")},{"./decode":5,"./encode":6}],8:[function(e,t,n){function i(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}function r(e,t,n){if(e&&a(e)&&e instanceof i)return e;var r=new i;return r.parse(e,t,n),r}function o(e){return"string"==typeof e}function a(e){return"object"==typeof e&&null!==e}function s(e){return null===e}var c=e("punycode");n.parse=r,n.resolve=function(e,t){return r(e,!1,!0).resolve(t)},n.resolveObject=function(e,t){return e?r(e,!1,!0).resolveObject(t):t},n.format=function(e){return o(e)&&(e=r(e)),e instanceof i?e.format():i.prototype.format.call(e)},n.Url=i;var l=/^([a-z0-9.+-]+:)/i,u=/:[0-9]*$/,h=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),d=["'"].concat(h),p=["%","/","?",";","#"].concat(d),f=["/","?","#"],m=/^[a-z0-9A-Z_-]{0,63}$/,g=/^([a-z0-9A-Z_-]{0,63})(.*)$/,v={javascript:!0,"javascript:":!0},y={javascript:!0,"javascript:":!0},b={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},w=e("querystring");i.prototype.parse=function(e,t,n){if(!o(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var i=e;i=i.trim();var r=l.exec(i);if(r){var a=(r=r[0]).toLowerCase();this.protocol=a,i=i.substr(r.length)}if(n||r||i.match(/^\/\/[^@\/]+@[^@\/]+/)){var s="//"===i.substr(0,2);!s||r&&y[r]||(i=i.substr(2),this.slashes=!0)}if(!y[r]&&(s||r&&!b[r])){for(var u,h,x=-1,E=0;E<f.length;E++)-1!==(S=i.indexOf(f[E]))&&(-1===x||S<x)&&(x=S);for(-1!==(h=-1===x?i.lastIndexOf("@"):i.lastIndexOf("@",x))&&(u=i.slice(0,h),i=i.slice(h+1),this.auth=decodeURIComponent(u)),x=-1,E=0;E<p.length;E++){var S;-1!==(S=i.indexOf(p[E]))&&(-1===x||S<x)&&(x=S)}-1===x&&(x=i.length),this.host=i.slice(0,x),i=i.slice(x),this.parseHost(),this.hostname=this.hostname||"";var _="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!_)for(var T=this.hostname.split(/\./),M=(E=0,T.length);E<M;E++){var C=T[E];if(C&&!C.match(m)){for(var A="",R=0,P=C.length;R<P;R++)C.charCodeAt(R)>127?A+="x":A+=C[R];if(!A.match(m)){var I=T.slice(0,E),L=T.slice(E+1),D=C.match(g);D&&(I.push(D[1]),L.unshift(D[2])),L.length&&(i="/"+L.join(".")+i),this.hostname=I.join(".");break}}}if(this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),!_){var O=this.hostname.split("."),k=[];for(E=0;E<O.length;++E){var F=O[E];k.push(F.match(/[^A-Za-z0-9_-]/)?"xn--"+c.encode(F):F)}this.hostname=k.join(".")}var B=this.port?":"+this.port:"",N=this.hostname||"";this.host=N+B,this.href+=this.host,_&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==i[0]&&(i="/"+i))}if(!v[a])for(E=0,M=d.length;E<M;E++){var U=d[E],z=encodeURIComponent(U);z===U&&(z=escape(U)),i=i.split(U).join(z)}var G=i.indexOf("#");-1!==G&&(this.hash=i.substr(G),i=i.slice(0,G));var H=i.indexOf("?");return-1!==H?(this.search=i.substr(H),this.query=i.substr(H+1),t&&(this.query=w.parse(this.query)),i=i.slice(0,H)):t&&(this.search="",this.query={}),i&&(this.pathname=i),b[a]&&this.hostname&&!this.pathname&&(this.pathname="/"),(this.pathname||this.search)&&(B=this.pathname||"",F=this.search||"",this.path=B+F),this.href=this.format(),this},i.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",n=this.pathname||"",i=this.hash||"",r=!1,o="";this.host?r=e+this.host:this.hostname&&(r=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(r+=":"+this.port)),this.query&&a(this.query)&&Object.keys(this.query).length&&(o=w.stringify(this.query));var s=this.search||o&&"?"+o||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||b[t])&&!1!==r?(r="//"+(r||""),n&&"/"!==n.charAt(0)&&(n="/"+n)):r||(r=""),i&&"#"!==i.charAt(0)&&(i="#"+i),s&&"?"!==s.charAt(0)&&(s="?"+s),t+r+(n=n.replace(/[?#]/g,function(e){return encodeURIComponent(e)}))+(s=s.replace("#","%23"))+i},i.prototype.resolve=function(e){return this.resolveObject(r(e,!1,!0)).format()},i.prototype.resolveObject=function(e){if(o(e)){var t=new i;t.parse(e,!1,!0),e=t}var n=new i;if(Object.keys(this).forEach(function(e){n[e]=this[e]},this),n.hash=e.hash,""===e.href)return n.href=n.format(),n;if(e.slashes&&!e.protocol)return Object.keys(e).forEach(function(t){"protocol"!==t&&(n[t]=e[t])}),b[n.protocol]&&n.hostname&&!n.pathname&&(n.path=n.pathname="/"),n.href=n.format(),n;if(e.protocol&&e.protocol!==n.protocol){if(!b[e.protocol])return Object.keys(e).forEach(function(t){n[t]=e[t]}),n.href=n.format(),n;if(n.protocol=e.protocol,e.host||y[e.protocol])n.pathname=e.pathname;else{for(var r=(e.pathname||"").split("/");r.length&&!(e.host=r.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==r[0]&&r.unshift(""),r.length<2&&r.unshift(""),n.pathname=r.join("/")}if(n.search=e.search,n.query=e.query,n.host=e.host||"",n.auth=e.auth,n.hostname=e.hostname||e.host,n.port=e.port,n.pathname||n.search){var a=n.pathname||"",c=n.search||"";n.path=a+c}return n.slashes=n.slashes||e.slashes,n.href=n.format(),n}var l=n.pathname&&"/"===n.pathname.charAt(0),u=e.host||e.pathname&&"/"===e.pathname.charAt(0),h=u||l||n.host&&e.pathname,d=h,p=n.pathname&&n.pathname.split("/")||[],f=(r=e.pathname&&e.pathname.split("/")||[],n.protocol&&!b[n.protocol]);if(f&&(n.hostname="",n.port=null,n.host&&(""===p[0]?p[0]=n.host:p.unshift(n.host)),n.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===r[0]?r[0]=e.host:r.unshift(e.host)),e.host=null),h=h&&(""===r[0]||""===p[0])),u)n.host=e.host||""===e.host?e.host:n.host,n.hostname=e.hostname||""===e.hostname?e.hostname:n.hostname,n.search=e.search,n.query=e.query,p=r;else if(r.length)p||(p=[]),p.pop(),p=p.concat(r),n.search=e.search,n.query=e.query;else if(null!=e.search)return f&&(n.hostname=n.host=p.shift(),(x=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=x.shift(),n.host=n.hostname=x.shift())),n.search=e.search,n.query=e.query,s(n.pathname)&&s(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.href=n.format(),n;if(!p.length)return n.pathname=null,n.search?n.path="/"+n.search:n.path=null,n.href=n.format(),n;for(var m=p.slice(-1)[0],g=(n.host||e.host)&&("."===m||".."===m)||""===m,v=0,w=p.length;w>=0;w--)"."==(m=p[w])?p.splice(w,1):".."===m?(p.splice(w,1),v++):v&&(p.splice(w,1),v--);if(!h&&!d)for(;v--;v)p.unshift("..");!h||""===p[0]||p[0]&&"/"===p[0].charAt(0)||p.unshift(""),g&&"/"!==p.join("/").substr(-1)&&p.push("");var x,E=""===p[0]||p[0]&&"/"===p[0].charAt(0);return f&&(n.hostname=n.host=E?"":p.length?p.shift():"",(x=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=x.shift(),n.host=n.hostname=x.shift())),(h=h||n.host&&p.length)&&!E&&p.unshift(""),p.length?n.pathname=p.join("/"):(n.pathname=null,n.path=null),s(n.pathname)&&s(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.auth=e.auth||n.auth,n.slashes=n.slashes||e.slashes,n.href=n.format(),n},i.prototype.parseHost=function(){var e=this.host,t=u.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},{punycode:4,querystring:7}],9:[function(e,t,n){"use strict";function i(e,t,n,i,r){var o,a,s,c=0;for(o=t,a=n-i;o<n;o+=i)c+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;if(r===c>0)for(o=t;o<n;o+=i)s=x(o,e[o],e[o+1],s);else for(o=n-i;o>=t;o-=i)s=x(o,e[o],e[o+1],s);return s}function r(e,t){if(!e)return e;t||(t=e);var n,i=e;do{if(n=!1,i.steiner||!v(i,i.next)&&0!==g(i.prev,i,i.next))i=i.next;else{if(E(i),(i=t=i.prev)===i.next)return null;n=!0}}while(n||i!==t);return t}function o(e,t,n,i,u,h,p){if(e){!p&&h&&function(e,t,n,i){var r=e;do{null===r.z&&(r.z=d(r.x,r.y,t,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){var t,n,i,r,o,a,s,c,l=1;do{for(n=e,e=null,o=null,a=0;n;){for(a++,i=n,s=0,t=0;t<l&&(s++,i=i.nextZ);t++);for(c=l;s>0||c>0&&i;)0===s?(r=i,i=i.nextZ,c--):0!==c&&i?n.z<=i.z?(r=n,n=n.nextZ,s--):(r=i,i=i.nextZ,c--):(r=n,n=n.nextZ,s--),o?o.nextZ=r:e=r,r.prevZ=o,o=r;n=i}o.nextZ=null,l*=2}while(a>1)}(r)}(e,i,u,h);for(var f,m,g=e;e.prev!==e.next;)if(f=e.prev,m=e.next,h?s(e,i,u,h):a(e))t.push(f.i/n),t.push(e.i/n),t.push(m.i/n),E(e),e=m.next,g=m.next;else if((e=m)===g){p?1===p?o(e=c(e,t,n),t,n,i,u,h,2):2===p&&l(e,t,n,i,u,h):o(r(e),t,n,i,u,h,1);break}}}function a(e){var t=e.prev,n=e,i=e.next;if(g(t,n,i)>=0)return!1;for(var r=e.next.next;r!==e.prev;){if(f(t.x,t.y,n.x,n.y,i.x,i.y,r.x,r.y)&&g(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function s(e,t,n,i){var r=e.prev,o=e,a=e.next;if(g(r,o,a)>=0)return!1;for(var s=r.x<o.x?r.x<a.x?r.x:a.x:o.x<a.x?o.x:a.x,c=r.y<o.y?r.y<a.y?r.y:a.y:o.y<a.y?o.y:a.y,l=r.x>o.x?r.x>a.x?r.x:a.x:o.x>a.x?o.x:a.x,u=r.y>o.y?r.y>a.y?r.y:a.y:o.y>a.y?o.y:a.y,h=d(s,c,t,n,i),p=d(l,u,t,n,i),m=e.nextZ;m&&m.z<=p;){if(m!==e.prev&&m!==e.next&&f(r.x,r.y,o.x,o.y,a.x,a.y,m.x,m.y)&&g(m.prev,m,m.next)>=0)return!1;m=m.nextZ}for(m=e.prevZ;m&&m.z>=h;){if(m!==e.prev&&m!==e.next&&f(r.x,r.y,o.x,o.y,a.x,a.y,m.x,m.y)&&g(m.prev,m,m.next)>=0)return!1;m=m.prevZ}return!0}function c(e,t,n){var i=e;do{var r=i.prev,o=i.next.next;y(r,i,i.next,o)&&b(r,o)&&b(o,r)&&(t.push(r.i/n),t.push(i.i/n),t.push(o.i/n),E(i),E(i.next),i=e=o),i=i.next}while(i!==e);return i}function l(e,t,n,i,a,s){var c=e;do{for(var l=c.next.next;l!==c.prev;){if(c.i!==l.i&&m(c,l)){var u=w(c,l);return c=r(c,c.next),u=r(u,u.next),o(c,t,n,i,a,s),void o(u,t,n,i,a,s)}l=l.next}c=c.next}while(c!==e)}function u(e,t){return e.x-t.x}function h(e,t){if(t=function(e,t){var n,i=t,r=e.x,o=e.y,a=-1/0;do{if(o<=i.y&&o>=i.next.y){var s=i.x+(o-i.y)*(i.next.x-i.x)/(i.next.y-i.y);s<=r&&s>a&&(a=s,n=i.x<i.next.x?i:i.next)}i=i.next}while(i!==t);if(!n)return null;if(e.x===n.x)return n.prev;var c,l=n,u=1/0;for(i=n.next;i!==l;)r>=i.x&&i.x>=n.x&&f(o<n.y?r:a,o,n.x,n.y,o<n.y?a:r,o,i.x,i.y)&&((c=Math.abs(o-i.y)/(r-i.x))<u||c===u&&i.x>n.x)&&b(i,e)&&(n=i,u=c),i=i.next;return n}(e,t)){var n=w(t,e);r(n,n.next)}}function d(e,t,n,i,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)/r)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)/r)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function p(e){var t=e,n=e;do{t.x<n.x&&(n=t),t=t.next}while(t!==e);return n}function f(e,t,n,i,r,o,a,s){return(r-a)*(t-s)-(e-a)*(o-s)>=0&&(e-a)*(i-s)-(n-a)*(t-s)>=0&&(n-a)*(o-s)-(r-a)*(i-s)>=0}function m(e,t){return v(e,t)||e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&y(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&b(e,t)&&b(t,e)&&function(e,t){var n=e,i=!1,r=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!=n.next.y>o&&r<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==e);return i}(e,t)}function g(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function v(e,t){return e.x===t.x&&e.y===t.y}function y(e,t,n,i){return g(e,t,n)>0!=g(e,t,i)>0&&g(n,i,e)>0!=g(n,i,t)>0}function b(e,t){return g(e.prev,e,e.next)<0?g(e,t,e.next)>=0&&g(e,e.prev,t)>=0:g(e,t,e.prev)<0||g(e,e.next,t)<0}function w(e,t){var n=new S(e.i,e.x,e.y),i=new S(t.i,t.x,t.y),r=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=r,r.prev=n,i.next=n,n.prev=i,o.next=i,i.prev=o,i}function x(e,t,n,i){var r=new S(e,t,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function E(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function S(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}t.exports=function(e,t,n){n=n||2;var a,s,c,l,d,f,m,g=t&&t.length,v=g?t[0]*n:e.length,y=i(e,0,v,n,!0),b=[];if(!y)return b;if(g&&(y=function(e,t,n,o){var a,s,c,l,d,f=[];for(a=0,s=t.length;a<s;a++)c=t[a]*o,l=a<s-1?t[a+1]*o:e.length,(d=i(e,c,l,o,!1))===d.next&&(d.steiner=!0),f.push(p(d));for(f.sort(u),a=0;a<f.length;a++)h(f[a],n),n=r(n,n.next);return n}(e,t,y,n)),e.length>80*n){a=c=e[0],s=l=e[1];for(var w=n;w<v;w+=n)d=e[w],f=e[w+1],d<a&&(a=d),f<s&&(s=f),d>c&&(c=d),f>l&&(l=f);m=Math.max(c-a,l-s)}return o(y,b,n,a,s,m),b}},{}],10:[function(e,t,n){"use strict";function i(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function r(){}var o="function"!=typeof Object.create&&"~";r.prototype._events=void 0,r.prototype.listeners=function(e,t){var n=o?o+e:e,i=this._events&&this._events[n];if(t)return!!i;if(!i)return[];if(i.fn)return[i.fn];for(var r=0,a=i.length,s=new Array(a);r<a;r++)s[r]=i[r].fn;return s},r.prototype.emit=function(e,t,n,i,r,a){var s=o?o+e:e;if(!this._events||!this._events[s])return!1;var c,l,u=this._events[s],h=arguments.length;if("function"==typeof u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),h){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,n),!0;case 4:return u.fn.call(u.context,t,n,i),!0;case 5:return u.fn.call(u.context,t,n,i,r),!0;case 6:return u.fn.call(u.context,t,n,i,r,a),!0}for(l=1,c=new Array(h-1);l<h;l++)c[l-1]=arguments[l];u.fn.apply(u.context,c)}else{var d,p=u.length;for(l=0;l<p;l++)switch(u[l].once&&this.removeListener(e,u[l].fn,void 0,!0),h){case 1:u[l].fn.call(u[l].context);break;case 2:u[l].fn.call(u[l].context,t);break;case 3:u[l].fn.call(u[l].context,t,n);break;default:if(!c)for(d=1,c=new Array(h-1);d<h;d++)c[d-1]=arguments[d];u[l].fn.apply(u[l].context,c)}}return!0},r.prototype.on=function(e,t,n){var r=new i(t,n||this),a=o?o+e:e;return this._events||(this._events=o?{}:Object.create(null)),this._events[a]?this._events[a].fn?this._events[a]=[this._events[a],r]:this._events[a].push(r):this._events[a]=r,this},r.prototype.once=function(e,t,n){var r=new i(t,n||this,!0),a=o?o+e:e;return this._events||(this._events=o?{}:Object.create(null)),this._events[a]?this._events[a].fn?this._events[a]=[this._events[a],r]:this._events[a].push(r):this._events[a]=r,this},r.prototype.removeListener=function(e,t,n,i){var r=o?o+e:e;if(!this._events||!this._events[r])return this;var a=this._events[r],s=[];if(t)if(a.fn)(a.fn!==t||i&&!a.once||n&&a.context!==n)&&s.push(a);else for(var c=0,l=a.length;c<l;c++)(a[c].fn!==t||i&&!a[c].once||n&&a[c].context!==n)&&s.push(a[c]);return s.length?this._events[r]=1===s.length?s[0]:s:delete this._events[r],this},r.prototype.removeAllListeners=function(e){return this._events?(e?delete this._events[o?o+e:e]:this._events=o?{}:Object.create(null),this):this},r.prototype.off=r.prototype.removeListener,r.prototype.addListener=r.prototype.on,r.prototype.setMaxListeners=function(){return this},r.prefixed=o,void 0!==t&&(t.exports=r)},{}],11:[function(e,t,n){"use strict";function i(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}var r=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable;t.exports=Object.assign||function(e,t){for(var n,a,s=i(e),c=1;c<arguments.length;c++){for(var l in n=Object(arguments[c]))r.call(n,l)&&(s[l]=n[l]);if(Object.getOwnPropertySymbols){a=Object.getOwnPropertySymbols(n);for(var u=0;u<a.length;u++)o.call(n,a[u])&&(s[a[u]]=n[a[u]])}}return s}},{}],12:[function(e,t,n){(function(e){!function(){function n(e){var t=!1;return function(){if(t)throw new Error("Callback was already called.");t=!0,e.apply(i,arguments)}}var i,r,o={};null!=(i=this)&&(r=i.async),o.noConflict=function(){return i.async=r,o};var a=Object.prototype.toString,s=Array.isArray||function(e){return"[object Array]"===a.call(e)},c=function(e,t){for(var n=0;n<e.length;n+=1)t(e[n],n,e)},l=function(e,t){if(e.map)return e.map(t);var n=[];return c(e,function(e,i,r){n.push(t(e,i,r))}),n},u=function(e){if(Object.keys)return Object.keys(e);var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t};void 0!==e&&e.nextTick?(o.nextTick=e.nextTick,"undefined"!=typeof setImmediate?o.setImmediate=function(e){setImmediate(e)}:o.setImmediate=o.nextTick):"function"==typeof setImmediate?(o.nextTick=function(e){setImmediate(e)},o.setImmediate=o.nextTick):(o.nextTick=function(e){setTimeout(e,0)},o.setImmediate=o.nextTick),o.each=function(e,t,i){function r(t){t?(i(t),i=function(){}):(o+=1)>=e.length&&i()}if(i=i||function(){},!e.length)return i();var o=0;c(e,function(e){t(e,n(r))})},o.forEach=o.each,o.eachSeries=function(e,t,n){if(n=n||function(){},!e.length)return n();var i=0,r=function(){t(e[i],function(t){t?(n(t),n=function(){}):(i+=1)>=e.length?n():r()})};r()},o.forEachSeries=o.eachSeries,o.eachLimit=function(e,t,n,i){h(t).apply(null,[e,n,i])},o.forEachLimit=o.eachLimit;var h=function(e){return function(t,n,i){if(i=i||function(){},!t.length||e<=0)return i();var r=0,o=0,a=0;!function s(){if(r>=t.length)return i();for(;a<e&&o<t.length;)a+=1,n(t[(o+=1)-1],function(e){e?(i(e),i=function(){}):(a-=1,(r+=1)>=t.length?i():s())})}()}},d=function(e){return function(){var t=Array.prototype.slice.call(arguments)
;return e.apply(null,[o.each].concat(t))}},p=function(e){return function(){var t=Array.prototype.slice.call(arguments);return e.apply(null,[o.eachSeries].concat(t))}},f=function(e,t,n,i){if(t=l(t,function(e,t){return{index:t,value:e}}),i){var r=[];e(t,function(e,t){n(e.value,function(n,i){r[e.index]=i,t(n)})},function(e){i(e,r)})}else e(t,function(e,t){n(e.value,function(e){t(e)})})};o.map=d(f),o.mapSeries=p(f),o.mapLimit=function(e,t,n,i){return m(t)(e,n,i)};var m=function(e){return function(e,t){return function(){var n=Array.prototype.slice.call(arguments);return t.apply(null,[h(e)].concat(n))}}(e,f)};o.reduce=function(e,t,n,i){o.eachSeries(e,function(e,i){n(t,e,function(e,n){t=n,i(e)})},function(e){i(e,t)})},o.inject=o.reduce,o.foldl=o.reduce,o.reduceRight=function(e,t,n,i){var r=l(e,function(e){return e}).reverse();o.reduce(r,t,n,i)},o.foldr=o.reduceRight;var g=function(e,t,n,i){var r=[];e(t=l(t,function(e,t){return{index:t,value:e}}),function(e,t){n(e.value,function(n){n&&r.push(e),t()})},function(e){i(l(r.sort(function(e,t){return e.index-t.index}),function(e){return e.value}))})};o.filter=d(g),o.filterSeries=p(g),o.select=o.filter,o.selectSeries=o.filterSeries;var v=function(e,t,n,i){var r=[];e(t=l(t,function(e,t){return{index:t,value:e}}),function(e,t){n(e.value,function(n){n||r.push(e),t()})},function(e){i(l(r.sort(function(e,t){return e.index-t.index}),function(e){return e.value}))})};o.reject=d(v),o.rejectSeries=p(v);var y=function(e,t,n,i){e(t,function(e,t){n(e,function(n){n?(i(e),i=function(){}):t()})},function(e){i()})};o.detect=d(y),o.detectSeries=p(y),o.some=function(e,t,n){o.each(e,function(e,i){t(e,function(e){e&&(n(!0),n=function(){}),i()})},function(e){n(!1)})},o.any=o.some,o.every=function(e,t,n){o.each(e,function(e,i){t(e,function(e){e||(n(!1),n=function(){}),i()})},function(e){n(!0)})},o.all=o.every,o.sortBy=function(e,t,n){o.map(e,function(e,n){t(e,function(t,i){t?n(t):n(null,{value:e,criteria:i})})},function(e,t){if(e)return n(e);n(null,l(t.sort(function(e,t){var n=e.criteria,i=t.criteria;return n<i?-1:n>i?1:0}),function(e){return e.value}))})},o.auto=function(e,t){t=t||function(){};var n=u(e),i=n.length;if(!i)return t();var r={},a=[],l=function(e){a.unshift(e)},h=function(){i--,c(a.slice(0),function(e){e()})};l(function(){if(!i){var e=t;t=function(){},e(null,r)}}),c(n,function(n){var i=s(e[n])?e[n]:[e[n]],d=function(e){var i=Array.prototype.slice.call(arguments,1);if(i.length<=1&&(i=i[0]),e){var a={};c(u(r),function(e){a[e]=r[e]}),a[n]=i,t(e,a),t=function(){}}else r[n]=i,o.setImmediate(h)},p=i.slice(0,Math.abs(i.length-1))||[],f=function(){return t=function(e,t){return e&&r.hasOwnProperty(t)},i=!0,((e=p).reduce?e.reduce(t,i):(c(e,function(e,n,r){i=t(i,e,n,r)}),i))&&!r.hasOwnProperty(n);var e,t,i};if(f())i[i.length-1](d,r);else{var m=function(){f()&&(function(e){for(var t=0;t<a.length;t+=1)if(a[t]===e)return void a.splice(t,1)}(m),i[i.length-1](d,r))};l(m)}})},o.retry=function(e,t,n){var i=[];"function"==typeof e&&(n=t,t=e,e=5),e=parseInt(e,10)||5;var r=function(r,a){for(var s=function(e,t){return function(n){e(function(e,i){n(!e||t,{err:e,result:i})},a)}};e;)i.push(s(t,!(e-=1)));o.series(i,function(e,t){t=t[t.length-1],(r||n)(t.err,t.result)})};return n?r():r},o.waterfall=function(e,t){if(t=t||function(){},!s(e)){var n=new Error("First argument to waterfall must be an array of functions");return t(n)}if(!e.length)return t();var i=function(e){return function(n){if(n)t.apply(null,arguments),t=function(){};else{var r=Array.prototype.slice.call(arguments,1),a=e.next();a?r.push(i(a)):r.push(t),o.setImmediate(function(){e.apply(null,r)})}}};i(o.iterator(e))()};var b=function(e,t,n){if(n=n||function(){},s(t))e.map(t,function(e,t){e&&e(function(e){var n=Array.prototype.slice.call(arguments,1);n.length<=1&&(n=n[0]),t.call(null,e,n)})},n);else{var i={};e.each(u(t),function(e,n){t[e](function(t){var r=Array.prototype.slice.call(arguments,1);r.length<=1&&(r=r[0]),i[e]=r,n(t)})},function(e){n(e,i)})}};o.parallel=function(e,t){b({map:o.map,each:o.each},e,t)},o.parallelLimit=function(e,t,n){b({map:m(t),each:h(t)},e,n)},o.series=function(e,t){if(t=t||function(){},s(e))o.mapSeries(e,function(e,t){e&&e(function(e){var n=Array.prototype.slice.call(arguments,1);n.length<=1&&(n=n[0]),t.call(null,e,n)})},t);else{var n={};o.eachSeries(u(e),function(t,i){e[t](function(e){var r=Array.prototype.slice.call(arguments,1);r.length<=1&&(r=r[0]),n[t]=r,i(e)})},function(e){t(e,n)})}},o.iterator=function(e){var t=function(n){var i=function(){return e.length&&e[n].apply(null,arguments),i.next()};return i.next=function(){return n<e.length-1?t(n+1):null},i};return t(0)},o.apply=function(e){var t=Array.prototype.slice.call(arguments,1);return function(){return e.apply(null,t.concat(Array.prototype.slice.call(arguments)))}};var w=function(e,t,n,i){var r=[];e(t,function(e,t){n(e,function(e,n){r=r.concat(n||[]),t(e)})},function(e){i(e,r)})};o.concat=d(w),o.concatSeries=p(w),o.whilst=function(e,t,n){e()?t(function(i){if(i)return n(i);o.whilst(e,t,n)}):n()},o.doWhilst=function(e,t,n){e(function(i){if(i)return n(i);var r=Array.prototype.slice.call(arguments,1);t.apply(null,r)?o.doWhilst(e,t,n):n()})},o.until=function(e,t,n){e()?n():t(function(i){if(i)return n(i);o.until(e,t,n)})},o.doUntil=function(e,t,n){e(function(i){if(i)return n(i);var r=Array.prototype.slice.call(arguments,1);t.apply(null,r)?n():o.doUntil(e,t,n)})},o.queue=function(e,t){function i(e,t,n,i){if(e.started||(e.started=!0),s(t)||(t=[t]),0==t.length)return o.setImmediate(function(){e.drain&&e.drain()});c(t,function(t){var r={data:t,callback:"function"==typeof i?i:null};n?e.tasks.unshift(r):e.tasks.push(r),e.saturated&&e.tasks.length===e.concurrency&&e.saturated(),o.setImmediate(e.process)})}void 0===t&&(t=1);var r=0,a={tasks:[],concurrency:t,saturated:null,empty:null,drain:null,started:!1,paused:!1,push:function(e,t){i(a,e,!1,t)},kill:function(){a.drain=null,a.tasks=[]},unshift:function(e,t){i(a,e,!0,t)},process:function(){if(!a.paused&&r<a.concurrency&&a.tasks.length){var t=a.tasks.shift();a.empty&&0===a.tasks.length&&a.empty(),r+=1;var i=n(function(){r-=1,t.callback&&t.callback.apply(t,arguments),a.drain&&a.tasks.length+r===0&&a.drain(),a.process()});e(t.data,i)}},length:function(){return a.tasks.length},running:function(){return r},idle:function(){return a.tasks.length+r===0},pause:function(){!0!==a.paused&&(a.paused=!0)},resume:function(){if(!1!==a.paused){a.paused=!1;for(var e=1;e<=a.concurrency;e++)o.setImmediate(a.process)}}};return a},o.priorityQueue=function(e,t){function n(e,t){return e.priority-t.priority}var i=o.queue(e,t);return i.push=function(e,t,r){!function(e,t,i,r){if(e.started||(e.started=!0),s(t)||(t=[t]),0==t.length)return o.setImmediate(function(){e.drain&&e.drain()});c(t,function(t){var a={data:t,priority:i,callback:"function"==typeof r?r:null};e.tasks.splice(function(e,t,n){for(var i=-1,r=e.length-1;i<r;){var o=i+(r-i+1>>>1);n(t,e[o])>=0?i=o:r=o-1}return i}(e.tasks,a,n)+1,0,a),e.saturated&&e.tasks.length===e.concurrency&&e.saturated(),o.setImmediate(e.process)})}(i,e,t,r)},delete i.unshift,i},o.cargo=function(e,t){var n=!1,i=[],r={tasks:i,payload:t,saturated:null,empty:null,drain:null,drained:!0,push:function(e,n){s(e)||(e=[e]),c(e,function(e){i.push({data:e,callback:"function"==typeof n?n:null}),r.drained=!1,r.saturated&&i.length===t&&r.saturated()}),o.setImmediate(r.process)},process:function o(){if(!n){if(0===i.length)return r.drain&&!r.drained&&r.drain(),void(r.drained=!0);var a="number"==typeof t?i.splice(0,t):i.splice(0,i.length),s=l(a,function(e){return e.data});r.empty&&r.empty(),n=!0,e(s,function(){n=!1;var e=arguments;c(a,function(t){t.callback&&t.callback.apply(null,e)}),o()})}},length:function(){return i.length},running:function(){return n}};return r};var x=function(e){return function(t){var n=Array.prototype.slice.call(arguments,1);t.apply(null,n.concat([function(t){var n=Array.prototype.slice.call(arguments,1);"undefined"!=typeof console&&(t?console.error&&console.error(t):console[e]&&c(n,function(t){console[e](t)}))}]))}};o.log=x("log"),o.dir=x("dir"),o.memoize=function(e,t){var n={},i={};t=t||function(e){return e};var r=function(){var r=Array.prototype.slice.call(arguments),a=r.pop(),s=t.apply(null,r);s in n?o.nextTick(function(){a.apply(null,n[s])}):s in i?i[s].push(a):(i[s]=[a],e.apply(null,r.concat([function(){n[s]=arguments;var e=i[s];delete i[s];for(var t=0,r=e.length;t<r;t++)e[t].apply(null,arguments)}])))};return r.memo=n,r.unmemoized=e,r},o.unmemoize=function(e){return function(){return(e.unmemoized||e).apply(null,arguments)}},o.times=function(e,t,n){for(var i=[],r=0;r<e;r++)i.push(r);return o.map(i,t,n)},o.timesSeries=function(e,t,n){for(var i=[],r=0;r<e;r++)i.push(r);return o.mapSeries(i,t,n)},o.seq=function(){var e=arguments;return function(){var t=this,n=Array.prototype.slice.call(arguments),i=n.pop();o.reduce(e,n,function(e,n,i){n.apply(t,e.concat([function(){var e=arguments[0],t=Array.prototype.slice.call(arguments,1);i(e,t)}]))},function(e,n){i.apply(t,[e].concat(n))})}},o.compose=function(){return o.seq.apply(null,Array.prototype.reverse.call(arguments))};var E=function(e,t){var n=function(){var n=this,i=Array.prototype.slice.call(arguments),r=i.pop();return e(t,function(e,t){e.apply(n,i.concat([t]))},r)};if(arguments.length>2){var i=Array.prototype.slice.call(arguments,2);return n.apply(this,i)}return n};o.applyEach=d(E),o.applyEachSeries=p(E),o.forever=function(e,t){!function n(i){if(i){if(t)return t(i);throw i}e(n)}()},void 0!==t&&t.exports?t.exports=o:i.async=o}()}).call(this,e("_process"))},{_process:3}],13:[function(e,t,n){function i(e,t){s.call(this),t=t||10,this.baseUrl=e||"",this.progress=0,this.loading=!1,this._progressChunk=0,this._beforeMiddleware=[],this._afterMiddleware=[],this._boundLoadResource=this._loadResource.bind(this),this._boundOnLoad=this._onLoad.bind(this),this._buffer=[],this._numToLoad=0,this._queue=r.queue(this._boundLoadResource,t),this.resources={}}var r=e("async"),o=e("url"),a=e("./Resource"),s=e("eventemitter3");i.prototype=Object.create(s.prototype),i.prototype.constructor=i,t.exports=i,i.prototype.add=i.prototype.enqueue=function(e,t,n,i){if(Array.isArray(e)){for(var r=0;r<e.length;++r)this.add(e[r]);return this}if("object"==typeof e&&(i=t||e.callback||e.onComplete,n=e,t=e.url,e=e.name||e.key||e.url),"string"!=typeof t&&(i=n,n=t,t=e),"string"!=typeof t)throw new Error("No url passed to add resource to loader.");if("function"==typeof n&&(i=n,n=null),this.resources[e])throw new Error('Resource with name "'+e+'" already exists.');return t=this._handleBaseUrl(t),this.resources[e]=new a(e,t,n),"function"==typeof i&&this.resources[e].once("afterMiddleware",i),this._numToLoad++,this._queue.started?(this._queue.push(this.resources[e]),this._progressChunk=(100-this.progress)/(this._queue.length()+this._queue.running())):(this._buffer.push(this.resources[e]),this._progressChunk=100/this._buffer.length),this},i.prototype._handleBaseUrl=function(e){var t=o.parse(e);return t.protocol||0===t.pathname.indexOf("//")?e:this.baseUrl.length&&this.baseUrl.lastIndexOf("/")!==this.baseUrl.length-1&&"/"!==e.charAt(0)?this.baseUrl+"/"+e:this.baseUrl+e},i.prototype.before=i.prototype.pre=function(e){return this._beforeMiddleware.push(e),this},i.prototype.after=i.prototype.use=function(e){return this._afterMiddleware.push(e),this},i.prototype.reset=function(){this.progress=0,this.loading=!1,this._progressChunk=0,this._buffer.length=0,this._numToLoad=0,this._queue.kill(),this._queue.started=!1,this.resources={}},i.prototype.load=function(e){if("function"==typeof e&&this.once("complete",e),this._queue.started)return this;this.emit("start",this);for(var t=0;t<this._buffer.length;++t)this._queue.push(this._buffer[t]);return this._buffer.length=0,this},i.prototype._loadResource=function(e,t){var n=this;e._dequeue=t,this._runMiddleware(e,this._beforeMiddleware,function(){e.load(n._boundOnLoad)})},i.prototype._onComplete=function(){this.emit("complete",this,this.resources)},i.prototype._onLoad=function(e){this.progress+=this._progressChunk,this.emit("progress",this,e),this._runMiddleware(e,this._afterMiddleware,function(){e.emit("afterMiddleware",e),this._numToLoad--,0===this._numToLoad&&(this.progress=100,this._onComplete()),e.error?this.emit("error",e.error,this,e):this.emit("load",this,e)}),e._dequeue()},i.prototype._runMiddleware=function(e,t,n){var i=this;r.eachSeries(t,function(t,n){t.call(i,e,n)},n.bind(this,e))},i.LOAD_TYPE=a.LOAD_TYPE,i.XHR_READY_STATE=a.XHR_READY_STATE,i.XHR_RESPONSE_TYPE=a.XHR_RESPONSE_TYPE},{"./Resource":14,async:12,eventemitter3:10,url:8}],14:[function(e,t,n){function i(e,t,n){if(a.call(this),n=n||{},"string"!=typeof e||"string"!=typeof t)throw new Error("Both name and url are required for constructing a resource.");this.name=e,this.url=t,this.isDataUrl=0===this.url.indexOf("data:"),this.data=null,this.crossOrigin=!0===n.crossOrigin?"anonymous":n.crossOrigin,this.loadType=n.loadType||this._determineLoadType(),this.xhrType=n.xhrType,this.metadata=n.metadata||{},this.error=null,this.xhr=null,this.isJson=!1,this.isXml=!1,this.isImage=!1,this.isAudio=!1,this.isVideo=!1,this._dequeue=null,this._boundComplete=this.complete.bind(this),this._boundOnError=this._onError.bind(this),this._boundOnProgress=this._onProgress.bind(this),this._boundXhrOnError=this._xhrOnError.bind(this),this._boundXhrOnAbort=this._xhrOnAbort.bind(this),this._boundXhrOnLoad=this._xhrOnLoad.bind(this),this._boundXdrOnTimeout=this._xdrOnTimeout.bind(this)}function r(e){return e.toString().replace("object ","")}function o(e,t,n){t&&0===t.indexOf(".")&&(t=t.substring(1)),t&&(e[t]=n)}var a=e("eventemitter3"),s=e("url"),c=!(!window.XDomainRequest||"withCredentials"in new XMLHttpRequest),l=null;i.prototype=Object.create(a.prototype),i.prototype.constructor=i,t.exports=i,i.prototype.complete=function(){this.data&&this.data.removeEventListener&&(this.data.removeEventListener("error",this._boundOnError),this.data.removeEventListener("load",this._boundComplete),this.data.removeEventListener("progress",this._boundOnProgress),this.data.removeEventListener("canplaythrough",this._boundComplete)),this.xhr&&(this.xhr.removeEventListener?(this.xhr.removeEventListener("error",this._boundXhrOnError),this.xhr.removeEventListener("abort",this._boundXhrOnAbort),this.xhr.removeEventListener("progress",this._boundOnProgress),this.xhr.removeEventListener("load",this._boundXhrOnLoad)):(this.xhr.onerror=null,this.xhr.ontimeout=null,this.xhr.onprogress=null,this.xhr.onload=null)),this.emit("complete",this)},i.prototype.load=function(e){switch(this.emit("start",this),e&&this.once("complete",e),!1!==this.crossOrigin&&"string"==typeof this.crossOrigin||(this.crossOrigin=this._determineCrossOrigin(this.url)),this.loadType){case i.LOAD_TYPE.IMAGE:this._loadImage();break;case i.LOAD_TYPE.AUDIO:this._loadElement("audio");break;case i.LOAD_TYPE.VIDEO:this._loadElement("video");break;case i.LOAD_TYPE.XHR:default:c&&this.crossOrigin?this._loadXdr():this._loadXhr()}},i.prototype._loadImage=function(){this.data=new Image,this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin),this.data.src=this.url,this.isImage=!0,this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1)},i.prototype._loadElement=function(e){if("audio"===e&&"undefined"!=typeof Audio?this.data=new Audio:this.data=document.createElement(e),null===this.data)return this.error=new Error("Unsupported element "+e),void this.complete();if(navigator.isCocoonJS)this.data.src=Array.isArray(this.url)?this.url[0]:this.url;else if(Array.isArray(this.url))for(var t=0;t<this.url.length;++t)this.data.appendChild(this._createSource(e,this.url[t]));else this.data.appendChild(this._createSource(e,this.url));this["is"+e[0].toUpperCase()+e.substring(1)]=!0,this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1),this.data.addEventListener("canplaythrough",this._boundComplete,!1),this.data.load()},i.prototype._loadXhr=function(){"string"!=typeof this.xhrType&&(this.xhrType=this._determineXhrType());var e=this.xhr=new XMLHttpRequest;e.open("GET",this.url,!0),this.xhrType===i.XHR_RESPONSE_TYPE.JSON||this.xhrType===i.XHR_RESPONSE_TYPE.DOCUMENT?e.responseType=i.XHR_RESPONSE_TYPE.TEXT:e.responseType=this.xhrType,e.addEventListener("error",this._boundXhrOnError,!1),e.addEventListener("abort",this._boundXhrOnAbort,!1),e.addEventListener("progress",this._boundOnProgress,!1),e.addEventListener("load",this._boundXhrOnLoad,!1),e.send()},i.prototype._loadXdr=function(){"string"!=typeof this.xhrType&&(this.xhrType=this._determineXhrType());var e=this.xhr=new XDomainRequest;e.timeout=5e3,e.onerror=this._boundXhrOnError,e.ontimeout=this._boundXdrOnTimeout,e.onprogress=this._boundOnProgress,e.onload=this._boundXhrOnLoad,e.open("GET",this.url,!0),setTimeout(function(){e.send()},0)},i.prototype._createSource=function(e,t,n){n||(n=e+"/"+t.substr(t.lastIndexOf(".")+1));var i=document.createElement("source");return i.src=t,i.type=n,i},i.prototype._onError=function(e){this.error=new Error("Failed to load element using "+e.target.nodeName),this.complete()},i.prototype._onProgress=function(e){e&&e.lengthComputable&&this.emit("progress",this,e.loaded/e.total)},i.prototype._xhrOnError=function(){this.error=new Error(r(this.xhr)+" Request failed. Status: "+this.xhr.status+', text: "'+this.xhr.statusText+'"'),this.complete()},i.prototype._xhrOnAbort=function(){this.error=new Error(r(this.xhr)+" Request was aborted by the user."),this.complete()},i.prototype._xdrOnTimeout=function(){this.error=new Error(r(this.xhr)+" Request timed out."),this.complete()},i.prototype._xhrOnLoad=function(){var e=this.xhr,t=void 0!==e.status?e.status:200;if(200===t||204===t||0===t&&e.responseText.length>0)if(this.xhrType===i.XHR_RESPONSE_TYPE.TEXT)this.data=e.responseText;else if(this.xhrType===i.XHR_RESPONSE_TYPE.JSON)try{this.data=JSON.parse(e.responseText),this.isJson=!0}catch(e){this.error=new Error("Error trying to parse loaded json:",e)}else if(this.xhrType===i.XHR_RESPONSE_TYPE.DOCUMENT)try{if(window.DOMParser){var n=new DOMParser;this.data=n.parseFromString(e.responseText,"text/xml")}else{var r=document.createElement("div");r.innerHTML=e.responseText,this.data=r}this.isXml=!0}catch(e){this.error=new Error("Error trying to parse loaded xml:",e)}else this.data=e.response||e.responseText;else this.error=new Error("["+e.status+"]"+e.statusText+":"+e.responseURL);this.complete()},i.prototype._determineCrossOrigin=function(e,t){if(0===e.indexOf("data:"))return"";t=t||window.location,l||(l=document.createElement("a")),l.href=e;var n=!(e=s.parse(l.href)).port&&""===t.port||e.port===t.port;return e.hostname===t.hostname&&n&&e.protocol===t.protocol?"":"anonymous"},i.prototype._determineXhrType=function(){return i._xhrTypeMap[this._getExtension()]||i.XHR_RESPONSE_TYPE.TEXT},i.prototype._determineLoadType=function(){return i._loadTypeMap[this._getExtension()]||i.LOAD_TYPE.XHR},i.prototype._getExtension=function(){var e,t=this.url;if(this.isDataUrl){var n=t.indexOf("/");e=t.substring(n+1,t.indexOf(";",n))}else{var i=t.indexOf("?");-1!==i&&(t=t.substring(0,i)),e=t.substring(t.lastIndexOf(".")+1)}return e},i.prototype._getMimeFromXhrType=function(e){switch(e){case i.XHR_RESPONSE_TYPE.BUFFER:return"application/octet-binary";case i.XHR_RESPONSE_TYPE.BLOB:return"application/blob";case i.XHR_RESPONSE_TYPE.DOCUMENT:return"application/xml";case i.XHR_RESPONSE_TYPE.JSON:return"application/json";case i.XHR_RESPONSE_TYPE.DEFAULT:case i.XHR_RESPONSE_TYPE.TEXT:default:return"text/plain"}},i.LOAD_TYPE={XHR:1,IMAGE:2,AUDIO:3,VIDEO:4},i.XHR_READY_STATE={UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4},i.XHR_RESPONSE_TYPE={DEFAULT:"text",BUFFER:"arraybuffer",BLOB:"blob",DOCUMENT:"document",JSON:"json",TEXT:"text"},i._loadTypeMap={gif:i.LOAD_TYPE.IMAGE,png:i.LOAD_TYPE.IMAGE,bmp:i.LOAD_TYPE.IMAGE,jpg:i.LOAD_TYPE.IMAGE,jpeg:i.LOAD_TYPE.IMAGE,tif:i.LOAD_TYPE.IMAGE,tiff:i.LOAD_TYPE.IMAGE,webp:i.LOAD_TYPE.IMAGE,tga:i.LOAD_TYPE.IMAGE},i._xhrTypeMap={xhtml:i.XHR_RESPONSE_TYPE.DOCUMENT,html:i.XHR_RESPONSE_TYPE.DOCUMENT,htm:i.XHR_RESPONSE_TYPE.DOCUMENT,xml:i.XHR_RESPONSE_TYPE.DOCUMENT,tmx:i.XHR_RESPONSE_TYPE.DOCUMENT,tsx:i.XHR_RESPONSE_TYPE.DOCUMENT,svg:i.XHR_RESPONSE_TYPE.DOCUMENT,gif:i.XHR_RESPONSE_TYPE.BLOB,png:i.XHR_RESPONSE_TYPE.BLOB,bmp:i.XHR_RESPONSE_TYPE.BLOB,jpg:i.XHR_RESPONSE_TYPE.BLOB,jpeg:i.XHR_RESPONSE_TYPE.BLOB,tif:i.XHR_RESPONSE_TYPE.BLOB,tiff:i.XHR_RESPONSE_TYPE.BLOB,webp:i.XHR_RESPONSE_TYPE.BLOB,tga:i.XHR_RESPONSE_TYPE.BLOB,json:i.XHR_RESPONSE_TYPE.JSON,text:i.XHR_RESPONSE_TYPE.TEXT,txt:i.XHR_RESPONSE_TYPE.TEXT},i.setExtensionLoadType=function(e,t){o(i._loadTypeMap,e,t)},i.setExtensionXhrType=function(e,t){o(i._xhrTypeMap,e,t)}},{eventemitter3:10,url:8}],15:[function(e,t,n){t.exports={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encodeBinary:function(e){for(var t,n="",i=new Array(4),r=0,o=0;r<e.length;){for(t=new Array(3),o=0;o<t.length;o++)r<e.length?t[o]=255&e.charCodeAt(r++):t[o]=0;switch(i[0]=t[0]>>2,i[1]=(3&t[0])<<4|t[1]>>4,i[2]=(15&t[1])<<2|t[2]>>6,i[3]=63&t[2],r-(e.length-1)){case 2:i[3]=64,i[2]=64;break;case 1:i[3]=64}for(o=0;o<i.length;o++)n+=this._keyStr.charAt(i[o])}return n}}},{}],16:[function(e,t,n){t.exports=e("./Loader"),t.exports.Resource=e("./Resource"),t.exports.middleware={caching:{memory:e("./middlewares/caching/memory")},parsing:{blob:e("./middlewares/parsing/blob")}}},{"./Loader":13,"./Resource":14,"./middlewares/caching/memory":17,"./middlewares/parsing/blob":18}],17:[function(e,t,n){var i={};t.exports=function(){return function(e,t){i[e.url]?(e.data=i[e.url],e.complete()):e.once("complete",function(){i[this.url]=this.data}),t()}}},{}],18:[function(e,t,n){var i=e("../../Resource"),r=e("../../b64");window.URL=window.URL||window.webkitURL,t.exports=function(){return function(e,t){if(!e.data)return t();if(e.xhr&&e.xhrType===i.XHR_RESPONSE_TYPE.BLOB)if(window.Blob&&"string"!=typeof e.data){if(0===e.data.type.indexOf("image")){var n=URL.createObjectURL(e.data);e.blob=e.data,e.data=new Image,e.data.src=n,e.isImage=!0,e.data.onload=function(){URL.revokeObjectURL(n),e.data.onload=null,t()}}}else{var o=e.xhr.getResponseHeader("content-type");o&&0===o.indexOf("image")&&(e.data=new Image,e.data.src="data:"+o+";base64,"+r.encodeBinary(e.xhr.responseText),e.isImage=!0,e.data.onload=function(){e.data.onload=null,t()})}else t()}}},{"../../Resource":14,"../../b64":15}],19:[function(e,t,n){function i(e){var t=document.createElement("div");t.style.width="100px",t.style.height="100px",t.style.position="absolute",t.style.top=0,t.style.left=0,t.style.zIndex=2,this.div=t,this.pool=[],this.renderId=0,this.debug=!1,this.renderer=e,this.children=[],this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this.isActive=!1,window.addEventListener("keydown",this._onKeyDown,!1)}var r=e("../core");Object.assign(r.DisplayObject.prototype,e("./accessibleTarget")),i.prototype.constructor=i,t.exports=i,i.prototype.activate=function(){this.isActive||(this.isActive=!0,window.document.addEventListener("mousemove",this._onMouseMove,!0),window.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),this.renderer.view.parentNode.appendChild(this.div))},i.prototype.deactivate=function(){this.isActive&&(this.isActive=!1,window.document.removeEventListener("mousemove",this._onMouseMove),window.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),this.div.parentNode.removeChild(this.div))},i.prototype.updateAccessibleObjects=function(e){if(e.visible&&(e.accessible&&e.interactive&&(e._accessibleActive||this.addChild(e),e.renderId=this.renderId),e.interactiveChildren))for(var t=e.children,n=t.length-1;n>=0;n--)this.updateAccessibleObjects(t[n])},i.prototype.update=function(){this.updateAccessibleObjects(this.renderer._lastObjectRendered);var e=this.renderer.view.getBoundingClientRect(),t=e.width/this.renderer.width,n=e.height/this.renderer.height,i=this.div;i.style.left=e.left+"px",i.style.top=e.top+"px",i.style.width=this.renderer.width+"px",i.style.height=this.renderer.height+"px";for(var o=0;o<this.children.length;o++){var a=this.children[o];if(a.renderId!==this.renderId)a._accessibleActive=!1,r.utils.removeItems(this.children,o,1),this.div.removeChild(a._accessibleDiv),this.pool.push(a._accessibleDiv),a._accessibleDiv=null,o--,0===this.children.length&&this.deactivate();else{i=a._accessibleDiv;var s=a.hitArea,c=a.worldTransform;a.hitArea?(i.style.left=(c.tx+s.x*c.a)*t+"px",i.style.top=(c.ty+s.y*c.d)*n+"px",i.style.width=s.width*c.a*t+"px",i.style.height=s.height*c.d*n+"px"):(s=a.getBounds(),this.capHitArea(s),i.style.left=s.x*t+"px",i.style.top=s.y*n+"px",i.style.width=s.width*t+"px",i.style.height=s.height*n+"px")}}this.renderId++},i.prototype.capHitArea=function(e){e.x<0&&(e.width+=e.x,e.x=0),e.y<0&&(e.height+=e.y,e.y=0),e.x+e.width>this.renderer.width&&(e.width=this.renderer.width-e.x),e.y+e.height>this.renderer.height&&(e.height=this.renderer.height-e.y)},i.prototype.addChild=function(e){var t=this.pool.pop();t||((t=document.createElement("button")).style.width="100px",t.style.height="100px",t.style.backgroundColor=this.debug?"rgba(255,0,0,0.5)":"transparent",t.style.position="absolute",t.style.zIndex=2,t.style.borderStyle="none",t.addEventListener("click",this._onClick.bind(this)),t.addEventListener("focus",this._onFocus.bind(this)),t.addEventListener("focusout",this._onFocusOut.bind(this))),t.title=e.accessibleTitle||"displayObject "+this.tabIndex,e._accessibleActive=!0,e._accessibleDiv=t,t.displayObject=e,this.children.push(e),this.div.appendChild(e._accessibleDiv),e._accessibleDiv.tabIndex=e.tabIndex},i.prototype._onClick=function(e){var t=this.renderer.plugins.interaction;t.dispatchEvent(e.target.displayObject,"click",t.eventData)},i.prototype._onFocus=function(e){var t=this.renderer.plugins.interaction;t.dispatchEvent(e.target.displayObject,"mouseover",t.eventData)},i.prototype._onFocusOut=function(e){var t=this.renderer.plugins.interaction;t.dispatchEvent(e.target.displayObject,"mouseout",t.eventData)},i.prototype._onKeyDown=function(e){9===e.keyCode&&this.activate()},i.prototype._onMouseMove=function(){this.deactivate()},i.prototype.destroy=function(){this.div=null;for(var e=0;e<this.children.length;e++)this.children[e].div=null;window.document.removeEventListener("mousemove",this._onMouseMove),window.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null},r.WebGLRenderer.registerPlugin("accessibility",i),r.CanvasRenderer.registerPlugin("accessibility",i)},{"../core":29,"./accessibleTarget":20}],20:[function(e,t,n){t.exports={accessible:!1,accessibleTitle:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:!1}},{}],21:[function(e,t,n){t.exports={accessibleTarget:e("./accessibleTarget"),AccessibilityManager:e("./AccessibilityManager")}},{"./AccessibilityManager":19,"./accessibleTarget":20}],22:[function(e,t,n){var i={VERSION:"3.0.10",PI_2:2*Math.PI,RAD_TO_DEG:180/Math.PI,DEG_TO_RAD:Math.PI/180,TARGET_FPMS:.06,RENDERER_TYPE:{UNKNOWN:0,WEBGL:1,CANVAS:2},BLEND_MODES:{NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16},DRAW_MODES:{POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},SCALE_MODES:{DEFAULT:0,LINEAR:0,NEAREST:1},RETINA_PREFIX:/@(.+)x/,RESOLUTION:1,FILTER_RESOLUTION:1,DEFAULT_RENDER_OPTIONS:{view:null,resolution:1,antialias:!1,forceFXAA:!1,autoResize:!1,transparent:!1,backgroundColor:0,clearBeforeRender:!0,preserveDrawingBuffer:!1,roundPixels:!1},SHAPES:{POLY:0,RECT:1,CIRC:2,ELIP:3,RREC:4},SPRITE_BATCH_SIZE:2e3};t.exports=i},{}],23:[function(e,t,n){function i(){a.call(this),this.children=[]}var r=e("../math"),o=e("../utils"),a=e("./DisplayObject"),s=e("../textures/RenderTexture"),c=new r.Matrix;i.prototype=Object.create(a.prototype),i.prototype.constructor=i,t.exports=i,Object.defineProperties(i.prototype,{width:{get:function(){return this.scale.x*this.getLocalBounds().width},set:function(e){var t=this.getLocalBounds().width;this.scale.x=0!==t?e/t:1,this._width=e}},height:{get:function(){return this.scale.y*this.getLocalBounds().height},set:function(e){var t=this.getLocalBounds().height;this.scale.y=0!==t?e/t:1,this._height=e}}}),i.prototype.onChildrenChange=function(){},i.prototype.addChild=function(e){var t=arguments.length;if(t>1)for(var n=0;n<t;n++)this.addChild(arguments[n]);else e.parent&&e.parent.removeChild(e),e.parent=this,this.children.push(e),this.onChildrenChange(this.children.length-1),e.emit("added",this);return e},i.prototype.addChildAt=function(e,t){if(t>=0&&t<=this.children.length)return e.parent&&e.parent.removeChild(e),e.parent=this,this.children.splice(t,0,e),this.onChildrenChange(t),e.emit("added",this),e;throw new Error(e+"addChildAt: The index "+t+" supplied is out of bounds "+this.children.length)},i.prototype.swapChildren=function(e,t){if(e!==t){var n=this.getChildIndex(e),i=this.getChildIndex(t);if(n<0||i<0)throw new Error("swapChildren: Both the supplied DisplayObjects must be children of the caller.");this.children[n]=t,this.children[i]=e,this.onChildrenChange(n<i?n:i)}},i.prototype.getChildIndex=function(e){var t=this.children.indexOf(e);if(-1===t)throw new Error("The supplied DisplayObject must be a child of the caller");return t},i.prototype.setChildIndex=function(e,t){if(t<0||t>=this.children.length)throw new Error("The supplied index is out of bounds");var n=this.getChildIndex(e);o.removeItems(this.children,n,1),this.children.splice(t,0,e),this.onChildrenChange(t)},i.prototype.getChildAt=function(e){if(e<0||e>=this.children.length)throw new Error("getChildAt: Supplied index "+e+" does not exist in the child list, or the supplied DisplayObject is not a child of the caller");return this.children[e]},i.prototype.removeChild=function(e){var t=arguments.length;if(t>1)for(var n=0;n<t;n++)this.removeChild(arguments[n]);else{var i=this.children.indexOf(e);if(-1===i)return;e.parent=null,o.removeItems(this.children,i,1),this.onChildrenChange(i),e.emit("removed",this)}return e},i.prototype.removeChildAt=function(e){var t=this.getChildAt(e);return t.parent=null,o.removeItems(this.children,e,1),this.onChildrenChange(e),t.emit("removed",this),t},i.prototype.removeChildren=function(e,t){var n,i,r=e||0,o="number"==typeof t?t:this.children.length,a=o-r;if(a>0&&a<=o){for(n=this.children.splice(r,a),i=0;i<n.length;++i)n[i].parent=null;for(this.onChildrenChange(e),i=0;i<n.length;++i)n[i].emit("removed",this);return n}if(0===a&&0===this.children.length)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")},i.prototype.generateTexture=function(e,t,n){var i=this.getLocalBounds(),r=new s(e,0|i.width,0|i.height,n,t);return c.tx=-i.x,c.ty=-i.y,r.render(this,c),r},i.prototype.updateTransform=function(){if(this.visible){this.displayObjectUpdateTransform();for(var e=0,t=this.children.length;e<t;++e)this.children[e].updateTransform()}},i.prototype.containerUpdateTransform=i.prototype.updateTransform,i.prototype.getBounds=function(){if(!this._currentBounds){if(0===this.children.length)return r.Rectangle.EMPTY;for(var e,t,n,i=1/0,o=1/0,a=-1/0,s=-1/0,c=!1,l=0,u=this.children.length;l<u;++l)this.children[l].visible&&(c=!0,i=i<(e=this.children[l].getBounds()).x?i:e.x,o=o<e.y?o:e.y,a=a>(t=e.width+e.x)?a:t,s=s>(n=e.height+e.y)?s:n);if(!c)return r.Rectangle.EMPTY;var h=this._bounds;h.x=i,h.y=o,h.width=a-i,h.height=s-o,this._currentBounds=h}return this._currentBounds},i.prototype.containerGetBounds=i.prototype.getBounds,i.prototype.getLocalBounds=function(){var e=this.worldTransform
;this.worldTransform=r.Matrix.IDENTITY;for(var t=0,n=this.children.length;t<n;++t)this.children[t].updateTransform();return this.worldTransform=e,this._currentBounds=null,this.getBounds(r.Matrix.IDENTITY)},i.prototype.renderWebGL=function(e){var t,n;if(this.visible&&!(this.worldAlpha<=0)&&this.renderable)if(this._mask||this._filters){for(e.currentRenderer.flush(),this._filters&&this._filters.length&&e.filterManager.pushFilter(this,this._filters),this._mask&&e.maskManager.pushMask(this,this._mask),e.currentRenderer.start(),this._renderWebGL(e),t=0,n=this.children.length;t<n;t++)this.children[t].renderWebGL(e);e.currentRenderer.flush(),this._mask&&e.maskManager.popMask(this,this._mask),this._filters&&e.filterManager.popFilter(),e.currentRenderer.start()}else for(this._renderWebGL(e),t=0,n=this.children.length;t<n;++t)this.children[t].renderWebGL(e)},i.prototype._renderWebGL=function(e){},i.prototype._renderCanvas=function(e){},i.prototype.renderCanvas=function(e){if(this.visible&&!(this.alpha<=0)&&this.renderable){this._mask&&e.maskManager.pushMask(this._mask,e),this._renderCanvas(e);for(var t=0,n=this.children.length;t<n;++t)this.children[t].renderCanvas(e);this._mask&&e.maskManager.popMask(e)}},i.prototype.destroy=function(e){if(a.prototype.destroy.call(this),e)for(var t=0,n=this.children.length;t<n;++t)this.children[t].destroy(e);this.removeChildren(),this.children=null}},{"../math":33,"../textures/RenderTexture":71,"../utils":77,"./DisplayObject":24}],24:[function(e,t,n){function i(){a.call(this),this.position=new r.Point,this.scale=new r.Point(1,1),this.pivot=new r.Point(0,0),this.skew=new r.Point(0,0),this.rotation=0,this.alpha=1,this.visible=!0,this.renderable=!0,this.parent=null,this.worldAlpha=1,this.worldTransform=new r.Matrix,this.filterArea=null,this._sr=0,this._cr=1,this._bounds=new r.Rectangle(0,0,1,1),this._currentBounds=null,this._mask=null}var r=e("../math"),o=e("../textures/RenderTexture"),a=e("eventemitter3"),s=e("../const"),c=new r.Matrix,l={worldTransform:new r.Matrix,worldAlpha:1,children:[]};i.prototype=Object.create(a.prototype),i.prototype.constructor=i,t.exports=i,Object.defineProperties(i.prototype,{x:{get:function(){return this.position.x},set:function(e){this.position.x=e}},y:{get:function(){return this.position.y},set:function(e){this.position.y=e}},worldVisible:{get:function(){var e=this;do{if(!e.visible)return!1;e=e.parent}while(e);return!0}},mask:{get:function(){return this._mask},set:function(e){this._mask&&(this._mask.renderable=!0),this._mask=e,this._mask&&(this._mask.renderable=!1)}},filters:{get:function(){return this._filters&&this._filters.slice()},set:function(e){this._filters=e&&e.slice()}}}),i.prototype.updateTransform=function(){var e,t,n,i,r,o,a=this.parent.worldTransform,l=this.worldTransform;this.skew.x||this.skew.y?(c.setTransform(this.position.x,this.position.y,this.pivot.x,this.pivot.y,this.scale.x,this.scale.y,this.rotation,this.skew.x,this.skew.y),l.a=c.a*a.a+c.b*a.c,l.b=c.a*a.b+c.b*a.d,l.c=c.c*a.a+c.d*a.c,l.d=c.c*a.b+c.d*a.d,l.tx=c.tx*a.a+c.ty*a.c+a.tx,l.ty=c.tx*a.b+c.ty*a.d+a.ty):this.rotation%s.PI_2?(this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation)),e=this._cr*this.scale.x,t=this._sr*this.scale.x,n=-this._sr*this.scale.y,i=this._cr*this.scale.y,r=this.position.x,o=this.position.y,(this.pivot.x||this.pivot.y)&&(r-=this.pivot.x*e+this.pivot.y*n,o-=this.pivot.x*t+this.pivot.y*i),l.a=e*a.a+t*a.c,l.b=e*a.b+t*a.d,l.c=n*a.a+i*a.c,l.d=n*a.b+i*a.d,l.tx=r*a.a+o*a.c+a.tx,l.ty=r*a.b+o*a.d+a.ty):(e=this.scale.x,i=this.scale.y,r=this.position.x-this.pivot.x*e,o=this.position.y-this.pivot.y*i,l.a=e*a.a,l.b=e*a.b,l.c=i*a.c,l.d=i*a.d,l.tx=r*a.a+o*a.c+a.tx,l.ty=r*a.b+o*a.d+a.ty),this.worldAlpha=this.alpha*this.parent.worldAlpha,this._currentBounds=null},i.prototype.displayObjectUpdateTransform=i.prototype.updateTransform,i.prototype.getBounds=function(e){return r.Rectangle.EMPTY},i.prototype.getLocalBounds=function(){return this.getBounds(r.Matrix.IDENTITY)},i.prototype.toGlobal=function(e){return this.parent?this.displayObjectUpdateTransform():(this.parent=l,this.displayObjectUpdateTransform(),this.parent=null),this.worldTransform.apply(e)},i.prototype.toLocal=function(e,t,n){return t&&(e=t.toGlobal(e)),this.parent?this.displayObjectUpdateTransform():(this.parent=l,this.displayObjectUpdateTransform(),this.parent=null),this.worldTransform.applyInverse(e,n)},i.prototype.renderWebGL=function(e){},i.prototype.renderCanvas=function(e){},i.prototype.generateTexture=function(e,t,n){var i=this.getLocalBounds(),r=new o(e,0|i.width,0|i.height,t,n);return c.tx=-i.x,c.ty=-i.y,r.render(this,c),r},i.prototype.setParent=function(e){if(!e||!e.addChild)throw new Error("setParent: Argument must be a Container");return e.addChild(this),e},i.prototype.setTransform=function(e,t,n,i,r,o,a,s,c){return this.position.x=e||0,this.position.y=t||0,this.scale.x=n||1,this.scale.y=i||1,this.rotation=r||0,this.skew.x=o||0,this.skew.y=a||0,this.pivot.x=s||0,this.pivot.y=c||0,this},i.prototype.destroy=function(){this.position=null,this.scale=null,this.pivot=null,this.skew=null,this.parent=null,this._bounds=null,this._currentBounds=null,this._mask=null,this.worldTransform=null,this.filterArea=null}},{"../const":22,"../math":33,"../textures/RenderTexture":71,eventemitter3:10}],25:[function(e,t,n){function i(){r.call(this),this.fillAlpha=1,this.lineWidth=0,this.lineColor=0,this.graphicsData=[],this.tint=16777215,this._prevTint=16777215,this.blendMode=u.BLEND_MODES.NORMAL,this.currentPath=null,this._webGL={},this.isMask=!1,this.boundsPadding=0,this._localBounds=new l.Rectangle(0,0,1,1),this.dirty=!0,this.glDirty=!1,this.boundsDirty=!0,this.cachedSpriteDirty=!1}var r=e("../display/Container"),o=e("../textures/Texture"),a=e("../renderers/canvas/utils/CanvasBuffer"),s=e("../renderers/canvas/utils/CanvasGraphics"),c=e("./GraphicsData"),l=e("../math"),u=e("../const"),h=new l.Point;i.prototype=Object.create(r.prototype),i.prototype.constructor=i,t.exports=i,i.prototype.clone=function(){var e=new i;e.renderable=this.renderable,e.fillAlpha=this.fillAlpha,e.lineWidth=this.lineWidth,e.lineColor=this.lineColor,e.tint=this.tint,e.blendMode=this.blendMode,e.isMask=this.isMask,e.boundsPadding=this.boundsPadding,e.dirty=!0,e.glDirty=!0,e.cachedSpriteDirty=this.cachedSpriteDirty;for(var t=0;t<this.graphicsData.length;++t)e.graphicsData.push(this.graphicsData[t].clone());return e.currentPath=e.graphicsData[e.graphicsData.length-1],e.updateLocalBounds(),e},i.prototype.lineStyle=function(e,t,n){if(this.lineWidth=e||0,this.lineColor=t||0,this.lineAlpha=void 0===n?1:n,this.currentPath)if(this.currentPath.shape.points.length){var i=new l.Polygon(this.currentPath.shape.points.slice(-2));i.closed=!1,this.drawShape(i)}else this.currentPath.lineWidth=this.lineWidth,this.currentPath.lineColor=this.lineColor,this.currentPath.lineAlpha=this.lineAlpha;return this},i.prototype.moveTo=function(e,t){var n=new l.Polygon([e,t]);return n.closed=!1,this.drawShape(n),this},i.prototype.lineTo=function(e,t){return this.currentPath.shape.points.push(e,t),this.dirty=!0,this},i.prototype.quadraticCurveTo=function(e,t,n,i){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);var r,o,a=this.currentPath.shape.points;0===a.length&&this.moveTo(0,0);for(var s=a[a.length-2],c=a[a.length-1],l=0,u=1;u<=20;++u)r=s+(e-s)*(l=u/20),o=c+(t-c)*l,a.push(r+(e+(n-e)*l-r)*l,o+(t+(i-t)*l-o)*l);return this.dirty=this.boundsDirty=!0,this},i.prototype.bezierCurveTo=function(e,t,n,i,r,o){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);for(var a,s,c,l,u,h=this.currentPath.shape.points,d=h[h.length-2],p=h[h.length-1],f=0,m=1;m<=20;++m)c=(s=(a=1-(f=m/20))*a)*a,u=(l=f*f)*f,h.push(c*d+3*s*f*e+3*a*l*n+u*r,c*p+3*s*f*t+3*a*l*i+u*o);return this.dirty=this.boundsDirty=!0,this},i.prototype.arcTo=function(e,t,n,i,r){this.currentPath?0===this.currentPath.shape.points.length&&this.currentPath.shape.points.push(e,t):this.moveTo(e,t);var o=this.currentPath.shape.points,a=o[o.length-2],s=o[o.length-1]-t,c=a-e,l=i-t,u=n-e,h=Math.abs(s*u-c*l);if(h<1e-8||0===r)o[o.length-2]===e&&o[o.length-1]===t||o.push(e,t);else{var d=s*s+c*c,p=l*l+u*u,f=s*l+c*u,m=r*Math.sqrt(d)/h,g=r*Math.sqrt(p)/h,v=m*f/d,y=g*f/p,b=m*u+g*c,w=m*l+g*s,x=c*(g+v),E=s*(g+v),S=u*(m+y),_=l*(m+y),T=Math.atan2(E-w,x-b),M=Math.atan2(_-w,S-b);this.arc(b+e,w+t,r,T,M,c*l>u*s)}return this.dirty=this.boundsDirty=!0,this},i.prototype.arc=function(e,t,n,i,r,o){if(i===r)return this;!(o=o||!1)&&r<=i?r+=2*Math.PI:o&&i<=r&&(i+=2*Math.PI);var a=o?-1*(i-r):r-i,s=40*Math.ceil(Math.abs(a)/(2*Math.PI));if(0===a)return this;var c=e+Math.cos(i)*n,l=t+Math.sin(i)*n;this.currentPath?this.currentPath.shape.points.push(c,l):this.moveTo(c,l);for(var u=this.currentPath.shape.points,h=a/(2*s),d=2*h,p=Math.cos(h),f=Math.sin(h),m=s-1,g=m%1/m,v=0;v<=m;v++){var y=h+i+d*(v+g*v),b=Math.cos(y),w=-Math.sin(y);u.push((p*b+f*w)*n+e,(p*-w+f*b)*n+t)}return this.dirty=this.boundsDirty=!0,this},i.prototype.beginFill=function(e,t){return this.filling=!0,this.fillColor=e||0,this.fillAlpha=void 0===t?1:t,this.currentPath&&this.currentPath.shape.points.length<=2&&(this.currentPath.fill=this.filling,this.currentPath.fillColor=this.fillColor,this.currentPath.fillAlpha=this.fillAlpha),this},i.prototype.endFill=function(){return this.filling=!1,this.fillColor=null,this.fillAlpha=1,this},i.prototype.drawRect=function(e,t,n,i){return this.drawShape(new l.Rectangle(e,t,n,i)),this},i.prototype.drawRoundedRect=function(e,t,n,i,r){return this.drawShape(new l.RoundedRectangle(e,t,n,i,r)),this},i.prototype.drawCircle=function(e,t,n){return this.drawShape(new l.Circle(e,t,n)),this},i.prototype.drawEllipse=function(e,t,n,i){return this.drawShape(new l.Ellipse(e,t,n,i)),this},i.prototype.drawPolygon=function(e){var t=e,n=!0;if(t instanceof l.Polygon&&(n=t.closed,t=t.points),!Array.isArray(t)){t=new Array(arguments.length);for(var i=0;i<t.length;++i)t[i]=arguments[i]}var r=new l.Polygon(t);return r.closed=n,this.drawShape(r),this},i.prototype.clear=function(){return this.lineWidth=0,this.filling=!1,this.dirty=!0,this.clearDirty=!0,this.graphicsData=[],this},i.prototype.generateTexture=function(e,t,n){t=t||1;var i=this.getLocalBounds(),r=new a(i.width*t,i.height*t),c=o.fromCanvas(r.canvas,n);return c.baseTexture.resolution=t,r.context.scale(t,t),r.context.translate(-i.x,-i.y),s.renderGraphics(this,r.context),c},i.prototype._renderWebGL=function(e){this.glDirty&&(this.dirty=!0,this.glDirty=!1),e.setObjectRenderer(e.plugins.graphics),e.plugins.graphics.render(this)},i.prototype._renderCanvas=function(e){if(!0!==this.isMask){this._prevTint!==this.tint&&(this.dirty=!0);var t=e.context,n=this.worldTransform,i=e.blendModes[this.blendMode];i!==t.globalCompositeOperation&&(t.globalCompositeOperation=i);var r=e.resolution;t.setTransform(n.a*r,n.b*r,n.c*r,n.d*r,n.tx*r,n.ty*r),s.renderGraphics(this,t)}},i.prototype.getBounds=function(e){if(!this._currentBounds){if(!this.renderable)return l.Rectangle.EMPTY;this.boundsDirty&&(this.updateLocalBounds(),this.glDirty=!0,this.cachedSpriteDirty=!0,this.boundsDirty=!1);var t=this._localBounds,n=t.x,i=t.width+t.x,r=t.y,o=t.height+t.y,a=e||this.worldTransform,s=a.a,c=a.b,u=a.c,h=a.d,d=a.tx,p=a.ty,f=s*i+u*o+d,m=h*o+c*i+p,g=s*n+u*o+d,v=h*o+c*n+p,y=s*n+u*r+d,b=h*r+c*n+p,w=s*i+u*r+d,x=h*r+c*i+p,E=f,S=m,_=f,T=m;_=w<(_=y<(_=g<_?g:_)?y:_)?w:_,T=x<(T=b<(T=v<T?v:T)?b:T)?x:T,E=w>(E=y>(E=g>E?g:E)?y:E)?w:E,S=x>(S=b>(S=v>S?v:S)?b:S)?x:S,this._bounds.x=_,this._bounds.width=E-_,this._bounds.y=T,this._bounds.height=S-T,this._currentBounds=this._bounds}return this._currentBounds},i.prototype.containsPoint=function(e){this.worldTransform.applyInverse(e,h);for(var t=this.graphicsData,n=0;n<t.length;n++){var i=t[n];if(i.fill&&i.shape&&i.shape.contains(h.x,h.y))return!0}return!1},i.prototype.updateLocalBounds=function(){var e=1/0,t=-1/0,n=1/0,i=-1/0;if(this.graphicsData.length)for(var r,o,a,s,c,l,h=0;h<this.graphicsData.length;h++){var d=this.graphicsData[h],p=d.type,f=d.lineWidth;if(r=d.shape,p===u.SHAPES.RECT||p===u.SHAPES.RREC)a=r.x-f/2,s=r.y-f/2,e=a<e?a:e,t=a+(c=r.width+f)>t?a+c:t,n=s<n?s:n,i=s+(l=r.height+f)>i?s+l:i;else if(p===u.SHAPES.CIRC)a=r.x,s=r.y,e=a-(c=r.radius+f/2)<e?a-c:e,t=a+c>t?a+c:t,n=s-(l=r.radius+f/2)<n?s-l:n,i=s+l>i?s+l:i;else if(p===u.SHAPES.ELIP)a=r.x,s=r.y,e=a-(c=r.width+f/2)<e?a-c:e,t=a+c>t?a+c:t,n=s-(l=r.height+f/2)<n?s-l:n,i=s+l>i?s+l:i;else{o=r.points;for(var m=0;m<o.length;m+=2)e=(a=o[m])-f<e?a-f:e,t=a+f>t?a+f:t,n=(s=o[m+1])-f<n?s-f:n,i=s+f>i?s+f:i}}else e=0,t=0,n=0,i=0;var g=this.boundsPadding;this._localBounds.x=e-g,this._localBounds.width=t-e+2*g,this._localBounds.y=n-g,this._localBounds.height=i-n+2*g},i.prototype.drawShape=function(e){this.currentPath&&this.currentPath.shape.points.length<=2&&this.graphicsData.pop(),this.currentPath=null;var t=new c(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.filling,e);return this.graphicsData.push(t),t.type===u.SHAPES.POLY&&(t.shape.closed=t.shape.closed||this.filling,this.currentPath=t),this.dirty=this.boundsDirty=!0,t},i.prototype.destroy=function(){r.prototype.destroy.apply(this,arguments);for(var e=0;e<this.graphicsData.length;++e)this.graphicsData[e].destroy();for(var t in this._webgl)for(var n=0;n<this._webgl[t].data.length;++n)this._webgl[t].data[n].destroy();this.graphicsData=null,this.currentPath=null,this._webgl=null,this._localBounds=null}},{"../const":22,"../display/Container":23,"../math":33,"../renderers/canvas/utils/CanvasBuffer":45,"../renderers/canvas/utils/CanvasGraphics":46,"../textures/Texture":72,"./GraphicsData":26}],26:[function(e,t,n){function i(e,t,n,i,r,o,a){this.lineWidth=e,this.lineColor=t,this.lineAlpha=n,this._lineTint=t,this.fillColor=i,this.fillAlpha=r,this._fillTint=i,this.fill=o,this.shape=a,this.type=a.type}i.prototype.constructor=i,t.exports=i,i.prototype.clone=function(){return new i(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.shape)},i.prototype.destroy=function(){this.shape=null}},{}],27:[function(e,t,n){function i(e){s.call(this,e),this.graphicsDataPool=[],this.primitiveShader=null,this.complexPrimitiveShader=null,this.maximumSimplePolySize=200}var r=e("../../utils"),o=e("../../math"),a=e("../../const"),s=e("../../renderers/webgl/utils/ObjectRenderer"),c=e("../../renderers/webgl/WebGLRenderer"),l=e("./WebGLGraphicsData"),u=e("earcut");i.prototype=Object.create(s.prototype),i.prototype.constructor=i,t.exports=i,c.registerPlugin("graphics",i),i.prototype.onContextChange=function(){},i.prototype.destroy=function(){s.prototype.destroy.call(this);for(var e=0;e<this.graphicsDataPool.length;++e)this.graphicsDataPool[e].destroy();this.graphicsDataPool=null},i.prototype.render=function(e){var t,n=this.renderer,i=n.gl,o=n.shaderManager.plugins.primitiveShader;!e.dirty&&e._webGL[i.id]||this.updateGraphics(e);var a=e._webGL[i.id];n.blendModeManager.setBlendMode(e.blendMode);for(var s=0,c=a.data.length;s<c;s++)t=a.data[s],1===a.data[s].mode?(n.stencilManager.pushStencil(e,t),i.uniform1f(n.shaderManager.complexPrimitiveShader.uniforms.alpha._location,e.worldAlpha*t.alpha),i.drawElements(i.TRIANGLE_FAN,4,i.UNSIGNED_SHORT,2*(t.indices.length-4)),n.stencilManager.popStencil(e,t)):(o=n.shaderManager.primitiveShader,n.shaderManager.setShader(o),i.uniformMatrix3fv(o.uniforms.translationMatrix._location,!1,e.worldTransform.toArray(!0)),i.uniformMatrix3fv(o.uniforms.projectionMatrix._location,!1,n.currentRenderTarget.projectionMatrix.toArray(!0)),i.uniform3fv(o.uniforms.tint._location,r.hex2rgb(e.tint)),i.uniform1f(o.uniforms.alpha._location,e.worldAlpha),i.bindBuffer(i.ARRAY_BUFFER,t.buffer),i.vertexAttribPointer(o.attributes.aVertexPosition,2,i.FLOAT,!1,24,0),i.vertexAttribPointer(o.attributes.aColor,4,i.FLOAT,!1,24,8),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,t.indexBuffer),i.drawElements(i.TRIANGLE_STRIP,t.indices.length,i.UNSIGNED_SHORT,0)),n.drawCount++},i.prototype.updateGraphics=function(e){var t,n,i=this.renderer.gl,r=e._webGL[i.id];if(r||(r=e._webGL[i.id]={lastIndex:0,data:[],gl:i}),e.dirty=!1,e.clearDirty){for(e.clearDirty=!1,t=0;t<r.data.length;t++){var o=r.data[t];o.reset(),this.graphicsDataPool.push(o)}r.data=[],r.lastIndex=0}for(t=r.lastIndex;t<e.graphicsData.length;t++){var s=e.graphicsData[t];s.type===a.SHAPES.POLY?(s.points=s.shape.points.slice(),s.shape.closed&&(s.points[0]===s.points[s.points.length-2]&&s.points[1]===s.points[s.points.length-1]||s.points.push(s.points[0],s.points[1])),s.fill&&s.points.length>=6&&(s.points.length<2*this.maximumSimplePolySize?(n=this.switchMode(r,0),this.buildPoly(s,n)||(n=this.switchMode(r,1),this.buildComplexPoly(s,n))):(n=this.switchMode(r,1),this.buildComplexPoly(s,n))),s.lineWidth>0&&(n=this.switchMode(r,0),this.buildLine(s,n))):(n=this.switchMode(r,0),s.type===a.SHAPES.RECT?this.buildRectangle(s,n):s.type===a.SHAPES.CIRC||s.type===a.SHAPES.ELIP?this.buildCircle(s,n):s.type===a.SHAPES.RREC&&this.buildRoundedRectangle(s,n)),r.lastIndex++}for(t=0;t<r.data.length;t++)(n=r.data[t]).dirty&&n.upload()},i.prototype.switchMode=function(e,t){var n;return e.data.length?((n=e.data[e.data.length-1]).points.length>32e4||n.mode!==t||1===t)&&((n=this.graphicsDataPool.pop()||new l(e.gl)).mode=t,e.data.push(n)):((n=this.graphicsDataPool.pop()||new l(e.gl)).mode=t,e.data.push(n)),n.dirty=!0,n},i.prototype.buildRectangle=function(e,t){var n=e.shape,i=n.x,o=n.y,a=n.width,s=n.height;if(e.fill){var c=r.hex2rgb(e.fillColor),l=e.fillAlpha,u=c[0]*l,h=c[1]*l,d=c[2]*l,p=t.points,f=t.indices,m=p.length/6;p.push(i,o),p.push(u,h,d,l),p.push(i+a,o),p.push(u,h,d,l),p.push(i,o+s),p.push(u,h,d,l),p.push(i+a,o+s),p.push(u,h,d,l),f.push(m,m,m+1,m+2,m+3,m+3)}if(e.lineWidth){var g=e.points;e.points=[i,o,i+a,o,i+a,o+s,i,o+s,i,o],this.buildLine(e,t),e.points=g}},i.prototype.buildRoundedRectangle=function(e,t){var n=e.shape,i=n.x,o=n.y,a=n.width,s=n.height,c=n.radius,l=[];if(l.push(i,o+c),this.quadraticBezierCurve(i,o+s-c,i,o+s,i+c,o+s,l),this.quadraticBezierCurve(i+a-c,o+s,i+a,o+s,i+a,o+s-c,l),this.quadraticBezierCurve(i+a,o+c,i+a,o,i+a-c,o,l),this.quadraticBezierCurve(i+c,o,i,o,i,o+c+1e-10,l),e.fill){var h=r.hex2rgb(e.fillColor),d=e.fillAlpha,p=h[0]*d,f=h[1]*d,m=h[2]*d,g=t.points,v=t.indices,y=g.length/6,b=u(l,null,2),w=0;for(w=0;w<b.length;w+=3)v.push(b[w]+y),v.push(b[w]+y),v.push(b[w+1]+y),v.push(b[w+2]+y),v.push(b[w+2]+y);for(w=0;w<l.length;w++)g.push(l[w],l[++w],p,f,m,d)}if(e.lineWidth){var x=e.points;e.points=l,this.buildLine(e,t),e.points=x}},i.prototype.quadraticBezierCurve=function(e,t,n,i,r,o,a){function s(e,t,n){return e+(t-e)*n}for(var c,l,u,h,d,p,f=a||[],m=0,g=0;g<=20;g++)c=s(e,n,m=g/20),l=s(t,i,m),u=s(n,r,m),h=s(i,o,m),d=s(c,u,m),p=s(l,h,m),f.push(d,p);return f},i.prototype.buildCircle=function(e,t){var n,i,o=e.shape,s=o.x,c=o.y;e.type===a.SHAPES.CIRC?(n=o.radius,i=o.radius):(n=o.width,i=o.height);var l=Math.floor(30*Math.sqrt(o.radius))||Math.floor(15*Math.sqrt(o.width+o.height)),u=2*Math.PI/l,h=0;if(e.fill){var d=r.hex2rgb(e.fillColor),p=e.fillAlpha,f=d[0]*p,m=d[1]*p,g=d[2]*p,v=t.points,y=t.indices,b=v.length/6;for(y.push(b),h=0;h<l+1;h++)v.push(s,c,f,m,g,p),v.push(s+Math.sin(u*h)*n,c+Math.cos(u*h)*i,f,m,g,p),y.push(b++,b++);y.push(b-1)}if(e.lineWidth){var w=e.points;for(e.points=[],h=0;h<l+1;h++)e.points.push(s+Math.sin(u*h)*n,c+Math.cos(u*h)*i);this.buildLine(e,t),e.points=w}},i.prototype.buildLine=function(e,t){var n=0,i=e.points;if(0!==i.length){var a=new o.Point(i[0],i[1]),s=new o.Point(i[i.length-2],i[i.length-1]);if(a.x===s.x&&a.y===s.y){(i=i.slice()).pop(),i.pop();var c=(s=new o.Point(i[i.length-2],i[i.length-1])).x+.5*(a.x-s.x),l=s.y+.5*(a.y-s.y);i.unshift(c,l),i.push(c,l)}var u,h,d,p,f,m,g,v,y,b,w,x,E,S,_,T,M,C,A,R,P,I,L=t.points,D=t.indices,O=i.length/2,k=i.length,F=L.length/6,B=e.lineWidth/2,N=r.hex2rgb(e.lineColor),U=e.lineAlpha,z=N[0]*U,G=N[1]*U,H=N[2]*U;for(d=i[0],p=i[1],f=i[2],y=-(p-(m=i[3])),b=d-f,y/=I=Math.sqrt(y*y+b*b),b/=I,y*=B,b*=B,L.push(d-y,p-b,z,G,H,U),L.push(d+y,p+b,z,G,H,U),n=1;n<O-1;n++)d=i[2*(n-1)],p=i[2*(n-1)+1],f=i[2*n],m=i[2*n+1],g=i[2*(n+1)],v=i[2*(n+1)+1],y=-(p-m),b=d-f,y/=I=Math.sqrt(y*y+b*b),b/=I,y*=B,b*=B,w=-(m-v),x=f-g,w/=I=Math.sqrt(w*w+x*x),x/=I,M=(-y+d)*(-b+m)-(-y+f)*(-b+p),R=(-(w*=B)+g)*(-(x*=B)+m)-(-w+f)*(-x+v),P=(_=-b+p-(-b+m))*(A=-w+f-(-w+g))-(C=-x+v-(-x+m))*(T=-y+f-(-y+d)),Math.abs(P)<.1?(P+=10.1,L.push(f-y,m-b,z,G,H,U),L.push(f+y,m+b,z,G,H,U)):((u=(T*R-A*M)/P)-f)*(u-f)+((h=(C*M-_*R)/P)-m)*(h-m)>19600?(E=y-w,S=b-x,E/=I=Math.sqrt(E*E+S*S),S/=I,E*=B,S*=B,L.push(f-E,m-S),L.push(z,G,H,U),L.push(f+E,m+S),L.push(z,G,H,U),L.push(f-E,m-S),L.push(z,G,H,U),k++):(L.push(u,h),L.push(z,G,H,U),L.push(f-(u-f),m-(h-m)),L.push(z,G,H,U));for(d=i[2*(O-2)],p=i[2*(O-2)+1],f=i[2*(O-1)],y=-(p-(m=i[2*(O-1)+1])),b=d-f,y/=I=Math.sqrt(y*y+b*b),b/=I,y*=B,b*=B,L.push(f-y,m-b),L.push(z,G,H,U),L.push(f+y,m+b),L.push(z,G,H,U),D.push(F),n=0;n<k;n++)D.push(F++);D.push(F-1)}},i.prototype.buildComplexPoly=function(e,t){var n=e.points.slice();if(!(n.length<6)){var i=t.indices;t.points=n,t.alpha=e.fillAlpha,t.color=r.hex2rgb(e.fillColor);for(var o,a,s=1/0,c=-1/0,l=1/0,u=-1/0,h=0;h<n.length;h+=2)s=(o=n[h])<s?o:s,c=o>c?o:c,l=(a=n[h+1])<l?a:l,u=a>u?a:u;n.push(s,l,c,l,c,u,s,u);var d=n.length/2;for(h=0;h<d;h++)i.push(h)}},i.prototype.buildPoly=function(e,t){var n=e.points;if(!(n.length<6)){var i=t.points,o=t.indices,a=n.length/2,s=r.hex2rgb(e.fillColor),c=e.fillAlpha,l=s[0]*c,h=s[1]*c,d=s[2]*c,p=u(n,null,2);if(!p)return!1;var f=i.length/6,m=0;for(m=0;m<p.length;m+=3)o.push(p[m]+f),o.push(p[m]+f),o.push(p[m+1]+f),o.push(p[m+2]+f),o.push(p[m+2]+f);for(m=0;m<a;m++)i.push(n[2*m],n[2*m+1],l,h,d,c);return!0}}},{"../../const":22,"../../math":33,"../../renderers/webgl/WebGLRenderer":49,"../../renderers/webgl/utils/ObjectRenderer":63,"../../utils":77,"./WebGLGraphicsData":28,earcut:9}],28:[function(e,t,n){function i(e){this.gl=e,this.color=[0,0,0],this.points=[],this.indices=[],this.buffer=e.createBuffer(),this.indexBuffer=e.createBuffer(),this.mode=1,this.alpha=1,this.dirty=!0,this.glPoints=null,this.glIndices=null}i.prototype.constructor=i,t.exports=i,i.prototype.reset=function(){this.points.length=0,this.indices.length=0},i.prototype.upload=function(){var e=this.gl;this.glPoints=new Float32Array(this.points),e.bindBuffer(e.ARRAY_BUFFER,this.buffer),e.bufferData(e.ARRAY_BUFFER,this.glPoints,e.STATIC_DRAW),this.glIndices=new Uint16Array(this.indices),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.glIndices,e.STATIC_DRAW),this.dirty=!1},i.prototype.destroy=function(){this.color=null,this.points=null,this.indices=null,this.gl.deleteBuffer(this.buffer),this.gl.deleteBuffer(this.indexBuffer),this.gl=null,this.buffer=null,this.indexBuffer=null,this.glPoints=null,this.glIndices=null}},{}],29:[function(e,t,n){var i=t.exports=Object.assign(e("./const"),e("./math"),{utils:e("./utils"),ticker:e("./ticker"),DisplayObject:e("./display/DisplayObject"),Container:e("./display/Container"),Sprite:e("./sprites/Sprite"),ParticleContainer:e("./particles/ParticleContainer"),SpriteRenderer:e("./sprites/webgl/SpriteRenderer"),ParticleRenderer:e("./particles/webgl/ParticleRenderer"),Text:e("./text/Text"),Graphics:e("./graphics/Graphics"),GraphicsData:e("./graphics/GraphicsData"),GraphicsRenderer:e("./graphics/webgl/GraphicsRenderer"),Texture:e("./textures/Texture"),BaseTexture:e("./textures/BaseTexture"),RenderTexture:e("./textures/RenderTexture"),VideoBaseTexture:e("./textures/VideoBaseTexture"),TextureUvs:e("./textures/TextureUvs"),CanvasRenderer:e("./renderers/canvas/CanvasRenderer"),CanvasGraphics:e("./renderers/canvas/utils/CanvasGraphics"),CanvasBuffer:e("./renderers/canvas/utils/CanvasBuffer"),WebGLRenderer:e("./renderers/webgl/WebGLRenderer"),WebGLManager:e("./renderers/webgl/managers/WebGLManager"),ShaderManager:e("./renderers/webgl/managers/ShaderManager"),Shader:e("./renderers/webgl/shaders/Shader"),TextureShader:e("./renderers/webgl/shaders/TextureShader"),PrimitiveShader:e("./renderers/webgl/shaders/PrimitiveShader"),ComplexPrimitiveShader:e("./renderers/webgl/shaders/ComplexPrimitiveShader"),ObjectRenderer:e("./renderers/webgl/utils/ObjectRenderer"),RenderTarget:e("./renderers/webgl/utils/RenderTarget"),AbstractFilter:e("./renderers/webgl/filters/AbstractFilter"),FXAAFilter:e("./renderers/webgl/filters/FXAAFilter"),SpriteMaskFilter:e("./renderers/webgl/filters/SpriteMaskFilter"),autoDetectRenderer:function(e,t,n,r){return e=e||800,t=t||600,!r&&i.utils.isWebGLSupported()?new i.WebGLRenderer(e,t,n):new i.CanvasRenderer(e,t,n)}})},{"./const":22,"./display/Container":23,"./display/DisplayObject":24,"./graphics/Graphics":25,"./graphics/GraphicsData":26,"./graphics/webgl/GraphicsRenderer":27,"./math":33,"./particles/ParticleContainer":39,"./particles/webgl/ParticleRenderer":41,"./renderers/canvas/CanvasRenderer":44,"./renderers/canvas/utils/CanvasBuffer":45,"./renderers/canvas/utils/CanvasGraphics":46,"./renderers/webgl/WebGLRenderer":49,"./renderers/webgl/filters/AbstractFilter":50,"./renderers/webgl/filters/FXAAFilter":51,"./renderers/webgl/filters/SpriteMaskFilter":52,"./renderers/webgl/managers/ShaderManager":56,"./renderers/webgl/managers/WebGLManager":58,"./renderers/webgl/shaders/ComplexPrimitiveShader":59,"./renderers/webgl/shaders/PrimitiveShader":60,"./renderers/webgl/shaders/Shader":61,"./renderers/webgl/shaders/TextureShader":62,"./renderers/webgl/utils/ObjectRenderer":63,"./renderers/webgl/utils/RenderTarget":65,"./sprites/Sprite":67,"./sprites/webgl/SpriteRenderer":68,"./text/Text":69,"./textures/BaseTexture":70,"./textures/RenderTexture":71,"./textures/Texture":72,"./textures/TextureUvs":73,"./textures/VideoBaseTexture":74,"./ticker":76,"./utils":77}],30:[function(e,t,n){function i(e){return e<0?-1:e>0?1:0}var r=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],o=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],a=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],s=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],c=[],l=e("./Matrix"),u=[];!function(){for(var e=0;e<16;e++){var t=[];u.push(t);for(var n=0;n<16;n++)for(var h=i(r[e]*r[n]+a[e]*o[n]),d=i(o[e]*r[n]+s[e]*o[n]),p=i(r[e]*a[n]+a[e]*s[n]),f=i(o[e]*a[n]+s[e]*s[n]),m=0;m<16;m++)if(r[m]===h&&o[m]===d&&a[m]===p&&s[m]===f){t.push(m);break}}for(e=0;e<16;e++){var g=new l;g.set(r[e],o[e],a[e],s[e],0,0),c.push(g)}}();var h={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MIRROR_HORIZONTAL:12,uX:function(e){return r[e]},uY:function(e){return o[e]},vX:function(e){return a[e]},vY:function(e){return s[e]},inv:function(e){return 8&e?15&e:7&-e},add:function(e,t){return u[e][t]},sub:function(e,t){return u[e][h.inv(t)]},rotate180:function(e){return 4^e},isSwapWidthHeight:function(e){return 2==(3&e)},byDirection:function(e,t){return 2*Math.abs(e)<=Math.abs(t)?t>=0?h.S:h.N:2*Math.abs(t)<=Math.abs(e)?e>0?h.E:h.W:t>0?e>0?h.SE:h.SW:e>0?h.NE:h.NW},matrixAppendRotationInv:function(e,t,n,i){var r=c[h.inv(t)];n=n||0,i=i||0,r.tx=n,r.ty=i,e.append(r)}};t.exports=h},{"./Matrix":31}],31:[function(e,t,n){function i(){this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0}var r=e("./Point");i.prototype.constructor=i,t.exports=i,i.prototype.fromArray=function(e){this.a=e[0],this.b=e[1],this.c=e[3],this.d=e[4],this.tx=e[2],this.ty=e[5]},i.prototype.set=function(e,t,n,i,r,o){return this.a=e,this.b=t,this.c=n,this.d=i,this.tx=r,this.ty=o,this},i.prototype.toArray=function(e,t){this.array||(this.array=new Float32Array(9));var n=t||this.array;return e?(n[0]=this.a,n[1]=this.b,n[2]=0,n[3]=this.c,n[4]=this.d,n[5]=0,n[6]=this.tx,n[7]=this.ty,n[8]=1):(n[0]=this.a,n[1]=this.c,n[2]=this.tx,n[3]=this.b,n[4]=this.d,n[5]=this.ty,n[6]=0,n[7]=0,n[8]=1),n},i.prototype.apply=function(e,t){t=t||new r;var n=e.x,i=e.y;return t.x=this.a*n+this.c*i+this.tx,t.y=this.b*n+this.d*i+this.ty,t},i.prototype.applyInverse=function(e,t){t=t||new r;var n=1/(this.a*this.d+this.c*-this.b),i=e.x,o=e.y;return t.x=this.d*n*i+-this.c*n*o+(this.ty*this.c-this.tx*this.d)*n,t.y=this.a*n*o+-this.b*n*i+(-this.ty*this.a+this.tx*this.b)*n,t},i.prototype.translate=function(e,t){return this.tx+=e,this.ty+=t,this},i.prototype.scale=function(e,t){return this.a*=e,this.d*=t,this.c*=e,this.b*=t,this.tx*=e,this.ty*=t,this},i.prototype.rotate=function(e){var t=Math.cos(e),n=Math.sin(e),i=this.a,r=this.c,o=this.tx;return this.a=i*t-this.b*n,this.b=i*n+this.b*t,this.c=r*t-this.d*n,this.d=r*n+this.d*t,this.tx=o*t-this.ty*n,this.ty=o*n+this.ty*t,this},i.prototype.append=function(e){var t=this.a,n=this.b,i=this.c,r=this.d;return this.a=e.a*t+e.b*i,this.b=e.a*n+e.b*r,this.c=e.c*t+e.d*i,this.d=e.c*n+e.d*r,this.tx=e.tx*t+e.ty*i+this.tx,this.ty=e.tx*n+e.ty*r+this.ty,this},i.prototype.setTransform=function(e,t,n,i,r,o,a,s,c){var l,u,h,d,p,f,m,g,v,y;return p=Math.sin(a),f=Math.cos(a),m=Math.cos(c),g=Math.sin(c),v=-Math.sin(s),y=Math.cos(s),l=f*r,u=p*r,h=-p*o,d=f*o,this.a=m*l+g*h,this.b=m*u+g*d,this.c=v*l+y*h,this.d=v*u+y*d,this.tx=e+(n*l+i*h),this.ty=t+(n*u+i*d),this},i.prototype.prepend=function(e){var t=this.tx;if(1!==e.a||0!==e.b||0!==e.c||1!==e.d){var n=this.a,i=this.c;this.a=n*e.a+this.b*e.c,this.b=n*e.b+this.b*e.d,this.c=i*e.a+this.d*e.c,this.d=i*e.b+this.d*e.d}return this.tx=t*e.a+this.ty*e.c+e.tx,this.ty=t*e.b+this.ty*e.d+e.ty,this},i.prototype.invert=function(){var e=this.a,t=this.b,n=this.c,i=this.d,r=this.tx,o=e*i-t*n;return this.a=i/o,this.b=-t/o,this.c=-n/o,this.d=e/o,this.tx=(n*this.ty-i*r)/o,this.ty=-(e*this.ty-t*r)/o,this},i.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},i.prototype.clone=function(){var e=new i;return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e},i.prototype.copy=function(e){return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e},i.IDENTITY=new i,i.TEMP_MATRIX=new i},{"./Point":32}],32:[function(e,t,n){function i(e,t){this.x=e||0,this.y=t||0}i.prototype.constructor=i,t.exports=i,i.prototype.clone=function(){return new i(this.x,this.y)},i.prototype.copy=function(e){this.set(e.x,e.y)},i.prototype.equals=function(e){return e.x===this.x&&e.y===this.y},i.prototype.set=function(e,t){this.x=e||0,this.y=t||(0!==t?this.x:0)}},{}],33:[function(e,t,n){t.exports={Point:e("./Point"),Matrix:e("./Matrix"),GroupD8:e("./GroupD8"),Circle:e("./shapes/Circle"),Ellipse:e("./shapes/Ellipse"),Polygon:e("./shapes/Polygon"),Rectangle:e("./shapes/Rectangle"),RoundedRectangle:e("./shapes/RoundedRectangle")}},{"./GroupD8":30,"./Matrix":31,"./Point":32,"./shapes/Circle":34,"./shapes/Ellipse":35,"./shapes/Polygon":36,"./shapes/Rectangle":37,"./shapes/RoundedRectangle":38}],34:[function(e,t,n){function i(e,t,n){this.x=e||0,this.y=t||0,this.radius=n||0,this.type=o.SHAPES.CIRC}var r=e("./Rectangle"),o=e("../../const");i.prototype.constructor=i,t.exports=i,i.prototype.clone=function(){return new i(this.x,this.y,this.radius)},i.prototype.contains=function(e,t){if(this.radius<=0)return!1;var n=this.x-e,i=this.y-t;return(n*=n)+(i*=i)<=this.radius*this.radius},i.prototype.getBounds=function(){return new r(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)}},{"../../const":22,"./Rectangle":37}],35:[function(e,t,n){function i(e,t,n,i){this.x=e||0,this.y=t||0,this.width=n||0,this.height=i||0,this.type=o.SHAPES.ELIP}var r=e("./Rectangle"),o=e("../../const");i.prototype.constructor=i,t.exports=i,i.prototype.clone=function(){return new i(this.x,this.y,this.width,this.height)},i.prototype.contains=function(e,t){if(this.width<=0||this.height<=0)return!1;var n=(e-this.x)/this.width,i=(t-this.y)/this.height;return(n*=n)+(i*=i)<=1},i.prototype.getBounds=function(){return new r(this.x-this.width,this.y-this.height,this.width,this.height)}},{"../../const":22,"./Rectangle":37}],36:[function(e,t,n){function i(e){var t=e;if(!Array.isArray(t)){t=new Array(arguments.length);for(var n=0;n<t.length;++n)t[n]=arguments[n]}if(t[0]instanceof r){
for(var i=[],a=0,s=t.length;a<s;a++)i.push(t[a].x,t[a].y);t=i}this.closed=!0,this.points=t,this.type=o.SHAPES.POLY}var r=e("../Point"),o=e("../../const");i.prototype.constructor=i,t.exports=i,i.prototype.clone=function(){return new i(this.points.slice())},i.prototype.contains=function(e,t){for(var n=!1,i=this.points.length/2,r=0,o=i-1;r<i;o=r++){var a=this.points[2*r],s=this.points[2*r+1],c=this.points[2*o],l=this.points[2*o+1];s>t!=l>t&&e<(c-a)*(t-s)/(l-s)+a&&(n=!n)}return n}},{"../../const":22,"../Point":32}],37:[function(e,t,n){function i(e,t,n,i){this.x=e||0,this.y=t||0,this.width=n||0,this.height=i||0,this.type=r.SHAPES.RECT}var r=e("../../const");i.prototype.constructor=i,t.exports=i,i.EMPTY=new i(0,0,0,0),i.prototype.clone=function(){return new i(this.x,this.y,this.width,this.height)},i.prototype.contains=function(e,t){return!(this.width<=0||this.height<=0)&&e>=this.x&&e<this.x+this.width&&t>=this.y&&t<this.y+this.height}},{"../../const":22}],38:[function(e,t,n){function i(e,t,n,i,o){this.x=e||0,this.y=t||0,this.width=n||0,this.height=i||0,this.radius=o||20,this.type=r.SHAPES.RREC}var r=e("../../const");i.prototype.constructor=i,t.exports=i,i.prototype.clone=function(){return new i(this.x,this.y,this.width,this.height,this.radius)},i.prototype.contains=function(e,t){return!(this.width<=0||this.height<=0)&&e>=this.x&&e<=this.x+this.width&&t>=this.y&&t<=this.y+this.height}},{"../../const":22}],39:[function(e,t,n){function i(e,t,n){r.call(this),(n=n||15e3)>16384&&(n=16384),n>(e=e||15e3)&&(n=e),this._properties=[!1,!0,!1,!1,!1],this._maxSize=e,this._batchSize=n,this._buffers=null,this._bufferToUpdate=0,this.interactiveChildren=!1,this.blendMode=o.BLEND_MODES.NORMAL,this.roundPixels=!0,this.setProperties(t)}var r=e("../display/Container"),o=e("../const");i.prototype=Object.create(r.prototype),i.prototype.constructor=i,t.exports=i,i.prototype.setProperties=function(e){e&&(this._properties[0]="scale"in e?!!e.scale:this._properties[0],this._properties[1]="position"in e?!!e.position:this._properties[1],this._properties[2]="rotation"in e?!!e.rotation:this._properties[2],this._properties[3]="uvs"in e?!!e.uvs:this._properties[3],this._properties[4]="alpha"in e?!!e.alpha:this._properties[4])},i.prototype.updateTransform=function(){this.displayObjectUpdateTransform()},i.prototype.renderWebGL=function(e){this.visible&&!(this.worldAlpha<=0)&&this.children.length&&this.renderable&&(e.setObjectRenderer(e.plugins.particle),e.plugins.particle.render(this))},i.prototype.onChildrenChange=function(e){var t=Math.floor(e/this._batchSize);t<this._bufferToUpdate&&(this._bufferToUpdate=t)},i.prototype.renderCanvas=function(e){if(this.visible&&!(this.worldAlpha<=0)&&this.children.length&&this.renderable){var t=e.context,n=this.worldTransform,i=!0,r=0,o=0,a=0,s=0,c=e.blendModes[this.blendMode];c!==t.globalCompositeOperation&&(t.globalCompositeOperation=c),t.globalAlpha=this.worldAlpha,this.displayObjectUpdateTransform();for(var l=0;l<this.children.length;++l){var u=this.children[l];if(u.visible){var h=u.texture.frame;if(t.globalAlpha=this.worldAlpha*u.alpha,u.rotation%(2*Math.PI)==0)i&&(t.setTransform(n.a,n.b,n.c,n.d,n.tx,n.ty),i=!1),r=u.anchor.x*(-h.width*u.scale.x)+u.position.x+.5,o=u.anchor.y*(-h.height*u.scale.y)+u.position.y+.5,a=h.width*u.scale.x,s=h.height*u.scale.y;else{i||(i=!0),u.displayObjectUpdateTransform();var d=u.worldTransform;e.roundPixels?t.setTransform(d.a,d.b,d.c,d.d,0|d.tx,0|d.ty):t.setTransform(d.a,d.b,d.c,d.d,d.tx,d.ty),r=u.anchor.x*-h.width+.5,o=u.anchor.y*-h.height+.5,a=h.width,s=h.height}t.drawImage(u.texture.baseTexture.source,h.x,h.y,h.width,h.height,r,o,a,s)}}}},i.prototype.destroy=function(){if(r.prototype.destroy.apply(this,arguments),this._buffers)for(var e=0;e<this._buffers.length;++e)this._buffers[e].destroy();this._properties=null,this._buffers=null}},{"../const":22,"../display/Container":23}],40:[function(e,t,n){function i(e,t,n,i){this.gl=e,this.vertSize=2,this.vertByteSize=4*this.vertSize,this.size=i,this.dynamicProperties=[],this.staticProperties=[];for(var r=0;r<t.length;r++){var o=t[r];n[r]?this.dynamicProperties.push(o):this.staticProperties.push(o)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.initBuffers()}i.prototype.constructor=i,t.exports=i,i.prototype.initBuffers=function(){var e,t,n=this.gl,i=0;for(this.dynamicStride=0,e=0;e<this.dynamicProperties.length;e++)(t=this.dynamicProperties[e]).offset=i,i+=t.size,this.dynamicStride+=t.size;this.dynamicData=new Float32Array(this.size*this.dynamicStride*4),this.dynamicBuffer=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,this.dynamicBuffer),n.bufferData(n.ARRAY_BUFFER,this.dynamicData,n.DYNAMIC_DRAW);var r=0;for(this.staticStride=0,e=0;e<this.staticProperties.length;e++)(t=this.staticProperties[e]).offset=r,r+=t.size,this.staticStride+=t.size;this.staticData=new Float32Array(this.size*this.staticStride*4),this.staticBuffer=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,this.staticBuffer),n.bufferData(n.ARRAY_BUFFER,this.staticData,n.DYNAMIC_DRAW)},i.prototype.uploadDynamic=function(e,t,n){for(var i=this.gl,r=0;r<this.dynamicProperties.length;r++){var o=this.dynamicProperties[r];o.uploadFunction(e,t,n,this.dynamicData,this.dynamicStride,o.offset)}i.bindBuffer(i.ARRAY_BUFFER,this.dynamicBuffer),i.bufferSubData(i.ARRAY_BUFFER,0,this.dynamicData)},i.prototype.uploadStatic=function(e,t,n){for(var i=this.gl,r=0;r<this.staticProperties.length;r++){var o=this.staticProperties[r];o.uploadFunction(e,t,n,this.staticData,this.staticStride,o.offset)}i.bindBuffer(i.ARRAY_BUFFER,this.staticBuffer),i.bufferSubData(i.ARRAY_BUFFER,0,this.staticData)},i.prototype.bind=function(){var e,t,n=this.gl;for(n.bindBuffer(n.ARRAY_BUFFER,this.dynamicBuffer),e=0;e<this.dynamicProperties.length;e++)t=this.dynamicProperties[e],n.vertexAttribPointer(t.attribute,t.size,n.FLOAT,!1,4*this.dynamicStride,4*t.offset);for(n.bindBuffer(n.ARRAY_BUFFER,this.staticBuffer),e=0;e<this.staticProperties.length;e++)t=this.staticProperties[e],n.vertexAttribPointer(t.attribute,t.size,n.FLOAT,!1,4*this.staticStride,4*t.offset)},i.prototype.destroy=function(){this.dynamicProperties=null,this.dynamicData=null,this.gl.deleteBuffer(this.dynamicBuffer),this.staticProperties=null,this.staticData=null,this.gl.deleteBuffer(this.staticBuffer)}},{}],41:[function(e,t,n){function i(e){r.call(this,e),this.indices=new Uint16Array(98304);for(var t=0,n=0;t<98304;t+=6,n+=4)this.indices[t+0]=n+0,this.indices[t+1]=n+1,this.indices[t+2]=n+2,this.indices[t+3]=n+0,this.indices[t+4]=n+2,this.indices[t+5]=n+3;this.shader=null,this.indexBuffer=null,this.properties=null,this.tempMatrix=new c.Matrix}var r=e("../../renderers/webgl/utils/ObjectRenderer"),o=e("../../renderers/webgl/WebGLRenderer"),a=e("./ParticleShader"),s=e("./ParticleBuffer"),c=e("../../math");i.prototype=Object.create(r.prototype),i.prototype.constructor=i,t.exports=i,o.registerPlugin("particle",i),i.prototype.onContextChange=function(){var e=this.renderer.gl;this.shader=new a(this.renderer.shaderManager),this.indexBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indices,e.STATIC_DRAW),this.properties=[{attribute:this.shader.attributes.aVertexPosition,size:2,uploadFunction:this.uploadVertices,offset:0},{attribute:this.shader.attributes.aPositionCoord,size:2,uploadFunction:this.uploadPosition,offset:0},{attribute:this.shader.attributes.aRotation,size:1,uploadFunction:this.uploadRotation,offset:0},{attribute:this.shader.attributes.aTextureCoord,size:2,uploadFunction:this.uploadUvs,offset:0},{attribute:this.shader.attributes.aColor,size:1,uploadFunction:this.uploadAlpha,offset:0}]},i.prototype.start=function(){var e=this.renderer.gl;e.activeTexture(e.TEXTURE0),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var t=this.shader;this.renderer.shaderManager.setShader(t)},i.prototype.render=function(e){var t=e.children,n=t.length,i=e._maxSize,r=e._batchSize;if(0!==n){n>i&&(n=i),e._buffers||(e._buffers=this.generateBuffers(e)),this.renderer.blendModeManager.setBlendMode(e.blendMode);var o=this.renderer.gl,a=e.worldTransform.copy(this.tempMatrix);a.prepend(this.renderer.currentRenderTarget.projectionMatrix),o.uniformMatrix3fv(this.shader.uniforms.projectionMatrix._location,!1,a.toArray(!0)),o.uniform1f(this.shader.uniforms.uAlpha._location,e.worldAlpha);var s=t[0]._texture.baseTexture;if(s._glTextures[o.id])o.bindTexture(o.TEXTURE_2D,s._glTextures[o.id]);else{if(!this.renderer.updateTexture(s))return;e._properties[0]&&e._properties[3]||(e._bufferToUpdate=0)}for(var c=0,l=0;c<n;c+=r,l+=1){var u=n-c;u>r&&(u=r);var h=e._buffers[l];h.uploadDynamic(t,c,u),e._bufferToUpdate===l&&(h.uploadStatic(t,c,u),e._bufferToUpdate=l+1),h.bind(this.shader),o.drawElements(o.TRIANGLES,6*u,o.UNSIGNED_SHORT,0),this.renderer.drawCount++}}},i.prototype.generateBuffers=function(e){var t,n=this.renderer.gl,i=[],r=e._maxSize,o=e._batchSize,a=e._properties;for(t=0;t<r;t+=o)i.push(new s(n,this.properties,a,o));return i},i.prototype.uploadVertices=function(e,t,n,i,r,o){for(var a,s,c,l,u,h,d,p,f,m=0;m<n;m++)s=(a=e[t+m])._texture,l=a.scale.x,u=a.scale.y,s.trim?(h=(d=(c=s.trim).x-a.anchor.x*c.width)+s.crop.width,p=(f=c.y-a.anchor.y*c.height)+s.crop.height):(h=s._frame.width*(1-a.anchor.x),d=s._frame.width*-a.anchor.x,p=s._frame.height*(1-a.anchor.y),f=s._frame.height*-a.anchor.y),i[o]=d*l,i[o+1]=f*u,i[o+r]=h*l,i[o+r+1]=f*u,i[o+2*r]=h*l,i[o+2*r+1]=p*u,i[o+3*r]=d*l,i[o+3*r+1]=p*u,o+=4*r},i.prototype.uploadPosition=function(e,t,n,i,r,o){for(var a=0;a<n;a++){var s=e[t+a].position;i[o]=s.x,i[o+1]=s.y,i[o+r]=s.x,i[o+r+1]=s.y,i[o+2*r]=s.x,i[o+2*r+1]=s.y,i[o+3*r]=s.x,i[o+3*r+1]=s.y,o+=4*r}},i.prototype.uploadRotation=function(e,t,n,i,r,o){for(var a=0;a<n;a++){var s=e[t+a].rotation;i[o]=s,i[o+r]=s,i[o+2*r]=s,i[o+3*r]=s,o+=4*r}},i.prototype.uploadUvs=function(e,t,n,i,r,o){for(var a=0;a<n;a++){var s=e[t+a]._texture._uvs;s?(i[o]=s.x0,i[o+1]=s.y0,i[o+r]=s.x1,i[o+r+1]=s.y1,i[o+2*r]=s.x2,i[o+2*r+1]=s.y2,i[o+3*r]=s.x3,i[o+3*r+1]=s.y3,o+=4*r):(i[o]=0,i[o+1]=0,i[o+r]=0,i[o+r+1]=0,i[o+2*r]=0,i[o+2*r+1]=0,i[o+3*r]=0,i[o+3*r+1]=0,o+=4*r)}},i.prototype.uploadAlpha=function(e,t,n,i,r,o){for(var a=0;a<n;a++){var s=e[t+a].alpha;i[o]=s,i[o+r]=s,i[o+2*r]=s,i[o+3*r]=s,o+=4*r}},i.prototype.destroy=function(){this.renderer.gl&&this.renderer.gl.deleteBuffer(this.indexBuffer),r.prototype.destroy.apply(this,arguments),this.shader.destroy(),this.indices=null,this.tempMatrix=null}},{"../../math":33,"../../renderers/webgl/WebGLRenderer":49,"../../renderers/webgl/utils/ObjectRenderer":63,"./ParticleBuffer":40,"./ParticleShader":42}],42:[function(e,t,n){function i(e){r.call(this,e,["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute float aColor;","attribute vec2 aPositionCoord;","attribute vec2 aScale;","attribute float aRotation;","uniform mat3 projectionMatrix;","varying vec2 vTextureCoord;","varying float vColor;","void main(void){","   vec2 v = aVertexPosition;","   v.x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);","   v.y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);","   v = v + aPositionCoord;","   gl_Position = vec4((projectionMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = aColor;","}"].join("\n"),["precision lowp float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","uniform float uAlpha;","void main(void){","  vec4 color = texture2D(uSampler, vTextureCoord) * vColor * uAlpha;","  if (color.a == 0.0) discard;","  gl_FragColor = color;","}"].join("\n"),{uAlpha:{type:"1f",value:1}},{aPositionCoord:0,aRotation:0})}var r=e("../../renderers/webgl/shaders/TextureShader");i.prototype=Object.create(r.prototype),i.prototype.constructor=i,t.exports=i},{"../../renderers/webgl/shaders/TextureShader":62}],43:[function(e,t,n){function i(e,t,n,i){if(s.call(this),r.sayHello(e),i)for(var c in a.DEFAULT_RENDER_OPTIONS)void 0===i[c]&&(i[c]=a.DEFAULT_RENDER_OPTIONS[c]);else i=a.DEFAULT_RENDER_OPTIONS;this.type=a.RENDERER_TYPE.UNKNOWN,this.width=t||800,this.height=n||600,this.view=i.view||document.createElement("canvas"),this.resolution=i.resolution,this.transparent=i.transparent,this.autoResize=i.autoResize||!1,this.blendModes=null,this.preserveDrawingBuffer=i.preserveDrawingBuffer,this.clearBeforeRender=i.clearBeforeRender,this.roundPixels=i.roundPixels,this._backgroundColor=0,this._backgroundColorRgb=[0,0,0],this._backgroundColorString="#000000",this.backgroundColor=i.backgroundColor||this._backgroundColor,this._tempDisplayObjectParent={worldTransform:new o.Matrix,worldAlpha:1,children:[]},this._lastObjectRendered=this._tempDisplayObjectParent}var r=e("../utils"),o=e("../math"),a=e("../const"),s=e("eventemitter3");i.prototype=Object.create(s.prototype),i.prototype.constructor=i,t.exports=i,Object.defineProperties(i.prototype,{backgroundColor:{get:function(){return this._backgroundColor},set:function(e){this._backgroundColor=e,this._backgroundColorString=r.hex2string(e),r.hex2rgb(e,this._backgroundColorRgb)}}}),i.prototype.resize=function(e,t){this.width=e*this.resolution,this.height=t*this.resolution,this.view.width=this.width,this.view.height=this.height,this.autoResize&&(this.view.style.width=this.width/this.resolution+"px",this.view.style.height=this.height/this.resolution+"px")},i.prototype.destroy=function(e){e&&this.view.parentNode&&this.view.parentNode.removeChild(this.view),this.type=a.RENDERER_TYPE.UNKNOWN,this.width=0,this.height=0,this.view=null,this.resolution=0,this.transparent=!1,this.autoResize=!1,this.blendModes=null,this.preserveDrawingBuffer=!1,this.clearBeforeRender=!1,this.roundPixels=!1,this._backgroundColor=0,this._backgroundColorRgb=null,this._backgroundColorString=null}},{"../const":22,"../math":33,"../utils":77,eventemitter3:10}],44:[function(e,t,n){function i(e,t,n){n=n||{},r.call(this,"Canvas",e,t,n),this.type=c.RENDERER_TYPE.CANVAS,this.context=this.view.getContext("2d",{alpha:this.transparent}),this.refresh=!0,this.maskManager=new o,this.smoothProperty="imageSmoothingEnabled",this.context.imageSmoothingEnabled||(this.context.webkitImageSmoothingEnabled?this.smoothProperty="webkitImageSmoothingEnabled":this.context.mozImageSmoothingEnabled?this.smoothProperty="mozImageSmoothingEnabled":this.context.oImageSmoothingEnabled?this.smoothProperty="oImageSmoothingEnabled":this.context.msImageSmoothingEnabled&&(this.smoothProperty="msImageSmoothingEnabled")),this.initPlugins(),this._mapBlendModes(),this._tempDisplayObjectParent={worldTransform:new s.Matrix,worldAlpha:1},this.resize(e,t)}var r=e("../SystemRenderer"),o=e("./utils/CanvasMaskManager"),a=e("../../utils"),s=e("../../math"),c=e("../../const");i.prototype=Object.create(r.prototype),i.prototype.constructor=i,t.exports=i,a.pluginTarget.mixin(i),i.prototype.render=function(e){this.emit("prerender");var t=e.parent;this._lastObjectRendered=e,e.parent=this._tempDisplayObjectParent,e.updateTransform(),e.parent=t,this.context.setTransform(1,0,0,1,0,0),this.context.globalAlpha=1,this.context.globalCompositeOperation=this.blendModes[c.BLEND_MODES.NORMAL],navigator.isCocoonJS&&this.view.screencanvas&&(this.context.fillStyle="black",this.context.clear()),this.clearBeforeRender&&(this.transparent?this.context.clearRect(0,0,this.width,this.height):(this.context.fillStyle=this._backgroundColorString,this.context.fillRect(0,0,this.width,this.height))),this.renderDisplayObject(e,this.context),this.emit("postrender")},i.prototype.destroy=function(e){this.destroyPlugins(),r.prototype.destroy.call(this,e),this.context=null,this.refresh=!0,this.maskManager.destroy(),this.maskManager=null,this.smoothProperty=null},i.prototype.renderDisplayObject=function(e,t){var n=this.context;this.context=t,e.renderCanvas(this),this.context=n},i.prototype.resize=function(e,t){r.prototype.resize.call(this,e,t),this.smoothProperty&&(this.context[this.smoothProperty]=c.SCALE_MODES.DEFAULT===c.SCALE_MODES.LINEAR)},i.prototype._mapBlendModes=function(){this.blendModes||(this.blendModes={},a.canUseNewCanvasBlendModes()?(this.blendModes[c.BLEND_MODES.NORMAL]="source-over",this.blendModes[c.BLEND_MODES.ADD]="lighter",this.blendModes[c.BLEND_MODES.MULTIPLY]="multiply",this.blendModes[c.BLEND_MODES.SCREEN]="screen",this.blendModes[c.BLEND_MODES.OVERLAY]="overlay",this.blendModes[c.BLEND_MODES.DARKEN]="darken",this.blendModes[c.BLEND_MODES.LIGHTEN]="lighten",this.blendModes[c.BLEND_MODES.COLOR_DODGE]="color-dodge",this.blendModes[c.BLEND_MODES.COLOR_BURN]="color-burn",this.blendModes[c.BLEND_MODES.HARD_LIGHT]="hard-light",this.blendModes[c.BLEND_MODES.SOFT_LIGHT]="soft-light",this.blendModes[c.BLEND_MODES.DIFFERENCE]="difference",this.blendModes[c.BLEND_MODES.EXCLUSION]="exclusion",this.blendModes[c.BLEND_MODES.HUE]="hue",this.blendModes[c.BLEND_MODES.SATURATION]="saturate",this.blendModes[c.BLEND_MODES.COLOR]="color",this.blendModes[c.BLEND_MODES.LUMINOSITY]="luminosity"):(this.blendModes[c.BLEND_MODES.NORMAL]="source-over",this.blendModes[c.BLEND_MODES.ADD]="lighter",this.blendModes[c.BLEND_MODES.MULTIPLY]="source-over",this.blendModes[c.BLEND_MODES.SCREEN]="source-over",this.blendModes[c.BLEND_MODES.OVERLAY]="source-over",this.blendModes[c.BLEND_MODES.DARKEN]="source-over",this.blendModes[c.BLEND_MODES.LIGHTEN]="source-over",this.blendModes[c.BLEND_MODES.COLOR_DODGE]="source-over",this.blendModes[c.BLEND_MODES.COLOR_BURN]="source-over",this.blendModes[c.BLEND_MODES.HARD_LIGHT]="source-over",this.blendModes[c.BLEND_MODES.SOFT_LIGHT]="source-over",this.blendModes[c.BLEND_MODES.DIFFERENCE]="source-over",this.blendModes[c.BLEND_MODES.EXCLUSION]="source-over",this.blendModes[c.BLEND_MODES.HUE]="source-over",this.blendModes[c.BLEND_MODES.SATURATION]="source-over",this.blendModes[c.BLEND_MODES.COLOR]="source-over",this.blendModes[c.BLEND_MODES.LUMINOSITY]="source-over"))}},{"../../const":22,"../../math":33,"../../utils":77,"../SystemRenderer":43,"./utils/CanvasMaskManager":47}],45:[function(e,t,n){function i(e,t){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.width=e,this.canvas.height=t}i.prototype.constructor=i,t.exports=i,Object.defineProperties(i.prototype,{width:{get:function(){return this.canvas.width},set:function(e){this.canvas.width=e}},height:{get:function(){return this.canvas.height},set:function(e){this.canvas.height=e}}}),i.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},i.prototype.resize=function(e,t){this.canvas.width=e,this.canvas.height=t},i.prototype.destroy=function(){this.context=null,this.canvas=null}},{}],46:[function(e,t,n){var i=e("../../../const"),r={};t.exports=r,r.renderGraphics=function(e,t){var n=e.worldAlpha;e.dirty&&(this.updateGraphicsTint(e),e.dirty=!1);for(var r=0;r<e.graphicsData.length;r++){var o=e.graphicsData[r],a=o.shape,s=o._fillTint,c=o._lineTint;if(t.lineWidth=o.lineWidth,o.type===i.SHAPES.POLY){t.beginPath();var l=a.points;t.moveTo(l[0],l[1]);for(var u=1;u<l.length/2;u++)t.lineTo(l[2*u],l[2*u+1]);a.closed&&t.lineTo(l[0],l[1]),l[0]===l[l.length-2]&&l[1]===l[l.length-1]&&t.closePath(),o.fill&&(t.globalAlpha=o.fillAlpha*n,t.fillStyle="#"+("00000"+(0|s).toString(16)).substr(-6),t.fill()),o.lineWidth&&(t.globalAlpha=o.lineAlpha*n,t.strokeStyle="#"+("00000"+(0|c).toString(16)).substr(-6),t.stroke())}else if(o.type===i.SHAPES.RECT)(o.fillColor||0===o.fillColor)&&(t.globalAlpha=o.fillAlpha*n,t.fillStyle="#"+("00000"+(0|s).toString(16)).substr(-6),t.fillRect(a.x,a.y,a.width,a.height)),o.lineWidth&&(t.globalAlpha=o.lineAlpha*n,t.strokeStyle="#"+("00000"+(0|c).toString(16)).substr(-6),t.strokeRect(a.x,a.y,a.width,a.height));else if(o.type===i.SHAPES.CIRC)t.beginPath(),t.arc(a.x,a.y,a.radius,0,2*Math.PI),t.closePath(),o.fill&&(t.globalAlpha=o.fillAlpha*n,t.fillStyle="#"+("00000"+(0|s).toString(16)).substr(-6),t.fill()),o.lineWidth&&(t.globalAlpha=o.lineAlpha*n,t.strokeStyle="#"+("00000"+(0|c).toString(16)).substr(-6),t.stroke());else if(o.type===i.SHAPES.ELIP){var h=2*a.width,d=2*a.height,p=a.x-h/2,f=a.y-d/2;t.beginPath();var m=h/2*.5522848,g=d/2*.5522848,v=p+h,y=f+d,b=p+h/2,w=f+d/2;t.moveTo(p,w),t.bezierCurveTo(p,w-g,b-m,f,b,f),t.bezierCurveTo(b+m,f,v,w-g,v,w),t.bezierCurveTo(v,w+g,b+m,y,b,y),t.bezierCurveTo(b-m,y,p,w+g,p,w),t.closePath(),o.fill&&(t.globalAlpha=o.fillAlpha*n,t.fillStyle="#"+("00000"+(0|s).toString(16)).substr(-6),t.fill()),o.lineWidth&&(t.globalAlpha=o.lineAlpha*n,t.strokeStyle="#"+("00000"+(0|c).toString(16)).substr(-6),t.stroke())}else if(o.type===i.SHAPES.RREC){var x=a.x,E=a.y,S=a.width,_=a.height,T=a.radius,M=Math.min(S,_)/2|0;T=T>M?M:T,t.beginPath(),t.moveTo(x,E+T),t.lineTo(x,E+_-T),t.quadraticCurveTo(x,E+_,x+T,E+_),t.lineTo(x+S-T,E+_),t.quadraticCurveTo(x+S,E+_,x+S,E+_-T),t.lineTo(x+S,E+T),t.quadraticCurveTo(x+S,E,x+S-T,E),t.lineTo(x+T,E),t.quadraticCurveTo(x,E,x,E+T),t.closePath(),(o.fillColor||0===o.fillColor)&&(t.globalAlpha=o.fillAlpha*n,t.fillStyle="#"+("00000"+(0|s).toString(16)).substr(-6),t.fill()),o.lineWidth&&(t.globalAlpha=o.lineAlpha*n,t.strokeStyle="#"+("00000"+(0|c).toString(16)).substr(-6),t.stroke())}}},r.renderGraphicsMask=function(e,t){var n=e.graphicsData.length;if(0!==n){t.beginPath();for(var r=0;r<n;r++){var o=e.graphicsData[r],a=o.shape;if(o.type===i.SHAPES.POLY){var s=a.points;t.moveTo(s[0],s[1]);for(var c=1;c<s.length/2;c++)t.lineTo(s[2*c],s[2*c+1]);s[0]===s[s.length-2]&&s[1]===s[s.length-1]&&t.closePath()}else if(o.type===i.SHAPES.RECT)t.rect(a.x,a.y,a.width,a.height),t.closePath();else if(o.type===i.SHAPES.CIRC)t.arc(a.x,a.y,a.radius,0,2*Math.PI),t.closePath();else if(o.type===i.SHAPES.ELIP){var l=2*a.width,u=2*a.height,h=a.x-l/2,d=a.y-u/2,p=l/2*.5522848,f=u/2*.5522848,m=h+l,g=d+u,v=h+l/2,y=d+u/2;t.moveTo(h,y),t.bezierCurveTo(h,y-f,v-p,d,v,d),t.bezierCurveTo(v+p,d,m,y-f,m,y),t.bezierCurveTo(m,y+f,v+p,g,v,g),t.bezierCurveTo(v-p,g,h,y+f,h,y),t.closePath()}else if(o.type===i.SHAPES.RREC){var b=a.x,w=a.y,x=a.width,E=a.height,S=a.radius,_=Math.min(x,E)/2|0;S=S>_?_:S,t.moveTo(b,w+S),t.lineTo(b,w+E-S),t.quadraticCurveTo(b,w+E,b+S,w+E),t.lineTo(b+x-S,w+E),t.quadraticCurveTo(b+x,w+E,b+x,w+E-S),t.lineTo(b+x,w+S),t.quadraticCurveTo(b+x,w,b+x-S,w),t.lineTo(b+S,w),t.quadraticCurveTo(b,w,b,w+S),t.closePath()}}}},r.updateGraphicsTint=function(e){if(16777215!==e.tint||e._prevTint!==e.tint){e._prevTint=e.tint;for(var t=(e.tint>>16&255)/255,n=(e.tint>>8&255)/255,i=(255&e.tint)/255,r=0;r<e.graphicsData.length;r++){var o=e.graphicsData[r],a=0|o.fillColor,s=0|o.lineColor;o._fillTint=((a>>16&255)/255*t*255<<16)+((a>>8&255)/255*n*255<<8)+(255&a)/255*i*255,o._lineTint=((s>>16&255)/255*t*255<<16)+((s>>8&255)/255*n*255<<8)+(255&s)/255*i*255}}}},{"../../../const":22}],47:[function(e,t,n){function i(){}var r=e("./CanvasGraphics");i.prototype.constructor=i,t.exports=i,i.prototype.pushMask=function(e,t){t.context.save();var n=e.alpha,i=e.worldTransform,o=t.resolution;t.context.setTransform(i.a*o,i.b*o,i.c*o,i.d*o,i.tx*o,i.ty*o),e.texture||(r.renderGraphicsMask(e,t.context),t.context.clip()),e.worldAlpha=n},i.prototype.popMask=function(e){e.context.restore()},i.prototype.destroy=function(){}},{"./CanvasGraphics":46}],48:[function(e,t,n){var i=e("../../../utils"),r={};t.exports=r,r.getTintedTexture=function(e,t){var n=e.texture,i="#"+("00000"+(0|(t=r.roundColor(t))).toString(16)).substr(-6);if(n.tintCache=n.tintCache||{},n.tintCache[i])return n.tintCache[i];var o=r.canvas||document.createElement("canvas");if(r.tintMethod(n,t,o),r.convertTintToImage){var a=new Image;a.src=o.toDataURL(),n.tintCache[i]=a}else n.tintCache[i]=o,r.canvas=null;return o},r.tintWithMultiply=function(e,t,n){var i=n.getContext("2d"),r=e.baseTexture.resolution,o=e.crop.clone();o.x*=r,o.y*=r,o.width*=r,o.height*=r,n.width=o.width,n.height=o.height,i.fillStyle="#"+("00000"+(0|t).toString(16)).substr(-6),i.fillRect(0,0,o.width,o.height),i.globalCompositeOperation="multiply",i.drawImage(e.baseTexture.source,o.x,o.y,o.width,o.height,0,0,o.width,o.height),i.globalCompositeOperation="destination-atop",i.drawImage(e.baseTexture.source,o.x,o.y,o.width,o.height,0,0,o.width,o.height)},r.tintWithOverlay=function(e,t,n){var i=n.getContext("2d"),r=e.baseTexture.resolution,o=e.crop.clone();o.x*=r,o.y*=r,o.width*=r,o.height*=r,n.width=o.width,n.height=o.height,i.globalCompositeOperation="copy",i.fillStyle="#"+("00000"+(0|t).toString(16)).substr(-6),i.fillRect(0,0,o.width,o.height),i.globalCompositeOperation="destination-atop",i.drawImage(e.baseTexture.source,o.x,o.y,o.width,o.height,0,0,o.width,o.height)},r.tintWithPerPixel=function(e,t,n){var r=n.getContext("2d"),o=e.baseTexture.resolution,a=e.crop.clone();a.x*=o,a.y*=o,a.width*=o,a.height*=o,n.width=a.width,n.height=a.height,r.globalCompositeOperation="copy",r.drawImage(e.baseTexture.source,a.x,a.y,a.width,a.height,0,0,a.width,a.height);for(var s=i.hex2rgb(t),c=s[0],l=s[1],u=s[2],h=r.getImageData(0,0,a.width,a.height),d=h.data,p=0;p<d.length;p+=4)d[p+0]*=c,d[p+1]*=l,d[p+2]*=u;r.putImageData(h,0,0)},r.roundColor=function(e){var t=r.cacheStepsPerColorChannel,n=i.hex2rgb(e);return n[0]=Math.min(255,n[0]/t*t),n[1]=Math.min(255,n[1]/t*t),n[2]=Math.min(255,n[2]/t*t),i.rgb2hex(n)},r.cacheStepsPerColorChannel=8,r.convertTintToImage=!1,r.canUseMultiply=i.canUseNewCanvasBlendModes(),r.tintMethod=r.canUseMultiply?r.tintWithMultiply:r.tintWithPerPixel},{"../../../utils":77}],49:[function(e,t,n){function i(e,t,n){n=n||{},r.call(this,"WebGL",e,t,n),this.type=f.RENDERER_TYPE.WEBGL,this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this),this.view.addEventListener("webglcontextlost",this.handleContextLost,!1),this.view.addEventListener("webglcontextrestored",this.handleContextRestored,!1),this._useFXAA=!!n.forceFXAA&&n.antialias,this._FXAAFilter=null,this._contextOptions={alpha:this.transparent,antialias:n.antialias,premultipliedAlpha:this.transparent&&"notMultiplied"!==this.transparent,stencil:!0,preserveDrawingBuffer:n.preserveDrawingBuffer},this.drawCount=0,this.shaderManager=new o(this),this.maskManager=new a(this),this.stencilManager=new s(this),this.filterManager=new c(this),this.blendModeManager=new l(this),this.currentRenderTarget=null,this.currentRenderer=new h(this),this.initPlugins(),this._createContext(),this._initContext(),this._mapGlModes(),this._managedTextures=[],this._renderTargetStack=[]}var r=e("../SystemRenderer"),o=e("./managers/ShaderManager"),a=e("./managers/MaskManager"),s=e("./managers/StencilManager"),c=e("./managers/FilterManager"),l=e("./managers/BlendModeManager"),u=e("./utils/RenderTarget"),h=e("./utils/ObjectRenderer"),d=e("./filters/FXAAFilter"),p=e("../../utils"),f=e("../../const");i.prototype=Object.create(r.prototype),i.prototype.constructor=i,t.exports=i,p.pluginTarget.mixin(i),i.glContextId=0,i.prototype._createContext=function(){var e=this.view.getContext("webgl",this._contextOptions)||this.view.getContext("experimental-webgl",this._contextOptions);if(this.gl=e,!e)throw new Error("This browser does not support webGL. Try using the canvas renderer");this.glContextId=i.glContextId++,e.id=this.glContextId,e.renderer=this},i.prototype._initContext=function(){var e=this.gl;e.disable(e.DEPTH_TEST),e.disable(e.CULL_FACE),e.enable(e.BLEND),this.renderTarget=new u(e,this.width,this.height,null,this.resolution,!0),this.setRenderTarget(this.renderTarget),this.emit("context",e),this.resize(this.width,this.height),this._useFXAA||(this._useFXAA=this._contextOptions.antialias&&!e.getContextAttributes().antialias),this._useFXAA&&(window.console.warn("FXAA antialiasing being used instead of native antialiasing"),this._FXAAFilter=[new d])},i.prototype.render=function(e){if(this.emit("prerender"),!this.gl.isContextLost()){this.drawCount=0,this._lastObjectRendered=e,this._useFXAA&&(this._FXAAFilter[0].uniforms.resolution.value.x=this.width,this._FXAAFilter[0].uniforms.resolution.value.y=this.height,e.filterArea=this.renderTarget.size,e.filters=this._FXAAFilter);var t=e.parent;e.parent=this._tempDisplayObjectParent,e.updateTransform(),e.parent=t;var n=this.gl;this.setRenderTarget(this.renderTarget),this.clearBeforeRender&&(this.transparent?n.clearColor(0,0,0,0):n.clearColor(this._backgroundColorRgb[0],this._backgroundColorRgb[1],this._backgroundColorRgb[2],1),n.clear(n.COLOR_BUFFER_BIT)),this.renderDisplayObject(e,this.renderTarget),this.emit("postrender")}},i.prototype.renderDisplayObject=function(e,t,n){this.setRenderTarget(t),n&&t.clear(),this.filterManager.setFilterStack(t.filterStack),e.renderWebGL(this),this.currentRenderer.flush()},i.prototype.setObjectRenderer=function(e){this.currentRenderer!==e&&(this.currentRenderer.stop(),this.currentRenderer=e,this.currentRenderer.start())},i.prototype.setRenderTarget=function(e){this.currentRenderTarget!==e&&(this.currentRenderTarget=e,this.currentRenderTarget.activate(),this.stencilManager.setMaskStack(e.stencilMaskStack))},i.prototype.resize=function(e,t){r.prototype.resize.call(this,e,t),this.filterManager.resize(e,t),this.renderTarget.resize(e,t),this.currentRenderTarget===this.renderTarget&&(this.renderTarget.activate(),this.gl.viewport(0,0,this.width,this.height))},i.prototype.updateTexture=function(e){if((e=e.baseTexture||e).hasLoaded){var t=this.gl;return e._glTextures[t.id]||(e._glTextures[t.id]=t.createTexture(),e.on("update",this.updateTexture,this),e.on("dispose",this.destroyTexture,this),this._managedTextures.push(e)),t.bindTexture(t.TEXTURE_2D,e._glTextures[t.id]),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultipliedAlpha),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e.source),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,e.scaleMode===f.SCALE_MODES.LINEAR?t.LINEAR:t.NEAREST),e.mipmap&&e.isPowerOfTwo?(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,e.scaleMode===f.SCALE_MODES.LINEAR?t.LINEAR_MIPMAP_LINEAR:t.NEAREST_MIPMAP_NEAREST),t.generateMipmap(t.TEXTURE_2D)):t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,e.scaleMode===f.SCALE_MODES.LINEAR?t.LINEAR:t.NEAREST),e.isPowerOfTwo?(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT)):(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)),e._glTextures[t.id]}},i.prototype.destroyTexture=function(e,t){if((e=e.baseTexture||e).hasLoaded&&e._glTextures[this.gl.id]&&(this.gl.deleteTexture(e._glTextures[this.gl.id]),delete e._glTextures[this.gl.id],!t)){var n=this._managedTextures.indexOf(e);-1!==n&&p.removeItems(this._managedTextures,n,1)}},i.prototype.handleContextLost=function(e){e.preventDefault()},i.prototype.handleContextRestored=function(){this._initContext();for(var e=0;e<this._managedTextures.length;++e){var t=this._managedTextures[e];t._glTextures[this.gl.id]&&delete t._glTextures[this.gl.id]}},i.prototype.destroy=function(e){this.destroyPlugins(),this.view.removeEventListener("webglcontextlost",this.handleContextLost),this.view.removeEventListener("webglcontextrestored",this.handleContextRestored);for(var t=0;t<this._managedTextures.length;++t){var n=this._managedTextures[t];this.destroyTexture(n,!0),n.off("update",this.updateTexture,this),n.off("dispose",this.destroyTexture,this)}r.prototype.destroy.call(this,e),this.uid=0,this.shaderManager.destroy(),this.maskManager.destroy(),this.stencilManager.destroy(),this.filterManager.destroy(),this.blendModeManager.destroy(),this.shaderManager=null,this.maskManager=null,this.filterManager=null,this.blendModeManager=null,this.currentRenderer=null,this.handleContextLost=null,this.handleContextRestored=null,this._contextOptions=null,this._managedTextures=null,this.drawCount=0,this.gl.useProgram(null),this.gl=null},i.prototype._mapGlModes=function(){var e=this.gl;this.blendModes||(this.blendModes={},this.blendModes[f.BLEND_MODES.NORMAL]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],
this.blendModes[f.BLEND_MODES.ADD]=[e.ONE,e.DST_ALPHA],this.blendModes[f.BLEND_MODES.MULTIPLY]=[e.DST_COLOR,e.ONE_MINUS_SRC_ALPHA],this.blendModes[f.BLEND_MODES.SCREEN]=[e.ONE,e.ONE_MINUS_SRC_COLOR],this.blendModes[f.BLEND_MODES.OVERLAY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],this.blendModes[f.BLEND_MODES.DARKEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],this.blendModes[f.BLEND_MODES.LIGHTEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],this.blendModes[f.BLEND_MODES.COLOR_DODGE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],this.blendModes[f.BLEND_MODES.COLOR_BURN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],this.blendModes[f.BLEND_MODES.HARD_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],this.blendModes[f.BLEND_MODES.SOFT_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],this.blendModes[f.BLEND_MODES.DIFFERENCE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],this.blendModes[f.BLEND_MODES.EXCLUSION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],this.blendModes[f.BLEND_MODES.HUE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],this.blendModes[f.BLEND_MODES.SATURATION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],this.blendModes[f.BLEND_MODES.COLOR]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],this.blendModes[f.BLEND_MODES.LUMINOSITY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA]),this.drawModes||(this.drawModes={},this.drawModes[f.DRAW_MODES.POINTS]=e.POINTS,this.drawModes[f.DRAW_MODES.LINES]=e.LINES,this.drawModes[f.DRAW_MODES.LINE_LOOP]=e.LINE_LOOP,this.drawModes[f.DRAW_MODES.LINE_STRIP]=e.LINE_STRIP,this.drawModes[f.DRAW_MODES.TRIANGLES]=e.TRIANGLES,this.drawModes[f.DRAW_MODES.TRIANGLE_STRIP]=e.TRIANGLE_STRIP,this.drawModes[f.DRAW_MODES.TRIANGLE_FAN]=e.TRIANGLE_FAN)}},{"../../const":22,"../../utils":77,"../SystemRenderer":43,"./filters/FXAAFilter":51,"./managers/BlendModeManager":53,"./managers/FilterManager":54,"./managers/MaskManager":55,"./managers/ShaderManager":56,"./managers/StencilManager":57,"./utils/ObjectRenderer":63,"./utils/RenderTarget":65}],50:[function(e,t,n){function i(e,t,n){this.shaders=[],this.padding=0,this.uniforms=n||{},this.vertexSrc=e||r.defaultVertexSrc,this.fragmentSrc=t||r.defaultFragmentSrc}var r=e("../shaders/TextureShader");i.prototype.constructor=i,t.exports=i,i.prototype.getShader=function(e){var t=e.gl,n=this.shaders[t.id];return n||(n=new r(e.shaderManager,this.vertexSrc,this.fragmentSrc,this.uniforms,this.attributes),this.shaders[t.id]=n),n},i.prototype.applyFilter=function(e,t,n,i){var r=this.getShader(e);e.filterManager.applyFilter(r,t,n,i)},i.prototype.syncUniform=function(e){for(var t=0,n=this.shaders.length;t<n;++t)this.shaders[t].syncUniform(e)}},{"../shaders/TextureShader":62}],51:[function(e,t,n){function i(){r.call(this,"\nprecision mediump float;\n\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform mat3 projectionMatrix;\nuniform vec2 resolution;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvarying vec2 vResolution;\n\n//texcoords computed in vertex step\n//to avoid dependent texture reads\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\n\nvoid texcoords(vec2 fragCoord, vec2 resolution,\n            out vec2 v_rgbNW, out vec2 v_rgbNE,\n            out vec2 v_rgbSW, out vec2 v_rgbSE,\n            out vec2 v_rgbM) {\n    vec2 inverseVP = 1.0 / resolution.xy;\n    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\n    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\n    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\n    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\n    v_rgbM = vec2(fragCoord * inverseVP);\n}\n\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n   vColor = vec4(aColor.rgb * aColor.a, aColor.a);\n   vResolution = resolution;\n\n   //compute the texture coords and send them to varyings\n   texcoords(aTextureCoord * resolution, resolution, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}\n",'precision lowp float;\n\n\n/**\nBasic FXAA implementation based on the code on geeks3d.com with the\nmodification that the texture2DLod stuff was removed since it\'s\nunsupported by WebGL.\n\n--\n\nFrom:\nhttps://github.com/mitsuhiko/webgl-meincraft\n\nCopyright (c) 2011 by Armin Ronacher.\n\nSome rights reserved.\n\nRedistribution and use in source and binary forms, with or without\nmodification, are permitted provided that the following conditions are\nmet:\n\n    * Redistributions of source code must retain the above copyright\n      notice, this list of conditions and the following disclaimer.\n\n    * Redistributions in binary form must reproduce the above\n      copyright notice, this list of conditions and the following\n      disclaimer in the documentation and/or other materials provided\n      with the distribution.\n\n    * The names of the contributors may not be used to endorse or\n      promote products derived from this software without specific\n      prior written permission.\n\nTHIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n"AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\nLIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\nA PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\nOWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\nSPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\nLIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\nDATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\nTHEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\nOF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n#ifndef FXAA_REDUCE_MIN\n    #define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n    #define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n    #define FXAA_SPAN_MAX     8.0\n#endif\n\n//optimized version for mobile, where dependent\n//texture reads can be a bottleneck\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 resolution,\n            vec2 v_rgbNW, vec2 v_rgbNE,\n            vec2 v_rgbSW, vec2 v_rgbSE,\n            vec2 v_rgbM) {\n    vec4 color;\n    mediump vec2 inverseVP = vec2(1.0 / resolution.x, 1.0 / resolution.y);\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\n    vec4 texColor = texture2D(tex, v_rgbM);\n    vec3 rgbM  = texColor.xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n    mediump vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n\n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n              dir * rcpDirMin)) * inverseVP;\n\n    vec3 rgbA = 0.5 * (\n        texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n        texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n        texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n        texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n\n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, texColor.a);\n    else\n        color = vec4(rgbB, texColor.a);\n    return color;\n}\n\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying vec2 vResolution;\n\n//texcoords computed in vertex step\n//to avoid dependent texture reads\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nuniform sampler2D uSampler;\n\n\nvoid main(void){\n\n    gl_FragColor = fxaa(uSampler, vTextureCoord * vResolution, vResolution, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n\n}\n',{resolution:{type:"v2",value:{x:1,y:1}}})}var r=e("./AbstractFilter");i.prototype=Object.create(r.prototype),i.prototype.constructor=i,t.exports=i,i.prototype.applyFilter=function(e,t,n){var i=e.filterManager,r=this.getShader(e);i.applyFilter(r,t,n)}},{"./AbstractFilter":50}],52:[function(e,t,n){function i(e){var t=new o.Matrix;r.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n    vColor = vec4(aColor.rgb * aColor.a, aColor.a);\n}\n","precision lowp float;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\nuniform float alpha;\nuniform sampler2D mask;\n\nvoid main(void)\n{\n    // check clip! this will stop the mask bleeding out from the edges\n    vec2 text = abs( vMaskCoord - 0.5 );\n    text = step(0.5, text);\n    float clip = 1.0 - max(text.y, text.x);\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n    original *= (masky.r * masky.a * alpha * clip);\n    gl_FragColor = original;\n}\n",{mask:{type:"sampler2D",value:e._texture},alpha:{type:"f",value:1},otherMatrix:{type:"mat3",value:t.toArray(!0)}}),this.maskSprite=e,this.maskMatrix=t}var r=e("./AbstractFilter"),o=e("../../../math");i.prototype=Object.create(r.prototype),i.prototype.constructor=i,t.exports=i,i.prototype.applyFilter=function(e,t,n){var i=e.filterManager;this.uniforms.mask.value=this.maskSprite._texture,i.calculateMappedMatrix(t.frame,this.maskSprite,this.maskMatrix),this.uniforms.otherMatrix.value=this.maskMatrix.toArray(!0),this.uniforms.alpha.value=this.maskSprite.worldAlpha;var r=this.getShader(e);i.applyFilter(r,t,n)},Object.defineProperties(i.prototype,{map:{get:function(){return this.uniforms.mask.value},set:function(e){this.uniforms.mask.value=e}},offset:{get:function(){return this.uniforms.offset.value},set:function(e){this.uniforms.offset.value=e}}})},{"../../../math":33,"./AbstractFilter":50}],53:[function(e,t,n){function i(e){r.call(this,e),this.currentBlendMode=99999}var r=e("./WebGLManager");i.prototype=Object.create(r.prototype),i.prototype.constructor=i,t.exports=i,i.prototype.setBlendMode=function(e){if(this.currentBlendMode===e)return!1;this.currentBlendMode=e;var t=this.renderer.blendModes[this.currentBlendMode];return this.renderer.gl.blendFunc(t[0],t[1]),!0}},{"./WebGLManager":58}],54:[function(e,t,n){function i(e){r.call(this,e),this.filterStack=[],this.filterStack.push({renderTarget:e.currentRenderTarget,filter:[],bounds:null}),this.texturePool=[],this.textureSize=new c.Rectangle(0,0,e.width,e.height),this.currentFrame=null}var r=e("./WebGLManager"),o=e("../utils/RenderTarget"),a=e("../../../const"),s=e("../utils/Quad"),c=e("../../../math");i.prototype=Object.create(r.prototype),i.prototype.constructor=i,t.exports=i,i.prototype.onContextChange=function(){this.texturePool.length=0;var e=this.renderer.gl;this.quad=new s(e)},i.prototype.setFilterStack=function(e){this.filterStack=e},i.prototype.pushFilter=function(e,t){var n=e.filterArea?e.filterArea.clone():e.getBounds();n.x=0|n.x,n.y=0|n.y,n.width=0|n.width,n.height=0|n.height;var i=0|t[0].padding;if(n.x-=i,n.y-=i,n.width+=2*i,n.height+=2*i,this.renderer.currentRenderTarget.transform){var r=this.renderer.currentRenderTarget.transform;n.x+=r.tx,n.y+=r.ty,this.capFilterArea(n),n.x-=r.tx,n.y-=r.ty}else this.capFilterArea(n);if(n.width>0&&n.height>0){this.currentFrame=n;var o=this.getRenderTarget();this.renderer.setRenderTarget(o),o.clear(),this.filterStack.push({renderTarget:o,filter:t})}else this.filterStack.push({renderTarget:null,filter:t})},i.prototype.popFilter=function(){var e=this.filterStack.pop(),t=this.filterStack[this.filterStack.length-1],n=e.renderTarget;if(e.renderTarget){var i=t.renderTarget,r=this.renderer.gl;this.currentFrame=n.frame,this.quad.map(this.textureSize,n.frame),r.bindBuffer(r.ARRAY_BUFFER,this.quad.vertexBuffer),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,this.quad.indexBuffer);var o=e.filter;if(r.vertexAttribPointer(this.renderer.shaderManager.defaultShader.attributes.aVertexPosition,2,r.FLOAT,!1,0,0),r.vertexAttribPointer(this.renderer.shaderManager.defaultShader.attributes.aTextureCoord,2,r.FLOAT,!1,0,32),r.vertexAttribPointer(this.renderer.shaderManager.defaultShader.attributes.aColor,4,r.FLOAT,!1,0,64),this.renderer.blendModeManager.setBlendMode(a.BLEND_MODES.NORMAL),1===o.length)o[0].uniforms.dimensions&&(o[0].uniforms.dimensions.value[0]=this.renderer.width,o[0].uniforms.dimensions.value[1]=this.renderer.height,o[0].uniforms.dimensions.value[2]=this.quad.vertices[0],o[0].uniforms.dimensions.value[3]=this.quad.vertices[5]),o[0].applyFilter(this.renderer,n,i),this.returnRenderTarget(n);else{for(var s=n,c=this.getRenderTarget(!0),l=0;l<o.length-1;l++){var u=o[l];u.uniforms.dimensions&&(u.uniforms.dimensions.value[0]=this.renderer.width,u.uniforms.dimensions.value[1]=this.renderer.height,u.uniforms.dimensions.value[2]=this.quad.vertices[0],u.uniforms.dimensions.value[3]=this.quad.vertices[5]),u.applyFilter(this.renderer,s,c);var h=s;s=c,c=h}o[o.length-1].applyFilter(this.renderer,s,i),this.returnRenderTarget(s),this.returnRenderTarget(c)}return e.filter}},i.prototype.getRenderTarget=function(e){var t=this.texturePool.pop()||new o(this.renderer.gl,this.textureSize.width,this.textureSize.height,a.SCALE_MODES.LINEAR,this.renderer.resolution*a.FILTER_RESOLUTION);return t.frame=this.currentFrame,e&&t.clear(!0),t},i.prototype.returnRenderTarget=function(e){this.texturePool.push(e)},i.prototype.applyFilter=function(e,t,n,i){var r=this.renderer.gl;this.renderer.setRenderTarget(n),i&&n.clear(),this.renderer.shaderManager.setShader(e),e.uniforms.projectionMatrix.value=this.renderer.currentRenderTarget.projectionMatrix.toArray(!0),e.syncUniforms(),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,t.texture),r.drawElements(r.TRIANGLES,6,r.UNSIGNED_SHORT,0),this.renderer.drawCount++},i.prototype.calculateMappedMatrix=function(e,t,n){var i=t.worldTransform.copy(c.Matrix.TEMP_MATRIX),r=t._texture.baseTexture,o=n.identity(),a=this.textureSize.height/this.textureSize.width;o.translate(e.x/this.textureSize.width,e.y/this.textureSize.height),o.scale(1,a);var s=this.textureSize.width/r.width,l=this.textureSize.height/r.height;return i.tx/=r.width*s,i.ty/=r.width*s,i.invert(),o.prepend(i),o.scale(1,1/a),o.scale(s,l),o.translate(t.anchor.x,t.anchor.y),o},i.prototype.capFilterArea=function(e){e.x<0&&(e.width+=e.x,e.x=0),e.y<0&&(e.height+=e.y,e.y=0),e.x+e.width>this.textureSize.width&&(e.width=this.textureSize.width-e.x),e.y+e.height>this.textureSize.height&&(e.height=this.textureSize.height-e.y)},i.prototype.resize=function(e,t){this.textureSize.width=e,this.textureSize.height=t;for(var n=0;n<this.texturePool.length;n++)this.texturePool[n].resize(e,t)},i.prototype.destroy=function(){this.quad.destroy(),r.prototype.destroy.call(this),this.filterStack=null,this.offsetY=0;for(var e=0;e<this.texturePool.length;e++)this.texturePool[e].destroy();this.texturePool=null}},{"../../../const":22,"../../../math":33,"../utils/Quad":64,"../utils/RenderTarget":65,"./WebGLManager":58}],55:[function(e,t,n){function i(e){r.call(this,e),this.stencilStack=[],this.reverse=!0,this.count=0,this.alphaMaskPool=[]}var r=e("./WebGLManager"),o=e("../filters/SpriteMaskFilter");i.prototype=Object.create(r.prototype),i.prototype.constructor=i,t.exports=i,i.prototype.pushMask=function(e,t){t.texture?this.pushSpriteMask(e,t):this.pushStencilMask(e,t)},i.prototype.popMask=function(e,t){t.texture?this.popSpriteMask(e,t):this.popStencilMask(e,t)},i.prototype.pushSpriteMask=function(e,t){var n=this.alphaMaskPool.pop();n||(n=[new o(t)]),n[0].maskSprite=t,this.renderer.filterManager.pushFilter(e,n)},i.prototype.popSpriteMask=function(){var e=this.renderer.filterManager.popFilter();this.alphaMaskPool.push(e)},i.prototype.pushStencilMask=function(e,t){this.renderer.stencilManager.pushMask(t)},i.prototype.popStencilMask=function(e,t){this.renderer.stencilManager.popMask(t)}},{"../filters/SpriteMaskFilter":52,"./WebGLManager":58}],56:[function(e,t,n){function i(e){r.call(this,e),this.maxAttibs=10,this.attribState=[],this.tempAttribState=[];for(var t=0;t<this.maxAttibs;t++)this.attribState[t]=!1;this.stack=[],this._currentId=-1,this.currentShader=null}var r=e("./WebGLManager"),o=e("../shaders/TextureShader"),a=e("../shaders/ComplexPrimitiveShader"),s=e("../shaders/PrimitiveShader"),c=e("../../../utils");i.prototype=Object.create(r.prototype),i.prototype.constructor=i,c.pluginTarget.mixin(i),t.exports=i,i.prototype.onContextChange=function(){this.initPlugins();var e=this.renderer.gl;this.maxAttibs=e.getParameter(e.MAX_VERTEX_ATTRIBS),this.attribState=[];for(var t=0;t<this.maxAttibs;t++)this.attribState[t]=!1;this.defaultShader=new o(this),this.primitiveShader=new s(this),this.complexPrimitiveShader=new a(this)},i.prototype.setAttribs=function(e){var t;for(t=0;t<this.tempAttribState.length;t++)this.tempAttribState[t]=!1;for(var n in e)this.tempAttribState[e[n]]=!0;var i=this.renderer.gl;for(t=0;t<this.attribState.length;t++)this.attribState[t]!==this.tempAttribState[t]&&(this.attribState[t]=this.tempAttribState[t],this.attribState[t]?i.enableVertexAttribArray(t):i.disableVertexAttribArray(t))},i.prototype.setShader=function(e){return this._currentId!==e.uid&&(this._currentId=e.uid,this.currentShader=e,this.renderer.gl.useProgram(e.program),this.setAttribs(e.attributes),!0)},i.prototype.destroy=function(){this.primitiveShader.destroy(),this.complexPrimitiveShader.destroy(),r.prototype.destroy.call(this),this.destroyPlugins(),this.attribState=null,this.tempAttribState=null}},{"../../../utils":77,"../shaders/ComplexPrimitiveShader":59,"../shaders/PrimitiveShader":60,"../shaders/TextureShader":62,"./WebGLManager":58}],57:[function(e,t,n){function i(e){r.call(this,e),this.stencilMaskStack=null}var r=e("./WebGLManager"),o=e("../../../utils");i.prototype=Object.create(r.prototype),i.prototype.constructor=i,t.exports=i,i.prototype.setMaskStack=function(e){this.stencilMaskStack=e;var t=this.renderer.gl;0===e.stencilStack.length?t.disable(t.STENCIL_TEST):t.enable(t.STENCIL_TEST)},i.prototype.pushStencil=function(e,t){this.renderer.currentRenderTarget.attachStencilBuffer();var n=this.renderer.gl,i=this.stencilMaskStack;this.bindGraphics(e,t),0===i.stencilStack.length&&(n.enable(n.STENCIL_TEST),n.clear(n.STENCIL_BUFFER_BIT),i.reverse=!0,i.count=0),i.stencilStack.push(t);var r=i.count;n.colorMask(!1,!1,!1,!1),n.stencilFunc(n.ALWAYS,0,255),n.stencilOp(n.KEEP,n.KEEP,n.INVERT),1===t.mode?(n.drawElements(n.TRIANGLE_FAN,t.indices.length-4,n.UNSIGNED_SHORT,0),i.reverse?(n.stencilFunc(n.EQUAL,255-r,255),n.stencilOp(n.KEEP,n.KEEP,n.DECR)):(n.stencilFunc(n.EQUAL,r,255),n.stencilOp(n.KEEP,n.KEEP,n.INCR)),n.drawElements(n.TRIANGLE_FAN,4,n.UNSIGNED_SHORT,2*(t.indices.length-4)),i.reverse?n.stencilFunc(n.EQUAL,255-(r+1),255):n.stencilFunc(n.EQUAL,r+1,255),i.reverse=!i.reverse):(i.reverse?(n.stencilFunc(n.EQUAL,r,255),n.stencilOp(n.KEEP,n.KEEP,n.INCR)):(n.stencilFunc(n.EQUAL,255-r,255),n.stencilOp(n.KEEP,n.KEEP,n.DECR)),n.drawElements(n.TRIANGLE_STRIP,t.indices.length,n.UNSIGNED_SHORT,0),i.reverse?n.stencilFunc(n.EQUAL,r+1,255):n.stencilFunc(n.EQUAL,255-(r+1),255)),n.colorMask(!0,!0,!0,!0),n.stencilOp(n.KEEP,n.KEEP,n.KEEP),i.count++},i.prototype.bindGraphics=function(e,t){var n,i=this.renderer.gl;1===t.mode?(n=this.renderer.shaderManager.complexPrimitiveShader,this.renderer.shaderManager.setShader(n),i.uniformMatrix3fv(n.uniforms.translationMatrix._location,!1,e.worldTransform.toArray(!0)),i.uniformMatrix3fv(n.uniforms.projectionMatrix._location,!1,this.renderer.currentRenderTarget.projectionMatrix.toArray(!0)),i.uniform3fv(n.uniforms.tint._location,o.hex2rgb(e.tint)),i.uniform3fv(n.uniforms.color._location,t.color),i.uniform1f(n.uniforms.alpha._location,e.worldAlpha),i.bindBuffer(i.ARRAY_BUFFER,t.buffer),i.vertexAttribPointer(n.attributes.aVertexPosition,2,i.FLOAT,!1,8,0),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,t.indexBuffer)):(n=this.renderer.shaderManager.primitiveShader,this.renderer.shaderManager.setShader(n),i.uniformMatrix3fv(n.uniforms.translationMatrix._location,!1,e.worldTransform.toArray(!0)),i.uniformMatrix3fv(n.uniforms.projectionMatrix._location,!1,this.renderer.currentRenderTarget.projectionMatrix.toArray(!0)),i.uniform3fv(n.uniforms.tint._location,o.hex2rgb(e.tint)),i.uniform1f(n.uniforms.alpha._location,e.worldAlpha),i.bindBuffer(i.ARRAY_BUFFER,t.buffer),i.vertexAttribPointer(n.attributes.aVertexPosition,2,i.FLOAT,!1,24,0),i.vertexAttribPointer(n.attributes.aColor,4,i.FLOAT,!1,24,8),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,t.indexBuffer))},i.prototype.popStencil=function(e,t){var n=this.renderer.gl,i=this.stencilMaskStack;if(i.stencilStack.pop(),i.count--,0===i.stencilStack.length)n.disable(n.STENCIL_TEST);else{var r=i.count;this.bindGraphics(e,t),n.colorMask(!1,!1,!1,!1),1===t.mode?(i.reverse=!i.reverse,i.reverse?(n.stencilFunc(n.EQUAL,255-(r+1),255),n.stencilOp(n.KEEP,n.KEEP,n.INCR)):(n.stencilFunc(n.EQUAL,r+1,255),n.stencilOp(n.KEEP,n.KEEP,n.DECR)),n.drawElements(n.TRIANGLE_FAN,4,n.UNSIGNED_SHORT,2*(t.indices.length-4)),n.stencilFunc(n.ALWAYS,0,255),n.stencilOp(n.KEEP,n.KEEP,n.INVERT),n.drawElements(n.TRIANGLE_FAN,t.indices.length-4,n.UNSIGNED_SHORT,0),this.renderer.drawCount+=2,i.reverse?n.stencilFunc(n.EQUAL,r,255):n.stencilFunc(n.EQUAL,255-r,255)):(i.reverse?(n.stencilFunc(n.EQUAL,r+1,255),n.stencilOp(n.KEEP,n.KEEP,n.DECR)):(n.stencilFunc(n.EQUAL,255-(r+1),255),n.stencilOp(n.KEEP,n.KEEP,n.INCR)),n.drawElements(n.TRIANGLE_STRIP,t.indices.length,n.UNSIGNED_SHORT,0),this.renderer.drawCount++,i.reverse?n.stencilFunc(n.EQUAL,r,255):n.stencilFunc(n.EQUAL,255-r,255)),n.colorMask(!0,!0,!0,!0),n.stencilOp(n.KEEP,n.KEEP,n.KEEP)}},i.prototype.destroy=function(){r.prototype.destroy.call(this),this.stencilMaskStack.stencilStack=null},i.prototype.pushMask=function(e){this.renderer.setObjectRenderer(this.renderer.plugins.graphics),e.dirty&&this.renderer.plugins.graphics.updateGraphics(e,this.renderer.gl),e._webGL[this.renderer.gl.id].data.length&&this.pushStencil(e,e._webGL[this.renderer.gl.id].data[0])},i.prototype.popMask=function(e){this.renderer.setObjectRenderer(this.renderer.plugins.graphics),this.popStencil(e,e._webGL[this.renderer.gl.id].data[0])}},{"../../../utils":77,"./WebGLManager":58}],58:[function(e,t,n){function i(e){this.renderer=e,this.renderer.on("context",this.onContextChange,this)}i.prototype.constructor=i,t.exports=i,i.prototype.onContextChange=function(){},i.prototype.destroy=function(){this.renderer.off("context",this.onContextChange,this),this.renderer=null}},{}],59:[function(e,t,n){function i(e){r.call(this,e,["attribute vec2 aVertexPosition;","uniform mat3 translationMatrix;","uniform mat3 projectionMatrix;","uniform vec3 tint;","uniform float alpha;","uniform vec3 color;","varying vec4 vColor;","void main(void){","   gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);","   vColor = vec4(color * alpha * tint, alpha);","}"].join("\n"),["precision mediump float;","varying vec4 vColor;","void main(void){","   gl_FragColor = vColor;","}"].join("\n"),{tint:{type:"3f",value:[0,0,0]},alpha:{type:"1f",value:0},color:{type:"3f",value:[0,0,0]},translationMatrix:{type:"mat3",value:new Float32Array(9)},projectionMatrix:{type:"mat3",value:new Float32Array(9)}},{aVertexPosition:0})}var r=e("./Shader");i.prototype=Object.create(r.prototype),i.prototype.constructor=i,t.exports=i},{"./Shader":61}],60:[function(e,t,n){function i(e){r.call(this,e,["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform mat3 projectionMatrix;","uniform float alpha;","uniform float flipY;","uniform vec3 tint;","varying vec4 vColor;","void main(void){","   gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);","   vColor = aColor * vec4(tint * alpha, alpha);","}"].join("\n"),["precision mediump float;","varying vec4 vColor;","void main(void){","   gl_FragColor = vColor;","}"].join("\n"),{tint:{type:"3f",value:[0,0,0]},alpha:{type:"1f",value:0},translationMatrix:{type:"mat3",value:new Float32Array(9)},projectionMatrix:{type:"mat3",value:new Float32Array(9)}},{aVertexPosition:0,aColor:0})}var r=e("./Shader");i.prototype=Object.create(r.prototype),i.prototype.constructor=i,t.exports=i},{"./Shader":61}],61:[function(e,t,n){function i(e,t,n,i,o){if(!t||!n)throw new Error("Pixi.js Error. Shader requires vertexSrc and fragmentSrc");this.uid=r.uid(),this.gl=e.renderer.gl,this.shaderManager=e,this.program=null,this.uniforms=i||{},this.attributes=o||{},this.textureCount=1,this.vertexSrc=t,this.fragmentSrc=n,this.init()}var r=e("../../../utils");i.prototype.constructor=i,t.exports=i,i.prototype.init=function(){this.compile(),this.gl.useProgram(this.program),this.cacheUniformLocations(Object.keys(this.uniforms)),this.cacheAttributeLocations(Object.keys(this.attributes))},i.prototype.cacheUniformLocations=function(e){for(var t=0;t<e.length;++t)this.uniforms[e[t]]._location=this.gl.getUniformLocation(this.program,e[t])},i.prototype.cacheAttributeLocations=function(e){for(var t=0;t<e.length;++t)this.attributes[e[t]]=this.gl.getAttribLocation(this.program,e[t])},i.prototype.compile=function(){var e=this.gl,t=this._glCompile(e.VERTEX_SHADER,this.vertexSrc),n=this._glCompile(e.FRAGMENT_SHADER,this.fragmentSrc),i=e.createProgram();return e.attachShader(i,t),e.attachShader(i,n),e.linkProgram(i),e.getProgramParameter(i,e.LINK_STATUS)||(console.error("Pixi.js Error: Could not initialize shader."),console.error("gl.VALIDATE_STATUS",e.getProgramParameter(i,e.VALIDATE_STATUS)),console.error("gl.getError()",e.getError()),""!==e.getProgramInfoLog(i)&&console.warn("Pixi.js Warning: gl.getProgramInfoLog()",e.getProgramInfoLog(i)),e.deleteProgram(i),i=null),e.deleteShader(t),e.deleteShader(n),this.program=i},i.prototype.syncUniform=function(e){var t,n,i=e._location,o=e.value,a=this.gl;switch(e.type){case"b":case"bool":case"boolean":a.uniform1i(i,o?1:0);break;case"i":case"1i":a.uniform1i(i,o);break;case"f":case"1f":a.uniform1f(i,o);break;case"2f":a.uniform2f(i,o[0],o[1]);break;case"3f":a.uniform3f(i,o[0],o[1],o[2]);break;case"4f":a.uniform4f(i,o[0],o[1],o[2],o[3]);break;case"v2":a.uniform2f(i,o.x,o.y);break;case"v3":a.uniform3f(i,o.x,o.y,o.z);break;case"v4":a.uniform4f(i,o.x,o.y,o.z,o.w);break;case"1iv":a.uniform1iv(i,o);break;case"2iv":a.uniform2iv(i,o);break;case"3iv":a.uniform3iv(i,o);break;case"4iv":a.uniform4iv(i,o);break;case"1fv":a.uniform1fv(i,o);break;case"2fv":a.uniform2fv(i,o);break;case"3fv":a.uniform3fv(i,o);break;case"4fv":a.uniform4fv(i,o);break;case"m2":case"mat2":case"Matrix2fv":a.uniformMatrix2fv(i,e.transpose,o);break;case"m3":case"mat3":case"Matrix3fv":a.uniformMatrix3fv(i,e.transpose,o);break;case"m4":case"mat4":case"Matrix4fv":a.uniformMatrix4fv(i,e.transpose,o);break;case"c":"number"==typeof o&&(o=r.hex2rgb(o)),a.uniform3f(i,o[0],o[1],o[2]);break;case"iv1":a.uniform1iv(i,o);break;case"iv":a.uniform3iv(i,o);break;case"fv1":a.uniform1fv(i,o);break;case"fv":a.uniform3fv(i,o);break;case"v2v":for(e._array||(e._array=new Float32Array(2*o.length)),t=0,n=o.length;t<n;++t)e._array[2*t]=o[t].x,e._array[2*t+1]=o[t].y;a.uniform2fv(i,e._array);break;case"v3v":for(e._array||(e._array=new Float32Array(3*o.length)),t=0,n=o.length;t<n;++t)e._array[3*t]=o[t].x,e._array[3*t+1]=o[t].y,e._array[3*t+2]=o[t].z;a.uniform3fv(i,e._array);break;case"v4v":for(e._array||(e._array=new Float32Array(4*o.length)),t=0,n=o.length;t<n;++t)e._array[4*t]=o[t].x,e._array[4*t+1]=o[t].y,e._array[4*t+2]=o[t].z,e._array[4*t+3]=o[t].w;a.uniform4fv(i,e._array);break;case"t":case"sampler2D":if(!e.value||!e.value.baseTexture.hasLoaded)break;a.activeTexture(a["TEXTURE"+this.textureCount]);var s=e.value.baseTexture._glTextures[a.id];s||(this.initSampler2D(e),s=e.value.baseTexture._glTextures[a.id]),a.bindTexture(a.TEXTURE_2D,s),a.uniform1i(e._location,this.textureCount),this.textureCount++;break;default:console.warn("Pixi.js Shader Warning: Unknown uniform type: "+e.type)}},i.prototype.syncUniforms=function(){for(var e in this.textureCount=1,this.uniforms)this.syncUniform(this.uniforms[e])},i.prototype.initSampler2D=function(e){var t=this.gl,n=e.value.baseTexture;if(n.hasLoaded)if(e.textureData){var i=e.textureData;n._glTextures[t.id]=t.createTexture(),t.bindTexture(t.TEXTURE_2D,n._glTextures[t.id]),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultipliedAlpha),t.texImage2D(t.TEXTURE_2D,0,i.luminance?t.LUMINANCE:t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n.source),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,i.magFilter?i.magFilter:t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,i.wrapS?i.wrapS:t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,i.wrapS?i.wrapS:t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,i.wrapT?i.wrapT:t.CLAMP_TO_EDGE)}else this.shaderManager.renderer.updateTexture(n)},i.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.gl=null,this.uniforms=null,this.attributes=null,this.vertexSrc=null,this.fragmentSrc=null},i.prototype._glCompile=function(e,t){var n=this.gl.createShader(e);return this.gl.shaderSource(n,t),this.gl.compileShader(n),this.gl.getShaderParameter(n,this.gl.COMPILE_STATUS)?n:(console.log(this.gl.getShaderInfoLog(n)),null)}},{"../../../utils":77}],62:[function(e,t,n){function i(e,t,n,o,a){var s={uSampler:{type:"sampler2D",value:0},projectionMatrix:{type:"mat3",value:new Float32Array([1,0,0,0,1,0,0,0,1])}};if(o)for(var c in o)s[c]=o[c];var l={aVertexPosition:0,aTextureCoord:0,aColor:0};if(a)for(var u in a)l[u]=a[u];t=t||i.defaultVertexSrc,n=n||i.defaultFragmentSrc,r.call(this,e,t,n,s,l)}var r=e("./Shader");i.prototype=Object.create(r.prototype),i.prototype.constructor=i,t.exports=i,i.defaultVertexSrc=["precision lowp float;","attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","uniform mat3 projectionMatrix;","varying vec2 vTextureCoord;","varying vec4 vColor;","void main(void){","   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","}"].join("\n"),i.defaultFragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void){","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"].join("\n")},{"./Shader":61}],63:[function(e,t,n){function i(e){r.call(this,e)}var r=e("../managers/WebGLManager");i.prototype=Object.create(r.prototype),i.prototype.constructor=i,t.exports=i,i.prototype.start=function(){},i.prototype.stop=function(){this.flush()},i.prototype.flush=function(){},i.prototype.render=function(e){}},{"../managers/WebGLManager":58}],64:[function(e,t,n){function i(e){this.gl=e,this.vertices=new Float32Array([0,0,200,0,200,200,0,200]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.colors=new Float32Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]),this.indices=new Uint16Array([0,1,2,0,3,2]),this.vertexBuffer=e.createBuffer(),this.indexBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,128,e.DYNAMIC_DRAW),
e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indices,e.STATIC_DRAW),this.upload()}i.prototype.constructor=i,i.prototype.map=function(e,t){var n=0,i=0;this.uvs[0]=n,this.uvs[1]=i,this.uvs[2]=n+t.width/e.width,this.uvs[3]=i,this.uvs[4]=n+t.width/e.width,this.uvs[5]=i+t.height/e.height,this.uvs[6]=n,this.uvs[7]=i+t.height/e.height,n=t.x,i=t.y,this.vertices[0]=n,this.vertices[1]=i,this.vertices[2]=n+t.width,this.vertices[3]=i,this.vertices[4]=n+t.width,this.vertices[5]=i+t.height,this.vertices[6]=n,this.vertices[7]=i+t.height,this.upload()},i.prototype.upload=function(){var e=this.gl;e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferSubData(e.ARRAY_BUFFER,0,this.vertices),e.bufferSubData(e.ARRAY_BUFFER,32,this.uvs),e.bufferSubData(e.ARRAY_BUFFER,64,this.colors)},i.prototype.destroy=function(){var e=this.gl;e.deleteBuffer(this.vertexBuffer),e.deleteBuffer(this.indexBuffer)},t.exports=i},{}],65:[function(e,t,n){var i=e("../../../math"),r=e("../../../utils"),o=e("../../../const"),a=e("./StencilMaskStack"),s=function(e,t,n,s,c,l){this.gl=e,this.frameBuffer=null,this.texture=null,this.size=new i.Rectangle(0,0,1,1),this.resolution=c||o.RESOLUTION,this.projectionMatrix=new i.Matrix,this.transform=null,this.frame=null,this.stencilBuffer=null,this.stencilMaskStack=new a,this.filterStack=[{renderTarget:this,filter:[],bounds:this.size}],this.scaleMode=s||o.SCALE_MODES.DEFAULT,this.root=l,this.root||(this.frameBuffer=e.createFramebuffer(),this.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,s===o.SCALE_MODES.LINEAR?e.LINEAR:e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,s===o.SCALE_MODES.LINEAR?e.LINEAR:e.NEAREST),r.isPowerOfTwo(t,n)?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)),e.bindFramebuffer(e.FRAMEBUFFER,this.frameBuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture,0)),this.resize(t,n)};s.prototype.constructor=s,t.exports=s,s.prototype.clear=function(e){var t=this.gl;e&&t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer),t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT)},s.prototype.attachStencilBuffer=function(){if(!this.stencilBuffer&&!this.root){var e=this.gl;this.stencilBuffer=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,this.stencilBuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,this.stencilBuffer),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,this.size.width*this.resolution,this.size.height*this.resolution)}},s.prototype.activate=function(){var e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,this.frameBuffer);var t=this.frame||this.size;this.calculateProjection(t),this.transform&&this.projectionMatrix.append(this.transform),e.viewport(0,0,t.width*this.resolution,t.height*this.resolution)},s.prototype.calculateProjection=function(e){var t=this.projectionMatrix;t.identity(),this.root?(t.a=1/e.width*2,t.d=-1/e.height*2,t.tx=-1-e.x*t.a,t.ty=1-e.y*t.d):(t.a=1/e.width*2,t.d=1/e.height*2,t.tx=-1-e.x*t.a,t.ty=-1-e.y*t.d)},s.prototype.resize=function(e,t){if(e|=0,t|=0,this.size.width!==e||this.size.height!==t){if(this.size.width=e,this.size.height=t,!this.root){var n=this.gl;n.bindTexture(n.TEXTURE_2D,this.texture),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,e*this.resolution,t*this.resolution,0,n.RGBA,n.UNSIGNED_BYTE,null),this.stencilBuffer&&(n.bindRenderbuffer(n.RENDERBUFFER,this.stencilBuffer),n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,e*this.resolution,t*this.resolution))}var i=this.frame||this.size;this.calculateProjection(i)}},s.prototype.destroy=function(){var e=this.gl;e.deleteRenderbuffer(this.stencilBuffer),e.deleteFramebuffer(this.frameBuffer),e.deleteTexture(this.texture),this.frameBuffer=null,this.texture=null}},{"../../../const":22,"../../../math":33,"../../../utils":77,"./StencilMaskStack":66}],66:[function(e,t,n){function i(){this.stencilStack=[],this.reverse=!0,this.count=0}i.prototype.constructor=i,t.exports=i},{}],67:[function(e,t,n){function i(e){a.call(this),this.anchor=new r.Point,this._texture=null,this._width=0,this._height=0,this.tint=16777215,this.blendMode=l.BLEND_MODES.NORMAL,this.shader=null,this.cachedTint=16777215,this.texture=e||o.EMPTY}var r=e("../math"),o=e("../textures/Texture"),a=e("../display/Container"),s=e("../renderers/canvas/utils/CanvasTinter"),c=e("../utils"),l=e("../const"),u=new r.Point,h=r.GroupD8,d=new r.Matrix;i.prototype=Object.create(a.prototype),i.prototype.constructor=i,t.exports=i,Object.defineProperties(i.prototype,{width:{get:function(){return Math.abs(this.scale.x)*this.texture._frame.width},set:function(e){var t=c.sign(this.scale.x)||1;this.scale.x=t*e/this.texture._frame.width,this._width=e}},height:{get:function(){return Math.abs(this.scale.y)*this.texture._frame.height},set:function(e){var t=c.sign(this.scale.y)||1;this.scale.y=t*e/this.texture._frame.height,this._height=e}},texture:{get:function(){return this._texture},set:function(e){this._texture!==e&&(this._texture=e,this.cachedTint=16777215,e&&(e.baseTexture.hasLoaded?this._onTextureUpdate():e.once("update",this._onTextureUpdate,this)))}}}),i.prototype._onTextureUpdate=function(){this._width&&(this.scale.x=c.sign(this.scale.x)*this._width/this.texture.frame.width),this._height&&(this.scale.y=c.sign(this.scale.y)*this._height/this.texture.frame.height)},i.prototype._renderWebGL=function(e){e.setObjectRenderer(e.plugins.sprite),e.plugins.sprite.render(this)},i.prototype.getBounds=function(e){if(!this._currentBounds){var t,n,i,r,o=this._texture._frame.width,a=this._texture._frame.height,s=o*(1-this.anchor.x),c=o*-this.anchor.x,l=a*(1-this.anchor.y),u=a*-this.anchor.y,h=e||this.worldTransform,d=h.a,p=h.b,f=h.c,m=h.d,g=h.tx,v=h.ty,y=d*c+f*u+g,b=m*u+p*c+v,w=d*s+f*u+g,x=m*u+p*s+v,E=d*s+f*l+g,S=m*l+p*s+v,_=d*c+f*l+g,T=m*l+p*c+v;if(t=_<(t=E<(t=w<(t=y)?w:t)?E:t)?_:t,i=T<(i=S<(i=x<(i=b)?x:i)?S:i)?T:i,n=_>(n=E>(n=w>(n=y)?w:n)?E:n)?_:n,r=T>(r=S>(r=x>(r=b)?x:r)?S:r)?T:r,this.children.length){var M=this.containerGetBounds();s=M.x,c=M.x+M.width,t=t<s?t:s,i=i<(l=M.y)?i:l,n=n>c?n:c,r=r>(u=M.y+M.height)?r:u}var C=this._bounds;C.x=t,C.width=n-t,C.y=i,C.height=r-i,this._currentBounds=C}return this._currentBounds},i.prototype.getLocalBounds=function(){return this._bounds.x=-this._texture._frame.width*this.anchor.x,this._bounds.y=-this._texture._frame.height*this.anchor.y,this._bounds.width=this._texture._frame.width,this._bounds.height=this._texture._frame.height,this._bounds},i.prototype.containsPoint=function(e){this.worldTransform.applyInverse(e,u);var t,n=this._texture._frame.width,i=this._texture._frame.height,r=-n*this.anchor.x;return u.x>r&&u.x<r+n&&(t=-i*this.anchor.y,u.y>t&&u.y<t+i)},i.prototype._renderCanvas=function(e){if(!(this.texture.crop.width<=0||this.texture.crop.height<=0)){var t=e.blendModes[this.blendMode];if(t!==e.context.globalCompositeOperation&&(e.context.globalCompositeOperation=t),this.texture.valid){var n,i,r=this._texture,o=this.worldTransform,a=r.crop.width,c=r.crop.height;e.context.globalAlpha=this.worldAlpha;var u=r.baseTexture.scaleMode===l.SCALE_MODES.LINEAR;e.smoothProperty&&e.context[e.smoothProperty]!==u&&(e.context[e.smoothProperty]=u),2==(3&r.rotate)&&(a=r.crop.height,c=r.crop.width),r.trim?(n=r.crop.width/2+r.trim.x-this.anchor.x*r.trim.width,i=r.crop.height/2+r.trim.y-this.anchor.y*r.trim.height):(n=(.5-this.anchor.x)*r._frame.width,i=(.5-this.anchor.y)*r._frame.height),r.rotate&&(o.copy(d),o=d,h.matrixAppendRotationInv(o,r.rotate,n,i),n=0,i=0),n-=a/2,i-=c/2,e.roundPixels?(e.context.setTransform(o.a,o.b,o.c,o.d,o.tx*e.resolution|0,o.ty*e.resolution|0),n|=0,i|=0):e.context.setTransform(o.a,o.b,o.c,o.d,o.tx*e.resolution,o.ty*e.resolution);var p=r.baseTexture.resolution;16777215!==this.tint?(this.cachedTint!==this.tint&&(this.cachedTint=this.tint,this.tintedTexture=s.getTintedTexture(this,this.tint)),e.context.drawImage(this.tintedTexture,0,0,a*p,c*p,n*e.resolution,i*e.resolution,a*e.resolution,c*e.resolution)):e.context.drawImage(r.baseTexture.source,r.crop.x*p,r.crop.y*p,a*p,c*p,n*e.resolution,i*e.resolution,a*e.resolution,c*e.resolution)}}},i.prototype.destroy=function(e,t){a.prototype.destroy.call(this),this.anchor=null,e&&this._texture.destroy(t),this._texture=null,this.shader=null},i.fromFrame=function(e){var t=c.TextureCache[e];if(!t)throw new Error('The frameId "'+e+'" does not exist in the texture cache');return new i(t)},i.fromImage=function(e,t,n){return new i(o.fromImage(e,t,n))}},{"../const":22,"../display/Container":23,"../math":33,"../renderers/canvas/utils/CanvasTinter":48,"../textures/Texture":72,"../utils":77}],68:[function(e,t,n){function i(e){r.call(this,e),this.vertSize=5,this.vertByteSize=4*this.vertSize,this.size=a.SPRITE_BATCH_SIZE;var t=4*this.size*this.vertByteSize,n=6*this.size;this.vertices=new ArrayBuffer(t),this.positions=new Float32Array(this.vertices),this.colors=new Uint32Array(this.vertices),this.indices=new Uint16Array(n);for(var i=0,o=0;i<n;i+=6,o+=4)this.indices[i+0]=o+0,this.indices[i+1]=o+1,this.indices[i+2]=o+2,this.indices[i+3]=o+0,this.indices[i+4]=o+2,this.indices[i+5]=o+3;this.currentBatchSize=0,this.sprites=[],this.shader=null}var r=e("../../renderers/webgl/utils/ObjectRenderer"),o=e("../../renderers/webgl/WebGLRenderer"),a=e("../../const");i.prototype=Object.create(r.prototype),i.prototype.constructor=i,t.exports=i,o.registerPlugin("sprite",i),i.prototype.onContextChange=function(){var e=this.renderer.gl;this.shader=this.renderer.shaderManager.defaultShader,this.vertexBuffer=e.createBuffer(),this.indexBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indices,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.vertices,e.DYNAMIC_DRAW),this.currentBlendMode=99999},i.prototype.render=function(e){var t=e._texture;this.currentBatchSize>=this.size&&this.flush();var n=t._uvs;if(n){var i,r,o,a,s=e.anchor.x,c=e.anchor.y;if(t.trim&&void 0===e.tileScale){var l=t.trim;i=(r=l.x-s*l.width)+t.crop.width,o=(a=l.y-c*l.height)+t.crop.height}else i=t._frame.width*(1-s),r=t._frame.width*-s,o=t._frame.height*(1-c),a=t._frame.height*-c;var u=this.currentBatchSize*this.vertByteSize,h=e.worldTransform,d=h.a,p=h.b,f=h.c,m=h.d,g=h.tx,v=h.ty,y=this.colors,b=this.positions;if(this.renderer.roundPixels){var w=this.renderer.resolution;b[u]=((d*r+f*a+g)*w|0)/w,b[u+1]=((m*a+p*r+v)*w|0)/w,b[u+5]=((d*i+f*a+g)*w|0)/w,b[u+6]=((m*a+p*i+v)*w|0)/w,b[u+10]=((d*i+f*o+g)*w|0)/w,b[u+11]=((m*o+p*i+v)*w|0)/w,b[u+15]=((d*r+f*o+g)*w|0)/w,b[u+16]=((m*o+p*r+v)*w|0)/w}else b[u]=d*r+f*a+g,b[u+1]=m*a+p*r+v,b[u+5]=d*i+f*a+g,b[u+6]=m*a+p*i+v,b[u+10]=d*i+f*o+g,b[u+11]=m*o+p*i+v,b[u+15]=d*r+f*o+g,b[u+16]=m*o+p*r+v;b[u+2]=n.x0,b[u+3]=n.y0,b[u+7]=n.x1,b[u+8]=n.y1,b[u+12]=n.x2,b[u+13]=n.y2,b[u+17]=n.x3,b[u+18]=n.y3;var x=e.tint;y[u+4]=y[u+9]=y[u+14]=y[u+19]=(x>>16)+(65280&x)+((255&x)<<16)+(255*e.worldAlpha<<24),this.sprites[this.currentBatchSize++]=e}},i.prototype.flush=function(){if(0!==this.currentBatchSize){var e,t,n,i,r=this.renderer.gl;if(this.currentBatchSize>.5*this.size)r.bufferSubData(r.ARRAY_BUFFER,0,this.vertices);else{var o=this.positions.subarray(0,this.currentBatchSize*this.vertByteSize);r.bufferSubData(r.ARRAY_BUFFER,0,o)}for(var a,s=0,c=0,l=null,u=this.renderer.blendModeManager.currentBlendMode,h=null,d=!1,p=!1,f=0,m=this.currentBatchSize;f<m;f++)t=(a=this.sprites[f])._texture.baseTexture,d=u!==(n=a.blendMode),p=h!==(i=a.shader||this.shader),(l!==t||d||p)&&(this.renderBatch(l,s,c),c=f,s=0,l=t,d&&(u=n,this.renderer.blendModeManager.setBlendMode(u)),p&&((e=(h=i).shaders?h.shaders[r.id]:h)||(e=h.getShader(this.renderer)),this.renderer.shaderManager.setShader(e),e.uniforms.projectionMatrix.value=this.renderer.currentRenderTarget.projectionMatrix.toArray(!0),e.syncUniforms(),r.activeTexture(r.TEXTURE0))),s++;this.renderBatch(l,s,c),this.currentBatchSize=0}},i.prototype.renderBatch=function(e,t,n){if(0!==t){var i=this.renderer.gl;e._glTextures[i.id]?i.bindTexture(i.TEXTURE_2D,e._glTextures[i.id]):this.renderer.updateTexture(e),i.drawElements(i.TRIANGLES,6*t,i.UNSIGNED_SHORT,6*n*2),this.renderer.drawCount++}},i.prototype.start=function(){var e=this.renderer.gl;e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var t=this.vertByteSize;e.vertexAttribPointer(this.shader.attributes.aVertexPosition,2,e.FLOAT,!1,t,0),e.vertexAttribPointer(this.shader.attributes.aTextureCoord,2,e.FLOAT,!1,t,8),e.vertexAttribPointer(this.shader.attributes.aColor,4,e.UNSIGNED_BYTE,!0,t,16)},i.prototype.destroy=function(){this.renderer.gl.deleteBuffer(this.vertexBuffer),this.renderer.gl.deleteBuffer(this.indexBuffer),r.prototype.destroy.call(this),this.shader.destroy(),this.renderer=null,this.vertices=null,this.positions=null,this.colors=null,this.indices=null,this.vertexBuffer=null,this.indexBuffer=null,this.sprites=null,this.shader=null}},{"../../const":22,"../../renderers/webgl/WebGLRenderer":49,"../../renderers/webgl/utils/ObjectRenderer":63}],69:[function(e,t,n){function i(e,t,n){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.resolution=n||c.RESOLUTION,this._text=null,this._style=null;var i=o.fromCanvas(this.canvas);i.trim=new a.Rectangle,r.call(this,i),this.text=e,this.style=t}var r=e("../sprites/Sprite"),o=e("../textures/Texture"),a=e("../math"),s=e("../utils"),c=e("../const");i.prototype=Object.create(r.prototype),i.prototype.constructor=i,t.exports=i,i.fontPropertiesCache={},i.fontPropertiesCanvas=document.createElement("canvas"),i.fontPropertiesContext=i.fontPropertiesCanvas.getContext("2d"),Object.defineProperties(i.prototype,{width:{get:function(){return this.dirty&&this.updateText(),this.scale.x*this._texture._frame.width},set:function(e){this.scale.x=e/this._texture._frame.width,this._width=e}},height:{get:function(){return this.dirty&&this.updateText(),this.scale.y*this._texture._frame.height},set:function(e){this.scale.y=e/this._texture._frame.height,this._height=e}},style:{get:function(){return this._style},set:function(e){"number"==typeof(e=e||{}).fill&&(e.fill=s.hex2string(e.fill)),"number"==typeof e.stroke&&(e.stroke=s.hex2string(e.stroke)),"number"==typeof e.dropShadowColor&&(e.dropShadowColor=s.hex2string(e.dropShadowColor)),e.font=e.font||"bold 20pt Arial",e.fill=e.fill||"black",e.align=e.align||"left",e.stroke=e.stroke||"black",e.strokeThickness=e.strokeThickness||0,e.wordWrap=e.wordWrap||!1,e.wordWrapWidth=e.wordWrapWidth||100,e.dropShadow=e.dropShadow||!1,e.dropShadowColor=e.dropShadowColor||"#000000",e.dropShadowAngle=void 0!==e.dropShadowAngle?e.dropShadowAngle:Math.PI/6,e.dropShadowDistance=void 0!==e.dropShadowDistance?e.dropShadowDistance:5,e.dropShadowBlur=void 0!==e.dropShadowBlur?e.dropShadowBlur:0,e.padding=e.padding||0,e.textBaseline=e.textBaseline||"alphabetic",e.lineJoin=e.lineJoin||"miter",e.miterLimit=e.miterLimit||10,this._style=e,this.dirty=!0}},text:{get:function(){return this._text},set:function(e){e=e.toString()||" ",this._text!==e&&(this._text=e,this.dirty=!0)}}}),i.prototype.updateText=function(){var e=this._style;this.context.font=e.font;for(var t=(e.wordWrap?this.wordWrap(this._text):this._text).split(/(?:\r\n|\r|\n)/),n=new Array(t.length),i=0,r=this.determineFontProperties(e.font),o=0;o<t.length;o++){var a=this.context.measureText(t[o]).width;n[o]=a,i=Math.max(i,a)}var s=i+e.strokeThickness;e.dropShadow&&(s+=e.dropShadowDistance),this.canvas.width=(s+this.context.lineWidth)*this.resolution;var c,l,u=this.style.lineHeight||r.fontSize+e.strokeThickness,h=u*t.length;if(e.dropShadow&&(h+=e.dropShadowDistance),this.canvas.height=(h+2*this._style.padding)*this.resolution,this.context.scale(this.resolution,this.resolution),navigator.isCocoonJS&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.font=e.font,this.context.strokeStyle=e.stroke,this.context.lineWidth=e.strokeThickness,this.context.textBaseline=e.textBaseline,this.context.lineJoin=e.lineJoin,this.context.miterLimit=e.miterLimit,e.dropShadow){e.dropShadowBlur>0?(this.context.shadowColor=e.dropShadowColor,this.context.shadowBlur=e.dropShadowBlur):this.context.fillStyle=e.dropShadowColor;var d=Math.cos(e.dropShadowAngle)*e.dropShadowDistance,p=Math.sin(e.dropShadowAngle)*e.dropShadowDistance;for(o=0;o<t.length;o++)c=e.strokeThickness/2,l=e.strokeThickness/2+o*u+r.ascent,"right"===e.align?c+=i-n[o]:"center"===e.align&&(c+=(i-n[o])/2),e.fill&&this.context.fillText(t[o],c+d,l+p+this._style.padding)}for(this.context.fillStyle=e.fill,o=0;o<t.length;o++)c=e.strokeThickness/2,l=e.strokeThickness/2+o*u+r.ascent,"right"===e.align?c+=i-n[o]:"center"===e.align&&(c+=(i-n[o])/2),e.stroke&&e.strokeThickness&&this.context.strokeText(t[o],c,l+this._style.padding),e.fill&&this.context.fillText(t[o],c,l+this._style.padding);this.updateTexture()},i.prototype.updateTexture=function(){var e=this._texture;e.baseTexture.hasLoaded=!0,e.baseTexture.resolution=this.resolution,e.baseTexture.width=this.canvas.width/this.resolution,e.baseTexture.height=this.canvas.height/this.resolution,e.crop.width=e._frame.width=this.canvas.width/this.resolution,e.crop.height=e._frame.height=this.canvas.height/this.resolution,e.trim.x=0,e.trim.y=-this._style.padding,e.trim.width=e._frame.width,e.trim.height=e._frame.height-2*this._style.padding,this._width=this.canvas.width/this.resolution,this._height=this.canvas.height/this.resolution,e.baseTexture.emit("update",e.baseTexture),this.dirty=!1},i.prototype.renderWebGL=function(e){this.dirty&&this.updateText(),r.prototype.renderWebGL.call(this,e)},i.prototype._renderCanvas=function(e){this.dirty&&this.updateText(),r.prototype._renderCanvas.call(this,e)},i.prototype.determineFontProperties=function(e){var t=i.fontPropertiesCache[e];if(!t){t={};var n=i.fontPropertiesCanvas,r=i.fontPropertiesContext;r.font=e;var o=Math.ceil(r.measureText("|Mq").width),a=Math.ceil(r.measureText("M").width),s=2*a;a=1.4*a|0,n.width=o,n.height=s,r.fillStyle="#f00",r.fillRect(0,0,o,s),r.font=e,r.textBaseline="alphabetic",r.fillStyle="#000",r.fillText("|Mq",0,a);var c,l,u=r.getImageData(0,0,o,s).data,h=u.length,d=4*o,p=0,f=!1;for(c=0;c<a;c++){for(l=0;l<d;l+=4)if(255!==u[p+l]){f=!0;break}if(f)break;p+=d}for(t.ascent=a-c,p=h-d,f=!1,c=s;c>a;c--){for(l=0;l<d;l+=4)if(255!==u[p+l]){f=!0;break}if(f)break;p-=d}t.descent=c-a,t.fontSize=t.ascent+t.descent,i.fontPropertiesCache[e]=t}return t},i.prototype.wordWrap=function(e){for(var t="",n=e.split("\n"),i=this._style.wordWrapWidth,r=0;r<n.length;r++){for(var o=i,a=n[r].split(" "),s=0;s<a.length;s++){var c=this.context.measureText(a[s]).width,l=c+this.context.measureText(" ").width;0===s||l>o?(s>0&&(t+="\n"),t+=a[s],o=i-c):(o-=l,t+=" "+a[s])}r<n.length-1&&(t+="\n")}return t},i.prototype.getBounds=function(e){return this.dirty&&this.updateText(),r.prototype.getBounds.call(this,e)},i.prototype.destroy=function(e){this.context=null,this.canvas=null,this._style=null,this._texture.destroy(void 0===e||e)}},{"../const":22,"../math":33,"../sprites/Sprite":67,"../textures/Texture":72,"../utils":77}],70:[function(e,t,n){function i(e,t,n){a.call(this),this.uid=r.uid(),this.resolution=n||1,this.width=100,this.height=100,this.realWidth=100,this.realHeight=100,this.scaleMode=t||o.SCALE_MODES.DEFAULT,this.hasLoaded=!1,this.isLoading=!1,this.source=null,this.premultipliedAlpha=!0,this.imageUrl=null,this.isPowerOfTwo=!1,this.mipmap=!1,this._glTextures={},e&&this.loadSource(e)}var r=e("../utils"),o=e("../const"),a=e("eventemitter3");i.prototype=Object.create(a.prototype),i.prototype.constructor=i,t.exports=i,i.prototype.update=function(){this.realWidth=this.source.naturalWidth||this.source.width,this.realHeight=this.source.naturalHeight||this.source.height,this.width=this.realWidth/this.resolution,this.height=this.realHeight/this.resolution,this.isPowerOfTwo=r.isPowerOfTwo(this.realWidth,this.realHeight),this.emit("update",this)},i.prototype.loadSource=function(e){var t=this.isLoading;if(this.hasLoaded=!1,this.isLoading=!1,t&&this.source&&(this.source.onload=null,this.source.onerror=null),this.source=e,(this.source.complete||this.source.getContext)&&this.source.width&&this.source.height)this._sourceLoaded();else if(!e.getContext){this.isLoading=!0;var n=this;e.onload=function(){e.onload=null,e.onerror=null,n.isLoading&&(n.isLoading=!1,n._sourceLoaded(),n.emit("loaded",n))},e.onerror=function(){e.onload=null,e.onerror=null,n.isLoading&&(n.isLoading=!1,n.emit("error",n))},e.complete&&e.src&&(this.isLoading=!1,e.onload=null,e.onerror=null,e.width&&e.height?(this._sourceLoaded(),t&&this.emit("loaded",this)):t&&this.emit("error",this))}},i.prototype._sourceLoaded=function(){this.hasLoaded=!0,this.update()},i.prototype.destroy=function(){this.imageUrl?(delete r.BaseTextureCache[this.imageUrl],delete r.TextureCache[this.imageUrl],this.imageUrl=null,navigator.isCocoonJS||(this.source.src="")):this.source&&this.source._pixiId&&delete r.BaseTextureCache[this.source._pixiId],this.source=null,this.dispose()},i.prototype.dispose=function(){this.emit("dispose",this)},i.prototype.updateSourceImage=function(e){this.source.src=e,this.loadSource(this.source)},i.fromImage=function(e,t,n){var o=r.BaseTextureCache[e];if(void 0===t&&0!==e.indexOf("data:")&&(t=!0),!o){var a=new Image;t&&(a.crossOrigin=""),(o=new i(a,n)).imageUrl=e,a.src=e,r.BaseTextureCache[e]=o,o.resolution=r.getResolutionOfUrl(e)}return o},i.fromCanvas=function(e,t){e._pixiId||(e._pixiId="canvas_"+r.uid());var n=r.BaseTextureCache[e._pixiId];return n||(n=new i(e,t),r.BaseTextureCache[e._pixiId]=n),n}},{"../const":22,"../utils":77,eventemitter3:10}],71:[function(e,t,n){function i(e,t,n,i,h){if(!e)throw new Error("Unable to create RenderTexture, you must pass a renderer into the constructor.");t=t||100,n=n||100,h=h||u.RESOLUTION;var d=new r;if(d.width=t,d.height=n,d.resolution=h,d.scaleMode=i||u.SCALE_MODES.DEFAULT,d.hasLoaded=!0,o.call(this,d,new l.Rectangle(0,0,t,n)),this.width=t,this.height=n,this.resolution=h,this.render=null,this.renderer=e,this.renderer.type===u.RENDERER_TYPE.WEBGL){var p=this.renderer.gl;this.textureBuffer=new a(p,this.width,this.height,d.scaleMode,this.resolution),this.baseTexture._glTextures[p.id]=this.textureBuffer.texture,this.filterManager=new s(this.renderer),this.filterManager.onContextChange(),this.filterManager.resize(t,n),this.render=this.renderWebGL,this.renderer.currentRenderer.start(),this.renderer.currentRenderTarget.activate()}else this.render=this.renderCanvas,this.textureBuffer=new c(this.width*this.resolution,this.height*this.resolution),this.baseTexture.source=this.textureBuffer.canvas;this.valid=!0,this._updateUvs()}var r=e("./BaseTexture"),o=e("./Texture"),a=e("../renderers/webgl/utils/RenderTarget"),s=e("../renderers/webgl/managers/FilterManager"),c=e("../renderers/canvas/utils/CanvasBuffer"),l=e("../math"),u=e("../const"),h=new l.Matrix;i.prototype=Object.create(o.prototype),i.prototype.constructor=i,t.exports=i,i.prototype.resize=function(e,t,n){e===this.width&&t===this.height||(this.valid=e>0&&t>0,this.width=this._frame.width=this.crop.width=e,this.height=this._frame.height=this.crop.height=t,n&&(this.baseTexture.width=this.width,this.baseTexture.height=this.height),this.valid&&(this.textureBuffer.resize(this.width,this.height),this.filterManager&&this.filterManager.resize(this.width,this.height)))},i.prototype.clear=function(){this.valid&&(this.renderer.type===u.RENDERER_TYPE.WEBGL&&this.renderer.gl.bindFramebuffer(this.renderer.gl.FRAMEBUFFER,this.textureBuffer.frameBuffer),this.textureBuffer.clear())},i.prototype.renderWebGL=function(e,t,n,i){if(this.valid){if(i=void 0===i||i,this.textureBuffer.transform=t,this.textureBuffer.activate(),e.worldAlpha=1,i){e.worldTransform.identity(),e.currentBounds=null;var r,o,a=e.children;for(r=0,o=a.length;r<o;++r)a[r].updateTransform()}var s=this.renderer.filterManager;this.renderer.filterManager=this.filterManager,this.renderer.renderDisplayObject(e,this.textureBuffer,n),this.renderer.filterManager=s}},i.prototype.renderCanvas=function(e,t,n,i){if(this.valid){i=!!i;var r=h;r.identity(),t&&r.append(t);var o=e.worldTransform;e.worldTransform=r,e.worldAlpha=1;var a,s,c=e.children;for(a=0,s=c.length;a<s;++a)c[a].updateTransform();n&&this.textureBuffer.clear();var l=this.textureBuffer.context,u=this.renderer.resolution;this.renderer.resolution=this.resolution,this.renderer.renderDisplayObject(e,l),this.renderer.resolution=u,e.worldTransform===r&&(e.worldTransform=o)}},i.prototype.destroy=function(){o.prototype.destroy.call(this,!0),this.textureBuffer.destroy(),this.filterManager&&this.filterManager.destroy(),this.renderer=null},i.prototype.getImage=function(){var e=new Image;return e.src=this.getBase64(),e},i.prototype.getBase64=function(){return this.getCanvas().toDataURL()},i.prototype.getCanvas=function(){if(this.renderer.type===u.RENDERER_TYPE.WEBGL){var e=this.renderer.gl,t=this.textureBuffer.size.width,n=this.textureBuffer.size.height,i=new Uint8Array(4*t*n);e.bindFramebuffer(e.FRAMEBUFFER,this.textureBuffer.frameBuffer),e.readPixels(0,0,t,n,e.RGBA,e.UNSIGNED_BYTE,i),e.bindFramebuffer(e.FRAMEBUFFER,null);var r=new c(t,n),o=r.context.getImageData(0,0,t,n);return o.data.set(i),r.context.putImageData(o,0,0),r.canvas}return this.textureBuffer.canvas},i.prototype.getPixels=function(){var e,t;if(this.renderer.type===u.RENDERER_TYPE.WEBGL){var n=this.renderer.gl;e=this.textureBuffer.size.width,t=this.textureBuffer.size.height;var i=new Uint8Array(4*e*t);return n.bindFramebuffer(n.FRAMEBUFFER,this.textureBuffer.frameBuffer),n.readPixels(0,0,e,t,n.RGBA,n.UNSIGNED_BYTE,i),n.bindFramebuffer(n.FRAMEBUFFER,null),i}return e=this.textureBuffer.canvas.width,t=this.textureBuffer.canvas.height,this.textureBuffer.canvas.getContext("2d").getImageData(0,0,e,t).data},i.prototype.getPixel=function(e,t){if(this.renderer.type===u.RENDERER_TYPE.WEBGL){var n=this.renderer.gl,i=new Uint8Array(4);return n.bindFramebuffer(n.FRAMEBUFFER,this.textureBuffer.frameBuffer),n.readPixels(e,t,1,1,n.RGBA,n.UNSIGNED_BYTE,i),n.bindFramebuffer(n.FRAMEBUFFER,null),i}return this.textureBuffer.canvas.getContext("2d").getImageData(e,t,1,1).data}},{"../const":22,"../math":33,"../renderers/canvas/utils/CanvasBuffer":45,"../renderers/webgl/managers/FilterManager":54,"../renderers/webgl/utils/RenderTarget":65,"./BaseTexture":70,"./Texture":72}],72:[function(e,t,n){function i(e,t,n,r,o){if(s.call(this),this.noFrame=!1,t||(this.noFrame=!0,t=new c.Rectangle(0,0,1,1)),e instanceof i&&(e=e.baseTexture),this.baseTexture=e,this._frame=t,this.trim=r,this.valid=!1,this.requiresUpdate=!1,this._uvs=null,this.width=0,this.height=0,this.crop=n||t,this._rotate=+(o||0),!0===o)this._rotate=2;else if(this._rotate%2!=0)throw"attempt to use diamond-shaped UVs. If you are sure, set rotation manually";e.hasLoaded?(this.noFrame&&(t=new c.Rectangle(0,0,e.width,e.height),e.on("update",this.onBaseTextureUpdated,this)),this.frame=t):e.once("loaded",this.onBaseTextureLoaded,this)}var r=e("./BaseTexture"),o=e("./VideoBaseTexture"),a=e("./TextureUvs"),s=e("eventemitter3"),c=e("../math"),l=e("../utils");i.prototype=Object.create(s.prototype),i.prototype.constructor=i,t.exports=i,Object.defineProperties(i.prototype,{frame:{get:function(){return this._frame},set:function(e){if(this._frame=e,this.noFrame=!1,this.width=e.width,this.height=e.height,!this.trim&&!this.rotate&&(e.x+e.width>this.baseTexture.width||e.y+e.height>this.baseTexture.height))throw new Error("Texture Error: frame does not fit inside the base Texture dimensions "+this);this.valid=e&&e.width&&e.height&&this.baseTexture.hasLoaded,this.trim?(this.width=this.trim.width,this.height=this.trim.height,this._frame.width=this.trim.width,this._frame.height=this.trim.height):this.crop=e,this.valid&&this._updateUvs()}},rotate:{get:function(){return this._rotate},set:function(e){this._rotate=e,this.valid&&this._updateUvs()}}}),i.prototype.update=function(){this.baseTexture.update()},i.prototype.onBaseTextureLoaded=function(e){this.noFrame?this.frame=new c.Rectangle(0,0,e.width,e.height):this.frame=this._frame,this.emit("update",this)},i.prototype.onBaseTextureUpdated=function(e){this._frame.width=e.width,this._frame.height=e.height,this.emit("update",this)},i.prototype.destroy=function(e){this.baseTexture&&(e&&this.baseTexture.destroy(),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture.off("loaded",this.onBaseTextureLoaded,this),this.baseTexture=null),this._frame=null,this._uvs=null,this.trim=null,this.crop=null,this.valid=!1,this.off("dispose",this.dispose,this),this.off("update",this.update,this)},i.prototype.clone=function(){return new i(this.baseTexture,this.frame,this.crop,this.trim,this.rotate)},i.prototype._updateUvs=function(){this._uvs||(this._uvs=new a),this._uvs.set(this.crop,this.baseTexture,this.rotate)},i.fromImage=function(e,t,n){var o=l.TextureCache[e];return o||(o=new i(r.fromImage(e,t,n)),l.TextureCache[e]=o),o},i.fromFrame=function(e){var t=l.TextureCache[e];if(!t)throw new Error('The frameId "'+e+'" does not exist in the texture cache');return t},i.fromCanvas=function(e,t){return new i(r.fromCanvas(e,t))},i.fromVideo=function(e,t){return"string"==typeof e?i.fromVideoUrl(e,t):new i(o.fromVideo(e,t))},i.fromVideoUrl=function(e,t){return new i(o.fromUrl(e,t))},i.addTextureToCache=function(e,t){l.TextureCache[t]=e},i.removeTextureFromCache=function(e){var t=l.TextureCache[e];return delete l.TextureCache[e],delete l.BaseTextureCache[e],t},i.EMPTY=new i(new r)},{"../math":33,"../utils":77,"./BaseTexture":70,"./TextureUvs":73,"./VideoBaseTexture":74,eventemitter3:10}],73:[function(e,t,n){function i(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1}t.exports=i;var r=e("../math/GroupD8");i.prototype.set=function(e,t,n){var i=t.width,o=t.height;if(n){var a=r.isSwapWidthHeight(n),s=(a?e.height:e.width)/2/i,c=(a?e.width:e.height)/2/o,l=e.x/i+s,u=e.y/o+c;n=r.add(n,r.NW),this.x0=l+s*r.uX(n),this.y0=u+c*r.uY(n),n=r.add(n,2),this.x1=l+s*r.uX(n),this.y1=u+c*r.uY(n),n=r.add(n,2),this.x2=l+s*r.uX(n),this.y2=u+c*r.uY(n),n=r.add(n,2),this.x3=l+s*r.uX(n),this.y3=u+c*r.uY(n)}else this.x0=e.x/i,this.y0=e.y/o,this.x1=(e.x+e.width)/i,this.y1=e.y/o,this.x2=(e.x+e.width)/i,this.y2=(e.y+e.height)/o,this.x3=e.x/i,this.y3=(e.y+e.height)/o}},{"../math/GroupD8":30}],74:[function(e,t,n){function i(e,t){if(!e)throw new Error("No video source element specified.");(e.readyState===e.HAVE_ENOUGH_DATA||e.readyState===e.HAVE_FUTURE_DATA)&&e.width&&e.height&&(e.complete=!0),o.call(this,e,t),this.autoUpdate=!1,this._onUpdate=this._onUpdate.bind(this),this._onCanPlay=this._onCanPlay.bind(this),e.complete||(e.addEventListener("canplay",this._onCanPlay),e.addEventListener("canplaythrough",this._onCanPlay),e.addEventListener("play",this._onPlayStart.bind(this)),e.addEventListener("pause",this._onPlayStop.bind(this))),this.__loaded=!1}function r(e,t){t||(t="video/"+e.substr(e.lastIndexOf(".")+1));var n=document.createElement("source");return n.src=e,n.type=t,n}var o=e("./BaseTexture"),a=e("../utils");i.prototype=Object.create(o.prototype),i.prototype.constructor=i,t.exports=i,i.prototype._onUpdate=function(){this.autoUpdate&&(window.requestAnimationFrame(this._onUpdate),this.update())},i.prototype._onPlayStart=function(){this.autoUpdate||(window.requestAnimationFrame(this._onUpdate),this.autoUpdate=!0)},i.prototype._onPlayStop=function(){this.autoUpdate=!1},i.prototype._onCanPlay=function(){this.hasLoaded=!0,this.source&&(this.source.removeEventListener("canplay",this._onCanPlay),this.source.removeEventListener("canplaythrough",this._onCanPlay),this.width=this.source.videoWidth,this.height=this.source.videoHeight,this.source.play(),this.__loaded||(this.__loaded=!0,this.emit("loaded",this)))},
i.prototype.destroy=function(){this.source&&this.source._pixiId&&(delete a.BaseTextureCache[this.source._pixiId],delete this.source._pixiId),o.prototype.destroy.call(this)},i.fromVideo=function(e,t){e._pixiId||(e._pixiId="video_"+a.uid());var n=a.BaseTextureCache[e._pixiId];return n||(n=new i(e,t),a.BaseTextureCache[e._pixiId]=n),n},i.fromUrl=function(e,t){var n=document.createElement("video");if(Array.isArray(e))for(var o=0;o<e.length;++o)n.appendChild(r(e[o].src||e[o],e[o].mime));else n.appendChild(r(e.src||e,e.mime));return n.load(),n.play(),i.fromVideo(n,t)},i.fromUrls=i.fromUrl},{"../utils":77,"./BaseTexture":70}],75:[function(e,t,n){function i(){var e=this;this._tick=function(t){e._requestId=null,e.started&&(e.update(t),e.started&&null===e._requestId&&e._emitter.listeners(a,!0)&&(e._requestId=requestAnimationFrame(e._tick)))},this._emitter=new o,this._requestId=null,this._maxElapsedMS=100,this.autoStart=!1,this.deltaTime=1,this.elapsedMS=1/r.TARGET_FPMS,this.lastTime=0,this.speed=1,this.started=!1}var r=e("../const"),o=e("eventemitter3"),a="tick";Object.defineProperties(i.prototype,{FPS:{get:function(){return 1e3/this.elapsedMS}},minFPS:{get:function(){return 1e3/this._maxElapsedMS},set:function(e){var t=Math.min(Math.max(0,e)/1e3,r.TARGET_FPMS);this._maxElapsedMS=1/t}}}),i.prototype._requestIfNeeded=function(){null===this._requestId&&this._emitter.listeners(a,!0)&&(this.lastTime=performance.now(),this._requestId=requestAnimationFrame(this._tick))},i.prototype._cancelIfNeeded=function(){null!==this._requestId&&(cancelAnimationFrame(this._requestId),this._requestId=null)},i.prototype._startIfPossible=function(){this.started?this._requestIfNeeded():this.autoStart&&this.start()},i.prototype.add=function(e,t){return this._emitter.on(a,e,t),this._startIfPossible(),this},i.prototype.addOnce=function(e,t){return this._emitter.once(a,e,t),this._startIfPossible(),this},i.prototype.remove=function(e,t){return this._emitter.off(a,e,t),this._emitter.listeners(a,!0)||this._cancelIfNeeded(),this},i.prototype.start=function(){this.started||(this.started=!0,this._requestIfNeeded())},i.prototype.stop=function(){this.started&&(this.started=!1,this._cancelIfNeeded())},i.prototype.update=function(e){var t;e=e||performance.now(),(t=this.elapsedMS=e-this.lastTime)>this._maxElapsedMS&&(t=this._maxElapsedMS),this.deltaTime=t*r.TARGET_FPMS*this.speed,this._emitter.emit(a,this.deltaTime),this.lastTime=e},t.exports=i},{"../const":22,eventemitter3:10}],76:[function(e,t,n){var i=e("./Ticker"),r=new i;r.autoStart=!0,t.exports={shared:r,Ticker:i}},{"./Ticker":75}],77:[function(e,t,n){var i=e("../const"),r=t.exports={_uid:0,_saidHello:!1,EventEmitter:e("eventemitter3"),pluginTarget:e("./pluginTarget"),async:e("async"),uid:function(){return++r._uid},hex2rgb:function(e,t){return(t=t||[])[0]=(e>>16&255)/255,t[1]=(e>>8&255)/255,t[2]=(255&e)/255,t},hex2string:function(e){return e=e.toString(16),"#"+("000000".substr(0,6-e.length)+e)},rgb2hex:function(e){return(255*e[0]<<16)+(255*e[1]<<8)+255*e[2]},canUseNewCanvasBlendModes:function(){if("undefined"==typeof document)return!1;var e="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAABAQMAAADD8p2OAAAAA1BMVEX/",t="AAAACklEQVQI12NgAAAAAgAB4iG8MwAAAABJRU5ErkJggg==",n=new Image;n.src=e+"AP804Oa6"+t;var i=new Image;i.src=e+"/wCKxvRF"+t;var r=document.createElement("canvas");r.width=6,r.height=1;var o=r.getContext("2d");o.globalCompositeOperation="multiply",o.drawImage(n,0,0),o.drawImage(i,2,0);var a=o.getImageData(2,0,1,1).data;return 255===a[0]&&0===a[1]&&0===a[2]},getNextPowerOfTwo:function(e){if(e>0&&0==(e&e-1))return e;for(var t=1;t<e;)t<<=1;return t},isPowerOfTwo:function(e,t){return e>0&&0==(e&e-1)&&t>0&&0==(t&t-1)},getResolutionOfUrl:function(e){var t=i.RETINA_PREFIX.exec(e);return t?parseFloat(t[1]):1},sayHello:function(e){if(!r._saidHello){if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var t=["\n %c %c %c Pixi.js "+i.VERSION+" -  "+e+"   %c  %c  http://www.pixijs.com/  %c %c %c%c \n\n","background: #ff66a5; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff66a5; background: #030307; padding:5px 0;","background: #ff66a5; padding:5px 0;","background: #ffc3dc; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;"];window.console.log.apply(console,t)}else window.console&&window.console.log("Pixi.js "+i.VERSION+" - "+e+" - http://www.pixijs.com/");r._saidHello=!0}},isWebGLSupported:function(){var e={stencil:!0};try{if(!window.WebGLRenderingContext)return!1;var t=document.createElement("canvas"),n=t.getContext("webgl",e)||t.getContext("experimental-webgl",e);return!(!n||!n.getContextAttributes().stencil)}catch(e){return!1}},sign:function(e){return e?e<0?-1:1:0},removeItems:function(e,t,n){var i=e.length;if(!(t>=i||0===n)){for(var r=t,o=i-(n=t+n>i?i-t:n);r<o;++r)e[r]=e[r+n];e.length=o}},TextureCache:{},BaseTextureCache:{}}},{"../const":22,"./pluginTarget":78,async:1,eventemitter3:10}],78:[function(e,t,n){t.exports={mixin:function(e){!function(e){e.__plugins={},e.registerPlugin=function(t,n){e.__plugins[t]=n},e.prototype.initPlugins=function(){for(var t in this.plugins=this.plugins||{},e.__plugins)this.plugins[t]=new e.__plugins[t](this)},e.prototype.destroyPlugins=function(){for(var e in this.plugins)this.plugins[e].destroy(),this.plugins[e]=null;this.plugins=null}}(e)}}},{}],79:[function(e,t,n){var i=e("./core"),r=e("./mesh"),o=e("./extras"),a=e("./filters");i.SpriteBatch=function(){throw new ReferenceError("SpriteBatch does not exist any more, please use the new ParticleContainer instead.")},i.AssetLoader=function(){throw new ReferenceError("The loader system was overhauled in pixi v3, please see the new PIXI.loaders.Loader class.")},Object.defineProperties(i,{Stage:{get:function(){return console.warn("You do not need to use a PIXI Stage any more, you can simply render any container."),i.Container}},DisplayObjectContainer:{get:function(){return console.warn("DisplayObjectContainer has been shortened to Container, please use Container from now on."),i.Container}},Strip:{get:function(){return console.warn("The Strip class has been renamed to Mesh and moved to mesh.Mesh, please use mesh.Mesh from now on."),r.Mesh}},Rope:{get:function(){return console.warn("The Rope class has been moved to mesh.Rope, please use mesh.Rope from now on."),r.Rope}},MovieClip:{get:function(){return console.warn("The MovieClip class has been moved to extras.MovieClip, please use extras.MovieClip from now on."),o.MovieClip}},TilingSprite:{get:function(){return console.warn("The TilingSprite class has been moved to extras.TilingSprite, please use extras.TilingSprite from now on."),o.TilingSprite}},BitmapText:{get:function(){return console.warn("The BitmapText class has been moved to extras.BitmapText, please use extras.BitmapText from now on."),o.BitmapText}},blendModes:{get:function(){return console.warn("The blendModes has been moved to BLEND_MODES, please use BLEND_MODES from now on."),i.BLEND_MODES}},scaleModes:{get:function(){return console.warn("The scaleModes has been moved to SCALE_MODES, please use SCALE_MODES from now on."),i.SCALE_MODES}},BaseTextureCache:{get:function(){return console.warn("The BaseTextureCache class has been moved to utils.BaseTextureCache, please use utils.BaseTextureCache from now on."),i.utils.BaseTextureCache}},TextureCache:{get:function(){return console.warn("The TextureCache class has been moved to utils.TextureCache, please use utils.TextureCache from now on."),i.utils.TextureCache}},math:{get:function(){return console.warn("The math namespace is deprecated, please access members already accessible on PIXI."),i}}}),i.Sprite.prototype.setTexture=function(e){this.texture=e,console.warn("setTexture is now deprecated, please use the texture property, e.g : sprite.texture = texture;")},o.BitmapText.prototype.setText=function(e){this.text=e,console.warn("setText is now deprecated, please use the text property, e.g : myBitmapText.text = 'my text';")},i.Text.prototype.setText=function(e){this.text=e,console.warn("setText is now deprecated, please use the text property, e.g : myText.text = 'my text';")},i.Text.prototype.setStyle=function(e){this.style=e,console.warn("setStyle is now deprecated, please use the style property, e.g : myText.style = style;")},i.Texture.prototype.setFrame=function(e){this.frame=e,console.warn("setFrame is now deprecated, please use the frame property, e.g : myTexture.frame = frame;")},Object.defineProperties(a,{AbstractFilter:{get:function(){return console.warn("filters.AbstractFilter is an undocumented alias, please use AbstractFilter from now on."),i.AbstractFilter}},FXAAFilter:{get:function(){return console.warn("filters.FXAAFilter is an undocumented alias, please use FXAAFilter from now on."),i.FXAAFilter}},SpriteMaskFilter:{get:function(){return console.warn("filters.SpriteMaskFilter is an undocumented alias, please use SpriteMaskFilter from now on."),i.SpriteMaskFilter}}}),i.utils.uuid=function(){return console.warn("utils.uuid() is deprecated, please use utils.uid() from now on."),i.utils.uid()}},{"./core":29,"./extras":86,"./filters":103,"./mesh":128}],80:[function(e,t,n){function i(e,t){r.Container.call(this),t=t||{},this.textWidth=0,this.textHeight=0,this._glyphs=[],this._font={tint:void 0!==t.tint?t.tint:16777215,align:t.align||"left",name:null,size:0},this.font=t.font,this._text=e,this.maxWidth=0,this.maxLineHeight=0,this.dirty=!1,this.updateText()}var r=e("../core");i.prototype=Object.create(r.Container.prototype),i.prototype.constructor=i,t.exports=i,Object.defineProperties(i.prototype,{tint:{get:function(){return this._font.tint},set:function(e){this._font.tint="number"==typeof e&&e>=0?e:16777215,this.dirty=!0}},align:{get:function(){return this._font.align},set:function(e){this._font.align=e||"left",this.dirty=!0}},font:{get:function(){return this._font},set:function(e){e&&("string"==typeof e?(e=e.split(" "),this._font.name=1===e.length?e[0]:e.slice(1).join(" "),this._font.size=e.length>=2?parseInt(e[0],10):i.fonts[this._font.name].size):(this._font.name=e.name,this._font.size="number"==typeof e.size?e.size:parseInt(e.size,10)),this.dirty=!0)}},text:{get:function(){return this._text},set:function(e){e=e.toString()||" ",this._text!==e&&(this._text=e,this.dirty=!0)}}}),i.prototype.updateText=function(){for(var e=i.fonts[this._font.name],t=new r.Point,n=null,o=[],a=0,s=0,c=[],l=0,u=this._font.size/e.size,h=-1,d=0,p=0;p<this.text.length;p++){var f=this.text.charCodeAt(p);if(h=/(\s)/.test(this.text.charAt(p))?p:h,/(?:\r\n|\r|\n)/.test(this.text.charAt(p)))c.push(a),s=Math.max(s,a),l++,t.x=0,t.y+=e.lineHeight,n=null;else if(-1!==h&&this.maxWidth>0&&t.x*u>this.maxWidth)r.utils.removeItems(o,h,p-h),p=h,h=-1,c.push(a),s=Math.max(s,a),l++,t.x=0,t.y+=e.lineHeight,n=null;else{var m=e.chars[f];m&&(n&&m.kerning[n]&&(t.x+=m.kerning[n]),o.push({texture:m.texture,line:l,charCode:f,position:new r.Point(t.x+m.xOffset,t.y+m.yOffset)}),a=t.x+(m.texture.width+m.xOffset),t.x+=m.xAdvance,d=Math.max(d,m.yOffset+m.texture.height),n=f)}}c.push(a),s=Math.max(s,a);var g=[];for(p=0;p<=l;p++){var v=0;"right"===this._font.align?v=s-c[p]:"center"===this._font.align&&(v=(s-c[p])/2),g.push(v)}var y=o.length,b=this.tint;for(p=0;p<y;p++){var w=this._glyphs[p];w?w.texture=o[p].texture:(w=new r.Sprite(o[p].texture),this._glyphs.push(w)),w.position.x=(o[p].position.x+g[o[p].line])*u,w.position.y=o[p].position.y*u,w.scale.x=w.scale.y=u,w.tint=b,w.parent||this.addChild(w)}for(p=y;p<this._glyphs.length;++p)this.removeChild(this._glyphs[p]);this.textWidth=s*u,this.textHeight=(t.y+e.lineHeight)*u,this.maxLineHeight=d*u},i.prototype.updateTransform=function(){this.validate(),this.containerUpdateTransform()},i.prototype.getLocalBounds=function(){return this.validate(),r.Container.prototype.getLocalBounds.call(this)},i.prototype.validate=function(){this.dirty&&(this.updateText(),this.dirty=!1)},i.fonts={}},{"../core":29}],81:[function(e,t,n){function i(e){r.Sprite.call(this,e[0]instanceof r.Texture?e[0]:e[0].texture),this._textures=null,this._durations=null,this.textures=e,this.animationSpeed=1,this.loop=!0,this.onComplete=null,this._currentTime=0,this.playing=!1}var r=e("../core");i.prototype=Object.create(r.Sprite.prototype),i.prototype.constructor=i,t.exports=i,Object.defineProperties(i.prototype,{totalFrames:{get:function(){return this._textures.length}},textures:{get:function(){return this._textures},set:function(e){if(e[0]instanceof r.Texture)this._textures=e,this._durations=null;else{this._textures=[],this._durations=[];for(var t=0;t<e.length;t++)this._textures.push(e[t].texture),this._durations.push(e[t].time)}}},currentFrame:{get:function(){var e=Math.floor(this._currentTime)%this._textures.length;return e<0&&(e+=this._textures.length),e}}}),i.prototype.stop=function(){this.playing&&(this.playing=!1,r.ticker.shared.remove(this.update,this))},i.prototype.play=function(){this.playing||(this.playing=!0,r.ticker.shared.add(this.update,this))},i.prototype.gotoAndStop=function(e){this.stop(),this._currentTime=e,this._texture=this._textures[this.currentFrame]},i.prototype.gotoAndPlay=function(e){this._currentTime=e,this.play()},i.prototype.update=function(e){var t=this.animationSpeed*e;if(null!==this._durations){var n=this._currentTime%1*this._durations[this.currentFrame];for(n+=t/60*1e3;n<0;)this._currentTime--,n+=this._durations[this.currentFrame];var i=Math.sign(this.animationSpeed*e);for(this._currentTime=Math.floor(this._currentTime);n>=this._durations[this.currentFrame];)n-=this._durations[this.currentFrame]*i,this._currentTime+=i;this._currentTime+=n/this._durations[this.currentFrame]}else this._currentTime+=t;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):this._texture=this._textures[this.currentFrame]},i.prototype.destroy=function(){this.stop(),r.Sprite.prototype.destroy.call(this)},i.fromFrames=function(e){for(var t=[],n=0;n<e.length;++n)t.push(new r.Texture.fromFrame(e[n]));return new i(t)},i.fromImages=function(e){for(var t=[],n=0;n<e.length;++n)t.push(new r.Texture.fromImage(e[n]));return new i(t)}},{"../core":29}],82:[function(e,t,n){function i(e,t,n){r.Sprite.call(this,e),this.tileScale=new r.Point(1,1),this.tilePosition=new r.Point(0,0),this._width=t||100,this._height=n||100,this._uvs=new r.TextureUvs,this._canvasPattern=null,this.shader=new r.AbstractFilter(["precision lowp float;","attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","uniform mat3 projectionMatrix;","uniform vec4 uFrame;","uniform vec4 uTransform;","varying vec2 vTextureCoord;","varying vec4 vColor;","void main(void){","   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);","   vec2 coord = aTextureCoord;","   coord -= uTransform.xy;","   coord /= uTransform.zw;","   vTextureCoord = coord;","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","}"].join("\n"),["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","uniform vec4 uFrame;","uniform vec2 uPixelSize;","void main(void){","   vec2 coord = mod(vTextureCoord, uFrame.zw);","   coord = clamp(coord, uPixelSize, uFrame.zw - uPixelSize);","   coord += uFrame.xy;","   gl_FragColor =  texture2D(uSampler, coord) * vColor ;","}"].join("\n"),{uFrame:{type:"4fv",value:[0,0,1,1]},uTransform:{type:"4fv",value:[0,0,1,1]},uPixelSize:{type:"2fv",value:[1,1]}})}var r=e("../core"),o=new r.Point,a=e("../core/renderers/canvas/utils/CanvasTinter");i.prototype=Object.create(r.Sprite.prototype),i.prototype.constructor=i,t.exports=i,Object.defineProperties(i.prototype,{width:{get:function(){return this._width},set:function(e){this._width=e}},height:{get:function(){return this._height},set:function(e){this._height=e}}}),i.prototype._onTextureUpdate=function(){},i.prototype._renderWebGL=function(e){var t=this._texture;if(t&&t._uvs){var n=t._uvs,i=t._frame.width,r=t._frame.height,o=t.baseTexture.width,a=t.baseTexture.height;t._uvs=this._uvs,t._frame.width=this.width,t._frame.height=this.height,this.shader.uniforms.uPixelSize.value[0]=1/o,this.shader.uniforms.uPixelSize.value[1]=1/a,this.shader.uniforms.uFrame.value[0]=n.x0,this.shader.uniforms.uFrame.value[1]=n.y0,this.shader.uniforms.uFrame.value[2]=n.x1-n.x0,this.shader.uniforms.uFrame.value[3]=n.y2-n.y0,this.shader.uniforms.uTransform.value[0]=this.tilePosition.x%(i*this.tileScale.x)/this._width,this.shader.uniforms.uTransform.value[1]=this.tilePosition.y%(r*this.tileScale.y)/this._height,this.shader.uniforms.uTransform.value[2]=o/this._width*this.tileScale.x,this.shader.uniforms.uTransform.value[3]=a/this._height*this.tileScale.y,e.setObjectRenderer(e.plugins.sprite),e.plugins.sprite.render(this),t._uvs=n,t._frame.width=i,t._frame.height=r}},i.prototype._renderCanvas=function(e){var t=this._texture;if(t.baseTexture.hasLoaded){var n=e.context,i=this.worldTransform,o=e.resolution,s=t.baseTexture,c=this.tilePosition.x/this.tileScale.x%t._frame.width,l=this.tilePosition.y/this.tileScale.y%t._frame.height;if(!this._canvasPattern){var u=new r.CanvasBuffer(t._frame.width,t._frame.height);16777215!==this.tint?(this.cachedTint!==this.tint&&(this.cachedTint=this.tint,this.tintedTexture=a.getTintedTexture(this,this.tint)),u.context.drawImage(this.tintedTexture,0,0)):u.context.drawImage(s.source,-t._frame.x,-t._frame.y),this._canvasPattern=u.context.createPattern(u.canvas,"repeat")}n.globalAlpha=this.worldAlpha,n.setTransform(i.a*o,i.b*o,i.c*o,i.d*o,i.tx*o,i.ty*o),n.scale(this.tileScale.x,this.tileScale.y),n.translate(c+this.anchor.x*-this._width,l+this.anchor.y*-this._height);var h=e.blendModes[this.blendMode];h!==e.context.globalCompositeOperation&&(n.globalCompositeOperation=h),n.fillStyle=this._canvasPattern,n.fillRect(-c,-l,this._width/this.tileScale.x,this._height/this.tileScale.y)}},i.prototype.getBounds=function(){var e,t,n,i,r=this._width,o=this._height,a=r*(1-this.anchor.x),s=r*-this.anchor.x,c=o*(1-this.anchor.y),l=o*-this.anchor.y,u=this.worldTransform,h=u.a,d=u.b,p=u.c,f=u.d,m=u.tx,g=u.ty,v=h*s+p*l+m,y=f*l+d*s+g,b=h*a+p*l+m,w=f*l+d*a+g,x=h*a+p*c+m,E=f*c+d*a+g,S=h*s+p*c+m,_=f*c+d*s+g;e=S<(e=x<(e=b<(e=v)?b:e)?x:e)?S:e,n=_<(n=E<(n=w<(n=y)?w:n)?E:n)?_:n,t=S>(t=x>(t=b>(t=v)?b:t)?x:t)?S:t,i=_>(i=E>(i=w>(i=y)?w:i)?E:i)?_:i;var T=this._bounds;return T.x=e,T.width=t-e,T.y=n,T.height=i-n,this._currentBounds=T,T},i.prototype.containsPoint=function(e){this.worldTransform.applyInverse(e,o);var t,n=this._width,i=this._height,r=-n*this.anchor.x;return o.x>r&&o.x<r+n&&(t=-i*this.anchor.y,o.y>t&&o.y<t+i)},i.prototype.destroy=function(){r.Sprite.prototype.destroy.call(this),this.tileScale=null,this._tileScaleOffset=null,this.tilePosition=null,this._uvs=null},i.fromFrame=function(e,t,n){var o=r.utils.TextureCache[e];if(!o)throw new Error('The frameId "'+e+'" does not exist in the texture cache '+this);return new i(o,t,n)},i.fromImage=function(e,t,n,o,a){return new i(r.Texture.fromImage(e,o,a),t,n)}},{"../core":29,"../core/renderers/canvas/utils/CanvasTinter":48}],83:[function(e,t,n){var i=e("../core"),r=i.DisplayObject,o=new i.Matrix;r.prototype._cacheAsBitmap=!1,r.prototype._originalRenderWebGL=null,r.prototype._originalRenderCanvas=null,r.prototype._originalUpdateTransform=null,r.prototype._originalHitTest=null,r.prototype._originalDestroy=null,r.prototype._cachedSprite=null,Object.defineProperties(r.prototype,{cacheAsBitmap:{get:function(){return this._cacheAsBitmap},set:function(e){this._cacheAsBitmap!==e&&(this._cacheAsBitmap=e,e?(this._originalRenderWebGL=this.renderWebGL,this._originalRenderCanvas=this.renderCanvas,this._originalUpdateTransform=this.updateTransform,this._originalGetBounds=this.getBounds,this._originalDestroy=this.destroy,this._originalContainsPoint=this.containsPoint,this.renderWebGL=this._renderCachedWebGL,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(this._cachedSprite&&this._destroyCachedDisplayObject(),this.renderWebGL=this._originalRenderWebGL,this.renderCanvas=this._originalRenderCanvas,this.getBounds=this._originalGetBounds,this.destroy=this._originalDestroy,this.updateTransform=this._originalUpdateTransform,this.containsPoint=this._originalContainsPoint))}}}),r.prototype._renderCachedWebGL=function(e){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(e),this._cachedSprite.worldAlpha=this.worldAlpha,e.setObjectRenderer(e.plugins.sprite),e.plugins.sprite.render(this._cachedSprite))},r.prototype._initCachedDisplayObject=function(e){if(!this._cachedSprite){e.currentRenderer.flush();var t=this.getLocalBounds().clone();if(this._filters){var n=this._filters[0].padding;t.x-=n,t.y-=n,t.width+=2*n,t.height+=2*n}var r=e.currentRenderTarget,a=e.filterManager.filterStack,s=new i.RenderTexture(e,0|t.width,0|t.height),c=o;c.tx=-t.x,c.ty=-t.y,this.renderWebGL=this._originalRenderWebGL,s.render(this,c,!0,!0),e.setRenderTarget(r),e.filterManager.filterStack=a,this.renderWebGL=this._renderCachedWebGL,this.updateTransform=this.displayObjectUpdateTransform,this.getBounds=this._getCachedBounds,this._cachedSprite=new i.Sprite(s),this._cachedSprite.worldTransform=this.worldTransform,this._cachedSprite.anchor.x=-t.x/t.width,this._cachedSprite.anchor.y=-t.y/t.height,this.updateTransform(),this.containsPoint=this._cachedSprite.containsPoint.bind(this._cachedSprite)}},r.prototype._renderCachedCanvas=function(e){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(e),this._cachedSprite.worldAlpha=this.worldAlpha,this._cachedSprite.renderCanvas(e))},r.prototype._initCachedDisplayObjectCanvas=function(e){if(!this._cachedSprite){var t=this.getLocalBounds(),n=e.context,r=new i.RenderTexture(e,0|t.width,0|t.height),a=o;a.tx=-t.x,a.ty=-t.y,this.renderCanvas=this._originalRenderCanvas,r.render(this,a,!0),e.context=n,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.getBounds=this._getCachedBounds,this._cachedSprite=new i.Sprite(r),this._cachedSprite.worldTransform=this.worldTransform,this._cachedSprite.anchor.x=-t.x/t.width,this._cachedSprite.anchor.y=-t.y/t.height,this.updateTransform(),this.containsPoint=this._cachedSprite.containsPoint.bind(this._cachedSprite)}},r.prototype._getCachedBounds=function(){return this._cachedSprite._currentBounds=null,this._cachedSprite.getBounds()},r.prototype._destroyCachedDisplayObject=function(){this._cachedSprite._texture.destroy(),this._cachedSprite=null},r.prototype._cacheAsBitmapDestroy=function(){this.cacheAsBitmap=!1,this._originalDestroy()}},{"../core":29}],84:[function(e,t,n){var i=e("../core");i.DisplayObject.prototype.name=null,i.Container.prototype.getChildByName=function(e){for(var t=0;t<this.children.length;t++)if(this.children[t].name===e)return this.children[t];return null}},{"../core":29}],85:[function(e,t,n){var i=e("../core");i.DisplayObject.prototype.getGlobalPosition=function(e){return e=e||new i.Point,this.parent?(this.displayObjectUpdateTransform(),e.x=this.worldTransform.tx,e.y=this.worldTransform.ty):(e.x=this.position.x,e.y=this.position.y),e}},{"../core":29}],86:[function(e,t,n){e("./cacheAsBitmap"),e("./getChildByName"),e("./getGlobalPosition"),t.exports={MovieClip:e("./MovieClip"),TilingSprite:e("./TilingSprite"),BitmapText:e("./BitmapText")}},{"./BitmapText":80,"./MovieClip":81,"./TilingSprite":82,"./cacheAsBitmap":83,"./getChildByName":84,"./getGlobalPosition":85}],87:[function(e,t,n){function i(){r.AbstractFilter.call(this,null,"precision mediump float;\n\nuniform vec4 dimensions;\nuniform float pixelSize;\nuniform sampler2D uSampler;\n\nfloat character(float n, vec2 p)\n{\n    p = floor(p*vec2(4.0, -4.0) + 2.5);\n    if (clamp(p.x, 0.0, 4.0) == p.x && clamp(p.y, 0.0, 4.0) == p.y)\n    {\n        if (int(mod(n/exp2(p.x + 5.0*p.y), 2.0)) == 1) return 1.0;\n    }\n    return 0.0;\n}\n\nvoid main()\n{\n    vec2 uv = gl_FragCoord.xy;\n\n    vec3 col = texture2D(uSampler, floor( uv / pixelSize ) * pixelSize / dimensions.xy).rgb;\n\n    float gray = (col.r + col.g + col.b) / 3.0;\n\n    float n =  65536.0;             // .\n    if (gray > 0.2) n = 65600.0;    // :\n    if (gray > 0.3) n = 332772.0;   // *\n    if (gray > 0.4) n = 15255086.0; // o\n    if (gray > 0.5) n = 23385164.0; // &\n    if (gray > 0.6) n = 15252014.0; // 8\n    if (gray > 0.7) n = 13199452.0; // @\n    if (gray > 0.8) n = 11512810.0; // #\n\n    vec2 p = mod( uv / ( pixelSize * 0.5 ), 2.0) - vec2(1.0);\n    col = col * character(n, p);\n\n    gl_FragColor = vec4(col, 1.0);\n}\n",{dimensions:{type:"4fv",value:new Float32Array([0,0,0,0])},pixelSize:{type:"1f",value:8}})}var r=e("../../core");i.prototype=Object.create(r.AbstractFilter.prototype),i.prototype.constructor=i,t.exports=i,Object.defineProperties(i.prototype,{size:{get:function(){return this.uniforms.pixelSize.value},set:function(e){this.uniforms.pixelSize.value=e}}})},{"../../core":29}],88:[function(e,t,n){function i(){r.AbstractFilter.call(this),this.blurXFilter=new o,this.blurYFilter=new a,this.defaultFilter=new r.AbstractFilter}var r=e("../../core"),o=e("../blur/BlurXFilter"),a=e("../blur/BlurYFilter");i.prototype=Object.create(r.AbstractFilter.prototype),i.prototype.constructor=i,t.exports=i,i.prototype.applyFilter=function(e,t,n){var i=e.filterManager.getRenderTarget(!0);this.defaultFilter.applyFilter(e,t,n),this.blurXFilter.applyFilter(e,t,i),e.blendModeManager.setBlendMode(r.BLEND_MODES.SCREEN),this.blurYFilter.applyFilter(e,i,n),e.blendModeManager.setBlendMode(r.BLEND_MODES.NORMAL),e.filterManager.returnRenderTarget(i)},Object.defineProperties(i.prototype,{blur:{get:function(){return this.blurXFilter.blur},set:function(e){this.blurXFilter.blur=this.blurYFilter.blur=e}},blurX:{get:function(){return this.blurXFilter.blur},set:function(e){this.blurXFilter.blur=e}},blurY:{get:function(){return this.blurYFilter.blur},set:function(e){this.blurYFilter.blur=e}}})},{"../../core":29,"../blur/BlurXFilter":91,"../blur/BlurYFilter":92}],89:[function(e,t,n){function i(e,t){r.AbstractFilter.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform float strength;\nuniform float dirX;\nuniform float dirY;\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying vec2 vBlurTexCoords[3];\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3((aVertexPosition), 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n\n    vBlurTexCoords[0] = aTextureCoord + vec2( (0.004 * strength) * dirX, (0.004 * strength) * dirY );\n    vBlurTexCoords[1] = aTextureCoord + vec2( (0.008 * strength) * dirX, (0.008 * strength) * dirY );\n    vBlurTexCoords[2] = aTextureCoord + vec2( (0.012 * strength) * dirX, (0.012 * strength) * dirY );\n\n    vColor = vec4(aColor.rgb * aColor.a, aColor.a);\n}\n","precision lowp float;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vBlurTexCoords[3];\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = vec4(0.0);\n\n    gl_FragColor += texture2D(uSampler, vTextureCoord     ) * 0.3989422804014327;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 0]) * 0.2419707245191454;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 1]) * 0.05399096651318985;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 2]) * 0.004431848411938341;\n}\n",{strength:{type:"1f",value:1},dirX:{type:"1f",value:e||0},dirY:{type:"1f",value:t||0}}),this.defaultFilter=new r.AbstractFilter,this.passes=1,this.dirX=e||0,this.dirY=t||0,this.strength=4}var r=e("../../core");i.prototype=Object.create(r.AbstractFilter.prototype),i.prototype.constructor=i,t.exports=i,i.prototype.applyFilter=function(e,t,n,i){var r=this.getShader(e);if(this.uniforms.strength.value=this.strength/4/this.passes*(t.frame.width/t.size.width),1===this.passes)e.filterManager.applyFilter(r,t,n,i);else{var o=e.filterManager.getRenderTarget(!0);e.filterManager.applyFilter(r,t,o,i);for(var a=0;a<this.passes-2;a++)e.filterManager.applyFilter(r,o,o,i);e.filterManager.applyFilter(r,o,n,i),e.filterManager.returnRenderTarget(o)}},Object.defineProperties(i.prototype,{blur:{get:function(){return this.strength},set:function(e){this.padding=.5*e,this.strength=e}},dirX:{get:function(){return this.dirX},set:function(e){this.uniforms.dirX.value=e}},dirY:{get:function(){return this.dirY},set:function(e){this.uniforms.dirY.value=e}}})},{"../../core":29}],90:[function(e,t,n){function i(){r.AbstractFilter.call(this),this.blurXFilter=new o,this.blurYFilter=new a}var r=e("../../core"),o=e("./BlurXFilter"),a=e("./BlurYFilter");i.prototype=Object.create(r.AbstractFilter.prototype),i.prototype.constructor=i,t.exports=i,i.prototype.applyFilter=function(e,t,n){var i=e.filterManager.getRenderTarget(!0);this.blurXFilter.applyFilter(e,t,i),this.blurYFilter.applyFilter(e,i,n),e.filterManager.returnRenderTarget(i)},Object.defineProperties(i.prototype,{blur:{get:function(){return this.blurXFilter.blur},set:function(e){this.padding=.5*Math.abs(e),this.blurXFilter.blur=this.blurYFilter.blur=e}},passes:{get:function(){return this.blurXFilter.passes},set:function(e){this.blurXFilter.passes=this.blurYFilter.passes=e}},blurX:{get:function(){return this.blurXFilter.blur},set:function(e){this.blurXFilter.blur=e}},blurY:{get:function(){return this.blurYFilter.blur},set:function(e){this.blurYFilter.blur=e}}})},{"../../core":29,"./BlurXFilter":91,"./BlurYFilter":92}],91:[function(e,t,n){function i(){r.AbstractFilter.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform float strength;\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying vec2 vBlurTexCoords[6];\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3((aVertexPosition), 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n\n    vBlurTexCoords[ 0] = aTextureCoord + vec2(-0.012 * strength, 0.0);\n    vBlurTexCoords[ 1] = aTextureCoord + vec2(-0.008 * strength, 0.0);\n    vBlurTexCoords[ 2] = aTextureCoord + vec2(-0.004 * strength, 0.0);\n    vBlurTexCoords[ 3] = aTextureCoord + vec2( 0.004 * strength, 0.0);\n    vBlurTexCoords[ 4] = aTextureCoord + vec2( 0.008 * strength, 0.0);\n    vBlurTexCoords[ 5] = aTextureCoord + vec2( 0.012 * strength, 0.0);\n\n    vColor = vec4(aColor.rgb * aColor.a, aColor.a);\n}\n","precision lowp float;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vBlurTexCoords[6];\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = vec4(0.0);\n\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 0])*0.004431848411938341;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 1])*0.05399096651318985;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 2])*0.2419707245191454;\n    gl_FragColor += texture2D(uSampler, vTextureCoord     )*0.3989422804014327;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 3])*0.2419707245191454;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 4])*0.05399096651318985;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 5])*0.004431848411938341;\n}\n",{strength:{type:"1f",value:1}}),this.passes=1,this.strength=4}var r=e("../../core");i.prototype=Object.create(r.AbstractFilter.prototype),i.prototype.constructor=i,t.exports=i,i.prototype.applyFilter=function(e,t,n,i){var r=this.getShader(e);if(this.uniforms.strength.value=this.strength/4/this.passes*(t.frame.width/t.size.width),1===this.passes)e.filterManager.applyFilter(r,t,n,i);else{for(var o=e.filterManager.getRenderTarget(!0),a=t,s=o,c=0;c<this.passes-1;c++){e.filterManager.applyFilter(r,a,s,!0);var l=s;s=a,a=l}e.filterManager.applyFilter(r,a,n,i),e.filterManager.returnRenderTarget(o)}},
Object.defineProperties(i.prototype,{blur:{get:function(){return this.strength},set:function(e){this.padding=.5*Math.abs(e),this.strength=e}}})},{"../../core":29}],92:[function(e,t,n){function i(){r.AbstractFilter.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform float strength;\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying vec2 vBlurTexCoords[6];\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3((aVertexPosition), 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n\n    vBlurTexCoords[ 0] = aTextureCoord + vec2(0.0, -0.012 * strength);\n    vBlurTexCoords[ 1] = aTextureCoord + vec2(0.0, -0.008 * strength);\n    vBlurTexCoords[ 2] = aTextureCoord + vec2(0.0, -0.004 * strength);\n    vBlurTexCoords[ 3] = aTextureCoord + vec2(0.0,  0.004 * strength);\n    vBlurTexCoords[ 4] = aTextureCoord + vec2(0.0,  0.008 * strength);\n    vBlurTexCoords[ 5] = aTextureCoord + vec2(0.0,  0.012 * strength);\n\n   vColor = vec4(aColor.rgb * aColor.a, aColor.a);\n}\n","precision lowp float;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vBlurTexCoords[6];\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = vec4(0.0);\n\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 0])*0.004431848411938341;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 1])*0.05399096651318985;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 2])*0.2419707245191454;\n    gl_FragColor += texture2D(uSampler, vTextureCoord     )*0.3989422804014327;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 3])*0.2419707245191454;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 4])*0.05399096651318985;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 5])*0.004431848411938341;\n}\n",{strength:{type:"1f",value:1}}),this.passes=1,this.strength=4}var r=e("../../core");i.prototype=Object.create(r.AbstractFilter.prototype),i.prototype.constructor=i,t.exports=i,i.prototype.applyFilter=function(e,t,n,i){var r=this.getShader(e);if(this.uniforms.strength.value=Math.abs(this.strength)/4/this.passes*(t.frame.height/t.size.height),1===this.passes)e.filterManager.applyFilter(r,t,n,i);else{for(var o=e.filterManager.getRenderTarget(!0),a=t,s=o,c=0;c<this.passes-1;c++){e.filterManager.applyFilter(r,a,s,!0);var l=s;s=a,a=l}e.filterManager.applyFilter(r,a,n,i),e.filterManager.returnRenderTarget(o)}},Object.defineProperties(i.prototype,{blur:{get:function(){return this.strength},set:function(e){this.padding=.5*Math.abs(e),this.strength=e}}})},{"../../core":29}],93:[function(e,t,n){function i(){r.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec2 delta;\n\nfloat random(vec3 scale, float seed)\n{\n    return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);\n}\n\nvoid main(void)\n{\n    vec4 color = vec4(0.0);\n    float total = 0.0;\n\n    float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\n\n    for (float t = -30.0; t <= 30.0; t++)\n    {\n        float percent = (t + offset - 0.5) / 30.0;\n        float weight = 1.0 - abs(percent);\n        vec4 sample = texture2D(uSampler, vTextureCoord + delta * percent);\n        sample.rgb *= sample.a;\n        color += sample * weight;\n        total += weight;\n    }\n\n    gl_FragColor = color / total;\n    gl_FragColor.rgb /= gl_FragColor.a + 0.00001;\n}\n",{delta:{type:"v2",value:{x:.1,y:0}}})}var r=e("../../core");i.prototype=Object.create(r.AbstractFilter.prototype),i.prototype.constructor=i,t.exports=i},{"../../core":29}],94:[function(e,t,n){function i(){r.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float m[25];\n\nvoid main(void)\n{\n\n    vec4 c = texture2D(uSampler, vTextureCoord);\n\n    gl_FragColor.r = (m[0] * c.r);\n        gl_FragColor.r += (m[1] * c.g);\n        gl_FragColor.r += (m[2] * c.b);\n        gl_FragColor.r += (m[3] * c.a);\n        gl_FragColor.r += m[4];\n\n    gl_FragColor.g = (m[5] * c.r);\n        gl_FragColor.g += (m[6] * c.g);\n        gl_FragColor.g += (m[7] * c.b);\n        gl_FragColor.g += (m[8] * c.a);\n        gl_FragColor.g += m[9];\n\n     gl_FragColor.b = (m[10] * c.r);\n        gl_FragColor.b += (m[11] * c.g);\n        gl_FragColor.b += (m[12] * c.b);\n        gl_FragColor.b += (m[13] * c.a);\n        gl_FragColor.b += m[14];\n\n     gl_FragColor.a = (m[15] * c.r);\n        gl_FragColor.a += (m[16] * c.g);\n        gl_FragColor.a += (m[17] * c.b);\n        gl_FragColor.a += (m[18] * c.a);\n        gl_FragColor.a += m[19];\n\n}\n",{m:{type:"1fv",value:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]}})}var r=e("../../core");i.prototype=Object.create(r.AbstractFilter.prototype),i.prototype.constructor=i,t.exports=i,i.prototype._loadMatrix=function(e,t){var n=e;(t=!!t)&&(this._multiply(n,this.uniforms.m.value,e),n=this._colorMatrix(n)),this.uniforms.m.value=n},i.prototype._multiply=function(e,t,n){return e[0]=t[0]*n[0]+t[1]*n[5]+t[2]*n[10]+t[3]*n[15],e[1]=t[0]*n[1]+t[1]*n[6]+t[2]*n[11]+t[3]*n[16],e[2]=t[0]*n[2]+t[1]*n[7]+t[2]*n[12]+t[3]*n[17],e[3]=t[0]*n[3]+t[1]*n[8]+t[2]*n[13]+t[3]*n[18],e[4]=t[0]*n[4]+t[1]*n[9]+t[2]*n[14]+t[3]*n[19],e[5]=t[5]*n[0]+t[6]*n[5]+t[7]*n[10]+t[8]*n[15],e[6]=t[5]*n[1]+t[6]*n[6]+t[7]*n[11]+t[8]*n[16],e[7]=t[5]*n[2]+t[6]*n[7]+t[7]*n[12]+t[8]*n[17],e[8]=t[5]*n[3]+t[6]*n[8]+t[7]*n[13]+t[8]*n[18],e[9]=t[5]*n[4]+t[6]*n[9]+t[7]*n[14]+t[8]*n[19],e[10]=t[10]*n[0]+t[11]*n[5]+t[12]*n[10]+t[13]*n[15],e[11]=t[10]*n[1]+t[11]*n[6]+t[12]*n[11]+t[13]*n[16],e[12]=t[10]*n[2]+t[11]*n[7]+t[12]*n[12]+t[13]*n[17],e[13]=t[10]*n[3]+t[11]*n[8]+t[12]*n[13]+t[13]*n[18],e[14]=t[10]*n[4]+t[11]*n[9]+t[12]*n[14]+t[13]*n[19],e[15]=t[15]*n[0]+t[16]*n[5]+t[17]*n[10]+t[18]*n[15],e[16]=t[15]*n[1]+t[16]*n[6]+t[17]*n[11]+t[18]*n[16],e[17]=t[15]*n[2]+t[16]*n[7]+t[17]*n[12]+t[18]*n[17],e[18]=t[15]*n[3]+t[16]*n[8]+t[17]*n[13]+t[18]*n[18],e[19]=t[15]*n[4]+t[16]*n[9]+t[17]*n[14]+t[18]*n[19],e},i.prototype._colorMatrix=function(e){var t=new Float32Array(e);return t[4]/=255,t[9]/=255,t[14]/=255,t[19]/=255,t},i.prototype.brightness=function(e,t){var n=[e,0,0,0,0,0,e,0,0,0,0,0,e,0,0,0,0,0,1,0];this._loadMatrix(n,t)},i.prototype.greyscale=function(e,t){var n=[e,e,e,0,0,e,e,e,0,0,e,e,e,0,0,0,0,0,1,0];this._loadMatrix(n,t)},i.prototype.grayscale=i.prototype.greyscale,i.prototype.blackAndWhite=function(e){this._loadMatrix([.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0],e)},i.prototype.hue=function(e,t){e=(e||0)/180*Math.PI;var n=Math.cos(e),i=Math.sin(e),r=[.213+.787*n+-.213*i,.715+-.715*n+-.715*i,.072+-.072*n+.928*i,0,0,.213+-.213*n+.143*i,.715+n*(1-.715)+.14*i,.072+-.072*n+-.283*i,0,0,.213+-.213*n+-.787*i,.715+-.715*n+.715*i,.072+.928*n+.072*i,0,0,0,0,0,1,0];this._loadMatrix(r,t)},i.prototype.contrast=function(e,t){var n=(e||0)+1,i=-128*(n-1),r=[n,0,0,0,i,0,n,0,0,i,0,0,n,0,i,0,0,0,1,0];this._loadMatrix(r,t)},i.prototype.saturate=function(e,t){var n=2*(e||0)/3+1,i=-.5*(n-1),r=[n,i,i,0,0,i,n,i,0,0,i,i,n,0,0,0,0,0,1,0];this._loadMatrix(r,t)},i.prototype.desaturate=function(e){this.saturate(-1)},i.prototype.negative=function(e){this._loadMatrix([0,1,1,0,0,1,0,1,0,0,1,1,0,0,0,0,0,0,1,0],e)},i.prototype.sepia=function(e){this._loadMatrix([.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0],e)},i.prototype.technicolor=function(e){this._loadMatrix([1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0],e)},i.prototype.polaroid=function(e){this._loadMatrix([1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],e)},i.prototype.toBGR=function(e){this._loadMatrix([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0],e)},i.prototype.kodachrome=function(e){this._loadMatrix([1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0],e)},i.prototype.browni=function(e){this._loadMatrix([.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0],e)},i.prototype.vintage=function(e){this._loadMatrix([.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0],e)},i.prototype.colorTone=function(e,t,n,i,r){var o=((n=n||16770432)>>16&255)/255,a=(n>>8&255)/255,s=(255&n)/255,c=((i=i||3375104)>>16&255)/255,l=(i>>8&255)/255,u=(255&i)/255,h=[.3,.59,.11,0,0,o,a,s,e=e||.2,0,c,l,u,t=t||.15,0,o-c,a-l,s-u,0,0];this._loadMatrix(h,r)},i.prototype.night=function(e,t){var n=[-2*(e=e||.1),-e,0,0,0,-e,0,e,0,0,0,e,2*e,0,0,0,0,0,1,0];this._loadMatrix(n,t)},i.prototype.predator=function(e,t){var n=[11.224130630493164*e,-4.794486999511719*e,-2.8746118545532227*e,0*e,.40342438220977783*e,-3.6330697536468506*e,9.193157196044922*e,-2.951810836791992*e,0*e,-1.316135048866272*e,-3.2184197902679443*e,-4.2375030517578125*e,7.476448059082031*e,0*e,.8044459223747253*e,0,0,0,1,0];this._loadMatrix(n,t)},i.prototype.lsd=function(e){this._loadMatrix([2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0],e)},i.prototype.reset=function(){this._loadMatrix([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],!1)},Object.defineProperties(i.prototype,{matrix:{get:function(){return this.uniforms.m.value},set:function(e){this.uniforms.m.value=e}}})},{"../../core":29}],95:[function(e,t,n){function i(){r.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float step;\n\nvoid main(void)\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n\n    color = floor(color * step) / step;\n\n    gl_FragColor = color;\n}\n",{step:{type:"1f",value:5}})}var r=e("../../core");i.prototype=Object.create(r.AbstractFilter.prototype),i.prototype.constructor=i,t.exports=i,Object.defineProperties(i.prototype,{step:{get:function(){return this.uniforms.step.value},set:function(e){this.uniforms.step.value=e}}})},{"../../core":29}],96:[function(e,t,n){function i(e,t,n){r.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying mediump vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec2 texelSize;\nuniform float matrix[9];\n\nvoid main(void)\n{\n   vec4 c11 = texture2D(uSampler, vTextureCoord - texelSize); // top left\n   vec4 c12 = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - texelSize.y)); // top center\n   vec4 c13 = texture2D(uSampler, vec2(vTextureCoord.x + texelSize.x, vTextureCoord.y - texelSize.y)); // top right\n\n   vec4 c21 = texture2D(uSampler, vec2(vTextureCoord.x - texelSize.x, vTextureCoord.y)); // mid left\n   vec4 c22 = texture2D(uSampler, vTextureCoord); // mid center\n   vec4 c23 = texture2D(uSampler, vec2(vTextureCoord.x + texelSize.x, vTextureCoord.y)); // mid right\n\n   vec4 c31 = texture2D(uSampler, vec2(vTextureCoord.x - texelSize.x, vTextureCoord.y + texelSize.y)); // bottom left\n   vec4 c32 = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + texelSize.y)); // bottom center\n   vec4 c33 = texture2D(uSampler, vTextureCoord + texelSize); // bottom right\n\n   gl_FragColor =\n       c11 * matrix[0] + c12 * matrix[1] + c13 * matrix[2] +\n       c21 * matrix[3] + c22 * matrix[4] + c23 * matrix[5] +\n       c31 * matrix[6] + c32 * matrix[7] + c33 * matrix[8];\n\n   gl_FragColor.a = c22.a;\n}\n",{matrix:{type:"1fv",value:new Float32Array(e)},texelSize:{type:"v2",value:{x:1/t,y:1/n}}})}var r=e("../../core");i.prototype=Object.create(r.AbstractFilter.prototype),i.prototype.constructor=i,t.exports=i,Object.defineProperties(i.prototype,{matrix:{get:function(){return this.uniforms.matrix.value},set:function(e){this.uniforms.matrix.value=new Float32Array(e)}},width:{get:function(){return 1/this.uniforms.texelSize.value.x},set:function(e){this.uniforms.texelSize.value.x=1/e}},height:{get:function(){return 1/this.uniforms.texelSize.value.y},set:function(e){this.uniforms.texelSize.value.y=1/e}}})},{"../../core":29}],97:[function(e,t,n){function i(){r.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    float lum = length(texture2D(uSampler, vTextureCoord.xy).rgb);\n\n    gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);\n\n    if (lum < 1.00)\n    {\n        if (mod(gl_FragCoord.x + gl_FragCoord.y, 10.0) == 0.0)\n        {\n            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n        }\n    }\n\n    if (lum < 0.75)\n    {\n        if (mod(gl_FragCoord.x - gl_FragCoord.y, 10.0) == 0.0)\n        {\n            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n        }\n    }\n\n    if (lum < 0.50)\n    {\n        if (mod(gl_FragCoord.x + gl_FragCoord.y - 5.0, 10.0) == 0.0)\n        {\n            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n        }\n    }\n\n    if (lum < 0.3)\n    {\n        if (mod(gl_FragCoord.x - gl_FragCoord.y - 5.0, 10.0) == 0.0)\n        {\n            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n        }\n    }\n}\n")}var r=e("../../core");i.prototype=Object.create(r.AbstractFilter.prototype),i.prototype.constructor=i,t.exports=i},{"../../core":29}],98:[function(e,t,n){function i(e,t){var n=new r.Matrix;e.renderable=!1,r.AbstractFilter.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMapCoord;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvoid main(void)\n{\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n   vMapCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n   vColor = vec4(aColor.rgb * aColor.a, aColor.a);\n}\n","precision mediump float;\n\nvarying vec2 vMapCoord;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform vec2 scale;\n\nuniform sampler2D uSampler;\nuniform sampler2D mapSampler;\n\nvoid main(void)\n{\n   vec4 map =  texture2D(mapSampler, vMapCoord);\n\n   map -= 0.5;\n   map.xy *= scale;\n\n   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y));\n}\n",{mapSampler:{type:"sampler2D",value:e.texture},otherMatrix:{type:"mat3",value:n.toArray(!0)},scale:{type:"v2",value:{x:1,y:1}}}),this.maskSprite=e,this.maskMatrix=n,null==t&&(t=20),this.scale=new r.Point(t,t)}var r=e("../../core");i.prototype=Object.create(r.AbstractFilter.prototype),i.prototype.constructor=i,t.exports=i,i.prototype.applyFilter=function(e,t,n){var i=e.filterManager;i.calculateMappedMatrix(t.frame,this.maskSprite,this.maskMatrix),this.uniforms.otherMatrix.value=this.maskMatrix.toArray(!0),this.uniforms.scale.value.x=this.scale.x*(1/t.frame.width),this.uniforms.scale.value.y=this.scale.y*(1/t.frame.height);var r=this.getShader(e);i.applyFilter(r,t,n)},Object.defineProperties(i.prototype,{map:{get:function(){return this.uniforms.mapSampler.value},set:function(e){this.uniforms.mapSampler.value=e}}})},{"../../core":29}],99:[function(e,t,n){function i(){r.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform vec4 dimensions;\nuniform sampler2D uSampler;\n\nuniform float angle;\nuniform float scale;\n\nfloat pattern()\n{\n   float s = sin(angle), c = cos(angle);\n   vec2 tex = vTextureCoord * dimensions.xy;\n   vec2 point = vec2(\n       c * tex.x - s * tex.y,\n       s * tex.x + c * tex.y\n   ) * scale;\n   return (sin(point.x) * sin(point.y)) * 4.0;\n}\n\nvoid main()\n{\n   vec4 color = texture2D(uSampler, vTextureCoord);\n   float average = (color.r + color.g + color.b) / 3.0;\n   gl_FragColor = vec4(vec3(average * 10.0 - 5.0 + pattern()), color.a);\n}\n",{scale:{type:"1f",value:1},angle:{type:"1f",value:5},dimensions:{type:"4fv",value:[0,0,0,0]}})}var r=e("../../core");i.prototype=Object.create(r.AbstractFilter.prototype),i.prototype.constructor=i,t.exports=i,Object.defineProperties(i.prototype,{scale:{get:function(){return this.uniforms.scale.value},set:function(e){this.uniforms.scale.value=e}},angle:{get:function(){return this.uniforms.angle.value},set:function(e){this.uniforms.angle.value=e}}})},{"../../core":29}],100:[function(e,t,n){function i(){r.AbstractFilter.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform float strength;\nuniform vec2 offset;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying vec2 vBlurTexCoords[6];\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3((aVertexPosition+offset), 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n\n    vBlurTexCoords[ 0] = aTextureCoord + vec2(0.0, -0.012 * strength);\n    vBlurTexCoords[ 1] = aTextureCoord + vec2(0.0, -0.008 * strength);\n    vBlurTexCoords[ 2] = aTextureCoord + vec2(0.0, -0.004 * strength);\n    vBlurTexCoords[ 3] = aTextureCoord + vec2(0.0,  0.004 * strength);\n    vBlurTexCoords[ 4] = aTextureCoord + vec2(0.0,  0.008 * strength);\n    vBlurTexCoords[ 5] = aTextureCoord + vec2(0.0,  0.012 * strength);\n\n   vColor = vec4(aColor.rgb * aColor.a, aColor.a);\n}\n","precision lowp float;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vBlurTexCoords[6];\nvarying vec4 vColor;\n\nuniform vec3 color;\nuniform float alpha;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    vec4 sum = vec4(0.0);\n\n    sum += texture2D(uSampler, vBlurTexCoords[ 0])*0.004431848411938341;\n    sum += texture2D(uSampler, vBlurTexCoords[ 1])*0.05399096651318985;\n    sum += texture2D(uSampler, vBlurTexCoords[ 2])*0.2419707245191454;\n    sum += texture2D(uSampler, vTextureCoord     )*0.3989422804014327;\n    sum += texture2D(uSampler, vBlurTexCoords[ 3])*0.2419707245191454;\n    sum += texture2D(uSampler, vBlurTexCoords[ 4])*0.05399096651318985;\n    sum += texture2D(uSampler, vBlurTexCoords[ 5])*0.004431848411938341;\n\n    gl_FragColor = vec4( color.rgb * sum.a * alpha, sum.a * alpha );\n}\n",{blur:{type:"1f",value:1/512},color:{type:"c",value:[0,0,0]},alpha:{type:"1f",value:.7},offset:{type:"2f",value:[5,5]},strength:{type:"1f",value:1}}),this.passes=1,this.strength=4}var r=e("../../core");i.prototype=Object.create(r.AbstractFilter.prototype),i.prototype.constructor=i,t.exports=i,i.prototype.applyFilter=function(e,t,n,i){var r=this.getShader(e);if(this.uniforms.strength.value=this.strength/4/this.passes*(t.frame.height/t.size.height),1===this.passes)e.filterManager.applyFilter(r,t,n,i);else{for(var o=e.filterManager.getRenderTarget(!0),a=t,s=o,c=0;c<this.passes-1;c++){e.filterManager.applyFilter(r,a,s,i);var l=s;s=a,a=l}e.filterManager.applyFilter(r,a,n,i),e.filterManager.returnRenderTarget(o)}},Object.defineProperties(i.prototype,{blur:{get:function(){return this.strength},set:function(e){this.padding=.5*e,this.strength=e}}})},{"../../core":29}],101:[function(e,t,n){function i(){r.AbstractFilter.call(this),this.blurXFilter=new o,this.blurYTintFilter=new a,this.defaultFilter=new r.AbstractFilter,this.padding=30,this._dirtyPosition=!0,this._angle=45*Math.PI/180,this._distance=10,this.alpha=.75,this.hideObject=!1,this.blendMode=r.BLEND_MODES.MULTIPLY}var r=e("../../core"),o=e("../blur/BlurXFilter"),a=e("./BlurYTintFilter");i.prototype=Object.create(r.AbstractFilter.prototype),i.prototype.constructor=i,t.exports=i,i.prototype.applyFilter=function(e,t,n){var i=e.filterManager.getRenderTarget(!0);this._dirtyPosition&&(this._dirtyPosition=!1,this.blurYTintFilter.uniforms.offset.value[0]=Math.sin(this._angle)*this._distance,this.blurYTintFilter.uniforms.offset.value[1]=Math.cos(this._angle)*this._distance),this.blurXFilter.applyFilter(e,t,i),e.blendModeManager.setBlendMode(this.blendMode),this.blurYTintFilter.applyFilter(e,i,n),e.blendModeManager.setBlendMode(r.BLEND_MODES.NORMAL),this.hideObject||this.defaultFilter.applyFilter(e,t,n),e.filterManager.returnRenderTarget(i)},Object.defineProperties(i.prototype,{blur:{get:function(){return this.blurXFilter.blur},set:function(e){this.blurXFilter.blur=this.blurYTintFilter.blur=e}},blurX:{get:function(){return this.blurXFilter.blur},set:function(e){this.blurXFilter.blur=e}},blurY:{get:function(){return this.blurYTintFilter.blur},set:function(e){this.blurYTintFilter.blur=e}},color:{get:function(){return r.utils.rgb2hex(this.blurYTintFilter.uniforms.color.value)},set:function(e){this.blurYTintFilter.uniforms.color.value=r.utils.hex2rgb(e)}},alpha:{get:function(){return this.blurYTintFilter.uniforms.alpha.value},set:function(e){this.blurYTintFilter.uniforms.alpha.value=e}},distance:{get:function(){return this._distance},set:function(e){this._dirtyPosition=!0,this._distance=e}},angle:{get:function(){return this._angle},set:function(e){this._dirtyPosition=!0,this._angle=e}}})},{"../../core":29,"../blur/BlurXFilter":91,"./BlurYTintFilter":100}],102:[function(e,t,n){function i(){r.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\nuniform float gray;\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n   gl_FragColor.rgb = mix(gl_FragColor.rgb, vec3(0.2126*gl_FragColor.r + 0.7152*gl_FragColor.g + 0.0722*gl_FragColor.b), gray);\n}\n",{gray:{type:"1f",value:1}})}var r=e("../../core");i.prototype=Object.create(r.AbstractFilter.prototype),i.prototype.constructor=i,t.exports=i,Object.defineProperties(i.prototype,{gray:{get:function(){return this.uniforms.gray.value},set:function(e){this.uniforms.gray.value=e}}})},{"../../core":29}],103:[function(e,t,n){t.exports={AsciiFilter:e("./ascii/AsciiFilter"),BloomFilter:e("./bloom/BloomFilter"),BlurFilter:e("./blur/BlurFilter"),BlurXFilter:e("./blur/BlurXFilter"),BlurYFilter:e("./blur/BlurYFilter"),BlurDirFilter:e("./blur/BlurDirFilter"),ColorMatrixFilter:e("./color/ColorMatrixFilter"),ColorStepFilter:e("./color/ColorStepFilter"),ConvolutionFilter:e("./convolution/ConvolutionFilter"),CrossHatchFilter:e("./crosshatch/CrossHatchFilter"),DisplacementFilter:e("./displacement/DisplacementFilter"),DotScreenFilter:e("./dot/DotScreenFilter"),GrayFilter:e("./gray/GrayFilter"),DropShadowFilter:e("./dropshadow/DropShadowFilter"),InvertFilter:e("./invert/InvertFilter"),NoiseFilter:e("./noise/NoiseFilter"),PixelateFilter:e("./pixelate/PixelateFilter"),RGBSplitFilter:e("./rgb/RGBSplitFilter"),ShockwaveFilter:e("./shockwave/ShockwaveFilter"),SepiaFilter:e("./sepia/SepiaFilter"),SmartBlurFilter:e("./blur/SmartBlurFilter"),TiltShiftFilter:e("./tiltshift/TiltShiftFilter"),TiltShiftXFilter:e("./tiltshift/TiltShiftXFilter"),TiltShiftYFilter:e("./tiltshift/TiltShiftYFilter"),TwistFilter:e("./twist/TwistFilter")}},{"./ascii/AsciiFilter":87,"./bloom/BloomFilter":88,"./blur/BlurDirFilter":89,"./blur/BlurFilter":90,"./blur/BlurXFilter":91,"./blur/BlurYFilter":92,"./blur/SmartBlurFilter":93,"./color/ColorMatrixFilter":94,"./color/ColorStepFilter":95,"./convolution/ConvolutionFilter":96,"./crosshatch/CrossHatchFilter":97,"./displacement/DisplacementFilter":98,"./dot/DotScreenFilter":99,"./dropshadow/DropShadowFilter":101,"./gray/GrayFilter":102,"./invert/InvertFilter":104,"./noise/NoiseFilter":105,"./pixelate/PixelateFilter":106,"./rgb/RGBSplitFilter":107,"./sepia/SepiaFilter":108,"./shockwave/ShockwaveFilter":109,"./tiltshift/TiltShiftFilter":111,"./tiltshift/TiltShiftXFilter":112,"./tiltshift/TiltShiftYFilter":113,"./twist/TwistFilter":114}],104:[function(e,t,n){function i(){r.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform float invert;\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord);\n\n    gl_FragColor.rgb = mix( (vec3(1)-gl_FragColor.rgb) * gl_FragColor.a, gl_FragColor.rgb, 1.0 - invert);\n}\n",{invert:{type:"1f",value:1}})}var r=e("../../core");i.prototype=Object.create(r.AbstractFilter.prototype),i.prototype.constructor=i,t.exports=i,Object.defineProperties(i.prototype,{invert:{get:function(){return this.uniforms.invert.value},set:function(e){this.uniforms.invert.value=e}}})},{"../../core":29}],105:[function(e,t,n){function i(){r.AbstractFilter.call(this,null,"precision highp float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform float noise;\nuniform sampler2D uSampler;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main()\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n\n    float diff = (rand(vTextureCoord) - 0.5) * noise;\n\n    color.r += diff;\n    color.g += diff;\n    color.b += diff;\n\n    gl_FragColor = color;\n}\n",{noise:{type:"1f",value:.5}})}var r=e("../../core");i.prototype=Object.create(r.AbstractFilter.prototype),i.prototype.constructor=i,t.exports=i,Object.defineProperties(i.prototype,{noise:{get:function(){return this.uniforms.noise.value},set:function(e){this.uniforms.noise.value=e}}})},{"../../core":29}],106:[function(e,t,n){function i(){r.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 dimensions;\nuniform vec2 pixelSize;\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord;\n\n    vec2 size = dimensions.xy / pixelSize;\n\n    vec2 color = floor( ( vTextureCoord * size ) ) / size + pixelSize/dimensions.xy * 0.5;\n\n    gl_FragColor = texture2D(uSampler, color);\n}\n",{dimensions:{type:"4fv",value:new Float32Array([0,0,0,0])},pixelSize:{type:"v2",value:{x:10,y:10}}})}var r=e("../../core");i.prototype=Object.create(r.AbstractFilter.prototype),i.prototype.constructor=i,t.exports=i,Object.defineProperties(i.prototype,{size:{get:function(){return this.uniforms.pixelSize.value},set:function(e){this.uniforms.pixelSize.value=e}}})},{"../../core":29}],107:[function(e,t,n){function i(){r.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 dimensions;\nuniform vec2 red;\nuniform vec2 green;\nuniform vec2 blue;\n\nvoid main(void)\n{\n   gl_FragColor.r = texture2D(uSampler, vTextureCoord + red/dimensions.xy).r;\n   gl_FragColor.g = texture2D(uSampler, vTextureCoord + green/dimensions.xy).g;\n   gl_FragColor.b = texture2D(uSampler, vTextureCoord + blue/dimensions.xy).b;\n   gl_FragColor.a = texture2D(uSampler, vTextureCoord).a;\n}\n",{red:{type:"v2",value:{x:20,y:20}},green:{type:"v2",value:{x:-20,y:20}},blue:{type:"v2",value:{x:20,y:-20}},dimensions:{type:"4fv",value:[0,0,0,0]}})}var r=e("../../core");i.prototype=Object.create(r.AbstractFilter.prototype),i.prototype.constructor=i,t.exports=i,Object.defineProperties(i.prototype,{red:{get:function(){return this.uniforms.red.value},set:function(e){this.uniforms.red.value=e}},green:{get:function(){return this.uniforms.green.value},set:function(e){this.uniforms.green.value=e}},blue:{get:function(){return this.uniforms.blue.value},set:function(e){this.uniforms.blue.value=e}}})},{"../../core":29}],108:[function(e,t,n){function i(){r.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float sepia;\n\nconst mat3 sepiaMatrix = mat3(0.3588, 0.7044, 0.1368, 0.2990, 0.5870, 0.1140, 0.2392, 0.4696, 0.0912);\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n   gl_FragColor.rgb = mix( gl_FragColor.rgb, gl_FragColor.rgb * sepiaMatrix, sepia);\n}\n",{sepia:{type:"1f",value:1}})}var r=e("../../core");i.prototype=Object.create(r.AbstractFilter.prototype),i.prototype.constructor=i,t.exports=i,Object.defineProperties(i.prototype,{sepia:{get:function(){return this.uniforms.sepia.value},set:function(e){this.uniforms.sepia.value=e}}})},{"../../core":29}],109:[function(e,t,n){function i(){r.AbstractFilter.call(this,null,"precision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nuniform vec2 center;\nuniform vec3 params; // 10.0, 0.8, 0.1\nuniform float time;\n\nvoid main()\n{\n    vec2 uv = vTextureCoord;\n    vec2 texCoord = uv;\n\n    float dist = distance(uv, center);\n\n    if ( (dist <= (time + params.z)) && (dist >= (time - params.z)) )\n    {\n        float diff = (dist - time);\n        float powDiff = 1.0 - pow(abs(diff*params.x), params.y);\n\n        float diffTime = diff  * powDiff;\n        vec2 diffUV = normalize(uv - center);\n        texCoord = uv + (diffUV * diffTime);\n    }\n\n    gl_FragColor = texture2D(uSampler, texCoord);\n}\n",{center:{type:"v2",value:{x:.5,y:.5}},params:{type:"v3",value:{x:10,y:.8,z:.1}},time:{type:"1f",value:0}})}var r=e("../../core");i.prototype=Object.create(r.AbstractFilter.prototype),i.prototype.constructor=i,t.exports=i,Object.defineProperties(i.prototype,{center:{get:function(){return this.uniforms.center.value},set:function(e){this.uniforms.center.value=e}},params:{get:function(){return this.uniforms.params.value},set:function(e){this.uniforms.params.value=e}},time:{get:function(){return this.uniforms.time.value},set:function(e){this.uniforms.time.value=e}}})},{"../../core":29}],110:[function(e,t,n){function i(){r.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float blur;\nuniform float gradientBlur;\nuniform vec2 start;\nuniform vec2 end;\nuniform vec2 delta;\nuniform vec2 texSize;\n\nfloat random(vec3 scale, float seed)\n{\n    return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);\n}\n\nvoid main(void)\n{\n    vec4 color = vec4(0.0);\n    float total = 0.0;\n\n    float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\n    vec2 normal = normalize(vec2(start.y - end.y, end.x - start.x));\n    float radius = smoothstep(0.0, 1.0, abs(dot(vTextureCoord * texSize - start, normal)) / gradientBlur) * blur;\n\n    for (float t = -30.0; t <= 30.0; t++)\n    {\n        float percent = (t + offset - 0.5) / 30.0;\n        float weight = 1.0 - abs(percent);\n        vec4 sample = texture2D(uSampler, vTextureCoord + delta / texSize * percent * radius);\n        sample.rgb *= sample.a;\n        color += sample * weight;\n        total += weight;\n    }\n\n    gl_FragColor = color / total;\n    gl_FragColor.rgb /= gl_FragColor.a + 0.00001;\n}\n",{blur:{type:"1f",value:100},gradientBlur:{type:"1f",value:600},start:{type:"v2",value:{x:0,y:window.innerHeight/2}},end:{type:"v2",value:{x:600,y:window.innerHeight/2}},delta:{type:"v2",value:{x:30,y:30}},texSize:{type:"v2",value:{x:window.innerWidth,y:window.innerHeight}}}),this.updateDelta()}var r=e("../../core");i.prototype=Object.create(r.AbstractFilter.prototype),i.prototype.constructor=i,t.exports=i,i.prototype.updateDelta=function(){this.uniforms.delta.value.x=0,this.uniforms.delta.value.y=0},Object.defineProperties(i.prototype,{blur:{get:function(){return this.uniforms.blur.value},set:function(e){this.uniforms.blur.value=e}},gradientBlur:{get:function(){return this.uniforms.gradientBlur.value},set:function(e){this.uniforms.gradientBlur.value=e}},start:{get:function(){return this.uniforms.start.value},set:function(e){this.uniforms.start.value=e,this.updateDelta()}},end:{get:function(){return this.uniforms.end.value},set:function(e){this.uniforms.end.value=e,this.updateDelta()}}})},{"../../core":29}],111:[function(e,t,n){function i(){r.AbstractFilter.call(this),this.tiltShiftXFilter=new o,this.tiltShiftYFilter=new a}var r=e("../../core"),o=e("./TiltShiftXFilter"),a=e("./TiltShiftYFilter");i.prototype=Object.create(r.AbstractFilter.prototype),
i.prototype.constructor=i,t.exports=i,i.prototype.applyFilter=function(e,t,n){var i=e.filterManager.getRenderTarget(!0);this.tiltShiftXFilter.applyFilter(e,t,i),this.tiltShiftYFilter.applyFilter(e,i,n),e.filterManager.returnRenderTarget(i)},Object.defineProperties(i.prototype,{blur:{get:function(){return this.tiltShiftXFilter.blur},set:function(e){this.tiltShiftXFilter.blur=this.tiltShiftYFilter.blur=e}},gradientBlur:{get:function(){return this.tiltShiftXFilter.gradientBlur},set:function(e){this.tiltShiftXFilter.gradientBlur=this.tiltShiftYFilter.gradientBlur=e}},start:{get:function(){return this.tiltShiftXFilter.start},set:function(e){this.tiltShiftXFilter.start=this.tiltShiftYFilter.start=e}},end:{get:function(){return this.tiltShiftXFilter.end},set:function(e){this.tiltShiftXFilter.end=this.tiltShiftYFilter.end=e}}})},{"../../core":29,"./TiltShiftXFilter":112,"./TiltShiftYFilter":113}],112:[function(e,t,n){function i(){r.call(this)}var r=e("./TiltShiftAxisFilter");i.prototype=Object.create(r.prototype),i.prototype.constructor=i,t.exports=i,i.prototype.updateDelta=function(){var e=this.uniforms.end.value.x-this.uniforms.start.value.x,t=this.uniforms.end.value.y-this.uniforms.start.value.y,n=Math.sqrt(e*e+t*t);this.uniforms.delta.value.x=e/n,this.uniforms.delta.value.y=t/n}},{"./TiltShiftAxisFilter":110}],113:[function(e,t,n){function i(){r.call(this)}var r=e("./TiltShiftAxisFilter");i.prototype=Object.create(r.prototype),i.prototype.constructor=i,t.exports=i,i.prototype.updateDelta=function(){var e=this.uniforms.end.value.x-this.uniforms.start.value.x,t=this.uniforms.end.value.y-this.uniforms.start.value.y,n=Math.sqrt(e*e+t*t);this.uniforms.delta.value.x=-t/n,this.uniforms.delta.value.y=e/n}},{"./TiltShiftAxisFilter":110}],114:[function(e,t,n){function i(){r.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float radius;\nuniform float angle;\nuniform vec2 offset;\n\nvoid main(void)\n{\n   vec2 coord = vTextureCoord - offset;\n   float dist = length(coord);\n\n   if (dist < radius)\n   {\n       float ratio = (radius - dist) / radius;\n       float angleMod = ratio * ratio * angle;\n       float s = sin(angleMod);\n       float c = cos(angleMod);\n       coord = vec2(coord.x * c - coord.y * s, coord.x * s + coord.y * c);\n   }\n\n   gl_FragColor = texture2D(uSampler, coord+offset);\n}\n",{radius:{type:"1f",value:.5},angle:{type:"1f",value:5},offset:{type:"v2",value:{x:.5,y:.5}}})}var r=e("../../core");i.prototype=Object.create(r.AbstractFilter.prototype),i.prototype.constructor=i,t.exports=i,Object.defineProperties(i.prototype,{offset:{get:function(){return this.uniforms.offset.value},set:function(e){this.uniforms.offset.value=e}},radius:{get:function(){return this.uniforms.radius.value},set:function(e){this.uniforms.radius.value=e}},angle:{get:function(){return this.uniforms.angle.value},set:function(e){this.uniforms.angle.value=e}}})},{"../../core":29}],115:[function(e,t,n){(function(n){e("./polyfill");var i=t.exports=e("./core");i.extras=e("./extras"),i.filters=e("./filters"),i.interaction=e("./interaction"),i.loaders=e("./loaders"),i.mesh=e("./mesh"),i.accessibility=e("./accessibility"),i.loader=new i.loaders.Loader,Object.assign(i,e("./deprecation")),n.PIXI=i}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./accessibility":21,"./core":29,"./deprecation":79,"./extras":86,"./filters":103,"./interaction":118,"./loaders":121,"./mesh":128,"./polyfill":133}],116:[function(e,t,n){function i(){this.global=new r.Point,this.target=null,this.originalEvent=null}var r=e("../core");i.prototype.constructor=i,t.exports=i,i.prototype.getLocalPosition=function(e,t,n){return e.worldTransform.applyInverse(n||this.global,t)}},{"../core":29}],117:[function(e,t,n){function i(e,t){t=t||{},this.renderer=e,this.autoPreventDefault=void 0===t.autoPreventDefault||t.autoPreventDefault,this.interactionFrequency=t.interactionFrequency||10,this.mouse=new o,this.eventData={stopped:!1,target:null,type:null,data:this.mouse,stopPropagation:function(){this.stopped=!0}},this.interactiveDataPool=[],this.interactionDOMElement=null,this.moveWhenInside=!1,this.eventsAdded=!1,this.onMouseUp=this.onMouseUp.bind(this),this.processMouseUp=this.processMouseUp.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.processMouseDown=this.processMouseDown.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.processMouseMove=this.processMouseMove.bind(this),this.onMouseOut=this.onMouseOut.bind(this),this.processMouseOverOut=this.processMouseOverOut.bind(this),this.onTouchStart=this.onTouchStart.bind(this),this.processTouchStart=this.processTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.processTouchEnd=this.processTouchEnd.bind(this),this.onTouchMove=this.onTouchMove.bind(this),this.processTouchMove=this.processTouchMove.bind(this),this.last=0,this.currentCursorStyle="inherit",this._tempPoint=new r.Point,this.resolution=1,this.setTargetElement(this.renderer.view,this.renderer.resolution)}var r=e("../core"),o=e("./InteractionData");Object.assign(r.DisplayObject.prototype,e("./interactiveTarget")),i.prototype.constructor=i,t.exports=i,i.prototype.setTargetElement=function(e,t){this.removeEvents(),this.interactionDOMElement=e,this.resolution=t||1,this.addEvents()},i.prototype.addEvents=function(){this.interactionDOMElement&&(r.ticker.shared.add(this.update,this),window.navigator.msPointerEnabled&&(this.interactionDOMElement.style["-ms-content-zooming"]="none",this.interactionDOMElement.style["-ms-touch-action"]="none"),window.document.addEventListener("mousemove",this.onMouseMove,!0),this.interactionDOMElement.addEventListener("mousedown",this.onMouseDown,!0),this.interactionDOMElement.addEventListener("mouseout",this.onMouseOut,!0),this.interactionDOMElement.addEventListener("touchstart",this.onTouchStart,!0),this.interactionDOMElement.addEventListener("touchend",this.onTouchEnd,!0),this.interactionDOMElement.addEventListener("touchmove",this.onTouchMove,!0),window.addEventListener("mouseup",this.onMouseUp,!0),this.eventsAdded=!0)},i.prototype.removeEvents=function(){this.interactionDOMElement&&(r.ticker.shared.remove(this.update),window.navigator.msPointerEnabled&&(this.interactionDOMElement.style["-ms-content-zooming"]="",this.interactionDOMElement.style["-ms-touch-action"]=""),window.document.removeEventListener("mousemove",this.onMouseMove,!0),this.interactionDOMElement.removeEventListener("mousedown",this.onMouseDown,!0),this.interactionDOMElement.removeEventListener("mouseout",this.onMouseOut,!0),this.interactionDOMElement.removeEventListener("touchstart",this.onTouchStart,!0),this.interactionDOMElement.removeEventListener("touchend",this.onTouchEnd,!0),this.interactionDOMElement.removeEventListener("touchmove",this.onTouchMove,!0),this.interactionDOMElement=null,window.removeEventListener("mouseup",this.onMouseUp,!0),this.eventsAdded=!1)},i.prototype.update=function(e){this._deltaTime+=e,this._deltaTime<this.interactionFrequency||(this._deltaTime=0,this.interactionDOMElement&&(this.didMove?this.didMove=!1:(this.cursor="inherit",this.processInteractive(this.mouse.global,this.renderer._lastObjectRendered,this.processMouseOverOut,!0),this.currentCursorStyle!==this.cursor&&(this.currentCursorStyle=this.cursor,this.interactionDOMElement.style.cursor=this.cursor))))},i.prototype.dispatchEvent=function(e,t,n){n.stopped||(n.target=e,n.type=t,e.emit(t,n),e[t]&&e[t](n))},i.prototype.mapPositionToPoint=function(e,t,n){var i=this.interactionDOMElement.getBoundingClientRect();e.x=(t-i.left)*(this.interactionDOMElement.width/i.width)/this.resolution,e.y=(n-i.top)*(this.interactionDOMElement.height/i.height)/this.resolution},i.prototype.processInteractive=function(e,t,n,i,r){if(!t||!t.visible)return!1;var o=!1,a=r=t.interactive||r;if(t.hitArea&&(a=!1),t.interactiveChildren)for(var s=t.children,c=s.length-1;c>=0;c--){var l=s[c];if(this.processInteractive(e,l,n,i,a)){if(!l.parent)continue;o=!0,a=!1,l.interactive&&(i=!1)}}return r&&(i&&!o&&(t.hitArea?(t.worldTransform.applyInverse(e,this._tempPoint),o=t.hitArea.contains(this._tempPoint.x,this._tempPoint.y)):t.containsPoint&&(o=t.containsPoint(e))),t.interactive&&n(t,o)),o},i.prototype.onMouseDown=function(e){this.mouse.originalEvent=e,this.eventData.data=this.mouse,this.eventData.stopped=!1,this.mapPositionToPoint(this.mouse.global,e.clientX,e.clientY),this.autoPreventDefault&&this.mouse.originalEvent.preventDefault(),this.processInteractive(this.mouse.global,this.renderer._lastObjectRendered,this.processMouseDown,!0)},i.prototype.processMouseDown=function(e,t){var n=this.mouse.originalEvent,i=2===n.button||3===n.which;t&&(e[i?"_isRightDown":"_isLeftDown"]=!0,this.dispatchEvent(e,i?"rightdown":"mousedown",this.eventData))},i.prototype.onMouseUp=function(e){this.mouse.originalEvent=e,this.eventData.data=this.mouse,this.eventData.stopped=!1,this.mapPositionToPoint(this.mouse.global,e.clientX,e.clientY),this.processInteractive(this.mouse.global,this.renderer._lastObjectRendered,this.processMouseUp,!0)},i.prototype.processMouseUp=function(e,t){var n=this.mouse.originalEvent,i=2===n.button||3===n.which,r=i?"_isRightDown":"_isLeftDown";t?(this.dispatchEvent(e,i?"rightup":"mouseup",this.eventData),e[r]&&(e[r]=!1,this.dispatchEvent(e,i?"rightclick":"click",this.eventData))):e[r]&&(e[r]=!1,this.dispatchEvent(e,i?"rightupoutside":"mouseupoutside",this.eventData))},i.prototype.onMouseMove=function(e){this.mouse.originalEvent=e,this.eventData.data=this.mouse,this.eventData.stopped=!1,this.mapPositionToPoint(this.mouse.global,e.clientX,e.clientY),this.didMove=!0,this.cursor="inherit",this.processInteractive(this.mouse.global,this.renderer._lastObjectRendered,this.processMouseMove,!0),this.currentCursorStyle!==this.cursor&&(this.currentCursorStyle=this.cursor,this.interactionDOMElement.style.cursor=this.cursor)},i.prototype.processMouseMove=function(e,t){this.processMouseOverOut(e,t),this.moveWhenInside&&!t||this.dispatchEvent(e,"mousemove",this.eventData)},i.prototype.onMouseOut=function(e){this.mouse.originalEvent=e,this.eventData.stopped=!1,this.mapPositionToPoint(this.mouse.global,e.clientX,e.clientY),this.interactionDOMElement.style.cursor="inherit",this.mapPositionToPoint(this.mouse.global,e.clientX,e.clientY),this.processInteractive(this.mouse.global,this.renderer._lastObjectRendered,this.processMouseOverOut,!1)},i.prototype.processMouseOverOut=function(e,t){t?(e._over||(e._over=!0,this.dispatchEvent(e,"mouseover",this.eventData)),e.buttonMode&&(this.cursor=e.defaultCursor)):e._over&&(e._over=!1,this.dispatchEvent(e,"mouseout",this.eventData))},i.prototype.onTouchStart=function(e){this.autoPreventDefault&&e.preventDefault();for(var t=e.changedTouches,n=t.length,i=0;i<n;i++){var r=t[i],o=this.getTouchData(r);o.originalEvent=e,this.eventData.data=o,this.eventData.stopped=!1,this.processInteractive(o.global,this.renderer._lastObjectRendered,this.processTouchStart,!0),this.returnTouchData(o)}},i.prototype.processTouchStart=function(e,t){t&&(e._touchDown=!0,this.dispatchEvent(e,"touchstart",this.eventData))},i.prototype.onTouchEnd=function(e){this.autoPreventDefault&&e.preventDefault();for(var t=e.changedTouches,n=t.length,i=0;i<n;i++){var r=t[i],o=this.getTouchData(r);o.originalEvent=e,this.eventData.data=o,this.eventData.stopped=!1,this.processInteractive(o.global,this.renderer._lastObjectRendered,this.processTouchEnd,!0),this.returnTouchData(o)}},i.prototype.processTouchEnd=function(e,t){t?(this.dispatchEvent(e,"touchend",this.eventData),e._touchDown&&(e._touchDown=!1,this.dispatchEvent(e,"tap",this.eventData))):e._touchDown&&(e._touchDown=!1,this.dispatchEvent(e,"touchendoutside",this.eventData))},i.prototype.onTouchMove=function(e){this.autoPreventDefault&&e.preventDefault();for(var t=e.changedTouches,n=t.length,i=0;i<n;i++){var r=t[i],o=this.getTouchData(r);o.originalEvent=e,this.eventData.data=o,this.eventData.stopped=!1,this.processInteractive(o.global,this.renderer._lastObjectRendered,this.processTouchMove,this.moveWhenInside),this.returnTouchData(o)}},i.prototype.processTouchMove=function(e,t){this.moveWhenInside&&!t||this.dispatchEvent(e,"touchmove",this.eventData)},i.prototype.getTouchData=function(e){var t=this.interactiveDataPool.pop();return t||(t=new o),t.identifier=e.identifier,this.mapPositionToPoint(t.global,e.clientX,e.clientY),navigator.isCocoonJS&&(t.global.x=t.global.x/this.resolution,t.global.y=t.global.y/this.resolution),e.globalX=t.global.x,e.globalY=t.global.y,t},i.prototype.returnTouchData=function(e){this.interactiveDataPool.push(e)},i.prototype.destroy=function(){this.removeEvents(),this.renderer=null,this.mouse=null,this.eventData=null,this.interactiveDataPool=null,this.interactionDOMElement=null,this.onMouseUp=null,this.processMouseUp=null,this.onMouseDown=null,this.processMouseDown=null,this.onMouseMove=null,this.processMouseMove=null,this.onMouseOut=null,this.processMouseOverOut=null,this.onTouchStart=null,this.processTouchStart=null,this.onTouchEnd=null,this.processTouchEnd=null,this.onTouchMove=null,this.processTouchMove=null,this._tempPoint=null},r.WebGLRenderer.registerPlugin("interaction",i),r.CanvasRenderer.registerPlugin("interaction",i)},{"../core":29,"./InteractionData":116,"./interactiveTarget":119}],118:[function(e,t,n){t.exports={InteractionData:e("./InteractionData"),InteractionManager:e("./InteractionManager"),interactiveTarget:e("./interactiveTarget")}},{"./InteractionData":116,"./InteractionManager":117,"./interactiveTarget":119}],119:[function(e,t,n){t.exports={interactive:!1,buttonMode:!1,interactiveChildren:!0,defaultCursor:"pointer",_over:!1,_touchDown:!1}},{}],120:[function(e,t,n){function i(e,t){var n={},i=e.data.getElementsByTagName("info")[0],r=e.data.getElementsByTagName("common")[0];n.font=i.getAttribute("face"),n.size=parseInt(i.getAttribute("size"),10),n.lineHeight=parseInt(r.getAttribute("lineHeight"),10),n.chars={};for(var s=e.data.getElementsByTagName("char"),c=0;c<s.length;c++){var l=parseInt(s[c].getAttribute("id"),10),u=new o.Rectangle(parseInt(s[c].getAttribute("x"),10)+t.frame.x,parseInt(s[c].getAttribute("y"),10)+t.frame.y,parseInt(s[c].getAttribute("width"),10),parseInt(s[c].getAttribute("height"),10));n.chars[l]={xOffset:parseInt(s[c].getAttribute("xoffset"),10),yOffset:parseInt(s[c].getAttribute("yoffset"),10),xAdvance:parseInt(s[c].getAttribute("xadvance"),10),kerning:{},texture:new o.Texture(t.baseTexture,u)}}var h=e.data.getElementsByTagName("kerning");for(c=0;c<h.length;c++){var d=parseInt(h[c].getAttribute("first"),10),p=parseInt(h[c].getAttribute("second"),10),f=parseInt(h[c].getAttribute("amount"),10);n.chars[p]&&(n.chars[p].kerning[d]=f)}e.bitmapFont=n,a.BitmapText.fonts[n.font]=n}var r=e("resource-loader").Resource,o=e("../core"),a=e("../extras"),s=e("path");t.exports=function(){return function(e,t){if(!e.data||!e.isXml)return t();if(0===e.data.getElementsByTagName("page").length||0===e.data.getElementsByTagName("info").length||null===e.data.getElementsByTagName("info")[0].getAttribute("face"))return t();var n=s.dirname(e.url);"."===n&&(n=""),this.baseUrl&&n&&("/"===this.baseUrl.charAt(this.baseUrl.length-1)&&(n+="/"),n=n.replace(this.baseUrl,"")),n&&"/"!==n.charAt(n.length-1)&&(n+="/");var a=n+e.data.getElementsByTagName("page")[0].getAttribute("file");if(o.utils.TextureCache[a])i(e,o.utils.TextureCache[a]),t();else{var c={crossOrigin:e.crossOrigin,loadType:r.LOAD_TYPE.IMAGE,metadata:e.metadata.imageMetadata};this.add(e.name+"_image",a,c,function(n){i(e,n.texture),t()})}}}},{"../core":29,"../extras":86,path:2,"resource-loader":16}],121:[function(e,t,n){t.exports={Loader:e("./loader"),bitmapFontParser:e("./bitmapFontParser"),spritesheetParser:e("./spritesheetParser"),textureParser:e("./textureParser"),Resource:e("resource-loader").Resource}},{"./bitmapFontParser":120,"./loader":122,"./spritesheetParser":123,"./textureParser":124,"resource-loader":16}],122:[function(e,t,n){function i(e,t){r.call(this,e,t);for(var n=0;n<i._pixiMiddleware.length;++n)this.use(i._pixiMiddleware[n]())}var r=e("resource-loader"),o=e("./textureParser"),a=e("./spritesheetParser"),s=e("./bitmapFontParser");i.prototype=Object.create(r.prototype),i.prototype.constructor=i,t.exports=i,i._pixiMiddleware=[r.middleware.parsing.blob,o,a,s],i.addPixiMiddleware=function(e){i._pixiMiddleware.push(e)};var c=r.Resource;c.setExtensionXhrType("fnt",c.XHR_RESPONSE_TYPE.DOCUMENT)},{"./bitmapFontParser":120,"./spritesheetParser":123,"./textureParser":124,"resource-loader":16}],123:[function(e,t,n){var i=e("resource-loader").Resource,r=e("path"),o=e("../core");t.exports=function(){return function(e,t){if(!e.data||!e.isJson||!e.data.frames)return t();var n={crossOrigin:e.crossOrigin,loadType:i.LOAD_TYPE.IMAGE,metadata:e.metadata.imageMetadata},a=r.dirname(e.url.replace(this.baseUrl,"")),s=o.utils.getResolutionOfUrl(e.url);this.add(e.name+"_image",a+"/"+e.data.meta.image,n,function(n){e.textures={};var i=e.data.frames;for(var r in i){var a=i[r].frame;if(a){var c=null,l=null;if(c=i[r].rotated?new o.Rectangle(a.x,a.y,a.h,a.w):new o.Rectangle(a.x,a.y,a.w,a.h),i[r].trimmed&&(l=new o.Rectangle(i[r].spriteSourceSize.x/s,i[r].spriteSourceSize.y/s,i[r].sourceSize.w/s,i[r].sourceSize.h/s)),i[r].rotated){var u=c.width;c.width=c.height,c.height=u}c.x/=s,c.y/=s,c.width/=s,c.height/=s,e.textures[r]=new o.Texture(n.texture.baseTexture,c,c.clone(),l,i[r].rotated?2:0),o.utils.TextureCache[r]=e.textures[r]}}t()})}}},{"../core":29,path:2,"resource-loader":16}],124:[function(e,t,n){var i=e("../core");t.exports=function(){return function(e,t){if(e.data&&e.isImage){var n=new i.BaseTexture(e.data,null,i.utils.getResolutionOfUrl(e.url));n.imageUrl=e.url,e.texture=new i.Texture(n),i.utils.BaseTextureCache[e.url]=n,i.utils.TextureCache[e.url]=e.texture}t()}}},{"../core":29}],125:[function(e,t,n){function i(e,t,n,o,a){r.Container.call(this),this._texture=null,this.uvs=n||new Float32Array([0,0,1,0,1,1,0,1]),this.vertices=t||new Float32Array([0,0,100,0,100,100,0,100]),this.indices=o||new Uint16Array([0,1,3,2]),this.dirty=!0,this.blendMode=r.BLEND_MODES.NORMAL,this.canvasPadding=0,this.drawMode=a||i.DRAW_MODES.TRIANGLE_MESH,this.texture=e,this.shader=null}var r=e("../core"),o=new r.Point,a=new r.Polygon;i.prototype=Object.create(r.Container.prototype),i.prototype.constructor=i,t.exports=i,Object.defineProperties(i.prototype,{texture:{get:function(){return this._texture},set:function(e){this._texture!==e&&(this._texture=e,e&&(e.baseTexture.hasLoaded?this._onTextureUpdate():e.once("update",this._onTextureUpdate,this)))}}}),i.prototype._renderWebGL=function(e){e.setObjectRenderer(e.plugins.mesh),e.plugins.mesh.render(this)},i.prototype._renderCanvas=function(e){var t=e.context,n=this.worldTransform;e.roundPixels?t.setTransform(n.a,n.b,n.c,n.d,0|n.tx,0|n.ty):t.setTransform(n.a,n.b,n.c,n.d,n.tx,n.ty),this.drawMode===i.DRAW_MODES.TRIANGLE_MESH?this._renderCanvasTriangleMesh(t):this._renderCanvasTriangles(t)},i.prototype._renderCanvasTriangleMesh=function(e){for(var t=this.vertices,n=this.uvs,i=t.length/2,r=0;r<i-2;r++){var o=2*r;this._renderCanvasDrawTriangle(e,t,n,o,o+2,o+4)}},i.prototype._renderCanvasTriangles=function(e){for(var t=this.vertices,n=this.uvs,i=this.indices,r=i.length,o=0;o<r;o+=3){var a=2*i[o],s=2*i[o+1],c=2*i[o+2];this._renderCanvasDrawTriangle(e,t,n,a,s,c)}},i.prototype._renderCanvasDrawTriangle=function(e,t,n,i,r,o){var a=this._texture.baseTexture.source,s=this._texture.baseTexture.width,c=this._texture.baseTexture.height,l=t[i],u=t[r],h=t[o],d=t[i+1],p=t[r+1],f=t[o+1],m=n[i]*s,g=n[r]*s,v=n[o]*s,y=n[i+1]*c,b=n[r+1]*c,w=n[o+1]*c;if(this.canvasPadding>0){var x=this.canvasPadding/this.worldTransform.a,E=this.canvasPadding/this.worldTransform.d,S=(l+u+h)/3,_=(d+p+f)/3,T=l-S,M=d-_,C=Math.sqrt(T*T+M*M);l=S+T/C*(C+x),d=_+M/C*(C+E),M=p-_,u=S+(T=u-S)/(C=Math.sqrt(T*T+M*M))*(C+x),p=_+M/C*(C+E),M=f-_,h=S+(T=h-S)/(C=Math.sqrt(T*T+M*M))*(C+x),f=_+M/C*(C+E)}e.save(),e.beginPath(),e.moveTo(l,d),e.lineTo(u,p),e.lineTo(h,f),e.closePath(),e.clip();var A=m*b+y*v+g*w-b*v-y*g-m*w,R=l*b+y*h+u*w-b*h-y*u-l*w,P=m*u+l*v+g*h-u*v-l*g-m*h,I=m*b*h+y*u*v+l*g*w-l*b*v-y*g*h-m*u*w,L=d*b+y*f+p*w-b*f-y*p-d*w,D=m*p+d*v+g*f-p*v-d*g-m*f,O=m*b*f+y*p*v+d*g*w-d*b*v-y*g*f-m*p*w;e.transform(R/A,L/A,P/A,D/A,I/A,O/A),e.drawImage(a,0,0),e.restore()},i.prototype.renderMeshFlat=function(e){var t=this.context,n=e.vertices,i=n.length/2;t.beginPath();for(var r=1;r<i-2;r++){var o=2*r,a=n[o],s=n[o+2],c=n[o+4],l=n[o+1],u=n[o+3],h=n[o+5];t.moveTo(a,l),t.lineTo(s,u),t.lineTo(c,h)}t.fillStyle="#FF0000",t.fill(),t.closePath()},i.prototype._onTextureUpdate=function(){this.updateFrame=!0},i.prototype.getBounds=function(e){if(!this._currentBounds){for(var t=e||this.worldTransform,n=t.a,i=t.b,o=t.c,a=t.d,s=t.tx,c=t.ty,l=-1/0,u=-1/0,h=1/0,d=1/0,p=this.vertices,f=0,m=p.length;f<m;f+=2){var g=p[f],v=p[f+1],y=n*g+o*v+s,b=a*v+i*g+c;h=y<h?y:h,d=b<d?b:d,l=y>l?y:l,u=b>u?b:u}if(h===-1/0||u===1/0)return r.Rectangle.EMPTY;var w=this._bounds;w.x=h,w.width=l-h,w.y=d,w.height=u-d,this._currentBounds=w}return this._currentBounds},i.prototype.containsPoint=function(e){if(!this.getBounds().contains(e.x,e.y))return!1;this.worldTransform.applyInverse(e,o);var t,n,r=this.vertices,s=a.points;if(this.drawMode===i.DRAW_MODES.TRIANGLES){var c=this.indices;for(n=this.indices.length,t=0;t<n;t+=3){var l=2*c[t],u=2*c[t+1],h=2*c[t+2];if(s[0]=r[l],s[1]=r[l+1],s[2]=r[u],s[3]=r[u+1],s[4]=r[h],s[5]=r[h+1],a.contains(o.x,o.y))return!0}}else for(n=r.length,t=0;t<n;t+=6)if(s[0]=r[t],s[1]=r[t+1],s[2]=r[t+2],s[3]=r[t+3],s[4]=r[t+4],s[5]=r[t+5],a.contains(o.x,o.y))return!0;return!1},i.DRAW_MODES={TRIANGLE_MESH:0,TRIANGLES:1}},{"../core":29}],126:[function(e,t,n){function i(e,t,n){r.call(this,e),this._ready=!0,this.segmentsX=t||10,this.segmentsY=n||10,this.drawMode=r.DRAW_MODES.TRIANGLES,this.refresh()}var r=e("./Mesh");i.prototype=Object.create(r.prototype),i.prototype.constructor=i,t.exports=i,i.prototype.refresh=function(){var e=this.segmentsX*this.segmentsY,t=[],n=[],i=[],r=this.texture,o=this.segmentsX-1,a=this.segmentsY-1,s=0,c=r.width/o,l=r.height/a;for(s=0;s<e;s++){var u=s%this.segmentsX,h=s/this.segmentsX|0;t.push(u*c,h*l),n.push(r._uvs.x0+(r._uvs.x1-r._uvs.x0)*(u/(this.segmentsX-1)),r._uvs.y0+(r._uvs.y3-r._uvs.y0)*(h/(this.segmentsY-1)))}var d=o*a;for(s=0;s<d;s++){var p=s%o,f=s/o|0,m=f*this.segmentsX+p,g=f*this.segmentsX+p+1,v=(f+1)*this.segmentsX+p,y=(f+1)*this.segmentsX+p+1;i.push(m,g,v),i.push(g,y,v)}this.vertices=new Float32Array(t),this.uvs=new Float32Array(n),this.colors=new Float32Array([]),this.indices=new Uint16Array(i)},i.prototype._onTextureUpdate=function(){r.prototype._onTextureUpdate.call(this),this._ready&&this.refresh()}},{"./Mesh":125}],127:[function(e,t,n){function i(e,t){r.call(this,e),this.points=t,this.vertices=new Float32Array(4*t.length),this.uvs=new Float32Array(4*t.length),this.colors=new Float32Array(2*t.length),this.indices=new Uint16Array(2*t.length),this._ready=!0,this.refresh()}var r=e("./Mesh"),o=e("../core");i.prototype=Object.create(r.prototype),i.prototype.constructor=i,t.exports=i,i.prototype.refresh=function(){var e=this.points;if(!(e.length<1)&&this._texture._uvs){var t=this.uvs,n=this.indices,i=this.colors,r=this._texture._uvs,a=new o.Point(r.x0,r.y0),s=new o.Point(r.x2-r.x0,r.y2-r.y0);t[0]=0+a.x,t[1]=0+a.y,t[2]=0+a.x,t[3]=1*s.y+a.y,i[0]=1,i[1]=1,n[0]=0,n[1]=1;for(var c,l,u=e.length,h=1;h<u;h++)e[h],l=h/(u-1),t[c=4*h]=l*s.x+a.x,t[c+1]=0+a.y,t[c+2]=l*s.x+a.x,t[c+3]=1*s.y+a.y,i[c=2*h]=1,i[c+1]=1,n[c=2*h]=c,n[c+1]=c+1;this.dirty=!0}},i.prototype._onTextureUpdate=function(){r.prototype._onTextureUpdate.call(this),this._ready&&this.refresh()},i.prototype.updateTransform=function(){var e=this.points;if(!(e.length<1)){for(var t,n,i,r,o,a=e[0],s=0,c=0,l=this.vertices,u=e.length,h=0;h<u;h++)n=e[h],i=4*h,c=-((t=h<e.length-1?e[h+1]:n).x-a.x),s=t.y-a.y,s/=r=Math.sqrt(s*s+c*c),c/=r,s*=o=this._texture.height/2,c*=o,l[i]=n.x+s,l[i+1]=n.y+c,l[i+2]=n.x-s,l[i+3]=n.y-c,a=n;this.containerUpdateTransform()}}},{"../core":29,"./Mesh":125}],128:[function(e,t,n){t.exports={Mesh:e("./Mesh"),Plane:e("./Plane"),Rope:e("./Rope"),MeshRenderer:e("./webgl/MeshRenderer"),MeshShader:e("./webgl/MeshShader")}},{"./Mesh":125,"./Plane":126,"./Rope":127,"./webgl/MeshRenderer":129,"./webgl/MeshShader":130}],129:[function(e,t,n){function i(e){r.ObjectRenderer.call(this,e),this.indices=new Uint16Array(15e3);for(var t=0,n=0;t<15e3;t+=6,n+=4)this.indices[t+0]=n+0,this.indices[t+1]=n+1,this.indices[t+2]=n+2,this.indices[t+3]=n+0,this.indices[t+4]=n+2,this.indices[t+5]=n+3;this.currentShader=null}var r=e("../../core"),o=e("../Mesh");i.prototype=Object.create(r.ObjectRenderer.prototype),i.prototype.constructor=i,t.exports=i,r.WebGLRenderer.registerPlugin("mesh",i),i.prototype.onContextChange=function(){},i.prototype.render=function(e){e._vertexBuffer||this._initWebGL(e);var t=this.renderer,n=t.gl,i=e._texture.baseTexture,r=e.shader,a=e.drawMode===o.DRAW_MODES.TRIANGLE_MESH?n.TRIANGLE_STRIP:n.TRIANGLES;t.blendModeManager.setBlendMode(e.blendMode),r=r?r.shaders[n.id]||r.getShader(t):t.shaderManager.plugins.meshShader,this.renderer.shaderManager.setShader(r),r.uniforms.translationMatrix.value=e.worldTransform.toArray(!0),r.uniforms.projectionMatrix.value=t.currentRenderTarget.projectionMatrix.toArray(!0),r.uniforms.alpha.value=e.worldAlpha,r.syncUniforms(),e.dirty?(e.dirty=!1,n.bindBuffer(n.ARRAY_BUFFER,e._vertexBuffer),n.bufferData(n.ARRAY_BUFFER,e.vertices,n.STATIC_DRAW),n.vertexAttribPointer(r.attributes.aVertexPosition,2,n.FLOAT,!1,0,0),n.bindBuffer(n.ARRAY_BUFFER,e._uvBuffer),n.bufferData(n.ARRAY_BUFFER,e.uvs,n.STATIC_DRAW),n.vertexAttribPointer(r.attributes.aTextureCoord,2,n.FLOAT,!1,0,0),n.activeTexture(n.TEXTURE0),i._glTextures[n.id]?n.bindTexture(n.TEXTURE_2D,i._glTextures[n.id]):this.renderer.updateTexture(i),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e._indexBuffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,e.indices,n.STATIC_DRAW)):(n.bindBuffer(n.ARRAY_BUFFER,e._vertexBuffer),n.bufferSubData(n.ARRAY_BUFFER,0,e.vertices),n.vertexAttribPointer(r.attributes.aVertexPosition,2,n.FLOAT,!1,0,0),n.bindBuffer(n.ARRAY_BUFFER,e._uvBuffer),n.vertexAttribPointer(r.attributes.aTextureCoord,2,n.FLOAT,!1,0,0),n.activeTexture(n.TEXTURE0),i._glTextures[n.id]?n.bindTexture(n.TEXTURE_2D,i._glTextures[n.id]):this.renderer.updateTexture(i),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e._indexBuffer),n.bufferSubData(n.ELEMENT_ARRAY_BUFFER,0,e.indices)),n.drawElements(a,e.indices.length,n.UNSIGNED_SHORT,0)},i.prototype._initWebGL=function(e){var t=this.renderer.gl;e._vertexBuffer=t.createBuffer(),e._indexBuffer=t.createBuffer(),e._uvBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,e._vertexBuffer),t.bufferData(t.ARRAY_BUFFER,e.vertices,t.DYNAMIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,e._uvBuffer),t.bufferData(t.ARRAY_BUFFER,e.uvs,t.STATIC_DRAW),e.colors&&(e._colorBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,e._colorBuffer),t.bufferData(t.ARRAY_BUFFER,e.colors,t.STATIC_DRAW)),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e._indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,e.indices,t.STATIC_DRAW)},i.prototype.flush=function(){},i.prototype.start=function(){this.currentShader=null},i.prototype.destroy=function(){r.ObjectRenderer.prototype.destroy.call(this)}},{"../../core":29,"../Mesh":125}],130:[function(e,t,n){function i(e){r.Shader.call(this,e,["precision lowp float;","attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat3 translationMatrix;","uniform mat3 projectionMatrix;","varying vec2 vTextureCoord;","void main(void){","   gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);","   vTextureCoord = aTextureCoord;","}"].join("\n"),["precision lowp float;","varying vec2 vTextureCoord;","uniform float alpha;","uniform sampler2D uSampler;","void main(void){","   gl_FragColor = texture2D(uSampler, vTextureCoord) * alpha ;","}"].join("\n"),{alpha:{type:"1f",value:0},translationMatrix:{type:"mat3",value:new Float32Array(9)},projectionMatrix:{type:"mat3",value:new Float32Array(9)}},{aVertexPosition:0,aTextureCoord:0})}var r=e("../../core");i.prototype=Object.create(r.Shader.prototype),i.prototype.constructor=i,t.exports=i,r.ShaderManager.registerPlugin("meshShader",i)},{"../../core":29}],131:[function(e,t,n){Math.sign||(Math.sign=function(e){return 0==(e=+e)||isNaN(e)?e:e>0?1:-1})},{}],132:[function(e,t,n){Object.assign||(Object.assign=e("object-assign"))},{"object-assign":11}],133:[function(e,t,n){e("./Object.assign"),e("./requestAnimationFrame"),e("./Math.sign")},{"./Math.sign":131,"./Object.assign":132,"./requestAnimationFrame":134}],134:[function(e,t,n){(function(e){if(Date.now&&Date.prototype.getTime||(Date.now=function(){return(new Date).getTime()}),!e.performance||!e.performance.now){var t=Date.now();e.performance||(e.performance={}),e.performance.now=function(){return Date.now()-t}}for(var n=Date.now(),i=["ms","moz","webkit","o"],r=0;r<i.length&&!e.requestAnimationFrame;++r)e.requestAnimationFrame=e[i[r]+"RequestAnimationFrame"],e.cancelAnimationFrame=e[i[r]+"CancelAnimationFrame"]||e[i[r]+"CancelRequestAnimationFrame"];e.requestAnimationFrame||(e.requestAnimationFrame=function(e){if("function"!=typeof e)throw new TypeError(e+"is not a function");var t=Date.now(),i=16+n-t;return i<0&&(i=0),n=t,setTimeout(function(){n=Date.now(),e(performance.now())},i)}),e.cancelAnimationFrame||(e.cancelAnimationFrame=function(e){clearTimeout(e)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[115])(115)}),window.nw&&window.require&&!navigator.isCocoonJS&&(window.require&&(window.require=void 0),window.define&&(window.define=void 0)),function(global){function isFunction(e){return"[object Function]"===ostring.call(e)}function isArray(e){return"[object Array]"===ostring.call(e)}function each(e,t){var n;if(e)for(n=0;n<e.length&&(!e[n]||!t(e[n],n,e));n+=1);}function eachReverse(e,t){var n;if(e)for(n=e.length-1;n>-1&&(!e[n]||!t(e[n],n,e));n-=1);}function hasProp(e,t){return hasOwn.call(e,t)}function getOwn(e,t){return hasProp(e,t)&&e[t]}function eachProp(e,t){var n;for(n in e)if(hasProp(e,n)&&t(e[n],n))break}function mixin(e,t,n,i){return t&&eachProp(t,function(t,r){!n&&hasProp(e,r)||(i&&"string"!=typeof t?(e[r]||(e[r]={}),mixin(e[r],t,n,i)):e[r]=t)}),e}function bind(e,t){return function(){return t.apply(e,arguments)}}function scripts(){return document.getElementsByTagName("script")}function defaultOnError(e){throw e}function getGlobal(e){if(!e)return e;var t=global;return each(e.split("."),function(e){t=t[e]}),t}function makeError(e,t,n,i){var r=new Error(t+"\nhttp://requirejs.org/docs/errors.html#"+e);return r.requireType=e,r.requireModules=i,n&&(r.originalError=n),r}function newContext(e){function t(e,t,n){var i,r,o,a,s,c,l,u,h,d,p,f=t&&t.split("/"),m=x.map,g=m&&m["*"];if(e&&"."===e.charAt(0)&&(t?(function(e){var t,n;for(t=0;e[t];t+=1)if("."===(n=e[t]))e.splice(t,1),t-=1;else if(".."===n){if(1===t&&(".."===e[2]||".."===e[0]))break;t>0&&(e.splice(t-1,2),t-=2)}}(e=(getOwn(x.pkgs,t)?f=[t]:f.slice(0,f.length-1)).concat(e.split("/"))),r=getOwn(x.pkgs,i=e[0]),e=e.join("/"),r&&e===i+"/"+r.main&&(e=i)):0===e.indexOf("./")&&(e=e.substring(2))),n&&m&&(f||g)){for(s=(a=e.split("/")).length;s>0;s-=1){if(l=a.slice(0,s).join("/"),f)for(c=f.length;c>0;c-=1)if((o=getOwn(m,f.slice(0,c).join("/")))&&(o=getOwn(o,l))){u=o,h=s;break}if(u)break;!d&&g&&getOwn(g,l)&&(d=getOwn(g,l),p=s)}!u&&d&&(u=d,h=p),u&&(a.splice(0,h,u),e=a.join("/"))}return e}function n(e){isBrowser&&each(scripts(),function(t){if(t.getAttribute("data-requiremodule")===e&&t.getAttribute("data-requirecontext")===y.contextName)return t.parentNode.removeChild(t),!0})}function i(e){var t=getOwn(x.paths,e);if(t&&isArray(t)&&t.length>1)return t.shift(),y.require.undef(e),y.require([e]),!0}function r(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),
e=e.substring(n+1,e.length)),[t,e]}function o(e,n,i,o){var a,s,c,l,u=null,h=n?n.name:null,d=e,p=!0,f="";return e||(p=!1,e="_@r"+(A+=1)),u=(l=r(e))[0],e=l[1],u&&(u=t(u,h,o),s=getOwn(M,u)),e&&(u?f=s&&s.normalize?s.normalize(e,function(e){return t(e,h,o)}):t(e,h,o):(u=(l=r(f=t(e,h,o)))[0],f=l[1],i=!0,a=y.nameToUrl(f))),{prefix:u,name:f,parentMap:n,unnormalized:!!(c=!u||s||i?"":"_unnormalized"+(R+=1)),url:a,originalName:d,isDefine:p,id:(u?u+"!"+f:f)+c}}function a(e){var t=e.id,n=getOwn(E,t);return n||(n=E[t]=new y.Module(e)),n}function s(e,t,n){var i=e.id,r=getOwn(E,i);!hasProp(M,i)||r&&!r.defineEmitComplete?(r=a(e)).error&&"error"===t?n(r.error):r.on(t,n):"defined"===t&&n(M[i])}function c(e,t){var n=e.requireModules,i=!1;t?t(e):(each(n,function(t){var n=getOwn(E,t);n&&(n.error=e,n.events.error&&(i=!0,n.emit("error",e)))}),i||req.onError(e))}function l(){globalDefQueue.length&&(apsp.apply(T,[T.length-1,0].concat(globalDefQueue)),globalDefQueue=[])}function u(e){delete E[e],delete S[e]}function h(){var e,t,r,o,a=1e3*x.waitSeconds,s=a&&y.startTime+a<(new Date).getTime(),l=[],u=[],d=!1,p=!0;if(!g){if(g=!0,eachProp(S,function(r){if(e=r.map,t=e.id,r.enabled&&(e.isDefine||u.push(r),!r.error))if(!r.inited&&s)i(t)?(o=!0,d=!0):(l.push(t),n(t));else if(!r.inited&&r.fetched&&e.isDefine&&(d=!0,!e.prefix))return p=!1}),s&&l.length)return(r=makeError("timeout","Load timeout for modules: "+l,null,l)).contextName=y.contextName,c(r);p&&each(u,function(e){!function e(t,n,i){var r=t.map.id;t.error?t.emit("error",t.error):(n[r]=!0,each(t.depMaps,function(r,o){var a=r.id,s=getOwn(E,a);!s||t.depMatched[o]||i[a]||(getOwn(n,a)?(t.defineDep(o,M[a]),t.check()):e(s,n,i))}),i[r]=!0)}(e,{},{})}),s&&!o||!d||!isBrowser&&!isWebWorker||w||(w=setTimeout(function(){w=0,h()},50)),g=!1}}function d(e){hasProp(M,e[0])||a(o(e[0],null,!0)).init(e[1],e[2])}function p(e,t,n,i){e.detachEvent&&!isOpera?i&&e.detachEvent(i,t):e.removeEventListener(n,t,!1)}function f(e){var t=e.currentTarget||e.srcElement;return p(t,y.onScriptLoad,"load","onreadystatechange"),p(t,y.onScriptError,"error"),{node:t,id:t&&t.getAttribute("data-requiremodule")}}function m(){var e;for(l();T.length;){if(null===(e=T.shift())[0])return c(makeError("mismatch","Mismatched anonymous define() module: "+e[e.length-1]));d(e)}}var g,v,y,b,w,x={waitSeconds:7,baseUrl:"./",paths:{},pkgs:{},shim:{},config:{}},E={},S={},_={},T=[],M={},C={},A=1,R=1;return b={require:function(e){return e.require?e.require:e.require=y.makeRequire(e.map)},exports:function(e){if(e.usingExports=!0,e.map.isDefine)return e.exports?e.exports:e.exports=M[e.map.id]={}},module:function(e){return e.module?e.module:e.module={id:e.map.id,uri:e.map.url,config:function(){var t=getOwn(x.pkgs,e.map.id);return getOwn(x.config,t?e.map.id+"/"+t.main:e.map.id)||{}},exports:M[e.map.id]}}},(v=function(e){this.events=getOwn(_,e.id)||{},this.map=e,this.shim=getOwn(x.shim,e.id),this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0}).prototype={init:function(e,t,n,i){i=i||{},this.inited||(this.factory=t,n?this.on("error",n):this.events.error&&(n=bind(this,function(e){this.emit("error",e)})),this.depMaps=e&&e.slice(0),this.errback=n,this.inited=!0,this.ignore=i.ignore,i.enabled||this.enabled?this.enable():this.check())},defineDep:function(e,t){this.depMatched[e]||(this.depMatched[e]=!0,this.depCount-=1,this.depExports[e]=t)},fetch:function(){if(!this.fetched){this.fetched=!0,y.startTime=(new Date).getTime();var e=this.map;if(!this.shim)return e.prefix?this.callPlugin():this.load();y.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],bind(this,function(){return e.prefix?this.callPlugin():this.load()}))}},load:function(){var e=this.map.url;C[e]||(C[e]=!0,y.load(this.map.id,e))},check:function(){if(this.enabled&&!this.enabling){var e,t,n=this.map.id,i=this.depExports,r=this.exports,o=this.factory;if(this.inited){if(this.error)this.emit("error",this.error);else if(!this.defining){if(this.defining=!0,this.depCount<1&&!this.defined){if(isFunction(o)){if(this.events.error&&this.map.isDefine||req.onError!==defaultOnError)try{r=y.execCb(n,o,i,r)}catch(t){e=t}else r=y.execCb(n,o,i,r);if(this.map.isDefine&&((t=this.module)&&void 0!==t.exports&&t.exports!==this.exports?r=t.exports:void 0===r&&this.usingExports&&(r=this.exports)),e)return e.requireMap=this.map,e.requireModules=this.map.isDefine?[this.map.id]:null,e.requireType=this.map.isDefine?"define":"require",c(this.error=e)}else r=o;this.exports=r,this.map.isDefine&&!this.ignore&&(M[n]=r,req.onResourceLoad&&req.onResourceLoad(y,this.map,this.depMaps)),u(n),this.defined=!0}this.defining=!1,this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}else this.fetch()}},callPlugin:function(){var e=this.map,n=e.id,i=o(e.prefix);this.depMaps.push(i),s(i,"defined",bind(this,function(i){var r,l,h,d=this.map.name,p=this.map.parentMap?this.map.parentMap.name:null,f=y.makeRequire(e.parentMap,{enableBuildCallback:!0});if(this.map.unnormalized)return i.normalize&&(d=i.normalize(d,function(e){return t(e,p,!0)})||""),s(l=o(e.prefix+"!"+d,this.map.parentMap),"defined",bind(this,function(e){this.init([],function(){return e},null,{enabled:!0,ignore:!0})})),void((h=getOwn(E,l.id))&&(this.depMaps.push(l),this.events.error&&h.on("error",bind(this,function(e){this.emit("error",e)})),h.enable()));(r=bind(this,function(e){this.init([],function(){return e},null,{enabled:!0})})).error=bind(this,function(e){this.inited=!0,this.error=e,e.requireModules=[n],eachProp(E,function(e){0===e.map.id.indexOf(n+"_unnormalized")&&u(e.map.id)}),c(e)}),r.fromText=bind(this,function(t,i){var s=e.name,l=o(s),u=useInteractive;i&&(t=i),u&&(useInteractive=!1),a(l),hasProp(x.config,n)&&(x.config[s]=x.config[n]);try{req.exec(t)}catch(e){return c(makeError("fromtexteval","fromText eval for "+n+" failed: "+e,e,[n]))}u&&(useInteractive=!0),this.depMaps.push(l),y.completeLoad(s),f([s],r)}),i.load(e.name,f,r,x)})),y.enable(i,this),this.pluginMaps[i.id]=i},enable:function(){S[this.map.id]=this,this.enabled=!0,this.enabling=!0,each(this.depMaps,bind(this,function(e,t){var n,i,r;if("string"==typeof e){if(e=o(e,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap),this.depMaps[t]=e,r=getOwn(b,e.id))return void(this.depExports[t]=r(this));this.depCount+=1,s(e,"defined",bind(this,function(e){this.defineDep(t,e),this.check()})),this.errback&&s(e,"error",bind(this,this.errback))}n=e.id,i=E[n],hasProp(b,n)||!i||i.enabled||y.enable(e,this)})),eachProp(this.pluginMaps,bind(this,function(e){var t=getOwn(E,e.id);t&&!t.enabled&&y.enable(e,this)})),this.enabling=!1,this.check()},on:function(e,t){var n=this.events[e];n||(n=this.events[e]=[]),n.push(t)},emit:function(e,t){each(this.events[e],function(e){e(t)}),"error"===e&&delete this.events[e]}},(y={config:x,contextName:e,registry:E,defined:M,urlFetched:C,defQueue:T,Module:v,makeModuleMap:o,nextTick:req.nextTick,onError:c,configure:function(e){e.baseUrl&&"/"!==e.baseUrl.charAt(e.baseUrl.length-1)&&(e.baseUrl+="/");var t=x.pkgs,n=x.shim,i={paths:!0,config:!0,map:!0};eachProp(e,function(e,t){i[t]?"map"===t?(x.map||(x.map={}),mixin(x[t],e,!0,!0)):mixin(x[t],e,!0):x[t]=e}),e.shim&&(eachProp(e.shim,function(e,t){isArray(e)&&(e={deps:e}),!e.exports&&!e.init||e.exportsFn||(e.exportsFn=y.makeShimExports(e)),n[t]=e}),x.shim=n),e.packages&&(each(e.packages,function(e){var n;n=(e="string"==typeof e?{name:e}:e).location,t[e.name]={name:e.name,location:n||e.name,main:(e.main||"main").replace(currDirRegExp,"").replace(jsSuffixRegExp,"")}}),x.pkgs=t),eachProp(E,function(e,t){e.inited||e.map.unnormalized||(e.map=o(t))}),(e.deps||e.callback)&&y.require(e.deps||[],e.callback)},makeShimExports:function(e){return function(){var t;return e.init&&(t=e.init.apply(global,arguments)),t||e.exports&&getGlobal(e.exports)}},makeRequire:function(i,r){function s(t,n,l){var u,d;return r.enableBuildCallback&&n&&isFunction(n)&&(n.__requireJsBuild=!0),"string"==typeof t?isFunction(n)?c(makeError("requireargs","Invalid require call"),l):i&&hasProp(b,t)?b[t](E[i.id]):req.get?req.get(y,t,i,s):(u=o(t,i,!1,!0).id,hasProp(M,u)?M[u]:c(makeError("notloaded",'Module name "'+u+'" has not been loaded yet for context: '+e+(i?"":". Use require([])")))):(m(),y.nextTick(function(){m(),(d=a(o(null,i))).skipMap=r.skipMap,d.init(t,n,l,{enabled:!0}),h()}),s)}return r=r||{},mixin(s,{isBrowser:isBrowser,toUrl:function(e){var n,r=e.lastIndexOf("."),o=e.split("/")[0];return-1!==r&&(!("."===o||".."===o)||r>1)&&(n=e.substring(r,e.length),e=e.substring(0,r)),y.nameToUrl(t(e,i&&i.id,!0),n,!0)},defined:function(e){return hasProp(M,o(e,i,!1,!0).id)},specified:function(e){return e=o(e,i,!1,!0).id,hasProp(M,e)||hasProp(E,e)}}),i||(s.undef=function(e){l();var t=o(e,i,!0),r=getOwn(E,e);n(e),delete M[e],delete C[t.url],delete _[e],r&&(r.events.defined&&(_[e]=r.events),u(e))}),s},enable:function(e){getOwn(E,e.id)&&a(e).enable()},completeLoad:function(e){var t,n,r,o=getOwn(x.shim,e)||{},a=o.exports;for(l();T.length;){if(null===(n=T.shift())[0]){if(n[0]=e,t)break;t=!0}else n[0]===e&&(t=!0);d(n)}if(r=getOwn(E,e),!t&&!hasProp(M,e)&&r&&!r.inited){if(!(!x.enforceDefine||a&&getGlobal(a)))return i(e)?void 0:c(makeError("nodefine","No define call for "+e,null,[e]));d([e,o.deps||[],o.exportsFn])}h()},nameToUrl:function(e,t,n){var i,r,o,a,s,c,l,u,h;if(req.jsExtRegExp.test(e))u=e+(t||"");else{for(i=x.paths,r=x.pkgs,c=(s=e.split("/")).length;c>0;c-=1){if(o=getOwn(r,l=s.slice(0,c).join("/")),h=getOwn(i,l)){isArray(h)&&(h=h[0]),s.splice(0,c,h);break}if(o){a=e===o.name?o.location+"/"+o.main:o.location,s.splice(0,c,a);break}}u=s.join("/"),u=("/"===(u+=t||(/^data\:|\?/.test(u)||n?"":".js")).charAt(0)||u.match(/^[\w\+\.\-]+:/)?"":x.baseUrl)+u}return x.urlArgs?u+(-1===u.indexOf("?")?"?":"&")+x.urlArgs:u},load:function(e,t){req.load(y,e,t)},execCb:function(e,t,n,i){return t.apply(i,n)},onScriptLoad:function(e){if("load"===e.type||readyRegExp.test((e.currentTarget||e.srcElement).readyState)){interactiveScript=null;var t=f(e);y.completeLoad(t.id)}},onScriptError:function(e){var t=f(e);if(!i(t.id))return c(makeError("scripterror","Script error for: "+t.id,e,[t.id]))}}).require=y.makeRequire(),y}function getInteractiveScript(){return interactiveScript&&"interactive"===interactiveScript.readyState||eachReverse(scripts(),function(e){if("interactive"===e.readyState)return interactiveScript=e}),interactiveScript}var req,s,head,baseElement,dataMain,src,interactiveScript,currentlyAddingScript,mainScript,subPath,version="2.1.9",commentRegExp=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/gm,cjsRequireRegExp=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,jsSuffixRegExp=/\.js$/,currDirRegExp=/^\.\//,op=Object.prototype,ostring=op.toString,hasOwn=op.hasOwnProperty,ap=Array.prototype,apsp=ap.splice,isBrowser=!("undefined"==typeof window||"undefined"==typeof navigator||!window.document),isWebWorker=!isBrowser&&"undefined"!=typeof importScripts,readyRegExp=isBrowser&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,defContextName="_",isOpera="undefined"!=typeof opera&&"[object Opera]"===opera.toString(),contexts={},cfg={},globalDefQueue=[],useInteractive=!1;if(void 0===define){if(void 0!==requirejs){if(isFunction(requirejs))return;cfg=requirejs,requirejs=void 0}void 0===require||isFunction(require)||(cfg=require,require=void 0),req=requirejs=function(e,t,n,i){var r,o,a=defContextName;return isArray(e)||"string"==typeof e||(o=e,isArray(t)?(e=t,t=n,n=i):e=[]),o&&o.context&&(a=o.context),(r=getOwn(contexts,a))||(r=contexts[a]=req.s.newContext(a)),o&&r.configure(o),r.require(e,t,n)},req.config=function(e){return req(e)},req.nextTick="undefined"!=typeof setTimeout?function(e){setTimeout(e,4)}:function(e){e()},require||(require=req),req.version=version,req.jsExtRegExp=/^\/|:|\?|\.js$/,req.isBrowser=isBrowser,s=req.s={contexts:contexts,newContext:newContext},req({}),each(["toUrl","undef","defined","specified"],function(e){req[e]=function(){var t=contexts[defContextName];return t.require[e].apply(t,arguments)}}),isBrowser&&(head=s.head=document.getElementsByTagName("head")[0],baseElement=document.getElementsByTagName("base")[0],baseElement&&(head=s.head=baseElement.parentNode)),req.onError=defaultOnError,req.createNode=function(e,t,n){var i=e.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script");return i.type=e.scriptType||"text/javascript",i.charset="utf-8",i.async=!0,i},req.load=function(e,t,n){var i,r=e&&e.config||{};if(isBrowser)return(i=req.createNode(r,t,n)).setAttribute("data-requirecontext",e.contextName),i.setAttribute("data-requiremodule",t),!i.attachEvent||i.attachEvent.toString&&i.attachEvent.toString().indexOf("[native code")<0||isOpera?(i.addEventListener("load",e.onScriptLoad,!1),i.addEventListener("error",e.onScriptError,!1)):(useInteractive=!0,i.attachEvent("onreadystatechange",e.onScriptLoad)),i.src=n,currentlyAddingScript=i,baseElement?head.insertBefore(i,baseElement):head.appendChild(i),currentlyAddingScript=null,i;if(isWebWorker)try{importScripts(n),e.completeLoad(t)}catch(i){e.onError(makeError("importscripts","importScripts failed for "+t+" at "+n,i,[t]))}},isBrowser&&!cfg.skipDataMain&&eachReverse(scripts(),function(e){if(head||(head=e.parentNode),dataMain=e.getAttribute("data-main"))return mainScript=dataMain,cfg.baseUrl||(src=mainScript.split("/"),mainScript=src.pop(),subPath=src.length?src.join("/")+"/":"./",cfg.baseUrl=subPath),mainScript=mainScript.replace(jsSuffixRegExp,""),req.jsExtRegExp.test(mainScript)&&(mainScript=dataMain),cfg.deps=cfg.deps?cfg.deps.concat(mainScript):[mainScript],!0}),define=function(e,t,n){var i,r;"string"!=typeof e&&(n=t,t=e,e=null),isArray(t)||(n=t,t=null),!t&&isFunction(n)&&(t=[],n.length&&(n.toString().replace(commentRegExp,"").replace(cjsRequireRegExp,function(e,n){t.push(n)}),t=(1===n.length?["require"]:["require","exports","module"]).concat(t))),useInteractive&&(i=currentlyAddingScript||getInteractiveScript())&&(e||(e=i.getAttribute("data-requiremodule")),r=contexts[i.getAttribute("data-requirecontext")]),(r?r.defQueue:globalDefQueue).push([e,t,n])},define.amd={jQuery:!0},req.exec=function(text){return eval(text)},req(cfg)}}(this),function(){"use strict";var e=!1,t=[],n=window.requirejs,i=window.require,r=window.define,o={require:i,define:function(){var n=arguments[0];e&&t.push(n),r.apply(this,arguments)},refresh:function(){var e=0;for(e=0;e<t.length;++e)n.undef(t[e])},watch:function(){e=!0}};window.bento=window.bento||o,window.require=void 0,window.define=void 0}(),!bento)var bento=window.bento;bento.define("bento",["bento/utils","bento/lib/domready","bento/eventsystem","bento/managers/asset","bento/managers/input","bento/managers/object","bento/managers/audio","bento/managers/screen","bento/managers/savestate","bento/math/vector2","bento/math/rectangle","bento/renderer","bento/autoresize"],function(e,t,n,i,r,o,a,s,c,l,u,h,d){"use strict";var p,f,m,g=1,v={x:1,y:1},y=!0,b=!1,w={},x=new u(0,0,640,480),E=function(){var t=M.getViewport(),i=e.getScreenSize(),r=m.pixelSize,o=m.responsiveResize.minWidth,a=m.responsiveResize.maxWidth,s=m.responsiveResize.minHeight,c=m.responsiveResize.maxHeight,l=m.responsiveResize.lockedRotation,u=new d(o,a,s,c,l);p&&(p.width=u.width*r,p.height=u.height*r,t.width=Math.round(u.width),t.height=Math.round(u.height),p.style&&(p.style.height=i.height+"px",p.style.width=i.height*(t.width/t.height)+"px"),console.log("Screen size: "+i.width*window.devicePixelRatio+" x "+i.height*window.devicePixelRatio),console.log("Game Resolution: "+u.width+" x "+u.height),f&&("canvas2d"===f.name?!1===M.getAntiAlias()&&M.setAntiAlias(!1):"pixi"===f.name&&M.getRenderer().getPixiRenderer().resize(p.width,p.height)),M.input.updateCanvas(),n.fire("resize",t),S=null)},S=null,_=function(){null!=S&&window.clearTimeout(S),S=window.setTimeout(E,100)},T=function(e){var t=!1;navigator.isCocoonJS||window.Windows||window.ejecta||b&&(n.on(e,function(){t=!0}),n.on("postDraw",function(e){var n,i,r;t&&(t=!1,n=p.toDataURL(),i="screenshot",(r=document.createElement("a")).download=i,r.href=n,document.body.appendChild(r),r.click(),document.body.removeChild(r))}))},M={version:"1.2.6",setup:function(c,l){l=l||c.onComplete||c.onLoad,m=c,c.pixelSize=c.pixelSize||1,c.sortMode=c.sortMode||0,t(function(){var t=function(){M.objects.run(),l&&l()};if(c.canvasDimension){if(!c.canvasDimension.isRectangle)throw"settings.canvasDimension must be a rectangle";x=c.canvasDimension||x}!function(t){var n,i=t.pixelSize||1;(p=t.canvasElement||document.getElementById(t.canvasId))||((n=document.getElementById("wrapper"))||(n=document.body),(p=document.createElement(e.isCocoonJS()?"screencanvas":"canvas")).id=t.canvasId,n.appendChild(p)),p.width=x.width*i,p.height=x.height*i,x.height,x.width}(c),function(e,t){var n=e.renderer;e.renderer=e.renderer?e.renderer.toLowerCase():"canvas2d","canvas2d"===e.renderer?n="bento/renderers/canvas2d":"pixi"===e.renderer?n="bento/renderers/pixi":"auto"===e.renderer&&(console.log("WARNING: auto renderer is deprecated. Please use canvas2d or pixi as renderers."),n="bento/renderers/canvas2d"),new h(n,p,e,function(n){console.log("Init "+n.name+" as renderer"),f=n,y=e.antiAlias,M.setAntiAlias(y),w=M.getGameData(),t()})}(c,function(){b=c.dev||!1,e.setDev(b),c.responsiveResize&&(!0===c.responsiveResize&&(c.responsiveResize={}),c.responsiveResize.landscape=c.responsiveResize.landscape||!1,c.responsiveResize.minWidth=c.responsiveResize.minWidth||180,c.responsiveResize.maxWidth=c.responsiveResize.maxWidth||240,c.responsiveResize.minHeight=c.responsiveResize.minHeight||320,c.responsiveResize.maxHeight=c.responsiveResize.maxHeight||390,window.addEventListener("resize",_,!1),window.addEventListener("orientationchange",_,!1),_()),M.input=new r(w,c),M.objects=new o(M.getGameData,c),M.assets=new i(c),M.audio=new a(M),M.screens=new s(c),e.extend(M,M.objects),c.assetGroups?M.assets.loadAssetGroups(c.assetGroups,t):window.assetsJson?(M.assets.loadInlineAssetsJson(),t()):M.assets.loadAssetsJson(function(e){t()}),bento.watch(),c.reload&&c.dev&&(c.reload.simple&&n.on(c.reload.simple,function(){M.reload()}),c.reload.assets&&n.on(c.reload.assets,function(){M.assets.loadAssetsJson(function(e){M.assets.reload(M.reload)})}),c.reload.jump&&n.on(c.reload.jump,function(){var e=window.prompt("Show which screen?");M.screens.show(e)})),c.screenshot&&c.dev&&T(c.screenshot)})}),document&&document.addEventListener&&(document.addEventListener("pause",function(e){n.fire("cordova-pause",e)},!1),document.addEventListener("resume",function(e){n.fire("cordova-resume",e)},!1),document.addEventListener("resign",function(e){n.fire("cordova-resign",e)},!1),document.addEventListener("backbutton",function(e){n.fire("cordova-backbutton",e)},!1),document.addEventListener("menubutton",function(e){n.fire("cordova-menubutton",e)},!1),document.addEventListener("searchbutton",function(e){n.fire("cordova-searchbutton",e)},!1),document.addEventListener("activated",function(e){n.fire("cordova-activated",e)},!1))},getSettings:function(){return m},getViewport:function(){return x},getCanvas:function(){return p},getRenderer:function(){return f},reload:function(e){var t;if(!M.screens)throw"Bento has not beens started yet.";(t=M.screens.getCurrentScreen())?(M.screens.reset(),M.objects.resume(),M.objects.stop(),bento.refresh(),M.objects.throttle=1,g=1,M.screens.show(e||t.name,void 0,function(){M.objects.run(),n.fire("bentoReload",{})})):console.log("WARNING: No screen has been loaded.")},getGameData:function(){var e=M.objects?M.objects.throttle:1;return{canvas:p,renderer:f,canvasScale:v,viewport:x,entity:null,event:null,deltaT:0,speed:e*g}},getGameSpeed:function(){return g},setGameSpeed:function(e){g=e},isDev:function(){return b},setAntiAlias:function(t){var n;e.isDefined(t)&&(y=t,e.isCocoonJs()&&window.Cocoon&&window.Cocoon.Utils?window.Cocoon.Utils.setAntialias(t):f&&(n=f.getContext())&&n.canvas&&(n.imageSmoothingEnabled=t,n.webkitImageSmoothingEnabled=t,n.mozImageSmoothingEnabled=t,n.msImageSmoothingEnabled=t))},getAntiAlias:function(){return y},createCanvas:function(t){var n,i=y;return e.isDefined(t)&&M.setAntiAlias(t),n=document.createElement("canvas"),e.isDefined(t)&&M.setAntiAlias(i),n},assets:null,objects:null,input:null,audio:null,screens:null,saveState:c,utils:e};return M}),bento.define("bento/components/anchor",["bento","bento/math/vector2","bento/math/rectangle","bento/entity","bento/eventsystem","bento/utils","bento/tween"],function(e,t,n,i,r,o,a){"use strict";var s=function(e){var n,i=e.onResize,o=e.offset||new t(0,0),a=e.relative||new t(0,0),c={offset:e.landscape&&e.landscape.offset||o,relative:e.landscape&&e.landscape.relative||a},l={offset:e.portrait&&e.portrait.offset||o,relative:e.portrait&&e.portrait.relative||a},u=function(){var e=s.getSafeZone(),t=s.isPortrait()?l:c;n.position.x=e.x+t.relative.x*e.width+t.offset.x,n.position.y=e.y+t.relative.y*e.height+t.offset.y,i&&i.call(h,s.isPortrait())},h={name:"anchor",start:function(e){r.on("resize",u),u()},destroy:function(e){r.off("resize",u)},attached:function(e){n=e.entity},resetPosition:u};return h};return s.isPortrait=function(){var t=e.getViewport();return t.width<t.height},s.getSafeZone=function(t){var i,r,o,a=e.getViewport(),c=a.height,l=a.width,u=s.getInsets();return r=c-u.top-u.bottom,o=l-u.left-u.right,i=new n(u.left,u.top,o,r),t&&(i.x+=a.x,i.y+=a.y),i},s.getInsets=function(){var t=o.getScreenSize(),n=e.getViewport(),i=s.insetOverrides,r={top:0,left:0,right:0,bottom:0};return document&&document.documentElement&&window&&window.getComputedStyle&&(r.top=window.getComputedStyle(document.documentElement).getPropertyValue("--sat"),r.right=window.getComputedStyle(document.documentElement).getPropertyValue("--sar"),r.bottom=window.getComputedStyle(document.documentElement).getPropertyValue("--sab"),r.left=window.getComputedStyle(document.documentElement).getPropertyValue("--sal"),r.top=parseInt(r.top)/(t.height*window.devicePixelRatio)*n.height,r.bottom=parseInt(r.bottom)/(t.height*window.devicePixelRatio)*n.height,r.left=parseInt(r.left)/(t.width*window.devicePixelRatio)*n.width,r.right=parseInt(r.right)/(t.width*window.devicePixelRatio)*n.width),null!==i.top&&(r.top=i.top),null!==i.bottom&&(r.bottom=i.bottom),null!==i.left&&(r.left=i.left),null!==i.right&&(r.right=i.right),r},s.insetOverrides={top:null,left:null,right:null,bottom:null},document&&document.documentElement&&window&&window.getComputedStyle&&(document.documentElement.style.setProperty("--sat","env(safe-area-inset-top)"),document.documentElement.style.setProperty("--sar","env(safe-area-inset-right)"),document.documentElement.style.setProperty("--sab","env(safe-area-inset-bottom)"),document.documentElement.style.setProperty("--sal","env(safe-area-inset-left)")),s}),bento.define("bento/components/clickable",["bento","bento/utils","bento/math/vector2","bento/math/transformmatrix","bento/eventsystem","bento/sortedeventsystem"],function(e,t,n,i,r,o){"use strict";var a=[],s=function(t){var n=0;if(!e.objects||!t)return!1;for(n=t.updateWhenPaused;t.parent;)n=(t=t.parent).updateWhenPaused;return n<e.objects.isPaused()},c=function(t){return t.updateWhenPaused<e.objects.isPaused()},l=function(e){if(!(this instanceof l))return new l(e);this.entity=null,this.parent=null,this.rootIndex=-1,this.name="clickable",this.isHovering=!1,this.ignorePauseDuringPointerUpEvent=!e||!t.isDefined(e.ignorePauseDuringPointerUpEvent)||e.ignorePauseDuringPointerUpEvent,this.holdId=null,this.isPointerDown=!1,this.initialized=!1,this.sort=e.sort||!1,this.updateWhenPaused=e.updateWhenPaused,this.callbacks={pointerDown:e.pointerDown||null,pointerUp:e.pointerUp||null,pointerMove:e.pointerMove||null,onClick:e.onClick||null,onClickUp:e.onClickUp||null,onClickMiss:e.onClickMiss||null,onHold:e.onHold||null,onHoldLeave:e.onHoldLeave||null,onHoldEnter:e.onHoldEnter||null,onHoldEnd:e.onHoldEnd||null,onHoverLeave:e.onHoverLeave||null,onHoverEnter:e.onHoverEnter||null},this.clickables=a};return l.prototype.destroy=function(){var e,t=a.indexOf(this),n=0;for(t>-1&&(a[t]=null),n=0,e=a.length;n<e&&!a[n];++n)n===e-1&&(a.length=0);this.sort?(o.off("pointerDown",this.pointerDown,this),o.off("pointerUp",this.pointerUp,this),o.off("pointerMove",this.pointerMove,this)):(r.off("pointerDown",this.pointerDown,this),r.off("pointerUp",this.pointerUp,this),r.off("pointerMove",this.pointerMove,this)),this.initialized=!1},l.prototype.start=function(){this.initialized||(a.push(this),this.sort?(o.on(this,"pointerDown",this.pointerDown,this),o.on(this,"pointerUp",this.pointerUp,this),o.on(this,"pointerMove",this.pointerMove,this)):(r.on("pointerDown",this.pointerDown,this),r.on("pointerUp",this.pointerUp,this),r.on("pointerMove",this.pointerMove,this)),this.initialized=!0)},l.prototype.update=function(){this.isHovering&&this.isPointerDown&&this.callbacks.onHold&&this.callbacks.onHold()},l.prototype.cloneEvent=function(e){return{id:e.id,position:e.position.clone(),eventType:e.eventType,localPosition:e.localPosition.clone(),worldPosition:e.worldPosition.clone(),diffPosition:e.diffPosition?e.diffPosition.clone():void 0}},l.prototype.pointerDown=function(e){var t;(this.updateWhenPaused?c(this):s(this.entity))||(t=this.transformEvent(e),this.isPointerDown=!0,this.callbacks.pointerDown&&this.callbacks.pointerDown.call(this,t),this.entity.getBoundingBox&&this.checkHovering.call(this,t,!0))},l.prototype.pointerUp=function(e){var t,n,i=this.callbacks,r=this.updateWhenPaused?c(this):s(this.entity);!this.ignorePauseDuringPointerUpEvent&&r||(n=(t=this.transformEvent(e)).localPosition,this.isPointerDown=!1,i.pointerUp&&i.pointerUp.call(this,t),this.entity.getBoundingBox().hasPosition(n)&&!r&&(i.onClickUp&&i.onClickUp.call(this,t),this.holdId===t.id&&i.onHoldEnd&&i.onHoldEnd.call(this,t)),this.holdId=null)},l.prototype.pointerMove=function(e){var t,n=this.callbacks;(this.updateWhenPaused?c(this):s(this.entity))||(n.pointerMove&&(t||(t=this.transformEvent(e)),n.pointerMove.call(this,t)),this.entity.getBoundingBox&&(n.onHoldEnter||n.onHoldLeave||n.onHoverLeave)&&(t||(t=this.transformEvent(e)),this.checkHovering.call(this,t)))},l.prototype.checkHovering=function(e,t){var n=e.localPosition,i=this.callbacks;this.entity.getBoundingBox().hasPosition(n)?(this.isHovering||this.holdId!==e.id||i.onHoldEnter&&i.onHoldEnter.call(this,e),!this.isHovering&&i.onHoverEnter&&i.onHoverEnter.call(this,e),this.isHovering=!0,t&&(this.holdId=e.id,i.onClick&&i.onClick.call(this,e))):(this.isHovering&&this.holdId===e.id&&i.onHoldLeave&&i.onHoldLeave.call(this,e),this.isHovering&&i.onHoverLeave&&i.onHoverLeave.call(this,e),this.isHovering=!1,t&&i.onClickMiss&&i.onClickMiss.call(this,e))},l.prototype.isPaused=function(){return this.updateWhenPaused?c(this):s(this.entity)},l.prototype.transformEvent=function(e){return e.localPosition=this.entity.toComparablePosition(e.worldPosition),e},l.prototype.attached=function(e){this.entity=e.entity},l.prototype.toString=function(){return"[object Clickable]"},l}),bento.define("bento/components/eventlistener",["bento","bento/math/vector2","bento/math/rectangle","bento/entity","bento/eventsystem","bento/utils","bento/tween"],function(e,t,n,i,r,o,a){"use strict";return function(t){e.getViewport();var n,i=t.name||"eventListener",a=t.eventName,s=t.ignorePause||!1,c=t.callback||t.onEvent||function(){},l={name:i,start:function(e){a||(o.log("WARNING: eventName is not defined! Using component name as event name"),a=i),r.on(a,s?c:u)},destroy:function(e){r.off(a,s?c:u)},attached:function(e){n=e.entity}},u=function(t){(function(t){var n=0;if(!e.objects||!t)return!1;for(n=t.updateWhenPaused;t.parent;)n=(t=t.parent).updateWhenPaused;return n<e.objects.isPaused()})(n)||c(t)};return l}}),bento.define("bento/components/fill",["bento/utils","bento","bento/math/vector2"],function(e,t,n){"use strict";var i=window.PIXI,r=function(){var e=t.createCanvas();e.width=3,e.height=3;var n=e.getContext("2d");n.fillStyle="#fff",n.fillRect(0,0,e.width,e.height);var r=i.BaseTexture.fromCanvas(e,i.SCALE_MODES.LINEAR),o=new i.Rectangle(1,1,1,1);return new i.Texture(r,o)}(),o=function(e){if(!(this instanceof o))return new o(e);var a=t.getViewport();for(e=e||{},this.parent=null,this.rootIndex=-1,this.sprite=new i.Sprite(r),this.name=e.name||"fill",this.color=e.color||[0,0,0,1];this.color.length<4;)this.color.push(1);this.dimension=e.dimension||e.size||e.rectangle||a.getSize(),this.origin=e.origin||new n(0,0),e.originRelative&&(this.origin.x=this.dimension.width*e.originRelative.x,this.origin.y=this.dimension.height*e.originRelative.y)};return o.prototype.draw=function(e){var t=this.dimension,n=this.origin,i=this.sprite,r=this.color;i.tint=255*r[0]<<16|255*r[1]<<8|255*r[2]<<0,i.alpha=r[3],i.x=t.x-n.x,i.y=t.y-n.y,i.width=t.width,i.height=t.height,e.renderer.drawPixi(this.sprite)},o.prototype.setOriginRelative=function(e){this.origin.x=this.dimension.width*e.x,this.origin.y=this.dimension.height*e.y},o.prototype.toString=function(){return"[object Fill]"},o}),bento.define("bento/components/modal",["bento","bento/math/vector2","bento/math/rectangle","bento/entity","bento/eventsystem","bento/utils","bento/tween"],function(e,t,n,i,r,o,a){"use strict";return function(t){var n,i,r=t.pauseLevel,a={name:"modal",pauseLevel:0,start:function(s){i=e.objects.isPaused(),r<i&&(r=i+1,t.surpressWarnings||o.log("Warning: target pauseLevel ("+t.pauseLevel+") is lower than current pause ("+i+")")),a.pauseLevel=r||i+1,e.objects.pause(a.pauseLevel),n.updateWhenPaused=a.pauseLevel},destroy:function(t){e.objects.isPaused()===a.pauseLevel&&e.objects.pause(i)},attached:function(e){n=e.entity}};return a}}),bento.define("bento/components/nineslice",["bento","bento/math/vector2","bento/math/rectangle","bento/entity","bento/eventsystem","bento/utils","bento/tween"],function(e,t,n,i,r,o,a){"use strict";var s=function(e){if(!(this instanceof s))return new s(e);this.entity=null,this.parent=null,this.rootIndex=-1,this.name="nineslice",this.visible=!0,this.origin=new t(0,0),this._width=0,this._height=0,this._recalculateFlag=!1,this.frameX=0,this.frameY=0,this.spriteImage=null,this.padding=0,this.frameWidth=0,this.frameHeight=0,this.frameCountX=1,this.frameCountY=1,this.framePadding=0,this.sliceWidth=0,this.sliceHeight=0,this.animations={},this.currentAnimation=null,this.currentAnimationLength=0,this.currentFrame=0,this.onCompleteCallback=function(){},this.settings=e,this.setup(e)};return s.prototype.setup=function(t){var n=this;if(t.image)this.spriteImage=t.image;else if(t.imageName){if(!e.assets)throw"Bento asset manager not loaded";this.spriteImage=e.assets.getImage(t.imageName)}else{if(!t.imageFromUrl)return;if(!this.spriteImage&&e.assets)return void e.assets.loadImageFromUrl(t.imageFromUrl,t.imageFromUrl,function(i,r){n.spriteImage=e.assets.getImage(t.imageFromUrl),n.setup(t),t.onLoad&&t.onLoad()})}this.spriteImage?(this.padding=t.padding||0,this.framePadding=t.framePadding||0,this.frameWidth=this.spriteImage.width,this.frameHeight=this.spriteImage.height,t.frameWidth?(this.frameWidth=t.frameWidth,this.frameCountX=Math.floor(this.spriteImage.width/t.frameWidth)):t.frameCountX&&(this.frameCountX=t.frameCountX,this.frameWidth=(this.spriteImage.width-this.framePadding*(this.frameCountX-1))/this.frameCountX),t.frameHeight?(this.frameHeight=t.frameHeight,this.frameCountY=Math.floor(this.spriteImage.width/t.frameHeight)):t.frameCountY&&(this.frameCountY=t.frameCountY,this.frameHeight=(this.spriteImage.height-this.framePadding*(this.frameCountY-1))/this.frameCountY),this.spriteImage&&(this.sliceWidth=Math.floor((this.frameWidth-2*this.padding)/3),this.sliceHeight=Math.floor((this.frameHeight-2*this.padding)/3)),t.width?this._width=Math.max(t.width||0,0):t.innerWidth&&(this._width=2*this.sliceWidth+Math.max(t.innerWidth||0,0)),t.height?this._height=Math.max(t.height||0,0):t.innerHeight&&(this._height=2*this.sliceHeight+Math.max(t.innerHeight||0,0)),this.settings.origin?(this.origin.x=this.settings.origin.x,
this.origin.y=this.settings.origin.y):this.settings.originRelative&&this.setOriginRelative(this.settings.originRelative),this.animations=t.animations||{},this.animations.default||(this.animations.default={frames:[0]}),this.entity&&(this.entity.dimension.x=-this.origin.x,this.entity.dimension.y=-this.origin.y,this.entity.dimension.width=this._width,this.entity.dimension.height=this._height),this.recalculateDimensions(),this.setAnimation("default")):o.log("ERROR: something went wrong with loading the sprite.")},s.prototype.updateEntity=function(){this.entity&&(this.entity.dimension.x=-this.origin.x,this.entity.dimension.y=-this.origin.y,this.entity.dimension.width=this._width,this.entity.dimension.height=this._height)},s.prototype.attached=function(e){this.entity=e.entity,this.updateEntity()},s.prototype.setAnimation=function(e,t,n){var i=this.animations[e];i?i&&(this.currentAnimation!==i||null!==this.onCompleteCallback&&o.isDefined(t))&&(o.isDefined(i.loop)||(i.loop=!0),o.isDefined(i.backTo)||(i.backTo=0),this.onCompleteCallback=t,this.currentAnimation=i,this.currentAnimation.name=e,this.currentAnimationLength=this.currentAnimation.frames.length,n||(this.currentFrame=0),this.currentAnimation.backTo>this.currentAnimationLength&&(console.log("Warning: animation "+e+" has a faulty backTo parameter"),this.currentAnimation.backTo=this.currentAnimationLength)):console.log("Warning: animation "+e+" does not exist.")},s.prototype.getAnimationName=function(){return this.currentAnimation.name},s.prototype.setFrame=function(e){this.currentFrame=e},s.prototype.getCurrentSpeed=function(){return this.currentAnimation.speed},s.prototype.setCurrentSpeed=function(e){this.currentAnimation.speed=e},s.prototype.getCurrentFrame=function(){return this.currentFrame},Object.defineProperty(s.prototype,"width",{get:function(){return this._width},set:function(e){this._width=Math.max(e,0),this._recalculateFlag=!0}}),Object.defineProperty(s.prototype,"height",{get:function(){return this._height},set:function(e){this._height=Math.max(e,0),this._recalculateFlag=!0}}),Object.defineProperty(s.prototype,"innerWidth",{get:function(){return Math.max(this._width-2*this.sliceWidth,0)},set:function(e){e-=2*this.sliceWidth,this._width=2*this.sliceWidth+Math.max(e,0),this._recalculateFlag=!0}}),Object.defineProperty(s.prototype,"innerHeight",{get:function(){return Math.max(this._height-2*this.sliceHeight,0)},set:function(e){e-=2*this.sliceHeight,this._height=2*this.sliceHeight+Math.max(e,0),this._recalculateFlag=!0}}),s.prototype.setOriginRelative=function(e){this.origin.x=e.x*this._width,this.origin.y=e.y*this._height,this.settings.originRelative=e.clone()},s.prototype.update=function(e){var t;if(this._recalculateFlag&&this.recalculateDimensions(),this.currentAnimation&&!(this.currentAnimationLength<=1||0===this.currentAnimation.speed)){var n=this.currentAnimation.speed||1;if(this.currentAnimation.frameSpeeds&&this.currentAnimation.frameSpeeds.length-1>=this.currentFrame&&(n*=this.currentAnimation.frameSpeeds[Math.floor(this.currentFrame)]),t=!1,this.currentFrame+=n*e.speed,this.currentAnimation.loop)for(;this.currentFrame>=this.currentAnimation.frames.length;)this.currentFrame-=this.currentAnimation.frames.length-this.currentAnimation.backTo,t=!0;else this.currentFrame>=this.currentAnimation.frames.length&&(t=!0);t&&this.onCompleteCallback&&(this.onCompleteCallback(),this.currentAnimation.loop||(this.onCompleteCallback=null))}},s.prototype.recalculateDimensions=function(){this._innerWidth=Math.round(Math.max(0,this._width-2*this.sliceWidth)),this._innerHeight=Math.round(Math.max(0,this._height-2*this.sliceHeight)),this._leftWidth=Math.min(this.sliceWidth,this._width/2),this.rightWidth=Math.min(this.sliceWidth,this._width-this._leftWidth),this._topHeight=Math.min(this.sliceHeight,this._height/2),this._bottomHeight=Math.min(this.sliceHeight,this._height-this._topHeight),this.settings.originRelative&&(this.origin.x=this.settings.originRelative.x*this._width,this.origin.y=this.settings.originRelative.y*this._height),this.entity&&this.updateEntity(),this._recalculateFlag=!1},s.prototype.fillArea=function(e,t,n,i,r,o){var a=(this.sliceWidth+this.padding)*(t%3)+this.frameX,s=(this.sliceHeight+this.padding)*Math.floor(t/3)+this.frameY;0!==r&&0!==o&&(r||(r=this.sliceWidth),o||(o=this.sliceHeight),e.drawImage(this.spriteImage,a,s,this.sliceWidth,this.sliceHeight,0|n,0|i,r,o))},s.prototype.updateFrame=function(){var e=Math.min(Math.floor(this.currentFrame),this.currentAnimation.frames.length-1),t=this.currentAnimation.frames[e];this.frameX=t%this.frameCountX*(this.frameWidth+this.padding),this.frameY=Math.floor(t/this.frameCountX)*(this.frameHeight+this.padding)},s.prototype.draw=function(e){e.entity;var t=this.origin;0!==this._width&&0!==this._height&&(this.updateFrame(),e.renderer.translate(-Math.round(t.x),-Math.round(t.y)),this.fillArea(e.renderer,0,0,0,this._leftWidth,this._topHeight),this.fillArea(e.renderer,1,this._leftWidth,0,this._innerWidth,this._topHeight),this.fillArea(e.renderer,2,this._width-this.rightWidth,0,this.rightWidth,this._topHeight),this.fillArea(e.renderer,3,0,this._topHeight,this._leftWidth,this._innerHeight),this.fillArea(e.renderer,4,this._leftWidth,this._topHeight,this._innerWidth,this._innerHeight),this.fillArea(e.renderer,5,this._width-this.rightWidth,this._topHeight,this.rightWidth,this._innerHeight),this.fillArea(e.renderer,6,0,this._height-this._bottomHeight,this._leftWidth,this._bottomHeight),this.fillArea(e.renderer,7,this._leftWidth,this._height-this._bottomHeight,this._innerWidth,this._bottomHeight),this.fillArea(e.renderer,8,this._width-this.rightWidth,this._height-this._bottomHeight,this.rightWidth,this._bottomHeight),e.renderer.translate(Math.round(t.x),Math.round(t.y)))},s.prototype.setWidth=function(e){this.width=e},s.prototype.setHeight=function(e){this.height=e},s}),bento.define("bento/components/pixi/sprite",["bento","bento/utils","bento/components/sprite"],function(e,t,n){"use strict";var i=function(t){if(!(this instanceof i))return new i(t);n.call(this,t),this.sprite=new window.PIXI.Sprite,this.scaleMode=t.scaleMode||(e.getAntiAlias()?window.PIXI.SCALE_MODES.LINEAR:window.PIXI.SCALE_MODES.NEAREST)};return i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype.draw=function(e){e.entity,this.currentAnimation&&this.visible&&(this.updateFrame(),this.updateSprite(this.spriteImage,this.sourceX,this.sourceY,this.frameWidth,this.frameHeight),e.renderer.translate(-Math.round(this.origin.x),-Math.round(this.origin.y)),e.renderer.drawPixi(this.sprite),e.renderer.translate(Math.round(this.origin.x),Math.round(this.origin.y)))},i.prototype.updateSprite=function(e,t,n,i,r){var o,a,s;e&&((s=e.image).texture||(s.texture=new window.PIXI.BaseTexture(s,this.scaleMode),s.frame=new window.PIXI.Texture(s.texture)),(o=(a=s.frame)._frame).x=e.x+t,o.y=e.y+n,o.width=i,o.height=r,a._updateUvs(),this.sprite.texture=a)},i.prototype.toString=function(){return"[object PixiSprite]"},i}),bento.define("bento/components/spine",["bento/utils","bento","bento/math/vector2"],function(e,t,n){"use strict";var i,r,o={},a=function(e,n,r,c){var l,u=t.assets.getSpine(e),h=u.skinImages,d=t.assets.getSpineLoader(),p=function(t){d.loadTexture(u.path+t,function(t,i){var s=a(e,n,r,c);l.skeleton=s.skeleton,l.state=s.state,l.bounds=y.skeleton,l.onReload&&l.onReload(),o[t]=i},function(){})},f=new window.spine.TextureAtlas(u.atlas,function(e){var t,n=d.get(u.path+e);return n||(i||(t=new Image,i=new window.spine.FakeTexture(t)),n=i,c===h[e]&&p(e)),n}),m=new window.spine.AtlasAttachmentLoader(f),g=new window.spine.SkeletonJson(m).readSkeletonData(u.skeleton),v=new window.spine.Skeleton(g);v.flipY=!0;var y=s(v);v.setSkinByName(c);var b=new window.spine.AnimationState(new window.spine.AnimationStateData(v.data));return b.setAnimation(0,n,!0),b.addListener({event:r.onEvent||function(e,t){},complete:r.onComplete||function(e,t){},start:r.onStart||function(e){},end:r.onEnd||function(e){}}),l={skeleton:v,state:b,bounds:y,onReload:null}},s=function(e){e.data,e.setToSetupPose(),e.updateWorldTransform();var t=new window.spine.Vector2,n=new window.spine.Vector2;return e.getBounds(t,n,[]),{offset:t,size:n}},c=function(t){var n,i,o,s,c,l=t.name||"spine",u=t.spineName||t.spine,h=t.skin||"default",d=t.animation||"default",p=!0,f=t.onEvent,m=t.onComplete,g=t.onStart,v=t.onEnd,y=t.triangleRendering||!1,b=1,w=t.scale||1,x={name:l,start:function(t){n||(n=a(u,d,{onEvent:f,onComplete:function(e,t){m&&m(e,t)},onStart:g,onEnd:v},h),i=n.skeleton,o=n.state,s=n.bounds,n.onReload=function(){i=n.skeleton,o=n.state,s=n.bounds,o.setAnimation(0,d,p),o.apply(i)}),r||((r=new window.spine.canvas.SkeletonRenderer(t.renderer.getContext())).debugRendering=!1),E(),e.isNumber(w)||(e.log("ERROR: scale must be a number"),w=1)},destroy:function(e){},update:function(e){o.update(e.deltaT/1e3*e.speed*b),o.apply(i)},draw:function(e){e.renderer.scale(w,w),i.updateWorldTransform(),r.triangleRendering=y,r.draw(i),e.renderer.scale(1/w,1/w)},attached:function(e){c=e.entity},setAnimation:function(t,n,r){d!==t&&(d=t,b=1,p=e.getDefault(r,!0),o.setAnimation(0,t,p),m=n,o.apply(i))},getAnimationName:function(){return d},getCurrentSpeed:function(){return b},setCurrentSpeed:function(e){b=e},getSpineData:function(){return{skeletonData:i,animationState:o}}},E=function(){c&&(c.dimension.x=s.offset.x*w,c.dimension.y=s.offset.y*w,c.dimension.width=s.size.x*w,c.dimension.height=s.size.y*w)};return x};return c.setDebugRendering=function(e){r&&(r.debugRendering=e)},c.cleanLazyLoadedImages=function(){var n=t.assets.getSpineLoader();e.forEach(o,function(t,i,r,o){try{n.remove(i)}catch(t){e.log(t)}t.dispose&&t.dispose()}),o=[]},c}),bento.define("bento/components/sprite",["bento","bento/utils","bento/math/vector2"],function(e,t,n){"use strict";var i=function(e){if(!(this instanceof i))return new i(e);this.entity=null,this.name=e.name||"sprite",this.visible=!0,this.parent=null,this.rootIndex=-1,this.animationSettings=e||{frameCountX:1,frameCountY:1},this.spriteImage=null,this.frameCountX=1,this.frameCountY=1,this.frameWidth=0,this.frameHeight=0,this.padding=0,this.origin=new n(0,0),this.currentSpriteSheet="",this.sourceX=0,this.sourceY=0,this.animations={},this.currentAnimation=null,this.currentAnimationLength=0,this.currentFrame=0,this.onCompleteCallback=function(){},this.setup(e)};return i.prototype.setup=function(n){var i,r,o=this;if(n&&n.spriteSheet&&(r=e.assets.getSpriteSheet(n.spriteSheet),this.currentSpriteSheet=n.spriteSheet,(n=t.copyObject(r.animation)).image=r.image,n.animation&&(n.animations={default:n.animation})),this.animationSettings=n||this.animationSettings,i=this.animationSettings.padding||0,this.animations.default||(this.animationSettings.animations||(this.animationSettings.animations={}),this.animationSettings.animations.default||(this.animationSettings.animations.default={frames:[0]})),n.image)this.spriteImage=n.image;else if(n.imageName){if(!e.assets)throw"Bento asset manager not loaded";this.spriteImage=e.assets.getImage(n.imageName)}else{if(!n.imageFromUrl)return;if(!this.spriteImage&&e.assets)return void e.assets.loadImageFromUrl(n.imageFromUrl,n.imageFromUrl,function(t,i){o.spriteImage=e.assets.getImage(n.imageFromUrl),o.setup(n),n.onLoad&&n.onLoad()})}this.spriteImage?(this.animationSettings.frameWidth?(this.frameWidth=this.animationSettings.frameWidth,this.frameCountX=Math.floor(this.spriteImage.width/this.frameWidth)):(this.frameCountX=this.animationSettings.frameCountX||1,this.frameWidth=(this.spriteImage.width-i*(this.frameCountX-1))/this.frameCountX),this.animationSettings.frameHeight?(this.frameHeight=this.animationSettings.frameHeight,this.frameCountY=Math.floor(this.spriteImage.height/this.frameHeight)):(this.frameCountY=this.animationSettings.frameCountY||1,this.frameHeight=(this.spriteImage.height-i*(this.frameCountY-1))/this.frameCountY),this.padding=this.animationSettings.padding||0,this.animationSettings.origin?(this.origin.x=this.animationSettings.origin.x,this.origin.y=this.animationSettings.origin.y):this.animationSettings.originRelative&&this.setOriginRelative(this.animationSettings.originRelative),t.extend(this.animations,this.animationSettings.animations,!0),this.setAnimation("default"),this.updateEntity()):t.log("ERROR: something went wrong with loading the sprite.")},i.prototype.updateEntity=function(){this.entity&&(this.entity.dimension.x=-this.origin.x,this.entity.dimension.y=-this.origin.y,this.entity.dimension.width=this.frameWidth,this.entity.dimension.height=this.frameHeight)},i.prototype.attached=function(e){var t,n=this.animationSettings.animations,r=0,o=0,a=0;for(t in this.entity=e.entity,this.updateEntity(),n){for(r=0,o=n[t].frames.length;r<o;++r)n[t].frames[r]>a&&(a=n[t].frames[r]);!i.suppressWarnings&&a>this.frameCountX*this.frameCountY-1&&console.log("Warning: the frames in animation "+t+" of "+(this.entity.name||this.entity.settings.name)+" are out of bounds. Can't use frame "+a+".")}},i.prototype.setAnimation=function(e,n,r){var o=this.animations[e];i.suppressWarnings||o?o&&(this.currentAnimation!==o||null!==this.onCompleteCallback&&t.isDefined(n))&&(t.isDefined(o.loop)||(o.loop=!0),t.isDefined(o.backTo)||(o.backTo=0),this.onCompleteCallback=n,this.currentAnimation=o,this.currentAnimation.name=e,this.currentAnimationLength=this.currentAnimation.frames.length,r||(this.currentFrame=0),!i.suppressWarnings&&this.currentAnimation.backTo>this.currentAnimationLength&&(console.log("Warning: animation "+e+" has a faulty backTo parameter"),this.currentAnimation.backTo=this.currentAnimationLength)):console.log("Warning: animation "+e+" does not exist.")},i.prototype.setSpriteSheet=function(e,t){this.currentSpriteSheet!==e&&(this.setup({spriteSheet:e}),this.onCompleteCallback=t)},i.prototype.getAnimationName=function(){return this.currentAnimation.name},i.prototype.setFrame=function(e){this.currentFrame=e},i.prototype.getCurrentSpeed=function(){return this.currentAnimation.speed},i.prototype.setCurrentSpeed=function(e){this.currentAnimation.speed=e},i.prototype.getCurrentFrame=function(){return this.currentFrame},i.prototype.getFrameWidth=function(){return this.frameWidth},i.prototype.getFrameHeight=function(){return this.frameHeight},i.prototype.setOriginRelative=function(e){this.origin.x=e.x*this.frameWidth,this.origin.y=e.y*this.frameHeight},i.prototype.update=function(e){var t;if(this.currentAnimation&&!(this.currentAnimationLength<=1||0===this.currentAnimation.speed)){var n=this.currentAnimation.speed||1;if(this.currentAnimation.frameSpeeds&&this.currentAnimation.frameSpeeds.length>=this.currentFrame&&(n*=this.currentAnimation.frameSpeeds[Math.floor(this.currentFrame)]),t=!1,this.currentFrame+=n*e.speed,this.currentAnimation.loop)for(;this.currentFrame>=this.currentAnimation.frames.length;)this.currentFrame-=this.currentAnimation.frames.length-this.currentAnimation.backTo,t=!0;else this.currentFrame>=this.currentAnimation.frames.length&&(t=!0);t&&this.onCompleteCallback&&(this.onCompleteCallback(),this.currentAnimation.loop||(this.onCompleteCallback=null))}},i.prototype.updateFrame=function(){var e=Math.min(Math.floor(this.currentFrame),this.currentAnimation.frames.length-1),t=this.currentAnimation.frames[e];this.sourceX=t%this.frameCountX*(this.frameWidth+this.padding),this.sourceY=Math.floor(t/this.frameCountX)*(this.frameHeight+this.padding)},i.prototype.draw=function(e){e.entity,this.currentAnimation&&this.visible&&(this.updateFrame(),e.renderer.drawImage(this.spriteImage,this.sourceX,this.sourceY,this.frameWidth,this.frameHeight,0|-this.origin.x,0|-this.origin.y,this.frameWidth,this.frameHeight))},i.prototype.toString=function(){return"[object Sprite]"},i.suppressWarnings=!1,i}),bento.define("bento/entity",["bento","bento/utils","bento/math/vector2","bento/math/rectangle","bento/math/transformmatrix","bento/transform"],function(e,t,n,i,r,o){"use strict";var a=0,s=function(r){if(!(this instanceof s))return new s(r);var c,l;if(this.name="",this.position=new n(0,0),this.family=[],this.components=[],this.global=!1,this.float=!1,this.updateWhenPaused=0,this.isAdded=!1,this.dimension=new i(0,0,0,0),this.boundingBox=r.boundingBox||null,this.scale=new n(1,1),this.rotation=0,this.alpha=1,this.visible=!0,this.id=a++,this.z=0,this.rootIndex=-1,this.timer=0,this.ticker=0,this.transform=new o(this),this.parent=null,this.settings=r,this.currentComponent=null,r){if(r.position&&(this.position=r.position),r.dimension&&(this.dimension=r.dimension),r.scale&&(this.scale=r.scale),r.name&&(this.name=r.name),r.family)for(t.isArray(r.family)||(r.family=[r.family]),c=0,l=r.family.length;c<l;++c)this.family.push(r.family[c]);if(t.isDefined(r.alpha)&&(this.alpha=r.alpha),t.isDefined(r.rotation)&&(this.rotation=r.rotation),t.isDefined(r.visible)&&(this.visible=r.visible),this.z=r.z||0,this.updateWhenPaused=r.updateWhenPaused||0,this.global=r.global||!1,this.float=r.float||!1,r.components)for(t.isArray(r.components)||(r.components=[r.components]),c=0,l=r.components.length;c<l;++c)this.attach(r.components[c]);r.init&&r.init.apply(this),r.addNow&&e.objects.add(this)}};return s.prototype.isEntity=function(){return!0},s.prototype.extend=function(e){return t.extend(this,e)},s.prototype.getBoundingBox=function(){return e=this,t=this.boundingBox||this.dimension,n=t.clone(),i=e.position,r=e.scale,n.x*=Math.abs(r.x),n.y*=Math.abs(r.y),n.width*=Math.abs(r.x),n.height*=Math.abs(r.y),r.x<0&&(n.x=-n.x-n.width),r.y<0&&(n.y=-n.y-n.height),n.x+=i.x,n.y+=i.y,n;var e,t,n,i,r},s.prototype.attach=function(n,i){var r=this,o=e.getGameData();if(n){if(n.name||console.warn("WARNING: component has no name",n),i||!n.isAdded&&!n.parent){if(o.entity=this,n.parent=this,n.rootIndex=this.components.length,this.components.push(n),n.attached&&n.attached(o),this.isAdded)n.start&&n.start(o);else for(r.parent&&(r=r.parent);r;){if(r.isAdded){n.start&&n.start(o);break}r=r.parent}return this}t.log("ERROR: Child "+n.name+" was already attached.")}else t.log("ERROR: trying to attach "+n)},s.prototype.remove=function(t){var n,i=this,r=e.getGameData();if(t){if(n=this.components.indexOf(t),this.components[n]=null,n>=0){if(this.isAdded)t.destroy&&t.destroy(r);else for(i.parent&&(i=i.parent);i;){if(i.isAdded){t.destroy&&t.destroy(r);break}i=i.parent}t.removed&&t.removed(r),t.parent=null,t.rootIndex=-1}return this}},s.prototype.removeByName=function(e){var t=this;return t.getComponent(e,function(e){t.remove(e)}),this},s.prototype.removeSelf=function(t){return this.parent?this.parent.remove(this):this.isAdded&&e.objects.remove(this),this},s.prototype.getComponent=function(e,t,n){var i,r,o;for(i=0,r=this.components.length;i<r;++i)if((o=this.components[i])&&o.name===e)return t&&t.apply(o,[o,i]),o;return n&&n(),null},s.prototype.moveComponentTo=function(e,t){var n;e&&(n=this.components.indexOf(e))>=0&&(this.components.splice(n,1),this.components.splice(t,0,e))},s.prototype.addToFamily=function(t){-1===this.family.indexOf(t)&&(this.family.push(t),e.objects.addObjectToFamily(this,t))},s.prototype.removeFromFamily=function(t){var n=this.family.indexOf(t);-1!==n&&(this.family.splice(n,1),e.objects.removeObjectFromFamily(this,t))},s.prototype.isFamily=function(e){return-1!==this.family.indexOf(e)},s.prototype.collidesWith=function(i,r,o){var a,s,c,l,u,h,d=[],p=new n(0,0),f=!0,m=null;if(i.isEntity)d=[i],p=r||p,h=o;else if(t.isArray(i))d=i,p=r||p,h=o;else if(p=i.offset||p,t.isDefined(i.firstOnly)&&(f=i.firstOnly),h=i.onCollide,i.entity){if(!i.entity.isEntity)return t.log("WARNING: settings.entity is not an entity"),null;d=[i.entity]}else if(i.entities){if(!t.isArray(i.entities))return t.log("WARNING: settings.entities is not an array"),null;d=i.entities}else i.name?d=e.objects.getByName(i.name):i.family?d=e.objects.getByFamily(i.family):i.rectangle&&(d=[i.rectangle]);if(!d.length)return null;for(a=this.getBoundingBox().offset(p),c=0,l=d.length;c<l;++c){if((u=d[c]).isEntity){if(u.id===this.id)continue;s=u.getBoundingBox()}else u.isRectangle&&(s=u);if(a.intersect(s)){if(h&&h(u),f)return u;(m=m||[]).push(u)}}return m},s.prototype.collidesWithGroup=function(e,i,r){var o,a,s,c,l,u,h;if(t.isArray(e)||t.isDefined(i)||t.isDefined(r)?(l=e,u=i||new n(0,0),h=r):(l=e.other,u=e.offset,h=e.onCollide),t.isArray(l)){if(!l.length)return null;for(c=this.getBoundingBox().offset(u),o=0,a=l.length;o<a;++o)if((!(s=l[o]).id||s.id!==this.id)&&s.getBoundingBox&&c.intersect(s.getBoundingBox()))return h&&h(s),s;return null}t.log("ERROR: Collision check must be with an Array of object")},s.prototype.getWorldPosition=function(){return this.transform.getWorldPosition()},s.prototype.toWorldPosition=function(e){return this.transform.toWorldPosition(e)},s.prototype.toLocalPosition=function(e){return this.transform.toLocalPosition(e)},s.prototype.toComparablePosition=function(e){return this.transform.toComparablePosition(e)},s.prototype.start=function(t){var n,i,r;for(t=t||e.getGameData(),n=0,i=this.components.length;n<i;++n)(r=this.components[n])&&r.start&&(t.entity=this,r.start(t))},s.prototype.destroy=function(t){var n,i,r,o=this.components;for(t=t||e.getGameData(),n=0,i=o.length;n<i;++n)(r=o[n])&&r.destroy&&(t.entity=this,r.destroy(t))},s.prototype.update=function(t){var n,i,r,o=this.components;for(t=t||e.getGameData(),n=0,i=o.length;n<i;++n)(r=o[n])&&r.update&&(this.currentComponent=r,t.entity=this,r.rootIndex=n,r.update(t));this.timer+=t.speed,this.ticker+=1,function(e){var t;for(t=e.components.length-1;t>=0;--t)e.components[t]||e.components.splice(t,1)}(this),this.currentComponent=null},s.prototype.draw=function(t){var n,i,r,o=this.components;if(this.visible&&this.transform.visible){for(t=t||e.getGameData(),this.transform.draw(t),n=0,i=o.length;n<i;++n)(r=o[n])&&r.draw&&(this.currentComponent=r,t.entity=this,r.draw(t));for(n=o.length-1;n>=0;n--)(r=o[n])&&r.postDraw&&(t.entity=this,r.postDraw(t));this.transform.postDraw(t),this.currentComponent=null}},s.prototype.attached=function(t){var n,i,r;for((t=t||e.getGameData()).entity=this,t.parent=this.parent,n=0,i=this.components.length;n<i;++n)(r=this.components[n])&&r.onParentAttached&&(t.entity=this,r.onParentAttached(t))},s.prototype.removed=function(t){var n,i,r;for((t=t||e.getGameData()).entity=this,t.parent=this.parent,n=0,i=this.components.length;n<i;++n)(r=this.components[n])&&r.onParentRemoved&&(t.entity=this,r.onParentRemoved(t))},s.prototype.collided=function(e){var t,n,i;if(!e)throw"Must pass a data object";for(e.entity=this,e.parent=this.parent,t=0,n=this.components.length;t<n;++t)(i=this.components[t])&&i.onParentCollided&&(e.entity=this,i.onParentCollided(e));this.onCollide&&this.onCollide(e.other)},s.prototype.toString=function(){return"[object Entity]"},s}),bento.define("bento/eventsystem",["bento/utils"],function(e){var t={},n={},i={};window.addEventListener("error",function(e){t={}});var r=function(r,o,a){e.isUndefined(n[r])&&(n[r]=[],t[r]=!1,i[r]=[]),n[r].push({callback:o,context:a})},o=function(e,r,o){var a,s,c;if(s=n[e],c=i[e],s&&c)if(t[e])c.push({callback:r,context:o});else for(a=s.length-1;a>=0;--a)if(s[a].callback===r){if(!o){n[e].splice(a,1);break}if(s[a].context===o){n[e].splice(a,1);break}}},a=!1,s={SortedEventSystem:null,stopPropagation:function(){a=!0;var e=s.SortedEventSystem;e&&e.stopPropagation()},fire:function(r,o){var c,l,u,h,d=s.SortedEventSystem;if(d&&d.fire(r,o),a=!1,function(e){var t,r,o,a,s,c=i[e],l=n[e];if(l&&c){for(r=0,o=c.length;r<o;++r){if(c[r].reset){n[e]=[];break}for(a=c[r].callback,s=c[r].context,t=l.length-1;t>=0;--t)if(l[t].callback===a){if(!s){n[e].splice(t,1);break}if(l[t].context===s){n[e].splice(t,1);break}}}i[e]=[]}}(r),e.isString(r)||(r=r.toString()),!e.isUndefined(n[r]))if(u=n[r],t[r])e.log('ERROR: Already looping over event "'+r+'"');else{for(t[r]=!0,c=0,l=u.length;c<l;++c)if((h=u[c])&&(h.context?h.callback.apply(h.context,[o]):h.callback(o)),a){a=!1;break}t[r]=!1}},addEventListener:r,removeEventListener:o,on:r,off:o,clear:function(e){var r=n[e],o=i[e];r&&o&&(t[e]?o.push({reset:!0}):n[e]=[])}};return s}),bento.define("audia",["bento/utils"],function(e){var t=null;"function"==typeof AudioContext?t=new AudioContext:window.webkitAudioContext&&(t=new webkitAudioContext);var n=Boolean(t),i=0,r={},o=function(e){var t=++i;return r[t]=e,t},a=function(e,t,n){return Math.min(Math.max(Number(e),t),n)},s=function(){var e={},n=function(n,i){var r=function(e){e.duration!==n._duration&&(n._duration=e.duration,n.dispatchEvent("durationchange")),n.dispatchEvent("canplay"),n.dispatchEvent("canplaythrough"),n.dispatchEvent("load"),n._autoplay&&n.play(),n._onload&&n.onload()};if(i in e)r(e[i]);else{var o=new XMLHttpRequest;o.open("GET",i,!0),o.responseType="arraybuffer",o.onload=function(){t.decodeAudioData(o.response,function(t){e[i]=t,r(t)})},o.send()}},i=function(n){n.bufferSource=t.createBufferSource(),n.bufferSource.buffer=e[n.src],n.bufferSource.connect(n.gainNode),n.bufferSource.loop=n._loop,n.bufferSource.onended=n._onended},r=t.createGain();r.gain.value=1,r.connect(t.destination);var s=function(e){this.id=o(this),this._listenerId=0,this._listeners={},this._autoplay=!1,this._buffered=[],this._currentSrc="",this._currentTime=0,this._defaultPlaybackRate=1,this._duration=NaN,this._loop=!1,this._muted=!1,this._paused=!0,this._playbackRate=1,this._played=[],this._preload="auto",this._seekable=[],this._seeking=!1,this._src="",this._volume=1,this._onended=null,this._onload=null,this.gainNode=t.createGain(),this.gainNode.gain.value=this._volume,this.gainNode.connect(r),void 0!==e&&(this.src=e)};return s.prototype.load=function(){this._src&&n(this,this._src)},s.prototype.play=function(){this._paused=!1,i(this),this.bufferSource.start?this.bufferSource.start(0):this.bufferSource.noteOn(0)},s.prototype.pause=function(){this._paused||(this._paused=!0,this.bufferSource.stop?this.bufferSource.stop(0):this.bufferSource.noteOff(0))},s.prototype.stop=function(){this._paused||(this.pause(),this.currentTime=0)},s.prototype.addEventListener=function(e,t){this._listeners[++this._listenerKey]={eventName:e,callback:t}},s.prototype.dispatchEvent=function(e,t){for(var n in this._listeners){var i=this._listeners[n];i.eventName==e&&i.callback&&i.callback.apply(i.callback,t)}},s.prototype.removeEventListener=function(e,t){var n=null;for(var i in this._listeners){var r=this._listeners[i];if(r.eventName===e&&r.callback===t){n=i;break}}null!==n&&delete this._listeners[n]},Object.defineProperty(s.prototype,"autoplay",{get:function(){return this._autoplay},set:function(e){this._autoplay=e}}),Object.defineProperty(s.prototype,"buffered",{get:function(){return this._buffered}}),Object.defineProperty(s.prototype,"currentSrc",{get:function(){return this._currentSrc}}),Object.defineProperty(s.prototype,"currentTime",{get:function(){return this._currentTime},set:function(e){this._currentTime=e}}),Object.defineProperty(s.prototype,"defaultPlaybackRate",{get:function(){return Number(this._defaultPlaybackRate)},set:function(e){this._defaultPlaybackRate=e}}),Object.defineProperty(s.prototype,"duration",{get:function(){return this._duration}}),Object.defineProperty(s.prototype,"loop",{get:function(){return this._loop},set:function(e){this._loop!==e&&(this._loop=e,this.bufferSource&&(this._paused?(i(this),this.bufferSource.loop=e):(this.pause(),i(this),this.bufferSource.loop=e,this.play())))}}),Object.defineProperty(s.prototype,"muted",{get:function(){return this._muted},set:function(e){this._muted=e,this.gainNode.gain.value=e?0:this._volume}}),Object.defineProperty(s.prototype,"paused",{get:function(){return this._paused}}),Object.defineProperty(s.prototype,"playbackRate",{get:function(){return this._playbackRate},set:function(e){this._playbackRate=e}}),Object.defineProperty(s.prototype,"played",{get:function(){return this._played}}),Object.defineProperty(s.prototype,"preload",{get:function(){return this._preload},set:function(e){this._preload=e}}),Object.defineProperty(s.prototype,"seekable",{get:function(){return this._seekable}}),Object.defineProperty(s.prototype,"seeking",{get:function(){return this._seeking}}),Object.defineProperty(s.prototype,"src",{get:function(){return this._src},set:function(e){this._src=e,n(this,e)}}),Object.defineProperty(s.prototype,"volume",{get:function(){return this._volume},set:function(e){s.preventErrors||a(e,0,1),e<0&&(e=0),this._volume=e,this._muted||(this.gainNode.gain.value=e,this.dispatchEvent("volumechange"))}}),Object.defineProperty(s.prototype,"onended",{get:function(){return this._onended},set:function(e){this._onended=e}}),Object.defineProperty(s.prototype,"onload",{get:function(){return this._onload},set:function(e){this._onload=e}}),l(s),s},c=function(){var e=function(e){this.id=o(this),this._audioNode=new Audio,void 0!==e&&(this.src=e)};return e.prototype.load=function(e){this._audioNode.load()},e.prototype.play=function(e){void 0!==e&&(this._audioNode.currentTime=e),this._audioNode.play()},e.prototype.pause=function(){this._audioNode.pause()},e.prototype.stop=function(){this._audioNode.pause(),this._audioNode.currentTime=0},e.prototype.addEventListener=function(e,t,n){this._audioNode.addEventListener(e,t,n)},e.prototype.removeEventListener=function(e,t,n){this._audioNode.removeEventListener(e,t,n)},Object.defineProperty(e.prototype,"autoplay",{get:function(){return this._audioNode.autoplay},set:function(e){this._audioNode.autoplay=e}}),Object.defineProperty(e.prototype,"buffered",{get:function(){return this._audioNode.buffered}}),Object.defineProperty(e.prototype,"currentSrc",{get:function(){return this._audioNode.src}}),Object.defineProperty(e.prototype,"currentTime",{get:function(){return this._audioNode.currentTime},set:function(e){this._audioNode.currentTime=e}}),Object.defineProperty(e.prototype,"defaultPlaybackRate",{get:function(){return this._audioNode.defaultPlaybackRate},set:function(e){this._audioNode.defaultPlaybackRate=e}}),Object.defineProperty(e.prototype,"duration",{get:function(){return this._audioNode.duration}}),Object.defineProperty(e.prototype,"loop",{get:function(){return this._audioNode.loop},set:function(e){this._audioNode.currentTime>=this._audioNode.duration&&(this._audioNode.currentTime=0),this._audioNode.loop=e}}),Object.defineProperty(e.prototype,"muted",{get:function(){return this._audioNode.muted},set:function(e){this._audioNode.muted=e}}),Object.defineProperty(e.prototype,"paused",{get:function(){return this._audioNode.paused}}),Object.defineProperty(e.prototype,"playbackRate",{get:function(){return this._audioNode.playbackRate},set:function(e){this._audioNode.playbackRate=e}}),Object.defineProperty(e.prototype,"played",{get:function(){return this._audioNode.played}}),Object.defineProperty(e.prototype,"preload",{get:function(){return this._audioNode.preload},set:function(e){this._audioNode.preload=e}}),Object.defineProperty(e.prototype,"seekable",{get:function(){return this._audioNode.seekable}}),Object.defineProperty(e.prototype,"seeking",{get:function(){return this._audioNode.seeking}}),Object.defineProperty(e.prototype,"src",{get:function(){return this._audioNode.src},set:function(e){var t=this,n=function(){t.onload&&t.onload(),t._audioNode.removeEventListener("canplaythrough",n,!1)};this._audioNode.src=e,this._audioNode.preload="auto",this._audioNode.addEventListener("canplaythrough",n,!1),this._audioNode.addEventListener("error",function(e){console.log("audio load error",t._audioNode.error)},!1),this._audioNode.load()}}),Object.defineProperty(e.prototype,"volume",{get:function(){return this._audioNode.volume},set:function(t){e.preventErrors&&(t=a(t,0,1)),this._audioNode.volume=t}}),Object.defineProperty(e.prototype,"onended",{get:function(){return this._audioNode.onended},set:function(e){this._audioNode.onended=e}}),Object.defineProperty(e.prototype,"onload",{get:function(){return this._audioNode.onload},set:function(e){this._audioNode.onload=e}}),l(e),e},l=function(i){var r;i.preventErrors=!0,Object.defineProperty(i,"hasWebAudio",{get:function(){return n}}),Object.defineProperty(i,"audioContext",{
get:function(){return t}}),Object.defineProperty(i,"gainNode",{get:function(){return gainNode}}),Object.defineProperty(i,"version",{get:function(){return"0.3.0"}}),i.canPlayType=function(t){return n&&e.isApple()?!(t.indexOf("ogg")>=0||(t.indexOf("mp3"),0)):(void 0===r&&(r=new Audio),t=(null===t.match("/")?"audio/":"")+t,r.canPlayType(t))},i.prototype.canPlayType=function(e){return i.canPlayType(e)};for(var o=["abort","canplay","canplaythrough","durationchange","emptied","error","loadeddata","loadedmetadata","loadstart","pause","play","playing","progress","ratechange","seeked","seeking","stalled","suspend","timeupdate","volumechange"],a=0,l=o.length;a<l;++a)!function(e){var t="_on"+e;i.prototype[t]=null,Object.defineProperty(i.prototype,"on"+e,{get:function(){return this[t]},set:function(n){this[t]&&this.removeEventListener(e,this[t],!1),"function"==typeof n?(this[t]=n,this.addEventListener(e,n,!1)):this[t]=null}})}(o[a]);i.getWebAudia=s,i.getHtmlAudia=c};return n?s():c()}),bento.define("bento/lib/domready",[],function(){"use strict";function e(){var e=l;s&&e.length&&(l=[],function(e){var t;for(t=0;t<e.length;t+=1)e[t](c)}(e))}function t(){s||(s=!0,o&&clearInterval(o),e())}function n(e){return s?e(c):l.push(e),n}var i,r,o,a="undefined"!=typeof window&&window.document,s=!a,c=a?document:null,l=[];if(a){if(document.addEventListener)document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1);else if(window.attachEvent){window.attachEvent("onload",t),r=document.createElement("div");try{i=null===window.frameElement}catch(i){}r.doScroll&&i&&window.external&&(o=setInterval(function(){try{r.doScroll(),t()}catch(e){}},30))}"complete"===document.readyState&&t()}return n.version="2.0.1",n.load=function(e,t,i,r){r.isBuild?i(null):n(i)},n}),bento.define("lzstring",[],function(){function e(e,t){if(!r[e]){r[e]={};for(var n=0,i=e.length;n<i;n++)r[e][e.charAt(n)]=n}return r[e][t]}var t=String.fromCharCode,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",r={},o={compressToBase64:function(e){if(null==e)return"";var t=o._compress(e,6,function(e){return n.charAt(e)});switch(t.length%4){default:case 0:return t;case 1:return t+"===";case 2:return t+"==";case 3:return t+"="}},decompressFromBase64:function(t){return null==t?"":""==t?null:o._decompress(t.length,32,function(i){return e(n,t.charAt(i))})},compressToUTF16:function(e){return null==e?"":o._compress(e,15,function(e){return t(e+32)})+" "},decompressFromUTF16:function(e){return null==e?"":""==e?null:o._decompress(e.length,16384,function(t){return e.charCodeAt(t)-32})},compressToUint8Array:function(e){for(var t=o.compress(e),n=new Uint8Array(2*t.length),i=0,r=t.length;i<r;i++){var a=t.charCodeAt(i);n[2*i]=a>>>8,n[2*i+1]=a%256}return n},decompressFromUint8Array:function(e){if(null==e)return o.decompress(e);for(var n=new Array(e.length/2),i=0,r=n.length;i<r;i++)n[i]=256*e[2*i]+e[2*i+1];var a=[];return n.forEach(function(e){a.push(t(e))}),o.decompress(a.join(""))},compressToEncodedURIComponent:function(e){return null==e?"":o._compress(e,6,function(e){return i.charAt(e)})},decompressFromEncodedURIComponent:function(t){return null==t?"":""==t?null:(t=t.replace(/ /g,"+"),o._decompress(t.length,32,function(n){return e(i,t.charAt(n))}))},compress:function(e){return o._compress(e,16,function(e){return t(e)})},_compress:function(e,t,n){if(null==e)return"";var i,r,o,a,s={},c={},l="",u="",h="",d=2,p=3,f=2,m=[],g=0,v=0;for(o=0,a=e.length;o<a;o+=1)if(l=e.charAt(o),Object.prototype.hasOwnProperty.call(s,l)||(s[l]=p++,c[l]=!0),u=h+l,Object.prototype.hasOwnProperty.call(s,u))h=u;else{if(Object.prototype.hasOwnProperty.call(c,h)){if(h.charCodeAt(0)<256){for(i=0;i<f;i++)g<<=1,v==t-1?(v=0,m.push(n(g)),g=0):v++;for(r=h.charCodeAt(0),i=0;i<8;i++)g=g<<1|1&r,v==t-1?(v=0,m.push(n(g)),g=0):v++,r>>=1}else{for(r=1,i=0;i<f;i++)g=g<<1|r,v==t-1?(v=0,m.push(n(g)),g=0):v++,r=0;for(r=h.charCodeAt(0),i=0;i<16;i++)g=g<<1|1&r,v==t-1?(v=0,m.push(n(g)),g=0):v++,r>>=1}0==--d&&(d=Math.pow(2,f),f++),delete c[h]}else for(r=s[h],i=0;i<f;i++)g=g<<1|1&r,v==t-1?(v=0,m.push(n(g)),g=0):v++,r>>=1;0==--d&&(d=Math.pow(2,f),f++),s[u]=p++,h=String(l)}if(""!==h){if(Object.prototype.hasOwnProperty.call(c,h)){if(h.charCodeAt(0)<256){for(i=0;i<f;i++)g<<=1,v==t-1?(v=0,m.push(n(g)),g=0):v++;for(r=h.charCodeAt(0),i=0;i<8;i++)g=g<<1|1&r,v==t-1?(v=0,m.push(n(g)),g=0):v++,r>>=1}else{for(r=1,i=0;i<f;i++)g=g<<1|r,v==t-1?(v=0,m.push(n(g)),g=0):v++,r=0;for(r=h.charCodeAt(0),i=0;i<16;i++)g=g<<1|1&r,v==t-1?(v=0,m.push(n(g)),g=0):v++,r>>=1}0==--d&&(d=Math.pow(2,f),f++),delete c[h]}else for(r=s[h],i=0;i<f;i++)g=g<<1|1&r,v==t-1?(v=0,m.push(n(g)),g=0):v++,r>>=1;0==--d&&(d=Math.pow(2,f),f++)}for(r=2,i=0;i<f;i++)g=g<<1|1&r,v==t-1?(v=0,m.push(n(g)),g=0):v++,r>>=1;for(;;){if(g<<=1,v==t-1){m.push(n(g));break}v++}return m.join("")},decompress:function(e){return null==e?"":""==e?null:o._decompress(e.length,32768,function(t){return e.charCodeAt(t)})},_decompress:function(e,n,i){var r,o,a,s,c,l,u,h=[],d=4,p=4,f=3,m="",g=[],v={val:i(0),position:n,index:1};for(r=0;r<3;r+=1)h[r]=r;for(a=0,c=Math.pow(2,2),l=1;l!=c;)s=v.val&v.position,v.position>>=1,0==v.position&&(v.position=n,v.val=i(v.index++)),a|=(s>0?1:0)*l,l<<=1;switch(a){case 0:for(a=0,c=Math.pow(2,8),l=1;l!=c;)s=v.val&v.position,v.position>>=1,0==v.position&&(v.position=n,v.val=i(v.index++)),a|=(s>0?1:0)*l,l<<=1;u=t(a);break;case 1:for(a=0,c=Math.pow(2,16),l=1;l!=c;)s=v.val&v.position,v.position>>=1,0==v.position&&(v.position=n,v.val=i(v.index++)),a|=(s>0?1:0)*l,l<<=1;u=t(a);break;case 2:return""}for(h[3]=u,o=u,g.push(u);;){if(v.index>e)return"";for(a=0,c=Math.pow(2,f),l=1;l!=c;)s=v.val&v.position,v.position>>=1,0==v.position&&(v.position=n,v.val=i(v.index++)),a|=(s>0?1:0)*l,l<<=1;switch(u=a){case 0:for(a=0,c=Math.pow(2,8),l=1;l!=c;)s=v.val&v.position,v.position>>=1,0==v.position&&(v.position=n,v.val=i(v.index++)),a|=(s>0?1:0)*l,l<<=1;h[p++]=t(a),u=p-1,d--;break;case 1:for(a=0,c=Math.pow(2,16),l=1;l!=c;)s=v.val&v.position,v.position>>=1,0==v.position&&(v.position=n,v.val=i(v.index++)),a|=(s>0?1:0)*l,l<<=1;h[p++]=t(a),u=p-1,d--;break;case 2:return g.join("")}if(0==d&&(d=Math.pow(2,f),f++),h[u])m=h[u];else{if(u!==p)return null;m=o+o.charAt(0)}g.push(m),h[p++]=o+m.charAt(0),o=m,0==--d&&(d=Math.pow(2,f),f++)}}};return o}),bento.define("bento/lib/requestanimationframe",[],function(){"use strict";for(var e=0,t=["ms","moz","webkit","o"],n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];return window.requestAnimationFrame||(window.requestAnimationFrame=function(t,n){var i=(new Date).getTime(),r=Math.max(0,16-(i-e)),o=window.setTimeout(function(){t(i+r)},r);return e=i+r,o}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)}),window.requestAnimationFrame}),bento.define("bento/managers/asset",["bento/eventsystem","bento/packedimage","bento/utils","audia","lzstring"],function(e,t,n,i,r){"use strict";return function(o){var a,s,c=o.useQueries,l=o.autoDisposeTextures,u=(Date.now(),{}),h={},d="",p={audio:{},json:{},images:{},binary:{},fonts:{},spritesheets:{},texturePacker:{},spine:{},"packed-images":{},"packed-spritesheets":{},"packed-json":{}},f=function(e,t,r){var o,a,s,l=!0,u=function(t,n){var o=new i,a=o.canPlayType("audio/"+n.slice(-3));return 0===n.indexOf("data:")&&(a=!0),a||window.ejecta?(C.skipAudioCallback?window.setTimeout(function(){r(null,e,o)},0):o.onload=function(){r(null,e,o)},0===n.indexOf("http")&&(o.crossOrigin="Anonymous"),o.src=n+(c&&n.indexOf("data:"),""),l=!1,!0):(a||(s=n),!1)};for(n.isArray(t)||(t=[t]),o=0,a=t.length;o<a&&!u(0,t[o]);++o);l&&r("This audio type is not supported:"+e+s)},m=function(e,t,n,i){var o,a=function(o){var a;try{"L"===o[0]&&"Z"===o[1]&&"S"===o[2]&&(i=!0,o=o.substring(3)),a=i?JSON.parse(r.decompressFromBase64(o)):JSON.parse(o)}catch(n){console.log("WARNING: Could not parse JSON "+e+" at "+t+": "+n),console.log("Trying to parse",o),a=o}n(null,e,a)};0!==t.indexOf("data:application/json;base64,")?0!==t.indexOf("LZS")?((o=new window.XMLHttpRequest).overrideMimeType&&o.overrideMimeType("application/json"),o.open("GET",t+"",!0),o.onerror=function(){n("Error: loading JSON "+t)},o.ontimeout=function(){n("Timeout: loading JSON "+t)},o.onreadystatechange=function(){var e;4===o.readyState&&(304===o.status||200===o.status||0===o.status&&o.responseText?(e=o.responseText,a(e)):n("Error: State "+o.readyState+" "+t))},o.send(null)):a(t):window.decodeB64?a(window.decodeB64(t.replace("data:application/json;base64,",""))):a(window.atob(t.replace("data:application/json;base64,","")))},g=function(e,t,i){var r=new Image;r._dispose=r.dispose,r.dispose=function(){r._dispose&&r._dispose(),r.texture&&r.texture.destroy&&r.texture.destroy()},r.addEventListener("load",function(){i(null,e,r)},!1),r.addEventListener("error",function(e){n.log("ERROR: loading image "+t)},!1),0===t.indexOf("http")&&(r.crossOrigin="Anonymous"),r.src=t+(c&&t.indexOf("data:"),"")},v=function(e,t,n){var i,r,o,a=e,s=document.createElement("canvas").getContext("2d"),c=0,l=function(){return s.measureText("abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890.,").width};e.indexOf("/")>=0&&(a=e.split("/"),e=a[a.length-1]),(o=document.createElement("style")).setAttribute("type","text/css"),o.innerHTML="@font-face { font-family: '"+e+"'; src: url('"+t+"');}",document.body.appendChild(o),s.font="normal 16px "+e,i=l(),r=window.setInterval(function(){i!==l()?(window.clearInterval(r),n&&n(null,e,e)):c>=10&&(window.clearInterval(r),console.log('Warning: font "'+e+'" timed out with loading.'),n&&n(null,e,e)),c+=1},100)},y=function(e,n,i){var r,o,a={image:null,animation:null},s=function(){null!==a.image&&null!==a.animation&&i(null,e,a)};n.json?(r=n.json,o=n.png):(r=n+".json",o=n+".png"),m(e,r,function(e,t,n){e?i(e,t,null):(a.animation=n,s())}),g(e,o,function(e,n,r){e?i(e,n,null):(a.image=t(r),s())})},b=function(e,t,n){var i,r,o={image:null,data:null},a=function(){null!==o.image&&null!==o.data&&n(null,e,o)};t.json?(i=t.json,r=t.png):(i=t+".json",r=t+".png"),m(e,i,function(e,t,i){e?n(e,t,null):(o.data=i,a())}),g(e,r,function(e,t,i){e?n(e,t,null):(o.image=i,a())})},w=function(e,t,n){var i,r,o={image:null,data:null},a=function(){null!==o.image&&null!==o.data&&n(null,e,o)};t.json?(i=t.json,r=t.png):(i=t+".json",r=t+".png"),m(e,i,function(e,t,i){e?n(e,t,null):(o.data=i,a())}),g(e,r,function(e,t,i){e?n(e,t,null):(o.image=i,a())})},x=function(e,t,i){var r,o={skeleton:null,atlas:null,images:[],imageCount:0,skinImages:{},path:((r=t.split("/")).splice(-1,1),r.join("/")+"/"),pathJson:t+".json",pathAtlas:t+".atlas",dispose:function(){var e,t;for(e=0,t=o.images.length;e<t;++e)a.remove(o.images[e].path);a.remove(o.pathJson),a.remove(o.pathAtlas)}},c=function(){o.imageCount===o.images.length&&null!==o.skeleton&&null!==o.atlas&&i(null,e,o)},l=function(t,n){var r,l,d=new window.spine.TextureAtlas(n,function(e){return s||(s=new Image),new window.spine.FakeTexture(s)}),p=d.pages;if(o.imageCount=p.length,C.lazyLoadSpine)o.imageCount=0,h(d);else for(r=0,l=p.length;r<l;++r)a.loadTexture(o.path+p[r].name,u,function(t,n){i(n,e,null)});o.atlas=n,c()},u=function(e,t){o.images.push({img:t,path:e}),c()},h=function(e){var t=JSON.parse(o.skeleton).skins;n.forEach(t,function(t,i){n.forEach(t,function(t,r,a,s){n.forEach(t,function(t,n){var r,a=t.name;(r=a?function(t){var n,i,r,o=e.regions;for(n=0,i=o.length;n<i;++n)if((r=o[n]).name===t)return r.page.name;return""}(a):e.pages[0].name)&&(s(),o.skinImages[r]=i)})})})};if(!window.spine)return console.error("ERROR: spine library not found!"),void i("Loading spine failed.");a||(a=new window.spine.canvas.AssetManager),a.loadText(o.pathJson,function(n,r){o.skeleton=r,c(),a.loadText(t.replace("-pro","").replace("-ess","")+".atlas",function(e,t){var n=JSON.parse(r).skeleton.images||"";for(n=n.replace("./","");n&&t.indexOf(n)>=0;)t=t.replace(n,"");l(e,t)},function(t,n){i(n,e,null)})},function(t,n){i(n,e,null)})},E=function(e,t,i){var r,o=n.getKeyLength(e),a=0,s=function(e,r,s){e?n.log(e):(u[r]=s,a+=1,n.isDefined(i)&&i(a,o,r,"json"),o===a&&n.isDefined(t)&&t(null,"assetGroup"))};for(r in e)e.hasOwnProperty(r)&&m(r,e[r],s)},S=function(e,i,r){var o,a=u[e],s=0,c=0,l=[],E={"packed-images":{},"packed-spritesheets":{},"packed-json":{}},S=[],M=function(){var r,o;(0===c||c>0&&s===c)&&(function(){for(var e,n,i,r,o,a,s;S.length;){if(n=S.pop(),o=_(n),a=T(n),!o||!a)return void S.push(n);for(i=0,r=a.frames.length;i<r;++i)s=(s=a.frames[i].filename).substring(0,s.length-4),e=a.frames[i].frame,p.texturePacker[s]=new t(o,e)}}(),r=E["packed-images"],n.forEach(r,function(e,i){var r=e.image,o=e.data;n.forEach(o,function(e,n){var i=e.assetName,o={x:e.x,y:e.y,w:e.width,h:e.height};p.texturePacker[i]=new t(r,o)})}),o=E["packed-json"],n.forEach(o,function(e){n.forEach(e,function(e,t,n,i){p.json[t]=e})}),function(){var e=E["packed-spritesheets"];n.forEach(e,function(e,i){var r=e.image,o=e.data;n.forEach(o,function(e,n){var i=e.assetName,o={x:e.x,y:e.y,w:e.width,h:e.height},a={image:new t(r,o),animation:e.spriteSheet};p.spritesheets[i]=a})})}(),h[e]=!0,n.isDefined(i)&&i(null,e))},C=function(e,t,i){e?n.log(e):(p.images[t]=i,s+=1,n.isDefined(r)&&r(s,c,t,"image"),M())},A=function(e,t,i){e?n.log(e):(p.json[t]=i,S.push(t),s+=1,n.isDefined(r)&&r(s,c,t,"pack"),M())},R=function(e,t,i){e?n.log(e):(p.json[t]=i,s+=1,n.isDefined(r)&&r(s,c,t,"json"),M())},P=function(e,t,i){e?n.log(e):(p.fonts[t]=i,s+=1,n.isDefined(r)&&r(s,c,t,"ttf"),M())},I=function(e,t,i){e?n.log(e):p.audio[t]=i,s+=1,n.isDefined(r)&&r(s,c,t,"audio"),M()},L=function(e,t,i){e?n.log(e):p.spritesheets[t]=i,s+=1,n.isDefined(r)&&r(s,c,t,"spriteSheet"),M()},D=function(e,t,i){e?n.log(e):p.spine[t]=i,s+=1,n.isDefined(r)&&r(s,c,t,"spine"),M()},O=function(e,t,i){e?n.log(e):(p["packed-images"][t]=i,E["packed-images"][t]=i,s+=1,n.isDefined(r)&&r(s,c,t,"imagePack"),M())},k=function(e,t,i){e?console.log(e):(p["packed-json"][t]=i,E["packed-json"][t]=i,s+=1,n.isDefined(r)&&r(s,c,t,"jsonPack"),M())},F=function(e,t,i){e?n.log(e):(p["packed-spritesheets"][t]=i,E["packed-spritesheets"][t]=i,s+=1,n.isDefined(r)&&r(s,c,t,"spriteSheetPack"),M())},B=function(e,t,n,i){l.push({fn:e,asset:t,path:n,callback:i})};if(n.isDefined(a)){if(n.isDefined(a.path)&&(d=a.path),n.isDefined(a.images))for(o in c+=n.getKeyLength(a.images),a.images)a.images.hasOwnProperty(o)&&B(g,o,"base64"===d?a.images[o]:d+"images/"+a.images[o],C);if(n.isDefined(a.texturePacker))for(o in c+=n.getKeyLength(a.texturePacker),a.texturePacker)a.texturePacker.hasOwnProperty(o)&&B(m,o,"base64"===d?a.texturePacker[o]:d+"json/"+a.texturePacker[o],A);if(n.isDefined(a.audio)&&(c+=n.getKeyLength(a.audio),n.forEach(a.audio,function(e,t,i,r){var o=[];n.isArray(e)||(e=[e]),n.forEach(e,function(e){o.push("base64"===d?e:d+"audio/"+e)}),B(f,t,o,I)})),n.isDefined(a.json))for(o in c+=n.getKeyLength(a.json),a.json)a.json.hasOwnProperty(o)&&B(m,o,"base64"===d?a.json[o]:d+"json/"+a.json[o],R);if(n.isDefined(a.fonts))for(o in c+=n.getKeyLength(a.fonts),a.fonts)a.fonts.hasOwnProperty(o)&&B(v,o,"base64"===d?a.fonts[o]:d+"fonts/"+a.fonts[o],P);if(n.isDefined(a.spritesheets))for(o in c+=n.getKeyLength(a.spritesheets),a.spritesheets)a.spritesheets.hasOwnProperty(o)&&B(y,o,"base64"===d?a.spritesheets[o]:d+"spritesheets/"+a.spritesheets[o],L);if(n.isDefined(a.spine))for(o in c+=n.getKeyLength(a.spine),a.spine)a.spine.hasOwnProperty(o)&&B(x,o,d+"spine/"+a.spine[o],D);return n.isDefined(a["packed-images"])&&(c+=n.getKeyLength(a["packed-images"]),n.forEach(a["packed-images"],function(e,t){B(b,t,"base64"===d?e:d+"packed-images/"+e,O)})),n.isDefined(a["packed-json"])&&(c+=n.getKeyLength(a["packed-json"]),n.forEach(a["packed-json"],function(e,t){B(m,t,"base64"===d?e:d+"packed-json/"+e,k)})),n.isDefined(a["packed-spritesheets"])&&(c+=n.getKeyLength(a["packed-spritesheets"]),n.forEach(a["packed-spritesheets"],function(e,t){B(w,t,"base64"===d?e:d+"packed-spritesheets/"+e,F)})),function(){var e,t,n=0;for(n=0,e=l.length;n<e;++n)(t=l[n]).fn(t.asset,t.path,t.callback);0===l.length&&M()}(),c}i("Could not find asset group "+e)},_=function(e){var t=p.images[e];return n.isDefined(t)||n.log("ERROR: ImageElement "+e+" could not be found"),t},T=function(e){var t=p.json[e];return n.isDefined(t)||n.log("ERROR: JSON "+e+" could not be found"),t},M=function(e,t){var i=!1;if(t){if(!p[t]){if(!p[t+"s"])return console.error("Asset type "+t+" doesn't exist."),!1;console.log("WARNING: type should be "+t+"s, not "+t),t+="s"}if(p[t][e])return!0;if("images"===t)return M(e,"texturePacker")}else n.forEach(p,function(t,n,r,o){t[e]&&(i=!0,o())});return i},C={lazyLoadSpine:!1,skipAudioCallback:!1,reload:function(e){var t,n=0,i=[],r=function(){(n+=1)===i.length&&e&&e()};for(t in Date.now(),p.texturePacker={},u)u.hasOwnProperty(t)&&h[t]&&i.push(t);!function(){var e,t;for(e=0,t=i.length;e<t;++e)S(i[e],r,function(e,t,n){})}()},loadAllAssets:function(e){var t,i=e.exceptions||[],r=e.onReady||e.onComplete||function(e,t){},o=e.onLoaded||e.onLoad||function(e,t,n,i){},a=0,s=0,c=0,l=0,h=function(e){e?n.log(e):(c+=1)===a&&r&&r(null)},d=function(e,t,n,i){l+=1,o&&o(l,s,n,i)};for(t in u)u.hasOwnProperty(t)&&(i.indexOf(t)>=0||(a+=1));for(t in u)u.hasOwnProperty(t)&&(i.indexOf(t)>=0||(u[t],s+=S(t,h,d)));0===a&&r&&r()},loadAssetGroups:E,loadAssetsJson:function(e){m("assets.json","assets.json",function(t,i,r){var o=!1,a={};t?e(t):(n.forEach(r,function(e,t,i,r){n.isString(e)?(o=!0,a[t]=e):u[t]=e}),o?E(a,e):e(null,"assetsJson"))})},loadInlineAssetsJson:function(){window.assetsJson&&(n.isString(window.assetsJson)&&(window.assetsJson=JSON.parse(r.decompressFromBase64(window.assetsJson))),n.forEach(window.assetsJson,function(e,t){u[t]=e}))},load:S,loadJson:m,loadImageFromUrl:function(e,t,i){p.images[e]?i&&i(null,p.images[e]):g(e,t,function(e,t,r){if(e)return n.log(e),void(i&&i(e));p.images[t]=r,i&&i(null,r)})},loadJsonFromUrl:function(e,t,i){m(e,t,function(e,t,r){if(e)return n.log(e),void(i&&i(e));p.json[t]=r,i&&i(null,r)})},loadAudioFromUrl:function(e,t,i){f(e,t,function(e,t,r){if(e)return n.log(e),void(i&&i(e));p.audio[t]=r,i&&i(r)})},unload:function(e,t){var i=u[e];t=n.getDefault(t,!0),i?(n.forEach(i,function(e,i){"object"==typeof e&&n.forEach(e,function(e,r){var o,a,s,c,l=p[i]||{},u=l[r];u&&(l[r]=void 0,delete l[r],"images"===i?p.texturePacker[r]&&(p.texturePacker[r]=void 0,delete p.texturePacker[r]):"packed-images"===i?(s=(a=u).image,c=a.data,n.forEach(c,function(e,t){var n=e.assetName;p.texturePacker[n]&&delete p.texturePacker[n]}),t&&s.dispose&&s.dispose(),t&&s.image&&s.image.dispose&&s.image.dispose()):"packed-spritesheets"===i?function(e){var i=e.image,r=e.data;n.forEach(r,function(e,t){var n=e.assetName;p.spritesheets[n]&&delete p.spritesheets[n]}),t&&i.dispose&&i.dispose(),t&&i.image&&i.image.dispose&&i.image.dispose()}(u):"packed-json"===i&&(o=u,n.forEach(o,function(e,t,n,i){delete p.json[t]})),t&&(u.dispose?u.dispose():u.image&&u.image.dispose?u.image.dispose():u.image&&u.image.image&&u.image.image.dispose?u.image.image.dispose():u._audioNode&&u._audioNode.dispose&&u._audioNode.dispose()))})}),h[e]=!1):n.log("ERROR: asset group "+e+" does not exist")},getImage:function(e){var i,r=p.texturePacker[e];if(!r){if(!(i=_(e)))return n.log("ERROR: Image "+e+" could not be found"),null;r=t(i),p.texturePacker[e]=r}return r},getImageElement:_,getJson:T,getAudio:function(e){var t=p.audio[e];return n.isDefined(t)||n.log("ERROR: Audio "+e+" could not be found"),t},getSpriteSheet:function(e){var t=p.spritesheets[e];return n.isDefined(t)||n.log("ERROR: Sprite sheet "+e+" could not be found"),t},getAssets:function(){return p},getAssetGroups:function(){return u},hasAsset:M,getSpine:function(e){var t=p.spine[e];return n.isDefined(t)||n.log("ERROR: Spine object "+e+" could not be found"),t},getSpineLoader:function(e){return a},forceHtml5Audio:function(){i=i.getHtmlAudia()}};return l&&e.on("screenHidden",function(){n.forEach(p.images,function(e){e&&e.texture&&e.texture.destroy&&(e.texture.destroy(),e.texture=null)})}),C}}),bento.define("bento/managers/audio",["bento/utils"],function(e){return function(t){var n,i,r=!1,o=!1,a=!1,s=!1,c=!1,l="",u=t.assets,h=(t.getCanvas(),function(e){d.ignorePageVisibility||(e?(n=r,i=o,d.muteMusic(!0),d.muteSound(!0)):(r=n,o=i,l&&d.playMusic(l,c)))}),d={ignorePageVisibility:!1,setVolume:function(e,t){var n=u.getAudio(t);n&&(n.volume=e)},getVolume:function(t){var n=u.getAudio(t);return n?n.volume:(e.log("ERROR: Could not find audio file"),0)},playSound:function(t,n,i,o){var s=u.getAudio(t),c=t.lastIndexOf("/");s?("sfx_"!==t.substr(c+1,4)&&e.log("Warning: file names of sound effects should start with 'sfx_'"),r||a||(o&&d.stopSound(t),e.isDefined(n)&&(s.loop=n),e.isDefined(i)&&(s.onended=i),s.play())):e.log("ERROR: Could not find audio file")},stopSound:function(t){var n=u.getAudio(t);n?n.stop():e.log("ERROR: Could not find audio file")},playMusic:function(t,n,i,r){var a,h=t.lastIndexOf("/");if(r&&d.stopAllMusic(),"bgm_"!==t.substr(h+1,4)&&e.log("Warning: file names of music tracks should start with 'bgm_'"),l=t,c=!e.isDefined(n)||n,!o&&""!==l){if(!(a=u.getAudio(t)))return void e.log("ERROR: Could not find audio file");i&&(a.onended=i),a.loop=c,a.play(),s=!0}},stopMusic:function(e){u.getAudio(e).stop(),s=!1},muteSound:function(e){(r=e)&&this.stopAllSound()},muteMusic:function(t,n){var i=l;o=t,e.isDefined(n)||(n=!1),o?(d.stopAllMusic(),l=i):n&&""!==l&&d.playMusic(l,c)},stopAllSound:function(){var e,t=u.getAssets().audio;for(e in t)t.hasOwnProperty(e)&&e.indexOf("sfx_")>=0&&t[e].stop()},stopAllMusic:function(){var e,t=u.getAssets().audio;for(e in t)t.hasOwnProperty(e)&&e.indexOf("bgm_")>=0&&t[e].stop(e===l?0:void 0);l="",s=!1},preventSounds:function(e){a=e},isPlayingMusic:function(e){return e?l===e:s}};return"hidden"in document?document.addEventListener("visibilitychange",function(){h(document.hidden)},!1):"mozHidden"in document?document.addEventListener("mozvisibilitychange",function(){h(document.mozHidden)},!1):"webkitHidden"in document?document.addEventListener("webkitvisibilitychange",function(){h(document.webkitHidden)},!1):"msHidden"in document?document.addEventListener("msvisibilitychange",function(){h(document.msHidden)},!1):"onpagehide"in window?(window.addEventListener("pagehide",function(){h(!0)},!1),window.addEventListener("pageshow",function(){h(!1)},!1)):"onblur"in document?(window.addEventListener("blur",function(){h(!0)},!1),window.addEventListener("focus",function(){h(!1)},!1)):"onfocusout"in document&&(window.addEventListener("focusout",function(){h(!0)},!1),window.addEventListener("focusin",function(){h(!1)},!1)),d}}),bento.define("bento/managers/input",["bento/utils","bento/math/vector2","bento/eventsystem"],function(e,t,n){"use strict";var i={};return function(r,o){var a,s,c,l,u,h,d,p=!1,f=[],m={},g=0,v=0,y=new t(0,0),b=[],w={},x=[],E={},S=function(e){f.push({id:e.id,position:e.position,eventType:e.eventType,localPosition:e.localPosition,worldPosition:e.worldPosition}),n.fire("pointerDown",e)},_=function(e){n.fire("pointerMove",e),O(e)},T=function(e){n.fire("pointerUp",e),k(e)},M=function(e){var t,n;for(e.preventDefault(),t=0,n=e.changedTouches.length;t<n;++t)L(e,t,"start"),S(e)},C=function(e){var t,n;for(e.preventDefault(),t=0,n=e.changedTouches.length;t<n;++t)L(e,t,"move"),_(e)},A=function(e){var t,n;for(e.preventDefault(),t=0,n=e.changedTouches.length;t<n;++t)L(e,t,"end"),T(e)},R=function(e){D(e,"start"),S(e)},P=function(e){D(e,"move"),_(e)},I=function(e){D(e,"end"),T(e)},L=function(n,r,o){var a,l,u=n.changedTouches[r];if(n.target&&n.target.getBoundingClientRect){var h=n.target.getBoundingClientRect();a=(u.pageX-h.left)/s.x+y.x,l=(u.pageY-h.top)/s.y+y.y}else a=(u.pageX-g)/s.x+y.x,l=(u.pageY-v)/s.y+y.y;var d={};n.preventDefault(),n.id=0,n.eventType="touch",u.position=new t(a,l),u.worldPosition=u.position.clone(),u.worldPosition.x+=c.x,u.worldPosition.y+=c.y,u.localPosition=u.position.clone(),n.position=u.position.clone(),n.worldPosition=u.worldPosition.clone(),n.localPosition=u.localPosition.clone(),n.id=u.identifier+1,"start"===o&&(d.startPosition=u.position.clone(),d.startWorldPosition=u.worldPosition.clone(),d.startLocalPosition=u.localPosition.clone(),i[n.id]=d),"end"===o&&((d=i[n.id])&&d.startPosition?(u.diffPosition=u.position.subtract(d.startPosition),u.diffWorldPosition=u.worldPosition.subtract(d.startWorldPosition),u.diffLocalPosition=u.localPosition.subtract(d.startLocalPosition),n.diffPosition=u.diffPosition.clone(),n.diffWorldPosition=u.diffWorldPosition.clone(),n.diffLocalPosition=u.diffLocalPosition.clone(),delete i[n.id]):e.log("ERROR: touch startPosition was not defined"))},D=function(e,n){var r,o;if(e.target&&e.target.getBoundingClientRect){var a=e.target.getBoundingClientRect();r=(e.clientX-a.left)/s.x+y.x,o=(e.clientY-a.top)/s.y+y.y}else r=(e.pageX-g)/s.x+y.x,o=(e.pageY-v)/s.y+y.y;var l={};e.id=0,e.eventType="mouse",e.position=new t(r,o),e.worldPosition=e.position.clone(),e.worldPosition.x+=c.x,e.worldPosition.y+=c.y,e.localPosition=e.position.clone(),"start"===n&&(l.startPosition=e.position.clone(),l.startWorldPosition=e.worldPosition.clone(),l.startLocalPosition=e.localPosition.clone(),i[-1]=l),"end"===n&&(l=i[-1],e.diffPosition=e.position.substract(l.startPosition),e.diffWorldPosition=e.worldPosition.substract(l.startWorldPosition),e.diffLocalPosition=e.localPosition.substract(l.startLocalPosition)),e.id=-1},O=function(e){var t,n=0;for(n=0,t=f.length;n<t;++n)if(f[n].id===e.id)return f[n].position=e.position,f[n].worldPosition=e.worldPosition,void(f[n].localPosition=e.position)},k=function(e){var t,n=0;for(n=0,t=f.length;n<t;++n)if(f[n].id===e.id)return void f.splice(n,1)},F=function(t){var i,r,o;if(t.preventDefault(),n.fire("keyDown",t),o=e.keyboardMapping[t.keyCode])for(i=0,r=o.length;i<r;++i)m[o[i]]=!0,n.fire("buttonDown",o[i]),n.fire("buttonDown-"+o[i]);else e.log("ERROR: Key with keyCode "+t.keyCode+" is undefined.")},B=function(t){var i,r,o;if(t.preventDefault(),n.fire("keyUp",t),o=e.keyboardMapping[t.keyCode])for(i=0,r=o.length;i<r;++i)m[o[i]]=!1,n.fire("buttonUp",o[i]),n.fire("buttonUp-"+o[i]);else e.log("ERROR: Key with keyCode "+t.keyCode+" is undefined.")},N=function(){var t=e.getScreenSize();e.isCocoonJs()?(s.x=t.width/c.width,s.y=t.height/c.height):(s.x=a.offsetWidth/c.width,s.y=a.offsetHeight/c.height,g=a.offsetLeft,v=a.offsetTop)},U=function(e){n.on("preUpdate",G),console.log("Gamepad connected:",e.gamepad),n.fire("gamepadConnected",e)},z=function(e){l=void 0,n.off("preUpdate",G),n.fire("gamepadDisconnected",e)},G=function(){var e=0,t=0;for(e=0,t=(u=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[]).length;e<t;++e)u[e]&&(l=u[e]);if(l)for(e=0,t=l.buttons.length;e<t;++e)l.buttons[e].pressed!==b[e]&&(l.buttons[e].pressed?H(e):j(e))},H=function(t){var i,r=0,o=e.gamepadMapping[t];for(n.fire("gamepadKeyDown",t),b[t]=!0,r=0,i=o.length;r<i;++r)w[o[r]]=!0,n.fire("gamepadButtonDown",o[r]),n.fire("gamepadButtonDown-"+o[r])},j=function(t){var i,r=0,o=e.gamepadMapping[t];for(n.fire("gamepadKeyUp",t),b[t]=!1,r=0,i=o.length;r<i;++r)w[o[r]]=!1,n.fire("gamepadButtonUp",o[r]),n.fire("gamepadButtonUp-"+o[r])},V=function(){var e,t=0;for(t=0,e=h.buttons.length;t<e;++t)h.buttons[t].pressed!==x[t]&&(h.buttons[t].pressed?W(t):X(t))},W=function(t){var n,i=0,r=e.remoteMapping[t];for(x[t]=!0,i=0,n=r.length;i<n;++i)E[r[i]]=!0},X=function(t){var n,i=0,r=e.remoteMapping[t];for(x[t]=!1,i=0,n=r.length;i<n;++i)E[r[i]]=!1},q=function(e){f.push({id:e.id,position:e.position,eventType:e.eventType,localPosition:e.localPosition,worldPosition:e.worldPosition}),n.fire("tvPointerDown",e)},Y=function(e){n.fire("tvPointerMove",e),O(e)},J=function(e){n.fire("tvPointerUp",e),k(e)},K=function(e){var t,n;for(e.preventDefault(),t=0,n=e.changedTouches.length;t<n;++t)$(e,t,"start"),q(e)},Z=function(e){var t,n;for(e.preventDefault(),t=0,n=e.changedTouches.length;t<n;++t)$(e,t,"move"),Y(e)},Q=function(e){var t,n;for(e.preventDefault(),t=0,n=e.changedTouches.length;t<n;++t)$(e,t,"end"),J(e)},$=function(n,r,o){var a=n.changedTouches[r],l=(a.pageX-g)/s.x+y.x,u=(a.pageY-v)/s.y+y.y,h={};n.preventDefault(),n.id=0,n.eventType="tvtouch",a.position=new t(l,u),a.worldPosition=a.position.clone(),a.worldPosition.x+=c.x,a.worldPosition.y+=c.y,a.localPosition=a.position.clone(),n.position=a.position.clone(),n.worldPosition=a.worldPosition.clone(),n.localPosition=a.localPosition.clone(),n.id=a.identifier+1,"start"===o&&(h.startPosition=a.position.clone(),h.startWorldPosition=a.worldPosition.clone(),h.startLocalPosition=a.localPosition.clone(),i[n.id]=h),"end"===o&&((h=i[n.id])&&h.startPosition?(a.diffPosition=a.position.substract(h.startPosition),a.diffWorldPosition=a.worldPosition.substract(h.startWorldPosition),a.diffLocalPosition=a.localPosition.substract(h.startLocalPosition),n.diffPosition=a.diffPosition.clone(),n.diffWorldPosition=a.diffWorldPosition.clone(),n.diffLocalPosition=a.diffLocalPosition.clone(),delete i[n.id]):e.log("ERROR: touch startPosition was not defined"))};if(!r)throw"Supply a gameData object";return s=r.canvasScale,a=r.canvas,c=r.viewport,a&&N(),window.ejecta&&(a.addEventListener("tvtouchstart",K),a.addEventListener("tvtouchmove",Z),a.addEventListener("tvtouchend",Q)),a.addEventListener("touchstart",M),a.addEventListener("touchmove",C),a.addEventListener("touchend",A),o.globalMouseUp?window.addEventListener("mouseup",I):a.addEventListener("mouseup",I),a.addEventListener("mousedown",R),a.addEventListener("mousemove",P),p=!0,e.isCocoonJs()||(a.addEventListener("touchstart",function(e){return e&&e.preventDefault&&e.preventDefault(),e&&e.stopPropagation&&e.stopPropagation(),!1}),a.addEventListener("touchmove",function(e){return e&&e.preventDefault&&e.preventDefault(),e&&e.stopPropagation&&e.stopPropagation(),!1})),a.addEventListener("touchcancel",function(e){n.fire("touchcancel",e)}),(d=r.canvas||window).tabIndex=0,d.focus&&d.focus(),d.addEventListener("keydown",F,!1),d.addEventListener("keyup",B,!1),d.addEventListener("mousedown",function(e){d.focus&&d.focus()},!1),a&&a.addEventListener&&(a.addEventListener("contextmenu",function(e){n.fire("mouseDown-right"),o.preventContextMenu&&e.preventDefault()},!1),a.addEventListener("click",function(e){1===e.which?(n.fire("mouseDown-left"),e.preventDefault()):2===e.which&&(n.fire("mouseDown-middle"),e.preventDefault())},!1)),function(){var e,t,i=0;if(window.ejecta){for(i=0,e=(t=navigator.getGamepads()).length;i<e;++i)t[i]&&"microGamepad"===t[i].profile&&(h=t[i]);for(i=0,e=h.buttons.length;i<e;++i)x.push(h.buttons[i].pressed);n.on("preUpdate",V)}}(),window.addEventListener("gamepadconnected",U),window.addEventListener("gamepaddisconnected",z),{getPointers:function(){return f},resetPointers:function(){f.length=0},isKeyDown:function(e){return m[e]||!1},isAnyKeyDown:function(){var e;for(e in m)if(m[e])return!0;return!1},isGamepadConnected:function(){return!!l},isGamepadButtonDown:function(e){return w[e]||!1},isAnyGamepadButtonDown:function(){var e;for(e in w)if(w[e])return!0;return!1},getGamepadAxesLeft:function(){return new t(l.axes[0],l.axes[1])},getGamepadAxesRight:function(){return new t(l.axes[2],l.axes[3])},isRemoteButtonDown:function(e){return E[e]||!1},setRemoteExitOnMenuPress:function(e){h.exitOnMenuPress=e},getRemoteAxes:function(){return new t(h.axes[0],h.axes[1])},stop:function(){p&&(window.ejecta&&(a.removeEventListener("tvtouchstart",K),a.removeEventListener("tvtouchmove",Z),a.removeEventListener("tvtouchend",Q)),a.removeEventListener("touchstart",M),a.removeEventListener("touchmove",C),a.removeEventListener("touchend",A),a.removeEventListener("mousedown",R),a.removeEventListener("mousemove",P),o.globalMouseUp?window.removeEventListener("mouseup",I):a.removeEventListener("mouseup",I),p=!1)},resume:function(){p||(window.ejecta&&(a.addEventListener("tvtouchstart",K),
a.addEventListener("tvtouchmove",Z),a.addEventListener("tvtouchend",Q)),a.addEventListener("touchstart",M),a.addEventListener("touchmove",C),a.addEventListener("touchend",A),a.addEventListener("mousedown",R),a.addEventListener("mousemove",P),o.globalMouseUp?window.addEventListener("mouseup",I):a.addEventListener("mouseup",I),p=!0)},updateCanvas:N,setOffset:function(e){y=e}}}}),bento.define("bento/managers/object",["bento/utils","bento/eventsystem"],function(e,t){"use strict";return function(n,i){var r,o=[],a=(new Date).getTime(),s=0,c=((new Date).getTime(),{}),l=!1,u=i.sortMode||0,h=i.useDeltaT||!1,d=i.autoThrottle||!1,p=0,f=function(){e.stableSort.inplace(o,function(e,t){return e.z-t.z})},m=function(){var e;for(e=o.length-1;e>=0;--e)null===o[e]&&o.splice(e,1)},g=function(t){var r=(new Date).getTime(),o=r-a,c=n();if(l){for(a=r,s+=o,(c=n()).deltaT=o,h?(s=1e3/60,d&&(S.throttle=Math.min(o/(1e3/60),3))):c.deltaT=1e3/60;s>=1e3/60;){if((s-=1e3/60)>1e3/30)for(;s>=1e3/60;)s-=1e3/60;i.useDeltaT&&(s=0),v(c)}m(),u===e.SortMode.ALWAYS&&f(),y(c),window.requestAnimationFrame(g)}},v=function(e){var i,a;for(e=e||n(),S.timer+=e.speed,S.ticker+=1,t.fire("preUpdate",e),a=0;a<o.length;++a)(i=o[a])&&(r=i,i.update&&i.updateWhenPaused>=p&&i.update(e),void 0!==i.rootIndex&&(i.rootIndex=a));t.fire("postUpdate",e)},y=function(e){var i,a,s;for(e=e||n(),t.fire("preDraw",e),e.renderer.begin(),t.fire("preDrawLoop",e),a=0,s=o.length;a<s;++a)(i=o[a])&&(r=i,i.draw&&i.draw(e));t.fire("postDrawLoop",e),e.renderer.flush(),t.fire("postDraw",e)},b=function(t){var i,r,a,s=n();if(t)if(t.name||console.warn("WARNING: object has no name",t),t.isAdded||t.parent)e.log("ERROR: Entity "+t.name+" was already added.");else{if(t.z=t.z||0,t.updateWhenPaused=t.updateWhenPaused||0,o.push(t),t.isAdded=!0,t.init&&t.init(),t.family)for(i=0,r=(a=t.family).length;i<r;++i)x(t,a[i]);t.start&&t.start(s),t.attached&&t.attached(s),u===e.SortMode.SORT_ON_ADD&&f()}else e.log("ERROR: trying to attach "+t)},w=function(e){var t,i,r,a,s=n();if(e){if(e.family)for(t=0,i=(a=e.family).length;t<i;++t)E(e,a[t]);(r=o.indexOf(e))>=0&&(o[r]=null,e.destroy&&e.destroy(s),e.removed&&e.removed(s),e.isAdded=!1)}},x=function(e,t){-1!==o.indexOf(e)&&(c[t]||(c[t]=[]),-1===c[t].indexOf(e)&&c[t].push(e))},E=function(t,n){var i=c[n];-1!==o.indexOf(t)&&i&&e.removeFromArray(i,t)},S={timer:0,ticker:0,attach:b,add:b,remove:w,removeAll:function(e){var t,n,i;for(t=0,n=o.length;t<n;++t)(i=o[t])&&(i.global&&!e||w(i));m()},addObjectToFamily:x,removeObjectFromFamily:E,get:function(e,t,n){var i,r,a;for(i=0,r=o.length;i<r;++i)if((a=o[i])&&a.name&&a.name===e)return t&&t(a),a;return n&&n(),null},getByName:function(e,t){var n,i,r,a=[];for(n=0,i=o.length;n<i;++n)(r=o[n])&&r.name&&r.name===e&&a.push(r);return t&&a.length&&t(a),a},getByFamily:function(e,t){var n=c[e];return n||(n=[],c[e]=n),t&&n.length&&t(n),n},stop:function(){l=!1},run:function(e){l&&!e||(l=!0,g())},count:function(){return o.length},pause:function(t){p=t,e.isUndefined(t)&&(p=1)},resume:function(){p=0},isPaused:function(t){return e.isDefined(t)?t.updateWhenPaused<p:p},draw:function(e){y(e)},setSortMode:function(e){u=e},update:function(e){v(e)},getObjects:function(){return o},getCurrentObject:function(){return r},throttle:1};return i.defaultSort&&(f=function(){o.sort(function(e,t){return e.z-t.z})}),S}}),bento.define("bento/managers/savestate",["bento/utils"],function(e){"use strict";var t,n=document.URL,i={data:{},keys:[],length:0,setItem:function(e,t){var n=this.data;n.hasOwnProperty(e)||(this.keys.push(e),this.length++),n[e]=t},getItem:function(t){var n=this.data[t];return e.isDefined(n)?n:null},removeItem:function(e){var t=this.keys.indexOf(e);-1!==t&&(this.keys.splice(t,1),this.length--),delete this.data[e]},key:function(e){return this.keys[e]},clear:function(){this.data={},this.keys=[],this.length=0}};try{if(t=window.localStorage,!window.localStorage)throw"No local storage available";window.localStorage.setItem(n+"save","0")}catch(e){console.log("Warning: you have disabled cookies on your browser. You cannot save progress in your game."),t=i}return{saveKeys:!1,save:function(i,r){var o;if(i){if("string"!=typeof i&&(i=JSON.stringify(i)),void 0===r&&(e.log("ERROR: Don't save a value as undefined, it can't be loaded back in. Use null instead."),r=null),t.setItem(n+i,JSON.stringify(r)),this.saveKeys){if((o=this.load("_keys",[])).indexOf(i)>-1)return;o.push(i),t.setItem(n+"_keys",JSON.stringify(o))}}else e.log("ERROR: savestate key is not defined.")},add:function(t,n){if(t){var i=this.load(t,0);i+=n,this.save(t,i)}else e.log("ERROR: savestate key is not defined.")},load:function(i,r){var o;if(i){if(null==(o=t.getItem(n+i)))return r;try{return JSON.parse(o)}catch(t){return e.log("ERROR: save file corrupted. "+t),r}}else e.log("ERROR: savestate key is not defined.")},remove:function(i){i?t.removeItem(n+i):e.log("ERROR: savestate key is not defined.")},clear:function(){t.clear()},debug:function(){console.log(localStorage)},isEmpty:function(){return 0===t.length},getId:function(){return n.slice(0)},setId:function(e){n=e},setStorage:function(e){t=e},getStorage:function(){return t},getKeys:function(){if(this.saveKeys)return this.load("_keys",[]);var e,i,r,o=[];for(e=0,i=t.length;e<i;e++)0===(r=t.key(e)).indexOf(n)&&o.push(r.slice(n.length));return o}}}),bento.define("bento/managers/screen",["bento/eventsystem","bento/utils"],function(e,t){"use strict";return function(){var t={},n=null,i={add:function(e){if(!e.name)throw"Add name property to screen";t[e.name]=e},show:function(r,o,a){null!==n&&i.hide({next:r}),(n=t[r])?(n.onShow&&n.onShow(o),e.fire("screenShown",n),a&&a()):bento.require([r],function(e){e.name||(e.name=r),i.add(e),i.show(r,o,a)})},hide:function(t){n&&(n.onHide&&n.onHide(t),e.fire("screenHidden",n),n=null)},getCurrentScreen:function(){return n},reset:function(){t={}}};return i}}),bento.define("bento/math/array2d",[],function(){"use strict";return function(e,t){var n,i,r=[];for(n=0;n<e;++n)for(r[n]=[],i=0;i<t;++i)r[n][i]=null;return{isArray2d:function(){return!0},iterate:function(n){var i,o;for(o=0;o<t;++o)for(i=0;i<e;++i)n(i,o,r[i][o])},get:function(e,t){return r[e][t]},set:function(e,t,n){r[e][t]=n}}}}),bento.define("bento/math/matrix",["bento/utils"],function(e){"use strict";var t=function(e){var t=this.clone();return t.addTo(e),t},n=function(e,t){var n=this.clone();return n.multiplyWith(other),n},i=function(r,o){var a,s,c=[],l=r||0,u=o||0,h=function(e,t,n){c[t*l+e]=n},d=function(e,t){return c[t*l+e]};for(s=0;s<u;++s)for(a=0;a<l;++a)h(a,s,a===s?1:0);return{isMatrix:function(){return!0},stringify:function(){var e,t,n="",i="";for(t=0;t<u;++t){for(e=0;e<l;++e)i+=d(e,t)+"\t";n+=i+"\n",i=""}return n},get:function(e,t){return d(e,t)},set:function(e,t,n){h(e,t,n)},setValues:function(e){var t,n=Math.min(c.length,e.length);for(t=0;t<n;++t)c[t]=e[t];return this},getWidth:function(){return l},getHeight:function(){return u},iterate:function(t){var n,i;for(i=0;i<u;++i)for(n=0;n<l;++n){if(!e.isFunction(t))throw"Please supply a callback function";t(n,i,d(n,i))}},transpose:function(){var e,t,n=[];for(e=0;e<l;++e)for(t=0;t<u;++t)n[e*u+t]=d(e,t);return c=n,u=[l,l=u][0],this},addTo:function(e){var t,n;if(u!=e.getHeight()||l!=e.getWidth())throw"Matrix sizes incorrect";for(n=0;n<u;++n)for(t=0;t<l;++t)h(t,n,d(t,n)+e.get(t,n));return this},add:t,multiplyWith:function(e){var t,n,i,r=[],o=l,a=u,s=e.getHeight(),h=e.getWidth(),p=0;if(a!=h)throw"Matrix sizes incorrect";for(n=0;n<s;++n)for(t=0;t<o;++t){for(p=0,i=0;i<h;++i)p+=e.get(i,n)*d(t,i);r[n*o+t]=p}return c=r,l=o,u=s,this},multiply:n,clone:function(){var e=i(l,u);return e.setValues(c),e}}};return i}),bento.define("bento/math/polygon",["bento/utils","bento/math/rectangle"],function(e,t){"use strict";var n=function(){return!0},i=function(){for(var e=[],t=this.points,n=t.length;n--;)e[n]=t[n];return c(e)},r=function(e){for(var t=[],n=this.points,i=n.length;i--;)t[i]=n[i],t[i].x+=e.x,t[i].y+=e.y;return c(t)},o=function(e,t,n,i){var r,o,a=function(e,t){return e.x*t.y-e.y*t.x},s=function(e,t){return{x:e.x-t.x,y:e.y-t.y}},c=s(t,e),l=s(i,n),u=a(s(n,e),c),h=a(c,l);return 0===u&&0===h?n.x-e.x<0!=n.x-t.x<0!=i.x-e.x<0!=i.x-t.x<0||n.y-e.y<0!=n.y-t.y<0!=i.y-e.y<0!=i.y-t.y<0:0!==h&&(r=u/h,(o=a(s(n,e),l)/h)>=0&&o<=1&&r>=0&&r<=1)},a=function(e){var t,n,i,r,a,s,l,u,h=[],d=this.points;if(e.isRectangle){if(!this.getBoundingBox().intersect(e))return!1;h.push({x:e.x,y:e.y}),h.push({x:e.getX2(),y:e.y}),h.push({x:e.getX2(),y:e.getY2()}),h.push({x:e.x,y:e.getY2()}),e=c(h)}else{if(!this.getBoundingBox().intersect(e.getBoundingBox()))return!1;h=e.points}for(a=0,s=d.length;a<s;++a)for(l=0,u=h.length;l<u;++l)if(t=d[a],n=d[(a+1)%d.length],i=h[l],r=h[(l+1)%h.length],o(t,n,i,r))return!0;return!(!this.hasPosition(h[0])&&!e.hasPosition(d[0]))},s=function(e){var t,n=this.points,i=!1,r=0,o=n.length-1,a=this.getBoundingBox();if(e.x<a.x||e.x>a.x+a.width||e.y<a.y||e.y>a.y+a.height)return!1;for(t=n.length;r<t;o=r++)n[r].y>e.y!=n[o].y>e.y&&e.x<(n[o].x-n[r].x)*(e.y-n[r].y)/(n[o].y-n[r].y)+n[r].x&&(i=!i);return i},c=function(e){var o,c,l=e[0].x,u=e[0].x,h=e[0].y,d=e[0].y,p=1;for(p=1,c=e.length;p<c;++p)o=e[p],l=Math.min(o.x,l),u=Math.max(o.x,u),h=Math.min(o.y,h),d=Math.max(o.y,d);return{x:l,y:h,width:u-l,height:d-h,points:e,isPolygon:n,getBoundingBox:function(){return new t(l,h,u-l,d-h)},hasPosition:s,intersect:a,offset:r,clone:i}};return c}),bento.define("bento/math/rectangle",["bento/utils","bento/math/vector2"],function(e,t){"use strict";var n=function(t,i,r,o){if(!(this instanceof n))return new n(t,i,r,o);e.isDev()&&(e.isNumber(t)&&e.isNumber(i)&&e.isNumber(r)&&e.isNumber(o)&&!isNaN(t)&&!isNaN(i)&&!isNaN(r)&&!isNaN(o)||e.log("WARNING: invalid Rectangle state! x: "+t+", y: "+i+", width: "+r+", height: "+o)),this.x=t||0,this.y=i||0,this.width=r||0,this.height=o||0};return n.prototype.isRectangle=function(){return!0},n.prototype.getX2=function(){return this.x+this.width},n.prototype.getY2=function(){return this.y+this.height},n.prototype.union=function(e){var t=Math.min(this.x,e.x),i=Math.min(this.y,e.y),r=Math.max(this.getX2(),e.getX2()),o=Math.max(this.getY2(),e.getY2());return new n(t,i,r-t,o-i)},n.prototype.intersect=function(e){return e.isPolygon?e.intersect(this):!(this.x+this.width<=e.x||this.y+this.height<=e.y||this.x>=e.x+e.width||this.y>=e.y+e.height)},n.prototype.intersection=function(e){var t=new n(0,0,0,0);return this.intersect(e)&&(t.x=Math.max(this.x,e.x),t.y=Math.max(this.y,e.y),t.width=Math.min(this.x+this.width,e.x+e.width)-t.x,t.height=Math.min(this.y+this.height,e.y+e.height)-t.y),t},n.prototype.intersectsCircle=function(e,n){var i=.5*this.width,r=.5*this.height,o=new t(this.x+i,this.y+r),a=Math.abs(e.x-o.x),s=Math.abs(e.y-o.y);return!(a>i+n||s>r+n)&&(a<=i||s<=r||(a-i)*(a-i)+(s-r)*(s-r)<=n*n)},n.prototype.intersectsLine=function(e,t){var n=function(e,t,n,i,r,o,a,s){var c=n-e,l=i-t,u=a-r,h=s-o,d=(-l*(e-r)+c*(t-o))/(-u*l+c*h),p=(u*(t-o)-h*(e-r))/(-u*l+c*h);return d>=0&&d<=1&&p>=0&&p<=1},i=this.x,r=this.y,o=this.getX2(),a=this.getY2();return this.hasPosition(e)&&this.hasPosition(t)||n(e.x,e.y,t.x,t.y,i,r,i,a)||n(e.x,e.y,t.x,t.y,i,r,o,r)||n(e.x,e.y,t.x,t.y,o,r,o,a)||n(e.x,e.y,t.x,t.y,i,a,o,a)},n.prototype.offset=function(e){return new n(this.x+e.x,this.y+e.y,this.width,this.height)},n.prototype.clone=function(){return new n(this.x,this.y,this.width,this.height)},n.prototype.copyInto=function(e){return e.x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,this},n.prototype.hasPosition=function(e){return!(e.x<this.x||e.y<this.y||e.x>=this.x+this.width||e.y>=this.y+this.height)},n.prototype.grow=function(e,t,n){return t||(this.x-=e/2,this.width+=e),n||(this.y-=e/2,this.height+=e),this},n.prototype.includePosition=function(e){return this.hasPosition(e)||(e.x<this.x?(t=this.x-e.x,this.x-=t,this.width+=t):e.x>this.x+this.width&&(t=e.x-(this.x+this.width),this.width+=t),e.y<this.y?(t=this.y-e.y,this.y-=t,this.height+=t):e.y>this.y+this.height&&(t=e.y-(this.y+this.height),this.height+=t)),this;var t},n.TOPLEFT=0,n.TOPRIGHT=1,n.BOTTOMLEFT=2,n.BOTTOMRIGHT=3,n.CENTER=4,n.prototype.getCorner=function(e){return e?1===e?new t(this.x+this.width,this.y):2===e?new t(this.x,this.y+this.height):3===e?new t(this.x+this.width,this.y+this.height):new t(this.x+this.width/2,this.y+this.height/2):new t(this.x,this.y)},n.prototype.getCenter=function(){return new t(this.x+this.width/2,this.y+this.height/2)},n.prototype.getSize=function(){return new n(0,0,this.width,this.height)},n.prototype.getExtents=function(){return new t(this.width/2,this.height/2)},n.prototype.toString=function(){return"[object Rectangle]"},n.copyInto=function(e,t){e.copyInto(t)},n}),bento.define("bento/math/transformmatrix",["bento/utils","bento/math/vector2"],function(e,t){"use strict";var n=function(){if(!(this instanceof n))return new n;this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0};return n.prototype.multiplyWithVector=function(e){var t=e.x,n=e.y;return e.x=this.a*t+this.c*n+this.tx,e.y=this.b*t+this.d*n+this.ty,e},n.prototype.inverseMultiplyWithVector=function(e){var t=e.x,n=e.y,i=1/(this.a*this.d-this.c*this.b);return e.x=this.d*t*i+-this.c*n*i+(this.ty*this.c-this.tx*this.d)*i,e.y=this.a*n*i+-this.b*t*i+(-this.ty*this.a+this.tx*this.b)*i,e},n.prototype.translate=function(e,t){return this.tx+=e,this.ty+=t,this},n.prototype.scale=function(e,t){return this.a*=e,this.b*=t,this.c*=e,this.d*=t,this.tx*=e,this.ty*=t,this},n.prototype.rotate=function(e,t,n){var i=this.a,r=this.b,o=this.c,a=this.d,s=this.tx,c=this.ty;return void 0===t&&(t=Math.sin(e)),void 0===n&&(n=Math.cos(e)),this.a=i*n-r*t,this.b=i*t+r*n,this.c=o*n-a*t,this.d=o*t+a*n,this.tx=s*n-c*t,this.ty=s*t+c*n,this},n.prototype.multiplyWith=function(e){var t=this.a,n=this.b,i=this.c,r=this.d;return this.a=e.a*t+e.b*i,this.b=e.a*n+e.b*r,this.c=e.c*t+e.d*i,this.d=e.c*n+e.d*r,this.tx=e.tx*t+e.ty*i+this.tx,this.ty=e.tx*n+e.ty*r+this.ty,this},n.prototype.multiply=function(e){return this.clone().multiplyWith(e)},n.prototype.clone=function(){var e=new n;return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e},n.prototype.copyInto=function(e){return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,this},n.prototype.reset=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},n.prototype.identity=n.prototype.reset,n.prototype.prependWith=function(e){var t=this.tx,n=this.a,i=this.c;return this.a=n*e.a+this.b*e.c,this.b=n*e.b+this.b*e.d,this.c=i*e.a+this.d*e.c,this.d=i*e.b+this.d*e.d,this.tx=t*e.a+this.ty*e.c+e.tx,this.ty=t*e.b+this.ty*e.d+e.ty,this},n.prototype.prepend=function(e){return this.clone().prependWith(e)},n.prototype.appendWith=n.prototype.multiplyWith,n.prototype.append=n.prototype.multiply,n.prototype.toString=function(){return"[object Matrix]"},n}),bento.define("bento/math/vector2",["bento/math/matrix","bento/utils"],function(e,t){"use strict";var n=function(e,i){if(!(this instanceof n))return new n(e,i);t.isDev()&&(t.isNumber(e)&&t.isNumber(i)&&!isNaN(e)&&!isNaN(i)||t.log("WARNING: invalid Vector2 state! x: "+e+", y: "+i)),this.x=e||0,this.y=i||0};return n.prototype.isVector2=function(){return!0},n.prototype.add=function(e){var t=this.clone();return t.addTo(e),t},n.prototype.addTo=function(e){return this.x+=e.x,this.y+=e.y,this},n.prototype.subtract=function(e){var t=this.clone();return t.substractFrom(e),t},n.prototype.subtractFrom=function(e){return this.x-=e.x,this.y-=e.y,this},n.prototype.substract=n.prototype.subtract,n.prototype.substractFrom=n.prototype.subtractFrom,n.prototype.angle=function(){return Math.atan2(this.y,this.x)},n.prototype.angleBetween=function(e){return Math.atan2(e.y-this.y,e.x-this.x)},n.prototype.dotProduct=function(e){return this.x*e.x+this.y*e.y},n.prototype.multiply=function(e){var t=this.clone();return t.multiplyWith(e),t},n.prototype.multiplyWith=function(e){return this.x*=e.x,this.y*=e.y,this},n.prototype.divide=function(e){var t=this.clone();return t.divideBy(e),t},n.prototype.divideBy=function(e){return this.x/=e.x,this.y/=e.y,this},n.prototype.scalarMultiply=function(e){var t=this.clone();return t.scalarMultiplyWith(e),t},n.prototype.scalarMultiplyWith=function(e){return this.x*=e,this.y*=e,this},n.prototype.scale=n.prototype.scalarMultiplyWith,n.prototype.magnitude=function(){return Math.sqrt(this.sqrMagnitude())},n.prototype.sqrMagnitude=function(){return this.dotProduct(this)},n.prototype.normalize=function(){var e=this.magnitude();return 0===e?(this.x=0,this.y=0,this):(this.x/=e,this.y/=e,this)},n.prototype.distance=function(e){return e.substract(this).magnitude()},n.prototype.isFartherThan=function(e,t){var n=e.substract(this);return n.x*n.x+n.y*n.y>t*t},n.prototype.isCloserThan=function(e,t){var n=e.substract(this);return n.x*n.x+n.y*n.y<t*t},n.prototype.rotateRadian=function(e){var t=this.x*Math.cos(e)-this.y*Math.sin(e),n=this.x*Math.sin(e)+this.y*Math.cos(e);return this.x=t,this.y=n,this},n.prototype.rotateDegree=function(e){return this.rotateRadian(e*Math.PI/180)},n.prototype.clone=function(){return new n(this.x,this.y)},n.prototype.copyInto=function(e){return e.x=this.x,e.y=this.y,this},n.prototype.toMatrix=function(){var t=new e(1,3);return t.set(0,0,this.x),t.set(0,1,this.y),t.set(0,2,1),t},n.prototype.reflect=function(e){var t=e.normalize(),n=this.dotProduct(t);return this.substractFrom(t.scalarMultiplyWith(n+n))},n.prototype.toString=function(){return"[object Vector2]"},n.copyInto=function(e,t){e.copyInto(t)},n.fromRotation=function(e,t){return new n(Math.cos(e)*t,Math.sin(e)*t)},Object.defineProperty(n,"up",{get:function(){return new n(0,-1)}}),Object.defineProperty(n,"down",{get:function(){return new n(0,1)}}),Object.defineProperty(n,"left",{get:function(){return new n(-1,0)}}),Object.defineProperty(n,"right",{get:function(){return new n(1,0)}}),n}),bento.define("bento/autoresize",["bento/utils"],function(e){return function(t,n,i,r,o){var a=e.getScreenSize(),s=a.width/a.height,c=s<=1;switch(o){case"portrait":c=!0;break;case"landscape":c=!1}return c?{width:Math.ceil(e.clamp(t,i*s,n)),height:Math.ceil(e.clamp(i,t/s,r))}:{width:Math.ceil(e.clamp(i,t*s,r)),height:Math.ceil(e.clamp(t,i/s,n))}}}),bento.define("bento/canvas",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/eventsystem","bento/utils","bento/tween","bento/packedimage","bento/objectpool","bento/renderers/canvas2d"],function(e,t,n,i,r,o,a,s,c,l,u,h){"use strict";var d=new u({poolSize:1,constructor:function(){return e.createCanvas()},destructor:function(e){return e.getContext("2d").clearRect(0,0,e.width,e.height),e.texture&&(e.texture.destroy&&e.texture.destroy(),e.texture=null),e}});return function(n){e.getViewport();var r,a,c,u,p,f,m,g,v,y=new t(0,0),b=!1,w={name:"rendererSwapper",draw:function(e){b||(n.preventAutoClear||u.clearRect(0,0,c.width,c.height),c.texture&&(c.texture.destroy&&c.texture.destroy(),c.texture=null),p=e.renderer,e.renderer=f,e.renderer.save(),e.renderer.translate(Math.round(y.x),Math.round(y.y)))},postDraw:function(e){b||(e.renderer.restore(),e.renderer=p,n.drawOnce&&(b=!0))}};if(n.canvas?c=n.canvas:((c=d.get()).width=n.width,c.height=n.height),u=c.getContext("2d"),f=new h(c,{pixelSize:n.pixelSize||1}),n.origin?y=n.origin:n.originRelative&&(y=new t(n.width*n.originRelative.x,n.height*n.originRelative.y)),m=new l(c),v=[new i({image:m,origin:n.origin,originRelative:n.originRelative}),w],n.components)for(r=0,a=n.components.length;r<a;++r)v.push(n.components[r]);return(g=new o({z:n.z,name:n.name||"canvas",position:n.position,components:v,family:n.family,init:n.init})).extend({getCanvas:function(){return c},getContext:function(){return u},getBase64:function(){return c.toDataURL()},downloadImage:function(e){var t=document.createElement("a");t.download=e||g.name,t.href=c.toDataURL(),document.body.appendChild(t),t.click(),document.body.removeChild(t)},drawOnce:function(e){c.isAdded?s.log("This Canvas is already attached, no need to call this function."):(c.start(e),c.draw(e))}}),g}}),bento.define("bento/color",["bento/utils"],function(e){return function(t,n,i,r){return t/=255,t=n/255,t=i/255,e.isDefined(r)||(r=1),[t,n,i,r]}}),bento.define("bento/gui/centeredlist",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/eventsystem","bento/utils","bento/tween"],function(e,t,n,i,r,o,a,s,c){"use strict";return function(t){e.getViewport();var n=[],i=t.spacing||8,r=s.getDefault(t.useItemDimensions,!0),a=t.direction||"x",c="x"===a?"width":"height",l=s.extend({z:0,name:"centeredList"},t,!0),u=new o(l),h=0,d=function(){var e=0,t=(h+i)*(n.length-1);for(e=0;e<n.length;++e)n[e].position[a]=-t/2+(h+i)*e};return u.extend({addItem:function(e){return r&&(h=e.dimension[c]),n.push(e),u.attach(e),d(),e},removeItem:function(e){var t=n.splice(e,1);u.remove(t),d()},iterate:function(e){var t,i,r=!1,o=function(){r=!0};for(t=0,i=n.length;t<i;++t)if(e(n[t],t,i,o),r)return},get:function(e){return n[e]},clear:function(){var e;for(e=n.length-1;e>=0;e--)u.remove(n[e]);d(),n=[]},getIndex:function(e){return n.indexOf(e)}}),Object.defineProperty(u,"length",{get:function(){return n.length},set:function(e){n.length=e}}),t.items&&s.forEach(t.items,function(e,t,n,i){u.addItem(e)}),u}}),bento.define("bento/gui/clickbutton",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/nineslice","bento/components/clickable","bento/entity","bento/utils","bento/tween","bento/eventsystem"],function(e,t,n,i,r,o,a,s,c,l){"use strict";var u=function(n){e.getViewport();var c=!0,h={up:{speed:0,frames:[0]},down:{speed:0,frames:[1]},inactive:{speed:0,frames:[2]}};n.frameCountX*n.frameCountY<=2&&(h.inactive.frames=[0]),n.frameCountX*n.frameCountY<=1&&(h.down.frames=[0]);var d=n.animations||h,p=n.nineSliceSettings||null,f=p?new r({image:n.image,imageName:n.imageName,originRelative:n.originRelative||new t(.5,.5),frameWidth:n.frameWidth,frameHeight:n.frameHeight,frameCountX:n.frameCountX,frameCountY:n.frameCountY,width:p.width,height:p.height,animations:d}):null,m=f?null:n.sprite||new i({image:n.image,imageName:n.imageName,originRelative:n.originRelative||new t(.5,.5),padding:n.padding,frameWidth:n.frameWidth,frameHeight:n.frameHeight,frameCountX:n.frameCountX,frameCountY:n.frameCountY,animations:d}),g=f||m,v=!1,y=new o({sort:n.sort,ignorePauseDuringPointerUpEvent:n.ignorePauseDuringPointerUpEvent,onClick:function(e){v=!1,c&&!u.currentlyPressing&&(u.currentlyPressing=E,x("down"),n.onButtonDown&&n.onButtonDown.apply(E,[e]),l.fire("clickButton-onButtonDown",{entity:E,event:"onClick",data:e}))},onHoldEnter:function(e){c&&(x("down"),n.onButtonDown&&n.onButtonDown.apply(E,[e]),l.fire("clickButton-onButtonDown",{entity:E,event:"onHoldEnter",data:e}))},onHoldLeave:function(e){c&&(x("up"),n.onButtonUp&&n.onButtonUp.apply(E,[e]),l.fire("clickButton-onButtonUp",{entity:E,event:"onHoldLeave",data:e}))},pointerUp:function(e){c&&(x("up"),n.onButtonUp&&n.onButtonUp.apply(E,[e]),l.fire("clickButton-onButtonUp",{entity:E,event:"pointerUp",data:e}),u.currentlyPressing===E&&(v=!0,u.currentlyPressing=null))},onHoldEnd:function(t){c&&n.onClick&&(u.currentlyPressing===E||v)&&(v=!1,n.onClick.apply(E,[t]),n.sfx&&(e.audio.stopSound(n.sfx),e.audio.playSound(n.sfx)),l.fire("clickButton-onClick",{entity:E,event:"onHoldEnd",data:t})),u.currentlyPressing===E&&(u.currentlyPressing=null)},onClickMiss:function(e){n.onClickMiss&&n.onClickMiss(e)}}),b=s.extend({z:0,name:"clickButton",position:new t(0,0),family:["buttons"],init:function(){w(c)}},n,!0);b.components=[g,y].concat(n.components||[]);var w=function(e){c=e,d=g.animations||d,c?x("up"):(u.currentlyPressing===E&&(u.currentlyPressing=null),d.inactive?x("inactive"):x("up"))},x=function(e){g.setAnimation(e)},E=new a(b).extend({setActive:w,doCallback:function(){n.onClick.apply(E)},mimicClick:function(){c&&(v=!0,y.callbacks.onHoldEnd({}))},isActive:function(){return c},setNineSliceSize:function(e,t){"nineslice"===g.name?(p.width=e,p.height=t,g.width=e,g.height=t):console.warn("LK_WARN: Don't use setNineSliceSize if the clickbutton uses a sprite.")}});return s.isDefined(n.active)&&(c=n.active),E.attach({name:"attachComponent",start:function(){l.fire("clickButton-start",{entity:E})},destroy:function(){l.fire("clickButton-destroy",{entity:E}),u.currentlyPressing===E&&(u.currentlyPressing=null)}}),Object.defineProperty(E,"active",{get:function(){return c},set:w}),E};return u.currentlyPressing=null,u}),bento.define("bento/gui/counter",["bento","bento/entity","bento/math/vector2","bento/components/sprite","bento/utils"],function(e,t,n,i,r){"use strict";return function(e){var o,a=e.value||0,s=e.spacing||new n(0,0),c=e.align||e.alignment||"right",l=0,u=[],h={},d=function(){return a.toString().length},p=function(){var p,f,m,g,v,y,b=a.toString(),w=d(),x=u.length-w;if(x<0)for(p=0;p<Math.abs(x);++p)g=void 0,v=void 0,y=void 0,g=new i({image:h.image,padding:h.padding,imageName:h.imageName,frameWidth:h.frameWidth,frameHeight:h.frameHeight,frameCountX:h.frameCountX,frameCountY:h.frameCountY,animations:e.animations||{0:{frames:[0]},1:{frames:[1]},2:{frames:[2]},3:{frames:[3]},4:{frames:[4]},5:{frames:[5]},6:{frames:[6]},7:{frames:[7]},8:{frames:[8]},9:{frames:[9]}}}),v=r.extend({name:"digit",components:[g]},e.digit||{}),y=new t(v),l=g.frameWidth,m=y,u.push(m),o.attach(m);else if(x>0)for(p=0;p<Math.abs(x);++p)m=u.pop(),o.remove(m);for(p=0,f=u.length;p<f;++p)(m=u[p]).position=new n((l+s.x)*p,0),m.getComponent("sprite",function(e){e.setAnimation(b.substr(p,1))});if("right"===c)for(p=0,f=u.length;p<f;++p)(m=u[p]).position.substractFrom(new n((l+s.x)*w-s.x,0));else if("center"===c)for(p=0,f=u.length;p<f;++p)(m=u[p]).position.addTo(new n(((l+s.x)*w-s.x)/-2,0))},f={z:e.z,name:e.name||"counter",position:e.position};return h.image=e.image,h.imageName=e.imageName,h.padding=e.padding,h.frameWidth=e.frameWidth,h.frameHeight=e.frameHeight,h.frameCountX=e.frameCountX,h.frameCountY=e.frameCountY,e.sprite&&(e.sprite=e.sprite.animationSettings,h.image=e.sprite.image,h.imageName=e.sprite.imageName,h.padding=e.sprite.padding,h.frameWidth=e.sprite.frameWidth,h.frameHeight=e.sprite.frameHeight,h.frameCountX=e.sprite.frameCountX,h.frameCountY=e.sprite.frameCountY),r.extend(f,e),f.components=e.components,o=new t(f).extend({setValue:function(e){a=e,p()},getValue:function(){return a},addValue:function(e){a+=e,p()},getDigits:function(){return d()},loopDigits:function(e){var t,n=0;for(n=0,t=u.length;n<t;++n)e(u[n])}}),p(),o}}),bento.define("bento/gui/scrollinglist",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/eventsystem","bento/utils","bento/tween"],function(e,t,n,i,r,o,a,s,c){"use strict";return function(t){e.getViewport();var n=[],i=0,a=0,c=0,l=null,u=0,h=0,d=0,p=0,f=0,m=0,g=!1,v=t.direction||"y",y="x"===v?"width":"height",b=t.spacing||0,w=t.snap||!1,x=t.snapNextOffset||0,E=w?0:t.maxOffset||0,S=w?0:t.minOffset||0,_=t.clamp||!1,T=t.snapMinSlideSpeed||1,M=t.snapSpeed||.3,C=t.damping||.9,A=-1,R=0,P=0,I=0,L=!0,D=new r({pointerDown:function(e){L&&null===l&&(F.position[v],c=e.position[v],a=e.position[v],i=F.position[v],p=m,n.length<=1||(t.area?t.area.hasPosition(e.localPosition)&&(l=e.id,t.onScrollStart&&t.onScrollStart()):(l=e.id,t.onScrollStart&&t.onScrollStart())))},pointerMove:function(e){l===e.id&&(u=e.position[v]-c,Math.abs(u)>Math.abs(h)&&(h=u),e.position[v],F.position[v]=i+(e.position[v]-a),c=e.position[v],t.onScroll&&t.onScroll(F.position[v]))},pointerUp:function(e){var t;l===e.id&&(l=null,d=h,t=a-e.position[v],w&&x&&(t>x?N.snapTo(p+1):t<-x&&N.snapTo(p-1)))}}),O={pointers:[],name:"inputBehavior",start:function(){this.pointers=e.input.getPointers()},update:function(){null!==l&&0===this.pointers.length&&(l=null)}},k={name:"scrollBehavior",update:function(){var e,i=F.position[v],r=P+b,o=n.length-1,a=s.clamp(-o,0===r?0:Math.round(i/r),0),c=a*r;if(g)return g=!1,l=null,void(d=0);f!==a&&(t.onLoseFocus&&t.onLoseFocus(n[s.clamp(0,-f,n.length-1)]),f=a,m=-a,t.onSnap&&(e=s.clamp(0,m,n.length-1),t.onSnap(n[e],e))),A>=0&&a!==-A?c=-A*r:A=-1,h*=.6,null===l&&(w&&(Math.abs(d)<T?F.position[v]+=(c-i)*M:F.position[v]+=d),F.position[v]+=d,i<=-R-E?(c=-R-E,F.position[v]+=.1*(c-i),d/=2):i>S&&(c=S,F.position[v]+=.1*(c-i),d/=2)),U(),Math.abs(d),d*=C,_&&(F.position[v]>S?(F.position[v]=S,d=0):F.position[v]<=-R-E&&(F.position[v]=-R-E,d=0)),I=F.position[v]}},F=new o({name:"container",updateWhenPaused:t.updateWhenPaused||0,components:[]}),B=s.extend({z:0,name:"scrollingList"},t,!0);B.components=[D,F,k,O].concat(t.components||[]);var N=new o(B),U=function(){var e,t,i,r=0;for(R=0,e=0,t=n.length;e<t;++e)(i=n[e]).position[v]=r,e!==t-1&&(r+=(P=i.dimension[y])+b);R=r};return N.extend({addItem:function(e){return n.push(e),F.attach(e),U(),N},removeItem:function(e){var t=n.splice(e,1);return F.remove(t[0]),U(),t},didMove:function(e){return Math.abs(I-i)>e},iterate:function(e){var t=0,i=n.length,r=!1,o=function(){r=!0};for(t=0;t<i;++t)if(e(n[t],t,i,o),r)return},forceTo:function(e){F.position[v]=e,N.update()},getScroll:function(){return F.position[v]},get:function(e){return n[e]},getItems:function(){return n},getTotalSize:function(){return R},setArea:function(e){t.area=e},snapTo:function(e){A=s.clamp(0,e,n.length-1)},getSelection:function(){return m},cancel:function(){g=!0},isScrolling:function(){return Math.abs(d)>.2},setMinOffset:function(e){S=e},setMaxOffset:function(e){E=e},setSpacing:function(e){b=e,U()},stopSliding:function(){d=0},setActive:function(e){L=e}}),Object.defineProperty(N,"length",{get:function(){return n.length},set:function(e){n.length=e}}),Object.defineProperty(N,"active",{get:function(){return L},set:N.setActive}),N}}),bento.define("bento/gui/text",["bento","bento/math/vector2","bento/math/rectangle","bento/entity","bento/utils","bento/components/sprite","bento/packedimage"],function(e,t,n,i,r,o,a){"use strict";var s=function(e){var t;if(""===e||0===e||"0"===e||null===e||!1===e||!r.isDefined(e))return!0;if(r.isArray(e)&&0===e.length)return!0;if(r.isObject(e)){for(t in e)if(r.has(e,t))return!1;return!0}return!1},c=function(l){var u,h,d,p,f,m,g,v,y="",b=!0,w="normal",x=!1,E=["black","white"],S="left",_="arial",T=16,M=32,C="black",A=[0],R=0,P="round",I=["black"],L=[!1],D="top",O=!1,k=!1,F=[],B=0,N=0,U=null,z=1,G=1,H="source-over",j=c.defaultSharpness,V=1/j,W=new t(0,0),X={},q=l.drawDebug||!1,Y=!1,J=new t(0,0),K=0,Z="black",Q=!1,$=0,ee=function(e){var n,i,o;if(e.fontSettings&&r.extend(e,e.fontSettings),e.sharpness&&(j=e.sharpness,V=1/j,ue.scale.x=V,ue.scale.y=V),e.fontSize&&(e.fontSize*=j),e.gradient&&(d=e.gradient),e.gradientColors)for(E=[],n=0,i=e.gradientColors.length;n<i;++n)E[n]=e.gradientColors[n];for(e.overlaySprite&&((U=e.overlaySprite).initialized||(U.init(),U.initialized=!0)),e.align&&(S=e.align),r.isDefined(e.ySpacing)&&(N=e.ySpacing*j),e.font&&(_=e.font),r.isDefined(e.fontSize)&&(T=e.fontSize,M=T),e.fontColor&&(C=e.fontColor),e.textBaseline&&(D=e.textBaseline),e.centerByCanvas&&(k=e.centerByCanvas),r.isDefined(e.fontWeight)&&(w=e.fontWeight),r.isDefined(e.lineWidth)&&(r.isArray(e.lineWidth)?(A=e.lineWidth,r.forEach(A,function(e,t,n,i){A[t]*=j})):A=[e.lineWidth*j]),e.strokeStyle&&(I=r.isArray(e.strokeStyle)?e.strokeStyle:[e.strokeStyle]),e.innerStroke&&(L=r.isArray(e.innerStroke)?e.innerStroke:[e.innerStroke]),O=e.pixelStroke||!1,P=r.getDefault(e.lineJoin,"round"),o=Math.max(A.length,I.length,L.length);A.length<o;)A.push(0);for(;I.length<o;)I.push("black");for(;L.length<o;)L.push(!1);for(R=0,n=0,i=A.length;n<i;++n)R=Math.max(R,2*A[n]);r.isDefined(e.shadow)&&(Y=e.shadow,J=r.isDefined(e.shadowOffset)?e.shadowOffset.scalarMultiplyWith(j):new t(0,Y?1*j:0),K=Math.max(Math.abs(J.x),Math.abs(J.y)),Z=e.shadowColor||"black"),r.isDefined(e.linebreaks)&&(b=e.linebreaks),r.isDefined(e.linebreaksOnlyOnSpace)&&(x=e.linebreaksOnlyOnSpace),r.isDefined(e.maxWidth)&&(u=e.maxWidth*j),r.isDefined(e.maxHeight)&&(h=e.maxHeight*j),
r.isDefined(e.margin)&&(W=e.margin.scalarMultiply(j)),e.text?v.setText(l.text):v.setText(y)},te=function(){return l.fontSettings?r.isDefined(l.fontSettings.antiAlias)&&(g=l.fontSettings.antiAlias):r.isDefined(l.antiAlias)&&(g=l.antiAlias),e.createCanvas(g)},ne=function(i){var o,c,l,u,h,d,y,b,w=new t(R/2,R/2),x=le.origin,E=(v.position,function(){var t=document.createElement("canvas"),n=t.getContext("2d"),i=e.getAntiAlias();if(r.isDefined(g)&&e.setAntiAlias(g),t.width=p.width,t.height=p.height,r.isDefined(g)&&e.setAntiAlias(i),re(n),n.fillStyle=Z,n.fillText(F[o].string,~~h,~~d+(navigator.isCocoonJS?0:.5)),!O)for(n.lineJoin=P,n.globalCompositeOperation="destination-over",l=A.length-1;l>=0;--l)A[l]&&!L[l]&&(n.lineWidth=2*A[l],n.strokeStyle=I[l],n.strokeText(F[o].string,~~h,~~d));f.drawImage(t,0,0,t.width,t.height,J.x,J.y,t.width,t.height)});i?b=i.getContext("2d"):(p||(p=te(),f=(i=p).getContext("2d")),i=p,b=f);var _,M,B,H=e.getAntiAlias();if(r.isDefined(g)&&e.setAntiAlias(g),i.width=z+R+K+2*W.x,i.height=G+R+K+2*W.y,r.isDefined(g)&&e.setAntiAlias(H),b.clearRect(0,0,i.width,i.height),p===i&&(v.dimension=new n(0,0,i.width/j,i.height/j)),U&&(y=i.width/U.getDimension().width,U.scalable&&U.scalable.setScale(new t(y,y))),Y&&(J.x<0&&(w.x-=J.x),J.y<0&&(w.y-=J.y)),p===i){switch(S){case"left":x.x=W.x;break;case"center":x.x=W.x+z/2;break;case"right":x.x=W.x+z}switch(D){case"top":x.y=W.y;break;case"middle":x.y=W.y+(k?i.height:G)/2;break;case"bottom":x.y=W.y+(k?i.height:G)}}for(re(b),o=0,c=F.length;o<c;++o){if(r.isDefined(F[o].gradient)?b.fillStyle=F[o].gradient:b.fillStyle=C,h=w.x+x.x+F[o].spaceWidth/2,d=w.y+(o+1)*T+W.y+N*o,b.globalCompositeOperation="source-over",O)for(l=A.length-1;l>=0;--l)A[l]&&!L[l]&&(_=void 0,M=void 0,B=void 0,_=document.createElement("canvas"),M=_.getContext("2d"),B=e.getAntiAlias(),r.isDefined(g)&&e.setAntiAlias(g),_.width=p.width,_.height=p.height,r.isDefined(g)&&e.setAntiAlias(B),re(M),M.fillStyle=I[l],M.fillText(F[o].string,~~h,~~d+(navigator.isCocoonJS?0:.5)),f.drawImage(_,0,0,_.width,_.height,0,-A,_.width,_.height),f.drawImage(_,0,0,_.width,_.height,-A,-A,_.width,_.height),f.drawImage(_,0,0,_.width,_.height,-A,0,_.width,_.height),f.drawImage(_,0,0,_.width,_.height,-A,A,_.width,_.height),f.drawImage(_,0,0,_.width,_.height,0,A,_.width,_.height),f.drawImage(_,0,0,_.width,_.height,A,A,_.width,_.height),f.drawImage(_,0,0,_.width,_.height,A,0,_.width,_.height),f.drawImage(_,0,0,_.width,_.height,A,-A,_.width,_.height));for(Y&&E(),b.globalCompositeOperation="source-over",b.fillText(F[o].string,~~h,~~d+(navigator.isCocoonJS?0:.5)),s(U)||(b.globalCompositeOperation="source-atop",U.setPosition(new t(h,d-T)),U.draw({canvas:p,context:b})),b.globalCompositeOperation="source-atop",l=0,u=A.length;l<u;++l)A[l]&&L[l]&&(b.lineWidth=2*A[l],b.strokeStyle=I[l],b.strokeText(F[o].string,~~h,~~d));if(!O)for(b.lineJoin=P,b.globalCompositeOperation="destination-over",l=A.length-1;l>=0;--l)A[l]&&!L[l]&&(b.lineWidth=2*A[l],b.strokeStyle=I[l],b.strokeText(F[o].string,~~h,~~d))}return ie(b),p===i&&(p.texture&&p.texture.destroy&&p.texture.destroy(),p.texture=null,m=new a(p),le.setup({image:m})),$+=2,i},ie=function(e){e&&(e.textAlign="left",e.textBaseline="bottom",e.lineWidth=0,e.strokeStyle="black",e.fillStyle="black",e.globalCompositeOperation=H,e.restore())},re=function(e){e&&(e.save(),e.textAlign=S,e.textBaseline="bottom",e.font=w+" "+T.toString()+"px "+_,H=e.globalCompositeOperation)},oe=function(){var e,t,n,i,r,o,a,h,d,m=(""+y).split("\n");for(p||se||c.generateOnConstructor||(p||(p=te(),f=p.getContext("2d")),se=!0,ee(l)),F=[],z=1,G=1,re(f),n=0;n<m.length;++n){if(B=0,r=(t=m[n]).length,e=f.measureText(t).width,b&&!s(u)&&e>u){for(i=0;e>u;)if(++i,a=t.slice(0,t.length-i),e=f.measureText(a).width,i===r){i=r-1;break}x&&-1==t.indexOf(" ")&&-1==t.indexOf("")||((d=Math.max(a.lastIndexOf(" "),a.lastIndexOf("")))>0&&d!=a.length?i+=a.length-d:x&&(i=0),h=t.slice(r-i,r),t=t.slice(0,r-i)," "===h.charAt(0)&&(h=h.slice(1)),0!==h.length&&m.splice(n+1,0,h)),e=f.measureText(t).width}e>z&&(z=e),o=ae(e,n),F.push({string:t,width:e,gradient:o,spaceWidth:B}),G+=T+N}},ae=function(e,t){var n,i,r,o,a,s,c={x:0,y:0},l={x:0,y:0};if(d){switch(a=(T+N)*t,s=(T+N)*(t+1),d){case"top-down":c.x=0,c.y=a,l.x=0,l.y=s;break;case"down-top":c.x=0,c.y=s,l.x=0,l.y=a;break;case"left-right":c.x=0,c.y=0,l.x=e,l.y=0;break;case"right-left":c.x=e,c.y=0,l.x=0,l.y=0;break;case"topleft-downright":c.x=0,c.y=a,l.x=e,l.y=s;break;case"topright-downleft":c.x=e,c.y=a,l.x=0,l.y=s;break;case"downleft-topright":c.x=0,c.y=s,l.x=e,l.y=a;break;case"downright-topleft":c.x=e,c.y=s,l.x=0,l.y=a}for(c.x+=R/2,c.y+=R/2,l.x+=R/2,l.y+=R/2,n=f.createLinearGradient(c.x,c.y,l.x,l.y),r=0,o=E.length;r<o;++r)i=r*(1/(o-1)),n.addColorStop(i,E[r]);return n}},se=!1,ce={name:"debugDrawComponent",draw:function(e){var i,r,o=new t(0,0),a=new t(0,0);!c.drawDebug&&!q||null===u&&null===h||(i=e.entity,o.x=le.origin.x/i.dimension.width,o.y=le.origin.y/i.dimension.height,a=le.origin.clone(),null!==u&&(a.x=o.x*u),null!==h&&(a.y=o.y*h),r=new n(-1*a.x||0,-1*a.y||0,u||i.dimension.width,h||i.dimension.height),e.renderer.fillRect([0,0,1,.25],r.x,r.y,r.width,r.height),null!==u&&(e.renderer.drawLine([0,0,1,.5],r.x,r.y,r.x,r.y+r.height,1),e.renderer.drawLine([0,0,1,.5],r.x+r.width,r.y,r.x+r.width,r.y+r.height,1)),null!==h&&(e.renderer.drawLine([0,0,1,.5],r.x,r.y,r.x+r.width,r.y,1),e.renderer.drawLine([0,0,1,.5],r.x,r.y+r.height,r.x+r.width,r.y+r.height,1)))},start:function(){p||(se||c.generateOnConstructor?ne():(p||(p=te(),f=p.getContext("2d")),se=!0,ee(l)))},destroy:function(){c.disposeCanvas&&p&&(p.dispose&&p.dispose(),p.texture&&p.texture.destroy&&p.texture.destroy(),p=null,m=null)},update:function(){$&&($-=1),!Q&&$>600&&!c.suppressWarnings&&(Q=!0,console.warn("PERFORMANCE WARNING: for the past 600 frames this Text module has been updating all the time.",v))}},le=new o({image:m}),ue=new i({name:"sharpnessScaler",scale:new t(V,V),components:[ce,le]}),he=r.extend({z:0,name:"text",position:new t(0,0)},l,!0);return he.components=l.components||[],he.components=[ue].concat(he.components||[]),v=new i(he).extend({getCanvas:function(){return p},getText:function(){return y},getStrings:function(){return F},setText:function(e,t){var n;if(T=M,t&&ee(t),y=e,oe(),!s(u)||!s(h))if(n=r.checksum(e+"_"+u+"_"+h),r.isDefined(X[n]))T=X[n],oe();else{for(;T>0&&(!s(u)&&z>u||!s(h)&&G>h);)T-=1,oe();X[n]=T}return ne(),T/j},getEffectiveFontSize:function(){return T/j},generateText:function(e){return ee(l),ne(e)}}),c.generateOnConstructor&&(p||(p=te(),f=p.getContext("2d")),ee(l)),v};return c.drawDebug=!1,c.disposeCanvas=!0,c.generateOnConstructor=!1,c.suppressWarnings=!1,c.defaultSharpness=4,c}),bento.define("bento/gui/togglebutton",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/utils","bento/tween","bento/eventsystem"],function(e,t,n,i,r,o,a,s,c){"use strict";return function(n){e.getViewport();var s=!0,l=!1,u=n.animations||{up:{speed:0,frames:[0]},down:{speed:0,frames:[1]}},h=n.sprite||new i({image:n.image,imageName:n.imageName,originRelative:n.originRelative||new t(.5,.5),padding:n.padding,frameWidth:n.frameWidth,frameHeight:n.frameHeight,frameCountX:n.frameCountX,frameCountY:n.frameCountY,animations:u}),d=new r({sort:n.sort,ignorePauseDuringPointerUpEvent:n.ignorePauseDuringPointerUpEvent,onClick:function(e){s&&(h.setAnimation("down"),c.fire("toggleButton-toggle-down",{entity:f,event:"onClick",data:e}))},onHoldEnter:function(e){s&&(h.setAnimation("down"),c.fire("toggleButton-toggle-down",{entity:f,event:"onHoldEnter",data:e}))},onHoldLeave:function(e){s&&(h.setAnimation(l?"down":"up"),c.fire("toggleButton-toggle-"+(l?"down":"up"),{entity:f,event:"onHoldLeave",data:e}))},pointerUp:function(e){s&&(h.setAnimation(l?"down":"up"),c.fire("toggleButton-toggle-"+(l?"down":"up"),{entity:f,event:"pointerUp",data:e}))},onHoldEnd:function(t){s&&(l=!l,n.onToggle&&(n.onToggle.apply(f),n.sfx&&(e.audio.stopSound(n.sfx),e.audio.playSound(n.sfx))),h.setAnimation(l?"down":"up"),c.fire("toggleButton-onToggle",{entity:f,event:"onHoldEnd",data:t}))}}),p=a.extend({z:0,name:"toggleButton",position:new t(0,0),family:["buttons"]},n);p.components=[h,d].concat(n.components||[]);var f=new o(p).extend({isToggled:function(){return l},toggle:function(t,i){l=a.isDefined(t)?t:!l,i&&n.onToggle&&(n.onToggle.apply(f),n.sfx&&(e.audio.stopSound(n.sfx),e.audio.playSound(n.sfx))),h.setAnimation(l?"down":"up")},setActive:function(e){!(s=e)&&u.inactive?h.setAnimation("inactive"):h.setAnimation(l?"down":"up")},doCallback:function(){n.onToggle.apply(f)},mimicClick:function(){s&&f.toggle(!l,!0)},isActive:function(){return s}});return a.isDefined(n.active)&&(s=n.active),n.toggled&&(l=!0),u=h.animations||u,!s&&u.inactive?h.setAnimation("inactive"):h.setAnimation(l?"down":"up"),f.attach({name:"attachComponent",start:function(){c.fire("toggleButton-start",{entity:f})},destroy:function(){c.fire("toggleButton-destroy",{entity:f})}}),Object.defineProperty(f,"active",{get:function(){return s},set:f.setActive}),f}}),bento.define("bento/maskedcontainer",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/eventsystem","bento/gui/clickbutton","bento/gui/counter","bento/gui/text","bento/utils","bento/tween"],function(e,t,n,i,r,o,a,s,c,l,u,h){"use strict";return function(t){e.getViewport();var i,r=t.components||[],a=function(e){var t,r=i.getBoundingBox();if(this.currentAnimation&&this.visible){var o=e.entity;this.updateFrame(),t=new n(0|-this.origin.x,0|-this.origin.y,this.frameWidth,this.frameHeight);var a=i.toWorldPosition(r.getCorner(n.TOPLEFT)),s=i.toWorldPosition(r.getCorner(n.BOTTOMRIGHT)),c=o.toLocalPosition(a),l=o.toLocalPosition(s),u=new n(c.x,c.y,l.x-c.x,l.y-c.y).intersection(t);(u.width||u.height)&&e.renderer.drawImage(this.spriteImage,this.sourceX+(u.x-t.x),this.sourceY+(u.y-t.y),u.width,u.height,u.x,u.y,u.width,u.height)}},s=function(e){u.forEach(e,function(e,t,n,i){e.components&&s(e.components),"sprite"===e.name&&e.draw!==a&&(e.draw=a)})},c={name:"componentWatcher",start:function(){s(r)},update:function(){t.watchComponents&&s(r)}};return r.push(c),i=new o(t)}}),bento.define("bento/objectpool",["bento","bento/utils"],function(e,t){"use strict";return function(e){var n=[],i=!1,r=e.constructor,o=e.destructor,a=function(){n.push(r())};if(!r)throw"Error: Must pass a settings.constructor function that returns an object";if(!o)throw"Error: Must pass a settings.destructor function that cleans the object";return{get:function(){return 0===n.length&&a(),n.pop()},discard:function(e){o(e),n.push(e)},init:function(){i||(i=!0,t.repeat(e.poolSize||0,a))}}}}),bento.define("bento/screen",["bento/utils","bento","bento/math/rectangle","bento/math/vector2","bento/tiled"],function(e,t,n,i,r){"use strict";return function(n){var i=t.getViewport(),o={name:null,tiled:null,dimension:n&&n.dimension?n.dimension:i.clone(),extend:function(t){return e.extend(this,t)},loadTiled:function(e){this.tiled=new r({assetName:e,spawnBackground:!0,spawnEntities:!0}),this.dimension=this.tiled.dimension},onShow:function(e){n&&(n.tiled&&this.loadTiled(n.tiled),n.onShow&&n.onShow.call(o,e))},onHide:function(e){var i=t.getViewport();n.onHide&&n.onHide.call(o,e),i.x=0,i.y=0,t.removeAll(),n.onHidden&&n.onHidden.call(o,e),t.objects.resume()}};return o}}),bento.define("bento/sortedeventsystem",["bento","bento/eventsystem","bento/utils"],function(e,t,n){var i=function(t){var n,i,r=-1,a=-1,s=t.parent,c=-1,l=[],u=null;if(null===o&&(o=e.objects.getObjects()),s)for(r=t.rootIndex,s.parent&&(c=s.rootIndex);s;)l.unshift(s),a+=1,s.parent||(u=s),s=s.parent;else u=t;n=u.rootIndex,i=u.z,this.isDirty=!1,this.component=t,this.parent=s,this.parentIndex=c,this.parents=l,this.componentIndex=r,this.depth=a,this.rootParent=u,this.rootIndex=n,this.rootZ=i},r=!1,o=null,a={},s=[],c=function(){var e,t,i,o,c,l,u;if(!r){for(t=0,i=s.length;t<i;++t)if(c=s[t].eventName,!0!==s[t].reset){if(l=s[t].callback,u=s[t].context,!n.isUndefined(a[c]))for(e=(o=a[c]).length-1;e>=0;--e)if(o[e].callback===l){if(!u){a[c].splice(e,1);break}if(o[e].context===u){a[c].splice(e,1);break}}}else a[c]=[];s=[]}},l=function(e,t,r,o){var s=new i(e);n.isString(e)?n.log("ERROR: First parameter of SortedEventSystem.on is the component!"):(n.isUndefined(a[t])&&(a[t]=[]),a[t].push({sortingData:s,callback:r,context:o}))},u=function(e,t,n){var i=a[e];i&&0!==i.length&&(s.push({eventName:e,callback:t,context:n}),r||c())},h=function(e,t){var n=e.sortingData,r=t.sortingData;if(n.isDirty&&(e.sortingData=new i(n.component),n=e.sortingData),r.isDirty&&(t.sortingData=new i(r.component),r=t.sortingData),n.component===r.component)return 0;var o=r.rootZ-n.rootZ;if(o)return o;var a=r.rootIndex-n.rootIndex;if(a)return a;var s=n.component.parent,c=r.component.parent;return s===c?r.componentIndex-n.componentIndex:s&&c&&s.parent===c.parent?r.parentIndex-n.parentIndex:n.parents.indexOf(r.component.parent)>=0||r.parents.indexOf(n.component.parent)>=0?r.depth-n.depth:d(n,r)},d=function(e,t){var n,i,r,o=e.parents,a=t.parents,s=Math.min(o.length,a.length),c=null;for(n=0;n<s;++n){if(o[n]!==a[n]){i=o[n],r=a[n];break}c=o[n]}return c&&c.components?c.components.indexOf(r)-c.components.indexOf(i):0},p=function(e){n.stableSort.inplace(e,h)},f=!1,m={suppressWarnings:!1,stopPropagation:function(){f=!0},fire:function(e,t){var i,o,s,l;if(f=!1,c(),n.isString(e)||(e=e.toString()),!n.isUndefined(a[e])){for(function(e){var t,n=0,i=e.length;for(n=0;n<i;++n)(t=e[n].sortingData).rootZ!==t.rootParent.z&&(t.isDirty=!0),t.rootIndex=t.rootParent.rootIndex}(s=a[e]),p(s),i=0,o=s.length;i<o;++i)if(r=!0,(l=s[i])?l.context?l.callback.apply(l.context,[t]):l.callback(t):this.suppressWarnings,f){f=!1;break}r=!1}},addEventListener:l,removeEventListener:u,on:l,off:u,clear:function(e){var t=a[e];t&&0!==t.length&&(s.push({eventName:e,reset:!0}),r||c())},sortListeners:p};return t.SortedEventSystem=m,m}),bento.define("bento/tiled",["bento","bento/entity","bento/components/sprite","bento/math/vector2","bento/math/rectangle","bento/math/polygon","bento/packedimage","bento/utils","bento/tiledreader"],function(e,t,n,i,r,o,a,s,c){"use strict";var l={},u={},h=function(t,n){var r=Math.ceil(n.x/t.x),o=Math.ceil(n.y/t.y),a=(t.x,t.y,{length:0}),c=function(n,i){var s=Math.floor(i.x/t.x)%r+Math.floor(i.y/t.y)%o*r;return a[n]||function(n){var i,s,c,l=[];for(i=0;i<r*o;++i)(s=e.createCanvas()).width=t.x,s.height=t.y,c=s.getContext("2d"),s.context=c,l.push(s);a[n]=l,a.length=Math.max(a.length,n+1)}(n),{index:s,canvas:a[n][s]}};return{spritesCountX:r,spritesCountY:o,canvasSize:t,layers:a,drawn:!1,getSpritesFromLayer:function(e){return a[e]},drawTile:function(e,n,o,a,s,l,u,h){var d,p,f=c(e,n),m=f.canvas,g=f.index,v=m.context,y=!1,b=!1,w=0,x=0,E=0,S=new i(t.x*(g%r),t.y*Math.floor(g/r));u?s||l?s&&!l?w=Math.PI/2:!s&&l?w=3*Math.PI/2:s&&l&&(w=Math.PI/2,y=!0):(w=Math.PI/2,b=!0):s&&l?w=Math.PI:(y=s,b=l),x+=n.x-S.x,E+=n.y-S.y,x+=o.width/2,E+=o.height/2,d=y?-1:1,p=b?-1:1,v.translate(x,E),v.rotate(w),v.scale(d,p),v.translate(-o.width/2,-o.height/2),void 0!==h&&(v.globalAlpha=h),v.drawImage(a.image,a.x+o.x,a.y+o.y,o.width,o.height,0,0,n.width,n.height),v.globalAlpha=1,v.translate(o.width/2,o.height/2),v.scale(1/d,1/p),v.rotate(-w),v.translate(-x,-E)},dispose:function(){s.forEach(a,function(e){e.length&&s.forEach(e,function(e){e&&(e.dispose&&e.dispose(),e.texture&&e.texture.destroy&&e.texture.destroy())})})}}};return function(o){var d=o.assetName,p=!s.isDefined(o.drawTiles)||o.drawTiles,f=o.tiled||e.assets.getJson(d),m=f.width||0,g=f.height||0,v=f.tilewidth||0,y=f.tileheight||0,b=f.properties||{},w=o.merge||!1,x=o.onInit,E=o.onLayer,S=o.onTile,_=o.onObject,T=o.onComplete,M=o.onSpawn,C=o.onSpawnComplete,A=o.onLayerMergeCheck,R=o.cacheModules||!1,P=o.cacheCanvas||!1,I=s.getDefault(o.attachEntities,!0),L=o.offset||new i(0,0),D=o.maxCanvasSize||new i(1024,1024),O=new i(m*v,g*y),k=-1,F=function(e,t,n){var i=u[e];return i||new h(t,n)}(d,D,O),B=[],N=[],U=0,z=0,G=1,H=0,j=new c({tiled:f,onInit:x,onExternalTileset:function(t){var n,i=t.indexOf("json/"),r=t.indexOf("../"),o=t;if(i>=0)o=t.substring(i+"json/".length);else if(r>=0)if(o=t,d){for((n=d.split("/")).pop();o.indexOf("../")>=0;){if(0===n.length)throw"ERROR: Impossible path to external tileset";n.pop(),o=o.replace("../","")}o=n.join("/")+(n.length?"/":"")+o}else for(;o.indexOf("../")>=0;)o=o.replace("../","");return o=o.replace(".json",""),e.assets.getJson(o)},onLayer:function(e,t){var n=!1;H=t,"tilelayer"===e.type&&(w?k=9999:(A&&(n=A(e)),k=n?9999:t)),G=e.opacity,E&&E.call(Y,e,t)},onTile:F.drawn||!p?null:function(t,n,i,o,a,s,c){var l,u,h=new r(t*v,n*y,v,y),d=X(i,o),p=i.image;l=(l=p.substring(p.indexOf("images/")+"images/".length)).replace(".png",""),u=e.assets.getImage(l),F.drawTile(k,h,d,u,a,s,c,G),S&&S.call(Y,t,n,i,o,a,s,c,H)},onObject:function(e,t,n,i,r,a){_&&_.call(Y,e,t,n,i,r,a,H),o.spawnEntities&&q(e,t,n,H,function(){})},onComplete:function(){var r,s,c=F.layers,l=c.length,h=F.canvasSize,p=F.spritesCountX,m=(F.spritesCountY,function(){var c,l,u,d=0,m=f.layers[s];for(d=0;d<r.length;++d)c=r[d],l=new n({image:new a(c)}),u=new t({z:0,name:m&&m.name||"tiledLayer",family:["backgrounds"],position:new i(L.x+h.x*(d%p),L.y+h.y*Math.floor(d/p)),components:[l]}),o.spawnBackground&&e.objects.attach(u),N.push(u)});for(s=0;s<l;++s)(r=c[s])&&m();P&&(F.drawn=!0,u[d]=F),T&&T.call(Y),V=!0,W()}}),V=!1,W=function(){V&&U===z&&C&&C.call(Y)},X=function(e,t){var n=Math.floor(e.imagewidth/e.tilewidth);return Math.floor(e.imageheight/e.tileheight),new r(t%n*e.tilewidth,Math.floor(t/n)*e.tileheight,e.tilewidth,e.tileheight)},q=function(t,n,r,o,a){var c,u,h,p={},f={},m={paths:[],parameters:[]},g=t.x,v=t.y,y=function(e){var t="",n="",i="",r=-1;for(t in e)t.indexOf("component")>-1&&(r=t.indexOf("."),n=t.slice(0,-1===r?void 0:r),p[n]||(p[n]={}),r>-1?(i=t.slice(r+1),p[n][i]=e[t]):p[n].pathToComponent=e[t])},b=function(){var r=arguments[0],s=new r(m.parameters[0]),c=s.dimension,d=new i(0,0),p=1,f=arguments.length;for(s.getComponent("sprite",function(e){d=e.origin}),s.position=new i(L.x+g+d.x,L.y+v+(d.y-c.height));p<f;++p)s.attach(new arguments[p](m.parameters[p]));I&&e.objects.attach(s),B.push(s),U+=1,M&&M.call(Y,s,t,{tileSet:n,moduleName:h,properties:u},o),a.call(Y,s,t,{tileSet:n,moduleName:h,properties:u},o),R&&(l[h]=Array.prototype.slice.call(arguments)),W()};t.gid&&(c=n.tileproperties)&&(u=c[r])&&(h=u.module)&&(m.paths.push(h),f={position:new i(g,v),tileSet:n,tileIndex:r,tileProperties:u,object:t,objectProperties:t.properties,jsonName:d},m.parameters.push({tiled:f}),y(u),y(t.properties),function(){var e,t="",n="",i={};for(n in p){for(t in i={tiled:f},e=p[n])"pathToComponent"!==t&&(i[t]=e[t]);m.paths.push(e.pathToComponent),m.parameters.push(s.cloneJson(i))}}(),z+=1,R&&l[h]?b.apply(this,l[h]):bento.require(m.paths,b))},Y={name:o.name||"tiled",assetName:d,mapProperties:b,json:f,dimension:new r(0,0,O.x,O.y),entities:B,backgrounds:N,layerImages:F,clearModuleCache:function(){l={}},clearCanvasCache:function(){s.forEach(u,function(e){e.dispose()}),u={}},destroy:function(){P&&F.dispose()},spawnEntity:q};return j.read(),Y}}),bento.define("bento/tiledreader",[],function(){"use strict";var e=2147483648,t=1073741824;return function(n){var i=n.onExternalTileset,r=n.onInit,o=n.onLayer,a=n.onTile,s=n.onObject,c=n.onComplete,l=n.tiled||{},u=l.width||0,h=l.height||0,d=(l.tilewidth,l.tileheight,l.tilesets||[]),p=d.length,f={},m=[],g=((l.layers||[]).length,function(e){var t=e.encoding;if("base64"===t)e.data=function(e){var t,n=window.atob(e),i=n.length,r=new Uint8Array(i);for(t=0;t<i;t++)r[t]=n.charCodeAt(t);return new Uint32Array(r.buffer,0,i/4)}(e.data),e.encoding=null;else if(t)throw"ERROR: compression not supported. Please set Tile Layer Format to CSV in Tiled.";return e});return function(){var e,t,n,r;for(e=0,t=d.length;e<t;++e)(r=(n=d[e]).source)&&(f[r]=i(r)),m.push(n.firstgid)}(),r&&r(l,f),{read:function(){var n,i,r,v,y,b,w,x,E,S,_,T,M,C,A,R,P,I=l.layers,L=function(e){var t,n,i,r=p,o=null;for(t=0;t<r;++t)(n=m[t])<=e&&(o=d[t],i=n);return o.source&&(o=f[o.source]),{tileSet:o,firstGid:i}},D=function(n){var i,r,o,a,c,l=n.gid;l?(o=l&e,a=l&t,c=536870912&l,r=(l&=536870911)-(i=L(l)).firstGid,s(n,i.tileSet,r,o,a,c)):s(n)};for(v=0,y=I.length;v<y;++v)if(E=(b=I[v]).type,o&&o(b,v),"tilelayer"===E&&a){if(!b.visible)continue;for(g(b),w=b.data,r=0;r<h;++r)for(n=0;n<u;++n)T=void 0,M=void 0,C=void 0,A=void 0,R=void 0,P=void 0,0!==(P=w[(_=r)*u+(S=n)])&&(C=P&e,A=P&t,R=536870912&P,M=(P&=536870911)-(T=L(P)).firstGid,a(S,_,T.tileSet,M,C,A,R))}else if("objectgroup"===E&&s)for(i=(x=b.objects||[]).length,n=0;n<i;++n)D(x[n]);c&&c()}}}}),bento.define("bento/tween",["bento","bento/math/vector2","bento/utils","bento/entity"],function(e,t,n,i){"use strict";var r=new Object({easeInQuad:function(e,t,n,i){return n*(e/=i)*e+t},easeOutQuad:function(e,t,n,i){return-n*(e/=i)*(e-2)+t},easeInOutQuad:function(e,t,n,i){return(e/=i/2)<1?n/2*e*e+t:-n/2*(--e*(e-2)-1)+t},easeInCubic:function(e,t,n,i){return n*(e/=i)*e*e+t},easeOutCubic:function(e,t,n,i){return n*((e=e/i-1)*e*e+1)+t},easeInOutCubic:function(e,t,n,i){return(e/=i/2)<1?n/2*e*e*e+t:n/2*((e-=2)*e*e+2)+t},easeInQuart:function(e,t,n,i){return n*(e/=i)*e*e*e+t},easeOutQuart:function(e,t,n,i){return-n*((e=e/i-1)*e*e*e-1)+t},easeInOutQuart:function(e,t,n,i){return(e/=i/2)<1?n/2*e*e*e*e+t:-n/2*((e-=2)*e*e*e-2)+t},easeInQuint:function(e,t,n,i){return n*(e/=i)*e*e*e*e+t},easeOutQuint:function(e,t,n,i){return n*((e=e/i-1)*e*e*e*e+1)+t},easeInOutQuint:function(e,t,n,i){return(e/=i/2)<1?n/2*e*e*e*e*e+t:n/2*((e-=2)*e*e*e*e+2)+t},easeInSine:function(e,t,n,i){return-n*Math.cos(e/i*(Math.PI/2))+n+t},easeOutSine:function(e,t,n,i){return n*Math.sin(e/i*(Math.PI/2))+t},easeInOutSine:function(e,t,n,i){return-n/2*(Math.cos(Math.PI*e/i)-1)+t},easeInExpo:function(e,t,n,i){return 0===e?t:n*Math.pow(2,10*(e/i-1))+t},easeOutExpo:function(e,t,n,i){return e===i?t+n:n*(1-Math.pow(2,-10*e/i))+t},easeInOutExpo:function(e,t,n,i){return 0===e?t:e===i?t+n:(e/=i/2)<1?n/2*Math.pow(2,10*(e-1))+t:n/2*(2-Math.pow(2,-10*--e))+t},easeInCirc:function(e,t,n,i){return-n*(Math.sqrt(1-(e/=i)*e)-1)+t},easeOutCirc:function(e,t,n,i){return n*Math.sqrt(1-(e=e/i-1)*e)+t},easeInOutCirc:function(e,t,n,i){return(e/=i/2)<1?-n/2*(Math.sqrt(1-e*e)-1)+t:n/2*(Math.sqrt(1-(e-=2)*e)+1)+t},easeInElastic:function(e,t,n,i){var r=1.70158,o=0,a=n;return 0===e?t:1==(e/=i)?t+n:(o||(o=.3*i),a<Math.abs(n)?(a=n,r=o/4):r=o/(2*Math.PI)*Math.asin(n/a),-a*Math.pow(2,10*(e-=1))*Math.sin((e*i-r)*(2*Math.PI)/o)+t)},easeOutElastic:function(e,t,n,i){var r=1.70158,o=0,a=n;return 0===e?t:1==(e/=i)?t+n:(o||(o=.3*i),a<Math.abs(n)?(a=n,r=o/4):r=o/(2*Math.PI)*Math.asin(n/a),a*Math.pow(2,-10*e)*Math.sin((e*i-r)*(2*Math.PI)/o)+n+t)},easeInOutElastic:function(e,t,n,i){var r=1.70158,o=0,a=n;return 0===e?t:2==(e/=i/2)?t+n:(o||(o=i*(.3*1.5)),a<Math.abs(n)?(a=n,r=o/4):r=o/(2*Math.PI)*Math.asin(n/a),e<1?a*Math.pow(2,10*(e-=1))*Math.sin((e*i-r)*(2*Math.PI)/o)*-.5+t:a*Math.pow(2,-10*(e-=1))*Math.sin((e*i-r)*(2*Math.PI)/o)*.5+n+t)},easeInBack:function(e,t,n,i,r){return void 0===r&&(r=1.70158),n*(e/=i)*e*((r+1)*e-r)+t},easeOutBack:function(e,t,n,i,r){return void 0===r&&(r=1.70158),n*((e=e/i-1)*e*((r+1)*e+r)+1)+t},easeInOutBack:function(e,t,n,i,r){return void 0===r&&(r=1.70158),(e/=i/2)<1?n/2*(e*e*((1+(r*=1.525))*e-r))+t:n/2*((e-=2)*e*((1+(r*=1.525))*e+r)+2)+t},easeInBounce:function(e,t,n,i){return n-this.easeOutBounce(i-e,0,n,i)+t},easeOutBounce:function(e,t,n,i){return(e/=i)<1/2.75?n*(7.5625*e*e)+t:e<2/2.75?n*(7.5625*(e-=1.5/2.75)*e+.75)+t:e<2.5/2.75?n*(7.5625*(e-=2.25/2.75)*e+.9375)+t:n*(7.5625*(e-=2.625/2.75)*e+.984375)+t},easeInOutBounce:function(e,t,n,i){return e<i/2?.5*this.easeInBounce(2*e,0,n,i)+t:.5*this.easeOutBounce(2*e-i,0,n,i)+.5*n+t}}),o=new Object({linear:function(e,t,n,i,r){return(t-e)*n+e},quadratic:function(e,t,n,i,r){return(t-e)*n*n+e},squareroot:function(e,t,n,i,r){return(t-e)*Math.pow(n,.5)+e},cubic:function(e,t,n,i,r){return(t-e)*n*n*n+e},cuberoot:function(e,t,n,i,r){return(t-e)*Math.pow(n,1/3)+e},exponential:function(e,t,n,i,r){return(t-e)/(Math.exp(i)-1)*Math.exp(i*n)+e-(t-e)/(Math.exp(i)-1)},elastic:function(e,t,n,i,r){return(t-e)/(Math.exp(i)-1)*Math.cos(r*n*2*Math.PI)*Math.exp(i*n)+e-(t-e)/(Math.exp(i)-1)},sin:function(e,t,n,i,r){return e+t*Math.sin(i*n*2*Math.PI)},cos:function(e,t,n,i,r){return e+t*Math.cos(i*n*2*Math.PI)}}),a=function(i){var a,s=0,c=!i.wait,l=i.onUpdate||i.do,u=i.onComplete,h=i.onCreate,d=i.onStart,p=i.applyOnDelay,f=!1,m=i.ease||"linear",g=i.from||0,v=i.delay||0,y=0,b=n.isDefined(i.to)?i.to:1,w=i.in||1,x=n.isDefined(i.alpha)?i.alpha:1,E=n.isDefined(i.beta)?i.beta:1,S=i.ignoreGameSpeed,_=i.stay,T=-1,M=function(e,n,i){var a=o[e];return n.isVector2&&i.isVector2?a?function(e,n,i,r,o){return new t(a(e.x,n.x,i,r,o),a(e.y,n.y,i,r,o))}:(a=r[e],function(e,n,i,r,o){return new t(a(i,e.x,n.x-e.x,1),a(i,e.y,n.y-e.y,1))}):a?function(e,t,n,i,r){return a(e,t,n,i,r)}:(a=r[e],function(e,t,n,i,r){return a(n,e,t-e,1)})}(m,g,b),C=new Object({z:0,name:"tweenBehavior",start:function(e){h&&h.apply(a)},update:function(e){if(0==--T&&C.resume(),c){if(y<v)return y+=S?1:e.speed,void(p&&l&&l.apply(a,[M(g,b,0,x,E),0]));s+=S?1:e.speed,f||(f=!0,d&&d.apply(a)),l&&l.apply(a,[M(g,b,s/w,x,E),s]),s>=w&&!_&&(s>w&&l&&l.apply(a,[M(g,b,1,x,E),s]),u&&u.apply(a),C.removeSelf())}},attached:function(e){e.entity&&(a=e.entity)},begin:function(e){return s=0,c=!0,e&&(y=0),a},stop:function(){return s=0,c=!1,a},pause:function(e){return c=!1,e&&(T=e),a},resume:function(){return C.begin()},removeSelf:function(){a===C?e.objects.remove(C):a&&a.isEntity&&a.remove(C)}});return a=C,n.isDefined(i.decay)&&(x=-i.decay),n.isDefined(i.growth)&&(x=i.growth),n.isDefined(i.oscillations)&&(E=i.oscillations,"sin"!==i.ease&&"cos"!==i.ease||(x=i.oscillations)),n.isDefined(i.updateWhenPaused)?C.updateWhenPaused=i.updateWhenPaused:C.updateWhenPaused=e.objects.isPaused(),c&&C.begin(),C},s=function(t){var n=new a(t);return e.objects.attach(n),n};return s.TweenBehavior=a,s.LINEAR="linear",s.QUADRATIC="quadratic",s.CUBIC="cubic",s.SQUAREROOT="squareroot",s.CUBEROOT="cuberoot",s.EXPONENTIAL="exponential",s.ELASTIC="elastic",s.SIN="sin",s.COS="cos",s.EASEINQUAD="easeInQuad",s.EASEOUTQUAD="easeOutQuad",s.EASEINOUTQUAD="easeInOutQuad",s.EASEINCUBIC="easeInCubic",s.EASEOUTCUBIC="easeOutCubic",s.EASEINOUTCUBIC="easeInOutCubic",s.EASEINQUART="easeInQuart",s.EASEOUTQUART="easeOutQuart",s.EASEINOUTQUART="easeInOutQuart",s.EASEINQUINT="easeInQuint",s.EASEOUTQUINT="easeOutQuint",s.EASEINOUTQUINT="easeInOutQuint",s.EASEINSINE="easeInSine",s.EASEOUTSINE="easeOutSine",s.EASEINOUTSINE="easeInOutSine",s.EASEINEXPO="easeInExpo",s.EASEOUTEXPO="easeOutExpo",s.EASEINOUTEXPO="easeInOutExpo",s.EASEINCIRC="easeInCirc",s.EASEOUTCIRC="easeOutCirc",s.EASEINOUTCIRC="easeInOutCirc",s.EASEINELASTIC="easeInElastic",s.EASEOUTELASTIC="easeOutElastic",s.EASEINOUTELASTIC="easeInOutElastic",s.EASEINBACK="easeInBack",s.EASEOUTBACK="easeOutBack",s.EASEINOUTBACK="easeInOutBack",s.EASEINBOUNCE="easeInBounce",s.EASEOUTBOUNCE="easeOutBounce",s.EASEINOUTBOUNCE="easeInOutBounce",s.interpolations=o,s.interpolationsRP=r,s}),bento.define("bento/packedimage",["bento/math/rectangle"],function(e){return function(t,n){var i=n?new e(n.x,n.y,n.w,n.h):new e(0,0,t.width,t.height);return i.image=t,i}}),bento.define("bento/profiler",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/eventsystem","bento/utils","bento/tween"],function(e,t,n,i,r,o,a,s,c){"use strict";var l=0,u=0,h=0,d={},p={},f={},m=0,g=!1;return{reportAfter:10,start:function(){g=!0,u=window.performance.now()},stop:function(){h+=window.performance.now()-u,m+=1,this.reportAfter&&m>this.reportAfter&&(m=0,this.report()),g=!1},report:function(){var e;for(e in console.log("== Report for time spent =="),console.log("Total time:",h.toFixed(2)+"ms"),p)p.hasOwnProperty(e)&&console.log(e,"\n  "+p[e].toFixed(2)+"ms","\n  "+(p[e]/h*100).toFixed(0)+"%","\n  "+f[e]+" tics")},tic:function(e){g&&(e?(d[e]=window.performance.now(),p[e]=p[e]||0,f[e]=f[e]||0):l=window.performance.now())},toc:function(e,t){g&&(t&&(e?console.log(e,window.performance.now()-d[e]):console.log(window.performance.now()-l)),p[e]+=window.performance.now()-d[e],f[e]+=1)}}}),bento.define("bento/renderer",["bento/utils"],function(e){return function(t,n,i,r){var o={save:function(){},restore:function(){},setTransform:function(e,t,n,i,r,o){},translate:function(){},scale:function(e,t){},rotate:function(e){},fillRect:function(e,t,n,i,r){},fillCircle:function(e,t,n,i){},strokeRect:function(e,t,n,i,r){},drawLine:function(e,t,n,i,r,o){},drawImage:function(e,t,n,i,r,o,a,s,c){},begin:function(){},flush:function(){},setColor:function(){},getOpacity:function(){},setOpacity:function(){},createSurface:function(){},setContext:function(){},restoreContext:function(){}};bento.require([t],function(t){e.extend(o,t(n,i),!0),r(o)})}}),bento.define("bento/renderers/canvas2d",["bento/utils","bento/math/transformmatrix"],function(e,t){return function(n,i){var r=n.getContext("2d"),o=r,a=i.pixelSize||1,s=new t,c=[],l={name:"canvas2d",save:function(){c.push(s.clone())},restore:function(){c.pop().copyInto(s),h()},setTransform:function(e,t,n,i,r,o){s.a=e,s.b=t,s.c=n,s.d=i,s.tx=r,s.ty=o,h()},getTransform:function(){return s},translate:function(e,n){var i=new t;s.multiplyWith(i.translate(e,n)),h()},scale:function(e,n){var i=new t;s.multiplyWith(i.scale(e,n)),h()},rotate:function(e){var n=new t;s.multiplyWith(n.rotate(e)),h()},fillRect:function(e,t,n,i,o){var a=u(e),s=r.globalAlpha;1!==e[3]&&(r.globalAlpha*=e[3]),r.fillStyle=a,r.fillRect(t,n,i,o),1!==e[3]&&(r.globalAlpha=s)},fillCircle:function(e,t,n,i){var o=u(e),a=r.globalAlpha;1!==e[3]&&(r.globalAlpha*=e[3]),r.fillStyle=o,r.beginPath(),r.arc(t,n,i,0,2*Math.PI),r.fill(),r.closePath(),1!==e[3]&&(r.globalAlpha=a)},strokeRect:function(e,t,n,i,o,a){var s=u(e),c=r.globalAlpha;1!==e[3]&&(r.globalAlpha*=e[3]),r.lineWidth=a||0,r.strokeStyle=s,r.strokeRect(t,n,i,o),1!==e[3]&&(r.globalAlpha=c)},strokeCircle:function(e,t,n,i,o,a,s){var c=u(e);r.globalAlpha,o=o||0,a=a||0,1!==e[3]&&(r.globalAlpha*=e[3]),r.strokeStyle=c,r.lineWidth=s||0,r.beginPath(),r.arc(t,n,i,o,a,!1),r.stroke(),r.closePath()},drawLine:function(t,n,i,o,a,s){var c=u(t),l=r.globalAlpha;1!==t[3]&&(r.globalAlpha*=t[3]),e.isDefined(s)||(s=1),r.strokeStyle=c,r.lineWidth=s,r.beginPath(),r.moveTo(n,i),r.lineTo(o,a),r.stroke(),r.closePath(),1!==t[3]&&(r.globalAlpha=l)},drawImage:function(e,t,n,i,o,a,s,c,l){r.drawImage(e.image,e.x+t,e.y+n,i,o,a,s,c,l)},getOpacity:function(){return r.globalAlpha},setOpacity:function(e){r.globalAlpha=e},createSurface:function(e,t){var n,i=document.createElement("canvas");return i.width=e,i.height=t,n=i.getContext("2d"),{canvas:i,context:n}},setContext:function(e){r=e},restoreContext:function(){r=o},getContext:function(){return r},begin:function(){r===o&&1!==a&&(l.save(),l.scale(a,a))},flush:function(){r===o&&1!==a&&l.restore()}},u=function(e){var t="#";return t+=("00"+Math.floor(255*e[0]).toString(16)).slice(-2),t+=("00"+Math.floor(255*e[1]).toString(16)).slice(-2),t+("00"+Math.floor(255*e[2]).toString(16)).slice(-2)},h=function(){r.setTransform(s.a,s.b,s.c,s.d,s.tx,s.ty)};return l}}),bento.define("bento/renderers/pixi",["bento","bento/utils","bento/math/transformmatrix","bento/renderers/canvas2d"],function(e,t,n,i){var r=window.PIXI,o=function(e){var t;for(this.sprites=[],t=0;t<e;++t)this.sprites.push(new r.Sprite);this.index=0};o.prototype.reset=function(){this.index=0},o.prototype.getSprite=function(){var e=this.sprites[this.index];return e||(e=new r.Sprite,this.sprites.push(e)),this.index+=1,e};var a=function(e){var t;for(this.graphics=[],t=0;t<e;++t)this.graphics.push(new r.Graphics);this.index=0};return a.prototype.reset=function(){this.index=0},a.prototype.get=function(){var e=this.graphics[this.index];return e||(e=new r.Graphics,this.graphics.push(e)),
this.index+=1,e.clear(),e},function(s,c){var l,u,h,d,p,f=function(){try{return l=s.getContext("webgl")||s.getContext("experimental-webgl"),!!window.WebGLRenderingContext}catch(e){return!1}}(),m=[],g=1,v=1,y=c.pixelSize||1,b=new o(2e3),w=new a(500),x={worldTransform:null,worldAlpha:1,children:[]},E=function(){var e=new r.Matrix;return e.a=u.a,e.b=u.b,e.c=u.c,e.d=u.d,e.tx=u.tx,e.ty=u.ty,e},S=function(e){var t=w.get(),n=255*e[2]+(255*e[1]<<8)+(255*e[0]<<16),i=e[3];return t.beginFill(n,i),t.worldTransform=E(),t.worldAlpha=g,t},_={name:"pixi",init:function(){},destroy:function(){},save:function(){m.push(u.clone())},restore:function(){u=m.pop()},setTransform:function(e,t,n,i,r,o){u.a=e,u.b=t,u.c=n,u.d=i,u.tx=r,u.ty=o},getTransform:function(){return u},translate:function(e,t){var i=new n;u.multiplyWith(i.translate(e,t))},scale:function(e,t){var i=new n;u.multiplyWith(i.scale(e,t))},rotate:function(e){var t=new n;u.multiplyWith(t.rotate(e))},fillRect:function(e,t,n,i,r){var o=S(e);o.drawRect(t,n,i,r),h.setObjectRenderer(p),p.render(o)},fillCircle:function(e,t,n,i){var r=S(e);r.drawCircle(t,n,i),h.setObjectRenderer(p),p.render(r)},strokeRect:function(e,t,n,i,r,o){var a=w.get(),s=255*e[2]+(255*e[1]<<8)+(255*e[0]<<16),c=e[3];a.worldTransform=E(),a.worldAlpha=g,a.lineStyle(o,s,c),a.drawRect(t,n,i,r),h.setObjectRenderer(p),p.render(a)},strokeCircle:function(e,t,n,i,r,o,a){var s=w.get(),c=255*e[2]+(255*e[1]<<8)+(255*e[0]<<16),l=e[3];s.worldTransform=E(),s.worldAlpha=g,s.lineStyle(a,c,l).arc(t,n,i,r,o),h.setObjectRenderer(p),p.render(s)},drawLine:function(e,n,i,r,o,a){var s=S(e),c=255*e[2]+(255*e[1]<<8)+(255*e[0]<<16);t.isDefined(a)||(a=1),t.isDefined(e[3])||(e[3]=1),s.lineStyle(a,c,e[3]).moveTo(n,i).lineTo(r,o).endFill(),h.setObjectRenderer(p),p.render(s)},drawImage:function(t,n,i,o,a,s,c,l,p){var f,m,v=t.image,y=t.x,x=t.y,E=b.getSprite();y+n+o>v.width||x+i+a>v.height?console.error("Warning: image and frame size do not correspond.",v):(v.texture||(v.texture=new r.BaseTexture(v,e.getAntiAlias()?r.SCALE_MODES.LINEAR:r.SCALE_MODES.NEAREST),v.frame=new r.Texture(v.texture)),(f=(m=v.frame)._frame).x=y+n,f.y=x+i,f.width=o,f.height=a,m._updateUvs(),E._texture=m,_.save(),_.translate(s,c),_.scale(l/o,p/a),E.worldTransform=u,E.worldAlpha=g,h.setObjectRenderer(d),d.render(E),_.restore(),0===d.currentBatchSize&&(b.reset(),w.reset()))},begin:function(){d.start(),(1!==y||t.isCocoonJs())&&(this.save(),this.scale(y*v,y*v))},flush:function(){d.flush(),b.reset(),w.reset(),(1!==y||t.isCocoonJs())&&this.restore()},getOpacity:function(){return g},setOpacity:function(e){g=e},drawPixi:function(e){x.worldTransform=u,x.worldAlpha=g,e.parent=x,e.updateTransform(),e.renderWebGL(h)},getContext:function(){return l},getPixiRenderer:function(){return h},updateSize:function(){h.resize(s.width,s.height)}};return f&&t.isDefined(window.PIXI)?(u=new n,t.isCocoonJs()&&(v=t.getScreenSize().width*window.devicePixelRatio/s.width,s.width*=v,s.height*=v),(h=new r.WebGLRenderer(s.width,s.height,{view:s,backgroundColor:0,clearBeforeRender:!1})).filterManager.setFilterStack(h.renderTarget.filterStack),h._tempDisplayObjectParent,d=h.plugins.sprite,p=h.plugins.graphics,h.plugins.mesh,_):(window.PIXI?f||console.log("WARNING: WebGL not available, reverting to Canvas2D renderer"):console.log("WARNING: PIXI library is missing, reverting to Canvas2D renderer"),i(s,c))}}),bento.define("bento/transform",["bento","bento/math/vector2","bento/math/transformmatrix"],function(e,t,n){"use strict";var i=2*Math.PI,r=function(e){if(!(this instanceof r))return new r(e);this.worldTransform=new n,this.localTransform=new n,this.entity=e,this.oldAlpha=1,this.x=0,this.y=0,this.visible=!0};return r.prototype.draw=function(e){var t=this.worldTransform,n=this.localTransform,o=this.entity,a=o.alpha,s=o.position,c=o.rotation,l=o.scale,u=e.renderer,h=e.viewport,d=0,p=0,f=l.x,m=l.y;n.reset(),r.subPixel?(d+=s.x+this.x,p+=s.y+this.y):(d+=Math.round(s.x+this.x),p+=Math.round(s.y+this.y)),o.parent||o.float||(d+=-h.x,p+=-h.y),n.scale(f,m),o.rotation%i&&n.rotate(c),n.translate(d,p),this.oldAlpha=e.renderer.getOpacity(),u.getTransform().clone().copyInto(t),t.multiplyWith(n),u.save(),u.setTransform(t.a,t.b,t.c,t.d,t.tx,t.ty),u.setOpacity(this.oldAlpha*a)},r.prototype.postDraw=function(e){var t=e.renderer;t.setOpacity(this.oldAlpha),t.restore()},r.prototype.getWorldPosition=function(){return this.toWorldPosition(this.entity.position)},r.prototype.toWorldPosition=function(t){var r,o,a,s=this.entity,c=[],l=!1;if(!s.parent)return s.float?t.add(e.getViewport().getCorner()):t.clone();for(o=s;o.parent;)o=o.parent,c.push(o);for(c.length&&c[c.length-1].float&&(l=!0),r=s.float||l?t.add(e.getViewport().getCorner()):t.clone(),a=0;a<c.length;++a)o=c[a],(new n).scale(o.scale.x,o.scale.y).multiplyWithVector(r),o.rotation%i&&(new n).rotate(o.rotation).multiplyWithVector(r),(new n).translate(o.position.x,o.position.y).multiplyWithVector(r);return r},r.prototype.toLocalPosition=function(e){var t=this.toComparablePosition(e),r=this.entity,o=r.position,a=(new n).translate(-o.x,-o.y);return a.multiplyWithVector(t),r.rotation%i&&(a=(new n).rotate(-r.rotation)).multiplyWithVector(t),(a=(new n).scale(1/r.scale.x,1/r.scale.y)).multiplyWithVector(t),t},r.prototype.toComparablePosition=function(t){var r,o,a,s,c=this.entity,l=[],u=!1;if(!c.parent)return c.float?t.subtract(e.getViewport().getCorner()):t;for(a=c;a.parent;)a=a.parent,l.push(a);for(l.length&&l[l.length-1].float&&(u=!0),r=c.float||u?t.subtract(e.getViewport().getCorner()):t.clone(),s=l.length-1;s>=0;--s)o=(a=l[s]).position,(new n).translate(-o.x,-o.y).multiplyWithVector(r),a.rotation%i&&(new n).rotate(-a.rotation).multiplyWithVector(r),(new n).scale(1/a.scale.x,1/a.scale.y).multiplyWithVector(r);return r},r.subPixel=!0,r}),bento.define("bento/utils",[],function(){"use strict";var e,t,n,i,r=!1,o=Array.prototype.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},a=function(e,t,n,i){var r,o,s,c;for(r in t)t.hasOwnProperty(r)&&(e.hasOwnProperty(r)&&!n&&(e.base=e.base||{},(o={})[r]=e[r],a(e.base,o),i&&i(r)),s=t[r],c=void 0,c=s,"object"==typeof s&&null!==s&&function(){for(;null!==Object.getPrototypeOf(c=Object.getPrototypeOf(c)););return Object.getPrototypeOf(s)===c}()?e[r]=a({},t[r]):e[r]=t[r]);return e},s=(t=function(e,t){return n(e.slice(),t)},n=function(e,t){"function"!=typeof t&&(t=function(e,t){return String(e).localeCompare(t)});var n=e.length;if(n<=1)return e;for(var r=new Array(n),o=1;o<n;o*=2){i(e,t,o,r);var a=e;e=r,r=a}return e},i=function(e,t,n,i){var r,o,a,s,c,l=e.length,u=0,h=2*n;for(r=0;r<l;r+=h)for(a=(o=r+n)+n,o>l&&(o=l),a>l&&(a=l),s=r,c=o;;)if(s<o&&c<a)t(e[s],e[c])<=0?i[u++]=e[s++]:i[u++]=e[c++];else if(s<o)i[u++]=e[s++];else{if(!(c<a))break;i[u++]=e[c++]}},t.inplace=function(e,t){var r=n(e,t);return r!==e&&i(r,null,e.length,e),e},t),c=function(){var e,t={3:["cancel"],8:["backspace"],9:["tab"],12:["clear"],13:["enter"],16:["shift"],17:["ctrl"],18:["alt","menu"],19:["pause","break"],20:["capslock"],27:["escape","esc"],32:["space","spacebar"],33:["pageup"],34:["pagedown"],35:["end"],36:["home"],37:["left"],38:["up"],39:["right"],40:["down"],41:["select"],42:["printscreen"],43:["execute"],44:["snapshot"],45:["insert","ins"],46:["delete","del"],47:["help"],91:["command","windows","win","super","leftcommand","leftwindows","leftwin","leftsuper"],92:["command","windows","win","super","rightcommand","rightwindows","rightwin","rightsuper"],145:["scrolllock","scroll"],186:["semicolon",";"],187:["equal","equalsign","="],188:["comma",","],189:["dash","-"],190:["period","."],191:["slash","forwardslash","/"],192:["graveaccent","`"],195:["GamepadA"],196:["GamepadB"],197:["GamepadX"],198:["GamepadY"],199:["GamepadRightShoulder"],200:["GamepadLeftShoulder"],201:["GamepadLeftTrigger"],202:["GamepadRightTrigger"],203:["GamepadDPadUp"],204:["GamepadDPadDown"],205:["GamepadDPadLeft"],206:["GamepadDPadRight"],207:["GamepadMenu"],208:["GamepadView"],209:["GamepadLeftThumbstick"],210:["GamepadRightThumbstick"],211:["GamepadLeftThumbstickUp"],212:["GamepadLeftThumbstickDown"],213:["GamepadLeftThumbstickRight"],214:["GamepadLeftThumbstickLeft"],215:["GamepadRightThumbstickUp"],216:["GamepadRightThumbstickDown"],217:["GamepadRightThumbstickRight"],218:["GamepadRightThumbstickLeft"],7:["GamepadXboxButton"],219:["openbracket","["],220:["backslash","\\"],221:["closebracket","]"],222:["apostrophe","'"],48:["zero","0"],49:["one","1"],50:["two","2"],51:["three","3"],52:["four","4"],53:["five","5"],54:["six","6"],55:["seven","7"],56:["eight","8"],57:["nine","9"],96:["numzero","num0"],97:["numone","num1"],98:["numtwo","num2"],99:["numthree","num3"],100:["numfour","num4"],101:["numfive","num5"],102:["numsix","num6"],103:["numseven","num7"],104:["numeight","num8"],105:["numnine","num9"],106:["nummultiply","num*"],107:["numadd","num+"],108:["numenter"],109:["numsubtract","num-"],110:["numdecimal","num."],111:["numdivide","num/"],144:["numlock","num"],112:["f1"],113:["f2"],114:["f3"],115:["f4"],116:["f5"],117:["f6"],118:["f7"],119:["f8"],120:["f9"],121:["f10"],122:["f11"],123:["f12"],174:["volDown"],175:["volUp"]};for(e=65;e<=90;e+=1)t[e]=t[e]||[],t[e].push(String.fromCharCode(e+32));return t}();return e={isNativeIos:function(){return!(!navigator.isCocoonJS||!window.Cocoon||"ios"!==window.Cocoon.getPlatform())||!!(window.device&&window.device&&window.device.platform)&&"ios"===window.device.platform.toLowerCase()},isNativeAndroid:function(){var e;if(navigator.isCocoonJS&&window.Cocoon){if("android"===(e=window.Cocoon.getPlatform())||"amazon"===e)return!0}else if(window.device&&window.device&&window.device.platform)return"android"===window.device.platform.toLowerCase();return!1},forEach:function(t,n){var i,r,o=!1,a=function(){o=!0};if(e.isArray(t)){for(i=0,r=t.length;i<r;++i)if(n(t[i],i,r,a,t[i+1]),o)return}else for(i in r=e.getKeyLength(t),t)if(t.hasOwnProperty(i)&&(n(t[i],i,r,a),o))return},getDefault:function(e,t){return void 0!==e?e:t},getRandom:function(e){return Math.floor(Math.random()*e)},getRandomRange:function(e,t){var n=t-e;return e+Math.floor(Math.random()*n)},getRandomFloat:function(e){return Math.random()*e},getRandomRangeFloat:function(e,t){var n=t-e;return e+Math.random()*n},getScreenSize:function(){var e={width:0,height:0};return window.dapi?(e.width=window.dapi.getScreenSize().width,e.height=window.dapi.getScreenSize().height):window.mraid?(e.width=window.mraid.getMaxSize().width,e.height=window.mraid.getMaxSize().height):(e.width=window.innerWidth,e.height=window.innerHeight),e},toRadian:function(e){return e*Math.PI/180},toDegree:function(e){return e/Math.PI*180},sign:function(e){return e>0?1:e<0?-1:0},approach:function(e,t,n){return n=Math.abs(n),e<t?Math.min(e+n,t):Math.max(e-n,t)},repeat:function(t,n){var i,r,o;if("number"==typeof t?(r=t,o=n):(r=n,o=t),o.apply)for(i=0;i<r;++i)o(i,r);else e.log("Did not pass a function")},checksum:function(e){var t,n=0,i=(e||"").length;if(0===i)return n;for(t=0;t<i;++t)n=(n<<5)-n+e.charCodeAt(t),n&=n;return n},extend:a,getKeyLength:function(t){return t?Object.keys(t).length:(e.log("WARNING: object is "+t),0)},copyObject:function(e){var t,n={};for(t in e)e.hasOwnProperty(t)&&(n[t]=e[t]);return n},cloneJson:function(e){var t;try{t=JSON.parse(JSON.stringify(e))}catch(e){t={},console.log("WARNING: object cloning failed")}return t},removeFromArray:function(e,t){for(var n=e.indexOf(t),i=!1;n>=0;)e.splice(n,1),n=e.indexOf(t),i=!0;return i},isBetween:function(e,t,n,i){return i?e<=t&&t<=n:e<t&&t<n},pickRandom:function(){return arguments[this.getRandom(arguments.length)]},modulo:function(e,t){return(e%t+t)%t},pickRandomFrom:function(e){return e[this.getRandom(e.length)]},clamp:function(e,t,n){return Math.max(e,Math.min(t,n))},isApple:function(){var e=navigator.userAgent.match(/iPhone|iPad|iPod/i);return/iPhone/i.test(e)||/iPad/i.test(e)||/iPod/i.test(e)},isAndroid:function(){return/Android/i.test(navigator.userAgent)},isCocoonJS:function(){return navigator.isCocoonJS},isCocoonJs:function(){return navigator.isCocoonJS},isMobileBrowser:function(){var e,t=!1;return e=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego|android|ipad|playbook|silk).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0),t},isAndroidDevice:function(){return"android"===(window.device&&window.device.platform?window.device.platform.toLowerCase():"")},isIosDevice:function(){return"ios"===(window.device&&window.device.platform?window.device.platform.toLowerCase():"")},isAmazonDevice:function(){return(window.device&&window.device.platform?window.device.platform.toLowerCase():"").indexOf("amazon")>-1},setDev:function(e){r=e},isDev:function(){return r},log:function(e){console.error(e)},isString:function(e){return"string"==typeof e||e instanceof String},isArray:o,isObject:function(e){return"[object Object]"===Object.prototype.toString.call(e)},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)},isNumber:function(e){return"[object Number]"===Object.prototype.toString.call(e)},isBoolean:function(e){return!0===e||!1===e||"[object Boolean]"===Object.prototype.toString.call(e)},isInt:function(e){return parseFloat(e)===parseInt(e,10)&&!isNaN(e)},isUndefined:function(e){return void 0===e},isDefined:function(e){return void 0!==e},isEmpty:function(e){return null==e},isNotEmpty:function(e){return null!=e},stableSort:s,keyboardMapping:c,remoteMapping:{0:["A","a","click"],2:["X","x","play","pause"],12:["up"],13:["down"],14:["left"],15:["right"],16:["menu"]},gamepadMapping:{0:["A","a"],1:["B","b"],2:["X","x"],3:["Y","y"],4:["L1","l1"],5:["R1","r1"],6:["L2","l2"],7:["R2","r2"],8:["back","select"],9:["start"],10:["right-thumb","right-stick"],11:["left-thumb","left-stick"],12:["up"],13:["down"],14:["left"],15:["right"],16:["menu","home"]},SortMode:{ALWAYS:0,NEVER:1,SORT_ON_ADD:2}}}),bento.define("color",["bento/utils"],function(e){var t=function(t,n,i,r){return e.isDefined(r)||(r=255),{r:Math.round(t),g:Math.round(n),b:Math.round(i),a:Math.round(r),clone:function(){return Object.assign({},this)},equals:function(e){return this.r===e.r&&this.g===e.g&&this.b===e.b},equalsAlpha:function(e){return this.r===e.r&&this.g===e.g&&this.b===e.b&&this.a===e.a},toInt:function(){return Math.round(this.b)+(Math.round(this.g)<<8)+(Math.round(this.r)<<16)},toOldColor:function(){return[this.r/255,this.g/255,this.b/255,this.a/255]},toHex:function(){var e=function(e){var t=e.toString(16);return 1==t.length?"0"+t:t};return"#"+e(this.r)+e(this.g)+e(this.b)}}};return t.hsv=function(e,n,i,r){var o=function(e,t,n){var i,r,o,a,s,c,l,u;switch(c=n*(1-t),l=n*(1-(s=6*e-(a=Math.floor(6*e)))*t),u=n*(1-(1-s)*t),a%6){case 0:i=n,r=u,o=c;break;case 1:i=l,r=n,o=c;break;case 2:i=c,r=n,o=u;break;case 3:i=c,r=l,o=n;break;case 4:i=u,r=c,o=n;break;case 5:i=n,r=c,o=l}return{r:Math.round(255*i),g:Math.round(255*r),b:Math.round(255*o)}}(e,n,i);return new t(o.r,o.g,o.b,r)},t}),bento.define("colorswapper",["bento","bento/utils","color","bento/packedimage"],function(e,t,n,i){var r={};return t.isCocoonJs()&&window.Cocoon&&window.Cocoon.App&&window.Cocoon.App.on,function(e,o,a){var s=function(e){return t.isDefined(e)?t.isDefined(e.toHex)?e.toHex():o[0]:"#NONE"},c=e.image.src+"_"+e.x+"_"+e.y+"_"+s(o[0])+","+s(o[1])+","+s(o[2])+"_"+s(a[0])+","+s(a[1])+","+s(a[2]);if(r[c])return r[c];var l=document.createElement("canvas"),u=l.getContext("2d");l.width=e.width,l.height=e.height,u.fillStyle="rgba(0, 0, 0, 0)",u.fillRect(0,0,l.width,l.height),u.drawImage(e.image,e.x,e.y,e.width,e.height,0,0,e.width,e.height);for(var h=0;h<o.length;h++){for(var d=u.getImageData(0,0,e.width,e.height),p=0;p<d.data.length;p+=4){var f=new n(d.data[p],d.data[p+1],d.data[p+2],d.data[p+3]);if(f.a>.1&&("all"==o[h]||f.equals(o[h]))){var m=p/4,g=(e.width,Math.floor(m/e.width)),v=Math.random(),y={};switch(a[h]){case"darken":d.data[p]=d.data[p]*(35/255),d.data[p+1]=d.data[p+1]*(34/255),d.data[p+2]=d.data[p+2]*(108/255);break;case"hologram":y.val=.9+.2*v,d.data[p]=d.data[p]*y.val,d.data[p+1]=d.data[p+1]*y.val,d.data[p+2]=d.data[p+2]*y.val,d.data[p+3]=d.data[p+3]*y.val,g%2==0?(d.data[p]=1.1*d.data[p],d.data[p+1]=1.1*d.data[p+1],d.data[p+2]=1.75*d.data[p+2],d.data[p+3]=.75*d.data[p+3]):(d.data[p]=.9*d.data[p],d.data[p+1]=.9*d.data[p+1],d.data[p+2]=2*d.data[p+2],d.data[p+3]=d.data[p+3]),d.data[p+4]=d.data[p],d.data[p+5]=d.data[p+1],d.data[p+6]=d.data[p+2],d.data[p+7]=d.data[p+3],p+=4;break;default:d.data[p]=a[h].r,d.data[p+1]=a[h].g,d.data[p+2]=a[h].b}}}if(u.putImageData(d,0,0),"all"==o[h])break}var b=new i(l);return r[c]=b,l=null,u=null,b}}),window.VERSION="0.0.0",window.BUILD=0,window.VERSION="1.3.1",window.BUILD=73,bento.require.config&&bento.require.config({baseUrl:"js",waitSeconds:0}),window.startGame=function(){bento.require(["bento","bento/math/vector2","bento/math/rectangle","bento/tween","bento/autoresize","utils","modules/nativestorage","init"],function(e,t,n,i,r,o,a,s){var c;console.log("********************"),console.log("Bento v"+e.version),console.log("Game v"+window.VERSION+" b"+window.BUILD),console.log("Environment: "+(c="Web",navigator.isCocoonJS?(c="Cocoon",window.Cocoon&&(c+=" "+void 0)):window.cordova?(c="Cordova",window.device&&(c+=" "+window.device.platform)):window.FBInstant&&(c="FBInstant"),c)),console.log("********************"),e.saveState.setId("roadcrash/"),e.saveState.saveKeys=!0;var l=o.isNativeAndroid()?window.devicePixelRatio<3?3:6:5;e.setup({name:"crashcars",canvasId:"canvas",renderer:o.isCocoonJs()?"canvas2d":"pixi",pixelSize:l,antiAlias:!o.isNativeAndroid()||l<6,useDeltaT:!0,autoThrottle:!0,subPixel:!0,useQueries:!0,preventContextMenu:!0,responsiveResize:{lockedRotation:"portrait",minWidth:180,maxWidth:240,minHeight:320,maxHeight:390},globalMouseUp:!1,reload:{simple:"mouseDown-right",assets:"buttonDown-1",jump:"buttonDown-2"},screenshot:"buttonDown-q",dev:!1},function(){a.init({migrateFromLocalStorage:!0,onComplete:function(){s()}})})})},window.patchUrl="https://lucky-kat.s3.amazonaws.com/roadcrash/data",window.patchGame=function(){var e=!1;window.patcher(window.patchUrl,"v"+window.VERSION,function(t){t&&console.log("Ended with",t),e||(window.startGame(),e=!0)})},document.addEventListener("deviceready",function(){window.patchGame()},!1),function(){if(!navigator.isCocoonJS&&!window.cordova)if(window.mraid){var e=!1;"loading"===window.mraid.getState()?window.mraid.addEventListener("ready",function(){e||(window.startGame(),e=!0)}):(window.startGame(),e=!0)}else window.startGame()}(),bento.define("globals",["bento","bento/utils","bento/math/vector2"],function(e,t,n){"use strict";var i=0,r=1;return{pixelScaleUI:1/6,pixelScaleUIV:new n(1/6,1/6),tutorialRace:!1,maxCarRank:42,maxStage:6,speed:0,maxSpeed:0,distance:0,maxDistance:9999999,curveX:[],curveY:[],cornerForce:0,cornerCrash:0,crashes:0,standings:[],leaderboard:[],opponents:24,mainButtonFocus:0,freeCar:5,freeCarDialog:0,freeCarCooldown:!1,buffs:null,earningsChecked:!1,gameEarningsTime:180,watchingAd:!1,maximumSkippedAds:2,waitWithRewardScreen:!1,goodJob:!0,forceEarnings:!1,RaceLayers:{CAMERA:i++,BACKGROUND:i++,PLAYER:i++,JOYSTICKSOCKET:i++,JOYSTICK:i++,GUI:i++,PAUSESCREEN:i++},MergeLayers:{BACKGROUND:r++,MERGETILES:r++,MERGECARS:r++,MERGINGCARS:r++,MERGEFX:r++,MAINMENU:r++,EARNINGTEXT:r++,GHOST:r++,BUFFS:r++,BALLOON:r++,COINRAIN:r++,TUTORIALBACKGROUND:r++,TUTORIALOBJECTS:r++,TUTORIALHAND:r++,BUYMENU:r++,FREEUPGRADE:r++,FULLMESSAGE:r++,DIALOG:r++,CONFETTI:r++,IAPMENU:r++,IAPGEMS:r++,IAPOVERLAY:r++,CHEATMENU:r++},PauseLevels:{NONE:0,PAUSE:1,SYSTEM:2},user_guest:!0,auth:!1}}),bento.define("init",["bento","bento/math/vector2","bento/math/rectangle","bento/tween","bento/eventsystem","utils","modules/localization","materials/curvematerial","modules/tenjin","modules/errorhandler","modules/gameanalytics","modules/abtest","modules/savemanager","modules/taptic","modules/ironsource","bento/gui/clickbutton","managers/timemanager","modules/crosspromo/crosspromo","gui/general/iapoverlay","modules/cloudsave","bento/gui/text","modules/tenjinserverpurchase","managers/vipmanager","modules/firebaseanalytics","modules/mopub"],function(e,t,n,i,r,o,a,s,c,l,u,h,d,p,f,m,g,v,y,b,w,x,E,S,_){"use strict";return function(){var t,n,i=function(){r.fire("tabSwitch")};r.on("cordova-resume",function(){g.resumeEvent()}),r.on("touchcancel",function(){e.input.resetPointers(),m.currentlyPressing=null}),l.init({saveErrors:o.isDev()||d.load("isDev"),GaId:"UA-59807613-23",GaPrefix:"RoadCrash"}),g.initialize(),c.init({apiKey:"TVITWX4WGSZGBSL58QGWY7XLBYXIAK4B",onComplete:function(e){e&&o.log("Tenjin initialization failed: "+e),o.isNativeAndroid()&&c.setBannerAdListener&&r.on("onBannerView",function(e){c.setBannerAdListener(e.adUnitId,e.bannerViewId,function(){},function(){})})}}),r.on("Tenjin",function(e){var t=e.category||e.action||e.name||e.event;t?e.value?c.sendEventAndValue(t,e.value):c.sendEvent(t):o.log("Error: wrong Analytics parameters")}),S.init(),e.saveState.load(window.atob("aXNEZXY="),!1)?console.log("Did not initialize GameAnalytics because user is dev"):u.initialize("","9f4137c60e532c98c4e844b7ea8d3db070b11f95",["coins","gems"],["gameplay","shop","iapshop","noads","gempack"]),y.init({productIds:["roadcrash_gems1","roadcrash_gems2","roadcrash_gems3","roadcrash_noads","roadcrash_vip"],gameAnalyticsCartType:"iapshop",gameAnalyticsItemTypes:{roadcrash_gems1:"gempack",roadcrash_gems2:"gempack",roadcrash_gems3:"gempack",roadcrash_noads:"noads",roadcrash_vip:"vip"},bundleId:"com.gezellig.roadcrash",appleKey:"U2FsdGVkX1/pIFR0ZiN3c+BXj15qW8HUSdfkwt48H5SJIhvLoN9+JgCtJAnhDevMgg3e98rlngouok0bgQ7uag==",googleKey:"U2FsdGVkX1/Rzdm1ZuL2UHoANVJHhA5/HU0JIkq8oHoIQhXh2RwwK0ZuuB2mMNHMF06JdfpidehVOVvKqh+LXmYjEyr7xlltYgebiEVXqTBs/j+ATc6EGDiQl5W7blOuFF3eJUpofcQUOi/4dIEP8Uz0mBqyrsjBf0ad/d8049KY9yb4uU+7I5VPKBkzQxQisF8L99Q0Bz8DXVpR/e0DS14CgXcukJAksH/QM6hmCDOcu97DLqUfX1HKyywTQJgTNxyBc9znBNAjjSbU7Td4Tel7ZEYjvY5gtzPjaWdrlaGQMndSqQI6MhaURc4Gnt0P+4Vpr1qgXWpY8iq6QgCWGfhqET/UVRnVejIZbB9/rvP1S1bxmPqveQW2zCwyWY12gq/xCOrccNtrTHfYm7Z4jScstFYGih8xpbhrpzfvS3AQzHUqinYpXrvOwehs9bk0wuqms6c//wjNZgOp1/8F4j3V4XalKWK3FrrgK0nvShmNeB8+feZBuQWM9p15dRR4Ipr1N3jzGhQhi4zgFzMkSKYwhTP0+tIsPhfFSqqd2lo=",onPurchase:function(t){console.log("-----------------onPurchase---------------");var n=t.productId;e.saveState.save("purchased-"+n,!0),console.log("onPurchase: ",n),"roadcrash_noads"===n?d.save("noAds",!0):"roadcrash_vip"===n&&(e.saveState.save("VIP",!0),e.saveState.save("VipLastValidated",Math.floor(g.getTime()/E.getTimeSpan())),e.saveState.save("VipFailedValidations",0),r.fire("onVipChanged",!0))}}),E.init({productId:"roadcrash_vip"}),x.init({eventName:"IapValidation",productIds:["roadcrash_vip"]}),r.on("clickButton-onButtonDown",function(){p.impact({type:"light"})}),r.on("toggleButton-onToggle",function(){p.selection()}),e.getCanvas().addEventListener("webglcontextrestored",function(){window.location.reload(!0)},!1),o.isNativeIos()?(t="GameCenter",b.init({serviceName:t,cloudSaveId:"roadcrash",excludedKeys:["muteSound","muteMusic","muteHaptics","skippedAds","notificationsAsked","notificationsAllowed","notification1Day","notification2Day","notification1Week","notification2Week","crates","specialCrates"]}),b.login()):o.isNativeAndroid(),"hidden"in document?document.addEventListener("visibilitychange",function(){i(document.hidden)},!1):"mozHidden"in document?document.addEventListener("mozvisibilitychange",function(){i(document.mozHidden)},!1):"webkitHidden"in document?document.addEventListener("webkitvisibilitychange",function(){i(document.webkitHidden)},!1):"msHidden"in document?document.addEventListener("msvisibilitychange",function(){i(document.msHidden)},!1):"onpagehide"in window?(window.addEventListener("pagehide",function(){i()},!1),window.addEventListener("pageshow",function(){i()},!1)):"onblur"in document?(window.addEventListener("blur",function(){i()},!1),window.addEventListener("focus",function(){i()},!1)):"onfocusout"in document&&(window.addEventListener("focusout",function(){i()},!1),window.addEventListener("focusin",function(){i()},!1)),n=function(){e.assets.load("preloader",function(t){a.init(),e.isDev()||a.cleanUnusedAssets(),h.init(),w.defaultSharpness=6,e.screens.show("screens/preloader")})},_.init({appKey:o.isNativeIos()?"2b7fe493ad8748729d5bcdd5d7a9249b":"ffbc1eec520d468b8b653d9edad5cb84",rewardedId:o.isNativeIos()?"6dda7cc18ae740f7b35206d16d4dab7d":"293dccef38dd410bbfa5edf0e791589f",InterstitialId:o.isNativeIos()?"c361b519782244f1af94ca7a22d7beb2":"7fd492ce0e3749e1b7f0d819e6db63e4",bannerId:o.isNativeIos()?"40056bd925f54d869387a42267059f2a":"e9273aece1004fb695d820e5d91a3229",autoLoadInterstitials:!0,autoLoadRewarded:!0,autoLoadBanners:!0,debugLevel:"none",onComplete:function(e){e?console.log("Mopub error: "+e):console.log("MoPub Initialized!"),n&&n()}})}}),bento.define("utils",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/utils","bento/tween"],function(e,t,n,i,r,o,a,s){"use strict";var c,l,u=Math.PI,h=2*u,d={timeout:function(e,t){return new s({from:0,to:1,in:e,ease:"linear",onComplete:t})},dotProduct:function(e,t){var n=e.x-t.x,i=e.y-t.y;return n*n+i*i},degreeDifference:function(e,t){for(var n=e-t;n>180;)n-=360;for(;n<=-180;)n+=360;return n},radianDifference:function(e,t){for(var n=e-t;n>u;)n-=h;for(;n<=-u;)n+=h;return n},normalizeDegrees:function(e){return(360-e)%360},normalizeRadians:function(e){return(h-e)%h},prompt:function(e,t,n,i){if(a.isCocoonJS()&&window.Cocoon)window.Cocoon.Dialog.prompt({title:e,message:t},{success:n,cancel:function(){}});else{var r=window.prompt(t);r&&n(r)}},getBotName:function(t){var n;switch(c||(c=e.assets.getJson("botnames"),l=e.assets.getJson("botnamescountry")),t){case"cn":case"sg":t="zh";break;case"tw":t="zt"}var i=l[t];if(i)n=i[a.getRandom(i.length)];else{if(a.getRandom(2)){n=c.nouns[a.getRandom(c.nouns.length)];for(var r=a.getRandom(5),o=0;o<r;o++)n+=a.getRandom(10).toString()}else n=c.adjectives[a.getRandom(c.adjectives.length)]+c.nouns[a.getRandom(c.nouns.length)];a.getRandom(5)||(n=a.getRandom(2)?n.toLowerCase():n.toUpperCase())}return n},getBotCountry:function(e,t){return e=e||"us",t=t||["us"],a.getRandomFloat(1)>.7?e:t[a.getRandom(t.length)]},getStoreLink:function(e){var t={web:"https://itunes.apple.com/us/app/roadcrash-io/id1475752390",ios:"https://itunes.apple.com/us/app/roadcrash-io/id1475752390",android:"https://play.google.com/store/apps/details?id=com.gezellig.roadcrash"},n=t.web;return e?t[e]&&(n=t[e]):a.isNativeIos()?n=t.ios:a.isNativeAndroid()&&(n=t.android),n},openUrl:function(e){window.cordova&&window.cordova.InAppBrowser?window.cordova.InAppBrowser.open(e,"_system"):window.open(e,"_blank")},versionToHex:function(e){var t=e.split(".").map(function(e){return 255&parseInt(e)});return t[0]<<16|t[1]<<8|t[2]}};return a.extend(a,d),a}),bento.define("3d/booster",["bento","bento/math/vector2","bento/math/rectangle","bento/entity","bento/eventsystem","bento/utils","bento/tween","materials/curvematerial","modules/threejs","globals","modules/taptic"],function(e,t,n,i,r,o,a,s,c,l,u){"use strict";var h=Math.PI,d=[e.assets.getTexture("booster/boosterpad_0"),e.assets.getTexture("booster/boosterpad_1"),e.assets.getTexture("booster/boosterpad_2")],p=new s({map:d[0],color:16777215,specular:0,emissiveMap:d[0]}),f=new s({color:16776968,specular:0,emissive:16776968,emissiveIntensity:1,transparent:!0,opacity:.6});return e.objects.getByFamily("enemies"),function(t){var n=0,i=0,a=p.clone(),s=!1,m=new c.Primitive({shape:"cube",parameters:[3.44,.2,13.76],material:f,disposeGeometry:!0,disposeMaterial:!0,start:function(e){},update:function(e){},destroy:function(e){},attached:function(e){}});return new c.Primitive({shape:"plane",parameters:[4,16,1,16],material:a,disposeGeometry:!0,disposeMaterial:!0,start:function(t){this.mesh.position.x=3.83*o.getRandom(4)-5.745,this.mesh.position.z=-300,this.mesh.position.y=.12,this.mesh.rotation.x=.498*-h,m.mesh.position.x=this.mesh.position.x,m.mesh.position.y=.2,m.mesh.position.z=this.mesh.position.z,m.mesh.visible=!1,e.objects.attach(m)},update:function(o){if((n+=o.speed)>1&&(n-=1,i+=1,i%=3,a.map=d[i],a.emissiveMap=d[i],a.emissiveMap.needsUpdate=!0),!s&&l.player.collidable&&Math.abs(this.mesh.position.z)<9.5){var h=c.camera;Math.abs(h.position.x-this.mesh.position.x)<2.5&&(r.fire("boost"),u.impact({style:"medium"}),t.camera3d.shake(5),e.audio.setVolume(1,"sfx_car_boost4"),e.audio.stopSound("sfx_car_boost4"),e.audio.playSound("sfx_car_boost4"),m.mesh.visible=!0,s=!0)}this.mesh.position.z+=l.speed*o.speed,m.mesh.position.z=this.mesh.position.z,this.mesh.position.z>28&&(e.objects.remove(this),e.objects.remove(m))},destroy:function(e){},attached:function(e){}})}}),bento.define("3d/boostflare",["bento","bento/math/vector2","bento/math/rectangle","bento/entity","bento/eventsystem","bento/utils","bento/tween","modules/threejs","materials/curvematerial"],function(e,t,n,i,r,o,a,s,c){"use strict";var l=e.assets.getTexture("fx/boost_flare"),u=e.assets.getTexture("fx/boost_flash"),h=new c({map:l,color:16777215,specular:0,transparent:!0,emissiveMap:l,emissive:16777215,emissiveIntensity:1,depthTest:!1}),d=new c({map:u,color:16777215,specular:0,transparent:!0,emissiveMap:u,emissive:16777215,emissiveIntensity:1,depthTest:!1});return function(t){e.getViewport();var n=t.exhaustPipe,i=new THREE.Vector3,r=new THREE.PlaneBufferGeometry(.8,6),c=new THREE.Mesh(r,h),p=new THREE.Group;p.add(c);var f=new THREE.PlaneBufferGeometry(1.6,1.6),m=new THREE.Mesh(f,d),g=0,v=1,y=1,b=0,w=!1,x=1,E=new s.ParticleSystem({textures:"fx/boost_spark",amount:8,size:1.6,color:16777215,setStartVelocity:function(e,t){e.x=o.getRandomRangeFloat(-.12,.12),e.y=o.getRandomRangeFloat(-.12,.12),e.z=0},start:function(e){n.parent.updateMatrixWorld(),n.getWorldPosition(i),i.z+=.4,this.particles.position.copy(i),this.activeParticles=0,s.scene.add(p),s.scene.add(m),c.position.copy(i),c.rotation.x=1.6,c.rotation.y=3.15,c.position.z=2.7,c.position.x=0,c.position.y=-.018,c.renderOrder=2,m.position.copy(i),m.rotation.x=-.8,m.renderOrder=1,p.visible=this.active,m.visible=this.active,this.particles.visible=this.active,
this.addVelocitiesAutomatically=this.active,this.activeParticles=0},destroy:function(e){r.dispose(),l.dispose(),h.dispose(),f.dispose(),d.dispose(),u.dispose(),s.scene.remove(c),s.scene.remove(m)},update:function(e){if(w){var t,r;n.getWorldPosition(i),i.z+=.4,(b+=e.speed)>8&&(b-=8,this.activeParticles=++e.amount,r=3*(e.amount-1),e.velocities[r]=o.getRandomRangeFloat(-.12,.12),e.velocities[r+1]=o.getRandomRangeFloat(-.12,.12));var a=0;for(this.particles.position.copy(i),t=0,r=0;t<e.amount;t++,r+=3)e.velocities[r]-=.01*e.velocities[r]*e.speed,e.velocities[r+1]-=.01*e.velocities[r+1]*e.speed,e.attributes.size.array[t]-=e.attributes.size.array[t]*o.getRandomRangeFloat(.08,.1)*e.speed,e.attributes.size.array[t]<.5&&(this.active?(e.attributes.size.array[t]=1.6,e.attributes.position.array[r]=0,e.attributes.position.array[r+1]=0,e.attributes.position.array[r+2]=0,e.velocities[r]=o.getRandomRangeFloat(-.12,.12),e.velocities[r+1]=o.getRandomRangeFloat(-.12,.12)):(a++,e.attributes.size.array[t]=1e-6));a===e.amount&&(this.activeParticles=0,this.addVelocitiesAutomatically=!1,this.particles.visible=!1,w=!1,e.velocities[0]=o.getRandomRangeFloat(-.12,.12),e.velocities[1]=o.getRandomRangeFloat(-.12,.12)),e.sizeDirty=!0,p.position.copy(i),m.position.copy(i),(g-=e.speed)<=0&&(g+=1.5,y=o.getRandomRangeFloat(.8,1.8)),v+=.4*(y-v)*e.speed,p.scale.set(v*x,.4*(v+(v*v-v))*x,v*x),m.scale.set(v*x,v*x,v*x),p.rotation.y=.3*this.entity.mesh.rotation.y}},attached:function(e){this.entity=e.entity}});E.active=!1;var S=new a.TweenBehavior({from:x,to:1,in:5,ease:"easeOutBack",onUpdate:function(e,t){x=e}}),_=new a.TweenBehavior({from:x,to:1e-5,in:8,ease:"easeInQuad",onUpdate:function(e,t){x=e},onComplete:function(){p.visible=!1,m.visible=!1}});return E.activate=function(){this.active||(this.activeParticles=1,this.addVelocitiesAutomatically=!0,b=0,w=E.active=!0,p.visible=!0,m.visible=!0,E.particles.visible=!0,S.begin(),e.objects.attach(S)),_.isAdded&&e.objects.remove(_)},E.deactivate=function(){this.active&&(this.active=!1,_.begin(),e.objects.attach(_)),S.isAdded&&e.objects.remove(S)},E}}),bento.define("3d/camera3d",["bento","modules/threejs"],function(e,t){"use strict";return function(e){var n=new THREE.Vector3,i=(Math.PI,0);return{name:"camera3d",target:e.target,targetOffset:e.targetOffset||new THREE.Vector3(0,1,-20),cameraOffset:e.cameraOffset||new THREE.Vector3(0,4,20),angle:0,start:function(e){t.camera.position.x=this.cameraOffset.x,t.camera.position.z=this.cameraOffset.z,t.camera.position.y=this.cameraOffset.y,this.cameraOffset.z},destroy:function(e){},update:function(e){var r,o;this.target&&this.target.position&&(t.camera.position.x=this.target.position.x+this.cameraOffset.x,t.camera.position.y=this.cameraOffset.y,t.camera.position.z=this.target.position.z+this.cameraOffset.z,n.addVectors(this.target.position,this.targetOffset),r=(new THREE.Matrix4).lookAt(t.camera.position,n,new THREE.Vector3(0,1,0)),o=(new THREE.Quaternion).setFromRotationMatrix(r),t.camera.rotation.setFromQuaternion(o),i>0&&(i--,t.camera.position.x+=.3*Math.random(),t.camera.position.y+=.3*Math.random(),t.camera.position.z+=.3*Math.random()))},draw:function(e){},attached:function(e){},shake:function(e){i=e}}}}),bento.define("3d/coinfx",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/eventsystem","bento/gui/clickbutton","bento/gui/counter","bento/gui/text","bento/utils","bento/tween","modules/threejs"],function(e,t,n,i,r,o,a,s,c,l,u,h,d){"use strict";var p=h.interpolationsRP.easeInQuad,f=h.interpolationsRP.easeOutQuad;return Math.PI,function(t){for(var n,i=t.position,r=t.direction,a=new d.ThreeSprite({image:"fx/ring_yellow_256",start:function(e){this.sprite.position.copy(i),this.time=0},update:function(e){this.time+=e.speed;var t=3;this.time<3&&(t=f(this.time,.1,2.1,3)),this.time<13?(t=f(this.time-3,2.2,.2,10),this.sprite.material.opacity=f(this.time-3,1,-1,10)):v.remove(a),this.sprite.scale.set(t,t,t)},attached:function(e){}}),s=new d.ThreeSprite({image:"fx/core_yellow",start:function(e){this.sprite.position.copy(i),this.sprite.position.z+=.05,this.time=0},update:function(e){this.time+=e.speed;var t=.1;this.time<7?t=f(this.time,.05,.85,7):this.time<13?t=p(this.time-7,.9,-.85,6):v.remove(s),this.sprite.scale.set(t,t,t)},attached:function(e){}}),c=[],l=e.assets.getTexture("fx/spark"),h=new THREE.SpriteMaterial({map:l,color:16777215,alphaTest:.1}),m=3+u.getRandom(2);m--;)n=new THREE.Sprite(h),c.push(n),n.force=(new THREE.Vector3).copy(r),n.force.multiplyScalar(.6),n.force.x+=u.getRandomRangeFloat(-.2,.2),n.force.y+=u.getRandomRangeFloat(-.2,.2),n.force.z+=u.getRandomRangeFloat(-.2,.2),n.scale.set(.6,.6,.6),n.position.copy(i);var g={name:"behaviorComponent",start:function(e){this.time=0},destroy:function(e){c.forEach(function(e){d.scene.remove(e),e.geometry.dispose()}),h.dispose()},update:function(e){var t;this.time+=e.speed,c.forEach(function(n){n.position.x+=n.force.x*e.speed,n.position.y+=n.force.y*e.speed,n.position.z+=n.force.z*e.speed,g.time<24?(t=f(g.time,1,-1,24),h.opacity=t):v.removeSelf(),n.force.x-=.08*n.force.x*e.speed,n.force.y-=.08*n.force.y*e.speed,n.force.z-=.08*n.force.z*e.speed})},draw:function(e){}},v=new o({z:0,name:"coinFx",updateWhenPaused:0,components:[a,s,g]});return v}}),bento.define("3d/confetti3d",["bento","bento/math/vector2","bento/math/rectangle","bento/entity","bento/eventsystem","bento/utils","bento/tween","modules/threejs"],function(e,t,n,i,r,o,a,s){"use strict";return function(e){for(var t,n=e.position,i=e.direction,r=[new THREE.MeshPhongMaterial({color:16711680,emissive:16711680,emissiveIntensity:.8,side:THREE.DoubleSide}),new THREE.MeshPhongMaterial({color:16772864,emissive:16772864,emissiveIntensity:.8,side:THREE.DoubleSide}),new THREE.MeshPhongMaterial({color:61439,emissive:61439,emissiveIntensity:.8,side:THREE.DoubleSide})],a=new THREE.PlaneGeometry(.2,.4),c=[],l=20;l--;)t=new THREE.Mesh(a.clone(),r[o.getRandom(3)]),c.push(t),t.force=i.clone(new THREE.Vector3),t.force.x+=o.getRandomRangeFloat(-.15,.15),t.force.y+=o.getRandomRangeFloat(-.05,.2),t.force.z+=o.getRandomRangeFloat(-.15,.15),t.torque=new THREE.Vector3(o.getRandomRangeFloat(-.12,.12),o.getRandomRangeFloat(-.12,.12),o.getRandomRangeFloat(-.12,.12)),t.position.copy(n),s.scene.add(t);return{name:"confetti3D",start:function(e){},destroy:function(e){c.forEach(function(e){s.scene.remove(e),e.geometry.dispose()}),r[0].dispose(),r[1].dispose(),r[2].dispose()},update:function(e){c.forEach(function(t){t.position.x+=t.force.x*e.speed,t.position.y+=t.force.y*e.speed,t.position.z+=t.force.z*e.speed,t.force.x-=.03*t.force.x*e.speed,t.force.y-=.01*t.force.y*e.speed,t.force.z-=.03*t.force.z*e.speed,t.force.y-=.005*e.speed,t.force.y<-.1&&(t.force.y=-.1),t.rotation.x+=t.torque.x*e.speed,t.rotation.y+=t.torque.y*e.speed,t.rotation.z+=t.torque.z*e.speed,t.position.y})},draw:function(e){},attached:function(e){e.entity}}}}),bento.define("3d/crashfx",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/eventsystem","bento/gui/clickbutton","bento/gui/counter","bento/gui/text","bento/utils","bento/tween","modules/threejs","globals"],function(e,t,n,i,r,o,a,s,c,l,u,h,d,p){"use strict";var f=h.interpolationsRP.easeInQuad,m=h.interpolationsRP.easeOutQuad,g=e.assets.getTexture("fx/flare"),v=new THREE.MeshBasicMaterial({map:g,color:16777215,alphaTest:.8,side:THREE.DoubleSide}),y=e.assets.getTexture("fx/spark"),b=new THREE.SpriteMaterial({map:y,color:16777215,alphaTest:.1}),w=2*Math.PI;return function(e){for(var t,n,i,r,a=new THREE.Vector3,s=new THREE.Matrix4,c=new THREE.Quaternion,l=new THREE.Euler,h=new d.ThreeSprite({image:"fx/ring_yellow_512",start:function(e){this.sprite.position.x=-2,this.sprite.position.z=30},update:function(e){this.time+=e.speed;var t=3;this.time<6?t=m(this.time,2.2,16.8,38):this.sprite.visible=!1,this.time>7&&this.time<30&&(this.sprite.material.opacity=m(this.time-7,1,-1,11)),this.sprite.scale.set(t,t,t)},attached:function(e){}}),g=new d.ThreeSprite({image:"fx/core_yellow",start:function(e){this.sprite.position.x=-2,this.sprite.position.z=30},update:function(e){this.time+=e.speed;var t=.1;this.time<4?t=m(this.time,.1,3,8):this.time<18?t=f(this.time-8,3,-2.9,10):this.sprite.visible=!1,this.sprite.scale.set(t,t,t)},attached:function(e){}}),y=[],x=3;x--;)n=new THREE.PlaneGeometry(1,2),(i=new THREE.Mesh(n,v)).position.z=-1,i.scale.y=2,i.scale.x=.4,i.rotation.x=-.25*w,(r=new THREE.Group).add(i),r.position.x=-4,r.position.z=30,y.push(r),d.scene.add(r);var E,S=[];for(x=3;x--;)E=new THREE.Sprite(b),S.push(E),E.force=new THREE.Vector3,d.scene.add(E),E.position.x=-4,E.position.z=30;var _=!1,T={name:"behaviorComponent",start:function(e){},destroy:function(e){y.forEach(function(e){d.scene.remove(e),e.children[0].geometry.dispose()}),S.forEach(function(e){d.scene.remove(e),e.geometry.dispose()})},update:function(e){var t,n;_&&(this.time+=e.speed,y.forEach(function(e){T.time<20?(t=m(T.time,3,e.gotoScale,30),e.children[0].scale.set(t,t,t),T.time>7&&(n=m(T.time-7,1,-1,13),v.opacity=n)):e.visible=!1}),S.forEach(function(t){t.position.x+=t.force.x*e.speed,t.position.y+=t.force.y*e.speed,t.position.z+=t.force.z*e.speed,T.time<24?(n=m(T.time,1,-1,24),b.opacity=n):(t.visible=!1,_=!1),t.force.x-=.08*t.force.x*e.speed,t.force.y-=.08*t.force.y*e.speed,t.force.z-=.08*t.force.z*e.speed}))},draw:function(e){}};return new o({z:0,name:"crashFx",updateWhenPaused:0,components:[h,g,T]}).extend({hit:function(e){_=!0,T.time=0,v.opacity=1;var n=p.curveX,i=p.curveY,r=(d.camera.position.z-a.z)/300*256,o=Math.floor(r),f=u.clamp(0,o+1,255);r=u.clamp(0,r,255),o=u.clamp(0,o,255);var m=u.clamp(0,r-o,1),b=new THREE.Vector3(n[o]+(n[f]-n[o])*m,i[o]+(i[f]-i[o])*m,0);for(a.copy(e.pointOfImpact),a.add(b),t=e.direction,s.lookAt(new THREE.Vector3(0,0,0),t,new THREE.Vector3(0,0,1)),c.setFromRotationMatrix(s),l.setFromQuaternion(c),h.sprite.position.x=a.x-.15*t.x,h.sprite.position.y=a.y,h.sprite.position.z=a.z+.15*-t.z,h.time=0,h.sprite.visible=!0,g.sprite.position.copy(a),g.time=0,g.sprite.visible=!0,x=3;x--;)y[x].rotation.copy(l),y[x].rotation.x+=u.getRandomRangeFloat(-.4,.4),y[x].rotation.y+=u.getRandomRangeFloat(-.4,.4),y[x].rotation.z+=u.getRandomRangeFloat(-.4,.4),y[x].position.copy(a),y[x].gotoScale=2.5+u.getRandomFloat(1),y[x].visible=!0;for(x=3;x--;)S[x].force.copy(t),S[x].force.multiplyScalar(.2),S[x].force.x+=u.getRandomRangeFloat(-.2,.2),S[x].force.y+=u.getRandomRangeFloat(-.2,.2),S[x].force.z+=u.getRandomRangeFloat(-.2,.2),S[x].scale.set(1.6,1.6,1.6),S[x].position.copy(a),S[x].visible=!0}})}}),bento.define("3d/debugcurve",["bento","bento/math/vector2","bento/math/rectangle","bento/entity","bento/eventsystem","bento/utils","bento/tween","modules/threejs","globals"],function(e,t,n,i,r,o,a,s,c){"use strict";return function(e){var t=new THREE.BoxBufferGeometry(.5,.5,.5),n=new THREE.MeshBasicMaterial({color:16711935}),i=[];return{name:"debugCurve",start:function(e){for(var r,o=0;o<40;o++)(r=new THREE.Mesh(t,n)).position.set(0,1,-7.4*o-2),i.push(r),s.scene.add(r)},activate:function(){},destroy:function(e){i.forEach(function(e){e.geometry.dispose(),s.scene.remove(e)})},update:function(e){var t,n,r,a,l,u,h=c.curveX,d=c.curveY;i.forEach(function(e){t=(s.camera.position.z-e.position.z)/300*256,n=Math.floor(t),r=o.clamp(0,n+1,255),t=o.clamp(0,t,255),n=o.clamp(0,n,255),a=o.clamp(0,t-n,1),l=h[n]+(h[r]-h[n])*a,u=d[n]+(d[r]-d[n])*a,e.position.x=l*(l>0?.8:1),e.position.y=1+u*(u>0?1.4:2)})},draw:function(e){},attached:function(e){}}}}),bento.define("3d/exhaust",["bento","bento/math/vector2","bento/math/rectangle","bento/entity","bento/eventsystem","bento/utils","bento/tween","modules/threejs","globals"],function(e,t,n,i,r,o,a,s,c){"use strict";return function(e){var t=e.exhaustPipe;if(t){t.parent.updateMatrixWorld();var n,i=t.getWorldPosition(new THREE.Vector3),r=new THREE.Vector3,a=0,l=new s.ParticleSystem({textures:"fx/smoke",amount:20,size:2,color:16777215,alpha:.4,setStartPosition:function(e,t){},setStartVelocity:function(e,t){e.x=o.getRandomRangeFloat(-.02,.02),e.y=o.getRandomRangeFloat(-.02,.02),e.z=o.getRandomRangeFloat(.02,.08)},start:function(e){this.particles.position.copy(i),this.activeParticles=1},update:function(e){t.getWorldPosition(i),r.subVectors(l.particles.position,i),this.particles.position.copy(i);var s=c.speed/c.maxSpeed;(a+=e.speed)>2&&(a-=2,this.activeParticles=++e.amount);var u,h,d=0,p=c.speed*e.speed;for(u=0,h=0;u<e.amount;u++,h+=3)e.attributes.alpha.array[u]<=0?s<1?(e.attributes.position.array[h]=0,e.attributes.position.array[h+1]=0,e.attributes.position.array[h+2]=0,e.velocities[h]=o.getRandomRangeFloat(-.02,.02),e.velocities[h+1]=o.getRandomRangeFloat(-.02,.02),e.velocities[h+2]=o.getRandomRangeFloat(.02-1*s,.08),e.attributes.size.array[u]=2,e.attributes.alpha.array[u]=.4-.4*s):d++:(e.velocities[h]*=.96,e.velocities[h+1]*=.96,e.velocities[h+2]+=.1*(o.getRandomRangeFloat(.05,.1)-e.velocities[h+2]),e.attributes.position.array[h]+=r.x,e.attributes.position.array[h+1]+=r.y,e.attributes.position.array[h+2]+=r.z,e.attributes.position.array[h+2]+=p*e.speed,e.attributes.size.array[u]+=(o.getRandomRangeFloat(.3,.4)+.5*s)*e.speed,e.attributes.alpha.array[u]-=(o.getRandomRangeFloat(.01,.03)+0*s)*e.speed);d===e.amount&&n.remove(this),e.positionDirty=!0,e.sizeDirty=!0,e.alphaDirty=!0},attached:function(e){n=e.entity}});return l}}}),bento.define("3d/playertag",["bento","bento/math/vector2","bento/math/rectangle","bento/entity","bento/eventsystem","bento/utils","bento/tween","managers/textstyles","bento/gui/text","modules/threejs","globals","materials/curvematerial"],function(e,t,n,i,r,o,a,s,c,l,u,h){"use strict";var d=document.createElement("canvas"),p=[];return function(n){var i,r=n.target;i=p.length?p.pop():document.createElement("canvas");var o=new c({text:n.playerName||"Player",position:new t(0,0),fontSettings:s.get("gamePlayerName"),align:"center",maxWidth:74,maxHeight:10,drawDebug:!1,linebreaks:!1}),a=e.assets.getImage("gui/flags/"+(n.country?n.country:"us")),f=e.assets.getImage("gui/ingame/player-details-back");o.generateText(d),i.width=1024,i.height=1024;var m=1024/f.width,g=532/(74*c.defaultSharpness),v=i.getContext("2d");v.drawImage(f.image,0,0,f.width,f.height,0,512-f.height*m/2,1024,f.height*m),v.drawImage(a.image,0,0,a.width,a.height,16*m,512-(f.height-32)*m/2,(a.width-16)*m,(f.height-32)*m),v.drawImage(d,0,0,d.width,d.height,(168-16*g)*m,516-d.height*g*m/2,d.width*g*m,d.height*g*m);var y=new THREE.Texture(i),b=new h({map:y,color:16777215,specular:0,emissiveMap:y,emissive:16777215,emissiveIntensity:1,transparent:!0}),w=new l.Primitive({shape:"plane",parameters:[4,4],material:b,disposeGeometry:!0,disposeMaterial:!0,start:function(e){w.height=n.physical?n.physical.height:20,this.mesh.position.copy(r.position),this.mesh.position.y+=w.height+w.offset,this.mesh.renderOrder=99,b.emissiveMap.needsUpdate=!0},update:function(e){this.mesh.position.set(r.position.x,r.position.y,r.position.z),this.mesh.position.y+=w.height+w.offset},destroy:function(e){y.dispose(),i.width=0,i.height=0,p.push(i),i=null},attached:function(e){}});return u.noRaceNames&&(console.log(w),w.mesh.visible=!1),w.offset=1,w}}),bento.define("3d/road",["bento","bento/utils","modules/threejs","bento/tween","globals"],function(e,t,n,i,r){"use strict";var o=Math.PI;return function(i){var a,s={},c=new n.Mesh({path:"road",start:function(r){var c,u;i.textures&&t.forEach(i.textures,function(n,i,r,o){u=s[i].material,(c=e.assets.getTexture(n)).wrapS=THREE.RepeatWrapping,c.wrapT=THREE.RepeatWrapping,u.map=c,t.isNativeAndroid()?(c.generateMipmaps=!1,u.map.minFilter=THREE.NearestFilter):(c.anisotropy=THREE.currentRenderer.capabilities.getMaxAnisotropy(),u.map.minFilter=THREE.NearestMipmapLinearFilter),u.map.magFilter=THREE.NearestFilter,u.emissiveMap=c,u.map.needsUpdate=!0,u.emissiveMap.needsUpdate=!0,u.needsUpdate=!0}),i.remove&&i.remove.forEach(function(e){s[e].parent&&s[e].parent.remove(s[e]),s[e].geometry.dispose()}),i.cliffWall&&i.cliffWall.forEach(function(e){s[e]&&(s[e].position.x=34*l(e),s[e].position.y=29.98,s[e].rotation.z=o)});var h=n.camera.position;this.mesh.position.z=-160+h.z,e.objects.get("camera3d",function(e){a=e})},update:function(e){var t;Math.abs(a.cameraOffset.x)/Math.abs(a.cameraOffset.z)<=.8?(t=-160+a.cameraOffset.z,a.cameraOffset.z<0&&(t+=160-a.cameraOffset.z)):t=0;var n=r.distance%20;t=20*Math.floor(t/20+1)+n,this.mesh.position.z=t},destroy:function(e){},attached:function(e){}});c.mesh.children.forEach(function(e){e.name&&(s[e.name]=e)});var l=function(e){switch(e=e.slice(-1)){case"l":return-1;case"r":return 1;default:return 0}};return c}}),bento.define("3d/speedlines",["bento","bento/math/vector2","bento/math/rectangle","bento/entity","bento/eventsystem","bento/utils","bento/tween","modules/threejs","globals"],function(e,t,n,i,r,o,a,s,c){"use strict";return function(e){var t=new THREE.BoxBufferGeometry(.2,.2,18),n=new THREE.MeshBasicMaterial({color:16777215,transparent:!0,opacity:.4}),i=o.isNativeAndroid()?20:40,r=[],a=!1,l=0,u=!0;return{name:"speedlines",start:function(e){for(var c,u=0;u<i;u++)(c=new THREE.Mesh(t,n)).position.set(o.getRandomRangeFloat(-12,12),o.getRandomRangeFloat(.2,24),o.getRandomRangeFloat(-300,12)),r.push(c),s.scene.add(c);a=!0,l=.01},activate:function(){a=!0,l=.01},destroy:function(e){r.forEach(function(e){e.geometry.dispose(),s.scene.remove(e)})},update:function(e){if(a){var t=Math.max(0,c.speed/c.maxSpeed-1)+l;l=0,n.opacity=1.7*t,u&&(u=!1,t=1,n.opacity=1);var i=4*c.speed*e.speed;r.forEach(function(e){e.position.z+=i,e.position.z>12&&e.position.set(o.getRandomRangeFloat(-12,12),o.getRandomRangeFloat(.2,24),-300),e.visible=t>0}),0===t&&(a=!1)}},draw:function(e){},attached:function(e){}}}}),bento.define("3d/sun",["bento","modules/threejs"],function(e,t){"use strict";return function(e){var n=e.color||16777215,i=e.intensity||1;return new Object({name:"sun",light:new THREE.DirectionalLight(n,i),start:function(n){this.light.position.y=e.height||16,t.scene.add(this.light),t.scene.add(this.light.target),e.start&&e.start.bind(this)(n)},destroy:function(e){t.scene.remove(this.light),t.scene.remove(this.light.target)},update:e.update})}}),bento.define("3d/tirefire",["bento","bento/math/vector2","bento/math/rectangle","bento/entity","bento/eventsystem","bento/utils","bento/tween","globals","modules/threejs"],function(e,t,n,i,r,o,a,s,c){"use strict";return function(t){var n=t.tire,i=new THREE.Vector3,r=new THREE.Vector3,o=new THREE.Vector3,a=e.assets.getTexture("fx/spark"),l=new THREE.SpriteMaterial({map:a,color:16777215,alphaTest:.1}),u=!1,h=[],d=[];return{name:"tireFire",destroy:function(e){},update:function(e){var t=s.speed*e.speed;if(d=d.filter(function(e){if(e.position.z+=t,e.position.z<20)return c.scene.remove(e),!0;h.push(e)}),u){var a,p=Math.ceil(4*t);if(n.getWorldPosition(i),!isNaN(u.toString()))return o=i.clone(o),void(u=!0);for(o.z+=t,r.subVectors(o,i);p--;)r.divideScalar(p+1),r.multiplyScalar(p),(a=h.length?h.pop():new THREE.Sprite(l)).scale.set(1.6,1.6),a.position.addVectors(i,r),d.push(a),c.scene.add(a)}},activate:function(){u||(u=1)},deactivate:function(){u=!1}}}}),bento.define("3d/tiresmoke",["bento","bento/math/vector2","bento/math/rectangle","bento/entity","bento/eventsystem","bento/utils","bento/tween","modules/threejs","globals"],function(e,t,n,i,r,o,a,s,c){"use strict";return function(e){var t=e.tire;if(t){t.parent.updateMatrixWorld();var n=t.getWorldPosition(new THREE.Vector3),i=new THREE.Vector3,r=0,a=!1,l=new s.ParticleSystem({textures:"fx/smoke",amount:80,size:6,color:16777215,alpha:.6,setStartPosition:function(e,t){},setStartVelocity:function(e,t){e.x=0,e.y=0,e.z=0},activate:function(){this.activeParticles||(t.getWorldPosition(n),this.particles.position.copy(n),this.activeParticles=1,i.set(0,0,0)),a=!0},update:function(e){if(this.activeParticles){t.getWorldPosition(n),i.subVectors(l.particles.position,n),this.particles.position.copy(n);var s=c.speed/c.maxSpeed;(r+=e.speed)>2&&a&&(r-=2,this.activeParticles=++e.amount);var u,h,d=0,p=c.speed*e.speed;for(u=0,h=0;u<e.amount;u++,h+=3)e.attributes.alpha.array[u]<=0?s<1?(e.attributes.position.array[h]=0,e.attributes.position.array[h+1]=0,e.attributes.position.array[h+2]=0,e.velocities[h]=o.getRandomRangeFloat(-.02,.02),e.velocities[h+1]=o.getRandomRangeFloat(-.02,.02),e.velocities[h+2]=o.getRandomRangeFloat(.02-1*s,.08),e.attributes.size.array[u]=2,e.attributes.alpha.array[u]=.4-.4*s):d++:(e.velocities[h]*=.96,e.velocities[h+1]*=.96,e.velocities[h+2]+=.1*(o.getRandomRangeFloat(.05,.1)-e.velocities[h+2]),e.attributes.position.array[h]+=i.x,e.attributes.position.array[h+1]+=i.y,e.attributes.position.array[h+2]+=i.z,e.attributes.position.array[h+2]+=p*e.speed,e.attributes.size.array[u]+=(o.getRandomRangeFloat(.6,.8)+.9*s)*e.speed,e.attributes.alpha.array[u]-=(o.getRandomRangeFloat(.01,.03)+0*s)*e.speed);d===e.amount&&(this.activeParticles=0),e.positionDirty=!0,e.sizeDirty=!0,e.alphaDirty=!0,a=!1}},attached:function(e){e.entity}});return l}}}),bento.define("components/backbutton",["bento","bento/eventsystem","bento/utils"],function(e,t,n){"use strict";var i=!1,r=function(){t.fire("backButton"),i||t.fire("exitApp"),i=!1};return document.addEventListener("backbutton",r,!1),n.isDev()&&(t.clear("buttonDown-escape"),t.on("buttonDown-escape",r)),function(n){e.getViewport();var r,o=null,a=n.onPressed,s=n.removeSelf,c=function(){if(r){if(r.isPaused())return;if(o&&o.isActive&&!o.isActive())return void(i=!0)}else if(o&&e.objects.isPaused()>o.updateWhenPaused)return;i=!0,a&&a({entity:o}),s&&(o.remove(l),t.off("backButton",c))},l={z:-1e4,name:"backButton",attached:function(e){o=e.entity},start:function(){t.on("backButton",c),o.getComponent("clickable",function(e){r=e})},destroy:function(){t.off("backButton",c)}};return l}}),bento.define("components/carcontroller",["bento","bento/components/clickable","bento/math/vector2","globals","bento/components/sprite","bento/entity","bento/eventsystem","bento/components/eventlistener"],function(e,t,n,i,r,o,a,s){"use strict";return function(c){var l=new n(0,0),u=new o({z:i.RaceLayers.JOYSTICKSOCKET,name:"joystickSocket",position:new n(0,0),scale:i.pixelScaleUIV.clone(),alpha:.3,components:[new r({imageName:"gui/joystick/socket",originRelative:new n(.5,.5)})]}),h=new o({z:i.RaceLayers.JOYSTICKSOCKET,name:"analogStick",position:new n(0,0),scale:i.pixelScaleUIV.clone(),components:[new r({imageName:"gui/joystick/stick",originRelative:new n(.5,.5)})]}),d=!1,p=new n(0,0),f=null,m=new t({pointerDown:function(e){null===f&&(f=e.id,p.x=0,p.y=0,l.x=e.position.x,l.y=e.position.y,d=!0)},pointerUp:function(e){f===e.id&&(f=null,p.x=0,p.y=0,d=!1,this.entity.canShoot&&(this.entity.trigger=!0))},pointerMove:function(e){if(f===e.id){var t=l.subtract(e.position),n=t.magnitude();n>4?(t.normalize(),n>25&&(l.x=e.position.x+25*t.x,l.y=e.position.y+25*t.y),n-=4,n/=20,n=Math.min(1,n),p.x=-t.x*n,p.y=-t.y*n):(p.x=0,p.y=0)}}}),g={};m._attached=m.attached,m.attached=function(t){m._attached(t),t.entity.attach(new s({name:"eventListener",eventName:"tabSwitch",ignorePause:!1,onEvent:function(e){g={}}})),t.entity.attach(new s({name:"eventListener",eventName:"buttonDown",ignorePause:!1,onEvent:function(e){g[e]=!0}})),t.entity.attach(new s({name:"eventListener",eventName:"buttonUp",ignorePause:!1,onEvent:function(e){g[e]=!1}})),u.active=!1,u.visible=!1,e.objects.attach(u),h.active=!1,h.visible=!1,e.objects.attach(h)};var v=function(e){return g[e]},y=0;return m._update=m.update,m.update=function(e){v("left")||v("a")?(a.fire("keyboardControlsChanged"),p.x>0?p.x=0:p.x<-.8?p.x=-.8:p.x+=-.15):v("right")||v("d")?(a.fire("keyboardControlsChanged"),p.x<0?p.x=0:p.x>.8?p.x=.8:p.x+=.15):d||(p.x=0),this.entity.virtual.x=p.x,this.entity.virtual.y=p.y,m._update(e),i.noJoystick?u.visible=h.visible=!1:u.visible=h.visible=d,u.position.x=l.x,u.position.y=l.y,h.position.x=l.x+8*this.entity.virtual.x,h.position.y=l.y+8*this.entity.virtual.y,y&&y--},m._destroy=m.destroy,m.destroy=function(t){e.objects.remove(u),e.objects.remove(h)},m}}),bento.define("components/collisionhelper",["bento","bento/math/vector2","bento/math/rectangle","bento/entity","bento/eventsystem","bento/utils","bento/tween"],function(e,t,n,i,r,o,a){"use strict";return function(e){var t=e.car,n=e.model,i=new THREE.Vector3,r=e.impact,o=[new THREE.Object3D({}),n,new THREE.Object3D({})],a=new THREE.Vector3({});return{length:0,width:0,height:0,position:-800,impulse:new THREE.Vector2,torque:0,hitBox:[new THREE.Box3,new THREE.Box3,new THREE.Box3],name:"collisionHelper",solveForces:e.solveForces||function(){},start:function(e){t.geometry.computeBoundingBox(),t.geometry.boundingBox.getSize(i),i.y+=i.z,i.z=i.y-i.z,i.y-=i.z,o[0].position.z=i.z/6*-2,o[2].position.z=i.z/6*2,this.width=i.x,this.height=i.y,this.length=i.z,i.z/=3,n.add(o[0]),n.add(o[2]),this.prepare()},prepare:function(e){var t;for(t=0;t<3;t++)o[t].getWorldPosition(a),a.y+=i.y/2,this.hitBox[t].setFromCenterAndSize(a,i);this.position=n.position.z},attached:function(e){e.entity},impact:r}}}),bento.define("components/collisionsolver",["bento","bento/math/vector2","bento/math/rectangle","bento/entity","bento/eventsystem","bento/utils","bento/tween"],function(e,t,n,i,r,o,a){"use strict";return Math.PI,function(t){var n=t.player,i=t.enemySpawner,r=e.objects.getByFamily("travelers");return{z:999999999,name:"collisionSolver",activeCars:[],update:function(e){this.activeCars.length=0;var t,a=new THREE.Vector3,s=new THREE.Vector3,c=new THREE.Vector3,l=[],u=n.collisionHelper,h=u.length/2;if(n.collidable){this.activeCars=i.enemyList.filter(function(e){if(e.collidable&&Math.abs(e.collisionHelper.position-u.position)<=e.collisionHelper.length/2+h)return!0});var d=function(i){if(l.length=0,i&&(t=i.collisionHelper,u.hitBox.forEach(function(e){t.hitBox.forEach(function(t){t.intersectsBox(e)&&l.push(t.clone(new THREE.Box3).intersect(e))})}),l.length)){var r=new THREE.Vector2;c.set(0,0,0),l.forEach(function(e){e.getCenter(a),e.getSize(s),s.x>r.x&&(r.x=s.x),s.z>r.y&&(r.y+=s.z),c.add(a)}),c.divideScalar(l.length),r.y>r.x?r.y=0:r.x=0,t.solveForces(i,n,c,r,e),t.impact&&t.impact(c,n),u.impact&&u.impact(c,i)}};o.forEach(this.activeCars,function(e,t,n,i){d(e)}),o.forEach(r,function(e,t,n,i){e.collidable&&-800!==e.collisionHelper.position&&d(e)})}}}}}),bento.define("components/hdnineslice",["bento","bento/math/vector2","bento/math/rectangle","bento/components/nineslice","bento/entity","bento/utils","bento/tween"],function(e,t,n,i,r,o,a){"use strict";return function(o){var a,s=o.name||"hdNineSlice",c=o.position,l=o.gamepixelDimension||new n(0,0,0,0),u=o.viewportDimension||new n(0,0,0,0),h=o.inheritDimension||new n(0,0,0,0),d=o.forceFitToParent||!1,p=o.scaleFactor||.144,f=new n(0,0,0,0),m=new i(o),g={name:"hdNinesliceBehavior",start:function(){if(y(l,u,h),a&&(a.dimension.width=f.width,a.dimension.height=f.height),m.width=f.width/p,m.height=f.height/p,v.scale=new t(p,p),v.parent){v.parent.dimension.x=-m.width*m.settings.originRelative.x*v.scale.x,v.parent.dimension.y=-m.height*m.settings.originRelative.y*v.scale.y;var e=v.parent.getComponent("positioner");e&&e.reposition()}},onParentAttached:function(e){a=e.parent}},v=new r({name:s,position:c,components:[m,g]}),y=function(t,n,i){var r,o=e.getViewport();f.width=t.width,f.height=t.height,f.width+=n.width*o.width,f.height+=n.height*o.height,d&&void 0!==v.parent.parent.dimension&&(r=v.parent.parent.dimension,f.width+=i.width*r.width,f.height+=i.height*r.height)};return l.isRectangle||(l=new n(l.x||0,l.y||0,l.width||0,l.height||0)),v}}),bento.define("components/hdsprite",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/pixi/sprite","bento/entity","bento/utils","bento/tween"],function(e,t,n,i,r,o,a,s){"use strict";return function(t){var s,c=t.name||"hdSprite",l=t.position,u=t.gamepixelDimension||new n(0,0,0,0),h=t.viewportDimension||new n(0,0,0,0),d=t.inheritDimension||new n(0,0,0,0),p=t.forceFitToParent||!1,f=new n(0,0,0,0),m=!a.isEmpty(u.width),g=!a.isEmpty(u.height),v=new(t.pixi?r:i)(t),y=new o({name:c,position:l,components:[v,{name:"hdSpriteBehavior",start:function(){var e;if(e=v.frameWidth/v.frameHeight,b(u,h,d),s&&(s.dimension.width=f.width,s.dimension.height=f.height),y.scale.x=f.width/v.frameWidth,y.scale.y=f.height/v.frameHeight,m||(y.scale.x=y.scale.y,s.dimension.width=f.height*e),g||(y.scale.y=y.scale.x,s.dimension.height=f.width/e),m||g||(y.scale.x=1,y.scale.y=1,s.dimension.width=v.frameWidth,s.dimension.height=v.frameHeight),p&&void 0!==y.parent.parent.dimension){var t=y.parent.parent.dimension;s.dimension.height*s.scale.y>t.height&&(s.scale.x=1*s.scale.x/(s.dimension.height/t.height),s.scale.y=1*s.scale.y/(s.dimension.height/t.height)),s.dimension.width*s.scale.x>t.width&&(s.scale.x=1*s.scale.x/(s.dimension.width/t.width),s.scale.y=1*s.scale.y/(s.dimension.width/t.width))}if(y.parent){s.dimension.x=-v.origin.x*y.scale.x,s.dimension.y=-v.origin.y*y.scale.y;var n=y.parent.getComponent("positioner");n&&n.reposition()}},onParentAttached:function(e){s=e.parent}}]}),b=function(t,n,i){var r,o=e.getViewport();m&&(f.width=t.width),g&&(f.height=t.height),f.width+=n.width*o.width,f.height+=n.height*o.height,p&&void 0!==y.parent.parent.dimension&&(r=y.parent.parent.dimension)&&(f.width+=i.width*r.width,f.height+=i.height*r.height)};return u.isRectangle||(u=new n(u.x||0,u.y||0,u.width||0,u.height||0)),y}}),bento.define("components/iconbutton",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/eventsystem","bento/gui/clickbutton","bento/gui/counter","bento/gui/text","bento/utils","bento/tween","bento/components/fill"],function(e,t,n,i,r,o,a,s,c,l,u,h,d){"use strict";return function(r){var a,c,l={},h=r.icon,p=r.iconSprite,f=r.iconAlpha,m=r.iconName||"",g=r.iconOffset||new t(0,0),v=r.offsetOnPressed||0,y=h||new o({name:"icon",components:[p||new i({imageName:m,originRelative:new t(.5,.5)})]}),b=new n((r.textPos&&r.textPos.x||0)/(r.scaleFactor||1),(r.textPos&&r.textPos.y||0)/(r.scaleFactor||1),(r.textSize&&r.textSize.width||0)/(r.scaleFactor||1),(r.textSize&&r.textSize.height||0)/(r.scaleFactor||1));return b.x-=b.width/2,b.y-=b.height/2,b.width&&b.height&&e.isUITool&&(c=new d({name:r.name+"_text",color:[1,0,1,.5],dimension:b})),y.position=new t(g.x*(1/(r.scaleFactor||.144)),g.y*(1/(r.scaleFactor||.144))),l.frameCountX=l.frameCountX||1,l.frameCountY=l.frameCountY||3,l.sfx="sfx_button",u.extend(l,r),l.onButtonDown=function(e){y.position.y=(g.y+v)*(1/a.scale.y),a.onButtonDown&&a.onButtonDown(e)},l.onButtonUp=function(e){y.position.y=g.y*(1/a.scale.y),a.onButtonUp&&a.onButtonUp(e)},l.onClick=function(e){a.onClick&&a.onClick(e)},l.components=[y].concat(r.components||[]),c&&l.components.unshift(c),r.scaleFactor&&(l.scale=new t(r.scaleFactor,r.scaleFactor)),l.scale||(l.scale=new t(.144,.144)),(a=new s(l)).attach({name:"iconbuttonBehavior",start:function(){if(a.parent&&0===a.parent.dimension.width&&0===a.parent.dimension.height){a.parent.dimension.width=a.dimension.width*l.scale.x,a.parent.dimension.height=a.dimension.height*l.scale.y,a.parent.dimension.x=.5*-a.dimension.width*a.scale.x,a.parent.dimension.y=.5*-a.dimension.height*a.scale.y;var e=a.parent.getComponent("positioner");e&&e.reposition()}}}),a.extend({icon:y,onButtonDown:r.onButtonDown,onButtonUp:r.onButtonUp,onClick:r.onClick}),Object.defineProperty(a,"sfx",{get:function(){return l.sfx},set:function(e){l.sfx=e}}),f&&a.attach({name:"alpha",update:function(){a.isActive()?y.alpha=1:y.alpha=f}}),a}}),bento.define("components/mask",["bento","bento/math/vector2","bento/math/rectangle","bento/entity","bento/eventsystem","bento/utils","bento/tween","bento/components/sprite"],function(e,t,n,i,r,o,a,s){"use strict";var c=function(e){var t,i=e.rectangle||new n(0,0,1,1),r=e.sprite,o={name:"mask",start:function(e){r&&(r.draw=a)},destroy:function(e){r&&(r.draw=s.prototype.draw)},attached:function(e){t=e.entity}
},a=function(e){var o;if(this.currentAnimation&&this.visible){this.updateFrame(),o=new n(0|-this.origin.x,0|-this.origin.y,this.frameWidth,this.frameHeight);var a=i.x,s=i.y,c=i.x+i.width,l=i.y+i.height,u=function(e){e!==t&&e.parent&&u(e.parent),a=(a-e.position.x)/e.scale.x,s=(s-e.position.y)/e.scale.y,c=(c-e.position.x)/e.scale.x,l=(l-e.position.y)/e.scale.y};u(r.parent);var h=new n(a,s,c-a,l-s).intersection(o);h.width&&h.height&&("[object PixiSprite]"!==this.toString()?e.renderer.drawImage(this.spriteImage,this.sourceX+(h.x-o.x),this.sourceY+(h.y-o.y),h.width,h.height,h.x,h.y,h.width,h.height):(this.updateSprite(this.spriteImage,this.sourceX+(h.x-o.x),this.sourceY+(h.y-o.y),h.width,h.height),e.renderer.translate(Math.round(h.x),Math.round(h.y)),e.renderer.drawPixi(this.sprite),e.renderer.translate(-Math.round(h.x),-Math.round(h.y))))}};return o};return c.applyToContainer=function(e,t){var n=function(i){i.components.forEach(function(i){i&&(i.components?n(i):i instanceof s&&e.attach(new c({sprite:i,rectangle:t})))})};n(e)},c}),bento.define("components/modulate",["bento","bento/math/vector2","bento/math/rectangle","bento/entity","bento/eventsystem","bento/utils","bento/tween"],function(e,t,n,i,r,o,a){"use strict";return function(t){e.getViewport();var n,i,r=t.strength||.2,s=r,c=t.base||1,l=t.base||1,u=Math.min(1,c/l),h=Math.min(1,l/c),d=t.speed||14,p=t.ignoreScale||!1,f=!o.isDefined(t.play)||t.play;return{name:"modulate",update:function(e){if(f){var t=r/2;n.scale.x=c+Math.sin(n.ticker/d)*(r*u)+t*u,n.scale.y=l+Math.sin(n.ticker/d)*(r*h)+t*h}},attached:function(e){n||(n=e.entity,p||(c=n.scale.x,l=n.scale.y,u=Math.min(1,c/l),h=Math.min(1,l/c),r*=Math.max(c,l),s=r))},pause:function(t){i&&e.objects.remove(i),i=new a({from:r,to:0,in:15,delay:0,ease:"easeInOutQuad",onUpdate:function(e,t){r=e},onComplete:function(){i=null,f=!1}})},resume:function(t){i&&e.objects.remove(i),f=!0,i=new a({from:r,to:s,in:15,delay:0,ease:"easeInQuad",onUpdate:function(e,t){r=e},onComplete:function(){i=null,f=!0}})}}}}),bento.define("components/multiscale",["bento","bento/math/vector2","bento/math/rectangle","bento/entity","bento/eventsystem","bento/utils","bento/tween"],function(e,t,n,i,r,o,a){"use strict";var s=!1;return function(e){var n,i=[],r=e.preventZero||!1,a=new t(1,1),c={name:"multiScale",update:function(e){n.scale.x=1,n.scale.y=1,o.forEach(i,function(e){var t=c[e];n.scale.x*=t.x,n.scale.y*=t.y}),r&&(n.scale.x=n.scale.x||a.x,n.scale.y=n.scale.y||a.y,a.x=o.sign(n.scale.x)||1,a.y=o.sign(n.scale.y)||1)},attached:function(t){n=t.entity,e.scales&&o.forEach(e.scales,function(e,t){c.addScale(t,e)})},addScale:function(e,n){c[e]?o.log("WARNING: scale "+e+" already exists"):(!s&&n&&0===n.x&&0===n.y&&(o.log("WARNING: passing new Vector(0, 0) results into an invisible entity"),s=!0),c[e]=n||new t(1,1),i.push(e))}};return c}}),bento.define("components/sortedclickable",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/eventsystem","bento/gui/counter","bento/gui/text","bento/utils","bento/tween","bento/gui/clickbutton"],function(e,t,n,i,r,o,a,s,c,l,u,h){"use strict";return function(e){var t=!1;return new r({onClick:function(n){t=!1,!h.currentlyPressing&&this.parent.visible&&(h.currentlyPressing=this.parent,e.onPressed&&e.onPressed.apply(this.parent,[n]))},onClickUp:function(n){t&&(h.currentlyPressing===this.parent&&(h.currentlyPressing=null),e.onClick&&e.onClick.apply(this.parent,[n]))},pointerUp:function(n){h.currentlyPressing===this.parent&&(t=!0,h.currentlyPressing=null,e.onRelease&&e.onRelease.apply(this.parent,[n]))},sort:!0})}}),bento.define("components/textplacement",["bento","bento/math/vector2","bento/math/rectangle","bento/entity","bento/gui/text","bento/utils","bento/tween","bento/components/fill"],function(e,t,n,i,r,o,a,s){"use strict";return function(e){var i=new n((e.textPos&&e.textPos.x||0)/(e.scaleFactor||1),(e.textPos&&e.textPos.y||0)/(e.scaleFactor||1),(e.gamepixelDimension&&e.gamepixelDimension.width||0)/(e.scaleFactor||1),(e.gamepixelDimension&&e.gamepixelDimension.height||0)/(e.scaleFactor||1)),o=(e.viewportDimension||new n(0,0,0,0),e.inheritDimension||new n(0,0,0,0),new n(0,0,0,0),e.align),a=e.textBaseline;return new r({position:new t(i.x,i.y),text:"",maxWidth:i.width,maxHeight:i.height,align:o,textBaseline:a,margin:new t(32,32)})}}),bento.define("debug/html",["bento","bento/utils"],function(e,t){"use strict";var n=function(e){var t,n,i=this;for(n=e.length?e:arguments,t=0;t<n.length;++t)this.appendChild(n[t]);return i},i=function(e){return this.innerHTML=e,this},r=function(e){-1===this.className.split(" ").indexOf(e)&&(this.className+=" "+e)},o=function(e){var t=this.className.split(" "),n=t.indexOf(e);n>=0&&(t.splice(n,1),this.className=t.join(" "))},a=function(){this.parentNode&&this.parentNode.removeChild(this)},s=function(e,n){var i,r,o=n||{},a=o.children,c=o.class,l=o.id,u="";return delete o.children,delete o.class,delete o.id,o.style&&t.isObject(o.style)&&(t.forEach(o.style,function(e,t){u+=t+": "+e+"; "}),o.style=u),0===e.indexOf("<")?(r=(new window.DOMParser).parseFromString(e,"text/html"),i=r.body.firstChild,s.addFunctions(i),s.addAttributes(i,o),c&&i.addClass(c),l&&(i.id=l)):i=s.make(e,c,l,o),a&&t.forEach(a,function(e){i.append(e)}),i};return s.addFunctions=function(e){e.addClass||(e.append=n,e.attach=n,e.write=i,e.addClass=r,e.removeClass=o,e.removeSelf=a,Object.defineProperty(e,"innerHtml",{get:function(){return this.innerHTML},set:function(e){this.innerHTML=e}}))},s.getById=function(e){var t=document.getElementById(e);return t&&s.addFunctions(t),t},s.appendToBody=function(e){return document.body.appendChild(e),e},s.makeDiv=function(e,t,n){return this.make("div",e,t,n)},s.make=function(e,t,n,i){var r=document.createElement(e);return n&&(r.id=n),t&&(r.className=t),i&&s.addAttributes(r,i),s.addFunctions(r),r},s.addAttributes=function(e,t){var n;for(n in t)t.hasOwnProperty(n)&&(0===n.indexOf("on")?e[n]=t[n]:"innerHtml"===n||"innerHTML"===n?e.innerHTML=t[n]:e.setAttribute(n,t[n]))},s.remove=function(e){e.parentNode.removeChild(e)},s.removeById=function(e){var t=s.getById(e);return t&&s.remove(t),t},s}),bento.define("debug/overlay",["bento","bento/utils","debug/html","debug/html/accordion"],function(e,t,n,i){"use strict";var r=!1,o=function(e){var n=e.onReady,r=e.params,o=[],a={},s=this;t.forEach(r,function(e,t){o.push(t)}),t.forEach(o,function(r){bento.require([r],function(c){var l=new i({title:r.replace("debug/tests/",""),isToggled:!0});a[r]={constructor:c,html:l},t.getKeyLength(a)===o.length&&(e.showOverlay&&(s.runTests(),s.show()),n&&n())},function(e){var t=new i({title:"ERROR: could not load"+r,isToggled:!0});a[r]={constructor:null,html:t}})}),this.modules=a,this.tests=o,this.params=r};return o.prototype.runTests=function(){var e=this.modules,i=this.params;t.forEach(this.tests,function(r){var o,a=e[r].constructor,s=e[r].html,c=!1,l=n("ul",{style:{"list-style-type":"disc"}});if(s.attach(l),a)try{o=new a(i[r]||{}),t.forEach(o,function(e){var t=n("p",{display:"inline",innerHtml:e.name,style:{"margin-right":"2px"}}),i=n("p",{display:"inline",style:{"margin-left":"8px"}}),r=n("div"),o=n("li").attach(t,i,r);l.attach(o),e.run(r,function(e){i.innerHtml=e,i.style.color="green"},function(e){i.innerHtml=e,i.style.color="red",c||(c=!0,s.title.innerHtml+=' <i class="fas fa-exclamation-triangle"></i>')})})}catch(e){s.attach(n("<p>"+e+"</p>"),{style:{color:"red"}})}else s.attach(n("<p>Tests could not be initialized</p>"))})},o.prototype.show=function(){var e=this.modules,i=n('<nav class="navbar" role="navigation" aria-label="main navigation" />').attach(n('<div class="navbar-brand" />').attach([n('<a id="close" class="navbar-item" href="#"><i class="fas fa-times-circle"></i></a>',{onclick:function(){o.removeSelf()}}),n('<h1 id="frontpage-h1" class="title navbar-item">Debugging</h1>')])),o=n("div",{id:"debugContainer",style:{display:"block",position:"absolute",top:"0px",left:"0px",width:"100%",height:"100%","-webkit-overflow-scrolling":"touch",overflow:"auto","min-width":"100%","min-height":"100%","background-color":"rgba(255, 255, 255, 0.9)"},children:[i]});n.appendToBody(o),r||(document.head.insertAdjacentHTML("beforeend","<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.5/css/bulma.min.css>"),document.head.insertAdjacentHTML("beforeend",'<link rel="stylesheet" type="text/css" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">'),r=!0),t.forEach(e,function(e){o.attach(e.html.container)})},o}),bento.define("entities/car",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/eventsystem","bento/gui/clickbutton","bento/gui/counter","bento/gui/text","bento/utils","bento/tween","modules/threejs","components/carcontroller","globals","3d/exhaust","components/collisionhelper","materials/curvematerial","modules/savemanager","3d/crashfx","modules/taptic","3d/boostflare","modules/carinfo","managers/vipmanager","bento/components/eventlistener"],function(e,t,n,i,r,o,a,s,c,l,u,h,d,p,f,m,g,v,y,b,w,x,E,S,_){"use strict";var T=Math.PI,M=2*T,C=new v({color:2697513,opacity:.8,transparent:!0,specular:0}),A=function(t){var n,i=t.x,r=-t.y,o=t.position,a=Math.sqrt(i*i+r*r)+.2,s=Math.atan2(i,r),c=t.fade||.08,l=C.clone(),u=t.fire?6:0,h=d.Primitive({shape:"plane",parameters:[.18,a],material:l,start:function(e){this.mesh.position.x=o.x-i/2,this.mesh.position.y=.03,this.mesh.position.z=o.z-r/2,this.mesh.rotation.x=T/-2,this.mesh.rotation.z=-s,u&&(l.color.set(16777199),l.emissive.set(16777199),l.emissiveIntensity=1,l.opacity=1,n=[new THREE.Color(16768768),new THREE.Color(16711680)])},update:function(t){this.mesh.position.z+=f.speed*t.speed,u?(u=Math.max(0,u-t.speed))>3?(l.color.set(16777199),l.color.lerp(n[0],1-(u-3)/3),l.emissive.copy(l.color)):(l.color.copy(n[1]),l.color.lerp(n[0],Math.max(0,(u-1)/2)),l.emissive.copy(l.color)):this.mesh.material.opacity-=c*t.speed,this.mesh.material.opacity<=0&&e.objects.remove(h)},destroy:function(e){this.mesh.material.dispose()},attached:function(e){}});e.objects.attach(h)};return function(n){var i,r=Math.min(y.load("carRank"),f.maxCarRank),s=E.getCarMesh(r),c="car"+("00"+r).slice(-2),l={},m=0,v=20/360*M,_=0,T=0,C=[],R=[],P=new THREE.Vector3,I=new THREE.Vector3,L=!0,D=!1,O=new d.Mesh({path:"cars/"+s,start:function(t){var n=y.load("testDrive"),r=S.getMaterial(l.car.material,n?5:void 0);n&&(y.add("testDrive",-1),n-1==0&&y.save("showSubscription",!0)),i=e.assets.getTexture("cars/"+c),r.map=i,r.emissiveMap=i,r.needsUpdate=!0,l.car.material=r},update:function(e){l.car.material.update&&l.car.material.update(e)},destroy:function(e){i&&i.dispose()},attached:function(e){}});O.mesh.children.forEach(function(e){e.name&&(l[e.name]=e)});var k,F=new p({}),B=new THREE.Vector3,N=new g({car:l.car,model:O.mesh,impact:function(t,n){var i;if("enemy"===n.name){a.fire("crashedChanged"),w.impact({style:"heavy"}),Y.camera3d.shake(8);var r=new THREE.Vector3;r.subVectors(n.mesh.position,O.mesh.position),G.hit({pointOfImpact:t,direction:r}),r.subVectors(O.mesh.position,n.mesh.position),j(B,n.mesh.position,n.collisionHelper.height),Y.sun.light.intensity=1.05,i=e.getGameSpeed(),new h({from:0,to:e.getGameSpeed(),in:6,delay:3,ease:"easeInQuad",ignoreGameSpeed:!0,onStart:function(){Y.sun.light.intensity=1},onUpdate:function(t,n){e.setGameSpeed(0)},onComplete:function(){e.setGameSpeed(i)}}),Y.progress.boost();var o=e.assets.getAudio("sfx_car_crash2");if(e.audio.stopSound("sfx_car_crash2"),e.audio.playSound("sfx_car_crash2"),o.bufferSource&&(o.bufferSource.playbackRate.value=.9+u.getRandomFloat(.3)),L||D)a.fire("crashed",n),e.audio.setVolume(1,"sfx_car_crash2");else{var s;e.audio.setVolume(.4,"sfx_car_crash2");var c=u.sign(r.x),l=Math.abs(r.x)/4;new h({from:1,to:0,in:40,delay:0,applyOnDelay:0,ease:"easeOutQuad",onStart:function(){},onUpdate:function(t,n){s=e.getGameSpeed(),O.mesh.position.z-=t*(.5-.2*l)*s,O.mesh.rotation.y-=t*(.01+.06*l)*s*c},onComplete:function(){}})}}else if("ramp"===n.name&&Math.abs(n.mesh.position.x-O.mesh.position.x)<=n.collisionHelper.width/2){e.audio.setVolume(1,"sfx_car_boost4"),e.audio.stopSound("sfx_car_boost4"),e.audio.playSound("sfx_car_boost4"),new h({from:O.mesh.position.y,to:12,in:80,delay:0,ease:"easeOutCubic",onStart:function(){},onUpdate:function(e,t){O.mesh.position.y=e,f.jump=!0},onComplete:function(){f.jump=!1,new h({from:12,to:.6,in:76,delay:0,ease:"easeInQuad",onStart:function(){},onUpdate:function(e,t){O.mesh.position.y=e},onComplete:function(){new h({from:.6,to:0,in:26,delay:0,ease:"elastic",decay:3,oscillations:2,onStart:function(){},onUpdate:function(e,t){O.mesh.position.y=e},onComplete:function(){}})}})}}),u.timeout(148,function(){e.audio.stopSound("sfx_car_bounce"),e.audio.playSound("sfx_car_bounce"),u.timeout(4,function(){e.audio.stopSound("sfx_car_bounce"),e.audio.playSound("sfx_car_bounce")})}),m=0,Y.torque=0,new h({from:O.mesh.rotation.y,to:0,in:28,ease:"elastic",decay:3,oscillations:2,onUpdate:function(e,t){O.mesh.rotation.y=e}}),new h({from:O.mesh.rotation.z,to:0,in:2,ease:"linear",onUpdate:function(e,t){O.mesh.rotation.z=e}}),new h({from:O.mesh.rotation.x,to:.6,in:12,ease:"easeOutQuad",onUpdate:function(e,t){O.mesh.rotation.x=e},onComplete:function(){new h({from:.6,to:-.4,in:148,delay:0,ease:"easeInOutQuad",onUpdate:function(e,t){O.mesh.rotation.x=e},onComplete:function(){new h({from:-.4,to:0,in:26,delay:0,ease:"elastic",decay:4,oscillations:2,onUpdate:function(e,t){O.mesh.rotation.x=e}})}})}}),new h({from:f.speed,to:6*f.maxSpeed,in:8,delay:0,ease:"easeOutQuad",onStart:function(){},onUpdate:function(e,t){f.speed=e},onComplete:function(){new h({from:6*f.maxSpeed,to:1.5*f.maxSpeed,in:40,delay:0,ease:"easeOutCubic",onStart:function(){},onUpdate:function(e,t){f.speed=e},onComplete:function(){}}),new h({from:0,to:1,in:1,delay:146,ease:"elastic",onStart:function(){Y.collidable=!0,f.speed=f.maxSpeed},onUpdate:function(e,t){},onComplete:function(){L=!0,D=!1}})}});var p=e.getViewport();d.camera.fov,new h({from:d.camera.fov/(p.height/320),to:60,in:30,ease:"easeInOutQuad",onStart:function(){},onUpdate:function(e,t){d.camera.fov=e*(p.height/320),d.camera.updateProjectionMatrix()},onComplete:function(){new h({from:60,to:45,in:80,ease:"easeInOutQuad",onStart:function(){},onUpdate:function(e,t){d.camera.fov=e*(p.height/320),d.camera.updateProjectionMatrix()}})}}),u.timeout(6,function(){Y.sun.light.intensity=1.1,i=e.getGameSpeed(),new h({from:0,to:e.getGameSpeed(),in:6,delay:3,ease:"easeInQuad",ignoreGameSpeed:!0,onStart:function(){Y.sun.light.intensity=1},onUpdate:function(t,n){e.setGameSpeed(0)},onComplete:function(){e.setGameSpeed(i)}})}),Y.collidable=!1,L=!1,D=!0,Y.forceSkid=!1,Y.fire=!1,Y.progress.jump(),n.collidable=!1}}}),U=function(){Y.remove(F),L=!1,V=f.speed,W=u.sign(Y.mesh.rotation.y)||1,new h({from:1,to:0,in:60,ease:"easeOutQuad",onStart:function(){},onUpdate:function(e,t){V=e}}),f.speed=0},z=function(e){e?k&&(u.isArray(k)?k.forEach(function(e){e.activate()}):k.activate()):k&&(u.isArray(k)?k.forEach(function(e){e.deactivate()}):k.deactivate())},G=new b({});e.objects.attach(G);var H=[];u.repeat(u.isNativeAndroid()?3:5,function(){var e=new THREE.Vector3,t=new THREE.Vector3,n=d.Mesh({path:"coin",start:function(e){this.counter=0,this.skipFirstFrame=!0,this.mesh.position.x=2,this.mesh.position.z=-200},update:function(e){this.counter>70||(this.force.y-=.01*e.speed,this.mesh.position.x+=this.force.x*e.speed,this.mesh.position.y+=this.force.y*e.speed,this.mesh.position.z+=(f.speed-this.force.z)*e.speed,this.mesh.position.y<.35&&(this.force.y*=-.6,this.mesh.position.y-=.35,this.mesh.position.y=-this.mesh.position.y,this.mesh.position.y+=.35,this.force.z-=.4*this.force.z*e.speed),this.mesh.rotation.x+=this.torque.x*e.speed,this.mesh.rotation.y+=this.torque.y*e.speed,this.mesh.rotation.z+=this.torque.z*e.speed,this.counter+=e.speed,this.counter>70&&!this.skipFirstFrame&&(this.mesh.visible=!1),this.skipFirstFrame&&(this.counter=70,this.skipFirstFrame=!1))}});H.push(n),n.force=e,n.torque=t,n.setup=function(e,t){this.counter=0,this.mesh.position.copy(e),this.mesh.position.y+=.8*t,this.mesh.visible=!0}});var j=function(e,t,n){H.forEach(function(i){e.clone(i.force),i.torque.set(u.getRandomRange(-.3,.3),u.getRandomRange(-.3,.3),u.getRandomRange(-.3,.3)),i.force.multiplyScalar(.15),i.force.x+=u.getRandomRangeFloat(-.2,.2),i.force.y+=u.getRandomRangeFloat(-.05,.3),i.force.z+=u.getRandomRangeFloat(-.2,.2),i.force.z*=.3,i.force.z+=f.speed,i.setup(t,n)})},V=0,W=0,X=!1,q={name:"carBehavior",start:function(e){f.player=Y,O.mesh.updateMatrixWorld(),u.forEach(l,function(e){e.name.indexOf("tire")>-1?(C.push(e),R.push(e.getWorldPosition(new THREE.Vector3))):e.name.indexOf("exhaust")>-1&&(k?(u.isArray(k)||(k=[k]),k.push(new x({exhaustPipe:e})),Y.attach(k[k.length-1])):(k=new x({exhaustPipe:e}),Y.attach(k)))}),H.forEach(function(e){Y.attach(e)}),Y.collisionHelper=N,a.on("finish",U),G.hit({pointOfImpact:new THREE.Vector3(0,1,-200),direction:new THREE.Vector3(2,0,0)})},destroy:function(e){a.off("finish",U)},update:function(t){if(L){if(Y.go){var n=Y.virtual.x,i=f.speed/f.maxSpeed;n<0&&O.mesh.position.x<-4?n*=Math.max(0,(O.mesh.position.x+6)/4):n>0&&O.mesh.position.x>4&&(n*=Math.max(0,(6-O.mesh.position.x)/4)),m+=.15*(-(n*=i)*v-m)*t.speed,N.torque+=.5*(m-O.mesh.rotation.y-Y.torque),Y.torque+=N.torque,N.torque*=0,O.mesh.rotation.y+=Y.torque*t.speed,N.impulse.x+=.2*(-O.mesh.rotation.y/v*.28-Y.velocity.x),N.impulse.x+=f.cornerForce,Y.velocity.x+=N.impulse.x,N.impulse.x*=0,O.mesh.position.x+=Y.velocity.x*t.speed,O.mesh.rotation.z+=.3*(.1*O.mesh.rotation.y-O.mesh.rotation.z)*t.speed,O.mesh.position.y+=.3*(-.04*Math.abs(O.mesh.rotation.y/v)-O.mesh.position.y)*t.speed,O.mesh.position.x<-7?O.mesh.position.x=-7:O.mesh.position.x>7&&(O.mesh.position.x=7),Y.velocity.y=f.speed,O.mesh.updateMatrixWorld(),N.prepare()}Y.fire?z(!0):z(!1),_*=.7,(_=Math.min(_+Math.abs(Y.velocity.x/.28)*t.speed,1))>.6||Y.forceSkid||Y.fire?(X||(e.audio.stopSound("sfx_skidding2"),e.audio.playSound("sfx_skidding2",!0),X=!0),u.forEach(C,function(e,n,i,r){R[n].z+=f.speed*t.speed,e.getWorldPosition(I),P.subVectors(I,R[n]),R[n].copy(I),(Math.abs(I.x)<7.6||Y.fire)&&T&&new A({x:P.x,y:P.z,position:I,fire:Y.fire}),Y.forceSkid=!1}),Y.fire=!1,T++):(X=!1,e.audio.stopSound("sfx_skidding2"),T=0)}else D?(e.audio.stopSound("sfx_skidding2"),z(!0)):(e.audio.stopSound("sfx_skidding2"),z(!1),O.mesh.position.x+=Y.velocity.x*V*t.speed,O.mesh.position.z-=Y.velocity.y*V*t.speed*.6,(f.wallLeft&&O.mesh.position.x<-8.3||f.wallRight&&O.mesh.position.x>8.3||f.fallLeft&&O.mesh.position.x<-8.3||f.fallRight&&O.mesh.position.x>8.3)&&(O.mesh.position.x=(8.3-(Math.abs(O.mesh.position.x)-8.3))*u.sign(O.mesh.position.x),Y.velocity.x*=-1),O.mesh.rotation.y+=.12*W*V*t.speed,u.forEach(C,function(e,t,n,i){e.getWorldPosition(I),P.subVectors(I,R[t]),R[t].copy(I),new A({x:P.x,y:P.z,position:I,fade:.01})}),O.mesh.updateMatrixWorld(),N.prepare())},draw:function(e){}},Y=new o({z:0,name:"car",position:n.position,updateWhenPaused:0,components:[O,F,q,N,new Object({name:"cacher",count:0,update:function(){this.count++>0?(z(!1),Y.remove(this)):z(!0)}})]}).extend({mesh:O.mesh,collisionHelper:N,virtual:new t(0,0),velocity:new THREE.Vector2,torque:0,sun:null,camera3d:null,progress:null,forceSkid:!1,fire:!1,go:!1,collidable:!0});return Y}}),bento.define("entities/enemy",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/eventsystem","bento/gui/clickbutton","bento/gui/counter","bento/gui/text","bento/utils","bento/tween","modules/threejs","globals","components/collisionhelper","3d/coinfx","3d/playertag","modules/carinfo","materials/curvematerial","managers/vipmanager"],function(e,t,n,i,r,o,a,s,c,l,u,h,d,p,f,m,g,v,y,b){"use strict";var w=2*Math.PI,x=new THREE.Vector2,E=new THREE.Vector2,S=new THREE.Vector2,_=function(e,t,n,i,r){var o=e.collisionHelper,a=t.collisionHelper,s=u.sign(e.mesh.position.x-t.mesh.position.x),c=u.sign(e.mesh.position.z-t.mesh.position.z);x.copy(e.velocity),E.copy(t.velocity);var l=new THREE.Vector2(n.x-e.mesh.position.x,n.y-e.mesh.position.y),h=Math.sqrt(l.x*l.x+l.y*l.y),d=new THREE.Vector2(n.x-t.mesh.position.x,n.y-t.mesh.position.y),p=Math.sqrt(d.x*d.x+d.y*d.y);x.x*=10/30,E.x*=3;var f=new THREE.Vector2,m=new THREE.Vector2,g=new THREE.Vector2(n.x,n.z);f.subVectors(g,e.mesh.position),m.subVectors(g,t.mesh.position),S.subVectors(x,E),x.x/=10/30,E.x/=3;var v=1-Math.min(Math.abs(u.toDegree(u.radianDifference(Math.atan2(x.x,x.y),Math.atan2(f.x,f.y)))/90),1),y=1-Math.min(Math.abs(u.toDegree(u.radianDifference(Math.atan2(S.x,S.y),Math.atan2(f.x,f.y)))/90),1),b=1-Math.min(Math.abs(u.toDegree(u.radianDifference(Math.atan2(-S.x,-S.y),Math.atan2(m.x,m.y)))/90),1),w=1-Math.min(Math.abs(u.toDegree(u.radianDifference(Math.atan2(S.x,S.y),Math.atan2(m.x,m.y)))/90),1),_=1-w;e.velocity.x=0,t.velocity.x=0,o.impulse.x+=(3*E.x*b*_+x.x*(1-b)+i.x*s)/r.speed,o.impulse.y+=(3*E.y*b*w+i.y*-c*2)/r.speed;var T=new THREE.Vector2(d.x+E.x*b*w+x.x*(1-b)*y,d.y+E.y*b*w+x.y*(1-b)*y),M=Math.sqrt(T.x*T.x+T.y*T.y);e.torque=0,o.torque=.15*(M-h)/r.speed;var C=new THREE.Vector2(l.x+x.x*v*y+E.x*(1-v)*w,l.y+x.y*v*w+x.y*(1-v)*w),A=Math.sqrt(C.x*C.x+C.y*C.y);t.torque=0,a.torque=.12*u.clamp(-.4,p-A,.4)/r.speed};return function(n){var i=n.rank?n.rank:0,r=v.getCarMesh(i),s="car"+("00"+i).slice(-2);n.rank||(s+="a");var c,l=n.startPosition,h={},m=!1,x=new d.Mesh({path:"cars/"+r,start:function(t){l?(this.mesh.position.x=l.x,this.mesh.position.z=l.y):(this.mesh.position.x=u.getRandomRangeFloat(-6,6),this.mesh.position.z=-300),m||(n.vip?this.material=b.getMaterial(h.car.material,!0):this.material=h.car.material.clone()),m=!0,c=e.assets.getTexture("cars/"+s),this.material.map=c,this.material.emissiveMap=c,this.material.needsUpdate=!0,h.car.material=this.material},update:function(e){},destroy:function(e){c&&c.dispose(),this.material&&this.material.dispose()},attached:function(e){}});x.mesh.children.forEach(function(e){e.name&&(h[e.name]=e)});var E,S,T=new THREE.Vector3,M=new THREE.Vector3,C=[function(e){var t=d.camera,n=Math.abs(x.mesh.position.x-t.position.x);u.sign(x.mesh.position.x)!==u.sign(t.position.x)?B.virtual.x+=n<5?.05*((5-n)/5*u.sign(x.mesh.position.x-t.position.x)-B.virtual.x)*e.speed:.1*-B.virtual.x*e.speed:Math.abs(x.mesh.position.x)>Math.abs(t.position.x)?7-Math.abs(x.mesh.position.x)<n||n<2?B.virtual.x+=.05*(1*u.sign(t.position.x-x.mesh.position.x)-B.virtual.x):n<5?B.virtual.x=.05*((5-n)/5*u.sign(x.mesh.position.x-t.position.x)-B.virtual.x):B.virtual.x+=.1*-B.virtual.x*e.speed:B.virtual.x+=.1*-B.virtual.x*e.speed},function(e){0===B.ticker&&(B.virtual.x=u.pickRandom(-1,1)),B.virtual.x=u.clamp(-.6,B.virtual.x-.01*u.sign(x.mesh.position.x),.6)},function(e){var t=-u.sign(x.mesh.position.x),n=1-Math.min(Math.max(0,Math.abs(x.mesh.position.x)-5)/2,1);B.virtual.x=u.clamp(-1,B.virtual.x+u.getRandomRangeFloat(-.1,.1),1),-t===u.sign(B.virtual.x)&&(B.virtual.x*=n)},function(){},function(e){var t=d.camera,n=Math.abs(x.mesh.position.z);if(n<120){var i=u.clamp(-1.6,(t.position.x-x.mesh.position.x)/4,1.6);!function(e){if(n>60)return B.virtual.x+=e;e=B.virtual.x+e;var t=Math.abs(p.player.mesh.position.x-x.mesh.position.x)/25;B.virtual.x=e*t+p.player.virtual.x*(1-t)}(.8*(1.2*(1-Math.max(0,n-82)/38)*i-B.virtual.x))}}],A=new f({car:h.car,model:x.mesh,solveForces:_,impact:function(e,t){!function(e,t){B.collidable=!1,P=!1,O||(p.standings.unshift(B),p.crashes++,a.fire("standing"),O=!0,n.first&&B.remove(E)),T.x=1*A.impulse.x,T.z=1.24*p.maxSpeed+.8*Math.min(A.impulse.y,.35),T.y=.3,M.y=A.torque;var i=(e.x-x.mesh.position.x)/A.width,r=(x.mesh.position.z-e.z)/A.length,o=Math.abs(r)/Math.abs(i);o=o>1?1:0,M.x=i*o,M.z=.3*r*(1-o);var s=M.length();s>.25&&(M.divideScalar(s),M.multiplyScalar(u.getRandomRangeFloat(.18,.22)));var c=A.height/2;x.mesh.children.forEach(function(e){e.position.y-=c}),x.mesh.position.y+=c}(e)}}),R=new g({playerName:n.botName,country:n.botCountry,target:x.mesh,physical:A}),P=!0,I=0,L=14/360*w,D=!0,O=!1,k=!1,F={name:"behaviorComponent",time:0,start:function(e){B.collisionHelper=A,S=!p.tutorialRace||p.tutorialOpponentCount-- >6?C[u.getRandom(4)]:C[4]},destroy:function(e){},update:function(t){var i,r;if(this.time+=t.speed,D)r=p.maxSpeed*(1.4+3*n.distanceStrength)*Math.min(this.time/170,1)-u.clamp(0,this.time-150,20)/20*.2,B.velocity.y+=.1*(r-B.velocity.y),B.velocity.y+=A.impulse.y*t.speed,A.impulse.y*=Math.max(0,1-t.speed),x.mesh.position.z+=(p.speed-B.velocity.y)*t.speed,this.time>=170&&(D=!1);else if(P){S(t);var o=B.virtual.x,s=p.speed/p.maxSpeed;o<0&&x.mesh.position.x<-4?o*=Math.max(0,(x.mesh.position.x+6)/2):o>0&&x.mesh.position.x>4&&(o*=Math.max(0,(6-x.mesh.position.x)/2)),o*=s,i=1-Math.min(x.mesh.position.y/300,1),I+=.08*(-o*L-I)*t.speed,A.torque+=.3*(I-x.mesh.rotation.y-B.torque)+.8*p.cornerForce*i,B.torque+=A.torque,A.torque*=0,x.mesh.rotation.y+=B.torque*t.speed,A.impulse.x+=.3*(-x.mesh.rotation.y/L*.17-B.velocity.x),A.impulse.x+=.5*p.cornerForce*i,B.velocity.x+=A.impulse.x,A.impulse.x*=0,x.mesh.position.x+=B.velocity.x*t.speed,x.mesh.rotation.z+=.3*(.05*x.mesh.rotation.y-x.mesh.rotation.z)*t.speed,x.mesh.position.y+=.3*(-.04*Math.abs(x.mesh.rotation.y/L)-x.mesh.position.y)*t.speed,r=p.maxSpeed-.42,B.velocity.y+=.1*(r-B.velocity.y),B.velocity.y+=A.impulse.y*t.speed,A.impulse.y*=Math.max(0,1-t.speed),x.mesh.position.z+=(p.speed-B.velocity.y)*t.speed,x.mesh.updateMatrixWorld(),A.prepare(),!O&&x.mesh.position.z>=0?(O=!0,p.standings.unshift(B),a.fire("standing"),n.first&&B.remove(E)):!k&&p.distance-x.mesh.position.z>=p.maxDistance&&(k=!0,p.leaderboard.push(B))}else{T.y-=.01*t.speed,x.mesh.position.x+=T.x*t.speed,x.mesh.position.y+=T.y*t.speed,x.mesh.position.z+=(p.speed-T.z)*t.speed;var c=p.cornerForce+Math.min(Math.abs(x.mesh.position.z/20),1)*(p.crashForce-p.cornerForce);x.mesh.position.x+=40*c*t.speed,x.mesh.rotation.x+=M.x*t.speed,x.mesh.rotation.y+=M.y*t.speed,x.mesh.rotation.z+=M.z*t.speed;var l=A.height/2;if((p.wallLeft&&x.mesh.position.x<-10||p.wallRight&&x.mesh.position.x>10)&&(x.mesh.position.x=(10-(Math.abs(x.mesh.position.x)-10))*u.sign(x.mesh.position.x),T.x*=-1),x.mesh.position.y<l&&!(p.fallLeft&&x.mesh.position.x<-12)&&!(p.fallRight&&x.mesh.position.x>12)){if(Math.abs(T.z)>.4){var h=e.assets.getAudio("sfx_car_bounce");e.audio.stopSound("sfx_car_bounce"),e.audio.setVolume(.8*(1-Math.min(1,Math.abs(x.mesh.position.z)/250)),"sfx_car_bounce"),e.audio.playSound("sfx_car_bounce"),h.bufferSource&&(h.bufferSource.playbackRate.value=.6+u.getRandomFloat(.7))}x.mesh.position.y-=l,x.mesh.position.y=-x.mesh.position.y,x.mesh.position.y+=l,T.y<.9&&x.mesh.position.z>-40?T.y=-T.y*Math.min(T.z/1.8,1):T.y=-T.y,T.z>.6&&x.mesh.position.z>-70&&(T.z*=.7),T.x*=.6,M.x+=u.getRandomRangeFloat(-.14,.14),M.y+=u.getRandomRangeFloat(-.14,.14),M.z+=u.getRandomRangeFloat(-.14,.14);var d=M.length();d>.25&&(M.divideScalar(d),M.multiplyScalar(u.getRandomRangeFloat(.18,.22)))}}x.mesh.position.z>25&&(e.objects.remove(B),n.spawner&&n.spawner.die(B))},draw:function(e){}},B=new o({z:0,name:"enemy",family:["enemies"],position:n.position,updateWhenPaused:0,components:[x,F,A,R]}).extend({mesh:x.mesh,collisionHelper:A,collidable:!0,virtual:new t(0,0),velocity:new THREE.Vector2,torque:0,playerName:n.botName,playerCountry:n.botCountry,reset:function(){if(l?(x.mesh.position.x=u.getRandomRangeFloat(-6.5,6.5),x.mesh.position.z=l.y):(x.mesh.position.x=u.getRandomRangeFloat(-6,6),x.mesh.position.z=-300),x.mesh.rotation.set(0,0,0),!P){var e=A.height/2;x.mesh.children.forEach(function(t){t.position.y+=e}),x.mesh.position.y=0}T.set(0,0,0),M.set(0,0,0),B.virtual.x=B.virtual.y=0,B.velocity.x=B.velocity.y=0,B.torque=0,A.torque=0,A.impulse.x=A.impulse.y=0,I=0,F.time=0,P=!0,D=!0,O=!1,k=!1,S=C[u.getRandom(4)],this.collidable=!0},finishSequence:function(){this.reset(),this.remove(R),this.velocity.y=A.impulse.y=p.maxSpeed-.42,l.y=20,this.collidable=!0,n.spawner=!1,D=!1}});if(n.first&&!p.noFirstPlayer){var N=e.assets.getTexture("ui/rival-marker"),U=new y({map:N,color:16777215,specular:0,emissiveMap:N,emissive:16777215,emissiveIntensity:1,transparent:!0});E=new d.Primitive({shape:"plane",parameters:[2,2],material:U,start:function(e){this.mesh.position.y=A.height+3,this.mesh.renderOrder=99,U.emissiveMap.needsUpdate=!0},update:function(e){this.mesh.position.x=x.mesh.position.x,this.mesh.position.z=x.mesh.position.z;var t=Math.max(1,this.mesh.position.z/-30);this.mesh.position.y=A.height+2+t,this.mesh.scale.set(t,t,t)},destroy:function(e){U.dispose(),N.dispose()},attached:function(e){}}),B.attach(E)}return B}}),bento.define("entities/luckykatlogo",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/utils","bento/tween"],function(e,t,n,i,r,o,a,s){"use strict";return function(n){var r=e.getViewport();return new o({z:1,name:"luckyKatLogo",position:new t(r.width/2,r.height/2),components:[new i({imageName:"luckykat-160",originRelative:new t(.5,.5)})]})}}),bento.define("entities/tutorial",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/eventsystem","bento/gui/clickbutton","bento/gui/counter","bento/gui/text","bento/utils","bento/tween","bento/components/fill","managers/textstyles","components/hdsprite","globals","gui/main/mergeboard","modules/savemanager","components/modulate","modules/abtest","modules/localization","gui/general/askrating","modules/cloudsavemanager","gui/main/cloudsavedialog","bento/components/anchor","modules/banner"],function(e,t,n,i,r,o,a,s,c,l,u,h,d,p,f,m,g,v,y,b,w,x,E,S,_,T){"use strict";return function(i){var s,c,b,x,M,C,A,R,P,I,L=e.getViewport(),D=i.state,O=0,k=null,F=!1,B=function(){var e=T.shouldShow();if(F!==e){F=e;var t=e?-13:13;C&&D<8&&(C.position.y+=t,s&&C.z===m.MergeLayers.TUTORIALOBJECTS&&(s.position.y+=t),L.height>340&&(C.position.y+=t/2,s.position.y+=t/2),_.getSafeZone().height!==L.height&&(C.position.y+=t/2,s.position.y+=t/2)),D<5&&(P&&(P.position.y-=t,s.position.y-=t),x&&(x.position.y+=2.3*t),b&&(b.position.y+=2.3*t)),H.position.y+=t}},N=!1,U=function(){console.log("crash"),N=!0,a.off("crashedChanged",U)},z=function(){O=0,H.remove(b),H.remove(x),new h({from:0,to:1,in:12,ease:"easeInQuad",ignoreGameSpeed:!0,onUpdate:function(t,n){s.alpha=1-t,P.alpha=1-t,e.setGameSpeed(t)},onComplete:function(){H.remove(s),H.remove(P),O=0}}),D++,a.off("keyboardControlsChanged",z)},G={name:"behaviorComponent",start:function(e){g.freeGifts=!1,0===D&&(m.tutorialRace=!0,m.tutorialOpponentCount=m.opponents,m.tutorial=!0),D<8&&(m.mainButtonFocus=1),m.noFreeCarDialog=!0,a.on("crashedChanged",U),a.on("keyboardControlsChanged",z),a.on("bannerStatusChanged",B)},destroy:function(e){m.tutorial=!1,a.off("keyboardControlsChanged",z),a.off("bannerStatusChanged",B)},update:function(i){var _,T,F;if(0===D)(_=e.screens.getCurrentScreen())&&"screens/race"===_.name&&(new h({from:1,to:0,in:5,delay:75,ease:"easeOutQuad",ignoreGameSpeed:!0,onUpdate:function(t,n){e.setGameSpeed(t)}}),D++,(u.isNativeIos()||u.isDev())&&u.timeout(30,function(){E.checkCloudNewer(function(t){if(t){e.audio.muteSound(!0),e.objects.pause(1);var n=new S({z:m.RaceLayers.GUI,updateWhenPaused:1,beforeLoad:function(){e.audio.muteSound(!1)},onComplete:function(){e.objects.pause(0)}});e.objects.attach(n)}})}));else if(1===D){if((_=e.screens.getCurrentScreen())&&"screens/race"===_.name&&O++>80){var B;s=new l({position:new t(0,0),text:w.getText("tutorial1"),fontSettings:p.get("white10"),align:"center",maxWidth:L.width-20,shadow:!0,shadowOffset:new t(1.4,1.4),shadowColor:"#000000"}),T=L.width/2,s.position.x=T,s.position.y=.3*L.height,b=f({gamepixelDimension:new n(0,0,56,70),imageName:"gui/home/poke_hand",originRelative:new t(.15,.1)}),x=f({gamepixelDimension:new n(0,0,120,36),
imageName:"gui/gameplay/leftright_arrows",originRelative:new t(.5,.55)}),b.position.x=T,b.position.y=.85*L.height,b.attach({timer:0,name:"handMover",update:function(){b.position.x=T+46*Math.sin(this.timer/15),this.timer++}});var U=0;b.attach(new r({pointerDown:function(e){null===k&&(k=e.id,B=e.position.x)},pointerMove:function(t){k===t.id&&(B&&(U+=Math.abs(t.position.x-B)),B=t.position.x,U>4&&(O=0,H.remove(b),H.remove(x),new h({from:0,to:1,in:12,ease:"easeInQuad",ignoreGameSpeed:!0,onUpdate:function(t,n){s.alpha=1-t,P.alpha=1-t,e.setGameSpeed(t)},onComplete:function(){H.remove(s),H.remove(P)}}),D++))}})),x.position.x=T,x.position.y=b.position.y,R=new d({name:"fill",dimension:new n(0,0,L.width+20,56),color:[0,0,0,.3],originRelative:new t(.5,.5)}),P=new o({name:"fillContainer",position:new t(L.width/2,.3*L.height),rotation:-.16,components:[R]}),new h({from:-L.width-20,to:0,in:6,applyOnDelay:!0,ignoreGameSpeed:!0,onStart:function(){},onUpdate:function(e,t){R.dimension.x=e},onComplete:function(){}}),H.attach(P),H.attach(x),H.attach(b),H.attach(s),D++}}else 3===D?(_=e.screens.getCurrentScreen())&&"screens/race"===_.name&&O++>140&&(O=0,s.setText(w.getText("tutorial2")),H.attach(P),P.alpha=1,H.attach(s),s.alpha=1,x={name:"crashChecker",update:function(t){O+=t.speed,(N||O>1500)&&(console.log(O),console.log(e.objects.get("crashFx")),e.saveState.save("tutorial",5),s.remove(x),new h({from:1,to:0,in:12,ease:"easeInQuad",onUpdate:function(e,t){s.alpha=e,P.alpha=e},onComplete:function(){H.remove(s),H.remove(P)}}))}},s.attach(x),new h({from:-L.width-20,to:0,in:6,applyOnDelay:!0,ignoreGameSpeed:!0,onStart:function(){},onUpdate:function(e,t){R.dimension.x=e},onComplete:function(){}}),g.earnings=2e3/1.3/32,D++):4===D?e.objects.get("raceFinish",function(e){e.getComponent("uiContainer",function(e){e.getComponent("increaseButton",function(t){e.remove(t)}),e.getComponent("collectButton",function(e){e.position.y-=20}),D++})}):5===D?(g.balloonSpawn=-10,(_=e.screens.getCurrentScreen())&&"screens/main"===_.name&&(M=e.objects.get("mainMenu"),I=e.objects.getByFamily("cars"),M&&(0===v.load("coins")&&v.save("coins",2e3),I.length>0&&M.getComponent("mainMenu",function(i){var r=e.objects.get("mergeBoard"),u=r.getMergeables();s=new l({position:new t(0,0),text:u?w.getText("tutorial4"):w.getText("tutorial3"),fontSettings:p.get("white10"),align:"center",maxWidth:L.width-20}),T=L.width/2,s.position.x=T,s.z=m.MergeLayers.TUTORIALOBJECTS,e.objects.attach(s),(b=f({gamepixelDimension:new n(0,0,28,35),imageName:"gui/home/poke_hand",originRelative:new t(.15,.1)})).z=m.MergeLayers.TUTORIALHAND,b.rotation=3.5,e.objects.attach(b),(c=new o({name:"background",components:[new d({name:"fill",color:[0,0,.1,.5]})]})).z=m.MergeLayers.TUTORIALBACKGROUND,e.objects.attach(c);var y=!0;m.mainButtonFocus=1;var E=function(){e.saveState.save("tutorial",8),new h({from:1,to:0,in:20,delay:0,ease:"easeInQuad",onStart:function(){},onUpdate:function(e,t){b.alpha=e,s.alpha=e,c.alpha=e},onComplete:function(){b.alpha=1,s.alpha=1,c.alpha=1,e.objects.remove(b),e.objects.remove(s),e.objects.remove(c),m.mainButtonFocus=0}}),g.mainButtonFocus=0,C.mainButtonFocus=0,m.mainButtonFocus=0,e.objects.get("carUnlockDialog",function(e){e.attach({name:"setButtonFocus",destroy:function(){m.mainButtonFocus=0}})}),C.z=m.MergeLayers.MAINMENU,I.forEach(function(e){e.z=m.MergeLayers.MERGECARS}),D=8};x={timer:0,state:u?1:0,name:"handMover",start:function(){C.previousPosition=C.position,C.footer=F,C.position=C.toWorldPosition(C.position).clone(),C.removeByName("positioner"),F.remove(C),e.objects.attach(C),u?(g.mainButtonFocus=1,u.a.z=m.MergeLayers.TUTORIALOBJECTS,u.b.z=m.MergeLayers.TUTORIALOBJECTS,s.position.y=.34*L.height,b.position.x=T+-60,b.position.y=.68*L.height-43,y=!1):(C.mainButtonFocus=1,b.position.x=C.position.x,b.position.y=C.position.y-32,s.position.y=C.position.y-78,C.z=m.MergeLayers.TUTORIALOBJECTS)},update:function(){var e=u;if(u=r.getMergeables())if(this.state%2==0&&(this.state++,C.mainButtonFocus=0,g.mainButtonFocus=1,y?(a.fire("FTUE_BUYFIRSTCAR"),y=!1):s.visible=!1,C.z=m.MergeLayers.MAINMENU,s.setText(w.getText("tutorial4")),s.position.y=.34*L.height,b.position.x=T+-60,b.position.y=.68*L.height-43,this.timer=0),b.visible=!0,!e||e.a===u.a&&e.b===u.b||(e.a.z=m.MergeLayers.MERGECARS,e.b.z=m.MergeLayers.MERGECARS),u.a.z=m.MergeLayers.TUTORIALOBJECTS,u.b.z=m.MergeLayers.TUTORIALOBJECTS,u.a.touchable&&u.b.touchable){var t=(u.b.position.x-u.a.position.x)/2,n=(u.b.position.y-u.a.position.y)/2,i=u.a.position.x+t,o=u.a.position.y+n;b.position.x=i+t*Math.sin(this.timer/12),b.position.y=o+n*Math.sin(this.timer/12)-25}else b.visible=!1;else{if(b.visible=!0,y||(s.visible=!1),this.state%2==1){if(v.load("rank")>=1)return void E();C.mainButtonFocus=1,g.mainButtonFocus=0,C.z=m.MergeLayers.TUTORIALOBJECTS,s.setText(w.getText("tutorial3")),I.forEach(function(e){e.z=m.MergeLayers.MERGECARS}),this.timer=0,this.state++}b.position.x=C.position.x,b.position.y=C.position.y-32+2*Math.sin(this.timer/8)}if(v.load("rank")>=1)return g.freeGifts=!0,void E();this.timer++}},D++,F=i.getComponent("footer"),C=F.getComponent("quickBuyButton"),A=i.getComponent("center").getComponent("raceButton"),b.attach(x)})))):6===D||7===D?g.balloonSpawn=-10:8===D?(_=e.screens.getCurrentScreen())&&"screens/race"===_.name?(e.saveState.save("tutorial",10),e.objects.remove(H)):(g.balloonSpawn=-10,M||(M=e.objects.get("mainMenu")),M&&(M.getComponent("mainMenu",function(e){C||(F=e.getComponent("footer"),C=F.getComponent("quickBuyButton"),A=e.getComponent("center").getComponent("raceButton"))}),C&&(C.active||(s?s.setText(w.getText("tutorial5")):(s=new l({position:new t(0,0),text:w.getText("tutorial5"),fontSettings:p.get("white10"),align:"center",maxWidth:L.width-20}),T=L.width/2,s.position.x=T,s.z=m.MergeLayers.TUTORIALOBJECTS),s.visible=!0,s.position.y=.34*L.height,c||((c=new o({name:"background",components:[new d({name:"fill",color:[0,0,.1,.5]})]})).z=m.MergeLayers.TUTORIALBACKGROUND),e.objects.attach(s),e.objects.attach(c),A.removeByName("positioner"),A.position=A.toWorldPosition(A.position).clone(),A.parent.remove(A),e.objects.attach(A),A.z=m.MergeLayers.TUTORIALOBJECTS,A.attach(new y({strength:.1,speed:21})),D++)))):9===D&&((_=e.screens.getCurrentScreen())&&"screens/race"===_.name?(e.saveState.save("tutorial",10),e.objects.remove(H),s&&s.isAdded&&e.objects.remove(s),c&&c.isAdded&&e.objects.remove(c)):(g.balloonSpawn=-10,C.active&&(e.saveState.save("tutorial",10),e.objects.remove(H),new h({from:1,to:0,in:20,delay:40,ease:"easeInQuad",onStart:function(){},onUpdate:function(e,t){s.alpha=e,c.alpha=e},onComplete:function(){s.alpha=1,c.alpha=1,e.objects.remove(b),e.objects.remove(s),e.objects.remove(c),s&&s.isAdded&&e.objects.remove(s),c&&c.isAdded&&e.objects.remove(c),A.z=m.MergeLayers.MAINMENU}}))))},draw:function(e){}},H=new o({name:"tutorial",position:i.position,updateWhenPaused:0,global:!0,components:[G]});return H}}),bento.define("managers/buff",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/eventsystem","bento/gui/clickbutton","bento/gui/counter","bento/gui/text","bento/utils","bento/tween","globals","modules/savemanager"],function(e,t,n,i,r,o,a,s,c,l,u,h,d,p){"use strict";return function(e){var t={doubleCoin:p.load("doubleTime"),addToDoubleCoin:function(e){t.doubleCoin+=e,p.save("doubleTime",t.doubleCoin)}};return d.buffs=t,new o({name:"buffManager",updateWhenPaused:999999999999,components:[{name:"behaviorComponent",start:function(e){},destroy:function(e){p.save("doubleTime",t.doubleCoin)},update:function(e){if(t.doubleCoin){var n=Math.ceil(t.doubleCoin/60/4);t.doubleCoin-=e.speed,t.doubleCoin<0&&(t.doubleCoin=0,a.fire("updateEarnings")),Math.ceil(t.doubleCoin/60/4)!==n&&p.save("doubleTime",t.doubleCoin)}},draw:function(e){}}]})}}),bento.define("managers/experience",["bento","bento/eventsystem","bento/utils","modules/savemanager"],function(e,t,n,i){"use strict";var r=i.load("rank"),o=function(e){return 30*Math.pow(2,e)},a=o(r),s=i.load("experience"),c=function(){for(var e=r;s>=a;)s-=a,a=o(++r);r!==e&&i.save("rank",r)};return c(),{getRank:function(){return r},getExperience:function(){return s},addExperience:function(e){s+=e,c(),t.fire("updateExperience",{rank:r,experience:s}),i.save("experience",s)},getCarExperience:function(e){return 10*Math.pow(1.9,e)},getRankExperience:o,refresh:function(){r=i.load("rank"),a=o(r),s=i.load("experience"),c()}}}),bento.define("managers/meshmanager",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/utils","bento/tween"],function(e,t,n,i,r,o,a,s){"use strict";var c={},l={},u=new THREE.FBXLoader,h=function(e,t,n,i){u.load(t,function(t){var i,r;for(i in t.children)(r=t.children[i])&&(a.isUndefined(r.material)||r.material.emissiveIntensity&&(r.material.emissiveMap||(r.material.emissiveMap=r.material.map)));c[e]=t,n&&n(e)},void 0,function(e){console.error(e)},i)},d={getMesh:function(e){var t=c[e+".fbx"];return t?t.clone():(a.log("ERROR: Mesh "+e+" could not be found"),null)},hasMesh:function(e){return!!c[e+".fbx"]},getTexture:function(t){var n=l[t];if(n)return n;if(e.assets.hasAsset(t,"images")){var i=e.assets.getImage(t);return(n=new THREE.Texture(i.image)).needsUpdate=!0,l[t]=n,n}return a.log("ERROR: Texture and Image "+t+" could not be found"),null},hasTexture:function(t){return!!l[t]||!!e.assets.hasAsset(t,"images")},loadMesh:function(t,n,i,r){var o=e.assets.getAssetGroups()[t],s=0,c=0,l=[],u=function(e){s++,i(s,c,e),(0===c||c>0&&s===c)&&n(null,t)};a.isDefined(o)?(a.isDefined(o.geometry)&&(c+=a.getKeyLength(o.geometry),a.forEach(o.geometry,function(e,t,n,i){var r;a.isArray(e)||(e=[e]),a.forEach(e,function(e){e.indexOf(".fbx")>-1?(r=o.path+"geometry/"+e,l.push({asset:e,path:r})):c--})})),function(){var e,t,n=0;for(n=0,e=l.length;n<e;++n)(t=l[n])&&h(t.asset,t.path,u,r);0===l.length&&u("done")}()):n("Could not find mesh group "+t)}};return a.extend(e.assets,d),console.log("Assetmanager extended with mesh functions"),e.assets}),bento.define("managers/pricing",["bento","bento/math/vector2","bento/math/rectangle","bento/entity","bento/eventsystem","bento/utils","bento/tween","modules/savemanager"],function(e,t,n,i,r,o,a,s){"use strict";var c,l=s.load("carRank"),u=[],h=[],d=[],p=0,f=["","K","M","B","T"],m=Math.log(1e3),g=f.length,v=function(e,t){return t=t||s.load("boughtCar-"+e),2*(100*Math.pow(Math.pow(e,2),1.5)+Math.pow(5,e)*Math.pow(t,1.2))},y=function(e){h[e]=v(e+1,u[e]),d[e]=v(e+1,u[e]+1)},b=function(){var e=Math.max(2,l-3);p=e-1;for(var t=Math.max(0,l-9);t<e;t++){if(h[t+1]&&h[t]+d[t]<h[t+1]){p=t;break}if(!h[t+1]){p=t;break}}r.fire("refreshQuickBuy")},w=function(){for(var e=0;e<l+1;e++)u[e]=s.load("boughtCar-"+e),y(e);b(),c=80*Math.pow(Math.pow(l,2),1.4)};return w(),{shorten:function(e){if(e<=999)return Math.floor(e).toString();var t=Math.floor(Math.log(e)/m),n=e/Math.pow(1e3,t),i=t-g,r=(Math.floor(100*n)/100).toFixed(2);return r.endsWith(".00")?r=r.replace(".00",""):r.endsWith("0")||5===r.length?r=r.slice(0,-1):6===r.length&&(r=r.slice(0,-3)),t<g?r+f[t]:r+String.fromCharCode(97+Math.floor(i/26),97+i%26)},getPrice:v,getPrices:function(e){return{current:h[e-1],next:d[e-1]}},checkUnlock:function(e){return e>l&&(u[l]=0,y(l),s.save("carRank",++l),c=80*Math.pow(Math.pow(l,2),1.4),!0)},fireRank:function(){r.fire("carRank",l)},buy:function(e){s.save("boughtCar-"+e,++u[e]),y(e),b()},quickBuy:function(){return{car:p,price:h[p]}},earning:function(e){return Math.floor(Math.pow(2.098,e+2))/3},levelUpReward:function(e){return 60*Math.floor(Math.pow(2.098,e+2))},getCurrentPrice:function(e){return h[e]},getCrashPrice:function(){return c},getRank:function(){return l},refresh:function(){u=[],h=[],d=[],p=0,w(),l=s.load("carRank")},levelUpGems:function(e){switch(e){case 1:case 2:return 1;case 3:case 4:return 2;case 5:case 6:return 3;default:return 3+2*(e-6)}},gemPrice:function(e){switch(e){case 2:return 2;case 3:case 4:return 3;case 5:case 6:return 4;case 7:case 8:return 5;case 9:case 10:return 6;case 11:return 8;case 12:return 10;default:return 10+5*(e-12)}}}}),bento.define("managers/textstyles",["bento","bento/math/vector2","bento/math/rectangle","bento/entity","bento/eventsystem","bento/utils","bento/tween","modules/localization"],function(e,t,n,i,r,o,a,s){"use strict";var c={get:function(e){var t,n={};return c.hasOwnProperty(e)&&(n=o.copyObject(c[e])),n.hasOwnProperty("font")&&l.hasOwnProperty(n.font)&&(t=l[n.font].hasOwnProperty(s.getLanguage())?l[n.font][s.getLanguage()]:l[n.font].default,n.font=t.fontName,t.hasOwnProperty("scale")&&1!==t.scale&&n.hasOwnProperty("fontSize")&&(n.fontSize=Math.round(t.scale*n.fontSize)),0===t.offset.x&&0===t.offset.y||(n.offset=o.copyObject(t.offset),n.offset.x=n.offset.x*(n.fontSize/8),n.offset.y=n.offset.y*(n.fontSize/8))),n},getFont:function(e){return l[e].hasOwnProperty(s.getLanguage())?l[e][s.getLanguage()]:l[e].default}},l={thin:{default:{fontName:"montserrat-medium-italic",offset:{x:0,y:0},scale:1}},regular:{default:{fontName:"montserrat-black-italic",offset:{x:0,y:0},scale:1}},alternate:{default:{fontName:"montserrat-alt-black",offset:{x:0,y:0},scale:1}}},u=new t(4,4);return c.white5={font:"regular",fontSize:5,fontColor:"rgb(255, 255, 255)",textBaseline:"middle",align:"center",antiAlias:!0,margin:u},c.white6={font:"regular",fontSize:6,fontColor:"rgb(255, 255, 255)",textBaseline:"middle",align:"center",antiAlias:!0,margin:u},c.white7={font:"regular",fontSize:7,fontColor:"rgb(255, 255, 255)",textBaseline:"middle",align:"center",antiAlias:!0,margin:u},c.white8={font:"regular",fontSize:8,fontColor:"rgb(255, 255, 255)",textBaseline:"middle",align:"center",antiAlias:!0,margin:u},c.white10={font:"regular",fontSize:10,fontColor:"rgb(255, 255, 255)",textBaseline:"middle",antiAlias:!0,margin:u},c.white12={font:"regular",fontSize:12,fontColor:"rgb(255, 255, 255)",textBaseline:"middle",antiAlias:!0,margin:u},c.white14={font:"regular",fontSize:14,fontColor:"rgb(255, 255, 255)",textBaseline:"middle",antiAlias:!0,margin:u},c.white16={font:"regular",fontSize:16,fontColor:"rgb(255, 255, 255)",antiAlias:!0,margin:u},c.white18={font:"regular",fontSize:18,fontColor:"rgb(255, 255, 255)",textBaseline:"bottom",antiAlias:!0,margin:u},c.red={font:"regular",fontSize:25,fontColor:"rgb(220, 0, 0)",textBaseline:"middle",antiAlias:!0,margin:u},c.black6={font:"regular",fontSize:6,fontColor:"rgb(58, 58, 58)",textBaseline:"middle",antiAlias:!0,margin:u},c.black7={font:"regular",fontSize:7,fontColor:"rgb(58, 58, 58)",textBaseline:"middle",antiAlias:!0,margin:u},c.black8={font:"regular",fontSize:8,fontColor:"rgb(58, 58, 58)",textBaseline:"middle",align:"center",antiAlias:!0,margin:u},c.black10={font:"regular",fontSize:10,fontColor:"rgb(58, 58, 58)",textBaseline:"middle",align:"center",antiAlias:!0,margin:u},c.black12={font:"regular",fontSize:12,fontColor:"rgb(58, 58, 58)",textBaseline:"middle",antiAlias:!0,margin:u},c.black14={font:"regular",fontSize:14,fontColor:"rgb(58, 58, 58)",textBaseline:"middle",antiAlias:!0,margin:u},c.black15={font:"regular",fontSize:15,fontColor:"rgb(58, 58, 58)",textBaseline:"middle",antiAlias:!0,margin:u},c.black16={font:"regular",fontSize:16,fontColor:"rgb(58, 58, 58)",textBaseline:"middle",antiAlias:!0,margin:u},c.black18={font:"regular",fontSize:18,fontColor:"rgb(58, 58, 58)",textBaseline:"middle",antiAlias:!0,margin:u},c.black20={font:"regular",fontSize:20,fontColor:"rgb(58, 58, 58)",textBaseline:"middle",antiAlias:!0,margin:u},c.black22={font:"regular",fontSize:22,fontColor:"rgb(58, 58, 58)",textBaseline:"middle",antiAlias:!0,margin:u},c.black26={font:"regular",fontSize:26,fontColor:"rgb(58, 58, 58)",textBaseline:"middle",antiAlias:!0,margin:u},c.collect={font:"regular",fontSize:10,fontColor:"rgb(137, 137, 137)",textBaseline:"middle",antiAlias:!0,margin:u},c.coinBonusButton={font:"regular",fontSize:6,fontColor:"rgb(137, 137, 137)",textBaseline:"middle",antiAlias:!0,margin:u},c.coinBonusInfo={font:"regular",fontSize:8,fontColor:"rgb(137, 137, 137)",textBaseline:"middle",antiAlias:!0,margin:u},c.levelUpRank={font:"regular",fontSize:24,fontColor:"rgb(255, 238, 31)",align:"center",textBaseline:"middle",antiAlias:!0,margin:u},c.nameInput={font:"thin",fontSize:8,fontColor:"rgb(255, 255, 255)",align:"center",textBaseline:"middle",antiAlias:!0,margin:u},c.rewardPlayerName={font:"thin",fontSize:8,fontColor:"rgb(58, 58, 58)",align:"center",textBaseline:"middle",antiAlias:!0,margin:u},c.gamePlayerName={font:"thin",fontSize:8,fontColor:"rgb(255, 255, 255)",align:"left",textBaseline:"middle",antiAlias:!0,margin:u},c.eliminatedPlayer={font:"thin",fontSize:4,fontColor:"rgb(255, 255, 255)",align:"left",textBaseline:"middle",antiAlias:!0,margin:u},c.eliminated={font:"regular",fontSize:7,fontColor:"rgb(58, 58, 58)",textBaseline:"middle",antiAlias:!0,margin:u},c.goodJob={font:"regular",fontSize:32,fontColor:"rgb(0, 0, 0)",textBaseline:"middle",antiAlias:!0,margin:u},c.finish={font:"regular",fontSize:28,fontColor:"rgb(0, 0, 0)",textBaseline:"middle",antiAlias:!0,margin:u},c.crashReward={font:"regular",fontSize:14,fontColor:"rgb(255, 255, 255)",textBaseline:"middle",antiAlias:!0,margin:u},c.statWhite={font:"thin",fontSize:8,fontColor:"rgb(255, 255, 255)",align:"left",textBaseline:"middle",antiAlias:!0,margin:u},c.gemRewardWheel={font:"regular",fontSize:12,fontColor:"rgb(1, 243, 161)",align:"center",textBaseline:"middle",antiAlias:!0,margin:u,strokeStyle:"#024833",innerStroke:!1},c.coinRewardWheel={font:"regular",fontSize:12,fontColor:"rgb(254, 252, 88)",align:"center",textBaseline:"middle",antiAlias:!0,margin:u,strokeStyle:"#6b2829",innerStroke:!1},c.boxRewardWheel={font:"regular",fontSize:12,fontColor:"rgb(255, 255, 255)",align:"center",textBaseline:"middle",antiAlias:!0,margin:u,strokeStyle:"#1d2433",innerStroke:!1},c.madnessEarnings={font:"regular",fontSize:6,fontColor:"rgb(255, 255, 4)",antiAlias:!0,margin:u},c.vipRewardText={font:"regular",fontSize:6,fontColor:"rgb(69, 84, 143)",align:"center",textBaseline:"middle",antiAlias:!0,margin:u},c}),bento.define("managers/timemanager",["bento","utils","bento/entity","bento/eventsystem"],function(e,t,n,i){"use strict";var r=!1,o=0,a=0,s={name:"counterBehavior",start:function(){console.log("globalTimer started")},destroy:function(){console.log("Warning: attempted to remove global timer")},now:Date.now(),update:function(e){var t,n;60==++o&&((t=(n=Date.now())-s.now)>1e4&&(t=1e4),s.now=n,p.time+=t,o=0,(a+=1)%2==0&&p.saveTime())}},c=new n({z:0,name:"globalTimer",global:!0,updateWhenPaused:1/0,components:[s]}),l=!1,u=function(e,n){var i=Date.now(),r=(Math.floor(i/1e3/60/60/24),function(){});p.hasUpdatedTime=!1,l||(l=!0,console.log("Getting server time..."),t.WEB||t.iDreamSky?r():(t.isNativeIos()||t.isNativeAndroid(),r()))},h=function(t){l=!1,p.online=!0,p.time=t,p.hasUpdatedTime=!0,p.saveTime();var n=e.saveState.load("timeOffset",0);null===n&&(n=p.time-Date.now(),e.saveState.save("timeOffset",n));var r=e.saveState.load("initialStartingTime",0);0===r&&(r=t,e.saveState.save("initialStartingTime",r)),0===p.previousTime&&(p.previousTime=t),i.fire("serverTimeUpdated")},d=function(){p.online=!1,l=!1,window.setTimeout(function(){p.tryToConnect&&p.updateServerTime()},1e4)},p={hasWarned:!1,online:!1,previousTime:0,time:0,elapsed:0,initialize:function(){r||(p.time=e.saveState.load("lastKnownTime",0),p.previousTime=e.saveState.load("lastKnownTime",0),e.objects.attach(c),u(h,d),t.isDev()&&(window.timeManager=p),r=!0)},getTime:function(){return p.time},hasUpdatedTime:!1,tryToConnect:!0,getLocalTime:function(){var t=e.saveState.load("timeOffset",0)||0;return p.time-t},resumeEvent:function(){p.hasWarned=!1,s.now=Date.now(),u(h,d)},saveTime:function(){e.saveState.save("lastKnownTime",p.time)},updateServerTime:function(e){u(function(t){e&&e(!0),h(t)},function(){e&&e(!1),d()})}};return console.log("return TimeManager"),p}),bento.define("managers/vipmanager",["bento","bento/eventsystem","bento/utils","modules/store","managers/timemanager","materials/metalmaterial","materials/rainbowmaterial","modules/savemanager","materials/ghostmaterial"],function(e,t,n,i,r,o,a,s,c){"use strict";var l,u=!1,h={name:"vipManager",init:function(e){l=e.productId},checkVip:function(o){consloe.log("--------------checkVip----------");var a=Math.floor(r.getTime()/432e5),s=e.saveState.load("VipLastValidated",0),c=e.saveState.load("VipFailedValidations",0),h=function(n){var i;n.productId===l&&(i=n.validated,e.saveState.load("VIP",!1)!==i&&(i||e.saveState.save("VipDowngraded",!0),e.saveState.save("VIP",i),t.fire("onVipChanged",i)),o(i),d("vipmanager: VIP validation complete: "+i)),e.saveState.save("VipLastValidated",a),f()},p=function(n){d("vipmanager: restore error "+n),c+=1,e.saveState.save("VipFailedValidations",c),f(),u||(u=!0,t.fire("notification",{textId:"vipValidationWarning",icon:null}))},f=function(){t.off("IapValidation",h),t.off("restore_error",p),h=function(){}};return d("vipmanager: starting validation"),o=o||function(){},a===s?(d("vipmanager: validated for today"),o(e.saveState.load("VIP",!1)),!0):e.saveState.load("purchased-"+l,!1)||e.isDev()||e.saveState.load("isDev",!1)?i.isLoaded()||e.isDev()?(d("vipmanager: waiting for validation"),t.on("IapValidation",h),t.on("restore_error",p),i.restore()?n.isNativeAndroid()&&window.setTimeout(function(){h({productId:l,validated:!1})},3e4):(p("Store not ready"),o(!1)),!0):(d("vipmanager: store not ready"),!1):(o(!1),d("vipmanager: never purchased vip before"),!0)},checkServerSubscription:function(n){console.log("-----checkServerSubscription-------");var i,o=e.saveState.load("originalTransactionId",null),a=e.saveState.load("VIP",!1),s=Math.floor(r.getCurrentTime()/432e5),c=e.saveState.load("VipLastValidated",0),p=e.saveState.load("VipFailedValidations",0),f=function(i,r){var o,c=!1;if(i)return d("vipmanager:  "+i),p+=1,e.saveState.save("VipFailedValidations",p),void(u||(u=!0,t.fire("notification",{textId:"vipValidationWarning",icon:null})));try{o=JSON.parse(r)}catch(e){return console.log("Could not parse subscription-isactive result."),void n(!1,r)}c=o.expirationDate?o.isActive:e.saveState.load("subscriptionPurchaseTimeStamp",0)+864e5<Date.now(),a!==c&&(c||e.saveState.save("VipDowngraded",!0),e.saveState.save("VIP",c),t.fire("onVipChanged",c)),n(c,r),e.saveState.save("VipLastValidated",s)};return s===c?(d("vipmanager: validated for today"),n(a,null),!1):e.saveState.load("purchased-"+l,!1)||e.isDev()||e.saveState.load("showDeveloperCheats",!1)?o?((i=new window.XMLHttpRequest).open("GET","https://ml371twv56.execute-api.us-east-1.amazonaws.com/latest/isactive?id="+o),i.onreadystatechange=function(){4===i.readyState&&(i.status>=200&&i.status<300?f(null,i.responseText):f("ERROR: bad server response. "+i.responseText))},i.send(),!0):h.checkVip(n):(n(!1,null),d("vipmanager: never purchased vip before"),!1)},checkSubscriptionValidation:function(o,a){console.log("-----checkSubscriptionValidation-------");var s=e.saveState.load("validatedReceipts",{})[o],c=e.saveState.load("VIP",!1),l=e.saveState.load("VipFailedValidations",0),u=function(){l+=1,e.saveState.save("VipFailedValidations",l)};return n.isNativeAndroid()?h.checkVip(a):s?e.saveState.load("purchased-"+o,!1)||e.isDev()||e.saveState.load("showDeveloperCheats",!1)?i.isLoaded()||e.isDev()?(d("vipmanager: revalidate"),i.revalidate(s,function(n,i){var s=!1;if(n)return d("vipmanager: error "+n),u(),a(!1,n),!0;d("vipmanager: revalidate complete: "+i.purchaseData.auto_renew_product_id),e.saveState.save("VipFailedValidations",0),e.saveState.save("VipLastValidated",Math.floor(r.getCurrentTime()/432e5)),!i||!i.purchaseData||i.purchaseData.auto_renew_product_id!==o||i.purchaseData.latest_expired_receipt_info&&"1"!==i.purchaseData.is_in_billing_retry_period||(s=!0),c!==s&&(s||(e.saveState.save("VipDowngraded",!0),console.log("VIP will be turned off.")),e.saveState.save("VIP",s),t.fire("onVipChanged",s),console.log("VIP validation: "+s)),a(s,i)}),!0):(console.log("vipmanager: store not ready"),u(),!1):(a(!1,null),console.log("vipmanager: never purchased vip before"),!0===e.saveState.load("VIP",!1)&&u(),!0):(console.log("vipmanager: receipt not available"),a(!1,null),!0===e.saveState.load("VIP",!1)&&u(),!0)},isVip:function(){var n=Math.floor(r.getTime()/432e5),i=e.saveState.load("VipLastValidated",0),o=e.saveState.load("VipFailedValidations",0);return n-i>2&&o>3&&(e.saveState.load("VIP",!1)&&(e.saveState.save("VipDowngraded",!0),e.saveState.save("VIP",!1),t.fire("onVipChanged",!1)),e.saveState.save("VipFailedValidations",0)),e.saveState.load("VIP",!1)},getMaterial:function(e,t){if(t||h.isVip())switch(t?isNaN(t)?1+n.getRandom(6):t:s.load("vipSkin")){case 1:return new o({color:16777215});case 2:return new o({color:16777215},{source:"shaders/silver"});case 3:return new o({color:16777215},{source:"shaders/copper"});case 4:return new c({color:16777215});case 5:return new a({color:16777215});case 6:return new a({color:16777215},{source:"shaders/violet",speed:5e-4});default:return e.clone()}return e.clone()},getTimeSpan:function(){return 432e5}},d=function(){(e.isDev()||e.saveState.load("isDev",!1))&&console.log.apply(this,arguments)};return h}),bento.define("materials/curvematerial",["modules/extendphong","bento"],function(e,t){"use strict";var n={uniforms:{},vsHeader:"\n            uniform sampler2D shiftVertex;\n            float unPackFloat (in vec4 v) {\n                // v *= 256.0;\n                float a = floor(v[3] / 128.0);\n                float s = a * 2.0 - 1.0;\n                float e = v[3] - a * 128.0 - 63.0;\n                float m = 1.0 + v[0] / 256.0 / 256.0 / 256.0 + v[1] / 256.0 / 256.0 + v[2] / 256.0;\n                return s * pow(2.0, e) * m;\n            }\n        ",vsAfter:"\n            float indexA = min(floor(gl_Position.z / 300.0 * 256.0), 255.0);\n            float indexB = max(0.0, min(indexA + 1.0, 255.0)) / 256.0;\n            indexA = max(0.0, indexA);\n            indexA /= 256.0;\n            vec2 texCoord = vec2(indexA, 1.0);\n            vec4 a = texture2D(shiftVertex, texCoord);\n            a *= 256.0;\n\n            texCoord.x = indexB;\n            vec4 b = texture2D(shiftVertex, texCoord);\n            b *= 256.0;\n\n            float lerp = max(0.0, min((gl_Position.z / 300.0 - indexA) / (indexB - indexA), 1.0));\n            float texA = unPackFloat(a);\n            float texB = unPackFloat(b);\n            float shiftX = texA + (texB - texA) * lerp;\n\n            float apply = 1.0 - floor(min(abs(gl_Position.x / 200.0), 1.0));\n\n            gl_Position.x += apply * shiftX * 4.0;\n\n            texCoord = vec2(indexA, 0.5);\n            a = texture2D(shiftVertex, texCoord);\n            a *= 256.0;\n\n            texCoord.x = indexB;\n            b = texture2D(shiftVertex, texCoord);\n            b *= 256.0;\n\n            texA = unPackFloat(a);\n            texB = unPackFloat(b);\n            float shiftY = texA + (texB - texA) * lerp;\n            gl_Position.y += shiftY * 4.0;\n    ",fsHeader:"",fsAfter:""},i=document.createElement("canvas");i.width=256,i.height=2;var r=i.getContext("2d");i.context=r;var o=new THREE.CanvasTexture(i,THREE.UVMapping,THREE.RepeatWrapping,THREE.RepeatWrapping,THREE.NearestFilter,THREE.NearestFilter),a=function(t){var i=e(n,t);o.needsUpdate=!0,i.uniforms.shiftVertex={type:"t",value:o},a._uniforms=i,THREE.MeshPhongMaterial.call(this,t),this.type="MeshCurveMaterial",this.vertexShader=i.vertexShader,this.fragmentShader=i.fragmentShader,this.uniforms=i.uniforms,this.needsUpdate=!0};return a.curveTexture=o,a.glslChunks=n,a.prototype=Object.create(THREE.MeshPhongMaterial.prototype),a.prototype.constructor=a,a}),bento.define("materials/ghostmaterial",["modules/extendphong","bento","materials/curvematerial"],function(e,t,n){"use strict";var i={uniforms:{},vsHeader:n.glslChunks.vsHeader+"\n            varying vec3 fPosition;\n        ",vsAfter:n.glslChunks.vsAfter+"\n            fPosition = mvPosition.xyz;\n        ",fsHeader:"\n            varying vec3 fPosition;\n            vec3 white = vec3(255.0, 255.0, 255.0);\n            vec3 ghost = vec3(120.0, 200.0, 255.0);\n            vec3 rim(vec3 color, float start, float end, float coef)\n            {\n              vec3 normal = normalize(vNormal);\n              vec3 eye = normalize(-fPosition.xyz);\n              float rim = smoothstep(start, end, 1.0 - dot(normal, eye));\n              return clamp(rim, 0.0, 1.0) * coef * color;\n            }\n        ",fsAfter:"\n            vec3 rimColor = rim(white, 0.0, 25.0, 0.008);\n            gl_FragColor = gl_FragColor * 0.2 + vec4(ghost * rimColor, 1.0);\n        "},r=function(t,o){o=o||{},t.emissive=new THREE.Color(1,1,1),t.emissiveIntensity=.8;var a=e(i,t,!0);n.curveTexture.needsUpdate=!0,a.uniforms.shiftVertex={type:"t",value:n.curveTexture},r._uniforms=a,THREE.MeshPhongMaterial.call(this,t),this.type="MeshGhostMaterial",this.vertexShader=a.vertexShader,this.fragmentShader=a.fragmentShader,this.uniforms=a.uniforms,this.needsUpdate=!0};return r.curveTexture=n.curveTexture,r.prototype=Object.create(THREE.MeshPhongMaterial.prototype),r.prototype.constructor=r,r}),bento.define("materials/metalmaterial",["modules/extendphong","bento","materials/curvematerial"],function(e,t,n){"use strict";var i={uniforms:{},vsHeader:n.glslChunks.vsHeader,vsAfter:n.glslChunks.vsAfter,fsHeader:"\n            uniform sampler2D goldMap;\n        ",fsAfter:"\n            // vec2 texCoord = vec2(0.5 - vNormal.b * 0.5 + vNormal.r * 0.5, vNormal.g);\n            vec2 texCoord = vec2(vNormal.b * 0.5 + vNormal.r * 0.5, vNormal.g);\n            vec4 goldColor = texture2D(goldMap, texCoord);\n            // gl_FragColor = goldColor;\n            gl_FragColor = gl_FragColor * 0.1 + goldColor * 0.9;\n        "},r=function(o,a){a=a||{};var s=e(i,o,!0);n.curveTexture.needsUpdate=!0,s.uniforms.shiftVertex={type:"t",value:n.curveTexture};var c=a.source||"shaders/gold";this.metalTexture=t.assets.getTexture(c),s.uniforms.goldMap={type:"t",value:this.metalTexture},r._uniforms=s,THREE.MeshPhongMaterial.call(this,o),this.type="MeshMetalMaterial",this.vertexShader=s.vertexShader,this.fragmentShader=s.fragmentShader,this.uniforms=s.uniforms,this.needsUpdate=!0};return r.curveTexture=n.curveTexture,r.prototype=Object.create(THREE.MeshPhongMaterial.prototype),r.prototype._dispose=THREE.MeshPhongMaterial.prototype.dispose,r.prototype.constructor=r,r.prototype.dispose=function(){this.metalTexture.dispose(),this._dispose()},r}),bento.define("materials/rainbowmaterial",["modules/extendphong","bento","materials/curvematerial"],function(e,t,n){"use strict";var i={uniforms:{},vsHeader:n.glslChunks.vsHeader+"\n            varying vec3 fPosition;\n        ",vsAfter:n.glslChunks.vsAfter+"\n            fPosition = mvPosition.xyz;\n        ",fsHeader:"\n            uniform sampler2D spectrumMap;\n            uniform float spectrumWalk;\n            varying vec3 fPosition;\n            vec3 rim(vec3 color, float start, float end, float coef)\n            {\n              vec3 normal = normalize(vNormal);\n              vec3 eye = normalize(-fPosition.xyz);\n              float rim = smoothstep(start, end, 1.0 - dot(normal, eye));\n              return clamp(rim, 0.0, 1.0) * coef * color;\n            }\n        ",fsAfter:"\n            vec3 c = vec3(255.0, 255.0, 255.0);\n            vec3 rimColor = rim(c, 0.0, 5.0, 0.05);\n            vec2 texCoord = vec2(mod(rimColor.r / 1.0 * 0.7 + spectrumWalk, 1.0), 1.0);\n            vec4 rainbowColor = texture2D(spectrumMap, texCoord);\n            gl_FragColor = gl_FragColor + rainbowColor * 0.9;\n            // gl_FragColor = vec4(rimColor, 1.0);\n        "},r=function(o,a){a=a||{};var s=e(i,o,!0);n.curveTexture.needsUpdate=!0,s.uniforms.shiftVertex={type:"t",value:n.curveTexture};var c=a.source||"shaders/rainbow";this.rainbowTexture=t.assets.getTexture(c),this.speed=a.speed||.006,s.uniforms.spectrumMap={type:"t",value:this.rainbowTexture},s.uniforms.spectrumWalk={type:"f",
value:0},r._uniforms=s,THREE.MeshPhongMaterial.call(this,o),this.type="MeshRainbowMaterial",this.vertexShader=s.vertexShader,this.fragmentShader=s.fragmentShader,this.uniforms=s.uniforms,this.needsUpdate=!0};return r.curveTexture=n.curveTexture,r.prototype=Object.create(THREE.MeshPhongMaterial.prototype),r.prototype._dispose=THREE.MeshPhongMaterial.prototype.dispose,r.prototype.constructor=r,r.prototype.dispose=function(){this.rainbowTexture.dispose(),this._dispose()},r.prototype.update=function(e){this.uniforms.spectrumWalk.value+=this.speed*e.speed},r}),bento.define("screens/main",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/eventsystem","bento/gui/clickbutton","bento/gui/counter","bento/gui/text","bento/utils","bento/screen","bento/tween","gui/main/mainmenu","modules/threejs","modules/savemanager","3d/camera3d","3d/sun","gui/general/dialog","gui/main/earningsdialog","globals","modules/watchad","managers/pricing","managers/timemanager","modules/notifications","modules/localization","managers/textstyles","components/iconbutton","gui/main/doublecoinbuff","managers/buff","gui/main/coinrain","gui/main/mergeboard","gui/main/freecardialog","modules/cloudsavemanager","gui/main/cloudsavedialog","gui/main/noaddialog","modules/carinfo","components/backbutton","gui/main/mondaymadnessdialog","gui/main/premadnessdialog","managers/vipmanager","gui/main/vipdialog","materials/curvematerial","gui/main/testdrivedialog","gui/main/vipgemdialog","modules/banner","gui/main/banneroverlay"],function(e,t,n,i,r,o,a,s,c,l,u,h,d,p,f,m,g,v,y,b,w,x,E,S,_,T,M,C,A,R,P,I,L,D,O,k,F,B,N,U,z,G,H,j,V,W,X){"use strict";var q,Y,J,K=function(){var t=(e.getViewport().height/320-1)/.21875;f.camera.position.y=2.2-.6*t,W.shouldShow()&&(f.camera.position.y-=.4)},Z=function(t){var n=new X({});e.objects.attach(n),W.showBanner({noAds:e.saveState.load("noBanner",!1)||m.load("noAds")}),t()},Q=function(e){e&&u.timeout(60,function(){$()})},$=function(t){var n=Math.floor(S.getLocalTime()/864e5);w.mainButtonFocus?t&&t():S.online&&m.load("vipRewardTimer")!==n?(m.save("vipRewardTimer",n),w.mainButtonFocus=2,e.objects.attach(new V({onComplete:function(){w.mainButtonFocus=0,t&&t()}}))):t&&t()},ee=function(t){!z.checkSubscriptionValidation("roadcrash_vip",function(n){var i=e.saveState.load("VIP",!1);console.log("VIP:"+n,"save:"+i),i?$(t):t&&t()})&&t&&t()},te=function(t){if(S.online){var n,i,r=S.getLocalTime(),o=Math.floor(r/1e3/60/60/24);!w.forceSM&&o%7==4||w.forceMM?(n=w.mainButtonFocus,w.mondayMadness||0!==n?t&&t():(w.mainButtonFocus=2,i=new N({onComplete:function(){w.mainButtonFocus=n,t&&t()}}),e.objects.attach(i))):o%7==3||w.forceSM?(w.mondayMadness=!1,n=w.mainButtonFocus,w.forceSM=!1,m.load("preMondayPopup")!==o&&0===n?(w.mainButtonFocus=2,i=new U({onComplete:function(){m.save("preMondayPopup",o),w.mainButtonFocus=n,t&&t()}}),e.objects.attach(i)):t&&t()):t&&(w.mondayMadness=!1,a.fire("mondayMadness"),t())}else t&&(w.mondayMadness=!1,a.fire("mondayMadness"),t())},ne=function(){if(!(E.getRank()<6||w.freeCarCooldown||w.noFreeCarDialog)){var t=function(){if(w.mainButtonFocus>0)q=window.setTimeout(t,16e3);else{w.mainButtonFocus=2;var n=E.getRank()-4,i=new L({car:n,onComplete:function(e){w.mainButtonFocus=0}});e.objects.attach(i),w.freeCarCooldown=!0,window.setTimeout(function(){w.freeCarCooldown=!1},8e4),q=null}};w.freeCar<=0?q||(q=window.setTimeout(t,1e3*(12+4*w.freeCarDialog))):q&&window.clearTimeout(q)}},ie=function(){m.add("coins",w.buffs.doubleCoin/60*I.earnings),a.fire("updateCoins",!0),w.buffs.doubleCoin=0,m.save("doubleTime",0)},re=function(t){var n=function(){var t=m.load("giftSavedTime"),n=S.getTime();t&&e.objects.get("mergeBoard",function(e){e.addTime(n-t),m.save("giftSavedTime",n),Y&&(a.off("serverTimeUpdated",Y),Y=null)})};t?(Y=n,a.on("serverTimeUpdated",n)):S.online&&u.timeout(14,n)},oe=function(e){S.online&&m.save("giftSavedTime",S.getTime()),ie()},ae=function(t){re(t),se(t),te(function(){se(t)}),z.checkSubscriptionValidation("roadcrash_vip",function(t){console.log("VIP:"+t,"save:"+e.saveState.load("VIP",!1))})},se=function(t,n){if(n=n||function(){},!e.objects.get("offlineEarningsDialog")){if(t)w.freeCar-=3,a.fire("freeCar");else if(w.earningsChecked)return n();if(0!==w.mainButtonFocus)return n();var i=0,r=S.getTime();if(!S.online)return n();var o=e.saveState.load("offlineEarningsTime",0);if(!o)return e.saveState.save("offlineEarningsTime",S.getTime()),w.earningsChecked=!0,n();if((i=Math.floor((r-o)/1e3))/60<15&&!w.forceEarnings)return w.earningsChecked=!0,n();w.forceEarnings=!1;var s=0;m.load("mergeBoard").forEach(function(e){u.isDefined(e)&&e>-1&&(s+=E.earning(e))}),i=Math.min(i,360),s*=i,s*=.5;var c=function(){e.objects.get("earningsDialog")||e.objects.get("doubleDialog")||(w.mainButtonFocus=2,e.objects.attach(new b({coins:s,doubleAmount:3,doubleCoins:w.mondayMadness,collect:function(t){w.mainButtonFocus=0,e.saveState.save("offlineEarningsTime",r),t&&(s*=3),w.mondayMadness&&(s*=2),z.isVip()&&(s*=2),m.add("coins",s),a.fire("updateCoins",!0),n()}})))},l=4,h=function(){var e=Date.now();J=null,x.canShowRewarded({onSuccess:function(){Date.now()-e<16?u.timeout(1,c):c()},onError:function(){if(u.isDev())c();else{if(!l--)return w.earningsChecked=!1,n();J=window.setTimeout(h,2e3)}}})};h(),w.earningsChecked=!0}},ce=function(t){if(m.add("cloudAge",1),u.isNativeIos()){var n=w.mainButtonFocus;D.checkCloudNewer(function(i){if(i){w.mainButtonFocus=2;var r=new O({onComplete:function(){w.mainButtonFocus=n,t()}});e.objects.attach(r)}else D.save(t,!0)})}else t()},le=function(t){if(0===w.mainButtonFocus){var n=m.load("noAdsDialogCount"),i=m.load("noAdsDialogShown");if(n===i)return;if(z.isVip()&&t)return void t();var r,o=n<3?2:3,a=m.load("showSubscription"),s=m.load("showTestDrive"),c=m.load("testDrive");(n&&n-i>=o||a)&&(w.mainButtonFocus=2,m.save("noAdsDialogShown",n),a||s<2||c>0?(m.save("showSubscription",!1),m.add("showTestDrive",1)):(m.save("showTestDrive",0),r=new j({onComplete:function(){w.mainButtonFocus=0,t&&t()}})),e.objects.attach(r))}else t&&t()};return new h({onShow:function(t){f.initialize({threeToPx:16,backgroundColor:3775743});var n=function(e){console.log("close login")},i=function(e){e?(console.log("user logged in"),w.user_guest=!1):console.log("there is no data")},r=function(e){e.is_guest?(console.log("user is guest"),window.plingaRpc.loginUser(i,n)):(console.log("user is logged in"),i(e))};a.fire("FirebaseAnalytics-setScreenName","main");var o=function(){w.user_guest=!0,w.auth=!1,window.plingaRpc.getUser(r)};plingaRpc_pauseGame=function(){e.audio.muteMusic(!0),e.audio.muteSound(!0)},plingaRpc_resumeGame=function(){e.audio.muteMusic(e.saveState.load("muteMusic",!1),!0),e.audio.muteSound(e.saveState.load("muteSound",!1)),bento.require(["audia"],function(e){var t=e.audioContext;t&&"suspended"===t.state&&t.resume()})},u.isDev()||window.plingaRpc&&(console.log("Init game distribution"),window.plingaRpc.init(o)),e.objects.attach({name:"carBehavior",start:function(e){}});var s=e.getViewport(),c=new R({});e.objects.attach(c),f.camera.position.x=0,f.camera.position.y=0,f.camera.position.z=0,f.camera.rotation.x=0,f.camera.rotation.y=0,f.camera.rotation.z=0;var l=new p({});e.objects.attach(l);var h,d=function(e){y=e,b=F.getCarMesh(y),x="car"+("00"+y).slice(-2),E.refresh()},g=2*Math.PI,y=Math.min(m.load("carRank"),w.maxCarRank),b=F.getCarMesh(y),x="car"+("00"+y).slice(-2),E={name:"showPlayer",mesh:f.getMesh("cars/"+b),dimensions:new THREE.Vector3,centerCar:function(){var e=new THREE.Vector3,t=this.carParts.car.geometry;t.computeBoundingBox(),e=t.boundingBox.getCenter(e),this.carParts.car.position.z=e.y},start:function(t){this.setParts(),this.centerCar(),this.calculateSize(),this.setScale(),f.scene.add(this.mesh),this.mesh.rotation.y=.625*g,this.defaultMaterial=this.carParts.car.material;var n=m.load("testDrive"),i=z.getMaterial(this.defaultMaterial,n?5:void 0);h=e.assets.getTexture("cars/"+x),i.map=h,i.emissiveMap=h,i.needsUpdate=!0,this.carParts.car.material=i,a.on("carRank",d),a.on("updateCarMaterial",E.updateMaterial),a.on("onVipChanged",E.updateMaterial)},destroy:function(e){a.off("carRank",d),a.off("updateCarMaterial",E.updateMaterial),a.off("onVipChanged",E.updateMaterial),f.scene.remove(this.mesh),f.cleanObject3d(this.mesh),h&&h.dispose()},calculateSize:function(){this.mesh&&this.mesh.traverse(function(e){"car"===e.name&&(e.geometry.computeBoundingBox(),e.geometry.boundingBox.getSize(E.dimensions),E.dimensions.y+=E.dimensions.z,E.dimensions.z=E.dimensions.y-E.dimensions.z,E.dimensions.y-=E.dimensions.z)})},setScale:function(){var e=28*this.dimensions.y,t=(s.height/320-1)/.21875,n=.5*s.height-60-14*t-e;if(n<50){var i=(n-50+e)/e;this.mesh.scale.set(i,i,i)}else this.mesh.scale.set(1,1,1)},refresh:function(){f.scene.remove(this.mesh),f.cleanObject3d(this.mesh),this.mesh=f.getMesh("cars/"+b),f.scene.add(this.mesh),this.setParts(),this.centerCar(),this.calculateSize(),this.setScale(),this.mesh.rotation.y=.625*g,this.defaultMaterial=this.carParts.car.material;var t=m.load("testDrive"),n=z.getMaterial(this.defaultMaterial,t?4:void 0);h=e.assets.getTexture("cars/"+x),n.map=h,n.emissiveMap=h,n.needsUpdate=!0,this.carParts.car.material=n},update:function(e){w.dontRotateCar?this.mesh.rotation.y=.625*g:(this.mesh.rotation.y+=.01,this.mesh.rotation.y%=g),this.carParts.car.material.update&&this.carParts.car.material.update(e)},setParts:function(){this.carParts={},this.mesh.children.forEach(function(e){e.name&&(E.carParts[e.name]=e)})},updateMaterial:function(){E.carParts.car.material.dispose(),E.carParts.car.material.map.dispose();var t=m.load("testDrive"),n=z.getMaterial(E.defaultMaterial,t?4:void 0);h=e.assets.getTexture("cars/"+x),n.map=h,n.emissiveMap=h,n.needsUpdate=!0,E.carParts.car.material=n}};e.objects.attach(E);var S=(s.height/320-1)/.21875;f.camera.position.y=2.2-.6*S,W.shouldShow()&&(f.camera.position.y-=.4),f.camera.position.z=15,f.camera.rotation.x=-.3,f.camera.rotation.y=0,f.camera.rotation.z=0;var _=new v({intensity:1});e.objects.attach(_);var T=new P({});e.objects.attach(T),a.on("cordova-resume",ae),a.on("cordova-resign",oe),a.on("cordova-pause",oe),a.on("freeCar",ne),a.on("afterInterstitial",le),a.on("onVipChanged",Q),a.on("bannerStatusChanged",K),ee(function(){Z(function(){te(function(){ce(function(){se(null,function(){ne()}),re()})})})})},onHide:function(){a.off("cordova-resume",ae),a.off("cordova-resign",oe),a.off("cordova-pause",oe),a.off("freeCar",ne),a.off("afterInterstitial",le),a.off("onVipChanged",Q),a.off("bannerStatusChanged",K),q&&window.clearTimeout(q),ie(),Y&&a.off("serverTimeUpdated",Y),J&&(w.earningsChecked=!1,window.clearTimeout(J))}})}),bento.define("screens/preloader",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/components/fill","bento/gui/text","bento/entity","bento/eventsystem","bento/utils","bento/screen","bento/tween","entities/luckykatlogo","globals","modules/localization","managers/meshmanager","materials/curvematerial","entities/tutorial","modules/notifications","modules/savemanager","modules/abtest","modules/crosspromo/crosspromo","gui/main/exit","materials/metalmaterial","gui/main/vipdialog","managers/vipmanager"],function(e,t,n,i,r,o,a,s,c,l,u,h,d,p,f,m,g,v,y,b,w,x,E,S,_,T){"use strict";var M=function(){if(console.log("carrank"+e.saveState.load("carRank",0)),1!==e.saveState.load("ignoreFtue",0)){if(0===e.saveState.load("ftue_bootUp",0)){if(e.saveState.load("tutorial",0)>0)return e.saveState.save("ignoreFtue",1),void console.log("save already exist so skip FTUE to keep data clean");e.saveState.save("ftue_bootUp",1),c.fire("GameAnalytics-addDesignEvent",{eventId:"FTUE:bootUp"}),c.fire("FirebaseAnalytics-logEvent",{name:"FTUEbootUp"}),console.log("ftue_bootUp")}var t=function(t){if(0===e.saveState.load(t.saveKey,0)){var n=function(){console.log(t.saveKey),e.saveState.save(t.saveKey,1),c.fire("GameAnalytics-addDesignEvent",{eventId:t.analyticKey}),c.fire("FirebaseAnalytics-logEvent",{name:t.firebaseKey}),c.off(t.eventKey,n)};c.on(t.eventKey,n)}};t({saveKey:"ftue_raceComplete",analyticKey:"FTUE:raceComplete",firebaseKey:"FTUEraceComplete",eventKey:"FTUE_RACECOMPLETE"}),t({saveKey:"ftue_buyFirstCar",analyticKey:"FTUE:buyFirstCar",firebaseKey:"FTUEbuyFirstCar",eventKey:"FTUE_BUYFIRSTCAR"}),t({saveKey:"ftue_merge1Complete",analyticKey:"FTUE:merge1Complete",firebaseKey:"FTUEmerge1Complete",eventKey:"FTUE_MERGE1COMPLETE"}),t({saveKey:"ftue_merge2Complete",analyticKey:"FTUE:merge2Complete",firebaseKey:"FTUEmerge2Complete",eventKey:"FTUE_MERGE2COMPLETE"}),t({saveKey:"ftue_merge3Complete",analyticKey:"FTUE:merge3Complete",firebaseKey:"FTUEmerge3Complete",eventKey:"FTUE_MERGE3COMPLETE"}),t({saveKey:"ftue_raceAgain",analyticKey:"FTUE:raceAgain",eventKey:"FTUE_RACEAGAIN"})}else console.log("ftue_ignore")},C=function(){var e=function(e){var t=(e=e||{}).time||864e5,n=e.Localization;return n?{title:n.getText("title"),text:n.getText(e.type||"notificationInactive1"),deltaTime:t}:(l.log("ERROR: pass Localization as parameter"),{})},t=function(){y.resetBadgeNumber();var t,n=function(e){var t=b.load(e);t&&y.cancel(t)};n("notification1Day"),n("notificationMondayMadness");var i=Date.now()/1e3/60/60/24,r=Math.floor(i),o=r%7;3!==o?(t=e({Localization:f,type:"notificationInactive1",time:864e5}),y.send(t,function(e){b.save("notification1Day",e)})):(t=e({Localization:f,type:"notificationInactive1",time:1728e5}),y.send(t,function(e){b.save("notification1Day",e)})),t=e({Localization:f,type:"notificationMonday",time:24*(r+(4-o+7)%7+.5-i)*60*60*1e3}),y.send(t,function(e){b.save("notificationMondayMadness",e)})};b.load("notificationsAllowed")?y.init(function(e){e&&(y.resetBadgeNumber(),t(),c.on("documentResume",t))}):c.on("allowedNotifications",function(){y.cancelAll(),t(),c.on("documentResume",t),c.clear("allowedNotifications")})},A=function(){c.on("exitApp",function(){e.objects.get("exitAppStandard")||e.objects.attach(new E({}))})},R=function(){var t,n=Date.now(),i=Math.floor(n/1e3/60/60/24),r=e.saveState.load("retainedDays",{}),o=e.saveState.load("bootups",0);0===o&&(e.saveState.save("bootupDate",n),e.saveState.save("bootupDay",i),c.fire("GameAnalytics-addDesignEvent",{eventId:"Stats:firstBootup"}),c.fire("GameAnalytics-addDesignEvent",{eventId:"Gameplay:Rank:rank-1"})),e.saveState.save("bootups",o+1),e.saveState.save("sessions",e.saveState.load("sessions",0)+1),r[t=i-e.saveState.load("bootupDay",0)]=1,e.saveState.save("retainedDays",r),1===t?c.fire("Tenjin",{action:"D1_retention"}):7===t&&c.fire("Tenjin",{action:"D7_retention"}),c.fire("GameAnalytics-addDesignEvent",{eventId:"Stats:bootup"}),c.fire("FirebaseAnalytics-logEvent",{name:"bootup"}),e.saveState.save("lastPlayedDay",i),e.saveState.save("lastPlayedVersion",window.VERSION)};return new u({onShow:function(){c.fire("FirebaseAnalytics-setScreenName","preloader");var n=!1,r=e.getViewport(),u=new s({z:0,name:"background",components:[new o({})]}),h=new s({z:0,name:"image",family:[""],position:new t(r.width/2,r.height/2),scale:new t(.4,.4),components:[new i({imageName:"bg",originRelative:new t(.5,.5)})]}),d=a({z:1,name:"loadingText",font:"montserrat-alt-black",fontSize:8,fontColor:"#fff",text:"",align:"center",textBaseline:"bottom",position:new t(r.width/2,r.height-20)}),m=function(){if(n){var t=e.saveState.load("tutorial",0);!function(){R(),C(),M();var t=(window.navigator.userLanguage||window.navigator.language||"en-US").split("-"),n=[];l.forEach(e.assets.getAssetGroups().main.images,function(e,t,i,r){t.indexOf("flags")>-1&&n.push(t.slice(-2))});var i=-1;2===t.length?("HK"!==t[1]&&"MO"!==t[1]&&"HANT"!==t[1]||(t[1]="cn"),-1===(i=n.indexOf(t[1].toLowerCase()))&&(i=n.indexOf(t[0].toLowerCase()))):i=n.indexOf(t[0].toLowerCase()),p.flags=n,p.userCountry=i>-1?n[i]:f.isChinese()?"cn":"us",l.isNativeIos()&&!l.isDev()||A(),T.checkSubscriptionValidation("roadcrash_vip",function(t){console.log("VIP:"+t,"save:"+e.saveState.load("VIP",!1))}),_.preloadTerms()}(),t>9?e.screens.show("screens/main"):(e.objects.attach(new v({state:t})),t>0?e.screens.show("screens/main"):e.screens.show("screens/race"))}};navigator.splashscreen&&navigator.splashscreen.hide(),f.setLanguage(),l.isDev()&&(window.setLanguage=f.setLanguage),e.objects.attach(u),e.objects.attach(h),e.objects.attach(d),function(){var n,i=e.assets.getAssetGroups().preloader.fonts;if(i)for(n in i)i.hasOwnProperty(n)&&new a({position:new t(1e3,1e3),text:".",font:n})}(),e.assets.loadAllAssets({exceptions:["preloader"],onLoaded:function(e,t){d.setText(~~(e/t*100)+"%"),on_sdk_process(~~(e/t*100))},onReady:function(){THREE.CustomMaterial=[],THREE.CustomMaterial.push(g),THREE.CustomMaterial.push(S),e.assets.loadMesh("3d",function(e,t){n=!0,m()},function(e,t,n){},function(e){switch(e.attrName){case"mat_horizon":case"tex_skybox":case"speedlines":e.ShadingModel="basic",delete e.EmissiveColor,delete e.EmissiveFactor,delete e.Shininess,delete e.SpecularColor,delete e.SpecularFactor;break;case"coin":e.ShadingModel="1";break;default:e.ShadingModel="0"}})}})}})}),bento.define("screens/race",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/eventsystem","bento/gui/clickbutton","bento/gui/text","bento/utils","bento/screen","bento/tween","entities/luckykatlogo","globals","modules/threejs","3d/sun","3d/camera3d","3d/road","entities/car","entities/enemy","components/collisionsolver","materials/curvematerial","modules/savemanager","3d/confetti3d","gui/main/racefinish","3d/speedlines","gui/main/racehud","3d/debugcurve","gui/main/eliminated","gui/main/goodjob","modules/abtest","modules/roadinfo","3d/booster","entities/travelers/ramp","gui/main/pause","modules/banner","managers/vipmanager"],function(e,t,n,i,r,o,a,s,c,l,u,h,d,p,f,m,g,v,y,b,w,x,E,S,_,T,M,C,A,R,P,I,L,D,O,k,F){"use strict";var B,N=function(){B.stop(),B.play(),B.bufferSource&&(B.bufferSource.playbackRate.value=3.5),p.earningsChecked=!1};return new u({onShow:function(){a.fire("GameAnalytics-addDesignEvent",{eventId:"Gameplay:Race:total",value:1}),a.fire("FirebaseAnalytics-setScreenName","race"),f.initialize({threeToPx:16,backgroundColor:p.greenScreen?p.greenScreenColor:void 0}),(B=e.assets.getAudio("sfx_engine00")).loop=!0,B.volume=.2,B.play(),p.raceTime=Date.now(),p.opponents=14,p.crashes=0,p.leaderboard.length=0,p.standings.length=0,p.fallLeft=!1,p.fallRight=!1,p.wallLeft=!1,p.wallRight=!1;var n=Math.floor(E.load("stage")/5),i=new y({});e.objects.attach(i);var r=new m({intensity:1});r.light.position.x=-4,r.light.position.z=1,e.objects.attach(r);var o=new g({target:i.mesh,targetOffset:new THREE.Vector3(0,1,-20),cameraOffset:new THREE.Vector3(0,16,24)});e.objects.attach(o);var s=new THREE.QuadraticBezierCurve3(new THREE.Vector3(0,13,16),new THREE.Vector3(0,7,30),new THREE.Vector3(0,4,24));new h({from:0,to:1,in:120,ease:"easeInOutQuad",onUpdate:function(e,t){o.cameraOffset.copy(s.getPoint(e))}}),new h({from:0,to:1,in:140,delay:36,ease:"easeInOutQuad",onUpdate:function(e,t){o.targetOffset.y=1+4*e,o.targetOffset.z=-40*e-20}}),i.sun=r,i.camera3d=o;var c=I(n);p.greenScreen&&(c.textures={road:c.textures.road},c.remove=["grassl","grassr","sidel","sider","cliffl","cliffr"],c.props=[]);var u=new v(c);e.objects.attach(u);var d=new M({});e.objects.attach(d);var C=!1,P=!1;p.maxDistance=99999999999999,p.maxSpeed=64e4/3600/60;var U=e.getViewport(),z=0,G=new h.TweenBehavior({from:0,to:1,in:30,ease:"easeInOutQuad",onStart:function(){},onUpdate:function(e,t){f.camera.fov=(z+(54-z)*e)*(U.height/320),f.camera.updateProjectionMatrix()},onComplete:function(){H.begin(),e.objects.attach(H)}}),H=new h.TweenBehavior({from:54,to:45,in:80,ease:"easeInOutQuad",onStart:function(){},onUpdate:function(e,t){f.camera.fov=e*(U.height/320),f.camera.updateProjectionMatrix()}});plingaRpc_pauseGame=function(){e.audio.muteMusic(!0),e.audio.muteSound(!0);var t=new O({});e.objects.attach(t)},plingaRpc_resumeGame=function(){e.audio.muteMusic(e.saveState.load("muteMusic",!1),!0),e.audio.muteSound(e.saveState.load("muteSound",!1)),bento.require(["audia"],function(e){var t=e.audioContext;t&&"suspended"===t.state&&t.resume()})};var j={name:"speedBoost",isAdded:!1,accelTween:h.interpolationsRP.easeOutCubic,decelTween:h.interpolationsRP.easeInOutCubic,speedBoost:.3*p.maxSpeed,timer:0,startSpeed:0,accelTime:3,burnTime:4,fireTime:30,decelTime:120,start:function(){this.timer=0,this.startSpeed=p.speed,$.activate(),z=f.camera.fov/(U.height/320),G.begin(),G.isAdded||e.objects.attach(G),H.isAdded&&e.objects.remove(H),e.audio.setVolume(.8,"sfx_car_boost4"),e.audio.stopSound("sfx_car_boost4"),e.audio.playSound("sfx_car_boost4")},update:function(t){this.timer+=t.speed,this.timer<=this.fireTime&&(i.fire=!0),this.timer<=this.accelTime?p.speed=this.accelTween(this.timer,this.startSpeed,p.maxSpeed+this.speedBoost-this.startSpeed,this.accelTime):this.timer<=this.accelTime+this.burnTime?p.speed=p.maxSpeed+this.speedBoost:this.timer<this.accelTime+this.burnTime+this.decelTime?p.speed=this.decelTween(this.timer-(this.accelTime+this.burnTime),p.maxSpeed+this.speedBoost,-this.speedBoost,this.decelTime):(p.speed=p.maxSpeed,e.objects.remove(this)),B.bufferSource&&(B.bufferSource.playbackRate.value=2.2+p.speed/p.maxSpeed*1.3)}},V={original:0,from:p.maxDistance,to:p.maxDistance},W=new h.TweenBehavior({from:0,to:1,in:10,delay:0,applyOnDelay:0,ease:"easeInQuint",onUpdate:function(e,t){p.maxDistance=Math.max(V.original,V.from+(V.to-V.from)*e)}}),X=0,q=function(){var t=new L({camera3d:o});e.objects.attach(t)},Y=!0,J=!1,K={name:"progressor",boosters:3,boosterCooldown:0,start:function(){p.speed=0,p.distance=0,p.maxDistance=60*p.maxSpeed*28,V.original=p.maxDistance,e.audio.stopSound("sfx_car_start"),e.audio.playSound("sfx_car_start"),new h({from:0,to:.28,in:30,ease:"easeInOutQuad",onStart:function(){},onUpdate:function(e,t){i.forceSkid=!0,i.mesh.rotation.y=e},onComplete:function(){new h({from:.28,to:-.28,in:32,ease:"easeInOutQuad",onStart:function(){},onUpdate:function(e,t){i.forceSkid=!0,i.mesh.rotation.y=e},onComplete:function(){new h({from:-.28,to:.05,in:20,ease:"easeInOutQuad",onStart:function(){},onUpdate:function(e,t){i.forceSkid=!0,i.mesh.rotation.y=e},onComplete:function(){i.go=!0}})}})}}),new h({from:0,to:.3,in:40,ease:"easeInQuart",onStart:function(){},onUpdate:function(e,t){p.speed=e,B.bufferSource&&(B.bufferSource.playbackRate.value=.5+e)},onComplete:function(){B.volume=.2,new h({from:.3,to:p.maxSpeed,in:130,applyOnDelay:0,ease:"easeOutQuad",onStart:function(){},onUpdate:function(e,t){p.speed=e,B.bufferSource&&(B.bufferSource.playbackRate.value=1.5+p.speed/p.maxSpeed*2)}})}}),a.on("boost",K.boost)},destroy:function(){a.off("boost",K.boost)},update:function(t){var n,r;if(p.tutorialRace){n=.05+p.distance/p.maxDistance*.95;var s=(r=p.standings.length/p.opponents)/n,c=Math.min(p.standings.length/(.4*p.opponents),1);c=1-c,c=1-(c*=c),s&&X--<=0&&r<1&&r&&(s=1/s,V.from=p.maxDistance,V.to=p.maxDistance*s*c,W.begin(),W.isAdded||e.objects.attach(W),X=5)}else if(p.distance+380<p.maxDistance){if(K.boosterCooldown<=0)if(K.boosters&&Math.floor(p.distance/p.maxDistance*6)>=7-2*K.boosters)K.boosters--,K.boosterCooldown=180,q();else{var u=(n=p.distance/p.maxDistance)-(r=p.standings.length/p.opponents);u>.08&&l.getRandomFloat(1)<.2*u*t.speed&&(K.boosterCooldown=180,q())}K.boosterCooldown-=p.speed*t.speed}if(Y&&!p.tutorialRace&&n>.3898){Y=!1;var m=new D({});ne.curveStrength=0,J=!0,m.attach({name:"resetCurves",destroy:function(){ne.curveStrength=1,J=!1}}),e.objects.attach(m)}if(p.distance+=p.speed*t.speed,d.setProgress(Math.min(p.distance/p.maxDistance,1)),d.setRival((p.distance-ue.mesh.position.z)/p.maxDistance),!C&&p.distance>p.maxDistance-320){C=!0;var g=new f.Mesh({path:"finish",start:function(e){this.mesh.children[1].material.emissiveIntensity=.8,this.mesh.children[2].material.emissiveIntensity=.8,this.mesh.children[3].material.emissiveIntensity=.8},update:function(t){if(this.mesh.position.z+=p.speed*t.speed,!P&&this.mesh.position.z>=0){P=!0;var n=new THREE.Object3D;n.position.copy(i.mesh.position),n.position.z=this.mesh.position.z,o.target=n,new h({from:4,to:2.6,in:56,ease:"easeOutQuad",onUpdate:function(e,t){o.cameraOffset.y=e}}),a.fire("finish"),B.bufferSource&&new h({from:B.bufferSource.playbackRate.value,to:1,in:30,ease:"easeOutQuad",onStart:function(){},onUpdate:function(e,t){B.bufferSource.playbackRate.value=e}}),new h({from:.2,to:0,in:30,ease:"easeInOutQuad",onStart:function(){},onUpdate:function(e,t){B.volume=e}});var r=new S({position:new THREE.Vector3(g.mesh.position.x-8,g.mesh.position.y,g.mesh.position.z),direction:new THREE.Vector3(.2,.15,0)});e.objects.attach(r),r=new S({position:new THREE.Vector3(g.mesh.position.x+8,g.mesh.position.y,g.mesh.position.z),direction:new THREE.Vector3(-.2,.15,0)}),e.objects.attach(r),p.leaderboard.push(i);var s=new _({});p.waitWithRewardScreen?l.timeout(360,function(){e.objects.attach(s)}):e.objects.attach(s),j.isAdded&&e.objects.remove(j),pe.finishSequence()}},destroy:function(e){},attached:function(e){}});g.mesh.position.z=p.distance-(p.maxDistance+20),e.objects.attach(g)}},boost:function(){P||(l.getRandomRangeFloat(2.76,2.82),j.isAdded?j.start():e.objects.attach(j))},jump:function(){B.bufferSource&&(B.bufferSource.playbackRate.value=3.5),P||($.activate(),j.isAdded&&e.objects.remove(j),G.isAdded&&e.objects.remove(G),H.isAdded&&e.objects.remove(H))}};e.objects.attach(K),i.progress=K;var Z=function(e){return e-Math.floor(e)},Q=function(e){if(!e)return[0,0,0,128];var t=e>0?1:-1,n=Math.floor(Math.log2(t*e)),i=t*e/Math.pow(2,n);return[Math.floor(256*Z(256*(i-1)*256)),Math.floor(256*Z(256*(i-1))),Math.floor(256*Z(1*(i-1))),n+63+(e>0?128:0)]},$=new T({});if(e.objects.attach($),!p.noRaceUI){var ee=new A({});e.objects.attach(ee)}var te=new R({});e.objects.attach(te);var ne={name:"canvasCurver",curveStrength:1,curveEndX:0,curveEndY:0,curveX:[],curveY:[],curveDataX:[],curveDataY:[],start:function(){var e,t;c.curve.startX&&0===l.getRandom(c.curve.startX)&&(e=l.getRandomRangeFloat(240,480),t=l.getRandomRange(180,300),this.curveX.push({start:t,end:e,curve:l.pickRandom(-1,1)*l.getRandomRangeFloat(10,25)*this.curveStrength}),this.curveEndX+=t+e-300),c.curve.startY&&0===l.getRandom(c.curve.startY)&&(e=l.getRandomRangeFloat(240,480),t=l.getRandomRange(140,300),this.curveY.push({start:t,end:e,curve:l.pickRandom(-1,1)*l.getRandomRangeFloat(4,8)*this.curveStrength}),this.curveEndY+=t+e-300)},update:function(e){var t,n,i,r,o,a,s,u=p.distance;this.curveEndX=Math.max(0,this.curveEndX-p.speed*e.speed),this.curveEndY=Math.max(0,this.curveEndY-p.speed*e.speed),c.curve.randomX&&0===l.getRandom(c.curve.randomX+2*this.curveEndX)&&(i=l.getRandomRangeFloat(240,480),this.curveX.push({start:p.distance+300+this.curveEndX,end:i,curve:l.pickRandom(-1,1)*l.getRandomRangeFloat(10,25)*this.curveStrength}),this.curveEndX+=i),p.maxDistance-p.distance>780+this.curveEndY&&c.curve.randomY&&0===l.getRandom(c.curve.randomY+3*this.curveEndY)&&(i=l.getRandomRangeFloat(140,480),this.curveY.push({start:p.distance+300+this.curveEndY,end:i,curve:l.pickRandom(-1,1)*l.getRandomRangeFloat(4,8)*this.curveStrength}),this.curveEndY+=i),this.curveDataX.length=0;var d=this.curveDataX,f=this.curveX,m=0,g=0,v=0,y=0;for(t=0;t<f.length;t++)if(r=(f[t].start-u)*(256/300),a=Math.floor(r),o=f[t].end*(256/300),s=Math.floor(a+o),a+o>0){for(n=a;n<s+1&&n<256;n++)g=h.interpolationsRP.easeInOutQuad(Math.max(0,n-r),0,f[t].curve,o)+m,22===n&&(S=(n-r)/o,v=(v=h.interpolationsRP.easeInOutQuad(Math.max(0,n-r),S<.5?0:1,S<.5?1:-1,o))*f[t].curve*.04/60),32===n&&(S=(n-r)/o,y=h.interpolationsRP.easeInOutQuad(Math.max(0,n-r),S<.5?0:1,S<.5?1:-1,o),y=v*f[t].curve*.04/60),d[n]=g;m=g}else f.splice(t--,1);p.cornerForce=v*this.curveStrength,p.crashForce=y*this.curveStrength,this.curveDataY.length=0;var b=this.curveDataY,w=this.curveY,E=0,S=0;for(t=0;t<w.length;t++)if(r=(w[t].start-u)*(256/300),a=Math.floor(r),o=w[t].end*(256/300),s=Math.floor(a+o),a+o>0){for(n=a;n<s+1&&n<256;n++)S=h.interpolationsRP.easeInOutQuad(Math.max(0,n-r),0,w[t].curve,o)+E,b[n]=S;E=S}else w.splice(t--,1);var _,T=x.curveTexture,M=T.image.context;M.clearRect(0,0,256,2);var C=d[22]||0,A=b[22]||0;for(t=0;t<22;t++)C!==d[22]&&(C=d[t]||C),A!==b[22]&&(A=b[t]||A);var R=0;for(m=0,E=0,t=0;t<256;t++)d[t]&&(m=d[t]),b[t]&&(E=b[t]),R=1-Math.min(t/40,1),g=(C-m)*(R=1-(R*=R)),p.curveX[t]=g,_=Q(g+9.73e-11),M.fillStyle="rgba("+_[0]+","+_[1]+","+_[2]+","+_[3]/256+")",M.fillRect(t,1,1,1),S=(A-E)*R,p.curveY[t]=S,_=Q(S+9.73e-11),M.fillStyle="rgba("+_[0]+","+_[1]+","+_[2]+","+_[3]/256+")",M.fillRect(t,0,1,1);T.needsUpdate=!0},destroy:function(){var e=x.curveTexture;e.image.context.clearRect(0,0,256,2),e.needsUpdate=!0}};e.objects.attach(ne);var ie=0,re=0,oe=function(t,n,i,r){var o=new f.Mesh({path:l.isArray(t.models)?l.pickRandomFrom(t.models):t.models,start:function(e){t.positionY&&(this.mesh.position.y=t.positionY()),t.positionX&&(this.mesh.position.x=t.positionX(n,this.mesh.position.y)),this.mesh.position.z=i||-300,t.rotationY&&(this.mesh.rotation.y=t.rotationY(n)),this.scale=1,t.scale&&(this.scale=t.scale()),this.mesh.scale.set(this.scale,this.scale,this.scale),this.mesh.frustumCulled=!1,this.mesh.children.forEach(function(e){e.frustumCulled=!1})},update:function(t){var n=1;this.mesh.position.z<-220&&(n=Math.max(5e-9,1-(this.mesh.position.z+220)/-80)),n*=this.scale,this.mesh.scale.set(n,n,n),this.mesh.position.z+=p.speed*t.speed,this.mesh.position.z>200&&e.objects.remove(this)},draw:function(){},destroy:function(e){},attached:function(e){}});e.objects.attach(o),t.repeat&&t.repeat(t,n,i||-300,r,oe)},ae=[],se=[],ce=function(e,t){e&&(ie+=e),t&&(re+=t)},le={name:"propSpawner",start:function(){c.props.forEach(function(e){e.cooldown&&(e.cooldown=0),l.repeat(e.start,function(t,n){e.uniform?oe(e,2===e.side?l.pickRandom(-1,1):e.side===c.side?-1:1,t*-e.uniform,ce):l.getRandom(2)||oe(e,2===e.side?l.pickRandom(-1,1):e.side===c.side?-1:1,l.getRandomRangeFloat(-10,-300),ce)})})},update:function(e){var t=p.speed*e.speed;ie+=t,re+=t;var n=p.speed/p.maxSpeed*e.speed;ae.length=0,se.length=0,c.props.forEach(function(e){(e.side===c.side||2===e.side)&&ie>e.distance&&ae.push(e),(e.side===(c.side+1)%2||2===e.side)&&re>e.distance&&se.push(e)});var i=function(e){if(e.cooldown){if(e.cooldown+e.coolDistance>p.distance)return!1;e.cooldown=0}return!(e.noFinishLine&&p.distance>p.maxDistance-600||e.noRamp&&(J||p.jump))},r=0,o=l.getRandomFloat(1);l.forEach(ae,function(e,t,a,s){i(e)&&(r+=e.chance*n,o<=r&&(e.coolDistance&&(e.cooldown=p.distance),ie=0,e.maxRepeat&&(e.iteration=0),oe(e,-1,void 0,ce),s()))}),r=0,o=l.getRandomFloat(1),l.forEach(se,function(e,t,a,s){i(e)&&(r+=e.chance*n,o<=r&&(e.coolDistance&&(e.cooldown=p.distance),re=0,oe(e,1,void 0,ce),s()))})}};e.objects.attach(le);var ue,he=Math.min(E.load("carRank"),p.maxCarRank-2),de=p.opponents,pe={name:"enemySpawner",enemyList:[],deadEnemies:[],start:function(){for(var n,i=7*-(de+1),r=l.getRandom(5),o=r?l.getRandom(de):0,a=0;a<de;a++){var s=l.getBotCountry(p.userCountry||"us",p.flags);n=new b({rank:l.getRandomRange(Math.max(0,he-5),he),spawner:pe,startPosition:new t(a?l.getRandomRangeFloat(-6.5,6.5):0,i+7*a+l.getRandomRangeFloat(-2.2,2.2)),distanceStrength:(de-1-a)/8.95,botName:l.getBotName(s),botCountry:s,first:!ue,vip:r&&o===a}),ue||(ue=n),e.objects.attach(n),this.enemyList.push(n)}},update:function(t){if(this.finished&&(this.finishCount+=t.speed,this.finishCount>40&&(this.finishCount-=40,this.deadEnemies.length))){var n=this.deadEnemies.pop();n.finishSequence(),e.objects.attach(n)}},die:function(e){this.deadEnemies.push(e)},finishSequence:function(){this.finished=!0,this.finishCount=0}};e.objects.attach(pe);var fe=new w({player:i,enemySpawner:pe});e.objects.attach(fe);var me=("00"+n).slice(-2),ge=f.Mesh({path:"horizon",dispose:!0,start:function(t){c.noHorizon||p.greenScreen?this.mesh.visible=!1:(this.material=this.mesh.children[0].material,this.texture=e.assets.getTexture("sky/horizon"+me),
this.texture.wrapS=THREE.RepeatWrapping,this.texture.needsUpdate=!0,this.material.map=this.texture,this.material.transparent=!0,this.material.needsUpdate=!0)},update:function(e){this.mesh.rotation.y+=-.1*p.cornerForce*e.speed*(p.speed/p.maxSpeed),this.mesh.position.x=f.camera.position.x,this.mesh.position.z=f.camera.position.z},destroy:function(e){c.noHorizon||p.greenScreen||(this.material.dispose(),this.texture.dispose())},attached:function(e){}});e.objects.attach(ge);var ve=f.Mesh({path:"skybox",start:function(t){this.material=this.mesh.children[0].material,this.texture=e.assets.getTexture("sky/skybox"+me),this.texture.wrapS=THREE.RepeatWrapping,this.texture.needsUpdate=!0,this.material.map=this.texture,this.material.needsUpdate=!0,p.greenScreen&&(this.mesh.visible=!1)},update:function(e){this.mesh.rotation.y+=-.05*p.cornerForce*e.speed*(p.speed/p.maxSpeed),this.mesh.position.x=f.camera.position.x,this.mesh.position.z=f.camera.position.z},destroy:function(e){this.material.dispose(),this.texture.dispose()},attached:function(e){}});e.objects.attach(ve);var ye=new O({});e.objects.attach(ye),a.on("cordova-resume",N),k.showBanner({noAds:e.saveState.load("noBanner",!1)||E.load("noAds")||F.isVip()})},onHide:function(){B.stop(),a.off("cordova-resume",N)}})}),bento.define("modules/abtest",["bento","bento/math/vector2","bento/math/rectangle","bento/entity","bento/eventsystem","bento/utils","bento/tween","modules/savemanager"],function(e,t,n,i,r,o,a,s){"use strict";var c,l,u,h="ABWinnerTutorial";return{init:function(e){(l=s.load(h))||(l=o.pickRandom("A","B"),s.save(h,l));var t,n="A"===l?"tutorialRaceForcedWin":"tutorialRaceNoForce";r.fire("GameAnalytics-setCustomDimension02",n),r.fire("FirebaseAnalytics-setUserProperty",{property:"ABTest2",value:n}),console.log(h+": "+l,"A"===l?"tutorialRaceForcedWin":"tutorialRaceNoForce"),s.load("identifier")||(t=window.device?"dvc_"+window.device.uuid:navigator.isCocoonJS&&window.Cocoon&&window.Cocoon.Device?"ccd_"+window.Cocoon.Device.getDeviceId():"rnd_"+(1+o.getRandom(1e8)),o.isDev()&&(t="dev"),s.save("identifier",t)),e&&e()},getAB1:function(){return c},getCustomDimensions01:function(){return["ZhInterstitialEveryRace","ZhInterstitialEvery2Race","excluded"]},getAB2:function(){return l},getCustomDimensions02:function(){return["tutorialRaceForcedWin","tutorialRaceNoForce","excluded"]},getAB3:function(){return u},getCustomDimensions03:function(){return["RaceTime30Sec","RaceTime40Sec","RaceTime50Sec","excluded"]},refreshAB:function(){c=s.load("ABInterstitialsChina"),l=s.load(h),u=s.load("ABRaceTime2")}}}),bento.define("modules/banner",["bento","bento/eventsystem","utils","modules/mopub"],function(e,t,n,i){"use strict";var r=!1;return{showBanner:function(e){var n=i.getBannerStatus();!e||e&&!e.noAds?(r=!0,n.visible||i.showBanner(function(){}),t.fire("bannerStatusChanged",{})):(r=!1,n.prepared&&i.removeBannerView(function(){t.fire("bannerStatusChanged",{})}))},isVisible:function(){return i.isBannerVisible()},shouldShow:function(){return r},hideBanner:function(e){i.getBannerStatus().visible&&i.hideBanner(function(){t.fire("bannerStatusChanged",{})})},removeBanner:function(e){i.getBannerStatus().prepared&&i.removeBannerView(function(){}),r=!1,t.fire("bannerStatusChanged",{})}}}),bento.define("modules/carinfo",["bento","bento/utils"],function(e,t){"use strict";return{getStats:function(e){switch(e){case 1:return{speed:60,acceleration:72};case 2:return{speed:80,acceleration:70};case 3:return{speed:85,acceleration:90};case 4:return{speed:96,acceleration:102};case 5:return{speed:108,acceleration:102};case 6:return{speed:125,acceleration:118};case 7:return{speed:129,acceleration:126};case 8:return{speed:134,acceleration:140};case 9:return{speed:138,acceleration:150};case 10:return{speed:144,acceleration:158};case 11:return{speed:156,acceleration:160};case 12:return{speed:170,acceleration:167};case 13:return{speed:175,acceleration:175};case 14:return{speed:200,acceleration:178};case 15:return{speed:210,acceleration:185};case 16:return{speed:216,acceleration:195};case 17:return{speed:220,acceleration:205};case 18:return{speed:236,acceleration:228};case 19:return{speed:236,acceleration:236};case 20:return{speed:244,acceleration:250};case 21:return{speed:250,acceleration:260};case 22:return{speed:282,acceleration:265};case 23:return{speed:294,acceleration:270};case 24:return{speed:300,acceleration:280};case 25:return{speed:300,acceleration:305};case 26:return{speed:340,acceleration:335};case 27:return{speed:350,acceleration:335};case 28:return{speed:360,acceleration:360};case 29:return{speed:370,acceleration:364};case 30:return{speed:378,acceleration:380};case 31:return{speed:390,acceleration:396};case 32:return{speed:420,acceleration:420};case 33:return{speed:450,acceleration:439};case 34:return{speed:480,acceleration:450};case 35:return{speed:500,acceleration:485};case 36:return{speed:530,acceleration:510};case 37:return{speed:550,acceleration:550};case 38:return{speed:570,acceleration:580};case 39:return{speed:585,acceleration:610};case 40:return{speed:620,acceleration:670};case 41:return{speed:643,acceleration:690};default:return{speed:50,acceleration:50}}},getCarMesh:function(e){switch(e){case 32:return"car16a";case 33:return"car16b";default:return"car"+("00"+Math.floor(e/2)).slice(-2)}},getMaxStats:function(e){return e<19?400:e<26?500:e<33?600:700}}}),bento.define("modules/cloudsave",["bento","utils","lzstring","modules/googleplaygames","modules/gamecenter"],function(e,t,n,i,r){"use strict";var o,a,s={},c="",l="",u=["muteSound","muteMusic","showDeveloperCheats","promptGooglePlayOnBoot","notificationsAllowed","notifications"],h=function(){return"AWS"===c||(t.isNativeAndroid()?i.isLoggedIn():!t.isNativeIos()||r.isLoggedIn())},d=function(){if(console.log("Cloudsave: Service "+c),"GooglePlay"===c)o=i;else{if("GameCenter"!==c)return;o=r}},p={init:function(e){l=e.cloudSaveId,u=e.excludedKeys||[],c=e.serviceName,console.log("Cloud: start "+c),d()},useCloudSave:!0,isAvailable:function(){return!0},login:function(e){if("GooglePlay"===c)i.isLoggedIn()?e&&e(!0):i.login(function(t,n){t||console.log(n),e&&e(t)});else{if("GameCenter"!==c)return void(t.isDev()?(l="dev",e&&e(!0)):console.log("Cloud saving not available"));r.isLoggedIn()?e&&e(!0):r.login(function(t,n){e&&e(t,n)})}},lastWriteStatus:"none",isLoggedIn:function(){return h()},saveToCloud:function(i){p.useCloudSave?(d(),h()&&o?(a=function(){var t,n,i={},r=e.saveState.getKeys();for(t=0,n=r.length;t<n;++t)u.indexOf(r[t])>=0||(i[r[t]]=e.saveState.load(r[t]));return i}(),function(i){var r,s;try{r=JSON.stringify(a)}catch(e){return t.log("Unable to stringify save file"),void(i&&i(!1,"stringifyError"))}try{s=n.compressToBase64(r)}catch(e){return t.log("Unable to compress save file"),void(i&&i(!1,"compressError"))}var c={identifier:l,title:l,description:"Save file for "+l,data:s,date:Date.now()};c.data?o.writeSavedGame(c,function(){i&&i(!0)},function(e){t.log("Cloud save error: "+JSON.stringify(e)),i&&i(!1,"cloudSaveError")}):e.objects.resume()}(function(e,t){p.lastWriteStatus=e?"success":"failed",i&&i(e,t)})):i&&i(!1,"notLoggedIn")):i&&i(!1,"turnedOff")},loadFromCloud:function(i){if(!p.useCloudSave)return console.log("Cloud saving feature is turned off."),void(i&&i(!1,"turnedOff"));var r={};d(),h()&&o?function(e){o.loadSavedGame(l,function(i){var r;if(console.log("cloudsave snapshot:",JSON.stringify(i)),i&&i.data){try{r=n.decompressFromBase64(i.data)}catch(n){return t.log("Savefile corrupted!"),void(e&&e(!1,"cloudSaveCorrupt"))}try{s=JSON.parse(r)}catch(n){return t.log("Savefile corrupted!"),void(e&&e(!1,"cloudSaveCorrupt"))}if(!s)return t.log("No save file found"),void(e&&e(!0,"cloudSaveNone"));e&&e(!0,s)}else t.log("No save file found"),e&&e(!0,"cloudSaveNone")},function(t){null!==t?(console.log("error cloudsave",JSON.stringify(t)),e&&e(!1,"pluginError")):(console.log("No cloud save found"),e&&e(!0,"cloudSaveNone"))})}(function(n,o){n&&"cloudSaveNone"!==o&&function(){var n;for(n in t.forEach(u,function(t){var n=e.saveState.load(t,null);null!==n&&(r[t]=n)}),e.saveState.clear(),t.forEach(r,function(t,n){e.saveState.save(n,r[n])}),s)e.saveState.save(n,s[n])}(),i(n,o)}):(t.log("Could not load from cloud"),i(!1,"notLoggedIn"))},getExcluded:function(){return u},hasAnySave:function(e){d(),h()&&o?o.loadSavedGame(l,function(i){var r;if(i&&i.data){try{r=n.decompressFromBase64(i.data)}catch(t){return void(e&&e(!1,"cloudSaveCorrupt"))}try{s=JSON.parse(r)}catch(t){return void(e&&e(!1,"cloudSaveCorrupt"))}if(!s)return void(e&&e(!1,"cloudSaveNone"));try{t.getKeyLength(s)?e(!0,i,s):e(!1)}catch(t){e(!1)}}else e(!1)},function(t){e&&e(!1,t)}):e(!1,"cloudSaveNoLogin")}};return p}),bento.define("modules/cloudsavemanager",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/eventsystem","bento/gui/clickbutton","bento/gui/counter","bento/gui/text","bento/utils","bento/tween","modules/cloudsave","modules/savemanager","globals","gui/main/mergeboard","managers/pricing","managers/experience","entities/tutorial"],function(e,t,n,i,r,o,a,s,c,l,u,h,d,p,f,m,g,v,y){"use strict";var b=function(e){d.saveToCloud(function(t,n){t?console.log("CloudSave: SUCCESS"):console.log("CloudSave: FAILED - "+n),e(t)})},w=function(e){d.loadFromCloud(function(t,n){t?console.log("CloudLoad: SUCCESS"):console.log("CloudLoad: FAILED - "+n),e(t)})},x={checkCloudNewer:function(e){d.hasAnySave(function(t,n,i){t?(i&&console.log("CLOUDSAVE FOUND: "+JSON.stringify(i)),!i||i.cloudAge>p.load("cloudAge")?e(!0):e(!1)):e(!1)})},save:function(e,t){t?b(e):x.checkCloudNewer(function(t){t?(console.log("CloudSave: FAILED - Cloud is newer than local"),e(!1)):b(e)})},load:function(e,t){t?w(e):x.checkCloudNewer(function(t){t?w(e):(console.log("CloudLoad: FAILED - Cloud is older than local"),e(!1))})},resetup:function(){m.reset(),g.refresh(),v.refresh(),f.earningsChecked=!1,e.objects.get("tutorial",function(t){e.objects.remove(t)});var t=e.saveState.load("tutorial",0);if(t>9)e.screens.show("screens/main");else{var n=new y({state:t});e.objects.attach(n),t>0?e.screens.show("screens/main"):e.screens.show("screens/race")}}};return x}),bento.define("modules/errorhandler",["bento","bento/eventsystem","bento/utils"],function(e,t,n){"use strict";var i={init:function(t){console.log("------init--------------------"),e.objects.attach(r),o(),i.GaPrefix=t.GaPrefix,i.GaId=t.GaId,i.saveErrors=t.saveErrors},saveErrors:!1,GaId:null,GaPrefix:""},r={z:0,name:"errorHandler",timer:0,global:!0,update:function(){r.timer+=1},destroy:function(){e.objects.attach(r)}},o=function(){window.onerror=function(n,i,o,s,c){console.log("caught Trace");var l,u=r.timer,h=e.objects.getCurrentObject();l={isFatal:!1,line:o,errorMsg:n,summary:"url: "+i+" line "+o+": "+n,currentObject:h},window.setTimeout(function(){r.isAdded&&u===r.timer?(l.isFatal=!0,console.log("Fatal error detected")):console.log("Non-fatal error detected"),a(l),t.fire("UncaughtError",l)},1e3)}},a=function(r){var o,a=i.GaPrefix,c=a+"-Error",l=e.screens.getCurrentScreen(),u="none",h=r.currentObject,d="none",p="none",f=r.summary,m=r.errorMsg,g=r.isFatal,v=e.saveState.load("errorHistory",[]),y="unknown";n.isNativeIos()?y="iOS":n.isNativeAndroid()?y="Android":(y="Web",navigator.userAgent),l&&(u=l.name),h&&h.name&&(d=h.name,f+="\nObject: "+h.name,(o=h.currentComponent)&&o.name&&(f+="\nComponent: "+(p=o.name),"stateMachine"===p&&(f+="\nstateName: "+o.stateName)),void 0!==window.VERSION&&(f+="\nVersion: "+window.VERSION),void 0!==window.BUILD&&(f+="\nBuild: "+window.BUILD)),m.stack&&(f+="\nStack: "+m.stack),g&&(c=a+"-ErrorFatal"),!i.GaId||n.isDev()&&"Web"===y||s(c,y+"-"+u,1,f),t.fire("GameAnalytics-addErrorEvent",{severity:5,message:y+"-"+u+": "+f}),i.saveErrors&&(v.push({isFatal:g,summary:f,screen:u,objectName:d,componentName:p,date:(new Date).toString()}),e.saveState.save("errorHistory",v)),console.log(f)},s=function(e,t,n,i){};return i}),bento.define("modules/extendphong",["utils"],function(e){"use strict";return function(t,n,i){var r=THREE.UniformsUtils.merge([THREE.ShaderLib.phong.uniforms,t.uniforms||""]),o={vertexShader:!i&&e.isNativeAndroid()?["#define LAMBERT","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifdef DOUBLE_SIDED","    varying vec3 vLightBack;","    varying vec3 vIndirectBack;","#endif",THREE.ShaderChunk.common,THREE.ShaderChunk.uv_pars_vertex,THREE.ShaderChunk.uv2_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.bsdfs,THREE.ShaderChunk.lights_pars_begin,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.fog_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,THREE.ShaderChunk.clipping_planes_pars_vertex,t.vsHeader||"","void main() {",THREE.ShaderChunk.uv_vertex,THREE.ShaderChunk.uv2_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.beginnormal_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,THREE.ShaderChunk.begin_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.project_vertex,THREE.ShaderChunk.logdepthbuf_vertex,THREE.ShaderChunk.clipping_planes_vertex,THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.lights_lambert_vertex,THREE.ShaderChunk.shadowmap_vertex,THREE.ShaderChunk.fog_vertex,t.vsAfter||"","}"].join("\n"):["#define PHONG","varying vec3 vViewPosition;","#ifndef FLAT_SHADED","    varying vec3 vNormal;","#endif",THREE.ShaderChunk.common,THREE.ShaderChunk.uv_pars_vertex,THREE.ShaderChunk.uv2_pars_vertex,THREE.ShaderChunk.displacementmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.fog_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,THREE.ShaderChunk.clipping_planes_pars_vertex,t.vsHeader||"","void main() {",THREE.ShaderChunk.uv_vertex,THREE.ShaderChunk.uv2_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.beginnormal_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,"#ifndef FLAT_SHADED","    vNormal = normalize( transformedNormal );","#endif",THREE.ShaderChunk.begin_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.displacementmap_vertex,THREE.ShaderChunk.project_vertex,THREE.ShaderChunk.logdepthbuf_vertex,THREE.ShaderChunk.clipping_planes_vertex," vViewPosition = - mvPosition.xyz;",THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.shadowmap_vertex,THREE.ShaderChunk.fog_vertex,t.vsAfter||"","}"].join("\n"),fragmentShader:function(n){return!n&&e.isNativeAndroid()?["uniform vec3 diffuse;","uniform vec3 emissive;","uniform float opacity;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifdef DOUBLE_SIDED","    varying vec3 vLightBack;","    varying vec3 vIndirectBack;","#endif",THREE.ShaderChunk.common,THREE.ShaderChunk.packing,THREE.ShaderChunk.dithering_pars_fragment,THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.uv_pars_fragment,THREE.ShaderChunk.uv2_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.alphamap_pars_fragment,THREE.ShaderChunk.aomap_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.emissivemap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.bsdfs,THREE.ShaderChunk.lights_pars_begin,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.shadowmask_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,THREE.ShaderChunk.clipping_planes_pars_fragment,t.fsHeader||"","void main() {",THREE.ShaderChunk.clipping_planes_fragment,"    vec4 diffuseColor = vec4( diffuse, opacity );","    ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","    vec3 totalEmissiveRadiance = emissive;",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.alphamap_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,THREE.ShaderChunk.emissivemap_fragment,"    reflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );","    #ifdef DOUBLE_SIDED","        reflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;","    #else","        reflectedLight.indirectDiffuse += vIndirectFront;","    #endif",THREE.ShaderChunk.lightmap_fragment,"    reflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );","    #ifdef DOUBLE_SIDED","        reflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;","    #else","        reflectedLight.directDiffuse = vLightFront;","    #endif","    reflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();",THREE.ShaderChunk.aomap_fragment,"    vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;",THREE.ShaderChunk.envmap_fragment,"    gl_FragColor = vec4( outgoingLight, diffuseColor.a );",THREE.ShaderChunk.tonemapping_fragment,THREE.ShaderChunk.encodings_fragment,THREE.ShaderChunk.fog_fragment,THREE.ShaderChunk.premultiplied_alpha_fragment,THREE.ShaderChunk.dithering_fragment,t.fsAfter||"","}"].join("\n"):["#define PHONG","uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;","uniform float opacity;",THREE.ShaderChunk.common,THREE.ShaderChunk.packing,THREE.ShaderChunk.dithering_pars_fragment,THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.uv_pars_fragment,THREE.ShaderChunk.uv2_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.alphamap_pars_fragment,THREE.ShaderChunk.aomap_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.emissivemap_pars_fragment,THREE.ShaderChunk.envmap_common_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.gradientmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.bsdfs,THREE.ShaderChunk.lights_pars_begin,THREE.ShaderChunk.lights_phong_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.bumpmap_pars_fragment,THREE.ShaderChunk.normalmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,THREE.ShaderChunk.clipping_planes_pars_fragment,t.fsHeader||"","void main() {",THREE.ShaderChunk.clipping_planes_fragment,"    vec4 diffuseColor = vec4( diffuse, opacity );","    ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","    vec3 totalEmissiveRadiance = emissive;",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.alphamap_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,THREE.ShaderChunk.normal_fragment_begin,THREE.ShaderChunk.normal_fragment_maps,THREE.ShaderChunk.emissivemap_fragment,THREE.ShaderChunk.lights_phong_fragment,THREE.ShaderChunk.lights_fragment_begin,THREE.ShaderChunk.lights_fragment_maps,THREE.ShaderChunk.lights_fragment_end,THREE.ShaderChunk.aomap_fragment,"    vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;",THREE.ShaderChunk.envmap_fragment,"    gl_FragColor = vec4( outgoingLight, diffuseColor.a );",THREE.ShaderChunk.tonemapping_fragment,THREE.ShaderChunk.encodings_fragment,THREE.ShaderChunk.fog_fragment,THREE.ShaderChunk.premultiplied_alpha_fragment,THREE.ShaderChunk.dithering_fragment,t.fsAfter||"","}"].join("\n")}(i),uniforms:THREE.UniformsUtils.clone(r),defines:{}};return n&&(n.color&&o.uniforms.diffuse.value.setHex(n.color),n.map&&(o.uniforms.map.value=n.map,o.defines.USE_MAP=""),n.normalMap&&(o.uniforms.normalMap.value=n.normalMap,o.defines.USE_NORMALMAP="",o.extensions.derivatives=!0),n.normalScale&&o.uniforms.normalScale.value.copy(n.normalScale)),o}}),bento.define("modules/firebaseanalytics",["bento","bento/eventsystem","bento/utils"],function(e,t,n){"use strict";var i=function(){},r=!0,o=window.FirebasePlugin,a={logEvent:i,setScreenName:i,setUserId:i,setUserProperty:i,init:i,setEnabled:function(e){r=e}};return o?(a.logEvent=function(e,t){o.logEvent(e,t)},a.setScreenName=function(e){o.setScreenName(e)},a.setUserId=function(e){o.setUserId(e)},a.setUserProperty=function(e,t){o.setUserProperty(e,t)},a.init=function(){t.on("FirebaseAnalytics-logEvent",function(e){r&&a.logEvent(e.name,e.properties||{})}),t.on("FirebaseAnalytics-setScreenName",function(e){r&&a.setScreenName(e)}),t.on("FirebaseAnalytics-setUserId",function(e){r&&a.setUserId(e)}),t.on("FirebaseAnalytics-setUserProperty",function(e){r&&a.setUserProperty(e.property,e.value)}),t.on("FirebaseAnalytics-setEnabled",function(e){r&&a.setEnabled(e)})},a):a}),bento.define("modules/gameanalytics",["bento","bento/eventsystem","bento/utils"],function(e,t,n){"use strict";var i=function(){},r={active:!1,initialize:i,businessEvent:i,sourceEvent:i,sinkEvent:i,startProgressionEvent:i,endProgressionEvent:i,debugErrorEvent:i,infoErrorEvent:i,warningErrorEvent:i,errorErrorEvent:i,criticalErrorEvent:i,customEvent:i,setCustomDimension:i,setGender:i,setBirthYear:i,setFacebookId:i,registerEvents:i,enable:i,disable:i},o=window.GameAnalytics,a=!1,s=function(){a||(n.log("ERROR: Trying to use analytics without the module initialized"),s=i)};return n.isDefined(o)?(!o.configureBuild&&window.gameanalytics&&(o={configureAvailableCustomDimensions01:function(e,t){window.gameanalytics.GameAnalytics.configureAvailableCustomDimensions01(e)},configureAvailableCustomDimensions02:function(e,t){window.gameanalytics.GameAnalytics.configureAvailableCustomDimensions02(e)},configureAvailableCustomDimensions03:function(e,t){window.gameanalytics.GameAnalytics.configureAvailableCustomDimensions03(e)},configureAvailableResourceCurrencies:function(e,t){window.gameanalytics.GameAnalytics.configureAvailableResourceCurrencies(e)},configureAvailableResourceItemTypes:function(e,t){window.gameanalytics.GameAnalytics.configureAvailableResourceItemTypes(e)},configureBuild:function(e,t){window.gameanalytics.GameAnalytics.configureBuild(e)},configureUserId:function(e,t){window.gameanalytics.GameAnalytics.configureUserId(e)},initialize:function(e,t){window.gameanalytics.GameAnalytics.initialize(e.gameKey,e.secretKey)},addBusinessEvent:function(e,t){window.gameanalytics.GameAnalytics.addBusinessEvent(e.currency,e.amount,e.itemType,e.itemId,e.cartType)},addResourceEvent:function(e,t){window.gameanalytics.GameAnalytics.addResourceEvent(e.flowType,e.currency,e.amount,e.itemType,e.itemId)},addProgressionEvent:function(e,t){window.gameanalytics.GameAnalytics.addProgressionEvent(e.progressionStatus,e.progression01,e.progression02,e.progression03,e.value)},addDesignEvent:function(e,t){window.gameanalytics.GameAnalytics.addDesignEvent(e.eventId,e.value)},addErrorEvent:function(e,t){window.gameanalytics.GameAnalytics.addErrorEvent(e.severity,e.message)},setEnabledInfoLog:function(e,t){window.gameanalytics.GameAnalytics.setEnabledInfoLog(e)},setEnabledVerboseLog:function(e,t){window.gameanalytics.GameAnalytics.setEnabledVerboseLog(e)},setEnabledManualSessionHandling:function(e,t){window.gameanalytics.GameAnalytics.setEnabledManualSessionHandling(e)},setCustomDimension01:function(e,t){window.gameanalytics.GameAnalytics.setCustomDimension01(e)},setCustomDimension02:function(e,t){window.gameanalytics.GameAnalytics.setCustomDimension02(e)},setCustomDimension03:function(e,t){window.gameanalytics.GameAnalytics.setCustomDimension03(e)},setFacebookId:function(e,t){window.gameanalytics.GameAnalytics.setFacebookId(e)},setGender:function(e,t){window.gameanalytics.GameAnalytics.setGender(e)},setBirthYear:function(e,t){window.gameanalytics.GameAnalytics.setBirthYear(e)},startSession:function(e,t){window.gameanalytics.GameAnalytics.startSession(e)},endSession:function(e,t){window.gameanalytics.GameAnalytics.endSession(e)},EGAErrorSeverity:window.gameanalytics.EGAErrorSeverity,EGAGender:window.gameanalytics.EGAGender,EGAResourceFlowType:window.gameanalytics.EGAResourceFlowType,EGAProgressionStatus:window.gameanalytics.EGAProgressionStatus}),r.initialize=function(e,t,i,s,c,l,u){var h="";n.isAndroidDevice()?h+="android ":n.isIosDevice()?h+="ios ":h+="web ",h+=window.VERSION,console.log('Configuring GameAnalytics for: "'+h+'"'),o.configureBuild(h),n.isDefined(i)&&(console.log("Currencies: "+JSON.stringify(i)),o.configureAvailableResourceCurrencies(i)),n.isDefined(s)&&(console.log("Items: "+JSON.stringify(s)),o.configureAvailableResourceItemTypes(s)),n.isDefined(c)&&(console.log("CustomResource01: "+JSON.stringify(c)),o.configureAvailableCustomDimensions01(c)),n.isDefined(l)&&(console.log("CustomResource02: "+JSON.stringify(l)),o.configureAvailableCustomDimensions02(l)),n.isDefined(u)&&(console.log("CustomResource03: "+JSON.stringify(u)),o.configureAvailableCustomDimensions03(u)),o.initialize({gameKey:e,secretKey:t}),console.log("GameAnalytics initialized!"),a=!0,r.active=!0},r.enable=function(){r.active=!0},r.disable=function(){r.active=!1},r.businessEvent=function(e,t,i,a,c,l,u){s(),r.active&&(n.isAndroidDevice()?o.addBusinessEvent({currency:e,amount:t,itemType:i,itemId:a,cartType:c,receipt:l,signature:u}):n.isIosDevice()?l?o.addBusinessEvent({currency:e,amount:t,itemType:i,itemId:a,cartType:c,receipt:l}):o.addBusinessEvent({currency:e,amount:t,itemType:i,itemId:a,cartType:c,autoFetchReceipt:!0}):o.addBusinessEvent({currency:e,amount:t,itemType:i,itemId:a,cartType:c}))},r.sourceEvent=function(e,t,n,i){s(),r.active&&o.addResourceEvent({flowType:o.EGAResourceFlowType.Source,currency:e,amount:t,itemType:n,itemId:i})},r.sinkEvent=function(e,t,n,i){s(),r.active&&o.addResourceEvent({flowType:o.EGAResourceFlowType.Sink,currency:e,amount:t,itemType:n,itemId:i})},r.startProgressionEvent=function(e,t,i){if(s(),r.active){var a={progressionStatus:o.EGAProgressionStatus.Start,progression01:e};n.isDefined(t)&&(a.progression02=t),n.isDefined(i)&&(a.progression03=i),o.addProgressionEvent(a)}},r.endProgressionEvent=function(e,t,i,a,c){if(s(),r.active){var l={progressionStatus:e?o.EGAProgressionStatus.Complete:o.EGAProgressionStatus.Fail,progression01:t};n.isDefined(i)&&(l.progression02=i),n.isDefined(a)&&(l.progression03=a),n.isDefined(c)&&(l.value=c),o.addProgressionEvent(l)}},r.debugErrorEvent=function(e){s(),r.active&&o.addErrorEvent({severity:o.EGAErrorSeverity.Debug,message:e})},r.infoErrorEvent=function(e){s(),r.active&&o.addErrorEvent({severity:o.EGAErrorSeverity.Info,message:e})},r.warningErrorEvent=function(e){s(),r.active&&o.addErrorEvent({severity:o.EGAErrorSeverity.Warning,message:e})},r.errorErrorEvent=function(e){s(),r.active&&o.addErrorEvent({severity:o.EGAErrorSeverity.Error,message:e})},r.criticalErrorEvent=function(e){s(),r.active&&o.addErrorEvent({severity:o.EGAErrorSeverity.Critical,message:e})},r.customEvent=function(e,t){if(s(),r.active){var i={eventId:e};n.isDefined(t)&&(i.value=t),o.addDesignEvent(i)}},r.setCustomDimension=function(e,t){if(s(),r.active)switch(e=n.clamp(1,e,3)){case 1:o.setCustomDimension01(t);break;case 2:o.setCustomDimension02(t);break;case 3:o.setCustomDimension03(t)}},r.setGender=function(e){if(s(),r.active)switch(e){case"male":o.setGender(o.EGAGender.Male);break;case"female":o.setGender(o.EGAGender.Female)}},r.setBirthYear=function(e){s(),r.active&&o.setBirthYear(e)},r.setFacebookId=function(e){s(),r.active&&o.setFacebookId(e)},r.registerEvents=function(){t.on("GameAnalytics-business",function(e){r.businessEvent(e.currency,e.amount,e.itemType,e.itemId,e.cartType,e.receipt,e.signature)}),t.on("GameAnalytics-source",function(e){r.sourceEvent(e.currency,e.amount,e.sourceType||e.itemType,e.sourceId||e.itemId)}),t.on("GameAnalytics-sink",function(e){r.sinkEvent(e.currency,e.cost||e.amount,e.sinkType||e.itemType,e.sinkId||e.itemId)}),t.on("GameAnalytics-startProgression",function(e){r.startProgressionEvent(e.id||e.progression01,e.progression02,e.progression03)}),t.on("GameAnalytics-endProgression",function(e){r.endProgressionEvent(e.didSucceed,e.id||e.progression01,e.progression02,e.progression03,e.score||e.value)}),t.on("GameAnalytics-custom",function(e){"string"==typeof e?r.customEvent(e):r.customEvent(e.id,e.value)});var e=function(e,n){t.on(e,function(e){n("string"==typeof e?e:e.message)})};e("GameAnalytics-error",r.errorErrorEvent),e("GameAnalytics-errorError",r.errorErrorEvent),e("GameAnalytics-debugError",r.debugErrorEvent),e("GameAnalytics-infoError",r.infoErrorEvent),e("GameAnalytics-warningError",r.warningErrorEvent),e("GameAnalytics-criticalError",r.criticalErrorEvent)},r):(n.log("WARNING: GameAnalytics not found!"),r)}),bento.define("modules/gamecenter",["bento/utils"],function(e){"use strict";var t=function(){return window.Cocoon.Social.GameCenter.isLoggedIn()},n=function(){},i={isLoggedIn:t,login:function(e){window.Cocoon.Social.GameCenter.login(function(t,n){if(n)return console.log("GC error",n.message),void(e&&e(!1,n.message));console.log("GC response",JSON.stringify(t)),e&&e(t.isAuthenticated,t)})},post:function(e,n,i){t()?window.Cocoon.Social.GameCenter.getSocialInterface().submitScore(e,i,{leaderboardID:n}):console.log("Not logged in to GameCenter")},show:function(e){window.Cocoon.Social.GameCenter.showLeaderboards(n,{identifier:e,category:e})},postAchievement:function(e,t){window.Cocoon.Social.GameCenter.getSocialInterface().submitAchievement(e,function(e){t&&t(e)})},showAchievement:function(e){window.Cocoon.Social.GameCenter.showAchievements(e)},loadSavedGame:function(e,n,i){t()&&window.Cocoon.Social.GameCenter.loadSavedGame(e,function(e){n&&(e.data?n(e):i(e))},function(e){i&&i(e)})},writeSavedGame:function(e,n,i){t()&&window.Cocoon.Social.GameCenter.writeSavedGame(e.identifier,e.data,function(){n&&n()},function(e){e&&i(e)})}},r={isLoggedIn:function(){return!1},login:n,post:n,show:n,postAchievement:n,showAchievement:n,loadSavedGame:n,writeSavedGame:n};return window.Cocoon&&window.Cocoon.Social&&window.Cocoon.Social.GameCenter&&e.isNativeIos()?(console.log("GameCenter available!"),i):(console.log("GameCenter unavailable"),r)}),bento.define("modules/googleplaygames",["bento","bento/utils"],function(e,t){"use strict";var n,i,r="988726576684-a4apo87l2qrhu5lkdb0ohv2qbos473p2.apps.googleusercontent.com",o=!1,a=!1,s=[],c=function(){},l=function(t,c){a||((r=t.clientId||r)||console.error("Error: enter the OAuth2 clientId. You can find this in the GPG dashboard under Linked Apps."),i=t.defaultLeaderboard,s=t.scopes||[],a=!0,e.saveState.load("playerStats",null)||e.saveState.save("playerStats",{averageSessionLength:-1,churnProbability:-1,daysSinceLastPlayed:-1,highSpenderProbability:-1,numberOfPurchases:-1,numberOfSessions:-1,sessionPercentile:-1,spendPercentile:-1,spendProbability:-1,totalSpendNext28Days:-1}),(n=window.Cocoon.Social.GooglePlayGames).init({clientId:r,defaultLeaderboard:i,showAchievementNotifications:!0,scopes:s},function(e){a=!1,o=!0,c&&c(e)}))},u=function(){if(!o)return!1;var e=n.getSocialInterface();return console.log("Google Play: is logged in",e.isLoggedIn()),e.isLoggedIn()},h=function(e){e=e||function(){},n.getSocialInterface().login(e)},d={init:c,isLoggedIn:c,login:c,post:c,show:c,postAchievement:c,showAchievement:c,submitEvent:c,loadSavedGame:c,writeSavedGame:c,showSavedGame:c,loadPlayerStats:c},p={init:function(e,t){o&&!a||l(e,t)},isLoggedIn:u,login:function(e){var t,i=this;o?(t=n.getSocialInterface()).isLoggedIn()?e&&e(!1):t.login(function(t,n){n?(e&&e(!1,n),console.error("login error: "+n.message+" "+n.code)):e&&e(t)
}):l({},function(t){i.login(e)})},post:function(e,t,i){if(o){var r=n.getSocialInterface();u()&&r.submitScore(e,i,{leaderboardID:t})}},show:function(e,t){if(o){var i=n.getSocialInterface();u()?i.showLeaderboard(function(e){console.log("show leaderboard",JSON.stringify(e))},{leaderboardID:e}):h(function(){console.log("logged in"),i.showLeaderboard(function(e){console.log("show leaderboard",JSON.stringify(e))},{leaderboardID:e})})}},postAchievement:function(e,t){if(o){var i=n.getSocialInterface();u()&&i.submitAchievement(e,function(e){console.log("achievement unlocked",e),e&&e.newlyUnlocked&&t&&t()})}},showAchievement:function(e){if(o){var t=n.getSocialInterface();u()?t.showAchievements(function(e){console.log("show leaderboard",JSON.stringify(e))}):h(function(){t.showAchievements(function(e){console.log("show leaderboard",JSON.stringify(e))})})}},submitEvent:function(e,t){o&&(window.Cocoon.Social.GooglePlayGames.submitEvent?window.Cocoon.Social.GooglePlayGames.submitEvent(e,t):console.log("submitEvent not available (cocoon devapp?)"))},loadSavedGame:function(e,t,n){o&&window.Cocoon.Social.GooglePlayGames.loadSavedGame(e,function(e,i){i&&n?n(i):t&&(e.data?t(e):n(e))})},writeSavedGame:function(e,t,n){o&&window.Cocoon.Social.GooglePlayGames.writeSavedGame(e,function(e){e&&n?n(e):t&&t()})},showSavedGame:function(e){o&&window.Cocoon.Social.GooglePlayGames.showSavedGames(e,function(e){})},loadPlayerStats:function(e){o&&window.Cocoon.Social.GooglePlayGames.loadPlayerStats(function(t,n){t&&e&&e(t),n&&(console.error(n),e&&e(null))})},loadScores:function(e,t){if(o){var n=!1!==e.topScores,i=0===e.timeSpan?0:e.timeSpan||2,r=!!e.friends,a=function(e,n){e&&t&&t(e),n&&t&&t(null)};n?window.Cocoon.Social.GooglePlayGames.loadTopScores(e.leaderboardId,i,r,a):window.Cocoon.Social.GooglePlayGames.loadPlayerCenteredScores(e.leaderboardId,i,r,a)}}};return t.isNativeAndroid()&&window.Cocoon.Social&&window.Cocoon.Social.GooglePlayGames?(console.log("Google Play Games available!"),p):(console.log("Google Play Games unavailable"),d)}),bento.define("modules/ironsource",["bento","bento/utils","bento/eventsystem"],function(e,t,n){var i,r,o,a,s,c,l,u,h=!1,d=!1,p=!1,f=!1,m=!1,g={autoShowBanner:"false",bannerPosition:"bottom",adSize:"BANNER",placement:"DefaultBanner",bannerOverlap:"true",offsetTopBar:"false",offsetBottom:"true"},v=function(){return{prepared:d,loaded:p,queue:f,visible:m}},y=function(){return m},b=!1,w=!1,x=!1,E=function(){R.prepareInterstitial(T,function(){window.setTimeout(E,3e3)})},S=!1,_=!1,T=function(){},M=function(e){e&&console.log("Iron Source Error: ",e)},C=function(){e.audio.muteMusic(!0),e.audio.muteSound(!0)},A=function(){e.audio.muteMusic(e.saveState.load("muteMusic",!1),!0),e.audio.muteSound(e.saveState.load("muteSound",!1)),bento.require(["audia"],function(e){var t=e.audioContext;t&&"suspended"===t.state&&t.resume()})},R={init:T,initialize:T,setUserConsent:T,createBannerView:T,getBannerStatus:v,isBannerVisible:y,removeBannerView:T,showBanner:T,hideBanner:T,prepareInterstitial:T,canShowInterstitial:function(e){return e&&e(!1),!1},showInterstitial:T,canShowRewarded:function(e){return e&&e(!1),!1},showRewarded:T,hasSegments:function(){return!1},setSegment:T};return window.plugins&&window.plugins.ironsource?(u=window.plugins.ironsource,R.init=function(e){var n=e.validateIntegration,i=e.bannerOptions||g,r=e.onComplete;b=e.autoLoadInterstitials,h=e.autoLoadBanners,e.appKey?u.initSdk({appKey:e.appKey||"",userId:e.userId||"",clientCallback:t.getDefault(e.clientCallback,!1)},function(){b&&E(),h&&R.createBannerView(i),n&&u.validateIntegration(),r&&r(),console.log("Iron Source Initialized!")},function(e){r&&r(e)}):t.log("Iron Source Initialization failed!","No App Key!")},R.initialize=R.init,R.setUserConsent=function(e){u.setUserConsent(e,function(){console.log("IronSource: User Consent has been set to "+e)},M)},R.createBannerView=function(e){var t=e.onComplete,n=e.onError,i={autoShowBanner:e.autoShowBanner||g.autoShowBanner,bannerPosition:e.bannerPosition||g.bannerPosition,adSize:e.adSize||g.adSize,placement:e.placement||g.placement,bannerOverlap:e.bannerOverlap||g.bannerOverlap,offsetTopBar:e.offsetTopBar||g.offsetTopBar,offsetBottom:e.offsetBottom||g.offsetBottom};u.createBannerView(i,function(){d=!0,t&&t()},n||M)},R.getBannerStatus=v,R.isBannerVisible=y,R.removeBannerView=function(e){u.removeBannerView(function(){d=!1,p=!1,f=!1,m=!1,e&&e()},M)},R.showBanner=function(e){p?u.showBanner(function(){m=!0,e&&e(),f=null},M):(R.createBannerView(t.extend(g,{onComplete:function(){console.log("IronSource banner view created"),d=!0}})),f=e)},R.hideBanner=function(e){m&&u.hideBanner(function(){m=!1,e&&e()},M)},R.prepareInterstitial=function(e,t){x?e&&e():(i=e,r=t,u.prepareInterstitialView(T,M))},R.canShowInterstitial=function(e){return e&&e(x),x},R.hasInterstitial=function(e,t){u.isInterstitialReady(function(n){n?e():t()},function(e){t?t(e):M(e)})},R.showInterstitial=function(e){var t=e.tag,i=e.onComplete||M;t||(t=""),R.canShowInterstitial(function(r){w?i("Already showing interstitial"):(w=!0,o=function(){e.muteAudio&&A(),i(),o=null,a=null,w=!1,n.fire("onInterstitialAdComplete",{tag:t})},a=function(t){e.muteAudio&&A(),i(t||"Failed to show"),o=null,a=null,w=!1},e.muteAudio&&C(),u.showInterstitialView(t,T,function(t){e.muteAudio&&A(),console.log("Cordova error "+t),i(t||"Cordova error"),o=null,a=null,w=!1}))},function(e){i(e||"Interstitial not ready to show")})},R.canShowRewarded=function(e){return e&&e(S),S},R.hasRewardedVideo=function(e,t){u.hasRewardedVideo(e,t)},R.showRewarded=function(e){var t=e.onReward||function(){},i=e.onComplete||function(){},r=e.tag||"";R.canShowRewarded()?_?i("Already showing ad"):(_=!0,l=function(t){e.muteAudio&&A(),i(t||"Failed to show rewarded ad"),c=null,l=null,_=!1,s=null},c=function(){e.muteAudio&&A(),i(),c=null,l=null,_=!1},s=function(){t(),s=null,n.fire("onRewardedAdComplete",{tag:r})},e.muteAudio&&C(),u.showRewardedVideo(r,T,function(t){e.muteAudio&&A(),i(t||"Cordova failure"),c=null,l=null,_=!1,s=null})):i("Rewarded ad not ready")},R.hasSegments=function(){return u.setUserSegment},R.setSegment=function(e,t){u.setUserSegment?u.setUserSegment(e,t,t):t&&t()},document.addEventListener("bannerDidLoad",function(e){n.fire("IronSource-bannerDidLoad",e),p=!0,f&&R.showBanner(f)},!1),document.addEventListener("bannerDidFailToLoadWithError",function(e){n.fire("IronSource-bannerDidFailToLoadWithError",e)},!1),document.addEventListener("didClickBanner",function(e){n.fire("IronSource-didClickBanner",e)},!1),document.addEventListener("bannerWillPresentScreen",function(e){n.fire("IronSource-bannerDidDismissScreen",e)},!1),document.addEventListener("bannerDidDismissScreen",function(e){n.fire("IronSource-bannerDidDismissScreen",e)},!1),document.addEventListener("bannerWillLeaveApplication",function(e){n.fire("IronSource-bannerWillLeaveApplication",e)},!1),document.addEventListener("interstitialDidLoad",function(e){n.fire("IronSource-interstitialDidLoad",e),x=!0,i&&i(e)},!1),document.addEventListener("interstitialDidFailToLoadWithError",function(e){n.fire("IronSource-interstitialDidFailToLoadWithError",e),x=!1,r&&r(e)},!1),document.addEventListener("interstitialDidShow",function(e){n.fire("IronSource-interstitialDidShow",e)},!1),document.addEventListener("interstitialDidFailToShowWithError",function(e){n.fire("IronSource-interstitialDidFailToShowWithError",e),a&&a(e),x=!1,b&&E()},!1),document.addEventListener("didClickInterstitial",function(e){n.fire("IronSource-didClickInterstitial",e)},!1),document.addEventListener("interstitialDidClose",function(e){n.fire("IronSource-interstitialDidClose",e),o&&o(e),x=!1,b&&E()},!1),document.addEventListener("interstitialDidOpen",function(e){n.fire("IronSource-interstitialDidOpen",e)},!1),document.addEventListener("didClickRewardedVideo",function(e){n.fire("IronSource-didClickRewardedVideo",e)},!1),document.addEventListener("rewardedVideoDidClose",function(e){n.fire("IronSource-rewardedVideoDidClose",e),c&&c(e)},!1),document.addEventListener("rewardedVideoDidOpen",function(e){n.fire("IronSource-rewardedVideoDidOpen",e)},!1),document.addEventListener("rewardedVideoDidFailToShowWithError",function(e){n.fire("IronSource-rewardedVideoDidFailToShowWithError",e),l&&l(e)},!1),document.addEventListener("didReceiveRewardForPlacement",function(e){n.fire("IronSource-didReceiveRewardForPlacement",e),s&&(s(e),s=null)},!1),document.addEventListener("rewardedVideoHasChangedAvailability",function(e){n.fire("IronSource-rewardedVideoHasChangedAvailability",e);try{var t=JSON.parse(e.msg);S=t.available}catch(e){S=!1}},!1),document.addEventListener("rewardedVideoDidEnd",function(e){n.fire("IronSource-rewardedVideoDidEnd",e)},!1),document.addEventListener("rewardedVideoDidStart",function(e){n.fire("IronSource-rewardedVideoDidStart",e)},!1),R):(t.log("WARNING: IronSource not found!"),R)}),bento.define("modules/localization",["bento","bento/utils"],function(e,t){"use strict";var n="en",i=[],r={},o=function(n,i){var o=e.assets.getAssets().json,a=[];return r={},t.forEach(o,function(e,o,s,c){0===o.indexOf("localization/")&&o.slice(-2)===n&&(e.base&&t.log("WARNING: json key 'base' is a reserved name, in file "+o),t.extend(r,e,!1,function(n){var s=e[n];t.isString(s)||t.isArray(s)?(t.log('WARNING: duplicate key "'+n+'" detected in language json "'+o+'"'),i&&(i.errors=i.errors,i.errors+=1)):a.push({key:n,duplicate:s,original:r[n]})}))}),t.forEach(a,function(e,o,a,s){t.extend(r[e.key],e.original,!1,function(r){t.log('WARNING: Inner conflict in language "'+n+'" with key "'+e.key+"/"+r+'"'),i&&(i.errors=i.errors,i.errors+=1)}),i&&(i.merges=i.merges,i.merges+=1)}),r},a={systemLanguage:"en",getText:function(e){var n=r[e];return t.isDefined(n)||t.log("WARNING: "+e+" was not found in localization strings"),n||""},setLanguage:function(e){e=e||a.systemLanguage,-1===i.indexOf(e)&&(e="en"),window.currentLanguage=e,window.isChinese=a.isChinese,console.log("Language set to "+e);try{r=o(e),n=e}catch(t){console.error("ERROR: language json "+e+" does not exist!!"),console.log(t)}},init:function(){var s,c,l;"ru"===LocalizationLanguage?(console.log("-----------Localisation Russe--------------"),c="ru"):"com"===LocalizationLanguage?(console.log("-----------Localisation Anglais--------------"),c="en"):c="en",l=c.toLowerCase(),console.log("Detected system language:",c),function(){var t,n=e.assets.getAssets().json;for(t in n)n.hasOwnProperty(t)&&0===t.indexOf("localization/")&&i.indexOf(t.slice(-2))<0&&i.push(t.slice(-2))}(),s=c.substr(0,2).toLowerCase(),("zh-tw"===l||l.indexOf("zh-hant")>=0||"zh-hk"===l)&&(s="zt"),function(e){var t,n;for(t=0,n=i.length;t<n;++t)if(i[t]===e)return!0;return!1}(s)&&(n=s),a.systemLanguage=n,window.currentLanguage=n,this.setLanguage(n),t.isDev()&&(window.inspectLanguages=function(){var e=r;t.forEach(i,function(e,n,i,r){var a={merges:0,errors:0},s=o(e,a);console.log(e+": "+t.getKeyLength(s)+" keys, "+a.merges+" merges,"+a.errors+" errors.")}),r=e})},getLanguage:function(){return n},isChinese:function(){return"zh"===n||"zt"===n},cleanUnusedAssets:function(){var n=e.assets.getAssetGroups();t.forEach(n,function(e){var n=e.json||{};t.forEach(n,function(e,t,i,r){var o=t.slice(-2);0===t.indexOf("localization/")&&o!==a.systemLanguage&&delete n[t]})})}};return a}),bento.define("modules/mopub",["bento","bento/utils","bento/eventsystem"],function(e,t,n){var i,r,o,a,s,c,l,u,h,d="xxxx",p=!1,f=!1,m=!1,g=!1,v=!1,y=!1,b={adUnitId:"xxxx",adSize:t.isNativeIos()?"320X50":"kMPPresetMaxAdSize50Height",bannerAtTop:!1,bannerOverlap:!0,autoRefreshBanner:!0,offsetTopBar:!0,autoShow:!1},w=function(){console.log("AUTO LOAD BANNER"),k.createBannerView(t.extend(b,{onError:function(){window.setTimeout(w,1e4)}}))},x=!1,E=!1,S=!1,_="yyyy",T=function(){k.prepareInterstitial(I,function(){window.setTimeout(T,1e4)})},M=!1,C="zzzz",A=function(){k.prepareRewarded(I,function(){window.setTimeout(A,1e4)})},R=!1,P=!1,I=function(){},L=function(e){e&&console.log("MoPub Error: ",e)},D=function(){e.audio.muteMusic(!0),e.audio.muteSound(!0)},O=function(){e.audio.muteMusic(e.saveState.load("muteMusic",!1),!0),e.audio.muteSound(e.saveState.load("muteSound",!1)),bento.require(["audia"],function(e){var t=e.audioContext;t&&"suspended"===t.state&&t.resume()})},k={init:function(e){e.onComplete&&e.onComplete()},initialize:I,createBannerView:I,removeBannerView:I,showBanner:I,hideBanner:I,getBannerStatus:function(){return{prepared:m,loaded:g,queue:v,visible:y}},isBannerVisible:function(){return y},canShowBanner:function(e){return e&&e(!1),!1},prepareInterstitial:I,canShowInterstitial:function(e){return e&&e(!1),!1},showInterstitial:I,prepareRewarded:I,canShowRewarded:function(e){return e&&e(!1),!1},showRewarded:I};return window.cordova&&window.cordova.plugins&&window.cordova.plugins.MoPub?(h=window.cordova.plugins.MoPub,k.init=function(e){x=e.autoLoadInterstitials||x,M=e.autoLoadRewarded||M,p=e.autoLoadBanners||p,d=e.appKey||d,C=e.rewardedId||C,_=e.InterstitialId||_,b.adUnitId=e.bannerId||b.adUnitId;var t={adId:d,debugLevel:e.debugLevel||"none",legitmateInterest:!0,getConsent:!0,forceConsentDialog:!0},n=e.onComplete;h.initSdk(t,function(){M&&A(),x&&T(),p&&w(),n&&n(),console.log("MoPub Initialized!")},function(e){console.log("MoPub not initialized... check error."),n&&n(e)})},k.initialize=k.init,k.createBannerView=function(e){var t=e.onComplete,i=e.onError;if(g)t&&t();else if(m)t&&t();else if(!f){var r={adUnitId:b.adUnitId,adSize:e.adSize||b.adSize,bannerAtTop:e.bannerAtTop||b.bannerAtTop,bannerOverlap:e.bannerOverlap||b.bannerOverlap,autoRefreshBanner:e.autoRefreshBanner||b.autoRefreshBanner,offsetTopBar:e.offsetTopBar||b.offsetTopBar,autoShow:e.autoShow||b.autoShow};h.createBannerView(r,function(e){m=!0,f=!1,t&&t(),n.fire("onBannerView",{bannerViewId:e,adUnitId:r.adUnitId})},i||L),f=!0}},k.canShowBanner=function(e){return e&&e(g),g},k.removeBannerView=function(e){h.removeBannerView(function(){m=!1,g=!1,v=!1,y=!1,e&&e()},L)},k.showBanner=function(e){g?h.showAd(function(){y=!0,e&&e(),v=null},L):(v=e,k.createBannerView(t.extend(b,{onComplete:function(){console.log("MoPub banner view created"),m=!0}})))},k.hideBanner=function(e){y&&h.hideAd(function(){y=!1,e&&e()},L)},k.prepareInterstitial=function(e,t){S?e&&e():(i=e,r=t,h.createInterstitialView({interstitialAdId:_},I,L))},k.canShowInterstitial=function(e){return e&&e(S),S},k.hasInterstitial=function(e,t){h.isInterstitialReady(function(n){n?e():t()},function(e){t?t(e):L(e)})},k.showInterstitial=function(e){var t=e.tag,i=e.onComplete||L;t||(t=""),k.canShowInterstitial(function(r){E?i("Already showing interstitial"):(E=!0,o=function(){e.muteAudio&&O(),i(),o=null,E=!1,n.fire("onInterstitialAdComplete",{tag:t})},e.muteAudio&&D(),h.showInterstitialAd(I,function(t){e.muteAudio&&O(),console.log("Cordova error "+t),i(t||"Cordova error"),o=null,E=!1}))})},k.prepareRewarded=function(e,t){R?e&&e():(a=e,s=t,h.createRewardVideo({rewardVideoId:C},I,L))},k.canShowRewarded=function(e){return e&&e(R),R},k.hasRewarded=function(e,t){h.isRewardVideoReady(function(n){n?e():t()},function(e){t?t(e):L(e)})},k.showRewarded=function(e){var t=e.onReward||function(){},i=e.onComplete||function(){},r=e.tag||"";k.canShowRewarded()?P?i("Already showing ad"):(P=!0,u=function(t){e.muteAudio&&O(),i(t||"Failed to show rewarded ad"),l=null,u=null,P=!1,c=null},l=function(){e.muteAudio&&O(),i(),l=null,u=null,P=!1},c=function(){t(),c=null,n.fire("onRewardedAdComplete",{tag:r})},e.muteAudio&&D(),h.showRewardVideo(I,function(t){e.muteAudio&&O(),i(t||"Cordova failure"),l=null,u=null,P=!1,c=null})):i("Rewarded ad not ready")},document.addEventListener("interstitialDidLoadAd",function(e){n.fire("MoPub-interstitialDidLoadAd",e),S=!0,i&&i(e)},!1),document.addEventListener("interstitialDidFailToLoadAd",function(e){n.fire("MoPub-interstitialDidFailToLoadAd",e),S=!1,r&&r(e)},!1),document.addEventListener("interstitialDidAppear",function(e){n.fire("MoPub-interstitialDidAppear",e)},!1),document.addEventListener("interstitialDidReceiveTapEvent",function(e){n.fire("MoPub-interstitialDidReceiveTapEvent",e)},!1),document.addEventListener("interstitialDidDisappear",function(e){n.fire("MoPub-interstitialDidDisappear",e),o&&o(e),S=!1,x&&T()},!1),document.addEventListener("rewardedVideoAdDidReceiveTapEventForAdUnitID",function(e){n.fire("MoPub-rewardedVideoDidReceiveTapEvent",e)},!1),document.addEventListener("rewardedVideoAdDidDisappearForAdUnitID",function(e){n.fire("MoPub-rewardedVideoDidDisappear",e),l&&l(e),R=!1,M&&A()},!1),document.addEventListener("rewardedVideoAdDidAppearForAdUnitID",function(e){n.fire("MoPub-rewardedVideoDidAppear",e)},!1),document.addEventListener("rewardedVideoAdDidFailToPlayForAdUnitID",function(e){n.fire("MoPub-rewardedVideoDidFailToPlay",e),u&&u(e)},!1),document.addEventListener("rewardedVideoAdShouldRewardForAdUnitID",function(e){n.fire("MoPub-rewardedVideoShouldReward",e),c&&(c(e),c=null)},!1),document.addEventListener("rewardedVideoAdDidLoadForAdUnitID",function(e){n.fire("MoPub-rewardedVideoDidLoad",e),R=!0,a&&a(e)},!1),document.addEventListener("rewardedVideoAdDidExpireForAdUnitID",function(e){n.fire("MoPub-rewardedVideoDidFailToLoadAd",e),R=!1,s&&s(e)},!1),document.addEventListener("adViewDidLoadAd",function(e){n.fire("MoPub-bannerDidLoad",e),g=!0,v&&k.showBanner(v)},!1),document.addEventListener("adViewDidFailToLoadAd",function(e){f=!1,m=!1,g=!1,n.fire("MoPub-bannerDidFailToLoad",e)},!1),document.addEventListener("willPresentModalViewForAd",function(e){n.fire("MoPub-didClickBanner",e),n.fire("MoPub-bannerExpanded",e)},!1),document.addEventListener("didDismissModalViewForAd",function(e){n.fire("MoPub-bannerDidDismiss",e)},!1),document.addEventListener("willLeaveApplicationFromAd",function(e){n.fire("MoPub-bannerWillLeaveApplication",e)},!1),k):(t.log("WARNING: MoPub not found!"),k)}),bento.define("modules/nativestorage",["bento","bento/utils"],function(e,t){"use strict";var n={},i=[],r={setItem:function(e,t){n.hasOwnProperty(e)||i.push(e),n[e]=t,o.setItem(e,t,function(){},function(n){console.error("Failed saving key: "+e+" value: "+t+" to native storage. Error code: "+n.code)})},getItem:function(e){var i=n[e];return t.isDefined(i)?i:null},removeItem:function(e){var t=i.indexOf(e);-1!==t&&i.splice(t,1),delete n[e],o.remove(e,function(){},function(t){console.error("Failed removing key: "+e+" from native storage. Error code: "+t.code)})},clear:function(){n={},i=[],o.clear(function(){},function(e){console.error("Failed clearing from native storage. Error code: "+e.code)})},key:function(e){return i[e]},get length(){return i.length}},o=window.NativeStorage;return{init:function(a){var s=a.onComplete,c=a.migrateFromLocalStorage,l=e.saveState.getId(),u=function(){var e,t,i=[],r=function(e){var t;e&&0===e.indexOf(l)&&(t=window.localStorage[e],n[e]=t,o.setItem(e,t,function(){window.localStorage.removeItem(e)},function(n){console.error("Failed migrating key: "+e+" value: "+t+" to native storage. Error code: "+n.code)}))};for(e=0,t=window.localStorage.length||0;e<t;++e)i.push(window.localStorage.key(e));for(e=0,t=i.length;e<t;++e)r(i[e]);h()},h=function(){i=Object.keys(n),e.saveState.setStorage(r),console.log("Using NativeStorage as save state"),s&&s()};if(!o)return console.warn("NativeStorage plugin not found."),void(s&&s());console.log("NativeStorage: Loading saveState from native storage"),o.keys(function(e){!function(e,i,r){var a=0,s=0,c=function(){a===s&&r()};t.forEach(i,function(t,n,i,r){0===t.indexOf(e)&&(a+=1)}),t.forEach(i,function(t,i,r,a){0===t.indexOf(e)&&o.getItem(t,function(e){n[t]=e,s+=1,c()},function(e){console.error("Failed loading key: "+t+" from native storage. Error code: "+e.code),s+=1,c()})}),c()}(l,e,function(){console.log("NativeStorage: Load complete"),c?u():h()})},function(){console.error("Unable to retrieve keys"),c?u():h()})},setItem:o?o.setItem:void 0,getItem:o?o.getItem:void 0,keys:o?o.keys:void 0,remove:o?o.remove:void 0,clear:o?o.clear:void 0,initWithSuiteName:o?o.initWithSuiteName:void 0}}),bento.define("modules/notifications",["bento/utils","bento/eventsystem"],function(e,t){"use strict";var n,i=!1,r=function(){},o={init:function(t){window.Cocoon&&window.Cocoon.Notification&&window.Cocoon.Notification.Local?i?(e.log("ERROR: Local notifications already initialized."),t&&t(i)):(n=window.Cocoon.Notification.Local).initialize({},function(r,o){n.isRegistered(function(r){r?console.log("Notifications registered successfully"):e.log("ERROR: couldn't register notifications"),i=r,n.idIndex=Date.now(),t&&t(i)})}):e.log("ERROR: No local notification plugin found")},send:function(t,r){var o=t.deltaTime||864e5,a=t.title,s=t.text,c={title:a||"",message:t.message||e.isNativeIos()?s:a,soundEnabled:e.getDefault(t.message,!0),badgeNumber:e.getDefault(t.badgeNumber,1),userData:t.userData||{},contentBody:t.contentBody||e.isNativeIos()?"":s,contentTitle:t.contentTitle||"",date:Date.now()+o,icon:t.icon||"notification_icon"};if(i)return function(t,i){if(t){console.log("Preparing to send notification");var r=n.send(t,function(e){window.setTimeout(function(){i&&i(e||r)},1)});return r}e.log("ERROR: No notification to send")}(c,r);e.log("Local Notifications are not initialized")},cancel:function(e){i&&n.cancel(e)},cancelAll:function(){n.cancelAllNotifications()},resetBadgeNumber:function(){i?e.isNativeIos()&&n.setBadgeNumber(0):console.log("Local Notifications are not initialized")}};return window.Cocoon||(o.init=r,o.send=r,o.resetBadgeNumber=r),o}),bento.define("modules/roadinfo",["bento","bento/utils","globals"],function(e,t,n){"use strict";var i=[{side:2,distance:5,chance:.01,start:7,models:"props/rock00",positionX:function(e){return t.getRandomRangeFloat(12,18)*e},rotationY:function(e){return t.getRandomFloat(6.2)},scale:function(){return 1.4}},{side:2,distance:20,chance:.05,start:24,models:"props/tree00",positionX:function(e){return t.getRandomRangeFloat(10,15)*e},rotationY:function(e){return t.getRandomFloat(6.2)},scale:function(){return 1+t.getRandomFloat(.8)}},{side:2,distance:40,chance:.02,start:4,models:["props/house00","props/house01","props/house02"],positionX:function(e){return 20*e},scale:function(){return 2.4}}],r=[{side:2,distance:5,chance:.004,start:8,models:"props/umbrella00",positionX:function(e){return t.getRandomRangeFloat(11,17)*e},scale:function(){return 1.4}},{side:2,distance:5,chance:.008,start:7,models:"props/grass00",positionX:function(e){return t.getRandomRangeFloat(12,18)*e},rotationY:function(e){return t.getRandomFloat(6.2)},scale:function(){return 1.4}},{side:0,distance:15,chance:.02,start:7,models:"props/beach_chair",positionX:function(e){return t.getRandomRangeFloat(15,15.3)*e},rotationY:function(e){return(e+1)/2*3.1415+t.getRandomRangeFloat(-.02,.02)},scale:function(){return 1.4},repeat:function(e,n,i,r,o){t.getRandom(3)&&(-1===n?r(-5,0):r(0,-50),o(e,n,i-8,r,o))}},{side:2,distance:20,chance:.04,start:13,models:["props/tree01","props/tree02"],positionX:function(e){return t.getRandomRangeFloat(10,15)*e},rotationY:function(e){return t.getRandomFloat(6.2)},scale:function(){return 1+t.getRandomFloat(.8)}},{side:1,distance:30,chance:.024,start:8,models:["props/beach_house00","props/beach_house01","props/beach_house02"],positionX:function(e){return 20*e},rotationY:function(e){return 3.1415*(1-(e+1)/2)},scale:function(){return 2.4}}],o=[{side:2,distance:20,chance:.05,start:24,models:["props/tree03","props/tree04","props/tree05"],positionX:function(e){return t.getRandomRangeFloat(14,18)*e},rotationY:function(e){return t.getRandomFloat(6.2)},scale:function(){return 1+t.getRandomFloat(.8)}},{side:2,distance:40,chance:.02,start:4,models:["props/house03","props/house04"],positionX:function(e){return 20*e},scale:function(){return 2.4}}],a=[{side:2,distance:20,chance:.05,start:24,models:"props/tree06",positionX:function(e){return t.getRandomRangeFloat(15,28)*e},rotationY:function(e){return t.getRandomFloat(6.2)},scale:function(){return 1.5+t.getRandomFloat(1.2)}},{side:2,distance:40,chance:.02,start:4,models:["props/lantern00"],positionX:function(e){return 16*e},scale:function(){return 1.8}},{side:2,distance:40,chance:.02,start:4,models:["props/house05","props/house06"],positionX:function(e){return 20*e},rotationY:function(e){return 3.1415*(1-(e+1)/2)},scale:function(){return 2.4}}],s=[{side:1,distance:12,uniform:14,chance:1,start:300/14,models:"props/fence01",positionX:function(e){return 9.8*e},rotationY:function(e){return(e+1)/2*3.1415},scale:function(){return.7}},{side:0,distance:2,chance:.1,start:14,models:"props/grass01",positionX:function(e){return t.getRandomRangeFloat(8.7,9.5)*e},rotationY:function(e){return t.getRandomFloat(6.2)},scale:function(){return.7}},{side:0,distance:8,chance:.05,start:5,models:["props/rock01","props/rock02","props/rock03","props/rock04"],positionX:function(e,n){var i=(n-2.8)/21.2;return(13.5+10*(i*=i)+t.getRandomRangeFloat(-.3,.3)*i)*e},positionY:function(){return t.getRandomRangeFloat(2.8,24)},rotationY:function(e){return t.getRandomFloat(6.2)},scale:function(){return t.getRandomRangeFloat(1,1.4)}},{side:0,distance:8,chance:.02,start:3,models:["props/tree07"],positionX:function(e,n){var i=(n-.4)/23.6;return(11+11*(i*=i)+t.getRandomRangeFloat(-.2,.2)*i)*e},positionY:function(){return t.getRandomRangeFloat(.4,24)},rotationY:function(e){return(e+1)/2*3.1415+3.1415},scale:function(){return t.getRandomRangeFloat(.5,.9)}},{side:0,distance:2,chance:.02,start:3,models:["props/tree08"],positionX:function(e,t){return(t/-5*-4-12)*e},positionY:function(){return t.getRandomRangeFloat(-5,0)},rotationY:function(e){return t.getRandomFloat(6.2)},scale:function(){return t.getRandomRangeFloat(.5,.9)}},{side:0,distance:2,chance:.01,start:4,models:["props/rock01","props/rock02","props/rock03"],positionX:function(e,t){return-12.3*e},positionY:function(){return-10.3},rotationY:function(e){return t.getRandomFloat(6.2)},scale:function(){return t.getRandomRangeFloat(1.2,1.4)}}],c=[{side:2,distance:20,chance:.005,start:0,models:"props/tunnel00",noFinishLine:!0,noRamp:!0,coolDistance:400,cooldown:0,iteration:0,maxRepeat:12,positionX:function(e){return 0},rotationY:function(e){return 0},scale:function(){return 1},repeat:function(e,n,i,r,o){this.iteration<this.maxRepeat&&t.getRandom(8)||this.iteration<1?(r(-20,-20),this.iteration++,o(e,n,i-20,r,o)):this.iteration=0}},{side:2,distance:5,chance:.01,start:3,models:"props/bush00",positionX:function(e){return t.getRandomRangeFloat(12,18)*e},rotationY:function(e){return t.getRandomFloat(6.2)},scale:function(){return 1.4}},{side:2,distance:5,chance:8e-4,start:1,models:"props/sign00",positionX:function(e){return 11*e},rotationY:function(e){return 0},scale:function(){return 1.4}},{side:2,distance:12,chance:.05,start:16,models:"props/tree09",positionX:function(e){return t.getRandomRangeFloat(13,37)*e},rotationY:function(e){return t.getRandomFloat(6.2)},scale:function(){return 1+t.getRandomFloat(.8)}},{side:2,distance:18,chance:.08,start:16,models:["props/rock05","props/rock06"],positionX:function(e){return t.getRandomRangeFloat(20,45)*e},rotationY:function(e){return t.getRandomFloat(6.2)},scale:function(){return.5+t.getRandomFloat(.8)}}];return function(e){var l;switch(e){case 0:return{textures:{road:"environment/road00",grassl:"environment/grass00",grassr:"environment/grass00"},remove:["sidel","sider","cliffl","cliffr"],props:i,curve:{startX:3,startY:6,randomX:200,randomY:500}};case 1:return(l={noHorizon:!0,side:t.getRandom(2),textures:{road:"environment/road01",grassl:"environment/grass01",grassr:"environment/grass01"},remove:["cliffl","cliffr"],props:r,curve:{startX:2,startY:0,randomX:100,randomY:0}}).side?(l.textures.sider="environment/water00",l.remove.push("sidel")):(l.textures.sidel="environment/water00",l.remove.push("sider")),l;case 2:return{textures:{road:"environment/road02",grassl:"environment/grass02",grassr:"environment/grass02"},remove:["sidel","sider","cliffl","cliffr"],props:o,curve:{startX:3,startY:6,randomX:200,randomY:200}};case 3:return{noHorizon:!0,textures:{road:"environment/road05",grassl:"environment/grass01",grassr:"environment/grass01"},remove:["sidel","sider","cliffl","cliffr"],props:c,curve:{startX:3,startY:6,randomX:200,randomY:150}};case 4:return{textures:{road:"environment/road03",grassl:"environment/grass03",grassr:"environment/grass03"},remove:["sidel","sider","cliffl","cliffr"],props:a,curve:{startX:3,startY:6,randomX:200,randomY:150}};case 5:return(l={noHorizon:!0,side:0,textures:{road:"environment/road04",cliffl:"environment/wall00",cliffr:"environment/wall00"},remove:["grassl","grassr","sidel","sider"],cliffWall:[],props:s,curve:{startX:4,startY:2,randomX:150,randomY:90}}).side?(l.cliffWall.push("cliffr"),n.wallRight=!0,n.fallLeft=!0):(l.cliffWall.push("cliffl"),n.wallLeft=!0,n.fallRight=!0),l;default:return{textures:{road:"environment/road00",grassl:"environment/grass00",grassr:"environment/grass00"},remove:["sidel","sider","cliffl","cliffr"],props:i,curve:{startX:3,startY:6,randomX:200,randomY:500}}}}}),bento.define("modules/savemanager",["bento","bento/utils"],function(e,t){var n={playerName:"Player",rank:0,stage:0,experience:0,carRank:0,doubleTime:0,giftSavedTime:0,mergeGiftTimer:0,freeUpgradeTimer:0,mergeBoard:[0],crates:0,specialCrates:[],coins:0,gems:0,cloudAge:0,noAds:!1,noAdsDialogCount:0,noAdsDialogShown:0,skippedAds:0,luckySpins:3,luckyWheelTimer:0,luckyWheelAmount:0,preMondayPopup:0,vipRewardTimer:0,vipSkin:1,testDrive:0,showTestDrive:2,showSubscription:!1,notificationsAsked:0,notificationsAllowed:!1,notification1Day:null,notification2Day:null,notification1Week:null,notification2Week:null,notificationMondayMadness:null,identifier:0,ABChoose:0,ABRaceSpeed:0,ABInterstitials:0,ABRaceTime:0,ABForcedTutorial:0,ABInterstitialsChina:0,ABInterstitialTutorial:0,ABRaceTime2:0,ABWinnerTutorial:0,isDev:!1},i={boughtCar:0},r=function(e){return null!==e&&(e.constructor===Array?e=[].concat(e):"object"==typeof e&&(e=JSON.parse(JSON.stringify(e)))),e},o=function(e){var o,a;if(n.hasOwnProperty(e))return!0;if(-1!==e.indexOf("-")){if(o=e.split("-")[0],e===o+"-")return t.log("only base part of key provided!"),!1;if(i.hasOwnProperty(o))return a=r(i[o]),n[e]=a,!0}return t.log("WARNING: save key "+e+" is not defined!"),!1},a={Keys:n,Base:i,save:function(t,n){o(t)&&e.saveState.save(t,n)},load:function(t){if(o(t)){var i=r(n[t]);return e.saveState.load(t,i)}},add:function(e,t){var n=a.load(e);n+=t,a.save(e,n)}};return a}),bento.define("modules/serverlog",["bento","bento/math/vector2","bento/math/rectangle","bento/entity","bento/eventsystem","bento/utils","bento/tween"],function(e,t,n,i,r,o,a){"use strict";var s={ip:"http://10.19.132.105:3000",id:0,send:function(e,t){var n=new window.XMLHttpRequest,i={name:e,log:t};try{n.open("POST",s.ip+"/save")}catch(e){console.log("Sending to logger failed: "+e)}n.setRequestHeader("Content-Type","application/json;charset=UTF-8"),n.timeout=2e3,n.onreadystatechange=function(){4===n.readyState&&(n.status>=200&&n.status<300||console.log("Sending to logger failed: "+n.responseText))},n.ontimeout=function(e){console.log("Sending to logger failed: "+e)},n.send(JSON.stringify(i)),s.id+=1},log:function(e){var t=new window.XMLHttpRequest,n={log:e};try{t.open("POST",s.ip+"/log")}catch(e){console.log("Sending to logger failed: "+e)}t.setRequestHeader("Content-Type","application/json;charset=UTF-8"),t.timeout=2e3,t.onreadystatechange=function(){4===t.readyState&&(t.status>=200&&t.status<300||console.log("Sending to logger failed: "+t.responseText))},t.ontimeout=function(e){console.log("Sending to logger failed: "+e)},t.send(JSON.stringify(n))}};return s}),bento.define("modules/store",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/eventsystem","bento/entity","bento/tween","utils"],function(e,t,n,i,r,o,a,s,c){"use strict";var l="",u={apple:"",google:""},h=function(e,t,n,i){var r;try{r=JSON.stringify(n),i&&(r+="\n\n"+i),o.fire("Analytics",{category:"IAP",action:"validation_failure_"+t,label:r})}catch(e){
console.log("Unable to track failure."),o.fire("Analytics",{category:"IAP",action:"tracking_failure",label:i})}console.log("Validation failure")},d="",p=[],f=!1,m={},g=[],v=function(e){var t,n=0;for(n=0;n<g.length;++n)if((t=g[n])&&t.productId===e)return t;return t},y=function(e){if(e)return console.log("ERROR: initializing store plugin"),void c.log(e);console.log("init store"),c.isDev()&&console.log("products to fetch:",JSON.stringify(p)),window.Cocoon.InApp.fetchProducts(p,b)},b=function(e,t){if(t)return console.log("onProductsFetchFailed",JSON.stringify(t)),void window.setTimeout(function(){window.Cocoon.InApp.fetchProducts(p,b)},3e4);for(var n=e.length-1;n>=0;n--)g.push(e[n]);c.isDev(),f=!0,x()},w=function(){window.Cocoon.InApp.setValidationHandler(function(e,t,n){var i,r;console.log("Custom validation started");var a="";if(c.isNativeIos())a="apple",i=window.encodeB64?window.encodeB64(e):window.btoa(e),d=i;else if(c.isNativeAndroid()){a="google",i=e;try{r=JSON.parse(e)}catch(e){r={signedData:"",signature:""}}d={purchaseData:r.signedData,dataSignature:r.signature}}else c.log("No validation available for this device");var s={receipt:i,key:u[a]},p=new window.XMLHttpRequest;p.open("POST","https://xbsl2jkdvg.execute-api.us-east-1.amazonaws.com/latest/"+a),p.setRequestHeader("Content-Type","application/json;charset=UTF-8"),p.send(JSON.stringify(s)),p.onreadystatechange=function(){var s={init:function(c){"SUCCESS"===c.status&&c.result.isValid?s[a](c.result):(n(!1),o.fire("IapValidation",{validated:!1,productId:t,b64receipt:i,receiptData:r}),h(0,"rejected",e))},apple:function(s){var c=s.purchaseData.service,u=s.purchaseData.receipt.bid,d=s.purchaseData.receipt.product_id;a===c&&l===u&&t===d?(n(!0),o.fire("IapValidation",{validated:!0,productId:t,b64receipt:i,receiptData:r,serverResponse:s})):(n(!1),o.fire("IapValidation",{validated:!1,productId:t,b64receipt:i,receiptData:r,serverResponse:s}),h(0,"rejectedByApple",e))},google:function(s){var c=s.purchaseData.service,u=s.purchaseData.packageName,d=s.purchaseData.productId;a===c&&l===u&&t===d?(n(!0),o.fire("IapValidation",{validated:!0,productId:t,b64receipt:i,receiptData:r,serverResponse:s})):(n(!1),o.fire("IapValidation",{validated:!1,productId:t,b64receipt:i,receiptData:r,serverResponse:s}),h(0,"rejectedByGoogle",e))}};if(4===p.readyState)if(p.status>=200&&p.status<300)try{console.log("iap success"),s.init(JSON.parse(p.responseText))}catch(a){d=null,n(!0),o.fire("IapValidation",{validated:!1,productId:t,b64receipt:i,receiptData:r}),h(0,"parseError",e,p.responseText)}else h(0,"unexpectedHttpResponse",e,p.responseText),d=null,n(!1),o.fire("IapValidation",{validated:!1,productId:t,b64receipt:i,receiptData:r})}})},x=function(){var t=E.getProducts(),n=0;if(t&&t.length>0)for(n=0;n<t.length;++n)e.saveState.save(t[n].productId+"Price",t[n].localizedPrice)},E={init:function(t){var n=t.productIds||[];if(l=t.bundleId||l,u.apple=t.appleKey||u.apple,u.google=t.googleKey||u.google,window.Cocoon&&window.Cocoon.InApp){if(!window.Cocoon.InApp.canPurchase())return console.log("Warning: Store not available"),E;l&&(c.isNativeIos()&&u.apple||c.isNativeAndroid()&&u.google)&&w(),window.Cocoon.InApp.on("purchase",{start:function(e){console.log("Product purchase started: "+e)},complete:function(t){var n=v(t.productId),i=e.saveState.load("purchasesCount",0),r=e.saveState.load("purchaseHistory",[]),a=e.saveState.load("unresolvedPurchases",[]),s=e.saveState.load("resolvedPurchases",[]);i+=1,e.saveState.save("purchasesCount",i),console.log("Product purchase completed: "),console.log(JSON.stringify(arguments));var l=!1;if(c.forEach(s,function(e,n,i,r){e.productId===t.productId&&e.transactionId===t.transactionId&&(l=!0,r())}),l&&t.productId.indexOf("vip")<0)return o.fire("purchase_error",""),void o.fire("Analytics",{category:"IAP",action:"duplicateResolve"});t.product=n,t.lastReceipt=d,t.productId.indexOf("vip")<0&&(a.push(t),r.push(t),e.saveState.save("purchaseHistory",r),e.saveState.save("unresolvedPurchases",a)),o.fire("purchase_success",t)},error:function(e,t){console.log("Product purchase failed: "+JSON.stringify(t)),c.isNativeIos()||c.isNativeAndroid()?o.fire("purchase_error",t.message):o.fire("purchase_error","Only available in the app version!")}}),p=n,window.Cocoon.InApp.initialize({autofinish:!0},y)}else console.log("InApp plugin not available")},revalidate:function(e,t){var n="";if(c.isNativeIos())n="apple";else{if(!c.isNativeAndroid())return void c.log("No validation available for this device");n="google"}var i={receipt:e,key:u[n]},r=new window.XMLHttpRequest;r.open("POST","https://xbsl2jkdvg.execute-api.us-east-1.amazonaws.com/latest/"+n),r.setRequestHeader("Content-Type","application/json;charset=UTF-8"),r.send(JSON.stringify(i)),r.onreadystatechange=function(){var e=function(e){"SUCCESS"===e.status?t(null,e.result):t("Server error")};if(4===r.readyState)if(r.status>=200&&r.status<300)try{console.log("Revalidation received"),e(JSON.parse(r.responseText))}catch(e){t("Could not parse result")}else t("Invalid response")}},setCallback:function(e,t){m[e]=t},purchase:function(e){return!!f&&(window.Cocoon.InApp.purchase(e,1,function(e){e&&console.log(e)}),!0)},purchaseSubscription:function(e){return!!f&&(window.Cocoon.InApp.purchaseSubscription(e,function(e){e&&console.log(e)}),!0)},restore:function(){return f?(window.Cocoon.InApp.restorePurchases(function(e){if(e)return console.log("error restore purchases"),console.log(JSON.stringify(e)),void o.fire("restore_error",e.message);o.fire("restore_success")}),!0):(console.log("Cannot restore"),o.fire("restore_error","Store not loaded."),!1)},getProducts:function(){return f?window.Cocoon.InApp.getProducts():null},getCachedProducts:function(){return g},isLoaded:function(){return f},canPurchase:function(){return window.Cocoon.InApp.canPurchase()},consume:function(e,t){window.Cocoon.InApp.consume(e.productId,1,t)},resolvePurchase:function(t){var n=e.saveState.load("unresolvedPurchases",[]),i=e.saveState.load("resolvedPurchases",[]);c.forEach(n,function(e,r,o,a){e.productId===t.productId&&e.transactionId===t.transactionId&&(n.splice(r,1),i.push(e),a())}),e.saveState.save("unresolvedPurchases",n),e.saveState.save("resolvedPurchases",i)},resolveAllPurchases:function(){var t=e.saveState.load("unresolvedPurchases",[]),n=e.saveState.load("resolvedPurchases",[]);n=n.concat(t),e.saveState.save("unresolvedPurchases",[]),e.saveState.save("resolvedPurchases",n)}};return E}),bento.define("modules/taptic",["bento","bento/utils","modules/savemanager"],function(e,t,n){"use strict";var i=function(){},r=!0,o={enable:function(e){r=e},unofficial:{weakBoom:i,strongBoom:i,burst:i},notification:i,selection:i,impact:i,gestureSelectionStart:i,gestureSelectionChanged:i,gestureSelectionEnd:i,initUnofficial:i},a=function(t){return function(){e.saveState.load("muteHaptics",!1)||r&&t.apply(window.TapticEngine,arguments)}};return!window.TapticEngine||t.isNativeAndroid()?(console.log("WARNING: cordova plugin for TapticEngine not found."),o):(console.log("Init taptic engine"),o.initUnofficial=function(){console.log("TapticEngine: Swap official with unoficial API"),window.TapticEngine.selection=window.TapticEngine.unofficial.weakBoom,window.TapticEngine.notification=window.TapticEngine.unofficial.burst,window.TapticEngine.impact=function(t){e.saveState.load("muteHaptics",!1)||t&&("heavy"===t.style&&window.TapticEngine.unofficial.strongBoom(),"medium"===t.style&&window.TapticEngine.unofficial.strongBoom(),"light"===t.style&&window.TapticEngine.unofficial.weakBoom())}},o.notification=a(window.TapticEngine.notification),o.selection=a(window.TapticEngine.selection),o.impact=a(window.TapticEngine.impact),o.gestureSelectionStart=a(window.TapticEngine.gestureSelectionStart),o.gestureSelectionChanged=a(window.TapticEngine.gestureSelectionChanged),o.gestureSelectionEnd=a(window.TapticEngine.gestureSelectionEnd),o)}),bento.define("modules/tenjin",["bento","bento/math/vector2","bento/math/rectangle","bento/entity","bento/eventsystem","bento/utils","bento/tween"],function(e,t,n,i,r,o,a){"use strict";var s,c=function(){},l={active:!0,transaction:c,androidTransaction:c,iosTransaction:c,sendEvent:c,sendEventAndValue:c,disable:c,enable:c,init:function(e){(e.onComplete||function(){})("Tenjin plugin not available")}};return window.tenjin?(s=window.cordova.require("cordova/exec"),l.iosTransaction=function(e,t,n,i,r,o,a,c){l.active&&s(function(){console.log("Tenjin iOS transaction success"),a&&a()},function(){console.log("Tenjin iOS transaction failed"),c&&c()},"Tenjin","iosTransaction",[e,t,n,i,r,o])},l.androidTransaction=function(e,t,n,i,r,o,a,c){l.active&&s(function(){console.log("Tenjin android transaction success"),a&&a()},function(){console.log("Tenjin android transaction failed"),c&&c()},"Tenjin","androidTransaction",[e,t,n,i,r,o])},l.sendEvent=function(e){l.active&&s(function(){console.log("Tenjin Sent: "+e)},function(){},"Tenjin","sendEvent",[""+e])},l.sendEventAndValue=function(e,t){l.active&&("undefined"===e&&(console.log('WARNING: "eventName" is required'),e="undefined"),"number"!=typeof t&&(console.log('WARNING: expecting "integerValue" to be an integer'),t=parseInt(t)),s(function(){console.log("Tenjin Sent: "+e+" :: "+t)},function(){},"Tenjin","sendEventAndValue",[""+e,t]))},l.enable=function(){l.active=!0},l.disable=function(){l.active=!1},l.init=function(e){var t=e.apiKey,n=o.getDefault(e.optIn,!0),i=e.onComplete||function(){},r="init",a=function(){i("Tenjin initialization failed at "+r)},c=function(){r="connect",s(function(){i()},a,"Tenjin","connect",[])};s(function(){n?(r="optIn",s(c,a,"Tenjin","optIn",[])):(r="optOut",s(c,a,"Tenjin","optOut",[]))},a,"Tenjin","init",[t])},window.tenjin&&(l.setBannerAdListener=window.tenjin.setBannerAdListener)):o.log("WARNING: Tenjin plugin does not exist."),l}),bento.define("modules/tenjinserverpurchase",["bento","bento/eventsystem","bento/utils","modules/store"],function(e,t,n,i){"use strict";var r,o=[],a={init:function(e){r=e.eventName,t.on(r,s),o=e.productIds||o},send:function(e,t){var n=new window.XMLHttpRequest;n.open("POST","https://ml371twv56.execute-api.us-east-1.amazonaws.com/latest/tenjin"),n.setRequestHeader("Content-Type","application/json;charset=UTF-8"),n.onreadystatechange=function(){4===n.readyState&&(n.status>=200&&n.status<300?t&&t(null):t&&t("ERROR: bad server response. "+n.responseText))},n.send(JSON.stringify(e))},getIdfa:function(t){var n=e.saveState.load("idfa",null);n?t(n):window.SystemData?window.SystemData.advertising_id&&window.SystemData.advertising_id(function(n){n?(e.saveState.save("idfa",n),t(n)):t(null)},function(){t(null)}):window.plugins&&window.plugins.AppleAdvertising?window.plugins.AppleAdvertising.getIdentifiers(function(n){if(n.trackingEnabled){var i=n.idfa;e.saveState.save("idfa",i),t(i)}else t(null)},function(){console.log("error loading identifiers"),t(null)}):t(null)}},s=function(t){var i={},r=t.receiptData||{},s=(t.serverResponse||{}).purchaseData||{},l=s.receipt||{},u=c(t.productId),h=window.device.platform.toLowerCase(),d=s.purchaseToken||null;if(!(o.indexOf(t.productId)<0)){var p=e.saveState.load("validatedReceipts",{});if(p[t.productId]=t.b64receipt,e.saveState.save("validatedReceipts",p),console.log("Validation of subscription detected - "+t.productId),!0===e.saveState.load("sentSubscriptionToServer",!1)){if("ios"===h)return;if(e.saveState.load("subscriptionPurchaseToken",null)===d)return}e.saveState.save("subscriptionPurchaseTimeStamp",Date.now()),t.validated&&t.serverResponse&&window.device?a.getIdfa(function(t){var o="0";t||(o="1"),i.limit_ad_tracking=o,"ios"===h&&(i.developer_device_id=window.device.uuid),i.advertising_id=t,i.platform=h,"ios"===h?(console.log("platform is iOS"),i.bundle_id=l.bid,i.product_id=l.product_id,i.transaction_id=l.transaction_id,i.original_transaction_id=l.original_transaction_id):(console.log("platform is Android"),i.bundle_id=s.packageName,i.product_id=s.productId,i.original_transaction_id=s.purchaseToken,i.receipt=r.signedData,i.signature=r.signature),i.price=u.price,i.currency=u.currency,i.quantity=1,function(e,t,i){var r=0;window.SystemData?n.forEach(t,function(t,n,o,a){var s=function(n){void 0!==n&&(e[t]=n),(r+=1)>=o&&i&&(i(),i=null)};window.SystemData[t]&&window.SystemData[t](s,s)}):(n.log("Missing SystemData plugin."),i())}(i,["os_version","app_version","country","os_version_release","build_id","locale","device_model"],function(){a.send(i,function(t){t?n.log("Error sending subs event: "+t):(console.log("Sent subscription event"),e.saveState.save("originalTransactionId",i.original_transaction_id))})})}):console.log("Validation failed")}},c=function(e){var t,n=0,r=i.getCachedProducts();for(n=0;n<r.length;++n)if((t=r[n])&&t.productId===e)return t;return t};return a}),bento.define("modules/threejs",["bento","bento/entity","bento/eventsystem","bento/utils","bento/components/sprite"],function(e,t,n,i,r){"use strict";var o,a,s,c,l,u,h,d,p,f=THREE.WebGLRenderer,m=e.getRenderer().getPixiRenderer(),g=e.getRenderer().getContext(),v={initialize:function(i){if(v.entity)return h&&(h.dispose(),h=null),l&&(l.dispose(),l=null),o=new THREE.Color(i.fogColor||15790335),a=i.fog||0,s=i.backgroundColor,c=i.backgroundTexture,u=i.skyBox,d=i.threeToPx,p=i.pxToThree,d?(v.threeToPx=d,v.pxToThree=1/d):p&&(v.pxToThree=p,v.threeToPx=1/p),a&&(v.scene.fog=new THREE.FogExp2(o,a)),u?y(v.scene,u):c?b(v.scene,c):s&&w(v.scene,s),v.entity;var r,x,E;o=new THREE.Color(i.fogColor||15790335),a=i.fog||0,s=i.backgroundColor,c=i.backgroundTexture,u=i.skyBox,d=i.threeToPx,p=i.pxToThree,THREE.currentRenderer?(r=THREE.currentRenderer,e.objects.get("threeJs",function(t){e.objects.remove(t)})):(r=new f({context:g,antialias:!1,powerPreference:"default",precision:"highp"}),THREE.currentRenderer=r);var S=e.getViewport(),_=!1,T=function(){_=!_},M=new Object({name:"behavior",start:function(e){v.entity=C,v.bento=!0,n.on("preDraw",this.preDraw),n.on("buttonDown-f1",T)},destroy:function(e){n.off("preDraw",this.preDraw),n.off("buttonDown-f1",T),h&&h.dispose(),l&&l.dispose()},update:function(e){_&&(console.log("THREE Info:\nMemory: "+JSON.stringify(r.info.memory)+"\nObjects: "+x.children.length),_=!1)},preDraw:function(e){r.state.reset(),r.render(x,E),g.disableVertexAttribArray(3),g.blendFunc(g.ONE,g.ONE_MINUS_SRC_ALPHA),g.disable(g.SCISSOR_TEST),g.disable(g.CULL_FACE),g.disable(g.DEPTH_TEST),g.enable(g.BLEND),g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,!1),m.shaderManager._currentId=-1,m.shaderManager.setShader(m.shaderManager.complexPrimitiveShader),g.viewport(0,0,g.canvas.width,g.canvas.height)}}),C=new t({name:"threeJs",global:!0,components:[M]});return d?(v.threeToPx=d,v.pxToThree=1/d):p&&(v.pxToThree=p,v.threeToPx=1/p),x=new THREE.Scene,E=new THREE.PerspectiveCamera(S.height/320*45,S.width/S.height,.1,340),x.add(E),a&&(x.fog=new THREE.FogExp2(o,a)),u?y(x,u):c?b(x,c):s&&w(x,s),v.camera=E,v.scene=x,v.renderer=r,e.objects.attach(C),C},threeToPx:128};v.pxToThree=1/v.threeToPx,v.camera=null,v.scene=null,v.bento=!1,v.entity=null;var y=function(t,n){var i;h=new THREE.CubeTexture,u=n;for(var r=0;r<6;r++)i=e.assets.getImage(u[r]),h.images[r]=i.image;6===r&&(h.needsUpdate=!0,t.background=h)},b=function(t,n){c=n;var i=e.assets.getImage(c);l=new THREE.Texture(i.image),t.background=new THREE.Color(l)},w=function(e,t){s=t,e.background=new THREE.Color(s)};v.setBackground=function(e,t){i.isArray(e)&&6===e.length?y(t||v.scene,e):i.isString(e)?b(t||v.scene,e):i.isNumber(e)&&w(t||v.scene,e)};var x=new THREE.MeshBasicMaterial({color:16711935}),E={circle:THREE.CircleBufferGeometry,cube:THREE.BoxBufferGeometry,cone:THREE.ConeBufferGeometry,cylinder:THREE.CylinderBufferGeometry,plane:THREE.PlaneBufferGeometry,sphere:THREE.SphereBufferGeometry,torus:THREE.TorusBufferGeometry};v.Primitive=function(e){var t=new E[e.shape](...e.parameters),n=e.material||x,r=new THREE.Mesh(t,n);return{name:e.name||e.shape+"Component",disposeGeometry:i.getDefault(e.disposeGeometry,!0),disposeMaterial:i.getDefault(e.disposeMaterial,!0),mesh:r,start:function(t){r&&v.scene.add(r),e.start&&e.start.bind(this)(t)},destroy:function(t){r&&r.parent&&(v.scene.remove(r),this.disposeGeometry&&r.geometry.dispose(),this.disposeMaterial&&r.material.dispose()),e.destroy&&e.destroy.bind(this)(t)},update:e.update,attached:e.attached,extend:function(e){return i.extend(this,e),this}}},v.cleanObject3d=function(e){e.children.forEach(function(e){"Group"!==e.type?"Mesh"===e.type&&e.geometry.dispose():v.cleanObject3d(e)})},v.getMesh=function(t){if(t||e.assets.hasMesh(t))return e.assets.getMesh(t);t?console.log("Warning: mesh does not exist"):console.log("Warning: path is undefined")},v.Mesh=function(e){var t=v.getMesh(e.path);return{name:e.name||"meshComponent",dispose:i.getDefault(e.dispose,!0),mesh:t,start:function(n){t&&v.scene.add(t),e.start&&e.start.bind(this)(n)},destroy:function(n){t&&t.parent&&(v.scene.remove(t),this.dispose&&v.cleanObject3d(t)),e.destroy&&e.destroy.bind(this)(n)},update:e.update,attached:e.attached}},v.Mixer=function(e){var t,n=[],r={};return{name:"mixerComponent",speed:.016,mesh:e.mesh,start:function(n){this.mesh.animations&&(t=new THREE.AnimationMixer(this.mesh),this.processAnimations(),e.startAnimation&&this.hasAnimation(e.startAnimation)&&this.play(e.startAnimation))},update:function(e){t&&t.update(this.speed*e.speed)},processAnimations:function(){var e,t;i.forEach(this.mesh.animations,function(i,o){t=i.name.lastIndexOf("|")+1,(e=i.name.substring(t))&&(r[e]||(r[e]=[],n.push(e)),r[e].push(o))})},hasAnimation:function(e){return n.indexOf(e)>-1},getAnimations:function(){return[].concat(n)},play:function(e){var n,i,o;if(o=r[e])for(n=0;n<o.length;n++)i=this.mesh.animations[o[n]],t.clipAction(i).play()},stop:function(){t.stopAllAction()}}};var S=!1;return v.MultiScale=function(e){var t,n=e.mesh,r=[],o=new THREE.Vector3(1,1,1),a={name:"meshMultiScale",update:function(e){var s=t.mesh||n;s&&(s.scale.x=1,s.scale.y=1,s.scale.z=1,i.forEach(r,function(e){var t=a[e];s.scale.x*=t.x,s.scale.y*=t.y,s.scale.z*=t.z}),s.scale.x=s.scale.x||o.x,s.scale.y=s.scale.y||o.y,s.scale.z=s.scale.y||o.y,o.x=i.sign(s.scale.x)||1,o.y=i.sign(s.scale.y)||1,o.z=i.sign(s.scale.z)||1)},attached:function(n){t=n.entity,e.scales&&i.forEach(e.scales,function(e,t){a.addScale(t,e)})},addScale:function(e,t){a[e]?i.log("WARNING: scale "+e+" already exists"):(!t||0!==t.x&&0!==t.y&&0!==t.z||(t.x||(t.x=1),t.y||(t.y=1),t.z||(t.z=1),S||(i.log("WARNING: passing new Vector with 0 results in errors from Three, defaulting to 1"),S=!0)),a[e]=t||new THREE.Vector3(1,1,1),r.push(e))}};return a},v.ParticleSystem=function(t){var n,r=function(t){var n;if(t)return i.isArray(t)||(t=[t]),t.map(function(t){return(n=e.assets.getTexture(t)).flipY=!1,n})}(t.textures),o=i.getDefault(t.color,16777215),a=i.getDefault(t.size,10),s=i.getDefault(t.alpha,1),c=t.texture||0,l=function(e,t){var n={color:{value:new THREE.Color(16777215)}};return t&&(n.textures={value:t}),n}(0,r),u=t.amount||1,h=u,d=t.setStartPosition,p=t.setStartColor,f=t.setStartSize||function(){return a},m=t.setStartAlpha||function(){return s},g=t.setStartTexture||function(){return c},y=t.setStartVelocity,b=new Float32Array(3*u),w=new Float32Array(3*u),x=new Float32Array(u),E=new Float32Array(u),S=new Float32Array(u),_=[],T=new THREE.Vector3,M=new THREE.Vector3,C=new THREE.Color(o);for(n=0;n<u;n++)d&&d(T,n),T.toArray(b,3*n),p&&p(C,n),C.toArray(w,3*n),x[n]=f(n),E[n]=m(n),S[n]=g(n),y&&y(M,n),M.toArray(_,3*n);var A=new THREE.BufferGeometry;A.addAttribute("position",new THREE.BufferAttribute(b,3)),A.addAttribute("customColor",new THREE.BufferAttribute(w,3)),A.addAttribute("size",new THREE.BufferAttribute(x,1)),A.addAttribute("alpha",new THREE.BufferAttribute(E,1)),A.addAttribute("texIndex",new THREE.BufferAttribute(S,1));var R=new THREE.ShaderMaterial({uniforms:l,vertexShader:String("\nattribute float size;\nattribute float alpha;\nattribute float texIndex;\nattribute vec3 customColor;\nvarying float vAlpha;\nvarying float vTexIndex;\nvarying vec3 vColor;\nvoid main() {\n    vAlpha = alpha;\n    vTexIndex = texIndex;\n    vColor = customColor;\n    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n    gl_PointSize = size * ( 300.0 / -mvPosition.z );\n    gl_Position = projectionMatrix * mvPosition;\n}"),fragmentShader:String("\nuniform vec3 color;\nuniform sampler2D textures[5];\nvarying float vAlpha;\nvarying float vTexIndex;\nvarying vec3 vColor;\nvoid main() {\n    gl_FragColor = vec4( color * vColor, 1.0 );\n    int texIndex = int(vTexIndex + 0.5);\n    if (texIndex == 0) {\n        gl_FragColor = gl_FragColor * texture2D( textures[0], gl_PointCoord );\n    } else if (texIndex == 1) {\n        gl_FragColor = gl_FragColor * texture2D( textures[1], gl_PointCoord );\n    } else if (texIndex == 2) {\n        gl_FragColor = gl_FragColor * texture2D( textures[2], gl_PointCoord );\n    } else if (texIndex == 3) {\n        gl_FragColor = gl_FragColor * texture2D( textures[3], gl_PointCoord );\n    } else if (texIndex == 4) {\n        gl_FragColor = gl_FragColor * texture2D( textures[4], gl_PointCoord );\n    }\n    gl_FragColor.a = vAlpha * gl_FragColor.a;\n}"),blending:THREE.NormalBlending,depthWrite:!1,transparent:!0,alphaTest:.2}),P=new THREE.Points(A,R);return{name:"particleSystemPlus",particles:P,active:!0,addVelocitiesAutomatically:!0,start:function(e){v.scene.add(P),t.start&&t.start.bind(this)(e)},destroy:function(e){t.destroy&&t.destroy.bind(this)(e),A.dispose(),R.dispose(),v.scene.remove(P)},update:function(e){var i={speed:e.speed,amount:h,attributes:A.attributes,velocities:_,positionDirty:!1,colorDirty:!1,sizeDirty:!1,alphaDirty:!1,texIndexDirty:!1,material:R};t.update&&t.update.bind(this)(i),this.addVelocitiesAutomatically?function(e){var t=A.attributes.position,i=3*h;for(n=0;n<i;n++)t.array[n]+=_[n]*e.speed;t.needsUpdate=!0}(e):A.attributes.position.needsUpdate=i.positionDirty,A.attributes.customColor.needsUpdate=i.colorDirty,A.attributes.size.needsUpdate=i.sizeDirty,A.attributes.alpha.needsUpdate=i.alphaDirty,A.attributes.texIndex.needsUpdate=i.texIndexDirty},attached:t.attached,get activeParticles(){return h},set activeParticles(e){e!==h&&(e>u&&(e=u),P.geometry.setDrawRange(0,e),h=e)}}},v.ThreeSprite=function(t){var n=t.texture?t.texture:e.assets.getTexture(t.image),r=new THREE.SpriteMaterial({map:n,color:16777215,alphaTest:.1}),o=new THREE.Sprite(r);return{name:t.name||"planeImage",dispose:i.getDefault(t.dispose,!0),sprite:o,start:function(e){o&&v.scene.add(o),t.start&&t.start.bind(this)(e)},destroy:function(e){o&&o.parent&&(v.scene.remove(o),this.dispose&&(o.geometry.dispose(),r.dispose())),t.destroy&&t.destroy.bind(this)(e)},update:function(e){t.update&&t.update.bind(this)(e)},attached:t.attached}},v.BentoSprite=function(e){if(!(this instanceof v.BentoSprite))return new v.BentoSprite(e);this.material=null,this.geometry=null,this.texture=null,this.plane=null,this.container=new THREE.Object3D,this.autoAttach=i.getDefault(e.autoAttach,!0),this.dispose=i.getDefault(e.dispose,!0),this.lastFrame=null,r.call(this,e),this.name=e.name||"planeSprite"},v.BentoSprite.prototype=Object.create(r.prototype),v.BentoSprite.prototype.constructor=v.BentoSprite,v.BentoSprite.prototype.start=function(e){this.autoAttach&&v.scene.add(this.container)},v.BentoSprite.prototype.destroy=function(e){this.autoAttach&&v.scene.remove(this.container),this.dispose()},v.BentoSprite.dispose=function(){this.dispose&&this.plane&&(this.plane.geometry.dispose(),this.plane.material.dispose())},v.BentoSprite.prototype.setup=function(e){var t,n,i;r.prototype.setup.call(this,e),(t=this.spriteImage)?((n=t.threeTexture)||((n=new THREE.Texture(t.image)).needsUpdate=!0,n.magFilter=THREE.NearestFilter,n.minFilter=THREE.NearestFilter,t.threeTexture=n),this.texture=n):this.texture=null,this.texture?(this.material=new THREE.MeshBasicMaterial({map:this.texture,color:16777215,alphaTest:1,transparent:!0}),this.geometry=new THREE.PlaneGeometry(this.frameWidth*v.pxToThree,this.frameHeight*v.pxToThree,1,1),this.plane&&(this.dispose(),this.container.remove(this.plane),this.plane=null),i=new THREE.Mesh(this.geometry,this.material),this.plane=i,this.container.rotation.x=-Math.PI/2,this.lastFrame=this.currentFrame,this.updateFrame(),this.updateUvs(),this.container.add(i),i.position.x=(this.frameWidth-this.origin.x-this.frameWidth/2)*v.pxToThree,i.position.y=(this.origin.y-this.frameHeight/2)*v.pxToThree):this.plane&&(this.container.remove(this.plane),this.plane=null)},v.BentoSprite.prototype.update=function(e){r.prototype.update.call(this,e),this.lastFrame!==this.currentFrame&&(this.updateFrame(),this.updateUvs()),this.lastFrame=this.currentFrame},v.BentoSprite.prototype.draw=function(e){},v.BentoSprite.prototype.updateUvs=function(){var e,t=this.sourceX,n=this.sourceY,i=this.spriteImage,r=i.image,o=r.width,a=r.height,s=(t+i.x)/o,c=1-(n+i.y)/a,l=this.frameWidth/o,u=this.frameHeight/a;this.geometry&&this.plane&&((e=this.geometry.faceVertexUvs[0])[0][0].set(s,c),e[0][1].set(s,c-u),e[0][2].set(s+l,c),e[1][0].set(s,c-u),e[1][1].set(s+l,c-u),e[1][2].set(s+l,c),this.geometry.uvsNeedUpdate=!0)},v.BentoSprite.prototype.attached=function(e){r.prototype.attached.call(this,e),this.container.name=this.parent.name+"."+this.name,this.plane&&(this.plane.name=this.container.name+".plane")},v}),bento.define("modules/watchad",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/eventsystem","bento/gui/clickbutton","bento/gui/counter","bento/gui/text","bento/utils","bento/tween","gui/general/dialog","modules/localization","modules/savemanager","modules/mopub"],function(e,t,n,i,r,o,a,s,c,l,u,h,d,p,f,m){"use strict";var g=function(e){return!0},v=function(e){console.log("show rewarded"),yadv_showReward({onOpen:()=>{console.log("Video ad open.")},onRewarded:()=>{console.log("Rewarded!"),e.onReward()},onClose:()=>{console.log("Video ad closed.")},onError:e=>{console.log("Error while open video ad:",e)}})},y=function(e){},b=function(e){a.fire("Tenjin",{action:e}),a.fire("FirebaseAnalytics-logEvent",{name:e})};return{showInterstitial:function(t){setTimeout(function(){yadv_showInsert({onClose:function(){},onError:function(){}})},1);var n=t.onComplete||function(){},i=(t.onReward,y),r=e.saveState.load("totalInterstitial",0);switch(e.saveState.save("totalInterstitial",++r),r){case 10:b("10IS_watched");break;case 15:b("15IS_watched");break;case 20:b("20IS_watched");break;case 50:b("50IS_watched");break;case 100:b("100IS_watched")}a.fire("Tenjin",{action:"interstitial_view"}),a.fire("GameAnalytics-addDesignEvent",{eventId:"Ads:interstitialView"}),a.fire("FirebaseAnalytics-logEvent",{name:"interstitialView"}),i({onComplete:function(){n&&n()},onFail:function(){console.log("fail interstitial")}})},showRewarded:function(t,n){var i=t.onComplete||function(){},r=t.onReward||function(){},o=(t.z,n?y:v);if(n){var s=e.saveState.load("totalInterstitial",0);switch(e.saveState.save("totalInterstitial",++s),s){case 10:b("10IS_watched");break;case 15:b("15IS_watched");break;case 20:b("20IS_watched");break;case 50:b("50IS_watched");break;case 100:b("100IS_watched")}a.fire("Tenjin",{action:"interstitial_view"}),a.fire("GameAnalytics-addDesignEvent",{eventId:"Ads:interstitialView"}),a.fire("FirebaseAnalytics-logEvent",{name:"interstitialView"})}o({onComplete:function(){if(!n){a.fire("Tenjin",{action:"video_view"}),a.fire("GameAnalytics-addDesignEvent",{eventId:"Ads:rewardedView"}),a.fire("FirebaseAnalytics-logEvent",{name:"rewardedView"});var t=Date.now(),r=Math.floor(t/1e3/60/60/24);r=Math.max(0,r-e.saveState.load("bootupDay",r));var o=e.saveState.load("totalRewarded",0);switch(e.saveState.save("totalRewarded",++o),o){case 5:b("5RV_watched"),r<2&&b("5RV_day"+(r+1));break;case 10:b("10RV_watched"),r<2&&b("10RV_day"+(r+1));break;case 15:b("15RV_watched"),r<1&&b("15RV_day1");break;case 20:b("20RV_watched");break;case 50:b("50RV_watched");break;case 100:b("100RV_watched")}}i&&i()},onReward:function(){r()},tag:t.tag,muteAudio:!0})},canShowRewarded:g}}),bento.define("debug/html/accordion",["bento","bento/utils","debug/html"],function(e,t,n){"use strict";var i=0;return function(e){var t=!1,r=i++,o=e.description,a=e.showTrash||e.canRemove,s=n.make("div","card-content","accordion-"+r,{style:{display:"none"}}),c=function(){t=!t,s.style.display=t?"block":"none",l.className=t?"fa fa-angle-down":"fa fa-angle-right"},l=n.make("i",t?"fa fa-angle-down":"fa fa-angle-right","",{}),u=n.make("a","","",{href:"#accordion-"+r}).append(n.make("span","icon is-small").append(l)),h=n.make("a","is-pulled-right is-relative","",{onclick:function(){n.remove(g)}}).append(n.make("i","fas fa-trash","",{})),d=n.make("span","",null,{style:"margin-left: 4px",innerHtml:e.title}),p=n.make("p","card-footer-item","",{innerHtml:o,style:"align-items: flex-start; justify-content: flex-start; padding: 0px 0px 0px 32px;"}),f=n.make("footer","card-footer","",{style:"border-top: none; font-size: 12px; justify-content: normal;"}).append(p),m=n.make("header","card-header-title",null,{style:"display: block;",onclick:c}).append([u,d]),g=n.make("div","card",null,{}).append([m,s]);return o&&g.append(f),e.isToggled&&c(),a&&m.append(h),new Object({container:g,body:s,title:d,append:function(e){return s.append(e),this},attach:function(e){return s.attach(e),this},addDescription:function(e){o||g.append(f),o=e,p.innerHTML=e}})}}),bento.define("debug/tests/example",["bento","bento/utils"],function(e,t){"use strict";return function(e){return[{name:"Plugin exists",run:function(e,t,n){window.examplePlugin?t("PASS"):n("FAIL: missing global variable window.examplePlugin")}}]}}),bento.define("debug/tests/facebook",["bento","bento/utils"],function(e,t){"use strict";return function(e){return[{name:"Plugin exists",run:function(e,t,n){window.facebookConnectPlugin?t("PASS"):n("FAIL: missing global variable window.facebookConnectPlugin")}},{name:"Login status",run:function(e,t,n){window.facebookConnectPlugin?window.facebookConnectPlugin.getLoginStatus(function(e){t("PASS: "+JSON.stringify(e))},function(){n("FAIL: error callback from facebookConnectPlugin.getLoginStatus")}):n("FAIL: missing global variable window.facebookConnectPlugin")}}]}}),bento.define("debug/tests/gameanalytics",["bento","bento/utils","modules/gameanalytics"],function(e,t,n){"use strict";return function(e){return[{name:"Plugin exists",run:function(e,t,n){window.GameAnalytics?t("PASS"):n("FAIL: missing global variable window.GameAnalytics")}}]}}),bento.define("debug/tests/iap",["bento","bento/utils","modules/store","debug/html","gui/general/iapoverlay"],function(e,t,n,i,r){"use strict";return function(e){return[{name:"Plugin exists",run:function(e,t,n){window.Cocoon&&window.Cocoon.InApp?t("PASS"):n("FAIL: missing global variable window.Cocoon.InApp")}},{name:"Can purchase",run:function(e,t,n){window.Cocoon&&window.Cocoon.InApp?window.Cocoon.InApp.canPurchase()?t("PASS"):n("FAIL: window.Cocoon.InApp.canPurchase() returns false"):n("FAIL: missing global variable window.Cocoon.InApp")}},{name:"Get products",run:function(e,r,o){if(!window.Cocoon||!window.Cocoon.InApp)return o("FAIL: missing global variable window.Cocoon.InApp"),void a.removeSelf();var a=i('<p>Waiting for store...<i class="fas fa-circle-notch fa-spin"></i></p>'),s=10,c=function(){var e=n.getCachedProducts(),i=[];t.forEach(e,function(e){i.push(e.productId)}),e.length?r("PASS: loaded "+i.join(", ")):o("FAIL: 0 products retrieved (assuming there are IAP products)"),a.removeSelf()},l=function(){window.setTimeout(function(){0!==s||n.isLoaded()?s>0&&!n.isLoaded()?(s-=1,a.innerHtml="Waiting for store... "+s+' <i class="fas fa-circle-notch fa-spin"></i></p>',l()):c():(o("FAIL: Store loading timed out"),a.removeSelf())},1e3)};n.isLoaded()?c():l(),e.append(a)}},{name:"Make purchase",run:function(t,n,o){if(e.testProduct){var a=!1,s=i("<p>Product to buy: "+e.testProduct+"</p>"),c=i('<a class="level button is-primary">Purchase</a>',{onclick:function(){a||(a=!0,
c.innerHtml='<i class="fas fa-circle-notch fa-spin"></i>',r.purchase({id:e.testProduct,isConsumable:!0,resolveAutomatically:!0,onPurchaseComplete:function(t,i,r){t&&i===e.testProduct?n("PASS (note: in-game logic not tested)"):o("FAIL: purchase was not successful"),c.removeSelf(),s.removeSelf()}}))}});t.attach(s),t.attach(c)}else o("FAIL: IAP test not properly initialized")}}]}}),bento.define("debug/tests/ironsrc",["bento","bento/utils","modules/ironsource","debug/html"],function(e,t,n,i){"use strict";return function(e){return[{name:"Plugin exists",run:function(e,t,n){window.plugins&&window.plugins.ironsource?t("PASS"):n("FAIL: Missing global variable window.plugins.ironsource")}},{name:"Can view a rewarded ad",run:function(e,t,r){var o=i('<a class="level button is-primary">Loading video...<i class="fas fa-circle-notch fa-spin"></i></a>',{onclick:function(){a?n.showRewarded(function(){t("PASS: video watched"),o.removeSelf()},function(e){r("FAIL: could not watch video "+e),o.removeSelf()}):window.alert("No video has been loaded (yet).")}}),a=!1,s=function(){n.canShowRewarded()?(a=!0,o.innerHtml="Watch video"):window.setTimeout(s,1e3)};e.append(o),s()}},{name:"Can view an interstitial ad",run:function(e,t,r){var o=i('<a class="level button is-primary">Loading video...<i class="fas fa-circle-notch fa-spin"></i></a>',{onclick:function(){a?n.showInterstitial(function(){t("PASS: video watched"),o.removeSelf()},function(e){r("FAIL: could not watch video "+e),o.removeSelf()}):window.alert("No video has been loaded (yet).")}}),a=!1,s=function(){n.canShowInterstitial(function(){a=!0,o.innerHtml="Watch video"},function(e){window.setTimeout(s,1e3)})};e.append(o),s()}}]}}),bento.define("debug/tests/mopub",["bento","bento/utils","modules/mopub","debug/html"],function(e,t,n,i){"use strict";return function(e){return[{name:"Plugin exists",run:function(e,t,n){window.cordova&&window.cordova.plugins&&window.cordova.plugins.MoPub?t("PASS"):n("FAIL: Missing global variable cordova.plugins.MoPub")}},{name:"Can view a rewarded ad",run:function(e,t,r){var o=i('<a class="level button is-primary">Loading video...<i class="fas fa-circle-notch fa-spin"></i></a>',{onclick:function(){a?n.showRewarded({tag:"debug",muteAudio:!0,onComplete:function(e){var n;if(e){try{n=JSON.stringify(e)}catch(e){console.log(e),n=""}return r("FAIL: could not watch video "+n),void o.removeSelf()}t("PASS: video watched"),o.removeSelf()},onReward:function(){console.log("Reward callback")}}):window.alert("No video has been loaded (yet).")}}),a=!1,s=function(){n.canShowRewarded()?(a=!0,o.innerHtml="Watch video"):window.setTimeout(s,1e3)};e.append(o),s()}},{name:"Can view an interstitial ad",run:function(e,t,r){var o=i('<a class="level button is-primary">Loading video...<i class="fas fa-circle-notch fa-spin"></i></a>',{onclick:function(){a?n.showInterstitial({tag:"debug",muteAudio:!0,onComplete:function(e){if(e)return r("FAIL: could not watch video "+e),void o.removeSelf();t("PASS: video watched"),o.removeSelf()}}):window.alert("No video has been loaded (yet).")}}),a=!1,s=function(){n.canShowInterstitial()?(a=!0,o.innerHtml="Watch video"):window.setTimeout(s,1e3)};e.append(o),s()}},{name:"Can view an banner",run:function(e,t,r){var o=i('<a class="level button is-primary">Loading banner...<i class="fas fa-circle-notch fa-spin"></i></a>',{onclick:function(){a?n.isBannerVisible()?(n.hideBanner(function(){t("PASS: Banner Hidden!")}),o.innerHtml="Show banner"):(n.showBanner(function(){t("PASS: Banner showed!")}),o.innerHtml="Hide banner"):window.alert("Banner view has not been loaded (yet).")}}),a=!1,s=function(){n.canShowBanner()?(a=!0,n.isBannerVisible()?o.innerHtml="Hide banner":o.innerHtml="Show banner"):window.setTimeout(s,1e3)};e.append(o),s()}}]}}),bento.define("debug/tests/systemdata",["bento","bento/utils"],function(e,t){"use strict";return function(e){return[{name:"Plugin exists",run:function(e,t,n){window.SystemData?t("PASS"):n("FAIL: missing global variable window.SystemData")}},{name:"Get IDFA",run:function(e,t,n){window.SystemData?window.SystemData.advertising_id?window.SystemData.advertising_id(function(e){e?t("PASS: "+e):n("FAIL: limited ad tracking (?)")},function(){n("FAIL: plugin faulty or limited ad tracking")}):n("FAIL: missing global variable window.SystemData.advertising_id"):n("FAIL: missing global variable window.SystemData")}}]}}),bento.define("debug/tests/tenjin",["bento","bento/utils","modules/tenjin","debug/html"],function(e,t,n,i){"use strict";return function(e){return[{name:"Plugin exists",run:function(e,t,n){window.tenjin?t("PASS"):n("FAIL: missing global variable window.tenjin")}},{name:"Send debug event",run:function(e,t,r){var o=Date.now(),a=i('<p>Sent event...<i class="fas fa-circle-notch fa-spin"></i></p>'),s=i('<a class="level button is-primary">Check event</a>',{onclick:function(){a.innerHtml='Checking...<i class="fas fa-circle-notch fa-spin"></i>',s.removeSelf(),c.removeSelf(),l(5e3)}}),c=i("p",{style:"color: red;",innerHtml:"FAIL"}),l=function(n){e.attach(a),window.setTimeout(function(){var n,i;n=function(t){c.innerHtml=t+"<br>",e.attach(c),e.attach(s)},(i=new window.XMLHttpRequest).open("GET","https://wjp7krc4ml.execute-api.us-east-1.amazonaws.com/latest/get-record?value="+o),i.onreadystatechange=function(){if(4===i.readyState){if(i.status>=200&&i.status<300)try{JSON.parse(i.responseText).Count?t("PASS: Custom event found"):n("FAIL: no records of custom event, try again. (Is the debug callback set up in Tenjin?)")}catch(e){n("FAIL: "+e)}else n("FAIL: "+i.responseText);a.removeSelf()}},i.ontimeout=function(e){r("FAIL: HTTP request timeout"),a.removeSelf()},i.send(),a.innerHtml='Checking callback...<i class="fas fa-circle-notch fa-spin"></i>'},n)};window.tenjin?(n.sendEventAndValue("debug",o),l(3e4)):r("FAIL: missing global variable window.tenjin")}}]}}),bento.define("debug/tests/toutiao",["bento","bento/utils","debug/html","modules/toutiao"],function(e,t,n,i){"use strict";return function(e){return[{name:"Plugin exists",run:function(e,t,n){window.cordova&&window.cordova.plugins&&window.cordova.plugins.toutiao?t("PASS"):n("FAIL: Missing global variable window.plugins.toutiao")}},{name:"Can view a rewarded video ad",run:function(e,t,r){var o=n('<a class="level button is-primary">Loading video...<i class="fas fa-circle-notch fa-spin"></i></a>',{onclick:function(){a?i.showRewarded(function(){t("PASS: video watched"),o.removeSelf()},function(e){r("FAIL: could not watch video "+e),o.removeSelf()}):window.alert("No video has been loaded (yet).")}}),a=!1,s=function(){i.canShowRewarded()?(a=!0,o.innerHtml="Watch video"):window.setTimeout(s,1e3)};e.append(o),s()}},{name:"Can view an fullscreen video ad",run:function(e,t,r){var o=n('<a class="level button is-primary">Loading video...<i class="fas fa-circle-notch fa-spin"></i></a>',{onclick:function(){a?i.showFullScreenVideo(function(){t("PASS: video watched"),o.removeSelf()},function(e){r("FAIL: could not watch video "+e),o.removeSelf()}):window.alert("No video has been loaded (yet).")}}),a=!1,s=function(){i.canShowFullScreenVideo(function(){a=!0,o.innerHtml="Watch video"},function(e){window.setTimeout(s,1e3)})};e.append(o),s()}}]}}),bento.define("entities/effects/confettiburst",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/eventsystem","bento/gui/clickbutton","bento/gui/counter","bento/gui/text","bento/utils","bento/tween","globals"],function(e,t,n,i,r,o,a,s,c,l,u,h,d){"use strict";return function(n){var r=n.position||new t(0,0),a=n.velocity||new t(0,0),s=n.friction||1,c=n.gravity||.05,l=n.life||u.getRandomRangeFloat(50,80),d=new t(n.particleScale||1,n.particleScale||1),p=!1,f=u.getRandomRangeFloat(-.1,.1),m=new o({z:n.z||0,name:"confetti",position:r.clone(),scale:d.clone(),float:n.float,updateWhenPaused:n.updateWhenPaused,components:[new i({imageName:n.imageName||"confetti",originRelative:new t(.5,.5),frameCountX:3,animations:{default:{speed:0,frames:[u.getRandom(3)]}}})]}).attach({name:"confettiBehaviour",speedX:0,speedY:n.speedY||1,rotationSpeed:u.getRandom(5),start:function(){m.timer=u.getRandomFloat(1e3)},update:function(e){m.rotation+=f,p||(l-=e.speed)<=0&&(p=!0,new h({from:d,to:new t(0,0),in:15,onUpdate:function(e,t){d=e},onComplete:function(){m.removeSelf()}})),a.y+=c*e.speed,m.position.addTo(a.scalarMultiply(e.speed)),a.scalarMultiplyWith(1-(1-s)*e.speed),m.scale.y=d.y,m.scale.x=Math.sin(m.timer/(this.rotationSpeed+5))*d.x}});return e.objects.attach(m),m}}),bento.define("entities/effects/confettistring",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/eventsystem","bento/gui/clickbutton","bento/gui/counter","bento/gui/text","bento/utils","bento/tween","globals","color","colorswapper"],function(e,t,n,i,r,o,a,s,c,l,u,h,d,p,f){"use strict";return function(n){var i=!1,r=[],a=[],s=function(e,t,n,i,r){var o=r.subtract(i),a=o.angle(),s=o.magnitude();e.translate(i.x,i.y),e.rotate(a),e.drawImage(t,0,0,8,8,0,-n/2,s,n),e.rotate(-a),e.translate(-i.x,-i.y)},c=n.position||new t(0,0),l=n.velocity||new t(0,0),d=n.friction||1,m=n.life||u.getRandomRangeFloat(50,70),g=m,v=n.radius||3,y=n.color||[new p(255,59,59),new p(255,224,111),new p(59,212,255)][u.getRandom(3)],b=u.getRandomRangeFloat(-.1,.1),w=new f(e.assets.getImage("pinkpixel"),[new p(255,0,255)],[y]),x={name:"behaviorComponent",update:function(e){for(i||(m-=e.speed)<=0&&(i=!0,new h({from:v,to:0,in:15,onUpdate:function(e,t){v=e},onComplete:function(){E.removeSelf()}}));E.timer>a[0]+30;)r.shift(),a.shift();for(0===r.length?(r.push(E.position.clone()),a.push(E.timer)):r[r.length-1].distance(E.position)<.1?(r[r.length-1]=E.position.clone(),a[a.length-1]=E.timer):(r.push(E.position.clone()),a.push(E.timer));a.length>30;)r.shift(),a.shift();E.position.addTo(l.scalarMultiply(e.speed)),l.scalarMultiplyWith(1-(1-d)*e.speed),l=l.rotateRadian(b*(m/g))},draw:function(e){var t=e.renderer;t.translate(-E.position.x,-E.position.y);for(var n=1;n<r.length;n++)s(t,w,Math.min(n/30*v,v),r[n-1].clone(),r[n].clone());t.translate(E.position.x,E.position.y)}},E=new o({z:n.z||0,name:"confettiString",family:["effects"],position:c.clone(),float:!1,updateWhenPaused:n.updateWhenPaused,components:[x]});return e.objects.attach(E),E}}),bento.define("entities/travelers/ramp",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/eventsystem","bento/gui/clickbutton","bento/gui/counter","bento/gui/text","bento/utils","bento/tween","modules/threejs","materials/curvematerial","globals","components/collisionhelper"],function(e,t,n,i,r,o,a,s,c,l,u,h,d,p,f,m){"use strict";var g=[e.assets.getTexture("booster/boosterpad_0"),e.assets.getTexture("booster/boosterpad_1"),e.assets.getTexture("booster/boosterpad_2")],v=new p({map:g[0],color:16777215,specular:0,emissive:3487029,emissiveIntensity:.8}),y=Math.PI,b=e.objects.getByFamily("enemies"),w=function(e,t,n,i,r){var o=t.collisionHelper,a=u.sign(e.mesh.position.x-t.mesh.position.x);t.velocity.x=0,o.impulse.x+=i.x*-a*.1/r.speed};return function(t){var n=e.assets.getTexture("cars/car00ramp"),i=v.clone(),r=new THREE.PlaneBufferGeometry(3.5,4.1,1,3),a=new THREE.Mesh(r,i),s=0,c=0,l=0,p=new h.TweenBehavior({from:0,to:1,in:80,delay:0,applyOnDelay:0,ease:"easeInOutQuad",decay:1,oscillations:1,onStart:function(){},onUpdate:function(e,t){E.mesh.position.x=l+(-5.7-l)*e},onComplete:function(){l=E.mesh.position.x,x.begin(),e.objects.attach(x)}}),x=new h.TweenBehavior({from:0,to:1,in:80,delay:0,applyOnDelay:0,ease:"easeInOutQuad",onStart:function(){},onUpdate:function(e,t){E.mesh.position.x=l+(5.7-l)*e},onComplete:function(){l=E.mesh.position.x,p.begin(),e.objects.attach(p)}}),E=new d.Mesh({path:"cars/car_ramp",start:function(t){var i=this.mesh.children[0].material.clone();i.map=n,i.emissiveMap=n,i.needsUpdate=!0,this.mesh.children[0].material=i,this.mesh.add(a),a.position.z=1.95,a.position.y=1.28,a.rotation.x=.286*-y,this.mesh.position.z=-300,T.collisionHelper=_,this.mesh.updateMatrixWorld(),_.prepare();var r,o,s=1/0;b.forEach(function(e){e&&e.mesh.position.z>E.mesh.position.z-30&&(r?(o=Math.abs(e.mesh.position.z-E.mesh.position.z))<s&&(r=e,s=o):(r=e,s=Math.abs(e.mesh.position.z-E.mesh.position.z)))}),s<28&&(this.mesh.position.z+=u.sign(this.mesh.position.z-r.mesh.position.z)*(30-s)),l=E.mesh.position.x,e.objects.attach(p)},update:function(t){(s+=t.speed)>3&&(s-=3,c+=1,c%=3,i.map=g[c],i.emissiveMap=g[c],i.map.needsUpdate=!0);var n=f.speed-(f.maxSpeed-.42);this.collidable||(n=.8),this.mesh.position.z+=n*t.speed;var r,o,a=1/0;this.mesh.position.z<0?b.forEach(function(e){e&&e.mesh.position.z>E.mesh.position.z&&(r?(o=e.mesh.position.z-E.mesh.position.z)<a&&(r=e,a=o):(r=e,a=e.mesh.position.z-E.mesh.position.z))}):this.mesh.position.z>40&&e.objects.remove(T),this.mesh.updateMatrixWorld(),_.prepare()},destroy:function(e){i.dispose()},attached:function(e){}}),S={};E.mesh.children.forEach(function(e){e.name&&(S[e.name]=e)});var _=new m({car:S.car,model:E.mesh,solveForces:w,impact:function(t,n){Math.abs(E.mesh.position.x-n.mesh.position.x)>this.width/2&&(p.isAdded?E.mesh.position.x-n.mesh.position.x>0&&(e.objects.remove(p),l=E.mesh.position.x,x.begin(),e.objects.attach(x)):x.isAdded&&E.mesh.position.x-n.mesh.position.x<0&&(e.objects.remove(x),l=E.mesh.position.x,p.begin(),e.objects.attach(p)))}}),T=new o({z:0,name:"ramp",family:["travelers"],position:t.position,updateWhenPaused:0,components:[E,_]}).extend({mesh:E.mesh,collidable:!0});return T}}),bento.define("gui/general/askrating",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/gui/clickbutton","bento/gui/counter","bento/gui/text","bento/eventsystem","bento/utils","bento/tween","modules/localization","gui/general/dialog","managers/textstyles","components/iconbutton"],function(e,t,n,i,r,o,a,s,c,l,u,h,d,p,f,m){"use strict";var g=function(n){var i,r=u.isNativeAndroid();if(!g.canAsk())return n.onComplete&&n.onComplete(),new o({});i=new p({z:n.z,name:"askRating",title:r?"":d.getText("rateUs"),text:d.getText("askLike").replace("{TITLE}",d.getText("title")),textStyle:"white8",height:170,bodyColor:"black",onComplete:function(){e.saveState.save("askedRatingVersion",window.VERSION),n.onComplete&&n.onComplete()}}),r||i.getComponent("windowContainer",function(e){e.removeByName("exitButton")});var a=new c({text:r?d.getText("rateUs"):d.getText("yesRatings"),position:new t(0,6),scale:new t(1/.144,1/.144),fontSettings:f.get("black14"),align:"center",maxWidth:50,linebreaks:!1,drawDebug:!1}),s=new m({name:"yesButton",position:new t(r?0:32,36),imageName:"gui/buttons/button_offlinex2",frameCountX:1,frameCountY:3,icon:a,offset:new t(0,0),offsetOnPressed:2,onClick:function(){consloe.log("--------------onClick-------------"),console.log("-----openurl  removed------")}});r||(s.scale.x=s.scale.y=.12);var l=new c({text:d.getText("noRatings"),position:new t(0,6),scale:new t(1/.144,1/.144),fontSettings:f.get("black14"),align:"center",maxWidth:50,linebreaks:!1,drawDebug:!1}),h=new m({name:"noButton",position:new t(-32,36),imageName:"gui/buttons/button_no",frameCountX:1,frameCountY:3,icon:l,offset:new t(0,0),offsetOnPressed:2,onClick:function(){console.log("-----openurl  removed------")}});return h.scale.x=h.scale.y=.12,i.content.getComponent("body",function(e){e.position.y=-18}),i.content.attach(s),r||i.content.attach(h),i},v=function(e){l.fire("GameAnalytics-addDesignEvent",{id:"Stats:RatingPopup:ratingShown"}),e?l.fire("GameAnalytics-addDesignEvent",{id:"Stats:RatingPopup:ratedUs"}):l.fire("GameAnalytics-addDesignEvent",{id:"Stats:RatingPopup:pressedNo"}),l.fire("FirebaseAnalytics-logEvent",{name:"ratingPopup",properties:{name:"ratingShown",action:e?"ratedUs":"pressedNo"}})};return g.canAsk=function(){return!1},g.askIos10=function(t){if(g.canAsk()){var n,i,r,o=[0,0,0];if(window.device&&(n=window.device.version,i=n.split("."),r=[],u.forEach(i,function(e){r.push(parseInt(e))}),o=r),e.saveState.save("askedRatingVersion",window.VERSION),1e4*o[0]+100*o[1]+o[0]>=100300)try{window.inappreview?(v(!0),window.inappreview.requestReview(function(){},function(){})):u.log("ERROR: inappreview plugin missing")}catch(e){u.log("ERROR: "+e)}}},g}),bento.define("gui/general/confetti",["bento","bento/utils","entities/effects/confettistring","entities/effects/confettiburst","globals","bento/math/vector2"],function(e,t,n,i,r,o){"use strict";return function(r){var a=e.getViewport();t.repeat(20,function(n,s){new i({z:r.z,float:!0,updateWhenPaused:e.objects.isPaused(),position:new o(t.getRandomRangeFloat(-8,8),2*a.height/3+t.getRandomRangeFloat(-4,4)),velocity:new o(t.getRandomRangeFloat(0,4),t.getRandomRangeFloat(-12,0)),friction:.95,particleScale:.04+t.getRandomFloat(.03)})}),t.repeat(10,function(i,s){new n({z:r.z,updateWhenPaused:e.objects.isPaused(),position:new o(t.getRandomRangeFloat(-8,8),2*a.height/3+t.getRandomRangeFloat(-4,4)),velocity:new o(t.getRandomRange(4,8),0).rotateDegree(t.getRandomRangeFloat(-90,-45)),friction:.95})}),t.repeat(10,function(n,s){new i({z:r.z,updateWhenPaused:e.objects.isPaused(),position:new o(a.width+t.getRandomRangeFloat(-8,8),2*a.height/3+t.getRandomRangeFloat(-4,4)),velocity:new o(t.getRandomRangeFloat(-4,0),t.getRandomRangeFloat(-12,0)),friction:.95,particleScale:.04+t.getRandomFloat(.03)})}),t.repeat(10,function(i,s){new n({z:r.z,updateWhenPaused:e.objects.isPaused(),position:new o(a.width+t.getRandomRangeFloat(-8,8),2*a.height/3+t.getRandomRangeFloat(-4,4)),velocity:new o(t.getRandomRange(-8,-4),0).rotateDegree(t.getRandomRangeFloat(45,90)),friction:.95})})}}),bento.define("gui/general/currencyicon",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/eventsystem","bento/gui/clickbutton","bento/gui/counter","bento/gui/text","bento/utils","bento/tween","components/hdsprite","managers/textstyles","managers/pricing"],function(e,t,n,i,r,o,a,s,c,l,u,h,d,p,f){"use strict";return function(e){var i=e.value||0,r=e.textStyle||"black18",a=e.iconSize||14,s=e.currencyIcon||"gui/level_completed/icon_coinblue",c=f.shorten(i),h=new l({text:c,fontSettings:p.get(r),maxWidth:64,linebreaks:!1,drawDebug:!1,lineWidth:e.lineWidth,strokeStyle:e.strokeStyle}),m=new d({gamepixelDimension:new n(0,0,a,a),imageName:s,originRelative:new t(.5,.5)}),g={name:"spacer",start:function(){var e=a+h.dimension.width+2;h.position.x=e/-2+a+2,m.position.x=e/-2+a/2,v.remove(g)}},v=new o({name:"iconContainer",position:e.position,components:[h,m,g]}).extend({setValue:function(e,t){u.isDefined(e)&&(i=e,c=f.shorten(e),h.setText(c,t||r),v.attach(g))}});return v}}),bento.define("gui/general/dialog",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/eventsystem","bento/gui/clickbutton","bento/gui/counter","bento/gui/text","bento/utils","bento/tween","components/hdnineslice","globals","bento/components/fill","managers/textstyles","components/iconbutton","components/backbutton"],function(e,t,n,i,r,o,a,s,c,l,u,h,d,p,f,m,g,v){"use strict";return function(i){var r=e.getViewport(),a=i.width||156,s=i.height||208,c=i.bodyColor||"white",u=i.onExit,y=i.onComplete,b=i.titleSprite||"popup_up",w=new d({name:"titleSlice",gamepixelDimension:new n(0,0,a,32),imageName:"gui/9slice/"+b,originRelative:new t(.5,0),position:new t(0,s/-2)}),x=new l({name:"title",position:new t(0,-s/2+18),text:i.title||"",fontSettings:m.get("black12"),align:"center",maxWidth:.8*a,maxHeight:16,linebreaks:!1});x.name="titleText";var E,S=new d({name:"bodySlice",gamepixelDimension:new n(0,0,a,s-32),imageName:"gui/9slice/popup_down_"+c,originRelative:new t(.5,0),position:new t(0,s/-2+32)}),_=new o({name:"background",components:[new f({name:"fill",color:[0,0,.1,.5]})]}),T=new v({onPressed:function(e){u&&u(),P.dismiss()}}),M=new g({name:"exitButton",position:new t(a/2-5,s/-2+5),imageName:"gui/buttons/button_popupexit",frameCountX:2,frameCountY:1,sort:!0,onClick:function(){u&&u(),P.dismiss()}}).attach(T),C=new o({name:"windowContent",position:new t(0,16)}),A=new o({z:0,name:"windowContainer",position:r.getExtents(),components:[S,w,M,x,C]});i.text&&(E=new l({name:"body",position:new t(0,0),text:i.text||"",fontSettings:m.get(i.textStyle||"black10"),align:"center",maxWidth:.75*a}),C.attach(E));var R={name:"behaviorComponent",start:function(e){P.setActive(!1),new h({from:0,to:1,in:20,ease:"elastic",decay:6,oscillations:1,onUpdate:function(e,t){A.scale.x=e,A.scale.y=e},onComplete:function(){P.setActive(!0),i.onActive&&i.onActive()}}),new h({from:0,to:1,in:12,ease:"easeOutQuad",onUpdate:function(e,t){_.alpha=e}})},destroy:function(e){},update:function(e){},draw:function(e){}},P=new o({z:i.z||p.MergeLayers.DIALOG,name:i.name||"dialog",position:i.position,updateWhenPaused:i.updateWhenPaused,components:[_,A,R]}).extend({setActive:function(e){M.setActive(e)},dismiss:function(){P.setActive(!1),new h({from:1,to:0,in:15,ease:"easeInBack",onUpdate:function(e,t){A.scale.x=e,A.scale.y=e},onComplete:function(){y&&y(),P.removeSelf()}}),new h({from:1,to:0,in:12,ease:"easeInQuad",onUpdate:function(e,t){_.alpha=e}})},content:C,getWidth:function(){return a},getHeight:function(){return s}});return P}}),bento.define("gui/general/fountain",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/eventsystem","bento/gui/clickbutton","bento/gui/counter","bento/gui/text","bento/utils","bento/tween"],function(e,t,n,i,r,o,a,s,c,l,u,h){"use strict";var d=h.interpolationsRP,p=h.interpolations,f=function(e){var t,n,i=e.interpolations.length,r={id:e.id,position:{x:0,y:0},rotation:0,scale:{x:1,y:1},alpha:1,visible:!1,interpolations:[]};for(t=0;t<i;t++)n=e.interpolations[t],r.interpolations.push(new g({start:n.start,startMin:n.startMin,startMax:n.startMax,end:n.end,endMin:n.endMin,endMax:n.endMax,from:n.from,fromMin:n.fromMin,fromMax:n.fromMax,to:n.to,toMin:n.toMin,toMax:n.toMax,ease:n.ease,alpha:n.oscillations,beta:n.decay,type:n.type,index:t,id:e.id,onCreate:e.onCreate}));return r},m=function(e,t,n){var i=function(e,t,n){return n=n||0,(e||0)+((t=t||0)||n?u.getRandomRangeFloat(t,n):0)};return e.isVector2?(t=t||{},n=n||{},{x:i(e.x,t.x,n.x),y:i(e.y,t.y,n.y)}):i(e,t,n)},g=function(e){var t={s:m(e.start,e.startMin,e.startMax),e:m(e.end,e.endMin,e.endMax),f:m(e.from,e.fromMin,e.fromMax),t:m(e.to,e.toMin,e.toMax),i:e.ease||"linear",a:e.alpha||0,b:e.beta||0,type:e.type,ii:e.index||0,id:e.id||0};return e.onCreate&&e.onCreate(t),t},v=function(e,t,n,i,r,o){return p[i]?p[i](e,t,n,r,o):d[i](n,e,t-e,1)},y=function(e,t,n){u.isNumber(t[n.type])?t[n.type]+=v(n.f,n.t,e,n.i,n.a,n.b):(t[n.type].x+=v(n.f.x,n.t.x,e,n.i,n.a,n.b),t[n.type].y+=v(n.f.y,n.t.y,e,n.i,n.a,n.b))};return function(n){var i=n.image?n.image:e.assets.getImage(n.imageName),r=n.origin||new t(i.width/2,i.height/2),a=n.scale||new t(1,1),s=n.amount||1,c=[],l=(new t(0,0),!1),u=0,h={name:"behaviorComponent",start:function(e){var t,i=s;for(i=0;i<s;i++)t=new f({id:i,interpolations:n.interpolations,onCreate:n.onCreate}),c.push(t)},destroy:function(e){},update:function(e){var t,i,r,o;l=!1,d.ignoreGameSpeed?u+=1:u+=e.speed,c.forEach(function(e){for(e.position.x=e.position.y=0,e.scale.x=e.scale.y=1,e.rotation=0,e.alpha=0,e.visible=!1,t=0;t<e.interpolations.length;t++)i=e.interpolations[t],r=u-i.s,o=i.e-i.s,r>=0?r<=o?(l=!0,e.visible=!0,y(r/o,e,i)):y(1,e,i):(y(0,e,i),l=!0)}),l||(n.onComplete&&n.onComplete(),d.removeSelf())},draw:function(e){c.forEach(function(t){t.visible&&(e.renderer.setOpacity(t.alpha),e.renderer.drawImage(i,i.x,i.y,i.width,i.height,t.position.x-r.x*a.x*t.scale.x,t.position.y-r.y*a.y*t.scale.y,i.width*a.x*t.scale.x,i.height*a.y*t.scale.y))}),e.renderer.setOpacity(1)}},d=new o({z:n.z||10,name:"fountain",position:n.position,updateWhenPaused:n.updateWhenPaused||0,components:[h]}).extend({ignoreGameSpeed:n.ignoreGameSpeed});return d}}),bento.define("gui/general/iapoverlay",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/gui/clickbutton","bento/gui/counter","bento/gui/text","bento/eventsystem","bento/utils","bento/tween","modules/store","modules/localization","bento/components/fill","modules/tenjin","managers/textstyles"],function(e,t,n,i,r,o,a,s,c,l,u,h,d,p,f,m,g){"use strict";var v=function(n){var i=e.getViewport(),r=n.timeoutTime||600,a=n.onTimeout,s=new o({name:"overlay",components:[new f({color:[0,0,0,.75]})]}),l=u.extend({position:new t(i.width/2,i.height/2),fontSettings:g.get("white10"),text:p.getText("processing"),fontSize:8,fontColor:"#ffffff",align:"center",maxWidth:i.width-16,textBaseline:"middle"},n.fontSettings),h=new c(l),d=0,m={oldPauseLevel:0,start:function(){this.oldPauseLevel=e.objects.isPaused(),d=this.oldPauseLevel+1,y.updateWhenPaused=d,e.objects.pause(d)},destroy:function(){e.objects.pause(this.oldPauseLevel)}},v={hasTimedOut:!1,update:function(){!1===this.hasTimedOut&&y.timer>r&&(this.hasTimedOut=!0,a&&a())}},y=new o({z:n.z,name:"iapOverlay",float:!0,components:[m,s,h,v]});return y.extend({exit:function(t,n){u.timeout(t||0,function(){e.objects.remove(y),n&&n()},d)},setText:function(e){h.setText(e)}}),y};l.on("purchase_success",function(e){v.onNonConsumable(e)}),v.onNonConsumable=function(t){var n=t.productId;e.saveState.save("purchased-"+n,!0)};var y="shop",b={};l.on("purchase_success",function(e){var t=e.productId,n=e.transactionId,i=e.product,r=e.lastReceipt;if(r&&i){var o=Math.round(100*i.price),a=y,s=b[t.replace("XXX",window.IAPPREFIX)]||"iap";w(r)?(u.isNativeIos()?(l.fire("GameAnalytics-addBusinessEvent",{currency:i.currency,amount:o,cartType:a,itemType:s,itemId:t,receipt:r}),m.iosTransaction(t,i.currency||"",1,i.price.toString(),n,r)):u.isNativeAndroid()&&(l.fire("GameAnalytics-addBusinessEvent",{currency:i.currency,amount:o,cartType:a,itemType:s,itemId:t,receipt:r.purchaseData,signature:r.dataSignature}),m.androidTransaction(t,i.currency||"",1,i.price,JSON.stringify(r.purchaseData),r.dataSignature)),m.sendEvent("validatedPayment")):console.log("purchased",{currency:i.currency,amount:o,cartType:a,itemType:s,itemId:t})}});var w=function(e){var t,n,i;if(u.isNativeAndroid())return!u.isDefined(((e||{}).purchaseData||{}).autoRenewing);try{if((t=window.decodeB64?window.decodeB64(e):window.atob(e)).indexOf('"environment" = "Sandbox"')>=0)return console.log("Sandbox environment detected."),!1;if(!(n=t.match(/\"purchase\-info\" \= \"(.*?)\"/gm)).length)return console.log("Purchase info not found."),!1;n=JSON.parse(n[0].split(" = ")[1]);var r=(n=window.decodeB64?window.decodeB64(n):window.atob(n)).match(/\"expires\-date\" \= \"(.*?)\"/gm);if(r&&r.length)return console.log("Product is a subscription."),!1;var o=n.match(/\"transaction\-id\" \= \"(.*?)\"/gm),a=n.match(/\"original\-transaction\-id\" \= \"(.*?)\"/gm);return!!(o&&o.length&&a&&a.length)&&(o=JSON.parse(o[0].split(" = ")[1]),(i="nil"===(a=JSON.parse(a[0].split(" = ")[1]))||a===o)||console.log("Already purchased this product in the past"),i)}catch(e){return u.log("ERROR: malformed receipt "+e),!1}};return v.purchase=function(t){var n=t.z,i=t.id,r=t.subscription,o=u.getDefault(t.isConsumable,!0),a=u.getDefault(t.resolveAutomatically,!0),s=t.onPurchaseComplete,c=t.fontSettings||{},h=new v({z:n,fontSettings:c}),f=t.restore||!1,m=function(t){var n,r,c;f?h.setText(p.getText("restored")):h.setText(p.getText("thanks")),h.exit(60,function(){!f&&a&&d.resolvePurchase(t),!f&&o?(console.log("CONSUMING!!"),d.consume(t,function(){s&&s(!0,i,t)})):s&&s(!0,i,t)}),y(),f||(n=t.productId,r=e.saveState.load("iapAmount",0),c=e.saveState.load("productAmount-"+n,0),r++,e.saveState.save("iapAmount",r),c++,e.saveState.save("productAmount-"+n,c),l.fire("Analytics",{category:"IAP",action:"bought_"+n}),l.fire("Analytics",{category:"IAP",action:"iapAmount_"+r,label:n}),l.fire("Analytics",{category:"UI",action:"bought_"+n}))},g=function(e){console.log("purchase failed!",JSON.stringify(e)),e&&(l.fire("Analytics",{category:"UI",action:"purchaseError",label:JSON.stringify(e)}),h.setText(p.getText("error"))),h.exit(120,function(){s&&s(!1,i,null)}),y()},y=function(){l.off("restore_success",m),l.off("restore_error",g),l.off("purchase_success",m),l.off("purchase_error",g)};return f?(e.objects.attach(h),h.setText(p.getText("processing")),l.on("restore_success",m),l.on("restore_error",g),l.on("purchase_error",g),d.restore(i)||(u.isNativeIos()||u.isNativeAndroid()?g(p.getText("errorstore")):g("Only available in the App version!"))):(e.objects.attach(h),h.setText(p.getText("processing")),l.on("purchase_success",m),l.on("purchase_error",g),(r?d.purchaseSubscription(i):d.purchase(i))||(u.isNativeIos()||u.isNativeAndroid()?g(p.getText("errorstore")):g("Only available in the App version!"))),h},v.restore=function(e){return e.restore=!0,v.purchase(e)},v.getPrice=function(t,n){var i,r=t,o=d.getProducts();if(o)for(i=0;i<o.length;++i)if(o[i].productId===r)return o[i].localizedPrice;return e.saveState.load(r+"Price",n)},v.init=function(e){d.init(e),y=e.gameAnalyticsCartType||"shop",b=e.gameAnalyticsItemTypes||{},v.onNonConsumable=e.onPurchase||v.onNonConsumable},v}),bento.define("gui/general/notificationbadge",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/eventsystem","bento/gui/clickbutton","bento/gui/counter","bento/gui/text","bento/utils","bento/tween","components/hdsprite"],function(e,t,n,i,r,o,a,s,c,l,u,h,d){"use strict";return function(e){var i=new d({gamepixelDimension:new n(0,0,11,12),imageName:"gui/home/notification_b",originRelative:new t(.5,.5)}),r=e.scale||1,a={name:"behaviorComponent",time:-u.getRandom(20),start:function(e){},destroy:function(e){},update:function(t){e.checkActive&&e.checkActive(),s.visible&&(this.time+=t.speed,s.scale.x=s.scale.y=(1+.1*Math.sin(this.time/20))*r)},draw:function(e){}},s=new o({z:0,name:"notificationBadge",position:e.position,updateWhenPaused:0,components:[i,a]});return s}}),bento.define("gui/general/uiloader",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/eventsystem","bento/gui/clickbutton","bento/gui/counter","bento/gui/text","bento/utils","bento/tween","bento/components/nineslice","components/hdnineslice","components/iconbutton","components/textplacement"],function(e,t,n,i,r,o,a,s,c,l,u,h,d,p,f,m){"use strict";var g={},v=!1,y=function(n){var i=n.loadJson||"no asset name supplied",r=n.onObject,o=n.hasOwnProperty("json")?n.json:{},a={name:"uiLoader",ui:{},start:function(t){Object.keys(o).length?a.ui=o:e.assets.hasAsset(i,"json")?a.ui=e.assets.getJson(i):u.log('ERROR: ui json "'+i+'" could not be found'),Object.keys(a.ui).length&&a.load()},load:function(){s(a.ui,function(t){n.onComplete?n.onComplete(t):e.objects.attach(t)})}},s=function(e,n){var i=e.module,o=e.components,a=[],c=0,l=0,h=!1,d=function(){var s={};e.offset&&(e.offset=b(e.offset));var c=e.offset?e.offset:new t(0,0);e.originRelative&&(e.originRelative=b(e.originRelative));var l=function(t){var o=new t(s);o.name=e.name,n&&n(o),g[i]=t,r&&r(o)};u.forEach(e,function(e,t){"module"!==t&&"position"!==t&&"rotationDegrees"!==t&&"components"!==t&&(s[t]=e)}),o&&(s.components=a),e.positionParent&&a.unshift(new x({offset:c,positionParent:e.positionParent,positionSelf:e.positionSelf,positionViewport:e.positionViewport})),e.scale&&(e.scale=b(e.scale)),e.rotationDegrees&&(s.rotation=u.toRadian(e.rotationDegrees)),e.dimension&&(e.dimension=w(e.dimension)),e.boundingBox&&(e.boundingBox=w(e.boundingBox)),g[i]?l(g[i]):(v&&console.warn("WARNING: module "+i+" was found but it was never preloaded."),bento.require([i],l))};o&&o.length&&u.forEach(o,function(e,t){e.module?(c+=1,s(e,function(e){l+=1,a[t]=e,h&&c===l&&d()})):a[t]=e}),h=!0,c===l&&d()};return a},b=function(e){
return new t(e.x||0,e.y||0)},w=function(e){return new n(e.x||0,e.y||0,e.width||0,e.height||0)},x=function(t){var n,i=e.getViewport(),r=b(t.positionParent),o=b(t.positionSelf),a=b(t.positionViewport),s=b(t.offset);return{name:"positioner",entity:null,start:function(){window.addEventListener("resize",this.reposition,!1),this.reposition()},destroy:function(){window.removeEventListener("resize",this.reposition)},attached:function(e){n=e.entity},reposition:function(){n.position.x=s.x,n.position.x+=r.x*(n.parent?n.parent.dimension.width:0),n.position.x+=o.x*n.dimension.width*n.scale.x,n.position.x+=a.x*i.width,n.position.y=s.y,n.position.y+=r.y*(n.parent?n.parent.dimension.height:0),n.position.y+=o.y*n.dimension.height*n.scale.y,n.position.y+=a.y*i.height}}};return y.preload=function(t){var n=t.onComplete,i=e.assets.getAssets().json,r={},o=0,a=0,s=function(e){var t=e.module;g[t]||(r[t]=t),u.forEach(e.components||[],function(e){s(e)})},c=function(){(a+=1)===o&&n&&(n(),n=null)};v=!0,u.forEach(i,function(e,t){0===t.toLowerCase().indexOf("ui/")&&s(e)}),0!==(o=u.getKeyLength(r))?u.forEach(r,function(e){bento.require([e],function(t){g[e]=t,c()})},function(e){u.log("ERROR: "+e),c()}):n(a)},y.clearCache=function(){g={}},y}),bento.define("gui/main/adballoon",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/eventsystem","bento/gui/clickbutton","bento/gui/counter","bento/gui/text","bento/utils","bento/tween","globals","components/hdsprite"],function(e,t,n,i,r,o,a,s,c,l,u,h,d,p){"use strict";return function(i){var r=e.getViewport(),a=new p({gamepixelDimension:new n(0,0,54,59),imageName:"gui/home/video_box",originRelative:new t(.5,.2)}),s=0,c=0,l={name:"behaviorComponent",start:function(e){h.visible=!1},destroy:function(e){},update:function(e){h.visible&&(h.position.y+=.5*e.speed,h.position.x+=h.rotation*e.speed,Math.abs(h.position.x-h.magnet)>8?c+=.01*(u.clamp(-.8,.05*(h.magnet-h.position.x),.8)-c)*e.speed:c+=.01*-c*e.speed,h.position.x+=c*e.speed,s+=.01*-h.rotation*e.speed,h.rotation+=s,h.position.y>r.height+50&&(h.visible=!1))},draw:function(e){}},h=new o({z:d.MergeLayers.BALLOON,name:"adBalloon",position:i.position,updateWhenPaused:0,components:[a,l]}).extend({magnet:0,activate:function(){h.visible||(h.rotation=u.getRandomRangeFloat(-.2,.2),h.visible=!0,h.position.x=u.getRandomRangeFloat(20,r.width-20),h.magnet=h.position.x,c=0,h.position.y=-56)}});return h}}),bento.define("gui/main/banneroverlay",["bento","bento/math/vector2","bento/math/rectangle","bento/entity","bento/eventsystem","bento/utils","bento/components/fill","bento/components/anchor","bento/components/eventlistener","modules/banner"],function(e,t,n,i,r,o,a,s,c,l){"use strict";return function(r){var o=e.getViewport(),u=new n(0,0,o.width,26),h=new t(o.width/2,26),d=new i({name:"fill",components:[new a({dimension:u,color:[0,0,0,.6],origin:h})]}),p=new s({relative:new t(.5,1),offset:new t(0,0),onResize:function(e){var t=Math.max(0,o.height-s.getSafeZone().getY2());u.width=o.width,h.x=o.width/2,u.height=26+t}}),f={name:"behaviorComponent",start:function(e){l.shouldShow()?m.visible=!0:m.visible=!1},destroy:function(e){},update:function(e){},draw:function(e){}},m=new i({z:99999999999,name:"BannerOverlay",position:r.position,updateWhenPaused:0,components:[d,p,f,new c({name:"bannerListener",eventName:"bannerStatusChanged",ignorePause:!1,onEvent:function(){l.shouldShow()?m.visible=!0:m.visible=!1}})]});return m}}),bento.define("gui/main/binsmoke",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/eventsystem","bento/gui/clickbutton","bento/gui/counter","bento/gui/text","bento/utils","bento/tween"],function(e,t,n,i,r,o,a,s,c,l,u,h){"use strict";return function(e){var n=new i({imageName:"gui/fx/merge_star",originRelative:new t(.5,.5)}),r=[],a=e.amount||8,s={name:"behaviorComponent",start:function(e){},destroy:function(e){},update:function(e){var t=!1;r.forEach(function(n){n.x+=n.forceX*e.speed,n.y+=n.forceY*e.speed,n.forceX-=.02*n.forceX*e.speed,n.forceY-=.02*n.forceY*e.speed,n.life+=e.speed,n.alpha=1-Math.min(n.life/n.lifeTime,1),n.alpha*=n.alpha,n.scale-=.02*e.speed,n.antiScale=1/n.scale,n.alpha>0&&(t=!0)}),t||(r.length=0)},draw:function(e){r.forEach(function(t){e.renderer.setOpacity(t.alpha),e.renderer.translate(t.x,t.y),e.renderer.scale(t.scale,t.scale),n.draw(e),e.renderer.scale(t.antiScale,t.antiScale),e.renderer.translate(-t.x,-t.y)})}};return new o({name:"binSmoke",position:e.position,scale:new t(.148,.148),updateWhenPaused:0,components:[s]}).extend({activate:function(){for(var e,t=a;t--;)e={x:0,y:0,forceX:u.getRandomRangeFloat(-12,12),forceY:u.getRandomRangeFloat(-6,6),lifeTime:22+u.getRandom(8),life:0,scale:1.2+u.getRandomFloat(.4),alpha:1},r.push(e)}})}}),bento.define("gui/main/buymenu",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/pixi/sprite","bento/components/clickable","bento/entity","bento/eventsystem","bento/gui/clickbutton","bento/gui/counter","bento/gui/text","bento/utils","bento/tween","components/hdsprite","components/iconbutton","managers/textstyles","components/hdnineslice","bento/components/fill","bento/gui/scrollinglist","globals","components/mask","modules/savemanager","managers/pricing","modules/watchad","modules/localization","managers/timemanager","gui/main/freeupgradedialog","gui/main/iapmenu","components/backbutton","modules/banner","bento/components/anchor"],function(e,t,n,i,r,o,a,s,c,l,u,h,d,p,f,m,g,v,y,b,w,x,E,S,_,T,M,C,A,R,P){"use strict";return function(o){var c=e.getViewport(),l=.6*c.height,h=[],I=x.load("coins"),L=x.load("freeUpgradeTimer"),D=new g({gamepixelDimension:new n(0,0,156,32),imageName:"gui/9slice/popup_up",originRelative:new t(.5,1),position:new t(0,-l)}),O=new u({name:"title",position:new t(0,18-l-32),text:_.getText("buyCars"),fontSettings:m.get("black12"),align:"center",maxWidth:156*.8,maxHeight:16,linebreaks:!1});O.name="titleText";var k=new A({onPressed:function(e){2===b.mainButtonFocus&&te.dismiss()}}),F=new f({position:new t(73,5-l-32),imageName:"gui/buttons/button_popupexit",frameCountX:2,frameCountY:1,sort:!0,onClick:function(){2===b.mainButtonFocus&&te.dismiss()}}).attach(k),B=new p({gamepixelDimension:new n(0,0,156,9),imageName:"gui/shop/header_shadow",originRelative:new t(.5,0)});B.position.y=-l;for(var N,U=R.shouldShow()?P.getSafeZone().height===c.height?26:39:0,z=new y({position:new t(0,24-l),direction:"y",spacing:3,maxOffset:47-l+U,minOffset:0,snap:!1,snapNextOffset:0,onSnap:function(e,t){},onLoseFocus:function(e){},onScrollStart:function(){},snapMinSlideSpeed:1,snapSpeed:.3,damping:.9}),G=x.load("carRank"),H=new d.TweenBehavior({from:1,to:0,in:60,delay:12,applyOnDelay:!0,ease:"easeOutQuart",onUpdate:function(e,t){j.alpha=e},onComplete:function(){e.objects.remove(j)}}),j=new u({text:_.getText("fullGarage"),z:b.MergeLayers.FULLMESSAGE,position:new t(c.width/2,.26*c.height),fontSettings:m.get("white10"),align:"center",maxWidth:c.width-20,shadow:!0,shadowOffset:new t(1.4,1.4),shadowColor:"#000000"}),V=new d.TweenBehavior({from:0,to:1,in:20,ease:"easeInQuad",onUpdate:function(e,t){q.position.y=X-15*e,q.alpha=1-e,q.scale.x=q.scale.y=.1+.048*e},onComplete:function(){q.visible=!1}}),W=new d.TweenBehavior({from:.1846,to:.142,in:16,ease:"elastic",decay:3,oscillations:2,onUpdate:function(e,t){N&&(N.scale.x=N.scale.y=e)},onComplete:function(){N=null}}),X=0,q=new a({name:"box",position:new t(-22,0),scale:new t(.148,.148),components:[new i({imageName:"gui/home/box",originRelative:new t(.5,.5)})]}),Y=function(i){var c=i.rank<=G,l=i.rank<Math.max(1,G-3),d=!l&&i.rank<G-1&&G>4,g=!0,v=i.rank===Math.max(1,G-4)&&b.freeCar<=0&&l,y=new u({text:(i.rank+1).toString(),position:new t(-65,0),fontSettings:m.get("black12"),textBaseline:"middle",align:"center",maxWidth:19,maxHeight:14,drawDebug:!1}),w="car"+("00"+i.rank).slice(-2),A=new r({imageName:"gui/cars/"+w,originRelative:new t(.5,.5)}),R=new a({name:"carContainer",position:new t(-23,0),scale:new t(.142,.142),components:[A]}),P=new a({name:"buttonContainer"}),D=function(){q.visible=!0,q.alpha=1,X=z.position.y+re.position.y+re.parent.position.y-3,q.position.y=X,V.begin(),V.isAdded||e.objects.attach(V),W.begin(),W.isAdded?N.scale.x=N.scale.y=.142:e.objects.attach(W),N=R},O=new f({imageName:v?"gui/buttons/button_buyad":"gui/buttons/button_buyprice",frameCountX:1,frameCountY:3,icon:P,offset:new t(0,-30),offsetOnPressed:2,position:new t(48,0),sort:!0,onClick:function(){if(2===b.mainButtonFocus&&re.parent.position.y+re.position.y>-18)if(v){O.active=!1,g=!1;var n=function(){O.getComponent("sprite",function(e){e.setup({imageName:"gui/buttons/button_buyprice",originRelative:new t(.5,.5),frameCountX:1,frameCountY:3,animations:{up:{speed:0,frames:[0]},down:{speed:0,frames:[1]},inactive:{speed:0,frames:[2]}}})}),P.removeByName("adIcon"),P.removeByName("freeText"),P.attach(F),P.attach(Z),v=!1,g=!0,O.active=!0,n=function(){}};S.showRewarded({z:b.MergeLayers.DIALOG,tag:"freeCar",onReward:function(){o.mergeBoard.buy(i.rank,function(){D(),b.freeCar=5,s.fire("freeCar"),n()},function(){},2)},onError:function(){}})}else{if(d&&x.load("gems")<Y)return b.mainButtonFocus=4,z.setActive(!1),void e.objects.attach(new C({onComplete:function(){z.setActive(!0),b.mainButtonFocus=2}}));if(!d&&U.current>x.load("coins"))return;o.mergeBoard.buy(i.rank,function(t){if(D(),d?(x.add("gems",-Y),s.fire("updateGems")):(E.buy(i.rank),x.add("coins",-U.current),U=E.getPrices(i.rank+1),J=E.shorten(U.current),Z.setText(J),Z.attach(B),s.fire("updateCoins")),T.online){var n=T.getTime();if(n>L&&i.rank<G-3&&!v&&i.rank>G-8){b.mainButtonFocus=3;var r=new M({oldCar:i.rank,newCar:G-3,onComplete:function(e){b.mainButtonFocus=2,e&&(L=n+3e5,x.save("freeUpgradeTimer",L))},onUpgrade:function(){t.setCar(G-3),L=n+6e5,x.save("freeUpgradeTimer",L)}});e.objects.attach(r)}}},function(){H.begin(!0),H.isAdded||e.objects.attach(H),j.isAdded||e.objects.attach(j)},1)}}});P.scale.x=1/O.scale.x,P.scale.y=1/O.scale.y;var k=new r({imageName:d?"gui/home/gem-icon":"gui/home/icon_coin",originRelative:new t(.5,.5)}),F=new a({name:"coinContainer",position:new t(-13,-2),scale:new t(.055,.055),components:[k]}),B={name:"coinAlign",start:function(){var e=Z.dimension.width+1;F.position.x=e/-2+2.5,Z.position.x=F.position.x+5.5,Z.remove(B)}},U=E.getPrices(i.rank+1),Y=E.gemPrice(i.rank),J=E.shorten(U.current),K=m.get("white8");K.align="left";var Z=new u({text:d?Y.toString():J,position:new t(-7,-2),fontSettings:K,maxWidth:26,maxHeight:10,drawDebug:!1,linebreaks:!1});if(Z.attach(B),l||d)if(!v||d)P.attach(F),P.attach(Z);else{var Q=new p({gamepixelDimension:new n(0,0,16,12),imageName:"gui/doubleearnings/icon_video",originRelative:new t(.5,.5)});Q.position.x=-12,Q.position.y=-2;var $=m.get("white8");$.align="left";var ee=new u({text:_.getText("free"),position:new t(-3,-2),fontSettings:$,maxWidth:22,maxHeight:8,drawDebug:!1});Q.name="adIcon",ee.name="freeText",P.attach(Q),P.attach(ee)}else{c||(A.sprite.tint=2105376),O.active=!1;var te=new u({text:_.getText("locked"),position:new t(0,-2),fontSettings:m.get("white8"),align:"center",maxWidth:36,maxHeight:10,drawDebug:!1});P.attach(te)}var ne=new p({gamepixelDimension:new n(0,0,148,34),imageName:"gui/shop/shop_carpannel2",originRelative:new t(.5,.5)}),ie=function(){l&&(U.current<=I||v)||d?O.active=g:O.active=!1};ie();var re=new a({name:"slotContainer-"+i.rank,position:new t(0,0),components:[ne,y,R,O]}).extend({canAfford:ie});return h.push(re),z.addItem(re),re},J=new v({name:"fill",dimension:new n(0,0,156,l/.7),color:[.847,.847,.906,1],originRelative:new t(.5,.7)}),K=new a({name:"background",position:new t(0,0),components:[J]}),Z=0;Z<b.maxCarRank;Z++)Y({rank:Z});z.forceTo(Math.min(0,-45.6*(G-2)+l-24)-U),w.applyToContainer(z,new n(-78,-l,156,l));var Q=function(){I=x.load("coins"),h.forEach(function(e){e.canAfford()})},$=function(){U=R.shouldShow()?P.getSafeZone().height===c.height?26:39:0,z.setMaxOffset(47-l+U)},ee={name:"behaviorComponent",start:function(e){q.visible=!1,new d({from:c.height+l,to:c.height,in:60,delay:0,applyOnDelay:0,ease:"elastic",decay:8,oscillations:3,onUpdate:function(e,t){te.position.y=e},onComplete:function(){}}),s.on("updateCoins",Q),s.on("bannerStatusChanged",$)},destroy:function(e){s.off("updateCoins",Q),s.off("bannerStatusChanged",$)},update:function(e){},draw:function(e){}},te=new a({z:b.MergeLayers.BUYMENU,name:"buyMenu",position:new t(c.width/2,c.height),updateWhenPaused:0,components:[K,z,B,D,F,O,q,ee]}).extend({setActive:function(e){F.setActive(e)},dismiss:function(){te.setActive(!1),b.mainButtonFocus=0,new d({from:c.height,to:c.height+l,in:8,ease:"easeInQuad",onUpdate:function(e,t){te.position.y=e},onComplete:function(){te.removeSelf()}})}});return te}}),bento.define("gui/main/carunlockdialog",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/eventsystem","bento/gui/clickbutton","bento/gui/counter","bento/gui/text","bento/utils","bento/tween","gui/general/dialog","components/hdsprite","managers/textstyles","components/iconbutton","modules/watchad","globals","managers/pricing","modules/savemanager","components/mask","gui/general/confetti","modules/localization","modules/carinfo"],function(e,t,n,i,r,o,a,s,c,l,u,h,d,p,f,m,g,v,y,b,w,x,E,S){"use strict";var _=function(e){var i=new l({text:e.statName,position:new t(-52,-5),fontSettings:f.get("statWhite"),align:"center",maxWidth:104,maxHeight:10,drawDebug:!1}),r=new p({gamepixelDimension:new n(0,0,108,10),imageName:"gui/unlock/stats_bar_base",originRelative:new t(.5,.5)});r.position.y=5;var a=new p({gamepixelDimension:new n(0,0,104,6),imageName:"gui/unlock/stats_bar_fill",originRelative:new t(.5,.5)});a.position.y=5;var s=new w({rectangle:new n(-56,2,e.previous/e.maxPoints*104,6),sprite:a.getComponent("sprite")});a.attach(s);var c=new p({gamepixelDimension:new n(0,0,104,6),imageName:"gui/unlock/stats_bar_fill_new",originRelative:new t(.5,.5)});c.position.y=5;var u=e.previous/e.maxPoints*104-56,h=new w({rectangle:new n(u-56,2,e.points/e.maxPoints*104-u,6),sprite:c.getComponent("sprite")});return c.attach(h),new o({name:"statBar",position:e.position,scale:new t(.8,.8),components:[r,c,a,i]})};return function(r){var s=r.car,c=s+1===v.maxCarRank,u="gui/cars/car"+("00"+s).slice(-2)+"_big",h=r.onComplete;e.audio.stopSound("sfx_cheerdialog"),e.audio.playSound("sfx_cheerdialog");var g=new d({name:"carUnlockDialog",title:E.getText("carUnlocked"),bodyColor:"black",height:c?244:232,onExit:function(){T.active=!1,a.fire("updateStats")},onComplete:function(){h&&h()}}),y=new o({name:"carContainer",position:new t(0,-45),scale:new t(.148,.148),components:[new i({imageName:u,originRelative:new t(.5,.5)})]}),b=new p({gamepixelDimension:new n(0,0,130,130),imageName:"gui/fx/shine",originRelative:new t(.5,.5)}).attach({name:"shineRotator",update:function(e){b.rotation+=.02*e.speed}});b.position.y=-45,g.content.attach(b),g.content.attach(y);var w=new l({text:E.getText("select"),position:new t(0,52),fontSettings:f.get("black10"),align:"center",maxWidth:50,linebreaks:!1,drawDebug:!1});w.scale.x=1/.144,w.scale.y=1/.144;var T=new m({name:"increaseButton",z:0,position:new t(0,67),imageName:"gui/buttons/button_buyback",frameCountX:2,frameCountY:1,icon:w,offset:new t(0,0),offsetOnPressed:2,iconAlpha:.5,excited:!0,onClick:function(){a.fire("updateStats"),g.dismiss()}});g.content.attach(T);var M=S.getStats(s),C=S.getStats(s-1),A=S.getMaxStats(s),R=new _({statName:E.getText("acceleration"),points:M.acceleration,previous:C.acceleration,maxPoints:A,position:new t(0,10)});g.content.attach(R);var P,I=new _({statName:E.getText("speed"),points:M.speed,previous:C.speed,maxPoints:A,position:new t(0,28)});return g.content.attach(I),c&&(y.position.y-=6,b.position.y-=6,I.position.y-=6,R.position.y-=6,T.position.y+=6,P=new l({text:E.getText("moreComingSoon"),position:new t(0,46),fontSettings:f.get("white10"),align:"center",maxWidth:128,linebreaks:!1,drawDebug:!1}),g.content.attach(P)),new x({z:v.MergeLayers.CONFETTI}),g}}),bento.define("gui/main/cheat",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/eventsystem","bento/gui/clickbutton","bento/gui/counter","bento/gui/text","bento/utils","bento/tween","globals","bento/components/modal","bento/components/fill","bento/components/nineslice","components/iconbutton","bento/gui/scrollinglist","modules/savemanager","modules/localization","debug/overlay","gui/main/mergeboard","managers/pricing","managers/experience","modules/abtest","managers/timemanager","entities/tutorial","managers/vipmanager"],function(e,t,n,i,r,o,a,s,c,l,u,h,d,p,f,m,g,v,y,b,w,x,E,S,_,T,M,C){"use strict";return function(i){var r=e.getViewport(),s=i.width||144,c=i.height||144,h=new f({name:"fill",dimension:r.getSize(),color:[27/255,18/255,58/255,.7],originRelative:new t(0,0)}),m=function(){d.mainButtonFocus=0,H.removeSelf()},_=new g({imageName:"gui/buttons/button_popupexit",frameCountX:2,frameCountY:1,iconAlpha:.5,excited:!0,position:new t(20,26),onClick:function(){a.fire("clickButton-onButtonDown"),m()}}),A=new v({position:new t(r.width/2,60),direction:"y",spacing:-120,maxOffset:0,minOffset:0,snap:!1,snapNextOffset:0,onSnap:function(e,t){},onLoseFocus:function(e){},onScrollStart:function(){},snapMinSlideSpeed:1,snapSpeed:.3,damping:.9}),R=function(e){var n=new l({z:0,position:new t(0,0),text:e.text,fontSize:10,fontColor:"#002FAF",font:"montserrat-alt-black",align:"center",textBaseline:"middle",maxWidth:100,linebreaks:!1,scale:new t(4,4)}),i=new g({imageName:"gui/buttons/button_levelclaim",frameCountX:2,frameCountY:1,icon:n,iconOffset:new t(0,-2),offsetOnPressed:2,onClick:e.onClick});return A.addItem(i),i.setText=function(e){n.setText(e)},i};R({text:window.atob("ZGVsZXRlIHNhdmU="),onClick:function(){d.mainButtonFocus=0,e.saveState.clear(),e.saveState.save(window.atob("aWdub3JlRnR1ZQ=="),1),x.reset(),E.refresh(),S.refresh(),e.objects.get("tutorial",function(t){e.objects.remove(t)}),e.objects.attach(new M({state:0})),e.screens.show("screens/race")}}),R({text:window.atob("Z2V0IG1vbmV5"),onClick:function(){u.prompt(window.atob("aG93IG11Y2g/"),window.atob("aG93IG11Y2g/"),function(e){isNaN(e)||(y.add(window.atob("Y29pbnM="),parseInt(e)),a.fire("updateCoins"),m())})}}),R({text:window.atob("Z2V0IGdlbXM="),onClick:function(){u.prompt(window.atob("aG93IG11Y2g/"),window.atob("aG93IG11Y2g/"),function(e){isNaN(e)||(y.add(window.atob("Z2Vtcw=="),parseInt(e)),a.fire("updateGems"),m())})}}),R({text:window.atob("c2V0IGNhcg=="),onClick:function(){u.prompt(window.atob("MCB0byA=")+(d.maxCarRank-1),window.atob("MCB0byA=")+(d.maxCarRank-1),function(t){isNaN(t)||(y.save(window.atob("Y2FyUmFuaw=="),Math.min(parseInt(t),d.maxCarRank-1)),d.mainButtonFocus=0,e.screens.show("screens/main"))})}});var P=R({text:window.atob("c3RhZ2U6IA==")+Math.floor(y.load("stage")/5),onClick:function(){var e=(Math.floor(y.load("stage")/5)+1)%d.maxStage;P.getComponent("text",function(t){t.setText(window.atob("c3RhZ2U6IA==")+e)}),e*=5,y.save("stage",e)}}),I=R({text:window.atob(d.goodJob?"Y2hlZXI6IG9u":"Y2hlZXI6IG9mZg=="),onClick:function(){d.goodJob=!d.goodJob,I.getComponent("text",function(e){e.setText(window.atob(d.goodJob?"Y2hlZXI6IG9u":"Y2hlZXI6IG9mZg=="))})}}),L=R({text:window.atob(d.noJoystick?"dmlydHVhbCBqb3lzdGljazogb2Zm":"dmlydHVhbCBqb3lzdGljazogb24="),onClick:function(){d.noJoystick=!d.noJoystick,L.getComponent("text",function(e){e.setText(window.atob(d.noJoystick?"dmlydHVhbCBqb3lzdGljazogb2Zm":"dmlydHVhbCBqb3lzdGljazogb24="))})}}),D=R({text:window.atob(d.noRaceUI?"cmFjZSB1aTogb2Zm":"cmFjZSB1aTogb24="),onClick:function(){d.noRaceUI=!d.noRaceUI,D.getComponent("text",function(e){e.setText(window.atob(d.noRaceUI?"cmFjZSB1aTogb2Zm":"cmFjZSB1aTogb24="))})}}),O=R({text:window.atob(d.noRaceBar?"cmFjZSBiYXI6IG9mZg==":"cmFjZSBiYXI6IG9u"),onClick:function(){d.noRaceBar=!d.noRaceBar,O.getComponent("text",function(e){e.setText(window.atob(d.noRaceBar?"cmFjZSBiYXI6IG9mZg==":"cmFjZSBiYXI6IG9u"))})}}),k=R({text:window.atob(d.noRaceNames?"bmFtZXM6IG9mZg==":"bmFtZXM6IG9u"),onClick:function(){d.noRaceNames=!d.noRaceNames,k.getComponent("text",function(e){e.setText(window.atob(d.noRaceNames?"bmFtZXM6IG9mZg==":"bmFtZXM6IG9u"))})}}),F=R({text:window.atob(d.noFirstPlayer?"cml2YWw6IG9mZg==":"cml2YWw6IG9u"),onClick:function(){d.noFirstPlayer=!d.noFirstPlayer,F.getComponent("text",function(e){e.setText(window.atob(d.noFirstPlayer?"cml2YWw6IG9mZg==":"cml2YWw6IG9u"))})}}),B=R({text:window.atob(d.waitWithRewardScreen?"cmV3YXJkczogd2FpdA==":"cmV3YXJkczogaW5zdGFudA=="),onClick:function(){d.waitWithRewardScreen=!d.waitWithRewardScreen,B.getComponent("text",function(e){e.setText(window.atob(d.waitWithRewardScreen?"cmV3YXJkczogd2FpdA==":"cmV3YXJkczogaW5zdGFudA=="))})}}),N=R({text:window.atob(d.greenScreen?"Z3JlZW4gc2NyZWVuOiBvbg==":"Z3JlZW4gc2NyZWVuOiBvZmY="),onClick:function(){var e=function(){d.greenScreen=!d.greenScreen;var e={fontColor:d.greenScreen?d.greenScreenColor:"#002FAF"};N.getComponent("text",function(t){t.setText(window.atob(d.greenScreen?"Z3JlZW4gc2NyZWVuOiBvbg==":"Z3JlZW4gc2NyZWVuOiBvZmY="),e)})};d.greenScreen?e():u.prompt(window.atob("d2hhdCBjb2xvcj8gKGRlZmF1bHQ6IDAwRkYwMCk="),window.atob("d2hhdCBjb2xvcj8gKGRlZmF1bHQ6IDAwRkYwMCk="),function(t){/[0-9A-Fa-f]{6}/g.test(t)?d.greenScreenColor=("#"+t+"000000").slice(0,7):d.greenScreenColor="#00FF00",e()})}}),U=(R({text:window.atob(d.noMainMenu?"bWFpbiBtZW51OiBvZmY=":"bWFpbiBtZW51OiBvbg=="),onClick:function(){d.noMainMenu=!d.noMainMenu,d.mainButtonFocus=0,e.screens.show("screens/main")}}),R({text:window.atob(d.dontRotateCar?"Y2FyIHJvdGF0ZTogb2Zm":"Y2FyIHJvdGF0ZTogb24="),onClick:function(){d.dontRotateCar=!d.dontRotateCar,U.getComponent("text",function(e){e.setText(window.atob(d.dontRotateCar?"Y2FyIHJvdGF0ZTogb2Zm":"Y2FyIHJvdGF0ZTogb24="))})}}));R({text:window.atob(d.forceMM?"bW9uZGF5IG1hZG5lc3M6IG9u":"bW9uZGF5IG1hZG5lc3M6IG9mZg=="),onClick:function(){d.forceMM=!d.forceMM,d.mainButtonFocus=0,e.screens.show("screens/main")}}),R({text:window.atob("c3VuZGF5IG1hZG5lc3M="),onClick:function(){d.forceSM=!d.forceSM,d.mainButtonFocus=0,y.save(window.atob("cHJlTW9uZGF5UG9wdXA="),0),e.screens.show("screens/main")}}),R({text:window.atob("Zm9yY2UgZWFybmluZ3M="),onClick:function(){d.earningsChecked=!1;var t=T.getTime(),n=e.saveState.load("offlineEarningsTime",0);Math.floor((t-n)/1e3)/60<15&&(t-=9e5,e.saveState.save("offlineEarningsTime",t)),m()}}),R({text:window.atob("bGFuZ3VhZ2U6IA==")+window.currentLanguage,onClick:function(){u.prompt(window.atob("ZGUsIGVuLCBlcywgZnIsIGl0LCBqYSwga28sIHB0LCBydSwgemgsIHp0"),window.atob("ZGUsIGVuLCBlcywgZnIsIGl0LCBqYSwga28sIHB0LCBydSwgemgsIHp0"),function(t){b.setLanguage(t),d.mainButtonFocus=0,e.screens.show("screens/main")})}}),R({text:e.saveState.load(window.atob("VklQ"),!1)?window.atob("VklQIGVuYWJsZWQ="):window.atob("VklQIGRpc2FibGVk"),onClick:function(){!1===e.saveState.load(window.atob("VklQ"),!1)?(e.saveState.save(window.atob("VklQ"),!0),e.saveState.save(window.atob("VmlwTGFzdFZhbGlkYXRlZA=="),T.getTime()/C.getTimeSpan()),e.saveState.save(window.atob("VmlwRmFpbGVkVmFsaWRhdGlvbnM="),0)):(e.saveState.save(window.atob("VklQ"),!1),a.fire(window.atob("b25WaXBDaGFuZ2Vk"),!1)),d.mainButtonFocus=0,e.screens.show("screens/main")}}),R({text:e.saveState.load(window.atob("bm9CYW5uZXI="),!1)?window.atob("YmFubmVyczogb2Zm"):window.atob("YmFubmVyczogb24="),onClick:function(){e.saveState.save(window.atob("bm9CYW5uZXI="),!e.saveState.load(window.atob("bm9CYW5uZXI="),!1)),d.mainButtonFocus=0,e.screens.show("screens/main")}}),R({text:e.saveState.load(window.atob("bm9BZHM="),!1)?window.atob("YWRzOiBvZmY="):window.atob("YWRzOiBvbg=="),onClick:function(){e.saveState.save(window.atob("bm9BZHM="),!e.saveState.load(window.atob("bm9BZHM="),!1)),d.mainButtonFocus=0,e.screens.show("screens/main")}}),R({text:window.atob("ZGVidWcgcGx1Z2lucw=="),onClick:function(){new w({showOverlay:!0,params:{"debug/tests/tenjin":null,"debug/tests/ironsrc":null,"debug/tests/mopub":null,"debug/tests/iap":{testProduct:"PRODUCT_ID"},"debug/tests/facebook":null,"debug/tests/systemdata":null,"debug/tests/gameanalytics":null}})}});var z=new l({position:new t(8,10),text:"v"+window.VERSION+"-"+window.BUILD+"."+(window.PATCHVERSION||0)+(e.isDev()?"DEV":""),font:"font",align:"left",fontSize:8,fontColor:"#ffffff",textBaseline:"bottom"}),G=new p({}),H=new o({z:i.z||d.MergeLayers.CHEATMENU,name:window.atob("Y2hlYXRNZW51"),float:!0,dimension:new n(0,0,s,c),components:[G,h,A,_,z]});return H}}),bento.define("gui/main/cloudsavedialog",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/eventsystem","bento/gui/clickbutton","bento/gui/counter","bento/gui/text","bento/utils","bento/tween","gui/general/dialog","components/hdsprite","gui/general/currencyicon","managers/textstyles","components/iconbutton","modules/watchad","globals","modules/localization","modules/cloudsavemanager"],function(e,t,n,i,r,o,a,s,c,l,u,h,d,p,f,m,g,v,y,b,w){"use strict";return function(e){var n=e.onComplete,i=e.beforeLoad,r=new d({z:e.z,updateWhenPaused:e.updateWhenPaused,title:b.getText("cloud"),text:b.getText("loadFromCloud"),height:170,onExit:function(){a.active=!1,w.save(n||function(){},!0)},onComplete:n});r.content.getComponent("body",function(e){e.position.y=-19});var o=new l({text:b.getText("yesCloud"),position:new t(0,6),scale:new t(6.94,6.94),fontSettings:m.get("black10"),align:"center",maxWidth:50,linebreaks:!1,drawDebug:!1}),a=new g({name:"yesButton",z:0,position:new t(0,35),imageName:"gui/buttons/button_offlinex2",frameCountX:1,frameCountY:3,icon:o,offset:new t(0,0),offsetOnPressed:2,iconAlpha:.5,excited:!0,onClick:function(){i&&i(),w.load(function(e){e&&w.resetup()},!0),r.dismiss()}});return r.content.attach(a),r}}),bento.define("gui/main/coinbar",["bento","bento/entity","globals","gui/general/uiloader","managers/textstyles","managers/pricing","modules/savemanager"],function(e,t,n,i,r,o,a){"use strict";return function(e){var s=new i({loadJson:"ui/coinbar",onObject:function(e){"coinText"===e.name&&(c.coinText=e,e.setText(o.shorten(c.coins),r.get("white8")))},onComplete:function(e){c.attach(e),s.done=!0}}),c=new t({z:n.RaceLayers.GUI,name:"coinBar",position:e.position,updateWhenPaused:0,components:[s]}).extend({coins:a.load("coins"),setCoins:function(){this.coins=a.load("coins"),c.coinText&&c.coinText.setText(o.shorten(this.coins),r.get("white8"))},coinText:null});return c}}),bento.define("gui/main/coinrain",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/eventsystem","bento/gui/clickbutton","bento/gui/counter","bento/gui/text","bento/utils","bento/tween","globals"],function(e,t,n,i,r,o,a,s,c,l,u,h,d){"use strict";return function(n){var i=n.image?n.image:e.assets.getImage(n.imageName||"gui/home/icon_coin"),r=n.origin||new t(i.width/2,i.height/2),a=new t(.075,.075),s=[],c=[],l=e.getViewport(),h=function(e){var t,n=u.getRandomRangeFloat(-.2,.2),i=Math.abs(n)/.2;c.length?((t=c.pop()).x=u.getRandom(l.width),t.y=e||-12-u.getRandomFloat(40),t.scale.x=u.getRandomRangeFloat(-1,1),t.scale.rotation=1*(1-i)+u.getRandomFloat(1)*i*u.pickRandom(-1,1)):t={x:u.getRandom(l.width),y:e||-12-u.getRandomFloat(40),scale:{x:1*(1-i)+u.getRandomFloat(1)*i*u.pickRandom(-1,1),y:1},rotation:n},s.push(t)},p=!1,f={name:"behaviorComponent",start:function(e){},destroy:function(e){},update:function(e){var t,n=d.buffs.doubleCoin,i=s.length;if(n||i){var r,o,a,f;for(n&&i<12&&(i?u.getRandom(6)||h():h(-20)),t=0;t<i;t++)(r=s[t]).y+=8*e.speed,r.scale.x+=r.rotation*((1.4-Math.abs(r.scale.x))/1.4)*e.speed,(o=Math.abs(r.scale.x))>1&&(r.rotation=-r.rotation,r.scale.x=(1-o+1)*u.sign(r.scale.x)),r.y>l.height+20&&(n?(r.x=u.getRandom(l.width),r.y=-12-u.getRandomFloat(40),r.scale.x=u.getRandomRangeFloat(-1,1),a=u.getRandomRangeFloat(-.2,.2),f=Math.abs(a)/.2,r.scale.rotation=1*(1-f)+u.getRandomFloat(1)*f*u.pickRandom(-1,1)):(c.push(s.splice(t,1)[0]),i--,t--));p=!0}else p=!1},draw:function(e){var t;p&&s.forEach(function(n){t=Math.max(Math.abs(n.scale.x),.2)*u.sign(n.scale.x),e.renderer.drawImage(i,i.x,i.y,i.width,i.height,n.x-r.x*a.x*t,n.y-r.y*a.y,i.width*a.x*t,i.height*a.y)})}};return new o({z:d.MergeLayers.COINRAIN,name:"coinRain",position:n.position,updateWhenPaused:n.updateWhenPaused||0,components:[f]})}}),bento.define("gui/main/doublecoinbuff",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/eventsystem","bento/gui/clickbutton","bento/gui/counter","bento/gui/text","bento/utils","bento/tween","components/hdsprite","modules/savemanager","globals","managers/textstyles","modules/localization"],function(e,t,n,i,r,o,a,s,c,l,u,h,d,p,f,m,g){"use strict";return function(i){var r=e.getViewport(),a=f.buffs.doubleCoin,s=new d({gamepixelDimension:new n(0,0,12,12),imageName:"gui/doubleearnings/buff_x2",originRelative:new t(.5,.5)}),c=function(e){var t=e/60,n=Math.floor((t+1)/60);return n+":"+("00"+Math.ceil(t-60*n)%60).slice(-2)},u=m.get("white5");u.align="left";var h=new l({text:"coin x2 "+c(a),position:new t(7.5,.3),fontSettings:u,align:"center",linebreaks:!1,drawDebug:!1}),p=0,v={name:"behaviorComponent",start:function(e){y.position.x=r.width/2-72.4,y.position.y=46,(a=f.buffs.doubleCoin)||(y.visible=!1)},destroy:function(e){},update:function(e){(a=f.buffs.doubleCoin)?(y.visible=!0,(a-=e.speed)<0&&(a=0),Math.ceil(a/60)!==p&&h.setText(g.getText("coinBonusTime").replace("{TIME}",c(a))),p=Math.ceil(a/60)):y.visible=!1},draw:function(e){}},y=new o({z:f.MergeLayers.BUFFS,name:"doubleCoinBuff",position:i.position,updateWhenPaused:0,components:[s,h,v]}).extend({getTime:function(){return c(a)}});return y}}),bento.define("gui/main/doubledialog",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/eventsystem","bento/gui/clickbutton","bento/gui/counter","bento/gui/text","bento/utils","bento/tween","gui/general/dialog","components/hdsprite","managers/textstyles","components/iconbutton","modules/watchad","globals","components/mask","managers/timemanager","modules/savemanager","modules/localization"],function(e,t,n,i,r,o,a,s,c,l,u,h,d,p,f,m,g,v,y,b,w,x){"use strict";return function(e){var r=v.buffs.doubleCoin,s=0,c=!1,h=new d({name:"doubleDialog",title:x.getText("coinBonusBoost"),onExit:function(){F.active=!1},onComplete:function(){v.mainButtonFocus=0}}).attach({name:"clock",start:function(){},update:function(e){(r=v.buffs.doubleCoin)>C?(c=!0,F.active=!1):c&&(c=!1,B()),r&&(r<0&&(r=0),Math.ceil(r/60)!==s&&(A.width=r/C*M,L.setText(P(r))),s=Math.ceil(r/60))}}),b=new p({gamepixelDimension:new n(0,0,49,47),imageName:"gui/doubleearnings/icon_x2",originRelative:new t(.5,.5)});b.position.y=-20;var w=new l({text:x.getText("coinBonusExplanation"),position:new t(0,-60),fontSettings:f.get("coinBonusInfo"),align:"center",maxWidth:128,maxHeight:18,drawDebug:!1});h.content.attach(b),h.content.attach(w);var E=new p({gamepixelDimension:new n(0,0,96,6),imageName:"gui/doubleearnings/barbase_x2",originRelative:new t(.5,.5)});h.content.attach(E),E.position.x=10,E.position.y=20;var S=new i({imageName:"gui/doubleearnings/barfill_x2",originRelative:new t(0,.5)}),_=new o({name:"barFill",position:new t(-358.5,0),components:[S]}),T=new i({name:"fillSprite",imageName:"gui/doubleearnings/bardivider_x2",originRelative:new t(.5,.5)});E.attach(_),E.attach(T);var M=717,C=108e3,A=new n(M/-2,-12,r/C*M,24),R=new y({rectangle:A,sprite:S});_.attach(R);var P=function(e){var t=e/60,n=Math.floor((t+1)/60);return n+":"+("00"+Math.ceil(t-60*n)%60).slice(-2)},I=f.get("black7");I.align="right";var L=new l({text:P(r),position:new t(-42,20.3),fontSettings:I,align:"center",maxWidth:22,maxHeight:10,linebreaks:!1,drawDebug:!1});h.content.attach(L);var D=new p({
gamepixelDimension:new n(0,0,22,19),imageName:"gui/offlineearnings/icon_video",originRelative:new t(.5,.5)});D.position.y=-7;var O=new l({text:x.getText("getX2"),position:new t(0,6),fontSettings:f.get("black10"),align:"center",maxWidth:50,linebreaks:!1,drawDebug:!1}),k=new o({name:"collectIcon",position:new t(0,46),scale:new t(1/.144,1/.144),components:[D,O]}),F=new m({name:"increaseButton",z:0,position:new t(0,54),imageName:"gui/buttons/button_offlinex2",frameCountX:1,frameCountY:3,icon:k,offset:new t(0,0),offsetOnPressed:2,iconAlpha:.5,excited:!0,onClick:function(){g.showRewarded({z:v.MergeLayers.DIALOG,tag:"doubleEarnings",onReward:function(e){v.buffs.addToDoubleCoin(9e3),a.fire("updateEarnings")},onError:function(e){}})}});h.content.attach(F),F.active=!1;var B=function(){g.canShowRewarded({onSuccess:function(){F.active=!0},onError:function(){u.isDev()?F.active=!0:window.setTimeout(B,2e3)}})};return r<=C?B():c=!0,h}}),bento.define("gui/main/doubletimer",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/eventsystem","bento/gui/clickbutton","bento/gui/counter","bento/gui/text","bento/utils","bento/tween","components/hdsprite","modules/savemanager","globals","managers/textstyles","modules/localization"],function(e,t,n,i,r,o,a,s,c,l,u,h,d,p,f,m,g){"use strict";return function(e){var i,r=f.buffs.doubleCoin,a=new d({gamepixelDimension:new n(0,0,27,14),imageName:"gui/coinboost/timer_tab",originRelative:new t(.5,.5)}),s=function(e){var t=e/60,n=Math.floor((t+1)/60);return n+":"+("00"+Math.ceil(t-60*n)%60).slice(-2)},c=m.get("white7"),u=new l({text:s(r),position:new t(0,0),fontSettings:c,align:"center",linebreaks:!1,drawDebug:!1}),p=0,g={name:"behaviorComponent",start:function(e){(r=f.buffs.doubleCoin)?v.position.y=-23:(v.visible=!1,v.position.y=-10)},destroy:function(e){},update:function(e){(r=f.buffs.doubleCoin)?(-23===v.position.y||i||(v.visible=!0,i=new h({from:v.position.y,to:-23,in:16,ease:"easeOutQuad",onUpdate:function(e,t){v.position.y=e},onComplete:function(){i=null}})),(r-=e.speed)<0&&(r=0),Math.ceil(r/60)!==p&&u.setText(s(r)),p=Math.ceil(r/60)):-10===v.position.y||i||(i=new h({from:v.position.y,to:-10,in:16,ease:"easeOutQuad",onUpdate:function(e,t){v.position.y=e},onComplete:function(){i=null,v.visible=!1}}))},draw:function(e){}},v=new o({z:f.MergeLayers.BUFFS,name:"doubleCoinBuff",position:e.position,updateWhenPaused:0,components:[a,u,g]}).extend({getTime:function(){return s(r)}});return v}}),bento.define("gui/main/earningsdialog",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/eventsystem","bento/gui/clickbutton","bento/gui/counter","bento/gui/text","bento/utils","bento/tween","gui/general/dialog","components/hdsprite","gui/general/currencyicon","managers/textstyles","components/iconbutton","modules/watchad","globals","modules/localization","managers/vipmanager"],function(e,t,n,i,r,o,a,s,c,l,u,h,d,p,f,m,g,v,y,b,w){"use strict";return function(e){var r=e.coins,a=e.collect,s=e.doubleAmount||3,c=w.isVip(),u=!1,x=new d({name:"offlineEarningsDialog",title:b.getText("offlineEarnings"),onActive:function(){e.doubleCoins&&x.getComponent("windowContainer",function(e){e.getComponent("exitButton",function(e){e.setActive(!1)})})},onExit:function(){R.active=!1,u=!0},onComplete:function(){a(!u)}}),E=new p({gamepixelDimension:new n(0,0,92,76),imageName:"gui/offlineearnings/coin_bag",originRelative:new t(.5,.5)});E.position.x=4,E.position.y=-38;var S=new f({value:r,textStyle:"black20",iconSize:20,currencyIcon:"gui/home/icon_coin",position:new t(0,14)});x.content.attach(E),x.content.attach(S);var _=new p({gamepixelDimension:new n(0,0,22,19),imageName:"gui/home/icon_video",originRelative:new t(.5,.5)});_.position.y=-10;var T=new f({value:r*s,textStyle:"black14",iconSize:16,currencyIcon:"gui/level_completed/icon_coingreen",position:new t(0,5),lineWidth:.8,strokeStyle:"#a1ff39"}),M=new p({gamepixelDimension:new n(0,0,26,26),imageName:"gui/level_completed/star_x5",originRelative:new t(.5,.5)});M.position.y=-14,M.position.x=42;var C=new l({text:"x"+s.toString(),position:new t(42,-14),fontSettings:m.get("black12"),align:"center",maxWidth:32,linebreaks:!1,drawDebug:!1});C.rotation=-.3;var A=new o({name:"collectIcon",position:new t(0,46),scale:new t(1/.144,1/.144),components:[_,T,M,C]}),R=new g({name:"increaseButton",z:0,position:new t(0,54),imageName:"gui/buttons/button_rv_small",frameCountX:1,frameCountY:3,icon:A,offset:new t(0,0),offsetOnPressed:2,iconAlpha:.5,excited:!0,onClick:function(){v.showRewarded({z:y.MergeLayers.DIALOG,tag:"offlineEarnings",onReward:function(){x.dismiss()}})}});return x.content.attach(R),(e.doubleCoins||c)&&(R.active=!1,new h({from:.18,to:0,in:40,delay:50,applyOnDelay:0,ease:"elastic",decay:5,oscillations:3,onStart:function(){S.setValue(2*r),T.setValue(2*r*s);var a=new l({z:0,position:new t(-7,7),text:b.getText(e.doubleCoins?"monday!":"VIP"),font:"montserrat-black-italic",fontSize:9,fontColor:"#ffba1c",lineWidth:1,strokeStyle:"#b44117",innerStroke:!1,align:"center",textBaseline:"bottom",linebreaks:!1});a.start(),x.content.attach(a);var c=new p({gamepixelDimension:new n(0,0,13,9),imageName:"gui/monday_madness/mm_offline_x2icon",originRelative:new t(.5,.5)});c.position.x=a.dimension.width/2,c.position.y=3,x.content.attach(c);var u=new o({z:0,name:"extraCoins",family:[""],position:new t(0,0),components:[new i({imageName:"gui/monday_madness/mm_coins",originRelative:new t(.5,.5)})]});u.position.x=0,u.position.y=E.position.y,u.scale.x=E.scale.x,u.scale.y=E.scale.y,x.content.attach(u),new h({from:0,to:1,in:12,ease:"easeInQuad",onUpdate:function(e,t){a.alpha=e,c.alpha=e}}),new h({from:0,to:1,in:12,delay:16,applyOnDelay:!0,ease:"easeInQuad",onUpdate:function(e,t){u.alpha=e}}),new h({from:S.position.y,to:S.position.y+4,in:20,ease:"easeOutQuad",onUpdate:function(e,t){S.position.y=e}})},onUpdate:function(e,t){S.rotation=e},onComplete:function(){R.active=!0,x.getComponent("windowContainer",function(e){e.getComponent("exitButton",function(e){e.setActive(!0)})})}})),x}}),bento.define("gui/main/eliminated",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/eventsystem","bento/gui/clickbutton","bento/gui/counter","bento/gui/text","bento/utils","bento/tween","components/hdsprite","managers/textstyles","modules/localization"],function(e,t,n,i,r,o,a,s,c,l,u,h,d,p,f){"use strict";return function(i){var r=e.getViewport(),s=new d({gamepixelDimension:new n(0,0,8,5),imageName:"gui/flags/us",originRelative:new t(.5,.5)});s.position.x=8,s.position.y=-4;var c=new d({gamepixelDimension:new n(0,0,46,8),imageName:"gui/ingame/player-details-back",originRelative:new t(.5,.5)});c.position.x=25,c.position.y=-4;var u=new l({text:"Player",position:new t(13,-4),fontSettings:p.get("eliminatedPlayer"),align:"left",maxWidth:33,maxHeight:4,linebreaks:!1}),m=new l({text:f.getText("eliminated"),position:new t(25,5),fontSettings:p.get("eliminated"),align:"center",maxWidth:46,maxHeight:9,linebreaks:!1}),g=new d({gamepixelDimension:new n(0,0,58,20),imageName:"gui/ingame/eliminated-infobox",originRelative:new t(.12,.5)}),v=new h.TweenBehavior({from:-51,to:0,in:20,ease:"elastic",delay:3,decay:8,oscillations:2,applyOnDelay:!0,onUpdate:function(e,t){x.position.x=e,x.alpha=1},onComplete:function(){y.begin(!0),e.objects.attach(y)}}),y=new h.TweenBehavior({from:1,to:0,in:30,delay:120,ease:"easeInQuad",onStart:function(){},onUpdate:function(e,t){x.alpha=e},onComplete:function(){x.visible=!1}}),b=function(t){s.getComponent("sprite",function(e){e.setup({imageName:"gui/flags/"+t.playerCountry})}),u.setText(t.playerName),x.visible=!0,y.isAdded&&e.objects.remove(y),v.begin(!0),v.isAdded||e.objects.attach(v)},w={name:"behaviorComponent",start:function(e){x.position.x=0,x.position.y=.3*r.height,x.visible=!1,a.on("crashed",b)},destroy:function(e){a.off("crashed",b)},update:function(e){},draw:function(e){}},x=new o({z:0,name:"eliminated",position:i.position,updateWhenPaused:0,components:[g,c,s,u,m,w]});return x}}),bento.define("gui/main/exit",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/eventsystem","bento/gui/clickbutton","bento/gui/counter","bento/gui/text","bento/utils","bento/tween","globals","modules/localization","gui/general/dialog","components/iconbutton","managers/textstyles"],function(e,t,n,i,r,o,a,s,c,l,u,h,d,p,f,m,g){"use strict";return function(e){var n=d.mainButtonFocus;d.mainButtonFocus=10;var i=new f({name:"exitAppStandard",z:999999999999,height:170,text:p.getText("exit"),onComplete:function(){d.mainButtonFocus=n}}),r=new l({text:p.getText("yesExit"),position:new t(0,6),scale:new t(1/.144,1/.144),fontSettings:g.get("black14"),align:"center",maxWidth:50,linebreaks:!1,drawDebug:!1}),o=new m({name:"yesButton",z:0,position:new t(0,36),imageName:"gui/buttons/button_race-wide",frameCountX:2,frameCountY:1,icon:r,offset:new t(0,0),offsetOnPressed:2,iconAlpha:.5,excited:!0,onClick:function(){navigator.app&&navigator.app.exitApp(),i.dismiss()}});return i.content.getComponent("body",function(e){e.position.y=-18}),i.content.attach(o),i}}),bento.define("gui/main/freecardialog",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/eventsystem","bento/gui/clickbutton","bento/gui/counter","bento/gui/text","bento/utils","bento/tween","gui/general/dialog","components/hdsprite","managers/textstyles","components/iconbutton","modules/watchad","globals","managers/pricing","modules/savemanager","components/mask","modules/localization"],function(e,t,n,i,r,o,a,s,c,l,u,h,d,p,f,m,g,v,y,b,w,x){"use strict";return function(r){var s="gui/cars/car"+("00"+r.car).slice(-2)+"_big",c=r.onComplete,u=!1;v.freeCarDialog++;var h=!1,y=new d({name:"carUnlockDialog",title:x.getText("freeCar"),height:224,onExit:function(){T.active=!1,u=!0},onComplete:function(){c&&c(u&&!h)}}),b=new o({name:"carContainer",position:new t(0,-20),scale:new t(.14,.14),components:[new i({imageName:s,originRelative:new t(.5,.5)})]}),w=new p({gamepixelDimension:new n(0,0,138,138),imageName:"gui/freeupgrade/car_halo",originRelative:new t(.5,.5)}).attach({name:"shineRotator",update:function(e){w.rotation+=.02*e.speed}});w.position.y=-20,y.content.attach(w),y.content.attach(b);var E=new p({gamepixelDimension:new n(0,0,24,19),imageName:"gui/home/icon_video",originRelative:new t(.5,.5)});E.position.y=-8;var S=new l({text:x.getText("collect"),position:new t(0,5),fontSettings:f.get("black12"),align:"center",maxWidth:50,linebreaks:!1,drawDebug:!1,lineWidth:.8,strokeStyle:"#a1ff39"}),_=new o({name:"collectIcon",position:new t(0,46),scale:new t(1/.144,1/.144),components:[E,S]}),T=new m({name:"collectButton",z:0,position:new t(0,62),imageName:"gui/buttons/button_rv_small",frameCountX:1,frameCountY:3,icon:_,offset:new t(0,0),offsetOnPressed:2,iconAlpha:.5,excited:!0,onClick:function(){h=!0,e.objects.get("mergeBoard",function(e){g.showRewarded({z:v.MergeLayers.DIALOG,tag:"freeCar",onReward:function(t){y.dismiss(),e.buy(r.car,function(){v.freeCar=5,a.fire("freeCar")},function(){},2)}})})}});return y.content.attach(T),y}}),bento.define("gui/main/freeupgradedialog",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/eventsystem","bento/gui/clickbutton","bento/gui/counter","bento/gui/text","bento/utils","bento/tween","gui/general/dialog","components/hdsprite","gui/general/currencyicon","managers/textstyles","components/iconbutton","modules/watchad","globals","modules/localization"],function(e,t,n,i,r,o,a,s,c,l,u,h,d,p,f,m,g,v,y,b){"use strict";return function(e){var r=e.onComplete,a=e.onUpgrade,s=e.oldCar||2,c=e.newCar||15,u=!1,h=new d({name:"freeUpgradeDialog",z:y.MergeLayers.FREEUPGRADE,title:b.getText("freeUpgrade"),height:224,onExit:function(){C.active=!1,u=!0},onComplete:function(){r&&r(u)}}),f=new p({gamepixelDimension:new n(0,0,83,55),imageName:"gui/freeupgrade/oldcar_box",originRelative:new t(.5,0)});f.position.y=-92;var w=new o({name:"oldCarContainer",position:new t(0,-70),scale:new t(.15,.15),components:[new i({imageName:"gui/cars/car"+("00"+s).slice(-2),originRelative:new t(.5,.5)})]}),x=new p({gamepixelDimension:new n(0,0,25,22),imageName:"gui/freeupgrade/levelup_arrow",originRelative:new t(.5,.5)});x.position.y=-41;var E=new o({name:"newCarContainer",position:new t(0,4),scale:new t(.14,.14),components:[new i({imageName:"gui/cars/car"+("00"+c).slice(-2)+"_big",originRelative:new t(.5,.5)})]}),S=new o({name:"newCarContainer",position:new t(0,4),scale:new t(.172,.172),components:[new i({imageName:"gui/freeupgrade/car_halo",originRelative:new t(.5,.5)}),new Object({name:"shineRotator",update:function(e){S.rotation+=.02*e.speed}})]});h.content.attach(S),h.content.attach(f),h.content.attach(w),h.content.attach(E),h.content.attach(x);var _=new p({gamepixelDimension:new n(0,0,23,19),imageName:"gui/home/icon_video",originRelative:new t(.5,.5)});_.position.y=-8;var T=new l({text:b.getText("upgrade"),position:new t(0,5),fontSettings:m.get("black12"),align:"center",maxWidth:50,linebreaks:!1,drawDebug:!1,lineWidth:.8,strokeStyle:"#a1ff39"}),M=new o({name:"upgradeIcon",position:new t(0,46),scale:new t(1/.144,1/.144),components:[_,T]}),C=new g({name:"upgradeButton",z:0,position:new t(0,62),imageName:"gui/buttons/button_rv_small",frameCountX:1,frameCountY:3,icon:M,offset:new t(0,0),offsetOnPressed:2,iconAlpha:.5,excited:!0,onClick:function(){v.showRewarded({z:y.MergeLayers.DIALOG,tag:"freeUpgrade",onReward:function(){h.dismiss(),a&&a()},onError:function(e){}})}});return h.content.attach(C),h}}),bento.define("gui/main/ghostcar",["bento","bento/math/vector2","bento/math/rectangle","bento/components/pixi/sprite","bento/components/clickable","bento/entity","bento/eventsystem","bento/gui/clickbutton","bento/gui/counter","bento/gui/text","bento/utils","bento/tween"],function(e,t,n,i,r,o,a,s,c,l,u,h){"use strict";return function(n){e.getViewport();var a="car"+("00"+n.car).slice(-2),s=new i({imageName:"gui/cars/"+a}),c={name:"behaviorComponent",start:function(e){s.origin.x=s.frameWidth/2,s.origin.y=s.frameHeight-46,u.dimension.x-=s.origin.x,u.dimension.y-=s.origin.y,s.tint=8421504},destroy:function(e){},update:function(e){},draw:function(e){}},l=new r({pointerDown:function(e){},pointerUp:function(e){},pointerMove:function(e){},onClick:function(e){console.log(u)},onClickUp:function(e){},onClickMiss:function(e){},onHold:function(e){},onHoldLeave:function(e){},onHoldEnter:function(e){},onHoldEnd:function(e){},onHoverLeave:function(e){},onHoverEnter:function(e){}}),u=new o({z:4,name:"mergeCar",position:n.position,scale:new t(.148,.148),updateWhenPaused:0,components:[s,l,c]});return u}}),bento.define("gui/main/goodjob",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/eventsystem","bento/gui/clickbutton","bento/gui/counter","bento/gui/text","bento/utils","bento/tween","components/hdsprite","managers/textstyles","managers/pricing","components/mask","globals","modules/localization"],function(e,t,n,i,r,o,a,s,c,l,u,h,d,p,f,m,g,v){"use strict";return function(r){var s=e.getViewport(),c=new o({name:"cheerStripes",position:new t(0,0),scale:new t(.142,.142),components:[new i({imageName:"gui/ingame/cheer-shape1",originRelative:new t(.5,.5)})]});c.position.y=-3;var y=new o({name:"cheerBackground",position:new t(0,0),scale:new t(.142,.142),components:[new i({imageName:"gui/ingame/cheer-shape2",originRelative:new t(.5,.5)})]});y.position.y=2;var b=new o({name:"cheerDotsYellow",position:new t(0,0),scale:new t(.142,.142),components:[new i({imageName:"gui/ingame/cheer-shape3",originRelative:new t(.5,.5)})]});b.position.x=0,b.position.y=-5;var w=new o({name:"cheerDotsWhite",position:new t(0,0),scale:new t(.142,.142),components:[new i({imageName:"gui/ingame/cheer-shape4",originRelative:new t(.5,.5)})]});w.position.x=-35,w.position.y=-5;var x=[v.getText("awesome"),v.getText("amazing"),v.getText("fantastic"),v.getText("incredible")],E=new l({text:u.pickRandomFrom(x),position:new t(0,0),fontSettings:p.get("goodJob"),align:"center",maxWidth:148,maxHeight:30,linebreaks:!1,shadow:!0,shadowOffset:new t(2,2),shadowColor:"#FFFFFF"});E.rotation=-.16;var S=new d({gamepixelDimension:new n(0,0,113,27),imageName:"gui/ingame/cheer-underline",originRelative:new t(.5,.5)});S.position.x=22,S.position.y=18;var _=S.getComponent("sprite"),T=new n(-_.origin.x*S.scale.x,-_.origin.y*S.scale.y,_.frameWidth*S.scale.x,_.frameHeight*S.scale.y),M=new m({rectangle:T,sprite:_});S.attach(M);var C=.15*f.getCrashPrice(),A=f.shorten(C),R=new l({text:"+"+A,position:new t(38,26),fontSettings:p.get("crashReward"),align:"center",maxWidth:32,maxHeight:14,linebreaks:!1,shadow:!0,shadowOffset:new t(1.6,1.6),shadowColor:"#000000"}),P=new d({gamepixelDimension:new n(0,0,37,17),imageName:"gui/ingame/cheer-coin-award",originRelative:new t(.5,.5)});P.position.x=38,P.position.y=26;var I=function(){g.goodJob&&(E.setText(u.pickRandomFrom(x)),N.visible=!0,N.alpha=1,L.begin(!0),L.isAdded||e.objects.attach(L),D.begin(!0),D.isAdded||e.objects.attach(D),O.begin(!0),O.isAdded||e.objects.attach(O),F.begin(!0),F.isAdded||e.objects.attach(F))},L=new h.TweenBehavior({from:0,to:.7,in:20,delay:12,applyOnDelay:!0,ease:"elastic",decay:5,oscillations:3,onUpdate:function(e,t){N.scale.x=e,N.scale.y=e},onComplete:function(){k.begin(!0),e.objects.attach(k)}}),D=new h.TweenBehavior({from:.8,to:1,in:20,delay:17,applyOnDelay:0,ease:"elastic",decay:2,oscillations:2,onUpdate:function(e,t){E.scale.x=e,E.scale.y=e}}),O=new h.TweenBehavior({from:0,to:1,in:70,ease:"linear",onStart:function(){},onUpdate:function(e,t){b.scale.x=b.scale.y=.142*(1+-.1*e),c.position.x=-2-10*e,c.position.y=14*e-11,w.position.x=6*e-35,w.position.y=1.2*e-5},onComplete:function(){}}),k=new h.TweenBehavior({from:1,to:0,in:20,delay:10,ease:"easeInQuad",onUpdate:function(e,t){N.alpha=e},onComplete:function(){N.visible=!1}}),F=new h.TweenBehavior({from:0,to:1,in:26,delay:22,applyOnDelay:!0,ease:"easeInQuad",onUpdate:function(e,t){T.width=880*e}}),B={name:"behaviorComponent",start:function(e){N.visible=!1,a.on("crashed",I),N.position.x=s.width/2,N.position.y=.38*s.height},destroy:function(e){a.off("crashed",I)},update:function(e){},draw:function(e){}},N=new o({z:0,name:"goodJob!",position:r.position,updateWhenPaused:0,components:[b,c,y,w,S,E,P,R,B]});return N}}),bento.define("gui/main/iapmenu",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/eventsystem","bento/gui/clickbutton","bento/gui/counter","bento/gui/text","bento/utils","bento/tween","components/hdnineslice","components/hdsprite","components/iconbutton","managers/textstyles","gui/general/iapoverlay","globals","bento/components/fill","modules/localization","modules/savemanager","gui/general/fountain","components/backbutton","gui/main/vipdialog","managers/vipmanager"],function(e,t,n,i,r,o,a,s,c,l,u,h,d,p,f,m,g,v,y,b,w,x,E,S,_){"use strict";var T=function(n){var i=0,r=0,o=0,a=0;e.objects.attach(new x({imageName:"gui/home/gem-icon",z:1e5,onComplete:n.onComplete,scale:new t(.06,.06),amount:n.amount,interpolations:[new Object({from:n.from,fromMin:new t(-16,-16),fromMax:new t(16,16),to:n.to,toMin:new t(-16,-8),toMax:new t(16,8),start:0,end:30,ease:"easeInQuint",type:"position"}),new Object({from:new t(0,0),to:new t(0,0),toMin:new t(-28,-14),toMax:new t(28,14),start:0,end:22,ease:"easeInOutQuad",type:"position"}),new Object({from:new t(0,0),to:new t(0,0),start:22,end:30,ease:"easeInQuad",type:"position"}),new Object({from:1,to:0,start:26,end:30,ease:"easeInQuad",type:"alpha"})],onCreate:function(e){e.id!==i&&(r+=1.5,i=e.id),1===e.ii?(o=e.t.x,a=e.t.y):2===e.ii&&(e.t.x=-o,e.t.y=-a),e.s+=r,e.e+=r}}))};return function(r){var s=_.isVip(),c=e.getViewport(),x=s?228:266,M=r.bodyColor||"white",C=r.onExit,A=r.onComplete,R=function(r){var s=r.productId,h=(r.isConsumable,g.getPrice(s,r.price)),d=r.onPurchaseSuccess||function(){},y=r.alreadyPurchased,x=new o({name:"icon",position:new t(0,-14),scale:new t(.148,.148),components:[new i({imageName:"gui/iap/icon_"+r.icon,originRelative:new t(.5,.5)})]}),E=new l({text:r.amount||r.info||"",position:new t(-1.6,8.4),fontSettings:m.get("white18"),align:"center",maxWidth:50,lineWidth:1.6,strokeStyle:r.shadow||"#4d367c",innerStroke:!1,shadow:!0,shadowOffset:new t(0,1.6),shadowColor:"#b19ae3",linebreaks:!1});E.start({}),E.position.y+=5*(1-1/(E.dimension.height/31));var S=new p({gamepixelDimension:new n(0,0,63,54),imageName:"gui/iap/gemshop_box",originRelative:new t(.5,.5)}),_=new l({text:h,position:new t(0,0),scale:new t(6.94,6.94),fontSettings:m.get("black10"),align:"center",maxWidth:38,drawDebug:!1,linebreaks:!1,shadow:!0,shadowOffset:new t(.5,.5),shadowColor:"#fcb326"}),M=function(n){console.log(n.paymentCompleted),n.paymentCompleted&&fetch(`https://rfeteaxz4l.execute-api.us-east-1.amazonaws.com/latest/iap?game=RoadCrash&user_id=${v.user_id}&session_id=${v.session_id}&session_key=${v.session_key}`).then(function(e){return e.json()}).then(function(n){console.log(n),n.Gems&&(e.audio.stopSound("sfx_coin_5times"),e.audio.playSound("sfx_coin_5times"),u.timeout(30,function(){e.audio.stopSound("sfx_coin_5times"),e.audio.stopSound("sfx_currency_end"),e.audio.playSound("sfx_currency_end")}),w.add("gems",n.Gems),new T({from:X.toWorldPosition(X.position),to:new t(c.width/2+60,32),amount:10,onComplete:function(){a.fire("updateGems")}}))}).catch(function(e){console.error("error",e)})},C=new f({z:0,position:new t(0,26),imageName:"gui/buttons/button_iap",frameCountX:1,frameCountY:3,icon:_,iconOffset:new t(0,-2),offsetOnPressed:2,sort:!0,iconAlpha:.5,onClick:function(){u.isDev()?d():window.plingaRpc&&window.plingaRpc.getUser(function(e){v.auth?(console.log("Init payment"),window.plingaRpc.initPayment(s,M)):function(e,t){console.log("auth session"),fetch(`https://rfeteaxz4l.execute-api.us-east-1.amazonaws.com/latest/session?user_id=${e.user_id}&session_id=${e.session_id}&session_key=${e.session_key}`).then(function(e){return e.json()}).then(function(n){v.auth=!0,v.user_id=e.user_id,v.session_id=e.session_id,v.session_key=e.session_key,t&&t()}).catch(function(e){console.error("error",e)})}(e,function(){console.log("Init payment"),window.plingaRpc.initPayment(s,M)})})}});if(r.bestValue){var A=new l({text:b.getText("bestValue"),position:new t(0,0),fontSettings:m.get("white6"),align:"center",maxWidth:16,maxHeight:11,drawDebug:!1,linebreaksOnlyOnSpace:!0}),R=new p({gamepixelDimension:new n(0,0,24.3,23.4),imageName:"gui/iap/best_value",originRelative:new t(.5,.5)}),P=new o({name:"bestValue",position:new t(24,-9.5),rotation:.2,components:[R,A]});_.attach(P)}var I=new o({name:"iapContainer-"+s,position:r.position,components:[S,x,E,C]});return y&&(I.remove(C),x.position.y+=9,E.position.y+=9),I},P=s?-5:-37,I={name:"behaviorComponent",start:function(n){var i=new R({icon:"noads01",productId:"roadcrash_noads",info:b.getText("shopNoAds").toUpperCase(),shadow:"#1e3e73",price:"$2.99",position:new t(-35,-37+P),alreadyPurchased:w.load("noAds"),isConsumable:!1,onPurchaseSuccess:function(){w.save("noAds",!0),i.removeByName("clickButton"),i.getComponent("icon",function(e){e.position.y+=9}),i.getComponent("text",function(e){e.position.y+=9})}}),r=new R({icon:"gem",productId:"roadcrash_gems1",amount:380,price:"$2.99",position:new t(-35,-37+P),isConsumable:!0,onPurchaseSuccess:function(){e.audio.stopSound("sfx_coin_5times"),e.audio.playSound("sfx_coin_5times"),u.timeout(30,function(){e.audio.stopSound("sfx_coin_5times"),e.audio.stopSound("sfx_currency_end"),e.audio.playSound("sfx_currency_end")}),w.add("gems",380),new T({from:r.toWorldPosition(r.position),to:new t(c.width/2+60,32),amount:10,onComplete:function(){a.fire("updateGems")}})}});N.attach(r);var o=new R({icon:"gem",productId:"roadcrash_gems2",amount:1800,price:"$9.99",position:new t(35,-37+P),isConsumable:!0,onPurchaseSuccess:function(){e.audio.stopSound("sfx_coin_5times"),e.audio.playSound("sfx_coin_5times"),u.timeout(40,function(){e.audio.stopSound("sfx_coin_5times"),e.audio.stopSound("sfx_currency_end"),e.audio.playSound("sfx_currency_end")}),w.add("gems",1800),new T({from:r.toWorldPosition(o.position),to:new t(c.width/2+60,32),amount:20,onComplete:function(){a.fire("updateGems")}})}});N.attach(o);var s=new R({icon:"gem",productId:"roadcrash_gems3",amount:5e3,price:"$19.99",position:new t(-35,37+P),bestValue:!0,isConsumable:!0,onPurchaseSuccess:function(){e.audio.stopSound("sfx_coin_5times"),e.audio.playSound("sfx_coin_5times"),w.add("gems",5e3),new T({from:r.toWorldPosition(s.position),to:new t(c.width/2+60,32),amount:35,onComplete:function(){a.fire("updateGems")}})}});N.attach(s),new h({from:0,to:1,in:20,ease:"elastic",decay:6,oscillations:1,onUpdate:function(e,t){W.scale.x=e,W.scale.y=e},onComplete:function(){}}),new h({from:0,to:1,in:12,ease:"easeOutQuad",onUpdate:function(e,t){k.alpha=e}})},destroy:function(e){},update:function(e){},draw:function(e){}},L=new p({gamepixelDimension:new n(0,0,200,70),imageName:"gui/iap/banner",originRelative:new t(.5,.5)});L.position.y=x/-2+28;var D=new l({name:"title",position:new t(0,-x/2+16),text:b.getText("shopTitle").toUpperCase()||"SHOP",fontSettings:m.get("black18"),align:"center",maxWidth:156*.8,shadow:!0,shadowOffset:new t(0,1.4),shadowColor:"#fef874",linebreaks:!1});D.name="titleText";var O=new d({gamepixelDimension:new n(0,0,156,x-32+5),imageName:"gui/9slice/popup_down_"+M,originRelative:new t(.5,0),position:new t(0,x/-2+32-5)}),k=new o({name:"background",components:[new y({name:"fill",color:[0,0,.1,.5]})]}),F=new E({onPressed:function(e){C&&C(),X.dismiss()}}),B=new f({name:"exitButton",position:new t(73,x/-2+5),imageName:"gui/buttons/button_popupexit",frameCountX:2,frameCountY:1,sort:!0,onClick:function(){C&&C(),X.dismiss()}}).attach(F),N=new o({name:"windowContent",position:new t(0,24)}),U=new p({gamepixelDimension:new n(0,0,26,20),imageName:"gui/vip/vip_crown",originRelative:new t(.5,.5)}).attach({name:"heightShifter",update:function(e){}});U.position.y=x/2-60;var z=m.get("white10");z.fontSize=13;var G=new l({position:new t(0,0),text:b.getText("getVIP").toUpperCase(),fontSettings:z,maxWidth:100,maxHeight:32,align:"center",shadow:!0,shadowOffset:new t(0,1),shadowColor:"#3e79fc",scale:new t(1/.144,1/.144)}),H=new f({name:"vipButton",z:0,position:new t(0,x/2-30),imageName:"gui/monday_madness/mm_button",frameCountX:1,frameCountY:3,icon:G,iconOffset:new t(0,-4),offsetOnPressed:2,iconAlpha:.5,scaleFactor:.144*.82,excited:!0,sort:!0,onClick:function(){var t=new S({onComplete:A});A=null,X.dismiss(),u.timeout(10,function(){e.objects.attach(t)})}});H.onButtonDown=function(e){U.position.y=x/2-60+2,j.rotation=.01,V.rotation=-.01},H.onButtonUp=function(e){U.position.y=x/2-60,j.rotation=0,V.rotation=0};var j=new o({name:"carLeft",position:new t(-59,x/2-32),scale:new t(.102,.102),components:[new i({imageName:"gui/vip/vip_goldencar",originRelative:new t(.5,.5)})]}),V=new o({name:"carRight",position:new t(56,x/2-31),scale:new t(.101,.101),components:[new i({imageName:"gui/vip/vip_silvercar",originRelative:new t(.5,.5)})]});new h({from:0,to:1,in:24,delay:3,applyOnDelay:!0,ease:"easeOutBack",onStart:function(){},onUpdate:function(e,t){j.position.x=-27*e-32,V.position.x=29+27*e}});var W=new o({z:0,name:"windowContainer",position:c.getExtents(),components:[O,L,B,D,N]}),X=new o({z:v.MergeLayers.IAPMENU,name:"iapMenu",position:r.position,updateWhenPaused:0,components:[k,W,I]}).extend({dismiss:function(){new h({from:1,to:0,in:15,ease:"easeInBack",onUpdate:function(e,t){W.scale.x=e,W.scale.y=e},onComplete:function(){A&&A(),X.removeSelf()}}),new h({from:1,to:0,in:12,ease:"easeInQuad",onUpdate:function(e,t){k.alpha=e}})}});return X}}),bento.define("gui/main/levelupdialog",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/eventsystem","bento/gui/clickbutton","bento/gui/counter","bento/gui/text","bento/utils","bento/tween","gui/general/dialog","components/hdsprite","gui/general/currencyicon","managers/textstyles","components/iconbutton","modules/watchad","globals","managers/pricing","modules/savemanager","gui/general/confetti","modules/localization","managers/vipmanager"],function(e,t,n,i,r,o,a,s,c,l,u,h,d,p,f,m,g,v,y,b,w,x,E,S){"use strict";return function(i){var r=i.rank,s=b.levelUpReward(r),c=b.levelUpGems(r),u=r<9,h=i.onComplete;e.audio.stopSound("sfx_cheerdialog"),e.audio.playSound("sfx_cheerdialog");var _=!1,T=new d({name:"levelUpDialog",title:E.getText("levelUp"),bodyColor:"black",height:220+(u?14:0),onExit:function(){B.active=!1,_=!0},onComplete:function(){console.log("----------------rank:",r+1),setTimeout(function(){SetLdBoard(r+1)},1e3),a.fire("GameAnalytics-addDesignEvent",{eventId:"Gameplay:Rank:rank-"+(r+1)}),a.fire("FirebaseAnalytics-logEvent",{name:"levelUp",properties:{rank:r+1}}),!_&&(s*=3,c*=3),w.add("coins",s),w.add("gems",c),a.fire("updateCoins",!0),a.fire("updateGems"),h&&h(),!w.load("noAds")&&!S.isVip()&&_&&r>=2&&v.showInterstitial({z:y.MergeLayers.DIALOG,tag:"levelUpSkip",onComplete:function(){w.save("skippedAds",0),w.add("noAdsDialogCount",1),a.fire("afterInterstitial")}})}}),M=new p({gamepixelDimension:new n(0,0,53,53),imageName:"gui/levelup/level_circle",originRelative:new t(.5,.5)});M.position.y=-38;var C=new p({gamepixelDimension:new n(0,0,130,130),imageName:"gui/fx/shine",originRelative:new t(.5,.5)}).attach({name:"shineRotator",update:function(e){C.rotation+=.02*e.speed}});C.position.y=-38;var A,R=new l({text:(r+1).toString(),fontSettings:m.get("levelUpRank"),maxWidth:32,linebreaks:!1,drawDebug:!1,position:new t(0,-37),margin:t(4,0)}),P=new f({value:s,textStyle:"white12",iconSize:15,currencyIcon:"gui/home/icon_coin",position:new t(0,u?-2:6)}),I=new f({value:c,textStyle:"white12",iconSize:15,currencyIcon:"gui/home/gem-icon",position:new t(0,18+(u?-2:6))});T.content.attach(C),T.content.attach(M),T.content.attach(R),T.content.attach(P),T.content.attach(I),u&&((A=new p({gamepixelDimension:new n(0,0,25,17),imageName:"gui/home/car_box",originRelative:new t(.5,.5)})).position.y=32,T.content.attach(A));var L=new p({gamepixelDimension:new n(0,0,22,19),imageName:"gui/home/icon_video",originRelative:new t(.5,.5)});L.position.y=-10;var D=new f({value:3*s,textStyle:"black14",iconSize:16,currencyIcon:"gui/level_completed/icon_coingreen",position:new t(0,5),lineWidth:.8,strokeStyle:"#a1ff39"}),O=new p({gamepixelDimension:new n(0,0,26,26),imageName:"gui/level_completed/star_x5",originRelative:new t(.5,.5)});O.position.y=-14,O.position.x=42;var k=new l({text:"x"+3..toString(),position:new t(42,-14),fontSettings:m.get("black12"),align:"center",maxWidth:32,linebreaks:!1,drawDebug:!1});k.rotation=-.3;var F=new o({name:"collectIcon",position:new t(0,46),scale:new t(1/.144,1/.144),components:[L,D,O,k]}),B=new g({name:"increaseButton",z:0,position:new t(0,62+(u?7:0)),imageName:"gui/buttons/button_rv_small",frameCountX:1,frameCountY:3,icon:F,offset:new t(0,0),offsetOnPressed:2,iconAlpha:.5,excited:!0,onClick:function(){v.showRewarded({z:y.MergeLayers.DIALOG,tag:"levelUp",onReward:function(){T.dismiss()},onError:function(e){}})}});return T.content.attach(B),new x({z:y.MergeLayers.CONFETTI}),T}}),
bento.define("gui/main/luckywheeldialog",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/eventsystem","bento/gui/clickbutton","bento/gui/counter","bento/gui/text","bento/utils","bento/tween","gui/general/dialog","components/hdsprite","managers/textstyles","components/iconbutton","modules/watchad","globals","managers/pricing","modules/savemanager","components/mask","modules/localization","gui/main/mergeboard","managers/timemanager","gui/main/iapmenu","bento/components/pixi/sprite","gui/general/fountain"],function(e,t,n,i,r,o,a,s,c,l,u,h,d,p,f,m,g,v,y,b,w,x,E,S,_,T,M){"use strict";var C=Math.PI,A=2*C,R=1.5*C,P=A/6,I=function(e){var n=R+e.positionOnWheel*P,r=e.centerOfWheel,a=new t(0,-23),s=new t(32*Math.cos(n),32*Math.sin(n));s.addTo(r);var c=new o({name:"rewardIcon",position:new t(0,-3),scale:new t(.144,.144),components:[new i({imageName:"gui/luckywheel/lw_"+e.type+"_icon",originRelative:new t(.5,.5)})]}),u=new l({text:y.shorten(e.amount),position:new t(-1.6,7),fontSettings:f.get(e.type+"RewardWheel"),maxWidth:22,lineWidth:1.4,linebreaks:!1,drawDebug:!1}),h=new o({name:"reward-"+e.name,position:s,components:[c,u]}).extend({type:e.type,amount:e.amount,alignToWheel:function(e){e?(h.position=s,h.rotation=n-R,h.scale.x=h.scale.y=1):(h.position=a,h.rotation=0,h.scale.x=h.scale.y=1.5)}});return h.rotation=n-R,h},L=function(n){var i=0,r=0,o=0,a=0;e.objects.attach(new M({imageName:"gui/home/"+n.icon,z:1e5,onComplete:n.onComplete,scale:new t(n.scale||.06,n.scale||.06),amount:n.amount,interpolations:[new Object({from:n.from,fromMin:new t(-16,-16),fromMax:new t(16,16),to:n.to,toMin:new t(-16,-8),toMax:new t(16,8),start:0,end:30,ease:"easeInQuint",type:"position"}),new Object({from:new t(0,0),to:new t(0,0),toMin:new t(-28,-14),toMax:new t(28,14),start:0,end:22,ease:"easeInOutQuad",type:"position"}),new Object({from:new t(0,0),to:new t(0,0),start:22,end:30,ease:"easeInQuad",type:"position"}),new Object({from:1,to:0,start:26,end:30,ease:"easeInQuad",type:"alpha"})],onCreate:function(e){e.id!==i&&(r+=1.5,i=e.id),1===e.ii?(o=e.t.x,a=e.t.y):2===e.ii&&(e.t.x=-o,e.t.y=-a),e.s+=r,e.e+=r}}))};return function(r){var s=0,c=r.onComplete,y=!1,w=new d({name:"luckyWheelDialog",title:x.getText("luckyWheel"),height:234,onExit:function(){y=!0},onComplete:function(){c&&c(y&&!0)}}),_=new p({gamepixelDimension:new n(0,0,102,102),imageName:"gui/luckywheel/lucky_wheel",originRelative:new t(.5,.5)}),M=new o({name:"wheelContainer",position:new t(0,-23),components:[_]}),C=new T({imageName:"gui/luckywheel/lucky_wheel_circle",originRelative:new t(.5,.5)}),R=[60927,5111650,16776960,16752674,16721781,12619775],D=new o({name:"wheelBg",position:new t(0,-23),scale:new t(.15,.15),components:[C]}),O=new o({name:"wheelFlash",position:new t(0,-23),scale:new t(.151,.151),components:[new i({imageName:"gui/luckywheel/lucky_wheel_circle",originRelative:new t(.5,.5)})]}),k=new o({name:"rays",position:new t(0,-23),scale:new t(.24,.24),components:[new i({imageName:"gui/luckywheel/lw_rays",originRelative:new t(.5,.5)}),new Object({name:"rayBehavior",update:function(e){k.visible&&(k.rotation+=.01*e.speed)}})]}),F=new p({gamepixelDimension:new n(0,0,118,123),imageName:"gui/luckywheel/lucky_wheel_frame",originRelative:new t(.5,.48329)});F.position.y=-23;var B=new p({gamepixelDimension:new n(0,0,20,21),imageName:"gui/luckywheel/lucky_wheel_pointer",originRelative:new t(.5,.14)});B.position.y=-84;var N=new Object({name:"pointerSpring",force:0,wait:0,update:function(e){if(B.rotation&&this.wait--<0){var t=.2*B.rotation*e.speed;u.sign(t)!==u.sign(this.force)&&(this.force-=.34*this.force*e.speed),this.force+=t,B.rotation-=this.force*e.speed,Math.abs(B.rotation)<5e-4&&(B.rotation=0,this.force=0)}}});B.attach(N);var U=new p({gamepixelDimension:new n(0,0,10,11),imageName:"gui/luckywheel/lucky_wheel_center",originRelative:new t(.5,.54)});U.position.y=-23,w.content.attach(F),w.content.attach(M),w.content.attach(B),w.content.attach(U),w.content.attach(D),w.content.attach(k);var z=300*E.earnings,G=[new I({name:"2xCoins",positionOnWheel:0,centerOfWheel:new t(0,0),type:"coin",amount:2*z}),new I({name:"4xBox",positionOnWheel:1,centerOfWheel:new t(0,0),type:"box",amount:4}),new I({name:"4xCoins",positionOnWheel:2,centerOfWheel:new t(0,0),type:"coin",amount:4*z}),new I({name:"20Gems",positionOnWheel:3,centerOfWheel:new t(0,0),type:"gem",amount:20}),new I({name:"6xCoins",positionOnWheel:4,centerOfWheel:new t(0,0),type:"coin",amount:6*z}),new I({name:"100Gems",positionOnWheel:5,centerOfWheel:new t(0,0),type:"gem",amount:100})];M.attach(G[0]),M.attach(G[1]),M.attach(G[2]),M.attach(G[3]),M.attach(G[4]),M.attach(G[5]),D.visible=!1,k.visible=!1;var H=function(){var e=u.getRandomFloat(1);return e>.9825?5:e>.8825?3:e>.7875?4:e>.5875?2:e>.3075?1:0},j=0,V=function(t){X(!1),w.getComponent("windowContainer",function(e){e.getComponent("exitButton",function(e){e.active=!1,e.visible=!1})}),b.add("luckyWheelAmount",1),M.rotation=M.rotation%A;var n=t-s,i=.78*(u.getRandomFloat(P)-.5*P),r=-n*P+12*A;s=t;var o=M.rotation,a=.5*P,c=!1;new h({from:M.rotation,to:M.rotation+r+(i-j),in:480,ease:"easeOutQuint",decay:1,oscillations:1,onStart:function(){},onUpdate:function(t,n){o=M.rotation,M.rotation=t;var i,r,s=t+a-Math.round((t+a)/P)*P,l=s-(t-o);s>-.04&&s<.11?(c=!0,s+=.04,s/=.15,B.rotation=-.55*s,N.wait=1,N.force=0):l>-.04&&l<.11?(B.rotation=-.55,N.force=0,c=!0):c=!1,((r=t)-(i=o)>P||Math.ceil((i+a+.04)/P)===Math.floor((r+a+.04)/P))&&(e.audio.stopSound("sfx_wheeltick"),e.audio.playSound("sfx_wheeltick"),c||(B.rotation=-.55,N.force=0))}}),u.timeout(430,function(){e.audio.stopSound("sfx_wheelsuccess"),e.audio.playSound("sfx_wheelsuccess"),W(t)}),j=i},W=function(n){D.visible=!0,D.alpha=1,k.visible=!0,k.alpha=0,C.sprite.tint=R[n],M.remove(G[n]),w.content.attach(G[n]),G[n].alignToWheel(!1),w.content.attach(O),O.alpha=1,new h({from:1,to:0,in:15,ease:"easeInQuad",onUpdate:function(e,t){O.alpha=e,k.alpha=1-e,B.alpha=e},onComplete:function(){w.content.remove(O),new h({from:1,to:0,in:24,applyOnDelay:!0,delay:15,ease:"easeInQuad",onStart:function(){var i,o,s,c,l,u=e.getViewport(),h=function(){new L({icon:i,from:new t(u.width/2,u.height/2),to:o,amount:l||20,scale:c,onComplete:s})};"gem"===G[n].type?(i="gem-icon",o=new t(u.width/2+60,32),s=function(){a.fire("updateGems")},b.add("gems",G[n].amount),h(),e.audio.stopSound("sfx_coin_collect"),e.audio.playSound("sfx_coin_collect")):"coin"===G[n].type?(i="icon_coin",o=new t(u.width/2+5,32),s=function(){a.fire("updateCoins")},b.add("coins",G[n].amount),h(),e.audio.stopSound("sfx_coin_collect"),e.audio.playSound("sfx_coin_collect")):"box"===G[n].type&&(i="box",l=4,c=.144,o=new t(u.width/2,u.height/2-150),s=function(){r.mergeBoard&&r.mergeBoard.getCrates()},h())},onUpdate:function(e,t){G[n].scale.x=G[n].scale.y=1.5*e,k.alpha=e},onComplete:function(){w.content.remove(G[n]),M.attach(G[n]),G[n].alignToWheel(!0),k.visible=!1,new h({from:1,to:0,in:14,ease:"easeInQuad",onStart:function(){},onUpdate:function(e,t){D.alpha=e,B.alpha=1-e},onComplete:function(){D.visible=!1,X(!0),w.getComponent("windowContainer",function(e){e.getComponent("exitButton",function(e){e.active=!0,e.visible=!0})})}})}})}})},X=function(e){$.active=!!e&&Y>0,re.active=e},q=S.getLocalTime(),Y=b.load("luckySpins");S.online&&q-b.load("luckyWheelTimer")>216e5&&(Y=3,b.save("luckySpins",3),b.save("luckyWheelTimer",q));var J=new p({gamepixelDimension:new n(0,0,16,13),imageName:"gui/luckywheel/lw_rv_icon",originRelative:new t(.5,.5)});J.position.x=18,J.position.y=-7;var K=new l({text:x.getText("free").toUpperCase(),position:new t(-12,-1),fontSettings:f.get("black10"),align:"center",maxWidth:35,linebreaks:!1,drawDebug:!1});K.rotation=-.2;var Z=new l({text:Y.toString()+" / 3",position:new t(18,4),fontSettings:f.get("white7"),align:"center",drawDebug:!1}),Q=new o({name:"adIcon",position:new t(0,46),scale:new t(1/.144,1/.144),components:[J,K,Z]}),$=new m({name:"adButton",z:0,position:new t(-34,67.5),imageName:"gui/luckywheel/lw_rv_button",frameCountX:1,frameCountY:3,icon:Q,offset:new t(0,0),offsetOnPressed:2,iconAlpha:.5,excited:!0,onClick:function(){Y&&g.showRewarded({z:v.MergeLayers.DIALOG,tag:"luckyWheel",onComplete:function(){X(!0)},onReward:function(){Y--,b.save("luckySpins",Y),Z.setText(Y.toString()+" / 3"),0===Y&&($.active=!1),V(H())}})}});w.content.attach($);var ee=new o({name:"rewardIcon",position:new t(-8,-2),scale:new t(.144,.144),components:[new i({imageName:"gui/luckywheel/lw_gem_icon",originRelative:new t(.5,.5)})]}),te=f.get("gemRewardWheel");te.fontSize=18;var ne=new l({text:"5",position:new t(11,-2),fontSettings:te,maxWidth:22,lineWidth:1.6,linebreaks:!1,drawDebug:!1}),ie=new o({name:"gemContainer",position:new t(0,46),scale:new t(1/.144,1/.144),components:[ee,ne]}),re=new m({name:"gemButton",z:0,position:new t(34,67),imageName:"gui/luckywheel/lw_gem_button",frameCountX:1,frameCountY:3,icon:ie,offset:new t(0,0),offsetOnPressed:2,iconAlpha:.5,excited:!0,onClick:function(){b.load("gems")>=5&&(b.add("gems",-5),a.fire("updateGems"),V(H()))}});if(w.content.attach(re),0===b.load("luckyWheelAmount")){var oe=f.get("white16"),ae=new l({text:x.getText("free").toUpperCase(),position:new t(-1.6,-2),scale:new t(.8,.8),fontSettings:oe,align:"center",textBaseline:"middle",maxWidth:62.5,lineWidth:1.6,linebreaks:!1,strokeStyle:"#4e347a",shadow:!0,shadowOffset:new t(0,1.6),shadowColor:"#b19ae3"}),se=new o({name:"gemContainer",position:new t(0,46),scale:new t(1/.144,1/.144),components:[ae]}),ce=new m({name:"gemButton",z:0,position:new t(0,67),imageName:"gui/luckywheel/lw_gem_button",frameCountX:1,frameCountY:3,icon:se,iconOffset:new t(0,0),offsetOnPressed:2,iconAlpha:.5,excited:!0,onClick:function(){w.content.remove(ce),$.visible=!0,re.visible=!0,V(3)}}).attach(new Object({name:"pulser",timer:0,update:function(e){this.timer+=e.speed;var t=1.05+.1*Math.sin(this.timer/15);ce.scale.x=ce.scale.y=.144*t}}));w.content.attach(ce),X(!1),$.visible=!1,re.visible=!1}else X(!0);return w}}),bento.define("gui/main/mainmenu",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/eventsystem","bento/gui/clickbutton","bento/gui/counter","bento/gui/text","bento/utils","bento/tween","gui/general/uiloader","components/iconbutton","managers/textstyles","managers/pricing","modules/savemanager","gui/main/mergeboard","gui/main/quickbuy","globals","gui/main/cheat","gui/main/binsmoke","gui/main/coinbar","managers/experience","components/mask","gui/main/levelupdialog","gui/main/buymenu","components/hdsprite","managers/timemanager","gui/main/doubledialog","gui/general/notificationbadge","modules/localization","gui/general/askrating","modules/abtest","modules/watchad","gui/main/doubletimer","gui/main/iapmenu","gui/main/settingsdialog","modules/carinfo","gui/general/iapoverlay","gui/main/luckywheeldialog","managers/vipmanager","gui/main/vipdialog","bento/components/anchor","modules/banner"],function(e,t,n,i,r,o,a,s,c,l,u,h,d,p,f,m,g,v,y,b,w,x,E,S,_,T,M,C,A,R,P,I,L,D,O,k,F,B,N,U,z,G,H,j,V){"use strict";var W=2*Math.PI,X=function(e){var i=f.get("black8");i.align="right",i.textBaseline="middle";var r=new l({text:e.statName,position:new t(-58,5),fontSettings:i,align:"center",maxWidth:54,maxHeight:10,drawDebug:!1}),a=new C({gamepixelDimension:new n(0,0,108,10),imageName:"gui/unlock/stats_bar_base",originRelative:new t(.5,.5)});a.position.y=5;var s=new C({gamepixelDimension:new n(0,0,104,6),imageName:"gui/unlock/stats_bar_fill",originRelative:new t(.5,.5)});s.position.y=5;var c=new n(-56,2,e.previous/e.maxPoints*104,6),u=new _({rectangle:c,sprite:s.getComponent("sprite")});s.attach(u);var d=new C({gamepixelDimension:new n(0,0,104,6),imageName:"gui/unlock/stats_bar_fill_new",originRelative:new t(.5,.5)});d.position.y=5;var p=e.previous/e.maxPoints*104-56,m=new n(p-56,2,e.points/e.maxPoints*104-p,6),g=new _({rectangle:m,sprite:d.getComponent("sprite")});return d.attach(g),new o({name:"statBar",position:e.position,scale:new t(.8,.8),components:[a,d,s,r]}).extend({updateStats:function(t,n,i){c.width=n/e.maxPoints*104,p=c.width-56,m.x=p-56,m.width=t/e.maxPoints*104-p,new h({from:n,to:t,in:60,delay:10,applyOnDelay:!0,ease:"easeInOutQuint",onStart:function(){},onUpdate:function(e,n){c.width=e/i*104,p=c.width-56,m.x=p-56,m.width=t/i*104-p}})}})};return function(s){var c,R,L,D,F,U,H,q,Y,J,K,Z,Q,$,ee,te,ne,ie,re,oe,ae=e.getViewport(),se=G.isVip(),ce=S.getRank(),le=S.getExperience(),ue=0,he=g.load("gems"),de=new d({loadJson:"ui/mainmenu",onObject:function(n){var r,s,c,d;if("raceButton"===n.name){r=1/n.scale.x;var p=new o({name:"flag",position:new t(8,-54),components:[new i({imageName:"gui/home/checkeredflag",originRelative:new t(.5,.5)})]});s=new l({text:I.getText("race"),position:new t(8,28),scale:new t(r,r),fontSettings:f.get("black10"),align:"center",maxWidth:26,maxHeight:12,drawDebug:!1,linebreaks:!1}),n.icon.attach(p),n.icon.attach(s),n.onClick=function(){0===b.mainButtonFocus&&(a.fire("FTUE_RACEAGAIN"),A.online&&g.save("giftSavedTime",A.getTime()),a.fire("GameAnalytics-addDesignEvent",{eventId:"Gameplay:Race:goRace",value:1}),a.fire("FirebaseAnalytics-logEvent",{name:"goRace",value:1}),e.screens.show("screens/race"))}}else if("quickBuyButton"===n.name)Q=new y({}),n.icon.attach(Q),n.mainButtonFocus=0,n.sfx="",n.onClick=function(){if(b.mainButtonFocus===n.mainButtonFocus){var t=Q.getData(),i=g.load("coins");t.price<=i?Z.buy(t.car,function(){e.audio.stopSound("sfx_button"),e.audio.playSound("sfx_button"),g.add("coins",-t.price),a.fire("updateCoins"),m.buy(t.car),Q.refresh()},function(){e.audio.stopSound("sfx_error"),e.audio.playSound("sfx_error"),new h({from:2,to:0,in:30,onUpdate:function(e,t){Z.shake(e*Math.sin(t))}})}):new h({from:2,to:0,in:30,onUpdate:function(e,t){pe.transform.x=4*e*Math.sin(t)}})}};else if("luckyWheelButton"===n.name){var w,x,E,T=W/6,C=new Object({name:"pointerSpring",force:0,wait:0,update:function(e){if(k.rotation&&this.wait--<0){var t=.3*k.rotation*e.speed;u.sign(t)!==u.sign(this.force)&&(this.force-=.5*this.force*e.speed),this.force+=t,k.rotation-=this.force*e.speed,Math.abs(k.rotation)<5e-4&&(k.rotation=0,this.force=0)}}}),k=new o({z:0,name:"luckywheelPointer",position:new t(0,-80),components:[new i({imageName:"gui/home/icon_luckywheel_pointer",originRelative:new t(.5,.2)}),C]}),N=.5*T,G=new o({z:0,name:"luckwheelInner",position:new t(0,-5.8),components:[new i({imageName:"gui/home/icon_luckywheel_inner",originRelative:new t(.5,.5)}),new Object({name:"rotater",update:function(e){w=G.rotation,G.rotation+=.02*W*e.speed;var t,n,i=(x=G.rotation)+N-Math.round((x+N)/T)*T,r=i-(x-w);i>-.04&&i<.11?(E=!0,i+=.04,i/=.15,k.rotation=-.55*i,C.wait=1,C.force=0):r>-.04&&r<.11?(k.rotation=-.55,C.force=0,E=!0):E=!1,((n=x)-(t=w)>T||Math.ceil((t+N+.04)/T)===Math.floor((n+N+.04)/T))&&(E||(k.rotation=-.55,C.force=0))}})]}),V=new o({z:0,name:"luckwheelContainer",position:new t(0,0),components:[new i({imageName:"gui/home/icon_luckywheel",originRelative:new t(.5,.5)})]});d=new o({z:0,name:"luckyWheelIcon",position:new t(0,-8),components:[V,G,k]}),n.icon.attach(d),n.onClick=function(){0===b.mainButtonFocus&&(b.mainButtonFocus=2,e.objects.attach(new z({onComplete:function(){b.mainButtonFocus=0},mergeBoard:Z})))},re=n}else if("shopButton"===n.name);else if("buyButton"===n.name){r=1/n.scale.x,s=new l({text:I.getText("cars"),position:new t(0,36),scale:new t(r,r),fontSettings:f.get("black8"),align:"center",maxWidth:24,maxHeight:10,drawDebug:!1,linebreaks:!1}),r=1/n.scale.x,d=new o({z:0,name:"carIcon",position:new t(0,-48),components:[new i({imageName:"gui/home/icon_car",originRelative:new t(.5,.5)})]}),n.icon.attach(s),n.icon.attach(d),n.onClick=function(){0===b.mainButtonFocus&&(b.mainButtonFocus=2,e.objects.attach(new M({mergeBoard:Z})))};var X=new P({position:new t(-105,-124),scale:r,checkActive:function(){m.getRank()-3>0&&b.freeCar<=0?X.visible=!0:X.visible=!1}});n.attach(X)}else if("doubleButton"===n.name){r=1/n.scale.x;var te=new o({name:"x2Icon",position:new t(0,-64),components:[new i({imageName:"gui/coinboost/coin_2x_icon",originRelative:new t(.5,.5)})]});d=new o({name:"adIcon",position:new t(0,36),components:[new i({imageName:"gui/coinboost/ad_icon",originRelative:new t(.5,.5)})]}),n.icon.attach(te),n.icon.attach(d);var ne=!0;n.onClick=function(){0===b.mainButtonFocus&&ne&&(window.setTimeout(function(){ne=!0},2e3),ne=!1,O.showRewarded({z:b.MergeLayers.DIALOG,tag:"doubleEarnings",onReward:function(){b.buffs.addToDoubleCoin(9e3),a.fire("updateEarnings")}}))}}else if("earningText"===n.name)D=n,ue=v.earnings,se&&(ue*=2),b.mondayMadness?(c=f.get("madnessEarnings"),ue*=2):c=f.get("black6"),D.setText(m.shorten(ue)+"/sec",c);else if("mondayText"===n.name)F=n,b.mondayMadness||(F.visible=!1),F.setText(I.getText("monday!"),f.get("white6"));else if("playerName"===n.name){var ie="Adil";b.playerName=ie}else if("header"===n.name)R=n,!Be&&Fe&&(ae.height>340&&(R.position.y-=ke/2),j.getSafeZone().height!==ae.height&&(R.position.y-=ke/2));else if("footer"===n.name)($=n).attach(me),$.moveComponentTo(me,1),me.position.x=43.6,!Ne&&Fe&&(ae.height>340&&($.position.y+=ke/2),j.getSafeZone().height!==ae.height&&($.position.y+=ke/2));else if("coins"===n.name)L=n;else if("rankText"===n.name)J=n,n.setText((ce+1).toString(),f.get("white8"));else if("rankBar"===n.name)H=n,q=n.getComponent("rankBar"),H.attach({name:"setRectangle",start:function(){fe.x=-q.origin.x*H.scale.x,fe.y=-q.origin.y*H.scale.y,fe.width=q.frameWidth*H.scale.x*(.14+le/S.getRankExperience(ce)*.86),fe.height=q.frameHeight*H.scale.y,H.remove(this)}}),Y=new _({rectangle:fe,sprite:q}),n.attach(Y);else if("rankBase"===n.name)U=n;else if("gemText"===n.name){K=n;var oe=f.get("white8");oe.align="left",n.setText(he.toString(),oe)}else"addGemsButton"===n.name?console.log("------------add------------"):"settingsButton"===n.name?n.onClick=function(){0===b.mainButtonFocus&&(b.mainButtonFocus=2,e.objects.attach(new B({onComplete:function(){b.mainButtonFocus=0}})))}:"backgroundTop"===n.name?n.visible=!1:"backgroundMerge"===n.name&&(ee=n)},onComplete:function(i){Ge.attach(i),de.done=!0,i.getComponent("center",function(t){t.getComponent("bin",function(t){(c=t).position.x+=10,c.smoke=new x({}),c.tween=new h.TweenBehavior({from:1,to:0,in:30,ease:"elastic",decay:2.5,oscillations:4,onUpdate:function(e,t){c.getComponent("binSprite",function(t){t.rotation=e})}}),c.attach(c.smoke),c.use=function(){c.tween.begin(),c.isAdded||e.objects.attach(c.tween),c.smoke.activate()},c.getComponent("useBinSprite",function(e){e.visible=!1,c.useSprite=e})})}),c&&(De.x=c.position.x+c.parent.position.x+c.parent.parent.position.x+c.dimension.x,De.y=c.position.y+c.parent.position.y+c.parent.parent.position.y+c.dimension.y+ke,De.width=c.dimension.width,De.height=c.dimension.height),U&&(Le.x=ae.width/2+U.parent.position.x+U.parent.parent.position.x+U.dimension.x*U.scale.x,Le.y=ae.height/2+U.parent.position.y+U.parent.parent.position.y+U.dimension.y*U.scale.y+ke,Le.width=U.dimension.width*U.scale.x,Le.height=U.dimension.height*U.scale.y,ae.height>340&&(Le.y-=ke/2),j.getSafeZone().height!==ae.height&&(Le.y-=ke/2)),Z=new v({bin:c}),e.objects.attach(Z),Z.position.y+=ke;var r=ee.getWorldPosition();ee.z=b.MergeLayers.BACKGROUND-2,ee.parent.remove(ee),e.objects.attach(ee),ee.attach({name:"positioner",start:function(){ee.position=r,ee.remove(this)}}),L.attach(pe),Q.canAfford(pe.coins);var s=N.getStats(m.getRank()),u=(ae.height/320-1)/.21875,d=N.getMaxStats(m.getRank());ne=new X({statName:I.getText("acceleration"),points:s.acceleration,previous:s.acceleration,maxPoints:d,position:new t(ae.width/2,.5*ae.height-47-14*u)}),Ge.attach(ne),te=new X({statName:I.getText("speed"),points:s.speed,previous:s.speed,maxPoints:d,position:new t(ae.width/2,.5*ae.height-47-14*u+9)}),Ge.attach(te),ne.scale.x=ne.scale.y=.7,te.scale.x=te.scale.y=.7;var y=new C({gamepixelDimension:new n(0,0,18,12),imageName:"gui/vip/vip_crown",originRelative:new t(.5,.5)});y.position.y-=4;var w=new l({text:I.getText("VIP"),position:new t(0,7),fontSettings:f.get("black8"),align:"center",maxWidth:24,maxHeight:10,drawDebug:!1,linebreaks:!1}),E=new o({name:"vipIcon",position:new t(0,0),scale:new t(1/.144,1/.144),components:[y,w]});(ie=new p({z:0,position:new t(ae.width-14,.25*ae.height+28),imageName:"gui/buttons/button_side_right",frameCountX:1,frameCountY:3,icon:E,iconOffset:new t(0,-1.8),offsetOnPressed:1.6,iconAlpha:.5,excited:!0,onClick:function(){se?(g.save("vipSkin",(g.load("vipSkin")+1)%7),a.fire("updateCarMaterial")):0===b.mainButtonFocus&&(b.mainButtonFocus=2)}})).scale.x=ie.scale.y=.122,xe(),b.noMainMenu&&ee&&(ee.visible=!1),b.noMainMenu&&ee&&(ee.visible=!1),$&&!Ne&&Fe&&(ae.height>340&&($.position.y+=ke/2),j.getSafeZone().height!==ae.height&&($.position.y+=ke/2))}}),pe=new E({}),fe=new n(0,0,0,1),me=new k({}),ge=new h.TweenBehavior({from:1.2,to:1,in:30,ease:"elastic",decay:2.5,oscillations:3,onUpdate:function(e,t){pe.coinText&&(pe.coinText.scale.x=e,pe.coinText.scale.y=e)}}),ve=function(t){g.load("coins")<0&&g.save("coins",0),pe.setCoins(),Q.canAfford(pe.coins),t&&!ge.isAdded&&(ge.begin(),e.objects.attach(ge))},ye=function(e){e=e||g.load("gems"),he=e,K&&K.setText(he)},be=function(e){we(e)},we=function(e){var t;ue=e||v.earnings,se&&(ue*=2),b.buffs.doubleCoin&&(ue*=2),b.mondayMadness?(t=f.get("madnessEarnings"),ue*=2,F&&(F.visible=!0)):(t=f.get("black6"),F&&(F.visible=!1)),D&&D.setText(m.shorten(ue)+"/sec",t)},xe=function(){ie&&ie.parent,ne&&(ne.scale.x=ne.scale.y=.63),te&&(te.scale.x=te.scale.y=.63),re&&(re.scale.x=re.scale.y=.122),oe&&(oe.scale.x=oe.scale.y=.122,oe.getComponent("sprite",function(e){re.position.x=ae.width/2-.122*e.frameWidth*.5-2,oe.position.x=ae.width/2-.122*e.frameWidth*.5-2,ie.position.x=ae.width-.122*e.frameWidth*.5,re.position.y=-.2*ae.height-28,oe.position.y=-.2*ae.height}))},Ee=function(e){xe(),se=e,be()},Se=le,_e=le,Te=ce,Me=new h.TweenBehavior({from:0,to:1,in:10,ease:"easeOutCubic",onUpdate:function(e,t){fe.width=q.frameWidth*H.scale.x*(.14+(Se+(le-Se)*e)/S.getRankExperience(ce)*.86)},onComplete:function(){if(ce!==Te){ce++,fe.width=0,J.setText((ce+1).toString());var t=b.mainButtonFocus;b.mainButtonFocus=2;var n=new T({rank:ce,onComplete:function(){b.mainButtonFocus=t,Se=0,le=Te!==ce?S.getRankExperience(ce):_e,Me.begin(),e.objects.attach(Me)}});e.objects.attach(n)}}}),Ce=function(t){t.rank!==ce&&(Te=t.rank),q&&(Se=le,le=Te!==ce?S.getRankExperience(ce):t.experience,_e=t.experience,Me.begin(),Me.isAdded||e.objects.attach(Me))},Ae=function(){var e=N.getStats(m.getRank()),t=N.getStats(m.getRank()-1),n=N.getMaxStats(m.getRank());te.updateStats(e.speed,t.speed,n),ne.updateStats(e.acceleration,t.acceleration,n)},Re=!1,Pe=0,Ie=e.saveState.load(window.atob("aXNEZXY="),!1)||u.isDev(),Le=new n(-1,-1,1,1),De=new n(-1,-1,1,1),Oe=new r({pointerDown:function(e){0===b.mainButtonFocus?Le.hasPosition(e.position)?Re||Ie?Pe++:Pe=0:c&&De.hasPosition(e.position)?(Re=!0,Pe=0):(Re=!1,Pe=0):(Re=!1,Pe=0)},pointerUp:function(t){var n;0===b.mainButtonFocus&&(Ie&&Pe?(b.mainButtonFocus=99,n=new w({}),e.objects.attach(n)):Pe>=10&&u.prompt("","?",function(t){t===window.atob("Y2FybWFnZWRkb24=")&&(Ie=!0,e.saveState.save(window.atob("aXNEZXY="),!0),b.mainButtonFocus=99,n=new w({}),e.objects.attach(n))}))}}),ke=0,Fe=!1,Be=!1,Ne=!1,Ue=function(){var e=V.shouldShow();if(Fe!==e){Fe=e;var t=e?-13:13;Z&&(Z.position.y+=t);var n=j.getSafeZone().height!==ae.height;R&&(Be=!0,ae.height>340&&(R.position.y-=t/2),n&&(R.position.y-=t/2)),$&&(Ne=!0,ae.height>340&&($.position.y+=t/4),n&&($.position.y+=t/2)),c&&(De.y+=t),U&&(Le.y+=t,ae.height>340&&(Le.y-=t/2),n&&(Le.y-=t/2)),Ge.position.y+=t,ke+=t}},ze={name:"behaviorComponent",start:function(e){a.on("updateCoins",ve),a.on("updateGems",ye),a.on("updateEarnings",be),a.on("updateExperience",Ce),a.on("updateStats",Ae),a.on("mondayMadness",we),a.on("onVipChanged",Ee),a.on("bannerStatusChanged",Ue),b.noMainMenu&&(Ge.visible=!1,ee&&(ee.visible=!1))},destroy:function(e){a.off("updateCoins",ve),a.off("updateGems",ye),a.off("updateEarnings",be),a.off("updateExperience",Ce),a.off("updateStats",Ae),a.off("mondayMadness",we),a.off("onVipChanged",Ee)},update:function(e){},draw:function(e){}},Ge=new o({z:b.MergeLayers.MAINMENU,name:"mainMenu",position:s.position,updateWhenPaused:0,components:[de,Oe,ze]}).extend({mergeBoard:Z});return Ge}}),bento.define("gui/main/mergeboard",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/eventsystem","bento/gui/clickbutton","bento/gui/counter","bento/gui/text","bento/utils","bento/tween","gui/main/mergetile","gui/main/mergecar","modules/savemanager","globals","modules/taptic","gui/main/binsmoke","managers/pricing","gui/main/mergefx","gui/main/adballoon","modules/watchad","managers/experience","managers/vipmanager"],function(e,t,n,i,r,o,a,s,c,l,u,h,d,p,f,m,g,v,y,b,w,x,E,S){"use strict";var _=f.load("mergeBoard"),T=f.load("crates"),M=f.load("specialCrates"),C=function(i){var s,c,l,v=S.isVip(),A=e.getViewport(),R=i.bin,P=[],I=[],L=new n(0,0,1,1),D=new n(0,0,1,1),O=new t(0,0),k=new p({car:1,z:m.MergeLayers.GHOST,ghost:!0}),F=new w({}),B=new b({}),N=new t(.5*A.width,.68*A.height),U={name:"behaviorComponent",balloonTimer:0,giftTimer:C.freeGifts?f.load("mergeGiftTimer"):0,start:function(n){var i,r;L.width=A.width,L.height=102,L.x=0,L.y=N.y-L.height/2-6,s=E.getRank();for(var o=4+Math.min(s,8),c=Math.ceil(Math.sqrt(o)),l=Math.pow(c-1,2),h=c,m=0,g=0,v=Math.ceil(o/c),y=!1,b=0,w=0;b<o;b++,w++)null===_[b]&&(_[b]=-1,y=!0),u.isDefined(_[b])&&-1!==_[b]?(r=new p({car:_[b]}),e.objects.attach(r),I.push(r)):r=void 0,w%h==0&&(w=0,g+=h=m<c-1?m<o-l?c:c-1:Math.min(o-g,c),m++),i=new d({position:new t(N.x+(h-1)/2*-40+b%h*40,N.y+(v-1)/2*-30+30*(m-1)),car:r}),K.attach(i),P.push(i),r&&(r.position.x=i.position.x,r.position.y=i.position.y);y&&f.save("mergeBoard",_),k.getComponent("rankContainer",function(e){e.visible=!1}),H(),e.objects.attach(k),k.visible=!1,e.objects.attach(B),e.objects.attach(F),s<8&&a.on("updateExperience",z),a.on("onVipChanged",G)},destroy:function(e){a.off("updateExperience",z),a.off("onVipChanged",G),C.freeGifts&&f.save("mergeGiftTimer",U.giftTimer)},update:function(e){var t=Math.min(e.speed,4);if(this.balloonTimer+=t,this.balloonTimer>180){C.balloonSpawn++,C.balloonSpawn%10==9&&(x.canShowRewarded()||u.isDev())&&F.activate(),this.balloonTimer-=180;var n=1;m.buffs.doubleCoin&&(n*=2),m.mondayMadness&&(n*=2),v&&(n*=2),f.add("coins",3*C.earnings*n),a.fire("updateCoins",!0)}C.freeGifts&&(this.giftTimer+=t);for(var i=!1;this.giftTimer>7200;)J()?this.giftTimer-=7200:this.giftTimer=0,i=!0;i&&f.save("mergeGiftTimer",U.giftTimer),F.wait&&F.wait--,m.mainButtonFocus!==C.mainButtonFocus&&(l=void 0,k.visible=!1)},draw:function(e){}},z=function(e){if(s!==e.rank){for(var t,n=Math.max(Math.min(e.rank,8)-s,0);n--;)t=new d({}),K.attach(t),P.push(t);s=e.rank;for(var i=P.length,r=Math.ceil(Math.sqrt(i)),o=Math.pow(r-1,2),c=r,l=0,u=0,h=Math.ceil(i/r),p=0,f=0;p<i;p++,f++)f%c==0&&(f=0,u+=c=l<r-1?l<i-o?r:r-1:Math.min(i-u,r),l++),(t=P[p]).position.x=N.x+(c-1)/2*-40+p%c*40,t.position.y=N.y+(h-1)/2*-30+30*(l-1),t.car&&(t.car.position.x=t.position.x,t.position.y=t.position.y);s>=8&&a.off("updateExperience",z)}},G=function(e){v=e},H=function(){C.earnings=0,I.forEach(function(e){e&&e.earning&&(C.earnings+=e.earning)}),a.fire("updateEarnings",C.earnings)},j=function(t,n){var i=new p({car:t,box:2,position:n.position.clone()});e.objects.attach(i),I.push(i),n.pedestal(i)},V=function(e){var t,n;if(M.length)t=M.shift(),j(t,e),_[P.indexOf(e)]=t,f.save("mergeBoard",_),f.save("specialCrates",M);else if(T)return n=y.getRank(),t=Math.max(n-7,Math.floor(n/2)),j(t,e),_[P.indexOf(e)]=t,f.save("mergeBoard",_),T--,f.save("crates",T),!0;return!1},W=function(){for(var e,t=!1,n=4,i=0;i<P.length&&n>0;i++)if(!P[i].car){var r=y.getRank();e=Math.max(Math.max(0,r-7),Math.min(r-5,Math.floor(r/2))),j(e,P[i]),_[i]=e,n--,t=!0}t&&f.save("mergeBoard",_),n&&(T+=n,f.save("crates",T))},X=null,q=0,Y=new r({pointerDown:function(e){var t=Date.now();m.mainButtonFocus===C.mainButtonFocus&&(u.isUndefined(l)||(t-q)/1e3>1.2)&&!F.wait&&(c&&(c.alpha=1,I.forEach(function(e){e!==c&&(e.car!==c.car||e.box||e.tile.glow(!1))}),c=null),F.visible&&(D.x=F.position.x+F.dimension.x-2,D.y=F.position.y+F.dimension.y-2,D.width=F.dimension.width+4,D.height=F.dimension.height+4),F.visible&&D.hasPosition(e.position)?(F.visible=!1,C.balloonSpawn=-30,F.wait=15,x.showRewarded({z:m.MergeLayers.DIALOG,tag:"freeCrates",onReward:function(e){W()}})):L.hasPosition(e.position)&&K.active&&!K.merging&&(u.forEach(I,function(n,i,r,o){D.x=n.position.x+n.dimension.x*n.scale.x,D.y=n.position.y+n.dimension.y*n.scale.y,D.width=n.dimension.width*n.scale.x,D.height=n.dimension.height*n.scale.y,n.touchable&&D.hasPosition(e.position)&&(n.box?(n.setCar(n.car),n.box=!1,o()):(l=e.id,q=t,c=n,O.x=e.position.x,O.y=e.position.y,c.alpha=.5,k.setCar(c.car),k.visible=!0,k.z=Math.max(c.z+1,m.MergeLayers.GHOST),k.position.x=O.x,k.position.y=O.y,o()))}),c&&1!==C.mainButtonFocus&&(I.forEach(function(e){e!==c&&(e.car!==c.car||e.box||e.tile.glow(!0))}),R.useSprite.visible=!0)),F.visible&&F.position.y<e.position.y&&(F.magnet=e.position.x))},pointerUp:function(t){if(m.mainButtonFocus===C.mainButtonFocus&&c&&t.id===l){var n=!1;if(I.forEach(function(e){e!==c&&(e.car!==c.car||e.box||e.tile.glow(!1))}),!n&&L.hasPosition(t.position)&&(u.forEach(I,function(e,i,r,o){c!==e&&(D.x=e.position.x+e.dimension.x*e.scale.x,D.y=e.position.y+e.dimension.y*e.scale.y,D.width=e.dimension.width*e.scale.x,D.height=e.dimension.height*e.scale.y,D.hasPosition(t.position)&&(e.car===c.car&&e.car<m.maxCarRank-1?(K.merging=!0,c.tile.car=null,_[P.indexOf(c.tile)]=-1,e.merge(c,function(e){V(e.tile),e.removeSelf(),I.splice(I.indexOf(e),1),K.merging=!1,H(),B.activate(this.position),this.getComponent("multiScale",function(e){new h({from:0,to:1,in:30,delay:0,ease:"elastic",decay:8,oscillations:2,onUpdate:function(t,n){e.normal.x=e.normal.y=t}})})}),_[P.indexOf(e.tile)]=e.car+1,g.impact({style:"heavy"})):(e.tile.swap(c),_[P.indexOf(c.tile)]=c.car,_[P.indexOf(e.tile)]=e.car,g.impact({style:"medium"})),n=!0,f.save("mergeBoard",_),g.impact({style:"light"})))}),n||u.forEach(P,function(e,i,r,o){if(c.tile!==e&&(D.x=e.position.x+e.dimension.x*e.scale.x,D.y=e.position.y+e.dimension.y*e.scale.y,D.width=e.dimension.width*e.scale.x,D.height=e.dimension.height*e.scale.y,D.hasPosition(t.position)&&!e.car)){var a=c.tile;_[P.indexOf(c.tile)]=-1,c.tile.car=null,e.pedestal(c),n=!0,_[i]=c.car,V(a)||f.save("mergeBoard",_)}})),!n&&I.length>1&&1!==C.mainButtonFocus){var i=R.parent,r=i.parent;D.x=r.position.x+i.position.x+R.position.x+R.dimension.x*R.scale.x-2,D.y=r.position.y+i.position.y+R.position.y+R.dimension.y*R.scale.y-2,D.width=R.dimension.width*R.scale.x+4,D.height=R.dimension.height*R.scale.y+4,D.hasPosition(t.position)&&(_[P.indexOf(c.tile)]=-1,I.splice(I.indexOf(c),1),c.tile.car=null,V(c.tile)||f.save("mergeBoard",_),c.removeSelf(),n=!0,H(),g.impact({style:"heavy"}),R.use(),e.audio.stopSound("sfx_bin"),e.audio.playSound("sfx_bin"),f.add("coins",y.getCurrentPrice(c.car)/2),a.fire("updateCoins",!0))}l=void 0,c.alpha=1,c=null,k.visible=!1,R.useSprite.visible=!1}X=null},pointerMove:function(e){if(m.mainButtonFocus===C.mainButtonFocus){if(c&&e.id===l){q=Date.now(),O.x=e.position.x,O.y=e.position.y,k.position.x=O.x,k.position.y=O.y;var t=!1;!t&&L.hasPosition(e.position)&&u.forEach(I,function(n,i,r,o){c!==n&&X!==n&&c.car===n.car&&(D.x=n.position.x+n.dimension.x*n.scale.x,D.y=n.position.y+n.dimension.y*n.scale.y,D.width=n.dimension.width*n.scale.x,D.height=n.dimension.height*n.scale.y,D.hasPosition(e.position)&&(X=n,t=!0,o()))}),t&&g.impact({style:"light"})}F.visible&&F.position.y<e.position.y&&(F.magnet=e.position.x)}},onClick:function(e){},onClickUp:function(e){},onClickMiss:function(e){},onHold:function(e){},onHoldLeave:function(e){},onHoldEnter:function(e){},onHoldEnd:function(e){},
onHoverLeave:function(e){},onHoverEnter:function(e){}}),J=function(t){for(var n,i=u.isUndefined(t)?Math.max(0,y.getRank()-9):t,r=0;r<P.length;r++)if(!P[r].car&&!K.merging){n=new p({car:i,position:P[r].position.clone(),box:1,tile:P[r]}),e.objects.attach(n),P[r].car=n,n.tile=P[r],_[r]=i,f.save("mergeBoard",_),I.push(n),n.getComponent("multiScale",function(e){new h({from:0,to:1,in:30,delay:0,ease:"elastic",decay:8,oscillations:3,onUpdate:function(t,n){e.normal.x=e.normal.y=t}})}),H();break}return!!n},K=new o({z:1,name:"mergeBoard",position:i.position,updateWhenPaused:0,components:[Y,U]}).extend({active:!0,merging:!1,addTime:function(e){C.freeGifts&&(e=e/1e3*60,U.giftTimer+=e)},buy:function(t,n,i,r){for(var o,a=0;a<P.length;a++)if(!P[a].car&&!K.merging){o=new p({car:t,position:P[a].position.clone(),box:r&&r>0?2:0,tile:P[a]}),e.objects.attach(o),P[a].car=o,o.tile=P[a],_[a]=t,f.save("mergeBoard",_),I.push(o),o.getComponent("multiScale",function(e){new h({from:0,to:1,in:30,delay:0,ease:"elastic",decay:8,oscillations:3,onUpdate:function(t,n){e.normal.x=e.normal.y=t}})}),H();break}o&&n?n(o):r&&2===r?(M.push(t),f.save("specialCrates",M),n&&n()):i&&i()},shake:function(e){K.position.x=e},getMergeables:function(){var e,t,n,i={},r=1/0;return I.forEach(function(o){o&&!o.box&&(n=o.car,i[n]?(n<r&&(r=n),i[n].b?(e=u.dotProduct(i[n].a.position,o.position),t=u.dotProduct(i[n].b.position,o.position),e<i[n].distance&&e<t?(i[n].b=o,i[n].distance=e):t<i[n].distance&&(i[n].a=o,i[n].distance=t)):(i[n].b=o,i[n].distance=u.dotProduct(i[n].a.position,o.position))):i[n]={a:o,b:null,distance:1/0})}),r!==1/0&&i[r]},getCrates:W});return K};return C.reset=function(){_=f.load("mergeBoard")},C.earnings=0,C.balloonSpawn=0,C.mainButtonFocus=0,C.freeGifts=!0,C}),bento.define("gui/main/mergecar",["bento","bento/math/vector2","bento/math/rectangle","bento/components/pixi/sprite","bento/components/clickable","bento/entity","bento/eventsystem","bento/gui/clickbutton","bento/gui/counter","bento/gui/text","bento/utils","bento/tween","managers/pricing","globals","components/multiscale","managers/textstyles","managers/experience","gui/main/carunlockdialog","modules/abtest","gui/general/askrating"],function(e,t,n,i,r,o,a,s,c,l,u,h,d,p,f,m,g,v,y,b){"use strict";var w=0;return function(n){var r=n.car,s="car"+("00"+r).slice(-2),c=new i({imageName:n.box?2===n.box?"gui/home/box":"gui/home/box_neutral":"gui/cars/"+s}),y=new l({text:(r+1).toString(),position:new t(0,0),scale:new t(6.75,6.75),fontSettings:m.get("black6"),align:"center",textBaseline:"middle",maxWidth:10,maxHeight:8,drawDebug:!1,linebreaks:!1}),x=d.earning(r),E=d.shorten(4*x),S=new l({text:"+"+E,position:new t(0,0),fontSettings:m.get("white6"),align:"center",textBaseline:"middle",maxWidth:28,linebreaks:!1});S.z=p.MergeLayers.EARNINGTEXT;var _=h.interpolationsRP.easeOutQuad,T={name:"earningBehavior",timer:0,max:64,alpha:40,y:0,start:function(){this.timer=0,S.position.x=P.position.x,this.y=S.position.y=P.position.y-10},update:function(e){if(this.timer+=e.speed,this.timer<this.max){var t=_(this.timer,0,-16,this.max),n=this.timer<this.alpha?1:_(this.timer-this.alpha,1,-1,this.max-this.alpha);S.position.y=this.y+t,S.alpha=n}else S.removeSelf()}};S.attach(T);var M=new i({imageName:"gui/home/car_number",originRelative:new t(.5,.5)}),C=new o({name:"rankContainer",position:new t(70,40),components:[M,y]}),A=new f({scales:{normal:new t(1,1),hd:new t(.148,.148)}}),R={name:"behaviorComponent",earningTimer:u.getRandomFloat(p.gameEarningsTime),start:function(e){c.origin.x=c.frameWidth/2,c.origin.y=c.frameHeight-46,P.dimension.x=-c.origin.x,P.dimension.y=-c.origin.y,P.box&&(P.transform.y=-P.position.y,P.alpha=0,P.touchable=!1,C.visible=!1,new h({from:P.transform.y,to:0,in:20,delay:5,ease:"easeInQuad",onStart:function(){},onUpdate:function(e,t){P.transform.y=e},onComplete:function(){P.touchable=!0,new h({from:.4,to:0,in:30,delay:0,ease:"elastic",decay:4,oscillations:2,onUpdate:function(e,t){A.normal.x=1+2*e,A.normal.y=1-e}})}}),new h({from:0,to:1,in:8,delay:5,ease:"easeInQuad",onUpdate:function(e,t){P.alpha=e}}));var t=(y.dimension.width/2).toString().split(".");t.length>1&&(y.position.x+=parseFloat("0."+t[1])),(t=(y.dimension.height/2).toString().split(".")).length>1&&(y.position.y+=parseFloat("0."+t[1]))},destroy:function(e){},update:function(t){if(!n.ghost&&!P.box){var i=1;p.buffs.doubleCoin&&(i/=2),p.mondayMadness&&(i/=2),this.earningTimer+=t.speed,this.earningTimer>=p.gameEarningsTime*i&&(this.earningTimer-=p.gameEarningsTime*i,S.isAdded||e.objects.attach(S))}},draw:function(e){}},P=new o({z:n.z||p.MergeLayers.MERGECARS,name:"mergeCar",family:n.ghost?[]:["cars"],position:n.position,scale:new t(.148,.148),updateWhenPaused:0,components:[A,c,C,R]}).extend({car:r,carString:s,tile:n.tile,earning:x,box:!!n.box,touchable:!0,setCar:function(e){(r!==e||P.box)&&(r=e,C.visible?y.setText((r+1).toString(),m.get("black6")):P.box&&(C.visible=!0),P.car=r,P.earning=d.earning(r),n.ghost||(E=d.shorten(4*P.earning),S.setText("+"+E)),s="car"+("00"+r).slice(-2),P.carString=s,c.setup({imageName:"gui/cars/"+s}),c.origin.x=c.frameWidth/2,c.origin.y=c.frameHeight-46,P.dimension.x=-c.origin.x,P.dimension.y=-c.origin.y)},merge:function(t,n){p.freeCar-=.5,a.fire("freeCar");var i=d.checkUnlock(P.car+1);P.tile.car=null,t.position.y=P.position.y,t.z=p.MergeLayers.MERGINGCARS;var r=P.z;P.z=p.MergeLayers.MERGINGCARS,t.getComponent("rankContainer",function(e){e.visible=!1}),C.visible=!1,t.touchable=!1,P.touchable=!1,e.audio.stopSound("sfx_pip"),e.audio.playSound("sfx_pip"),new h({from:0,to:34,in:20,ease:"easeInOutQuart",onUpdate:function(e,n){P.position.x=P.tile.position.x+e,t.position.x=P.tile.position.x-e},onComplete:function(){new h({from:34,to:0,in:7,ease:"easeInQuad",onUpdate:function(e,n){P.position.x=P.tile.position.x+e,t.position.x=P.tile.position.x-e},onComplete:function(){if(P.touchable=!0,P.z=r,P.tile.car=P,C.visible=!0,P.setCar(P.car+1),w++,a.fire("FTUE_MERGE"+w+"COMPLETE"),i){var o=p.mainButtonFocus;p.mainButtonFocus=2,a.fire("GameAnalytics-addDesignEvent",{eventId:"Gameplay:Cars:car-"+(P.car+1)}),a.fire("FirebaseAnalytics-logEvent",{name:"newCar",properties:{type:P.car+1}});var s=new v({car:P.car,onComplete:function(){e.audio.stopSound("sfx_merge"),e.audio.playSound("sfx_merge");var i=function(){p.mainButtonFocus=o,d.fireRank(),g.addExperience(g.getCarExperience(P.car-1)),n&&n.bind(P)(t)};P.car>=5&&b.canAsk()?u.isNativeIos()?b.askIos10():e.objects.attach(new b({onComplete:i})):i()}});e.objects.attach(s)}else e.audio.stopSound("sfx_merge"),e.audio.playSound("sfx_merge"),g.addExperience(g.getCarExperience(P.car-1)),n&&n.bind(P)(t)}})}})}});return P}}),bento.define("gui/main/mergefx",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/eventsystem","bento/gui/clickbutton","bento/gui/counter","bento/gui/text","bento/utils","bento/tween","globals"],function(e,t,n,i,r,o,a,s,c,l,u,h,d){"use strict";return function(n){var r=new i({imageName:"gui/fx/merge_star",originRelative:new t(.5,.5)}),a=new i({imageName:"gui/fx/merge_shine",originRelative:new t(.5,.5)}),s=new o({name:"shineContainer",position:new t(0,0),components:[a]}),c=[],l=n.amount||8,p={name:"behaviorComponent",start:function(e){s.visible=!1},destroy:function(e){},update:function(e){var t=!1;s.visible&&(s.rotation+=.04*e.speed),c.forEach(function(n){n.x+=n.forceX*e.speed,n.y+=n.forceY*e.speed,n.forceX-=.05*n.forceX*e.speed,n.forceY-=.05*n.forceY*e.speed,n.forceY+=-.2*e.speed,n.life+=e.speed,n.alpha=1-Math.min(n.life/n.lifeTime,1),n.alpha*=n.alpha,n.alpha>0&&(t=!0)}),t||(c.length=0)},draw:function(e){c.forEach(function(t){e.renderer.setOpacity(t.alpha),e.renderer.translate(t.x,t.y),r.draw(e),e.renderer.translate(-t.x,-t.y)}),e.renderer.setOpacity(1)}},f=new h.TweenBehavior({from:0,to:1,in:7,ease:"easeOutQuad",onUpdate:function(e,t){s.scale.x=e,s.scale.y=e},onComplete:function(){m.begin(),e.objects.attach(m)}}),m=new h.TweenBehavior({from:1,to:0,in:16,ease:"easeInQuad",onUpdate:function(e,t){s.alpha=e},onComplete:function(){s.alpha=1,s.visible=!1}}),g=new o({name:"mergeFx",z:d.MergeLayers.MERGEFX,position:n.position,scale:new t(.148,.148),updateWhenPaused:0,components:[s,p]}).extend({activate:function(t){var n;g.position.x=t.x,g.position.y=t.y-7,s.visible=!0,f.begin(),e.objects.attach(f);for(var i=l;i--;)n={x:0,y:0,forceX:u.getRandomRangeFloat(-8,8),forceY:u.getRandomRangeFloat(-4,12),lifeTime:54+u.getRandom(32),life:0,alpha:1},c.push(n)}});return g}}),bento.define("gui/main/mergetile",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/eventsystem","bento/gui/clickbutton","bento/gui/counter","bento/gui/text","bento/utils","bento/tween","components/hdsprite","globals"],function(e,t,n,i,r,o,a,s,c,l,u,h,d,p){"use strict";return function(r){e.getViewport();var a=new d({gamepixelDimension:new n(0,0,35,24),imageName:"gui/home/car_box",originRelative:new t(.5,.5)}),s=new o({name:"glow",components:[new i({imageName:"gui/home/car_glowbox",originRelative:new t(.5,.5)})]}),c={name:"behaviorComponent",start:function(e){l.car&&(l.car.tile=l),s.scale.x=a.scale.x,s.scale.y=a.scale.y,s.visible=!1},destroy:function(e){},update:function(e){if(l.car&&(l.car.position.x=l.parent.position.x+l.position.x,l.car.position.y=l.parent.position.y+l.position.y,s.visible)){var t=Math.abs(s.timer/35%2-1);t<.5?(t*=2,t*=t,t*=.5):(t=1-(t=2*(t-.5)),t=.5*(t=1-(t*=t))+.5),s.alpha=t}},draw:function(e){}},l=new o({z:p.MergeLayers.MERGETILES,name:"carTile",position:r.position,updateWhenPaused:0,components:[a,s,c]}).extend({car:r.car,pedestal:function(e){l.car=e,e.tile=l},swap:function(e){l.car.tile&&e.tile&&(e.tile.pedestal(l.car),l.pedestal(e))},glow:function(e){s.visible=e,e&&(s.timer=0)}});return l}}),bento.define("gui/main/mondaymadnessdialog",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/eventsystem","bento/gui/clickbutton","bento/gui/counter","bento/gui/text","bento/utils","bento/tween","gui/general/dialog","components/hdsprite","managers/textstyles","components/iconbutton","modules/watchad","globals","managers/pricing","modules/savemanager","components/mask","modules/localization"],function(e,t,n,i,r,o,a,s,c,l,u,h,d,p,f,m,g,v,y,b,w,x){"use strict";return function(e){var i=e.onComplete,r=new d({name:"mondayMadnessDialog",height:180,titleSprite:"popup_up_yellow",onComplete:function(){i&&i()}}),s=new p({gamepixelDimension:new n(0,0,161,104),imageName:"gui/monday_madness/mm_header",originRelative:new t(.5,.5)});s.position.y=-98,r.content.attach(s);var c=new l({z:0,position:new t(0,0),text:x.getText("mondayMadness"),font:"montserrat-black-italic",fontSize:20,fontColor:"#75342f",ySpacing:-3,align:"center",textBaseline:"middle",maxWidth:98,maxHeight:40,shadow:!0,shadowOffset:new t(1,1),shadowColor:"#ffc334"});c.position.y=-89,c.rotation=-.12;var u=new l({z:0,position:new t(0,0),text:x.getText("mondayMadness"),font:"montserrat-black-italic",fontSize:20,fontColor:"#fff03f",ySpacing:-3,align:"center",textBaseline:"middle",maxWidth:98,maxHeight:40,shadow:!0,shadowOffset:new t(1,1),shadowColor:"#fff68f"});u.position.x=2,u.position.y=-87,u.rotation=-.12,r.content.attach(u),r.content.attach(c);var h=new p({gamepixelDimension:new n(0,0,129,88),imageName:"gui/monday_madness/mm_graphic",originRelative:new t(.5,.5)});h.position.x=7,h.position.y=-13,r.content.attach(h),r.getComponent("windowContainer",function(e){e.getComponent("exitButton",function(t){e.remove(t)})});var g=new l({text:x.getText("mondayMadnessInfo"),position:new t(0,5),fontSettings:f.get("black8"),align:"center",maxWidth:92,drawDebug:!1});g.position.y=40,r.content.attach(g);var y=new p({gamepixelDimension:new n(0,0,33,23),imageName:"gui/monday_madness/mm_x2icon",originRelative:new t(.5,.5)});y.position.x=24,y.position.y=-6;var b=f.get("white16");b.textBaseline="middle";var w=new l({text:x.getText("free").toUpperCase(),position:new t(-23,-4),fontSettings:b,align:"center",maxWidth:49,linebreaks:!1,drawDebug:!1,shadow:!0,shadowOffset:new t(0,1.4),shadowColor:"#3f7ed1"});w.rotation=-.2;var E=new o({name:"collectIcon",position:new t(0,0),scale:new t(1/.144,1/.144),components:[w,y]}),S=new m({name:"collectButton",z:0,position:new t(0,85),imageName:"gui/monday_madness/mm_button",frameCountX:1,frameCountY:3,icon:E,offset:new t(0,0),offsetOnPressed:2,iconAlpha:.5,excited:!0,onClick:function(){v.mondayMadness=!0,a.fire("mondayMadness"),r.dismiss()}}).attach(new Object({name:"pulser",timer:0,update:function(e){this.timer+=e.speed;var t=.975+.05*Math.sin(this.timer/15);S.scale.x=S.scale.y=.144*t}}));return r.content.attach(S),r}}),bento.define("gui/main/noaddialog",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/eventsystem","bento/gui/clickbutton","bento/gui/counter","bento/gui/text","bento/utils","bento/tween","gui/general/dialog","components/hdsprite","managers/textstyles","components/iconbutton","modules/watchad","globals","managers/pricing","modules/savemanager","components/mask","modules/localization","gui/general/iapoverlay"],function(e,t,n,i,r,o,a,s,c,l,u,h,d,p,f,m,g,v,y,b,w,x,E){"use strict";return function(e){var r=e.onComplete,s=new d({name:"carUnlockDialog",width:132,height:160,onExit:function(){_.active=!1},onComplete:function(){r&&r()}}),c=new o({name:"icon",position:new t(0,-5),scale:new t(.148,.148),components:[new i({imageName:"gui/iap/icon_noads01",originRelative:new t(.5,.5)})]}),h=new l({text:x.getText("shopNoAds").toUpperCase(),position:new t(-1.6,17.4),fontSettings:f.get("white18"),align:"center",maxWidth:50,lineWidth:1.6,strokeStyle:"#1e3e73",innerStroke:!1,shadow:!0,shadowOffset:new t(0,1.6),shadowColor:"#b19ae3",linebreaks:!1});h.start({}),h.position.y+=5*(1-1/(h.dimension.height/31));var g=new p({gamepixelDimension:new n(0,0,63,54),imageName:"gui/iap/gemshop_box",originRelative:new t(.5,.5)}),y=o({name:"iconContainer",position:new t(0,-24),components:[g,c,h]});s.content.attach(y);var w=E.getPrice("roadcrash_noads","$2.99"),S=new l({text:w,position:new t(0,0),scale:new t(6.94,6.94),fontSettings:f.get("black10"),align:"center",maxWidth:38,drawDebug:!1,linebreaks:!1,shadow:!0,shadowOffset:new t(.5,.5),shadowColor:"#118f7f"}),_=new m({name:"iapButton",z:0,position:new t(0,30),imageName:"gui/buttons/button_offlinex2",frameCountX:1,frameCountY:3,icon:S,offset:new t(0,0),offsetOnPressed:2,iconAlpha:.5,excited:!0,onClick:function(){if(u.isDev())return b.save("noAds",!0),void s.dismiss();E.purchase({z:v.MergeLayers.IAPOVERLAY,id:"roadcrash_noads",isConsumable:!1,resolveAutomatically:!0,onPurchaseComplete:function(e,t,n){b.save("noAds",!0),s.dismiss()}})}});return s.content.attach(_),a.fire("GameAnalytics-addDesignEvent",{eventId:"IAP:noAdDialogView"}),s}}),bento.define("gui/main/pause",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/eventsystem","bento/gui/clickbutton","bento/gui/counter","bento/gui/text","bento/utils","bento/tween","bento/components/modal","bento/components/fill","globals","modules/localization","managers/textstyles","components/backbutton","components/iconbutton"],function(e,t,n,i,r,o,a,s,c,l,u,h,d,p,f,m,g,v,y){"use strict";var b,w=function(n){var i=e.getViewport(),r=new o({name:"background",components:[new p({name:"fill",color:[0,0,.1,.7]})]}),s=new l({text:m.getText("paused"),position:new t(i.width/2,.4*i.height),fontSettings:g.get("white12"),align:"center",maxWidth:160,drawDebug:!1}),c=new y({name:"playButton",z:0,position:new t(i.width/2,i.height-80),imageName:"gui/buttons/button_race-wide",frameCountX:2,frameCountY:1,iconName:"gui/ingame/play_icon",iconOffset:new t(0,-10),offsetOnPressed:2,iconAlpha:.5,excited:!0,onClick:function(){h.removeSelf(),n.onComplete&&n.onComplete()}}),u=new d({}),h=new o({z:n.z||f.Layers.DIALOGS,name:"pauseMenu",position:n.position,float:!0,components:[u,r,{name:"behaviorComponent",start:function(e){},destroy:function(e){},update:function(e){},draw:function(e){}},s,c]}).extend({dismiss:function(){h.removeSelf(),a.fire("unPaused")}});return h},x=!0;return function(n){var i=new v({onPressed:function(t){x?(b=new w({z:f.RaceLayers.PAUSESCREEN,onComplete:function(){b=null,x=!0}}),e.objects.attach(b),x=!1):(b.dismiss(),b=null,x=!0)}});return new o({z:0,name:"pauseEntity",position:new t(0,0),updateWhenPaused:1,components:[i]})}}),bento.define("gui/main/premadnessdialog",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/eventsystem","bento/gui/clickbutton","bento/gui/counter","bento/gui/text","bento/utils","bento/tween","gui/general/dialog","components/hdsprite","managers/textstyles","components/iconbutton","modules/watchad","globals","managers/pricing","modules/savemanager","components/mask","modules/localization"],function(e,t,n,i,r,o,a,s,c,l,u,h,d,p,f,m,g,v,y,b,w,x){"use strict";return function(e){var i=e.onComplete,r=new d({name:"mondayMadnessDialog",width:132,height:160,titleSprite:"popup_up_yellow",onComplete:function(){i&&i()}}),o=new p({gamepixelDimension:new n(0,0,128,83),imageName:"gui/monday_madness/mm_header",originRelative:new t(.5,.5)});o.position.y=-90,r.content.attach(o);var a=new l({z:0,position:new t(0,-83),text:x.getText("mondayMadness"),font:"montserrat-black-italic",fontSize:15,fontColor:"#75342f",ySpacing:-3,align:"center",textBaseline:"middle",maxWidth:98,maxHeight:40,shadow:!0,shadowOffset:new t(1,1),shadowColor:"#ffc334"});a.rotation=-.12;var s=new l({z:0,position:new t(2,-81),text:x.getText("mondayMadness"),font:"montserrat-black-italic",fontSize:15,fontColor:"#fff03f",ySpacing:-3,align:"center",textBaseline:"middle",maxWidth:98,maxHeight:40,shadow:!0,shadowOffset:new t(1,1),shadowColor:"#fff68f"});s.rotation=-.12,r.content.attach(s),r.content.attach(a);var c=new p({gamepixelDimension:new n(0,0,103.2,70.4),imageName:"gui/monday_madness/mm_graphic",originRelative:new t(.5,.5)}).attach(new Object({name:"pulser",timer:0,update:function(e){this.timer+=e.speed;var t=Math.sin(this.timer/60);c.position.y=2*t-13}}));c.position.x=7*.8,c.position.y=-13,r.content.attach(c);var u=new l({text:x.getText("preMondayMadnessInfo"),position:new t(0,5),fontSettings:f.get("black8"),align:"center",maxWidth:110,drawDebug:!1});return u.position.y=40,r.content.attach(u),r.getComponent("windowContainer",function(e){e.getComponent("exitButton",function(t){e.moveComponentTo(t,4)})}),r}}),bento.define("gui/main/quickbuy",["bento","bento/math/vector2","bento/math/rectangle","bento/components/pixi/sprite","bento/components/clickable","bento/entity","bento/eventsystem","bento/gui/clickbutton","bento/gui/counter","bento/gui/text","bento/utils","bento/tween","components/hdsprite","managers/pricing","managers/textstyles","modules/savemanager","globals"],function(e,t,n,i,r,o,a,s,c,l,u,h,d,p,f,m,g){"use strict";return function(e){var n=p.quickBuy(),r=p.shorten(n.price),s=new i({imageName:"gui/home/icon_coin",originRelative:new t(.5,.5)}),c=new o({name:"coinContainer",position:new t(0,0),scale:new t(.055,.055),components:[s]}),u=f.get("black8");u.align="left";var h=new l({text:r,position:new t(0,7),fontSettings:u,align:"left",textBaseline:"middle",maxWidth:27,maxHeight:9,drawDebug:!1}),d=n.car,v="car"+("00"+n.car).slice(-2),y=new window.PIXI.filters.ColorMatrixFilter,b=new i({imageName:"gui/cars/"+v+"_outline",originRelative:new t(.5,.5)}),w=!0,x=new o({name:"carContainer",position:new t(0,0),scale:new t(.14,.14),components:[b]}),E={name:"behaviorComponent",start:function(e){S.scale.x=1/S.parent.parent.scale.x,S.scale.y=S.scale.x,x.position.y=b.frameHeight/-2/S.scale.x+3,c.position.y=6;var t=5+h.dimension.width;h.position.x=t/-2+11,c.position.x=t/-2+4.5,b.sprite.filters=[y],s.sprite.filters=[y],a.on("refreshQuickBuy",S.refresh)},destroy:function(e){a.off("refreshQuickBuy",S.refresh)},update:function(e){},draw:function(e){}},S=new o({name:"quickBuyIcon",position:e.position,updateWhenPaused:0,components:[x,c,h,E]}).extend({getData:function(){return n},refresh:function(){if(n=p.quickBuy(),r=p.shorten(n.price),h.setText(r,u),d!==n.car){v="car"+("00"+n.car).slice(-2),b.setup({imageName:"gui/cars/"+v+(w?"_outline":""),originRelative:new t(.5,.5)}),x.position.y=b.frameHeight/-2/S.scale.x+3;var e=5+h.dimension.width;h.position.x=e/-2+11,c.position.x=e/-2+4.5,d=n.car,S.canAfford(m.load("coins"))}},canAfford:function(e){n.price<=e?S.parent&&S.parent.parent&&(S.parent.parent.setActive(!0),w||(b.setup({imageName:"gui/cars/"+v+"_outline",originRelative:new t(.5,.5)}),w=!0,y.saturate(0))):(g.freeCar-=.8,g.noFreeCarDialog&&(g.noFreeCarDialog=!1),a.fire("freeCar"),S.parent.parent.setActive(!1),w&&(b.setup({imageName:"gui/cars/"+v,originRelative:new t(.5,.5)}),y.saturate(-.7),w=!1))}});return S}}),bento.define("gui/main/racefinish",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/pixi/sprite","bento/components/clickable","bento/entity","bento/eventsystem","bento/gui/clickbutton","bento/gui/counter","bento/gui/text","bento/utils","bento/tween","components/hdnineslice","components/iconbutton","managers/textstyles","gui/general/dialog","gui/main/coinbar","components/hdsprite","modules/watchad","gui/general/fountain","gui/main/mergeboard","managers/pricing","globals","modules/savemanager","gui/general/currencyicon","bento/components/fill","components/mask","modules/abtest","modules/localization","modules/crosspromo/crosspromo","managers/vipmanager","modules/banner","bento/components/anchor"],function(e,t,n,i,r,o,a,s,c,l,u,h,d,p,f,m,g,v,y,b,w,x,E,S,_,T,M,C,A,R,P,I,L,D){"use strict";var O=function(n){var i=0,r=0,o=0;e.objects.attach(new w({imageName:"gui/home/icon_coin",onComplete:n.onComplete,scale:new t(.06,.06),amount:n.amount,interpolations:[new Object({from:n.from,fromMin:new t(-64,-16),fromMax:new t(64,16),to:n.to,toMin:new t(-20,-8),toMax:new t(20,8),start:0,end:30,ease:"easeInBack",type:"position"}),new Object({from:new t(0,0),to:new t(0,0),toMin:new t(-64,0),toMax:new t(64,0),start:0,end:22,ease:"easeInOutQuad",type:"position"}),new Object({from:new t(0,0),to:new t(0,0),start:22,end:30,ease:"easeInQuad",type:"position"}),new Object({from:1,to:0,start:26,end:30,ease:"easeInQuad",type:"alpha"})],onCreate:function(e){e.id!==i&&(r+=1.5,i=e.id),1===e.ii?o=e.t.x:2===e.ii&&(e.t.x=-o),e.s+=r,e.e+=r}}))},k=function(e){var i=new y({gamepixelDimension:new n(0,0,106,14),imageName:"gui/level_completed/player-position-back"+(e.isPlayer?"-self":""),originRelative:new t(.5,.5)}),r=new u({text:(e.rank+1).toString()||1,position:new t(-41,1),fontSettings:m.get("black12"),align:"center",maxWidth:19,maxHeight:11,drawDebug:!1}),o=new y({gamepixelDimension:new n(0,0,16,11),imageName:"gui/flags/"+e.flag,originRelative:new t(.5,.5)});o.position.x=-20;var s=m.get("rewardPlayerName");s.align="left";var c=new u({text:e.name||"Player",position:new t(-9,1),fontSettings:s,align:"center",maxWidth:60,maxHeight:11,drawDebug:!1});return new a({name:"playerTag",position:e.position,scale:new t(e.rank?.792:1,e.rank?.792:1),components:[i,r,o,c]})};return function(c){var l=e.getViewport();S.freeCar-=2.5,e.audio.stopSound("sfx_racefinish"),e.audio.playSound("sfx_racefinish");var g,w,A=(w=[],S.leaderboard.forEach(function(e){w.push(e),"car"===e.name&&(g=e)}),S.standings.forEach(function(e){w.push(e)}),w),P=E.getCrashPrice();console.log("time",(Date.now()-S.raceTime)/1e3);var F=I.isVip(),B=56*x.earnings*1.3+S.crashes*P*.15,N=new p({gamepixelDimension:new n(0,0,l.width,160),imageName:"gui/9slice/level_completed",originRelative:new t(.5,.5)}),U=new M({name:"fill",dimension:new n(0,0,l.width+20,74),color:[0,0,0,.3],originRelative:new t(.5,.5)}),z=new a({name:"fillContainer",position:new t(l.width/2,.24*l.height+28),rotation:-.16,components:[U]}),G=new y({gamepixelDimension:new n(0,0,27,22),imageName:"gui/home/icon_video",originRelative:new t(.5,.5)});G.position.y=-13;var H=new T({value:5*B,textStyle:"black18",iconSize:16,currencyIcon:"gui/level_completed/icon_coingreen",position:new t(0,5),lineWidth:.8,strokeStyle:"#a1ff39"}),j=new y({gamepixelDimension:new n(0,0,32,32),imageName:"gui/level_completed/star_x5",originRelative:new t(.5,.5)});j.position.y=-17,j.position.x=54;var V=new u({text:"x5",position:new t(54,-17),fontSettings:m.get("black15"),align:"center",maxWidth:32,linebreaks:!1,drawDebug:!1});V.rotation=-.3;var W=new a({name:"collectIcon",position:new t(0,0),scale:new t(1/.144,1/.144),components:[G,H,j,V]}),X=!1,q=new f({name:"increaseButton",z:0,position:new t(0,-70),imageName:"gui/buttons/button_rv_big",frameCountX:1,frameCountY:3,scaleFactor:.15,icon:W,offset:new t(0,0),offsetOnPressed:2,iconAlpha:.5,excited:!0,onClick:function(){b.showRewarded({z:2,tag:"finishReward",onReward:function(){be(),Se(!1),e.audio.stopSound("sfx_coin_5times"),e.audio.playSound("sfx_coin_5times"),new O({from:q.toWorldPosition(q.position),to:ae.toWorldPosition(ae.position),amount:32,onComplete:function(){we(5),h.timeout(20,function(){e.screens.show("screens/main")})}}),_.save("skippedAds",0)}})}}).attach({name:"checkAdAvailability",update:function(){(X=b.canShowRewarded()||h.isDev())&&!q.active&&xe?q.active=!0:X||(q.active=!1)}}),Y=new u({text:R.getText("collect"),position:new t(0,-10),fontSettings:m.get("collect"),align:"center",maxWidth:80,linebreaks:!1,drawDebug:!1}),J=new T({value:B,textStyle:"black15",iconSize:14,currencyIcon:"gui/level_completed/icon_coinblue",position:new t(0,3)}),K=new a({name:"collectIcon",position:new t(0,0),scale:new t(1/.144,1/.144),components:[Y,J]}),Z=new f({name:"collectButton",z:0,position:new t(0,-16),imageName:"gui/buttons/button_completedcollect",frameCountX:2,frameCountY:1,icon:K,offset:new t(0,0),offsetOnPressed:2,iconAlpha:.5,excited:!0,onClick:function(){be(),e.audio.stopSound("sfx_coin_collect"),e.audio.playSound("sfx_coin_collect"),new O({from:Z.toWorldPosition(Z.position),to:ae.toWorldPosition(ae.position),amount:15,onComplete:function(){console.log("oncomplete fontain"),we(1);var t=_.load("noAds")||I.isVip();h.timeout(20,function(){t?e.screens.show("screens/main"):S.tutorialRace?(S.tutorialRace=!1,e.screens.show("screens/main")):(_.add("noAdsDialogCount",1),b.showInterstitial({z:2,tag:"finishSkip",onComplete:function(){_.save("skippedAds",0)}}),window.setTimeout(function(){e.screens.show("screens/main")},2e3))})}}),Se(!1)}}),Q=new a({z:0,name:"downloadAndroid",family:[""],position:new t(0,0),scale:new t(.15,.15),components:[new i({imageName:"downloadAndroid",originRelative:new t(.5,.5)}),new D({relative:new t(.3,.9),offset:new t(0,0),onResize:function(e){}}),new o({pointerDown:function(e){},pointerUp:function(e){},pointerMove:function(e){},onClick:function(e){console.log("-----openurl  removed------")},onClickUp:function(e){},onClickMiss:function(e){},onHold:function(e){},onHoldLeave:function(e){},onHoldEnter:function(e){},onHoldEnd:function(e){},onHoverLeave:function(e){},onHoverEnter:function(e){}})]}),$=new a({z:0,name:"downloadIOS",family:[""],position:new t(0,0),scale:new t(.15,.15),components:[new i({imageName:"downloadIOS",originRelative:new t(.5,.5)}),new D({relative:new t(.7,.9),offset:new t(0,0),onResize:function(e){}}),new o({pointerDown:function(e){},pointerUp:function(e){},pointerMove:function(e){},onClick:function(e){console.log("-----openurl  removed------")},onClickUp:function(e){},onClickMiss:function(e){},onHold:function(e){},onHoldLeave:function(e){},onHoldEnter:function(e){},onHoldEnd:function(e){},onHoverLeave:function(e){},onHoverEnter:function(e){}})]}),ee=new a({name:"uiContainer",position:new t(l.width/2,0),components:[N,Z,q]}),te=new u({text:R.getText("finish"),position:new t(l.width/2,.12*l.height),fontSettings:m.get("finish"),align:"center",maxWidth:148,maxHeight:30,linebreaks:!1,shadow:!0,shadowOffset:new t(2,2),shadowColor:"#FFFFFF"});te.rotation=-.16;var ne=new y({gamepixelDimension:new n(0,0,113,27),imageName:"gui/ingame/cheer-underline",originRelative:new t(.5,.5)});ne.position.x=l.width/2+15,ne.position.y=.12*l.height+20;var ie=ne.getComponent("sprite"),re=new n(-ie.origin.x*ne.scale.x,-ie.origin.y*ne.scale.y,ie.frameWidth*ne.scale.x,ie.frameHeight*ne.scale.y),oe=new C({rectangle:re,sprite:ie});ne.attach(oe);var ae=new v({position:new t(l.width/2,-8)}),se=_.load("stage"),ce=(Math.floor(se/5)+1)%S.maxStage;_.save("stage",(se+1)%(5*S.maxStage)),se%=5;var le=new window.PIXI.filters.ColorMatrixFilter,ue=new r({imageName:"gui/level_completed/world"+("00"+ce).slice(-2),originRelative:new t(.5,.5)});ue.sprite.filters=[le],le.saturate(-1);var he,de,pe=new a({name:"worldImage",position:new t(380.5,-7.26),components:[ue]}),fe=new i({imageName:"gui/level_completed/world_progress_fill",originRelative:new t(.5,.5)}),me=new a({name:"unlockBlip",position:new t(150*se-403,34),components:[fe]}),ge=new a({name:"worldProgressBar",position:new t(-403,34),components:[new Object({name:"drawBlips",draw:function(e){for(var t=se;t--;)fe.draw(e),e.renderer.translate(150,0)}})]}),ve=new a({name:"carShine",position:new t(380.5,-7.26),components:[new i({imageName:"gui/fx/shine",originRelative:new t(.5,.5)})]}).attach({name:"shineRotator",update:function(e){ve.rotation+=.02*e.speed}}),ye=new a({name:"worldProgressBar",position:new t(l.width/2+6,l.height-140),scale:new t(.142,.142),components:[new i({imageName:"gui/level_completed/world_progress_bar",originRelative:new t(.5,.5)}),ge,me,ve,pe]}),be=function(){new d({from:-8,to:28,in:30,delay:0,applyOnDelay:0,ease:"elastic",decay:4,oscillations:2,onUpdate:function(e,t){ae.position.y=e}})},we=function(e){s.fire("FTUE_RACECOMPLETE"),x.balloonSpawn+=8;var t=1;S.mondayMadness&&(t*=2),F&&(t*=2),_.add("coins",B*t*e),ae.setCoins(),new d({from:1.2,to:1,in:30,ease:"elastic",decay:2.5,oscillations:3,onUpdate:function(e,t){ae.coinText&&(ae.coinText.scale.x=e,ae.coinText.scale.y=e)}})},xe=!1,Ee=S.tutorial||!1,Se=function(e){xe=e,q.active=!!e&&X,Z.active=!!e&&Ee},_e=function(){ye.visible=!0,me.visible=!1,new d({from:1e-4,to:.142,in:26,applyOnDelay:0,ease:"elastic",decay:7,oscillations:2,ignoreGameSpeed:!0,updateWhenPaused:1,onUpdate:function(e,t){ye.scale.x=ye.scale.y=e},onComplete:function(){if(me.visible=!0,Se(!0),e.audio.stopSound("sfx_pip"),e.audio.playSound("sfx_pip"),new d({from:1e-4,to:1,in:20,delay:0,ease:"elastic",decay:6,oscillations:2,onUpdate:function(e,t){me.scale.x=me.scale.y=e}}),4===se){var i=new u({z:0,position:new t(l.width/2+6,l.height-148),text:R.getText("newWorld"),fontSettings:m.get("white8"),align:"center",textBaseline:"middle",maxWidth:90,maxHeight:12,shadow:!0,shadowColor:"#000000",shadowOffset:new t(1.2,1.2)});e.objects.attach(i),ve.visible=!0,new d({from:-1,to:0,in:16,delay:8,applyOnDelay:!0,ease:"easeInQuart",onUpdate:function(e,t){le.saturate(e),ve.alpha=1+e,i.alpha=1+e}})}S.tutorial||((S.mondayMadness||F)&&(Z.position.y+=4,new d({from:.18,to:0,in:40,delay:10,applyOnDelay:0,ease:"elastic",decay:5,oscillations:3,onStart:function(){H.setValue(2*B*5),J.setValue(2*B);var e=new u({z:0,position:new t(-7,-40),text:R.getText(S.mondayMadness?"monday!":"VIP"),font:"montserrat-black-italic",fontSize:9,fontColor:"#ffba1c",lineWidth:1,strokeStyle:"#b44117",innerStroke:!1,align:"center",textBaseline:"middle",linebreaks:!1});e.start(),ee.attach(e);var i=new y({gamepixelDimension:new n(0,0,13,9),imageName:"gui/monday_madness/mm_offline_x2icon",originRelative:new t(.5,.5)});i.position.x=e.dimension.width/2,i.position.y=-40,ee.attach(i),new d({from:0,to:1,in:12,ease:"easeInQuad",onUpdate:function(t,n){e.alpha=t,i.alpha=t}}),new d({from:1,to:0,in:8,delay:50,ease:"easeInQuad",onUpdate:function(t,n){e.alpha=t,i.alpha=t},onComplete:function(){ee.remove(e),ee.remove(i)}})},onUpdate:function(e,t){H.rotation=e}})),new d({from:0,to:1,in:10,delay:70,applyOnDelay:0,ease:"easeInQuad",onStart:function(){Ee=!0,xe&&Se(!0)},onUpdate:function(e,t){Z.visible=!0,Z.alpha=e}}))}})
},Te=0,Me=!1,Ce=!1,Ae=q.scale.x,Re=Z.scale.x,Pe=function(){var e=L.shouldShow();if(Me!==e){Me=e;var t=e?-10:10;e?(q.scale.x=q.scale.y=.8*Ae,Z.scale.x=Z.scale.y=.8*Re):(q.scale.x=q.scale.y=Ae,Z.scale.x=Z.scale.y=Re),Z.position.y+=1.5*t,Ce||(ee.position.y+=.8*t),Te+=t}},Ie={name:"behaviorComponent",start:function(n){Pe(),e.objects.get("raceProgress",function(e){e.hide()}),de=S.crashes/S.opponents||0,he=de>.75?"Gameplay:crashSucces75to100":de>.5?"Gameplay:crashSucces50to75":de>.25?"Gameplay:crashSucces25to50":"Gameplay:crashSucces0to25",s.fire("GameAnalytics-addDesignEvent",{eventId:he,value:S.crashes/S.opponents||0}),s.fire("GameAnalytics-addDesignEvent",{eventId:"Gameplay:crashSucces",value:S.crashes/S.opponents||0}),Se(!1),Z.visible=S.tutorial||!1,Ce=!0,new d({from:l.height+80,to:l.height-20,in:60,delay:0,applyOnDelay:0,ease:"elastic",decay:5,oscillations:3,onUpdate:function(e,t){ee.position.y=e+.8*Te},onComplete:function(){Ce=!1,function(){var e,n=A.indexOf(g);s.fire("GameAnalytics-addDesignEvent",{eventId:"Gameplay:Position:position-"+("00"+(n+1)).slice(-2)}),s.fire("FirebaseAnalytics-logEvent",{name:"raceFinish",properties:{position:n+1,crashSection:he,crashSucces:S.crashes/S.opponents}});for(var i=Math.max(0,n-4),r=0,o=i;o<i+5;r++,o++)e=new k({rank:o,name:A[o].playerName?A[r].playerName:_.load("playerName"),flag:A[o].playerCountry?A[r].playerCountry:S.userCountry||"us",position:new t(0,14*r),isPlayer:o===n}),Le.attach(e),e.visible=!1,new d({from:1e-4,to:.92*e.scale.x,in:26,delay:10*r,applyOnDelay:0,ease:"elastic",decay:7,oscillations:2,ignoreGameSpeed:!0,updateWhenPaused:1,onStart:function(){this.tag.visible=!0,this.tag.scale.x=this.tag.scale.y=1e-4},onUpdate:function(e,t){this.tag.scale.x=this.tag.scale.y=e},onComplete:function(){0==--r&&_e()}}).tag=e}()}}),te.visible=!1,new d({from:0,to:1,in:60,delay:30,applyOnDelay:0,ease:"elastic",decay:8,oscillations:4,onStart:function(){te.visible=!0},onUpdate:function(e,t){te.scale.x=e,te.scale.y=e}}),new d({from:0,to:1,in:36,delay:40,applyOnDelay:!0,ease:"easeInQuad",onUpdate:function(e,t){re.width=880*e}}),new d({from:-l.width-20,to:0,in:6,delay:40,applyOnDelay:!0,onStart:function(){},onUpdate:function(e,t){U.dimension.x=e},onComplete:function(){}}),ye.visible=!1,ve.visible=!1,s.on("bannerStatusChanged",Pe)},destroy:function(e){s.off("bannerStatusChanged",Pe)},update:function(e){},draw:function(e){}},Le=new a({name:"leaderboardContainer",position:new t(l.width/2,.24*l.height),components:[]}),De=new a({z:1,name:"raceFinish",position:c.position,updateWhenPaused:0,components:[z,ye,ee,Le,te,ne,ae,Ie,$,Q]});return De}}),bento.define("gui/main/racehud",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/eventsystem","bento/gui/clickbutton","bento/gui/counter","bento/gui/text","bento/utils","bento/tween","globals","gui/general/uiloader","components/mask","managers/textstyles","managers/pricing","gui/main/mergeboard","modules/abtest"],function(e,t,n,i,r,o,a,s,c,l,u,h,d,p,f,m,g,v,y){"use strict";return function(i){e.getViewport();var r,s,c,l,y,b,w,x,E,S,_,T,M,C,A=d.opponents+1,R=A,P=g.getCrashPrice(),I=new p({loadJson:"ui/racehud",onObject:function(e){var t;"circleSprite"===e.name?r=e.getComponent("circleSprite"):"pointer"===e.name?s=e:"rival"===e.name?c=e:"progressBar"===e.name?d.noRaceBar&&(e.visible=!1):"barSprite"===e.name?(l=e,y=e.getComponent("barSprite"),D.x=-y.origin.x*l.scale.x*.1,D.y=-y.origin.y*l.scale.y,D.width=y.frameWidth*l.scale.x,D.height=y.frameHeight*l.scale.y,l.attach({name:"setRectangle",start:function(){D.x=-y.origin.x*l.scale.x,D.y=-y.origin.y*l.scale.y,D.width=y.frameWidth*l.scale.x,D.height=y.frameHeight*l.scale.y,l.remove(this)}}),b=new f({rectangle:D,sprite:y}),e.attach(b)):"positionTag"===e.name?(w=e,d.noRaceUI&&(w.visible=!1)):"positionContainer"===e.name?((x=e).rotation=-.16,I.done&&(E=x.position.x,S.attach(O))):"positionText"===e.name?(S=e,(t=m.get("black26")).align="right",t.textBaseline="top",S.setText(R,t)):"positionSuffix"===e.name?(_=e,(t=m.get("black15")).align="left",t.textBaseline="bottom",_.setText(L(R),t)):"totalText"===e.name?(T=e,(t=m.get("black7")).align="left",T.setText("/"+A.toString(),t)):"earning"===e.name?(M=e,e.visible=!1):"earningText"===e.name&&(C=e).setText("+0",m.get("white8"))},onComplete:function(e){U.attach(e),I.done=!0,x&&(E=x.position.x,S.attach(O))}}),L=function(e){switch(e){case 1:case 2:case 3:default:return""}},D=new n(0,0,0,1),O={name:"repositioner",start:function(){x&&S&&(x.position.x=E+(S.dimension.width-74.75)/11*4,S.dimension.width>79.75?(x.scale.x=.85,x.scale.y=x.scale.x):(x.scale.x=1,x.scale.y=1)),this.entity.remove(O)},attached:function(e){this.entity=e.entity}},k=!1,F=new h.TweenBehavior({from:1.2,to:1,in:20,ease:"elastic",decay:2.6,oscillations:2,onUpdate:function(e,t){w.scale.x=2-e,w.scale.y=2-e}}),B=function(){var t=A-d.standings.length;if(t!==R){S.setText(t.toString()),_.setText(L(t)),S.attach(O),R=t,F.begin(),F.isAdded||e.objects.attach(F);var n=56*v.earnings*1.3*(d.distance/d.maxDistance)+d.crashes*P*.15,i=g.shorten(n);C.setText(i),d.noRaceUI||d.noRaceBar||(M.visible=!0)}},N={name:"behaviorComponent",start:function(e){a.on("standing",B)},destroy:function(e){a.off("standing",B)},update:function(e){},draw:function(e){}},U=new o({z:d.RaceLayers.GUI,name:"raceProgress",family:[""],position:i.position,updateWhenPaused:0,components:[I,N]}).extend({setProgress:function(e){y&&(D.width=y.frameWidth*l.scale.x*(.96*e),s&&(s.position.x=-5+D.x+D.width,e>.95&&(s.alpha=Math.max(0,1-(e-.92)/.04)))),k||e>=1&&(r.setup({imageName:"gui/ingame/position-finish-on",originRelative:new t(.5,.5)}),k=!0)},setRival:function(e){if(c){if(e=.1*Math.min(e/.3,1)+.9*Math.max(0,(e-.3)/.7),c.position.x=-5+D.x+20+(y.frameWidth*l.scale.x-20)*(.96*e),s){var t=c.position.x-s.position.x;c.alpha=u.clamp(0,(t-4)/3,1)}e>.95&&(c.alpha=Math.min(c.alpha,Math.max(0,1-(e-.92)/.04)))}},hide:function(){new h({from:U.position.y,to:-34,in:8,delay:10,ease:"easeInQuad",onUpdate:function(e,t){U.position.y=e},onComplete:function(){U.removeSelf()}})}});return U}}),bento.define("gui/main/raceprogress",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/eventsystem","bento/gui/clickbutton","bento/gui/counter","bento/gui/text","bento/utils","bento/tween","globals","gui/general/uiloader","components/mask"],function(e,t,n,i,r,o,a,s,c,l,u,h,d,p,f){"use strict";return function(i){e.getViewport();var r,a,s,c,l=new p({loadJson:"ui/raceprogress",onObject:function(e){"circleSprite"===e.name?r=e.getComponent("circleSprite"):"barEntity"===e.name||"barSprite"===e.name&&(a=e,s=e.getComponent("barSprite"),u.x=-s.origin.x*a.scale.x*.1,u.y=-s.origin.y*a.scale.y,u.width=s.frameWidth*a.scale.x,u.height=s.frameHeight*a.scale.y,a.attach({name:"setRectangle",start:function(){u.x=-s.origin.x*a.scale.x,u.y=-s.origin.y*a.scale.y,u.width=s.frameWidth*a.scale.x,u.height=s.frameHeight*a.scale.y,a.remove(this)}}),c=new f({rectangle:u,sprite:s}),e.attach(c))},onComplete:function(e){g.attach(e),l.done=!0}}),u=new n(0,0,0,1),m=!1,g=new o({z:d.RaceLayers.GUI,name:"raceProgress",family:[""],position:i.position,updateWhenPaused:0,components:[l]}).extend({setProgress:function(e){s&&(u.width=s.frameWidth*a.scale.x*e),m||e>=1&&(r.setup({imageName:"gui/gameplay/progress_finish",originRelative:new t(.5,.5)}),m=!0)},hide:function(){new h({from:g.position.y,to:-34,in:8,delay:10,ease:"easeInQuad",onUpdate:function(e,t){g.position.y=e},onComplete:function(){g.removeSelf()}})}});return g}}),bento.define("gui/main/settingsdialog",["bento","bento/math/vector2","bento/math/rectangle","bento/entity","bento/eventsystem","bento/utils","bento/tween","bento/gui/text","gui/general/dialog","globals","modules/localization","components/hdsprite","bento/components/sprite","components/iconbutton","managers/textstyles","gui/general/iapoverlay"],function(e,t,n,i,r,o,a,s,c,l,u,h,d,p,f,m){"use strict";return function(r){var o=function(e){var r=new h({gamepixelDimension:new n(0,0,118,37),imageName:"gui/settings/option_base",originRelative:new t(.5,.5)}),o=e.toggleState,a=new d({imageName:"gui/settings/icon_"+e.icon+(e.toggle?o?"":"_off":""),originRelative:new t(.5,.5),animations:{default:{speed:0,frames:[0]}}}),c=new i({name:"settingIcon",position:new t(0,0),scale:new t(.8,.8),components:[a]}),l=new p({position:new t(38,.7),imageName:"gui/settings/setting_buttonA",frameCountX:1,frameCountY:3,icon:c,offset:new t(0,0),offsetOnPressed:2,iconAlpha:.5,excited:!0,onClick:function(){e.toggle&&(o=!o,a.setup({imageName:"gui/settings/icon_"+e.icon+(o?"":"_off"),originRelative:new t(.5,.5)})),e.onClick&&e.onClick()}}),u=f.get("black8");u.align="left";var m=new s({text:e.text,fontSettings:u,maxWidth:58,maxHeight:26,drawDebug:!1,position:new t(-48,0),margin:t(4,0)});return new i({name:"grid"+e.name,position:e.position,components:[r,l,m]})},a=new c({z:l.MergeLayers.SETTINGS||r.z,updateWhenPaused:r.updateWhenPaused,title:u.getText("settingsTitle"),height:228,onComplete:r.onComplete}),g=new o({icon:"settings01",text:u.getText("settingsMuteSound"),position:new t(0,-50),toggle:!0,toggleState:!e.saveState.load("muteSound",!1),onClick:function(){var t=!e.saveState.load("muteSound",!1);e.saveState.save("muteSound",t),e.audio.muteSound(t,!1)}});new o({icon:"settings02",text:u.getText("settingsHaptics"),position:new t(0,-8),toggle:!0,toggleState:!e.saveState.load("muteHaptics",!1),onClick:function(){e.saveState.save("muteHaptics",!e.saveState.load("muteHaptics",!1))}}),new o({icon:"settings03",text:u.getText("settingsRestorePurchases"),position:new t(0,34),onClick:function(){m.restore({z:l.MergeLayers.IAPOVERLAY})}}),new p({z:0,position:new t(0,74),imageName:"gui/buttons/button_buyback",frameCountX:2,frameCountY:1,icon:new i({}),iconSprite:new d({}),iconName:"",iconOffset:new t(0,0),offsetOnPressed:0,iconAlpha:.5,excited:!0,onClick:function(){l.user_guest||(l.user_guest=!0,window.plingaRpc.logoutUser(function(e){}))}}),new s({position:new t(0,-6),text:"Log out",scale:new t(4,4),fontSettings:f.get("red"),align:"center",shadow:!1,shadowOffset:new t(1.4,1.4),shadowColor:"#000000"});return a.content.attach(g),a}}),bento.define("gui/main/testdrivedialog",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/eventsystem","bento/gui/clickbutton","bento/gui/counter","bento/gui/text","bento/utils","bento/tween","gui/general/dialog","components/hdsprite","managers/textstyles","components/iconbutton","modules/watchad","globals","managers/pricing","modules/savemanager","components/mask","modules/localization","gui/general/iapoverlay"],function(e,t,n,i,r,o,a,s,c,l,u,h,d,p,f,m,g,v,y,b,w,x,E){"use strict";return function(e){var r=e.onComplete,s=new d({name:"testDriveDialog",title:x.getText("subscriptionName"),width:132,height:160,bodyColor:"black",onExit:function(){T.active=!1},onComplete:function(){r&&r()}}),c=new p({gamepixelDimension:new n(0,0,43,33),imageName:"gui/vip/vip_crown",originRelative:new t(.5,.5)});c.position.y=-91;var u=new p({gamepixelDimension:new n(0,0,200,70),imageName:"gui/vip/vip_banner",originRelative:new t(.5,.5)});u.position.y=-47,s.getComponent("windowContainer",function(e){e.getComponent("titleSlice",function(t){e.attach(u),e.attach(c);var n=e.components.indexOf(t);e.moveComponentTo(u,n),e.moveComponentTo(c,n),e.remove(t)}),e.getComponent("titleText",function(e){e.position.y+=5})});var h=new o({name:"icon",position:new t(0,-26),scale:new t(.1,.1),components:[new i({imageName:"gui/vip/vip_cars",originRelative:new t(.5,.5)})]}).attach(new Object({name:"pulser",timer:0,update:function(e){this.timer+=e.speed;var t=.05*Math.sin(this.timer/80);h.rotation=t}}));s.content.attach(h);var y=new l({text:x.getText("tryOut").toUpperCase(),position:new t(9,-2),fontSettings:f.get("black8"),align:"center",textBaseline:"middle",maxWidth:40,drawDebug:!1,linebreaks:!1,lineWidth:.8,strokeStyle:"#a1ff39"});y.rotation=-.1;var w=new o({name:"adIcon",position:new t(-25,-2),scale:new t(.144,.144),components:[new i({imageName:"gui/home/icon_video",originRelative:new t(.5,.5)})]}),E=new p({gamepixelDimension:new n(0,0,32,32),imageName:"gui/level_completed/star_x5",originRelative:new t(.5,.5)});E.position.y=-17,E.position.x=42;var S=new l({text:"x2",position:new t(42,-17),fontSettings:f.get("black15"),align:"center",maxWidth:32,linebreaks:!1,drawDebug:!1});S.rotation=-.3;var _=o({name:"iconContainer",position:new t(0,-24),scale:new t(1/.144,1/.144),components:[w,y,E,S]}),T=new m({name:"tryButton",z:0,position:new t(0,30),imageName:"gui/buttons/button_rv_small",frameCountX:1,frameCountY:3,icon:_,offset:new t(0,-2),offsetOnPressed:2,iconAlpha:.5,excited:!0,onClick:function(){g.showRewarded({z:v.MergeLayers.DIALOG,tag:"testDrive",onReward:function(){b.save("testDrive",2),b.save("skippedAds",0),a.fire("updateCarMaterial"),s.dismiss()}})}}).attach(new Object({name:"pulser",timer:0,update:function(e){this.timer+=e.speed;var t=.975+.05*Math.sin(this.timer/15);T.scale.x=T.scale.y=.144*t}}));return s.content.attach(T),s}}),bento.define("gui/main/vipdialog",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/eventsystem","bento/gui/clickbutton","bento/gui/counter","bento/gui/text","bento/utils","bento/tween","components/hdnineslice","components/hdsprite","components/iconbutton","managers/textstyles","gui/general/iapoverlay","globals","bento/components/fill","modules/localization","modules/savemanager","gui/general/fountain","components/backbutton","modules/banner","managers/vipmanager"],function(e,t,n,i,r,o,a,s,c,l,u,h,d,p,f,m,g,v,y,b,w,x,E,S,_){"use strict";var T,M,C,A=e.getViewport(),R=function(r){var s=r.bodyColor||"white",c=r.onExit,y=r.onComplete,x={name:"behaviorComponent",start:function(e){new h({from:0,to:1,in:20,ease:"elastic",decay:6,oscillations:1,onUpdate:function(e,t){ue.scale.x=e,ue.scale.y=e},onComplete:function(){}}),R.preloadTerms(),T&&T.removeSelf(),M&&M.removeSelf(),C&&C.removeSelf(),he.attach(T),he.attach(M),he.attach(C),new h({from:0,to:1,in:12,ease:"easeOutQuad",onUpdate:function(e,t){B.alpha=e,T.alpha=e,M.alpha=e,C.alpha=e}}),S.shouldShow()&&S.hideBanner(),a.on("bannerStatusChanged",P)},destroy:function(e){},update:function(e){},draw:function(e){}},P=function(){S.shouldShow()&&S.hideBanner()},I=new p({gamepixelDimension:new n(0,0,43,33),imageName:"gui/vip/vip_crown",originRelative:new t(.5,.5)});I.position.y=-103.5;var L,D=new p({gamepixelDimension:new n(0,0,200,70),imageName:"gui/vip/vip_banner",originRelative:new t(.5,.5)});switch(D.position.y=-59.5,b.getLanguage()){case"es":case"fr":case"it":case"pt":L=1;break;case"ru":L=2;break;default:L=0}var O=new l({position:new t(0,(L?1===L?22:16:11)-87.5),text:b.getText("VIP").toUpperCase()||"VIP",fontSettings:m.get(2!==L?"black18":"black22"),align:"center",maxWidth:156*.8,shadow:!0,shadowOffset:new t(0,1.4),shadowColor:"#fef874",linebreaks:!1});O.name="titleTextVIP";var k=new l({position:new t(0,(L?1===L?9:16:24)-87.5),text:b.getText("membership").toUpperCase()||"membership",fontSettings:m.get("black10"),align:"center",maxWidth:156*.8,shadow:!0,shadowOffset:new t(0,1.4),shadowColor:"#fef874",linebreaks:!1});k.name="titleTextMembership",2===L&&(k.visible=!1);var F=new d({gamepixelDimension:new n(0,0,156,148),imageName:"gui/9slice/popup_down_"+s,originRelative:new t(.5,0),position:new t(0,-60.5)}),B=new p({gamepixelDimension:new n(0,0,A.width,A.height),imageName:"gui/vip/vip_background",originRelative:new t(.5,.5)});B.position.x=A.width/2,B.position.y=A.height/2;var N=new E({onPressed:function(e){c&&c(),he.dismiss()}}),U=new f({name:"exitButton",position:new t(73,-82.5),imageName:"gui/buttons/button_popupexit",frameCountX:2,frameCountY:1,sort:!0,onClick:function(){c&&c(),he.dismiss()}}).attach(N),z=new o({name:"vipCars",position:new t(0,-56),scale:new t(.144,.144),components:[new i({imageName:"gui/vip/vip_cars",originRelative:new t(.5,.5)})]}),G=new l({position:new t(0,-28),text:b.getText("accessToCars").toUpperCase(),fontSettings:m.get("black6"),align:"center",maxWidth:93.6,linebreaks:!1});G.name="vipCarText";var H=new l({name:"title",position:new t(0,-18),text:"+",fontSettings:m.get("black16"),align:"center",maxWidth:93.6,linebreaks:!1});H.name="vipPlus";var j=new p({gamepixelDimension:new n(0,0,30,26),imageName:"gui/vip/vip_icon01",originRelative:new t(.5,.5)});j.position.y=-4;var V=new l({name:"title",position:new t(0,14),text:b.getText("shopNoAds"),fontSettings:m.get("vipRewardText"),maxWidth:40,linebreaks:!1});V.name="noAdsText";var W=new p({gamepixelDimension:new n(0,0,45,47),imageName:"gui/vip/vip_box",originRelative:new t(.5,.5)}),X=new o({name:"noAdsContainer",position:new t(-47,11),components:[W,j,V]}),q=new p({gamepixelDimension:new n(0,0,40,21),imageName:"gui/vip/vip_icon02",originRelative:new t(.5,.5)});q.position.y=-9;var Y=new l({position:new t(0,0),text:160,fontSettings:m.get("white14"),maxWidth:40,align:"center",lineWidth:1,strokeStyle:"#45548f",shadow:!0,shadowOffset:new t(0,1),shadowColor:"#45548f",linebreaks:!1});Y.name="gemAmountText";var J=new l({position:new t(0,12),text:b.getText("freeGems"),fontSettings:m.get("vipRewardText"),maxWidth:40,linebreaks:!1});J.name="freeGemText";var K=m.get("vipRewardText");K.fontSize=4;var Z=new l({position:new t(0,17),text:b.getText("everyDay"),fontSettings:K,maxWidth:40,linebreaks:!1});Z.name="everyDayText";var Q=new p({gamepixelDimension:new n(0,0,45,47),imageName:"gui/vip/vip_box",originRelative:new t(.5,.5)}),$=new o({name:"freeGemContainer",position:new t(0,11),components:[Q,q,Y,J,Z]}),ee=new p({gamepixelDimension:new n(0,0,25,25),imageName:"gui/vip/vip_icon03",originRelative:new t(.5,.5)});ee.position.y=-7;var te=new l({name:"title",position:new t(0,12),text:b.getText("doubleRewards"),fontSettings:m.get("vipRewardText"),maxWidth:40,ySpacing:-.5,maxHeight:13});te.name="doubleRewardText";var ne=new p({gamepixelDimension:new n(0,0,45,47),imageName:"gui/vip/vip_box",originRelative:new t(.5,.5)}),ie=new o({name:"doubleRewardContainer",position:new t(47,11),components:[ne,ee,te]}),re=m.get("white10");re.fontSize=11;var oe=new l({position:new t(0,-13),text:b.getText("tryForFree").toUpperCase(),fontSettings:re,maxWidth:86,align:"center",shadow:!0,shadowOffset:new t(0,1),shadowColor:"#3e79fc",linebreaks:!1}),ae=new l({position:new t(0,2),text:b.getText("freeTrial").replace("{NUMBER}",3).replace("{CURRENCY}",g.getPrice("roadcrash_vip","$4.99")),font:"montserrat-black-italic",fontSize:7,fontColor:"#37519c",margin:new t(4,4),maxWidth:82,maxHeight:21,ySpacing:.5,align:"center",textBaseline:"middle",shadow:!0,shadowOffset:new t(0,1),shadowColor:"#1ce3fe"}),se=new o({name:"tryIcon",position:new t(0,0),scale:new t(1/.144,1/.144),components:[oe,ae]}),ce=new f({name:"tryButton",z:0,position:new t(0,63.5),imageName:"gui/monday_madness/mm_button",frameCountX:1,frameCountY:3,icon:se,offset:new t(0,0),offsetOnPressed:2,iconAlpha:.5,excited:!0,onClick:function(){u.isDev()?e.saveState.load("VIP",!1)||(e.saveState.save("VIP",!0),e.saveState.save("VipFailedValidations",0),a.fire("onVipChanged",!0),he.dismiss()):g.purchase({z:v.MergeLayers.IAPOVERLAY,id:"roadcrash_vip",subscription:!0,isConsumable:!1,onPurchaseComplete:function(e,t,n){e&&"roadcrash_vip"===t&&he.dismiss()}})}}).attach(new Object({name:"pulser",timer:0,update:function(e){this.timer+=e.speed;var t=.975+.05*Math.sin(this.timer/15);ce.scale.x=ce.scale.y=.144*t}})),le=new o({name:"windowContent",position:new t(0,24),components:[z,G,H,X,$,ie,ce]}),ue=new o({z:0,name:"windowContainer",position:new t(A.width/2,.42*A.height),components:[F,I,D,U,O,k,le]}),he=new o({z:v.MergeLayers.IAPMENU,name:"iapMenu",position:r.position,updateWhenPaused:0,components:[B,ue,x]}).extend({dismiss:function(){a.off("bannerStatusChanged",P),S.showBanner({noAds:e.saveState.load("noBanner",!1)||w.load("noAds")||_.isVip()}),new h({from:1,to:0,in:15,ease:"easeInBack",onUpdate:function(e,t){ue.scale.x=e,ue.scale.y=e},onComplete:function(){y&&y(),he.removeSelf()}}),new h({from:1,to:0,in:12,ease:"easeInQuad",onUpdate:function(e,t){B.alpha=e,T.alpha=e,M.alpha=e,C.alpha=e}})}});return he};return R.preloadTerms=function(){if(!T){var e="GooglePlay";u.isNativeAndroid()&&(e="GooglePlay"),u.isNativeIos()&&(e="iTunes");var i=.92*A.width,o=b.getText("subscriptionTerms").replace("{SUBSCRIPTIONNAME}",b.getText("subscriptionName")).replace("{DAYS}",3).replace("{PRICE}",g.getPrice("roadcrash_vip","$4.99")).replace("{FEATURES}",b.getText("subscriptionFeatures").replace("{AMOUNT}",160)).replace("{SERVICE}",e);if((T=new l({position:new t(A.width/2-i/2,A.height-20),text:o,font:"Helvetica",fontSize:4,fontColor:"#ffffff",align:"left",textBaseline:"bottom",maxWidth:i,maxHeight:A.height-175-32-60,linebreaks:!0,ySpacing:2})).start(),!M&&((M=new l({position:new t(.25*A.width,A.height-10),text:b.getText("privacyPolicy"),font:"montserrat-black-italic",fontSize:6,fontColor:"#28aeff",align:"center",textBaseline:"bottom",maxWidth:.4*A.width,drawDebug:!1,linebreaks:!1,boundingBox:new n(-.15*A.width*3,-8,.3*A.width*3,9),components:[new r({sort:!0,onClick:function(e){console.log("-----openurl  removed------")}})]})).start(),!C))return(C=new l({position:new t(.75*A.width,A.height-10),text:b.getText("termsOfService"),font:"montserrat-black-italic",fontSize:6,fontColor:"#28aeff",align:"center",textBaseline:"bottom",maxWidth:.4*A.width,drawDebug:!1,linebreaks:!1,boundingBox:new n(-.15*A.width*3,-8,.3*A.width*3,9),components:[new r({sort:!0,onClick:function(e){}})]})).start(),R}},R}),bento.define("gui/main/vipgemdialog",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/eventsystem","bento/gui/clickbutton","bento/gui/counter","bento/gui/text","bento/utils","bento/tween","gui/general/dialog","components/hdsprite","managers/textstyles","components/iconbutton","modules/watchad","globals","managers/pricing","modules/savemanager","components/mask","modules/localization","gui/general/iapoverlay","gui/general/fountain"],function(e,t,n,i,r,o,a,s,c,l,u,h,d,p,f,m,g,v,y,b,w,x,E,S){"use strict";var _=function(n){var i=0,r=0,o=0,a=0;e.objects.attach(new S({imageName:"gui/home/"+n.icon,z:1e5,onComplete:n.onComplete,scale:new t(n.scale||.06,n.scale||.06),amount:n.amount,interpolations:[new Object({from:n.from,fromMin:new t(-16,-16),fromMax:new t(16,16),to:n.to,toMin:new t(-16,-8),toMax:new t(16,8),start:0,end:30,ease:"easeInQuint",type:"position"}),new Object({from:new t(0,0),to:new t(0,0),toMin:new t(-28,-14),toMax:new t(28,14),start:0,end:22,ease:"easeInOutQuad",type:"position"}),new Object({from:new t(0,0),to:new t(0,0),start:22,end:30,ease:"easeInQuad",type:"position"}),new Object({from:1,to:0,start:26,end:30,ease:"easeInQuad",type:"alpha"})],onCreate:function(e){e.id!==i&&(r+=1.5,i=e.id),1===e.ii?(o=e.t.x,a=e.t.y):2===e.ii&&(e.t.x=-o,e.t.y=-a),e.s+=r,e.e+=r}}))};return function(r){var s=e.getViewport(),c=r.onComplete,u=new d({name:"testDriveDialog",title:x.getText("subscriptionName"),width:132,height:160,onExit:function(){},onComplete:function(){c&&c()}}),m=new p({gamepixelDimension:new n(0,0,43,33),imageName:"gui/vip/vip_crown",originRelative:new t(.5,.5)});m.position.y=-91;var g=new p({gamepixelDimension:new n(0,0,200,70),imageName:"gui/vip/vip_banner",originRelative:new t(.5,.5)});g.position.y=-47,u.getComponent("windowContainer",function(e){e.getComponent("exitButton",function(e){e.active=!1,e.visible=!1}),e.getComponent("titleSlice",function(t){e.attach(g),e.attach(m);var n=e.components.indexOf(t);e.moveComponentTo(g,n),e.moveComponentTo(m,n),e.remove(t)}),e.getComponent("titleText",function(e){e.position.y+=5})});var v=f.get("gemRewardWheel");v.fontSize=26;var y=new o({name:"icon",position:new t(0,-8),scale:new t(.28,.28),components:[new i({imageName:"gui/luckywheel/lw_gem_icon",originRelative:new t(.5,.5)}),new l({text:"160",position:new t(1/.28*-3,1/.28*18),scale:new t(1/.28,1/.28),fontSettings:v,lineWidth:3,linebreaks:!1,drawDebug:!1})]});return u.content.attach(y),new h({from:1,to:0,in:24,applyOnDelay:!0,delay:40,ease:"easeInQuad",onStart:function(){b.add("gems",160),new _({icon:"gem-icon",from:new t(s.width/2,s.height/2),to:new t(s.width/2+60,32),amount:20,onComplete:function(){a.fire("updateGems")}}),e.audio.stopSound("sfx_coin_collect"),e.audio.playSound("sfx_coin_collect")},onUpdate:function(e,t){y.scale.x=y.scale.y=.28*e},onComplete:function(){u.dismiss()}}),u}}),bento.define("modules/crosspromo/crosspromo",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/components/fill","bento/entity","bento/eventsystem","bento/gui/clickbutton","bento/gui/counter","bento/gui/text","bento/utils","bento/tween","modules/crosspromo/inappstore","bento/packedimage","modules/localization","bento/components/modal","modules/crosspromo/polaroid","components/sortedclickable"],function(e,t,n,i,r,o,a,s,c,l,u,h,d,p,f,m,g,v,y){"use strict";var b,w,x,E="",S="666586",_=function(){var e,t,n;window.FBInstant||h.WEB||(T=!1,e=function(){!function(e){var t,n=0,i=A.concat([]),r=function(e){var t=(P[e]||{}).urlScheme;window.appAvailability.check(t,function(){k(e),n+=1,o()},function(){n+=1,o()})},o=function(){n===i.length&&(e(),e=function(){})};if(k(E),window.appAvailability)if(i.length<1)e();else for(t=0;t<i.length;++t)r(i[t]);else e()}(function(){var e;e=function(){console.log("CROSSPROMO ready to show "+F),T=!0,z.onReady&&z.onReady()},0!==A.length?(z.shuffleApp(),e()):console.log("Crosspromo: no more apps to show.")})},t={src:"https://lucky-kat.s3.amazonaws.com/crosspromo/crosspromo.js",onSuccess:function(){var t,n=window.Downloaded.crosspromo||{},i=n.games,r=n.waterFalls;I=n.titles||{},R=r[E]||r.default;var o=i[E]||{};for(t in(h.isNativeIos()||h.isDev())&&o.ios?(D=o.ios.impression,O=o.ios.click):h.isNativeAndroid()&&o.android&&(D=o.android.impression,O=o.android.click),D=D||{},O=O||{},i)i.hasOwnProperty(t)&&(P[t]=P[t]||{},P[t].bundleId=i[t].bundleId,P[t].urlScheme=i[t].urlScheme,h.isNativeAndroid()&&(P[t].urlScheme=P[t].bundleId),P[t].iosId=i[t].iosId,P[t].ios="https://itunes.apple.com/app/apple-store/id"+i[t].iosId,P[t].android="https://play.google.com/store/apps/details?id="+i[t].bundleId,A.push(t));e(n)},onFailure:function(){console.log("Crosspromo: Could not get JS file from server")}},(n=document.createElement("script")).type="text/javascript",n.src=t.src,n.onload=function(){t.onSuccess&&t.onSuccess(),n.parentNode.removeChild(n)},n.onerror=function(){t.onFailure&&t.onFailure()},document.head.appendChild(n))},T=!1,M=E,C=S,A=[],R=[],P={},I={},L={},D={},O={},k=function(e){console.log("Crosspromo: Already has "+e),L[e]=!0},F="",B=!1,N=function(){var e;0!=(!(!window.device||!window.device.version)&&(e=window.device.version,parseInt(e.substring(0,e.indexOf(".")))>8))?p.open(P[F].iosId,M,C,function(){console.log("Crosspromo: done preloading inappstore")},function(){console.log("Crosspromo: Could not load In App Store"),B=!0}):B=!0},U=function(e){var t=new window.XMLHttpRequest;t.onreadystatechange=function(){4===this.readyState&&200===this.status&&console.log("Crosspromo: "+this.responseText)},t.open("GET",e,!0),t.send()},z=function(t){var n=new v(t),i=new y({onClick:function(e){var t=O[F]||"";!L[F]&&t.indexOf("https")>-1&&U(t),z.openCrossPromo(),b&&b(F)}});return n.attach(new Object({name:"behavior",start:function(){if(T){var t=D[F]||"";!L[F]&&t.indexOf("https")>-1&&U(t),x+=1,e.saveState.save("timesPromoShown",x)}},destroy:function(e){w&&w(F)}})),n.attach(i),T?n.setVideoUrl(["./lib/crosspromo/"+F+".mp4","https://lucky-kat.s3.amazonaws.com/crosspromo/mp4/"+F+".mp4"]):(h.log("WARNING: Crosspromo is not ready to be shown."),n.visible=!1),n};return z.shuffleApp=function(){if(0!==A.length){var t=x%R.length;window.isChinese()&&"nomplant"===R[t]&&(e.saveState.save("timesPromoShown",++x),t++),F=R[t],h.isNativeIos()&&N(),I[F]}else console.log("Crosspromo: no more apps to show.")},z.init=function(t){b=t.onClick,w=t.onClose,E=t.gameId||"roadcrash",S=t.providerToken||"",x=e.saveState.load("timesPromoShown",0),_()},z.canShow=function(){return T},z.show=function(e){T=e},z.openCrossPromo=function(){var e=function(e){h.openUrl(e)};if(L[F])return h.isNativeAndroid()?void e(P[F].android):void e(P[F].urlScheme);h.isNativeAndroid()?e(P[F].android):h.isNativeIos()?B?e(P[F].ios):(p.show(),N()):e(P[F].ios)},z.currentEntity=null,z}),bento.define("modules/crosspromo/inappstore",["bento","bento/utils"],function(e,t){"use strict";var n=!0,i=!1,r=!1,o=function(){if(i)return console.log("not ready for showing"),void(r=!0);console.log("show"),window.plugins.inappstore.show()};return window.plugins&&window.plugins.inappstore||(n=!1),t.isNativeIos()||(n=!1),{open:function(e,t,a,s,c){return n?i?void 0:(window.plugins.inappstore.openWithTokens(e,t,a,function(){s&&s(),i=!1,r&&(r=!1,o())},function(){c&&c()}),!0):(c&&c(),!1)},show:o}}),bento.define("modules/crosspromo/polaroid",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/eventsystem","bento/gui/clickbutton","bento/gui/counter","bento/gui/text","bento/utils","bento/tween","modules/localization","bento/packedimage"],function(e,t,n,i,r,o,a,s,c,l,u,h,d,p){"use strict";return function(r){var a,s,c,u,h,f=r.videoSource||[],m=r.size||new n(0,0,128,128),g=new n(0,0,0,0),v=function(e,t){var n=document.createElement("video"),i=function(e,t){t||(t="video/"+e.substr(e.lastIndexOf(".")+1));var n=document.createElement("source");return n.src=e,n.type=t,n};if(n.loop=!0,n.muted=!0,n.setAttribute("webkit-playsinline","webkit-playsinline"),n.setAttribute("playsinline","playsinline"),n.crossOrigin="anonymous",n.addEventListener("loadedmetadata",function(e){g.width=n.videoWidth,g.height=n.videoHeight,a&&(a.scale.x=220/g.width,a.scale.y=220/g.height),t&&t()}),Array.isArray(e))for(var r=0;r<e.length;++r)n.appendChild(i(e[r].src||e[r],e[r].mime));else n.appendChild(i(e.src||e,e.mime));return n.load(),n.play(),n},y=function(){if(a&&(a.removeSelf(),s.pause(),s.removeAttribute("src"),s.load(),c.update=function(){},h.destroy(!0,!0)),f&&0!==f.length){s=v(f),c=new window.PIXI.VideoBaseTexture.fromVideo(s),u=new window.PIXI.Texture(c),h=new window.PIXI.Sprite(u);var n={name:"videoPause",video:s,paused:!1,updateWhenPaused:999,start:function(){this.play()},destroy:function(){this.pause()},pause:function(){this.paused||(this.paused=!0,this.video.pause())},play:function(){this.paused&&(this.paused=!1,this.video.play())},update:function(){e.objects.isPaused(a)?this.paused||(this.paused=!0,this.video.pause()):this.paused&&(this.paused=!1,this.video.play())}};return a=new o({name:"video",position:new t(-110,-110),components:[new Object({name:"renderVideo",start:function(){e.objects.attach(n)},destroy:function(){e.objects.remove(n)},draw:function(e){e.renderer.drawPixi(h)}})]}),_.attach(a),a}},b=function(){var e=v(f,function(){var t,n=new p(e);n.width=e.videoWidth,n.height=e.videoHeight,t=new i({image:n}),a.attach(t)});return a&&a.removeSelf(),a=new o({name:"video",position:new t(-110,-110),components:[]}),_.attach(a),a},w="pixi"===e.getRenderer().name,x=new i({imageName:"crosspromo-border",originRelative:new t(.5,.5)}),E=new l({position:new t(62,110),text:"play",font:"crosspromo",fontSize:24,fontColor:"#fff",align:"center",textBaseline:"middle",maxWidth:72,maxHeight:24,components:[]}),S=new l({position:new t(-48,110),text:d.getText("moreGames"),font:"crosspromo",fontSize:20,fontColor:"#777",align:"center",textBaseline:"middle",maxWidth:128,maxHeight:20,components:[]}),_=new o({name:"videoContainer"}),T=new o({z:r.z,name:"crosspromo",position:r.position,scale:r.scale,rotation:r.rotation,components:[_,x,E,S]});return T.extend({setVideoUrl:function(e){f=e,w?y():b()},setSize:function(e){T.scale.x=e.width/x.frameWidth,T.scale.y=e.height/x.frameHeight}}),f&&(w?y():b()),
T.setSize(m),T}});